/* 2.0.15.0 */
(function (n) { function i(n, t) { if (!(n.originalEvent.touches.length > 1)) { n.preventDefault(); var i = n.originalEvent.changedTouches[0], r = document.createEvent("MouseEvents"); r.initMouseEvent(t, !0, !0, window, 1, i.screenX, i.screenY, i.clientX, i.clientY, !1, !1, !1, !1, 0, null); n.target.dispatchEvent(r) } } if (n.support.touch = "ontouchend" in document, n.support.touch) { var t = n.ui.mouse.prototype, u = t._mouseInit, f = t._mouseDestroy, r; t._touchStart = function (n) { var t = this; !r && t._mouseCapture(n.originalEvent.changedTouches[0]) && (r = !0, t._touchMoved = !1, i(n, "mouseover"), i(n, "mousemove"), i(n, "mousedown")) }; t._touchMove = function (n) { r && (this._touchMoved = !0, i(n, "mousemove")) }; t._touchEnd = function (n) { r && (i(n, "mouseup"), i(n, "mouseout"), this._touchMoved || i(n, "click"), r = !1) }; t._mouseInit = function () { var t = this; t.element.bind({ touchstart: n.proxy(t, "_touchStart"), touchmove: n.proxy(t, "_touchMove"), touchend: n.proxy(t, "_touchEnd") }); u.call(t) }; t._mouseDestroy = function () { var t = this; t.element.unbind({ touchstart: n.proxy(t, "_touchStart"), touchmove: n.proxy(t, "_touchMove"), touchend: n.proxy(t, "_touchEnd") }); f.call(t) } } })(jQuery); String.prototype.equals = function (n, t) { return t ? this.toString().toLowerCase() === n.toLowerCase() : this.toString() === n }; String.prototype.equalsIgnoreCase = function (n) { return this.toString().toLowerCase() === n.toLowerCase() }; String.prototype.startsWith = function (n) { return n === "" ? !0 : this == null || n == null ? !1 : (n = String(n), this.length >= n.length && this.slice(0, n.length) === n) }; String.prototype.endsWith = function (n) { return n === "" ? !0 : this == null || n == null ? !1 : (n = String(n), this.length >= n.length && this.slice(this.length - n.length) === n) }; String.prototype.contains = function (n) { return this.indexOf(n) > -1 }; String.prototype.toUpper = function () { return this.toUpperCase() }; String.prototype.toLower = function () { return this.toLowerCase() }; String.prototype.compareTo = function (n) { var u = this.length, f = n.length, o = u < f ? u : f, t, r, e; for (i = 0; i < o; i++)if (t = this.charCodeAt(i), r = n.charCodeAt(i), t != r) return t > r ? 1 : t < r ? -1 : 0; return e = u - f, e > 0 ? 1 : e < 0 ? -1 : 0 }; String.prototype.replaceAll = function (n, t) { var i = this; return i.replace(new RegExp(n, "g"), t) }; Number.prototype.compareTo = function (n) { var t = this - n; return t > 0 ? 1 : t < 0 ? -1 : 0 }; Array.prototype.indexOf || (Array.prototype.indexOf = function (n) { for (var t = 0; t < this.length; t++)if (this[t] === n) return t; return -1 }); StringBuilder = function (n) { this.str = n ? n : "" }; StringBuilder.prototype.append = function (n) { return this.str += n, this }; StringBuilder.prototype.toString = function () { return this.str }; StringBuilder.prototype.endsWith = function (n) { return this.str.endsWith(n) }; StringBuilder.prototype.replace = function (n, t) { var i = this.str; return i.replace(new RegExp(n, "g"), t) }; StringBuilder.prototype.indexOf = function (n) { return this.str.indexOf(n) }; StringBuilder.prototype.length = function () { return this.str.length }; StringBuilder.prototype.insert = function (n, t) { return this.str = n > 0 ? this.str.substring(0, n) + t + this.str.substring(n, this.str.length) : t + this.str, this.str }; StringBuilder.prototype.clear = function () { return this.str.length = 0, this.str = "", this }; Date.prototype.toUniversalTime = function () { return new Date(this.getTime()) }; VISUtil = window.VISUtil || {}, function (n, t) { function c(t, i, r) { var u = function (u) { var f, e, o; if (isNaN(u) || u === null) return 0; if (f = u.toString(), e = f.indexOf("."), e != -1) { if (o = f.substring(0, e), o.length > t) return o = o.substring(0, t), o + f.substring(e, f.Length - e) } else if (i === 0 && r === 0) { if (f > n.EnvConstants.INT32MAXVALUE) return n.EnvConstants.INT32MAXVALUE; if (f < -1 * (n.EnvConstants.INT32MAXVALUE + 1)) return -1 * (n.EnvConstants.INT32MAXVALUE + 1) } return u }; this.GetFormatedValue = function (n) { var t = u(n).toString(); return r != 0 && (t.indexOf(".") <= -1 ? t = parseFloat(t).toFixed(r) : t.split(".")[1].length > r ? (t = parseFloat(t).toFixed(i), t = parseFloat(t)) : r === i ? t = parseFloat(t).toFixed(r) : t.split(".")[1].length < r && (t = parseFloat(t).toFixed(r))), t }; this.GetConvertedNumber = function (n, t) { var i; return n = this.GetConvertedString(n, t), t ? (i = n.split("."), !Number.isSafeInteger(Number(i[0]))) ? Number.MAX_SAFE_INTEGER : Number(String(n).replace(/[^0-9.-]+/g, "")) : (i = n.split(","), !Number.isSafeInteger(Number(i[0]))) ? Number.MAX_SAFE_INTEGER : Number(String(n).replace(/[^0-9,-]+/g, "").replace(/[,]+/g, ".")) }; this.GetConvertedString = function (n, t) { var i = ""; return t ? (i = n.match(/[.]+/g), i != null && i.length > 1 ? "" : String(String(n).replace(/[^0-9.-]+/g, ""))) : (i = n.match(/[,]+/g), i != null && i.length > 1 ? "" : String(String(n).replace(/[^0-9,-]+/g, "").replace(/[,]+/g, ","))) }; this.GetFormatAmount = function (n, t, i) { var e = window.navigator.language, o = String(n), f = "", u, r; return t == "init" ? f = o.split(".") : (t == "blur" || t == "formatOnly") && (f = i ? o.split(".") : o.split(",")), f[1] != undefined && (u = f[1].replace(/[\D\s\,_\-]+/g, "")), r = f[0].replace(/[\s\.\,_]+/g, ""), r = r ? parseInt(r, 10) : 0, u != undefined ? t == "init" || t == "formatOnly" ? i ? r.toLocaleString(e) + "." + u : r.toLocaleString(e) + "," + u : i ? r + "." + u : r + "," + u : t == "init" || t == "formatOnly" ? i ? r.toLocaleString(e) : r.toLocaleString(e) : i ? r : r }; this.getMinFractionDigit = function () { return r }; this.getMaxFractionDigit = function () { return i }; this.getLocaleAmount = function (t) { var i = this.GetFormatedValue(t).toLocaleString(undefined, { maximumFractionDigits: 6 }); return this.GetFormatAmount(i, "formatOnly", n.Env.isDecimalPoint()) }; this.dispose = function () { this.GetFormatedValue = null; this.GetConvertedNumber = null; this.GetConvertedString = null; this.GetFormatAmount = null; u = null } } function r(n) { this.pattern; this.applyPattern(n) } function o(n, t) { this.name = n; this.value = t; this.isDate = !1; this.isByteArray = !1 } function f() { this.tables = []; this.total = 0 } function u() { this.count = 0; this.totalPage = 0; this.page = 1; this.columns = []; this.rows = []; this.totalRecord = 0; this.columnsName = [] } function e(n, t) { this.cells = n.cells; this.id = n.id; this.parent = t } function i() { return this.rowIndex = -1, this.tables = [], this.curTable, this } function s() { } function h() { this.List = { sq: { decimalSeparator: !1 }, ar: { decimalSeparator: !0 }, bg: { decimalSeparator: !1 }, be: { decimalSeparator: !1 }, ca: { decimalSeparator: !1 }, zh: { decimalSeparator: !0 }, "zh-HK": { decimalSeparator: !0 }, "zh-CN": { decimalSeparator: !0 }, "zh-TW": { decimalSeparator: !0 }, hr: { decimalSeparator: !0 }, cs: { decimalSeparator: !1 }, da: { decimalSeparator: !1 }, nl: { decimalSeparator: !1 }, en: { decimalSeparator: !0 }, "en-AU": { decimalSeparator: !0 }, "en-CA": { decimalSeparator: !0 }, "en-IN": { decimalSeparator: !0 }, "en-NZ": { decimalSeparator: !0 }, "en-ZA": { decimalSeparator: !0 }, "en-US": { decimalSeparator: !0 }, "en-GB": { decimalSeparator: !0 }, et: { decimalSeparator: !1 }, fi: { decimalSeparator: !1 }, fr: { decimalSeparator: !1 }, "fr-CA": { decimalSeparator: !1 }, "fr-FR": { decimalSeparator: !1 }, "fr-CH": { decimalSeparator: !1 }, de: { decimalSeparator: !1 }, "de-AT": { decimalSeparator: !1 }, "de-DE": { decimalSeparator: !1 }, "de-LI": { decimalSeparator: !1 }, "de-CH": { decimalSeparator: !1 }, el: { decimalSeparator: !1 }, he: { decimalSeparator: !0 }, hi: { decimalSeparator: !0 }, hu: { decimalSeparator: !1 }, is: { decimalSeparator: !1 }, it: { decimalSeparator: !1 }, "it-IT": { decimalSeparator: !1 }, "it-CH": { decimalSeparator: !1 }, ja: { decimalSeparator: !0 }, ko: { decimalSeparator: !0 }, lv: { decimalSeparator: !1 }, lt: { decimalSeparator: !1 }, mk: { decimalSeparator: !1 }, nb: { decimalSeparator: !1 }, nn: { decimalSeparator: !1 }, pl: { decimalSeparator: !1 }, pt: { decimalSeparator: !1 }, "pt-BR": { decimalSeparator: !1 }, "pt-PT": { decimalSeparator: !1 }, ro: { decimalSeparator: !1 }, ru: { decimalSeparator: !1 }, sr: { decimalSeparator: !1 }, sh: { decimalSeparator: !1 }, sk: { decimalSeparator: !1 }, sl: { decimalSeparator: !1 }, es: { decimalSeparator: !1 }, "es-AR": { decimalSeparator: !1 }, "es-CL": { decimalSeparator: !1 }, "es-CO": { decimalSeparator: !1 }, "es-CR": { decimalSeparator: !1 }, "es-HN": { decimalSeparator: !1 }, "es-MX": { decimalSeparator: !1 }, "es-PE": { decimalSeparator: !1 }, "es-ES": { decimalSeparator: !1 }, "es-US": { decimalSeparator: !1 }, "es-UY": { decimalSeparator: !1 }, "es-VE": { decimalSeparator: !1 }, sv: { decimalSeparator: !1 }, th: { decimalSeparator: !0 }, tr: { decimalSeparator: !1 }, uk: { decimalSeparator: !1 }, vi: { decimalSeparator: !1 } } } n.Events = function () { var n = "click", t = "touchstart", i = "click", r; return "onmouseover" in document && "ontouchstart" in document ? (n = "click", t = "click") : "ontouchstart" in document ? (n = "touchstart", t = "touchstart") : (n = "click", t = "click"), i = "ontouchend" in document ? "touchend" : "click", r = "click", { onTouchStartOrClick: n, onTouchEndOrClick: i, onClick: r, onTouchStartAndClick: t } }(); n.Actions = { zoom: "zoom", refresh: "refresh", preference: "preference", add: "add", update: "update", remove: "delete", contact: "contact", addnewrec: "AddNewRecord", addproduct: "AddProduct" }; n.EnvConstants = { WINDOW_FIND: 1110, WINDOW_MLOOKUP: 1111, WINDOW_CUSTOMIZE: 1112, WINDOW_INFO: 1113, TAB_INFO: 1113, WINDOW_ACCOUNT: 1114, WINDOW_TEMP: 111e5, INT32MAXVALUE: 2147483647 }; n.Format = c; n.Utility = { divCoding: t("<div>"), inheritPrototype: function (n, t) { var i = Object.create(t.prototype); i.constructor = n; n.prototype = i; n.prototype.$super = t.prototype }, getBusyPanel: function () { return t("<div>").html(t("<strong>").html("Loading....")) }, getFunctionByName: function (n, t) { for (var f = [].slice.call(arguments).splice(2), i = n.split("."), u = i.pop(), r = 0; r < i.length; r++)t = t[i[r]]; return t[u] }, utf8_to_b64: function (n) { return window.btoa(unescape(encodeURIComponent(n))) }, b64_to_utf8: function (n) { return decodeURIComponent(escape(window.atob(n))) }, decodeText: function (n) { return this.divCoding.html(n).text() }, encodeText: function (n) { return this.divCoding.text(n).html() } }; n.Utility.encode = n.Utility.utf8_to_b64; n.Utility.decode = n.Utility.b64_to_utf8; n.Utility.Util = { getValueOfInt: function (n) { return n == null || n.toString().trim() == "" ? 0 : isNaN(n) ? 0 : parseInt(n.toString()) }, getValueOfDecimal: function (n) { return n == null || n.toString().trim() == "" ? 0 : isNaN(n) ? 0 : parseFloat(n.toString()) }, getValueOfDouble: function (n) { return n == null || n.toString().trim() == "" ? 0 : isNaN(n) ? 0 : parseFloat(n.toString()) }, getValueOfString: function (n) { return n == null || n.toString().trim() == "" ? "" : n == null ? "" : n.toString() }, getValueOfDate: function (n) { return n == null || n.toString().trim() == "" ? 0 : n ? new Date(n) : null }, getValueOfFormattedDateTime: function (n) { if (n == null || n.toString().trim() == "") return 0; if (n) { var t = new Date(n), i, r, u, f, e, o; return i = t.getFullYear(), r = t.getMonth().toString().length === 1 ? "0" + (t.getMonth() + 1).toString() : t.getMonth() + 1, u = t.getDate().toString().length === 1 ? "0" + t.getDate().toString() : t.getDate(), f = t.getHours().toString().length === 1 ? "0" + t.getHours().toString() : t.getHours(), e = t.getMinutes().toString().length === 1 ? "0" + t.getMinutes().toString() : t.getMinutes(), o = t.getSeconds().toString().length === 1 ? "0" + t.getSeconds().toString() : t.getSeconds(), i + "-" + r + "-" + u + "T" + f + ":" + e + ":" + o } return null }, getValueOfBoolean: function (n) { return n == null || n.toString().trim() == "" ? null : n.toString().toLowerCase() == "true" || n.toString() == "Y" ? !0 : !1 }, contains: function (n, t) { return n.indexOf(t) > -1 }, isEmpty: function (n) { return n == null || n.length === 0 ? !0 : !1 }, cleanMnemonic: function (n) { if (n == null || n.length == 0) return n; var t = n.indexOf("&"); return t == -1 ? n : (t + 1 < n.length && n.charAt(t + 1) != " " && (n = n.substring(0, t) + n.substring(t + 1)), n) }, scale: function (n) { var t, i; return isNaN(n) ? 0 : (t = 1.1, t = t.toLocaleString().substring(1, 2), i = n.toString().split(t), i.length > 2 || i.length == 1) ? 0 : i[1].length }, getIdentifierDisplayVal: function (n) { var t = ""; return n && n.indexOf("Images/") > -1 ? (t = n.replace("^^" + n.substring(n.indexOf("Images/"), n.lastIndexOf("^^") + 3), "_"), t.indexOf("Images/") > -1 && (t = t.replace(t.substring(t.indexOf("Images/"), t.lastIndexOf("^^") + 3), "_")), t.endsWith("_") && (t = t.substring(0, t.length - 1)), t.startsWith("_") && (t = t.substring(1))) : t = n, t } }; n.Env = function () { function h() { return r++ } function c() { return n.context } function l(n, t, i, r, u, f) { var l, c, s, a; if (typeof i != "number" && (f = u, u = r, r = i, i = 0), r == null || r.length == 0) return ""; for (var e = "", h = new String(""), o = r.indexOf("@"); o != -1 && o != r.lastIndexOf("@");) { if (l = r.substring(0, o), h += r.substring(0, o), r = r.substring(o + 1, r.length), c = r.indexOf("@"), c < 0) return ""; if (s = "", a = "", e = r.substring(0, c), e.contains(".") && (e = e.substring(0, e.indexOf("."))), s = n.getWindowContext(t, i, e, u), s.length == 0 && (e.startsWith("#") || e.startsWith("$")) && (s = n.getContext(e)), s.length == 0) { if (!f) return ""; h += " NULL " } else h += s; r = r.substring(c + 1, r.length); o = r.indexOf("@") } return h + r } function a(n, t, i, r, u, f) { var h, a, l, o, v; if (typeof i != "number" && (f = u, u = r, r = i, i = 0), h = [], r == null || r.length == 0) return ""; for (var e = "", c = new String(""), s = r.indexOf("@"); s != -1 && s != r.lastIndexOf("@");) { if (a = r.substring(0, s), c += r.substring(0, s), r = r.substring(s + 1, r.length), l = r.indexOf("@"), l < 0) return ""; if (o = "", v = "", e = r.substring(0, l), e.contains(".") && (e = e.substring(0, e.indexOf("."))), o = n.getWindowContext(t, i, e, u), o.length == 0 && (e.startsWith("#") || e.startsWith("$")) && (o = n.getContext(e)), o.length == 0) { if (!f) return ""; e.endsWith("_ID") ? h.push({ Key: e, Value: -1 }) : h.push({ Key: e, Value: null }); c += " NULL " } else h.push({ Key: e, Value: o }), c += o; r = r.substring(l + 1, r.length); s = r.indexOf("@") } return c += r, h } function v(n, t) { var o = [], s, e, r, h; if (n == null || n.length == 0) return ""; for (var i = "", f = new String(""), u = n.indexOf("@"); u != -1 && u != n.lastIndexOf("@");) { if (s = n.substring(0, u), f += n.substring(0, u), n = n.substring(u + 1, n.length), e = n.indexOf("@"), e < 0) return ""; if (r = "", h = "", i = n.substring(0, e), i.contains(".") && (i = i.substring(0, i.indexOf("."))), r = t[i.toLowerCase()], r.length == 0 && (i.startsWith("#") || i.startsWith("$")) && (r = ctx.getContext(i)), r.length == 0) { if (!ignoreUnparsable) return ""; o.push({ Key: i, Value: null }); f += " NULL " } else o.push({ Key: i, Value: r }), f += r; n = n.substring(e + 1, n.length); u = n.indexOf("@") } return f += n, o } function y(n, i) { var f, e, r, u; if (i) { if (n == t.DigitButLast4) return i.replace(/[^a-zA-Z0-9\.\-\@]/gi, "").replace(/[0-9](?=[\w\.\-\@]{4})/g, "*"); if (n == t.DigitButFirstLast4) { for (i = i.replace(/[^a-zA-Z0-9\.\-\@\s]/gi, ""), f = i.length, e = "", r = 0; r < f; r++)u = i[r], r > 3 && r < f - 4 && !isNaN(u) && (u = "*"), e += u; return e } if (n == t.AlphanumButLast4) return i.replace(/[^a-zA-Z0-9\.\s\@\-]/gi, "").replace(/[a-zA-Z0-9\s\.\@\-](?=[a-zA-Z0-9\s\.\@\-]{4})/g, "*"); if (n == t.AlphaNumButFirstLast4) { for (i = i.replace(/[^a-zA-Z0-9\@\.\s\-]/gi, ""), f = i.length, e = "", r = 0; r < f; r++)u = i[r], r > 3 && r < f - 4 && (u = "*"), e += u; return e } } } function p() { return u } function w(n) { n && n.toString().length != 0 || (n = 50); u = n } function b() { return f } function k(n) { f = n } function d(n, t, i, r) { if (n == null || i == null) throw new IllegalArgumentException("Require Context"); var u = null; return r ? (u = n.getContext("#" + i), u.length == 0 && (u = n.getContext("$" + i))) : (u = n.getContext("P" + t + "|" + i), u.length == 0 && (u = n.getContext("P|" + i))), u == null ? "" : u } function g(n, t) { var i = ""; return t > 0 && (i += n.getWindowContext(t, "WindowName", !1) + "  "), i } function nt(n) { var t, u, i; if (n == null) throw new Error("Require Context"); t = []; for (u in n) u.startsWith(r + "|") && t.push(u); while (t.length > 0) i = t.pop(), n[i] = null, delete n[i], i = null } function tt(n, t) { if (isNaN(n) || n === null) return "0"; var i = n.toString(); return i.contains(t) && (i = i.split(t).join("")), i } function e(n, t) { var i = [], r, u; return i = n.split("."), r = Globalize.format(Number(i[0]), "N", Globalize.cultureSelector), u = i[1] === "" ? ".0" : i[1], r.substring(0, r.length - 3) + t + u } function it(t, i, r) { return i = n.Env.removeCultCommaDot(i, t.thousendSeprator), i = i.split(t.decimalSeprator).join("."), i = t.format.GetFormatedValue(i), r === n.DisplayType.Amount ? i = Globalize.format(Number(i), "N", Globalize.cultureSelector) : r === n.DisplayType.Number && (i = e(i.toString(), t.decimalSeprator)), i } function rt() { return Date.now } function ut(n) { var t = ""; return t = typeof n != "string" ? o(n) : n, i() == t } function o(n) { if (n != null) { var t = n.getContext("#AD_Language"); if (t != null && t.length > 0) return t } return i() } function i() { return "en_US" } function ft(n) { return n == null || n.toString().trim() == "" ? 0 : isNaN(n) ? 0 : n > 0 ? 1 : n < 0 ? -1 : 0 } function et(n) { window.open(n) } function s(n) { return 1.1.toLocaleString(n).substring(1, 2) } function ot(n) { var t = window.navigator.language; return (n && n != "" && (t = n), s(t) != ",") ? !0 : !1 } var r = 1, u = 50, f = 400, t = { DigitButLast4: "904", DigitButFirstLast4: "944", AlphanumButLast4: "A04", AlphaNumButFirstLast4: "A44" }; return { getWindowNo: h, getCtx: c, parseContext: l, parseContext2: a, parseSQLFromRecords: v, getWINDOW_PAGE_SIZE: p, setWINDOW_PAGE_SIZE: w, setScreenHeight: k, getScreenHeight: b, getPreference: d, getHeader: g, clearWinContext: nt, removeCultCommaDot: tt, numberCultureValueFormat: e, numberDisplay: it, isBaseLanguage: ut, getAD_Language: o, getBaseAD_Language: i, currentTimeMillis: rt, signum: ft, startBrowser: et, isDecimalPoint: ot, getDecimalSeparator: s, ZERO: 0, ONE: 1, ONEHUNDRED: 100, NL: "\r\n", SHOW_CLIENT_ORG: 0, SHOW_CLIENT_ONLY: 1, SHOW_ORG_ONLY: 2, HIDE_CLIENT_ORG: 3, NULLString: "NULLValue", approveCol: "IsApproved", getObscureValue: y } }(); n.AEnv = function () { function s(n, i, r) { var u = null; return t.ajax({ url: e, type: "POST", datatype: "json", contentType: "application/json; charset=utf-8", async: i, data: JSON.stringify(n) }).done(function (n) { u = n; r && r(n) }), u } function h(t, i, r) { n.dataContext.getWindowJString({ windowNo: t, AD_Window_ID: i }, r) } function c(n) { return t('<button class="vis-controls-txtbtn-table-td2" ' + (n ? "disabled" : "") + ' ><i class="vis vis-find" /><\/button>') } function l(i) { var r = t("<ul class='vis-apanel-rb-ul'>"); return typeof i[n.Actions.zoom] != "undefined" && (r.append(t("<li data-action='" + n.Actions.zoom + "' style='opacity:" + (i[n.Actions.zoom] ? .7 : 1) + "'><i data-action='" + n.Actions.zoom + "' class='fa fa-search-plus'><\/i><span data-action='" + n.Actions.zoom + "'>" + n.Msg.getMsg("Zoom") + "<\/span><\/li>")), i[n.Actions.addnewrec] && r.append(t("<li data-action='" + n.Actions.addnewrec + "' style='opacity:" + (i[n.Actions.zoom] ? .7 : 1) + "'><i data-action='" + n.Actions.addnewrec + "' class='fa fa-plus'><\/i><span data-action='" + n.Actions.addnewrec + "'>" + n.Msg.getMsg("AddNew") + "<\/span><\/li>"))), i[n.Actions.preference] && r.append(t("<li data-action='" + n.Actions.preference + "'><i data-action='" + n.Actions.preference + "' class='fa fa-cog'><\/i><span data-action='" + n.Actions.preference + "'>" + n.Msg.getMsg("Preference") + "<\/span><\/li>")), i[n.Actions.refresh] && r.append(t("<li data-action='" + n.Actions.refresh + "'><i data-action='" + n.Actions.refresh + "' class='fa fa-refresh'><\/i><span data-action='" + n.Actions.refresh + "'>" + n.Msg.getMsg("Requery") + "<\/span><\/li>")), i[n.Actions.add] && r.append(t("<li data-action='" + n.Actions.add + "'><i data-action='" + n.Actions.add + "' class='vis vis-addbp'><\/i><span data-action='" + n.Actions.add + "'>" + n.Msg.getMsg("Add") + "<\/span><\/li>")), i[n.Actions.addproduct] && r.append(t("<li data-action='" + n.Actions.addproduct + "'><i data-action='" + n.Actions.addproduct + "' class='fa fa-plus'><\/i><span data-action='" + n.Actions.addproduct + "'>" + n.Msg.getMsg("AddProduct") + "<\/span><\/li>")), i[n.Actions.update] && r.append(t("<li data-action='" + n.Actions.update + "'><i data-action='" + n.Actions.update + "' class='vis vis-updatebp'><\/i><span data-action='" + n.Actions.update + "'>" + n.Msg.getMsg("Update") + "<\/span><\/li>")), i[n.Actions.remove] && r.append(t("<li data-action='" + n.Actions.remove + "'><i data-action='" + n.Actions.remove + "' class='fa fa-arrow-left'><\/i><span data-action='" + n.Actions.remove + "'>" + n.Msg.getMsg("Clear") + "<\/span><\/li>")), i[n.Actions.contact] && r.append(t("<li data-action='" + n.Actions.contact + "'><i data-action='" + n.Actions.contact + "' class='fa fa-user'><\/i><span data-action='" + n.Actions.contact + "'>" + n.Msg.getMsg("Contact") + "<\/span><\/li>")), r } function a() { if (i == null) { i = !1; var u = 645; n.MRole.getIsTableAccess(u, !0) ? i = !0 : (u = 644, n.MRole.getIsTableAccess(u, !0) && (i = !0)); i && t.ajax({ type: "Get", async: !0, url: n.Application.contextUrl + "Form/GetWorkflowWindowID", data: { AD_Table_ID: u }, success: function (n) { var t = JSON.parse(n); t && !isNaN(t) && (r = parseInt(t)); r == 0 && (r = 297) } }) } return i } function v(t, i) { var u = null; t != 0 && i != 0 && (u = new n.Query("AD_WF_Process"), u.addRestriction("AD_Table_ID", n.Query.prototype.EQUAL, t), u.addRestriction("Record_ID", n.Query.prototype.EQUAL, i), n.viewManager.startWindow(r, u)) } function u(i, r) { var f = null, e = 0, o = 0, u = null, s; (t.ajax({ type: "Get", async: !1, url: n.Application.contextUrl + "Form/GetZoomWindowID", data: { AD_Table_ID: i }, success: function (t) { u = (new n.DB.DataReader).toJson(t) } }), u.read() && (f = u.get(0).toString(), e = n.Utility.Util.getValueOfInt(u.getInt(1)), o = n.Utility.Util.getValueOfInt(u.getInt(2))), u.dispose(), f != null && e != 0) && (o == 0 || (s = f + "_ID=" + r, e = n.ZoomTarget.getZoomAD_Window_ID(f, 0, s, !0), e != 0)) && n.viewManager.startWindow(e, n.Query.prototype.getEqualQuery(f + "_ID", r)) } function y(t, i, r) { var e = null, h = 0, l = 0, s = 0, c = [], f, v, a; if (c[0] = new n.DB.SqlParam("@AD_Table_ID", t), c[1] = new n.DB.SqlParam("@AD_WF_Activity_ID", r), f = null, f = o("VIS_146", c), f.read()) e = f.get(0).toString(), h = n.Utility.Util.getValueOfInt(f.getInt(1)), l = n.Utility.Util.getValueOfInt(f.getInt(2)), s = n.Utility.Util.getValueOfInt(f.getInt(3)); else { u(t, i); return } if (f.dispose(), e != null || h != 0 || s == null || s == 0) { if (s != null && s != 0) { v = new n.Query; n.viewManager.startWindow(s, n.Query.prototype.getEqualQuery(e + "_ID", i)); return } (l == 0 || (a = e + "_ID=" + i, h = n.ZoomTarget.getZoomAD_Window_ID(e, 0, a, !0), h != 0)) && n.viewManager.startWindow(h, n.Query.prototype.getEqualQuery(e + "_ID", i)) } } var i = null, r = 0, f = n.Application.contextUrl, e = f + "JsonData/JDataSetWithCode", o = function (t, i, r) { var e = r ? !0 : !1, f = { sql: t, page: 1, pageSize: 0 }, u; return i && (f.param = i), u = null, s(f, e, function (t) { u = (new n.DB.DataReader).toJson(t); r && r(u) }), u }; return { getGridWindow: h, getContextPopup: l, getZoomButton: c, getIsWorkflowProcess: a, startWorkflowProcess: v, zoom: u, wfzoom: y } }(); r.prototype.typeList = ["", "", "number", "", "date", "", "time", "", "choice"]; r.prototype.modifierList = ["", "", "currency", "", "percent", "", "integer"]; r.prototype.dateModifierList = ["", "", "short", "", "medium", "", "long", "", "full"]; r.prototype.allFormats = { currency: "C", decimal: "D", general: "G", number: "N", percent: "P", shortdate: "d", longdate: "D", shorttime: "t", longtime: "T", fulltime: "T", fulldate: "D", mediumdate: "d", mediumtime: "t", choice: "" }; r.prototype.applyPattern = function (n) { var r, t, u, i; if (!this.cmpreFormat(n)) { this.pattern = n; return } for (r = [], t = new StringBuilder(""), u = 0; u < n.length; ++u)i = n[u], i == "{" ? t.length() == 0 ? t.append(i) : (r.push(t.toString()), t.clear(), t.append(i)) : i == "}" ? (t.append(i), r.push(t.toString()), t.clear()) : u == n.length ? (r.add(t.toString()), t.clear()) : t.append(i); this.pattern = this.parsePattren(r) }; r.prototype.parsePattren = function (n) { for (var t, i = new StringBuilder(" "), r = 0; r < n.length; r++) { if (t = n[r], t.startsWith("{") && this.cmpreFormat(t)) { t = this.getFormat(t.split(",")); i.append(t); continue } i.append(t) } return i.toString() }; r.prototype.getFormat = function (n) { var i = new StringBuilder(n[0]), t = ""; switch (this.findKeyword(n[1], this.typeList)) { case 0: break; case 1: case 2: switch (this.findKeyword(n[2].toString(), this.modifierList)) { case 0: t = this.allFormats.number; break; case 1: case 2: t = this.allFormats.currency; break; case 3: case 4: t = this.allFormats.percent; break; case 5: case 6: t = this.allFormats.decimal; break; default: t = this.allFormats.number }break; case 3: case 4: switch (this.findKeyword(n[2], this.dateModifierList)) { case 0: t = this.allFormats.shortdate; break; case 1: case 2: t = this.allFormats.shortdate; break; case 3: case 4: t = this.allFormats.mediumdate; break; case 5: case 6: t = this.allFormats.longdate; break; case 7: case 8: t = this.allFormats.fulldate; break; default: t = n[3].ToString() }break; case 5: case 6: switch (this.FindKeyword(n[2].ToString(), this.dateModifierList)) { case 0: t = this.allFormats.shorttime; break; case 1: case 2: t = this.allFormats.shorttime; break; case 3: case 4: t = this.allFormats.mediumtime; break; case 5: case 6: t = this.allFormats.mediumtime; break; case 7: case 8: t = this.allFormats.mediumtime; break; default: t = n[2].ToString() }break; case 7: case 8: try { t = n[3]; this.allFormats.choice = n[3].ToString() } catch (r) { throw new ArgumentException("Choice Pattern incorrect"); } break; default: throw new ArgumentException("unknown format type at "); }return n = null, t = "", i.append(t).append("}"), i.toString() }; r.prototype.format = function (n) { var i = this.pattern, t, r; for (this.pattern = null, t = 0; t < n.length; t++)r = new RegExp("\\{" + t + "\\}", "gm"), i = i.replace(r, n[t]); return i }; r.prototype.cmpreFormat = function (n) { return n.contains("number,") || n.contains("date,") || n.contains("time,") || n.contains("custom,") ? !0 : !1 }; r.prototype.findKeyword = function (n, t) { for (var i = 0; i < t.length; i++)if (n.equals(t[i])) return i; return -1 }; n.DB = { QUOTE: "'", getDBDateFormat: function (n, t, i) { var r = "", u; return i || n.setMinutes(-n.getTimezoneOffset()), r = n.toISOString(), u = r.split("T"), r = u[0], t && (r += " " + u[1].substring(0, u[1].length - 5)), r }, to_date: function (n, t) { time = n && n.toString().length > 0 ? n instanceof Date ? n : new Date(n) : null; time.toString() == "Invaild Date" && (time = null); var i = "", r = ""; if (1) { if (time == null) return t ? "TRUNC(SysDate)" : "SysDate"; i += "TO_DATE('"; r = time; t ? (r = this.getDBDateFormat(time, !1, !1), i += r, i += "','YYYY-MM-DD')") : (r = this.getDBDateFormat(time, !0, !0), i += r, i += "','YYYY-MM-DD HH24:MI:SS')") } else if (DatabaseType.IsPostgre) { if (time == null) return t ? "TRUNC(SysDate)" : "SysDate"; i = new StringBuilder("TO_DATE('"); t ? (r = time.Value.ToString("yyyy-MM-dd"), i.Append(r), i.Append("','YYYY-MM-DD')")) : (r = time.Value.ToString("yyyy-MM-dd HH:mm:ss"), i.Append(r), i.Append("','YYYY-MM-DD HH24:MI:SS')")) } else if (DatabaseType.IsMSSql) { if (time == null) return t ? "CAST(STR(YEAR(Getdate()))+'-'+STR(Month(Getdate()))+'-'+STR(Day(Getdate())) AS DATETIME)" : "getdate()"; i = new StringBuilder("CAST('"); r = time.ToString(); t ? (i.Append(r.Substring(0, 10)), i.Append("' AS DATETIME)")) : (i.Append(r.Substring(0, r.IndexOf("."))), i.Append("' AS DATETIME)")) } return i.toString() }, to_char: function (t, i) { var r = "TRIM(TO_CHAR("; return r = r.concat(t), n.DisplayType.IsNumeric(i) ? r = i == n.DisplayType.Amount ? r.concat(",'9G999G999G999G990D00'") : r.concat(",'TM9'") : n.DisplayType.IsDate(i) && (r = r.concat(",'").concat("yyyy-MM-dd").concat("'")), r = r.concat("))"), r.toString() }, to_string: function (n, t) { var i, r, u, f; if (n == null && n.length == 0) return "NULL"; for (t != null && (t = 0), i = n, t != 0 && i.length > t && (i = n.substring(0, t)), r = new StringBuilder, r.append(this.QUOTE), u = 0; u < i.length; u++)f = i.charAt(u), f == this.QUOTE ? r.append("''") : r.append(f); return r.append(this.QUOTE), i = r.toString(), r.clear(), i } }; o.prototype.setIsDate = function (n) { this.isDate = n }; o.prototype.setIsByteArray = function (n) { this.isByteArray = n }; f.prototype.toJson = function (i) { var r = i, u, f; for (typeof i == "string" && (r = JSON.parse(i)), r = t.isArray(r) ? r : [r], u = 0; u < r.length; u++)f = new n.DB.DataTable, f.toJson(r[u]), this.tables.push(f); return r = null, this }; f.prototype.getTable = function (n) { return n > -1 && n < this.tables.length ? this.tables[n] : null }; f.prototype.getTables = function () { return this.tables }; f.prototype.dispose = function () { for (var n = this.tables.length; n > 0; n--)this.tables.pop().dispose(); this.tables.length = 0; this.tables = null }; u.prototype.toJson = function (t) { var i, r; if (t) { if (this.totalRecord = t.records, this.totalPage = t.total, this.page = t.page, t.columns) { for (i = 0; i < t.columns.length; i++)this.columnsName[i] = t.columns[i].name; for (r = 0; r < t.rows.length; r++)this.rows.push(new n.DB.DataRow(t.rows[r], this)); this.columns = t.columns } this.count = this.rows.count } t = null }; u.prototype.getRowCount = function () { return this.rows.length }; u.prototype.getColumnCount = function () { return this.columns.length }; u.prototype.getRow = function (n) { return n > -1 && n < this.rows.length ? this.rows[n] : null }; u.prototype.getRows = function () { return this.rows }; u.prototype.getColumnsName = function () { return this.columnsName }; u.prototype.dispose = function () { for (this.count = 0, this.totalPage = 0, this.page = 1, this.columns.length = 0, this.columns = null; this.rows.length > 0;)this.rows.pop().dispose(); this.rows.length = 0; this.rows = null; this.totalRecord = 0 }; e.prototype.getCell = function (n) { var t = -1, i = ""; isNaN(n) ? (n = n.toLowerCase(), t = this.parent.columnsName.indexOf(n), i = n) : (t = n, i = this.parent.columnsName[t]); var r = this.parent.columns[t], u = r.type, f = this.cells[i]; return u == "system.datetime", f }; e.prototype.getJSCells = function () { return this.cells }; e.prototype.dispose = function () { this.cells.length = 0; this.cells = null; this.id = null; this.parent = null }; i.prototype.toJson = function (i) { for (var r = JSON.parse(i), f, r = t.isArray(r) ? r : [r], u = 0; u < r.length; u++)f = new n.DB.DataTable, f.toJson(r[u]), this.tables.push(f), u === 0 && (this.curTable = this.tables[u]); return r = null, this }; i.prototype.read = function () { return this.curTable ? ++this.rowIndex >= this.curTable.getRowCount() ? !1 : !0 : !1 }; i.prototype.getCell = function (n) { return this.curTable.getRow(this.rowIndex).getCell(n) }; i.prototype.get = function (n) { return this.curTable.getRow(this.rowIndex).getCell(n) }; i.prototype.getString = function (n) { var t = this.curTable.getRow(this.rowIndex).getCell(n); return t == null ? "" : t.toString() }; i.prototype.getInt = function (n) { var t = this.curTable.getRow(this.rowIndex).getCell(n); return t == null ? 0 : parseInt(t) }; i.prototype.getDecimal = function (n) { var t = this.curTable.getRow(this.rowIndex).getCell(n); return t == null ? 0 : parseFloat(t) }; i.prototype.getDateTime = function (n) { return this.curTable.getRow(this.rowIndex).getCell(n) }; i.prototype.setTableIndex = function (n) { this.rowIndex = 0; this.curTable = this.tables[n] }; i.prototype.close = function () { }; i.prototype.dispose = function () { this.curTable = null; for (var n = this.tables.length; n > 0; n--)this.tables.pop().dispose(); this.tables.length = 0; this.tables = null; this.rowIndex = null }; s.prototype.max = function (n, t) { return n == null ? t : t == null ? n : n > t ? n : t }; h.prototype.isDecimalSeparatorDot = function (n) { return n && this.List[n] != undefined ? this.List[n].decimalSeparator : null }; n.DB.DataSet = f; n.DB.DataTable = u; n.DB.DataRow = e; n.DB.SqlParam = o; n.DB.DataReader = i; n.MessageFormat = r; n.TimeUtil = s; n.CultureSeparator = h }(VIS, jQuery); VIS.Logging = VIS.Logging || {}, function (n) { function t(n, t) { this.name = n; this.value = t } function e(n, t) { this._level = n; this._sequenceNumber; this._sourceClassName; this._sourceMethodName; this._message = t; this._lineNumber; this._loggerName } function o() { if (o.prototype.singleInstance) return o.prototype.singleInstance; o.prototype.singleInstance = this } function u() { if (u.prototype.singletonInstance) return u.prototype.singletonInstance; u.prototype.singletonInstance = this } function s() { this.offValue = t.OFF.getIntValue(); this.logLevel = t.ALL; this.formatter; this.filter } function f() { if (f.prototype.singleInstance) return f.prototype.singleInstance; this.setFormatter(u.get()); this.setLevel(t.INFO); this.setFilter(o.get()); this.ERROR_SIZE = 20; this.m_errors = []; this.m_history = []; this.LOG_SIZE = 100; this.m_logs = []; this.m_issueError = !0; f.prototype.singleInstance = this } function i(n) { this.levelValue = t.INFO.getIntValue(); this.name = n; this.levelObject; this.handlers = []; this.kids = []; this.manager = r.getLogManager(); this.parent; this.offValue = t.OFF.getIntValue(); this.filter } function c() { i.call(this, ""); this.setLevel(t.INFO) } function r() { if (r.prototype.singleInstance) return r.prototype.singleInstance; this.emptyHandlers = []; this.loggers = {}; this.defaultLevel = t.INFO; this.rootLogger; r.prototype.singleInstance = this } function h(n) { i.call(this, n) } function l() { var e = null, n = t.INFO, h = [t.OFF, t.SEVERE, t.WARNING, t.INFO, t.CONFIG, t.FINE, t.FINER, t.FINEST, t.ALL], c = function (n) { if (n != null) { var t = i.getLogger(""); t.addHandler(n); e.push(n) } }, d = function () { return t.ALL.getIntValue() == n.getIntValue() }, l = function () { var r, t, n; if (e == null) { e = []; try { for (r = i.getLogger(""), t = r.getHandlers(), n = 0; n < t.length; n++)e.contains(t[n]) || e.Add(t[n]) } catch (s) { } f.get(!1) == null && c(f.get(!0)); v(u.get()); y(o.get()) } }, s = function (t) { var i, r; if (t != null) { for (e == null && l(!0), i = 0; i < e.length; i++)r = e[i], r.setLevel(t); t.getIntValue() != n.getIntValue() && a(t, null); n = t } }, a = function (n, t) { var f, e, o, u, s; if (n != null) { f = r.getLogManager(); e = f.getLoggerNames(); for (o in e) u = o, (t == null || u.indexOf(t) != -1) && (s = i.getLogger(u), s.setLevel(n)) } }, v = function (n) { for (var i, t = 0; t < e.length; t++)i = e[t], i.setFormatter(n) }, y = function (n) { for (var i, t = 0; t < e.length; t++)i = e[t], i.setFilter(n) }, p = function () { return n }, w = function (n) { if (n) for (var t = 0; t < h.length; t++)if (h[t].getName().equals(n)) { s(h[t]); return } }, g = function () { return n.getIntValue() }, b = function () { var n = r.getLogManager(); n.reset() }, k = function (i) { if (i) s(n); else { var r = n; s(t.OFF); n = r } }; return { initialize: l, addHandler: c, setLevel: s, setLevelByString: w, getLevel: p, shutdown: b, enable: k, getIsLevelAll: function () { return t.ALL.getIntValue() == n.getIntValue() }, getIsLevelFinest: function () { return t.FINEST.getIntValue() >= n.getIntValue() }, getIsLevelFiner: function () { return t.FINER.getIntValue() >= n.getIntValue() }, getIsLevelFine: function () { return t.FINE.getIntValue() >= n.getIntValue() }, getIsLevelInfo: function () { return t.INFO.IntValue() >= n.IntValue() } } } t.prototype.getIntValue = function () { return this.value }; t.prototype.getName = function () { return this.name }; t.prototype.getLevel = function (n) { return t.OFF.getIntValue() == n ? t.OFF : t.SEVERE.getIntValue() == n ? t.SEVERE : t.WARNING.getIntValue() == n ? t.WARNING : t.INFO.getIntValue() == n ? t.INFO : t.CONFIG.getIntValue() == n ? t.CONFIG : t.FINE.getIntValue() == n ? t.FINE : t.FINER.getIntValue() == n ? t.FINER : t.FINEST.getIntValue() == n ? t.FINEST : t.ALL.getIntValue() == n ? t.ALL : void 0 }; t.OFF = new t("OFF", 9999); t.SEVERE = new t("SEVERE", 1e3); t.WARNING = new t("WARNING", 900); t.INFO = new t("INFO", 800); t.CONFIG = new t("CONFIG", 700); t.FINE = new t("FINE", 600); t.FINER = new t("FINER", 500); t.FINEST = new t("FINEST", 400); t.ALL = new t("ALL", 0); e.prototype.getMessage = function () { return this._message }; e.prototype.setMessage = function (n) { this._message = n }; e.prototype.getSourceClassName = function () { return this._sourceClassName }; e.prototype.setSourceClassName = function (n) { this._sourceClassName = n }; e.prototype.getSourceMethodName = function () { return this._sourceMethodName }; e.prototype.setSourceMethodName = function (n) { this._sourceMethodName = n }; e.prototype.getLineNumber = function () { return this._lineNumber }; e.prototype.setLineNumber = function (n) { this._lineNumber = n }; e.prototype.getLoggerName = function () { return this._loggerName }; e.prototype.setLoggerName = function (n) { this._loggerName = n }; e.prototype.getLevel = function () { return this._level }; o.prototype.singleInstance = null; o.get = function () { return o.prototype.singleInstance ? o.prototype.singleInstance : new o }; o.prototype.getIsLoggable = function (n) { var i, r; return n.getLevel() === t.SEVERE || n.getLevel() === t.WARNING ? !0 : (i = n.getLoggerName(), i && i.startsWith("System.")) ? !1 : (r = n.sourceClassName, r && r.startsWith("System.")) ? !1 : !0 }; u.prototype.singletonInstance = null; u.prototype.NL = "/n"; u.get = function () { return u.prototype.singletonInstance ? u.prototype.singletonInstance : new u }; u.prototype.format = function (n) { var i = new StringBuilder, r = Date.now.toString("yyyy-MM-dd hh:mm:ss.ms"), u; return r = r + "00", n.getLevel() == t.prototype.SEVERE ? (i.append("===========> "), i.append("    (SEVERE)   ")) : n.getLevel() == t.WARNING ? (i.append("-----------> "), i.append("    (WARNING)  ")) : (i.append(r.Substring(11, 12)), u = 11, n.getLevel() == t.INFO ? i.append("    (INFO)     ") : n.getLevel() == t.CONFIG ? i.append("    (CONFIG)   ") : n.getLevel() == t.FINE ? i.append("    (FINE)     ") : n.getLevel() == t.FINER ? i.append("    (FINER)    ") : n.getLevel() == t.FINEST && i.append("    (FINEST)   ")), i.append(n.message), i.toString() }; u.prototype.getHead = function () { var n = (new StringBuilder).append("*** ").append(DateTime.Now.ToString()).append(" VAdvantage Log ").append(" ***").append("\n").append("ViennaAdvantage"); return n.toString() }; u.prototype.getTail = function () { var n = (new StringBuilder).append("*** ").append(" VAdvantage Log").append(" ***"); return n.toString() }; u.prototype.getClassMethod = function (n) { var i = "", t = n.getLoggerName(), r, u; return ((t == null || t.indexOf("default") != -1 || t.indexOf("global") != -1) && (t = n.getSourceClassName()), t != null ? (r = t.lastIndexOf("."), i += r != -1 ? t.substring(r + 1) : t) : i += n.getLoggerName(), n.getSourceMethodName() != null && (i += "." + n.getSourceMethodName()), u = i, u.equals("Trace.printStack")) ? "" : u }; u.prototype.getParameters = function (n) { var r = "", i = n.getParameters(), t; if (i != null && i.length > 0) for (t = 0; t < i.length; t++)t > 0 && (r += ", "), r += i[t]; return r }; u.prototype.getExceptionTrace = function () { try { } catch (n) { } return "" }; s.prototype.publish = function () { }; s.prototype.close = function () { }; s.prototype.flush = function () { }; s.prototype.setLevel = function (n) { if (n == null) throw new NullReferenceException("No Level"); this.logLevel = n }; s.prototype.getLevel = function () { return this.logLevel }; s.prototype.getFilter = function () { return this.filter }; s.prototype.setFilter = function (n) { this.filter = n }; s.prototype.getIsLoggable = function (n) { var i = this.getLevel().getIntValue(), t; return n.getLevel().getIntValue() < i || i == this.offValue ? !1 : (t = this.getFilter(), t == null) ? !0 : t.getIsLoggable(n) }; s.prototype.getFormatter = function () { return this.formatter }; s.prototype.setFormatter = function (n) { this.formatter = n }; n.Utility.inheritPrototype(f, s); f.prototype.singleInstance = null; f.get = function (n) { return f.prototype.singleInstance ? f.prototype.singleInstance : n ? new f : null }; f.prototype.setLevel = function (n) { n != null && (n == t.OFF ? this.$super.setLevel.call(this, t.SEVERE) : n == t.ALL || n == t.FINEST || n == t.FINER ? this.$super.setLevel.call(this, t.FINE) : this.$super.setLevel.call(this, n)) }; f.prototype.publish = function (n) { var i, r, u, f, e; if (this.getIsLoggable(n) && this.m_logs != null) { if (this.m_logs.length >= this.LOG_SIZE && this.m_logs.shift(), this.m_logs.push(n), n.getLevel() == t.SEVERE) { for (this.m_errors.length >= this.ERROR_SIZE && (this.m_errors.shift(), this.m_history.shift()), this.m_errors.push(n), i = [], r = 0; r < this.m_logs.length; r++)if (u = this.m_logs[r], u.getLevel() == t.SEVERE) if (i.length == 0) i.push(u); else break; else if (i.push(u), i.length > 10) break; this.m_history.push(i); this.m_issueError && (f = n.getLoggerName(), e = n.getSourceMethodName()) } console.log(n) } }; f.prototype.close = function () { this.m_logs != null && (this.m_logs.length = 0, this.m_logs = null); this.m_errors != null && (this.m_errors.length = 0, this.m_errors = null); this.m_history != null && (this.m_history.length = 0, this.m_history = null) }; f.prototype.getColumnNames = function () { var n = [4]; return n[0] = "Time", n[1] = "Level", n[2] = "Class.Method", n[3] = "Message", n }; f.prototype.getRecords = function (n) { return n ? this.m_errors.slice() : this.m_logs.slice() }; f.prototype.getLogData = function (n) { for (var i, t, f = this.getRecords(n), e = [], r = 0, o = f.length; r < o; r++)i = f[r], t = [], t.push((new Date).toString()), t.push(i.getLevel().getName()), t.push(u.get().getClassMethod(i)), t.push(i.getMessage()), e.push(t); return e }; f.prototype.resetBuffer = function (n) { this.m_errors.length = 0; this.m_history.length = 0; n || (this.m_logs.length = 0) }; i.prototype.setFilter = function (n) { this.filter = n }; i.prototype.getFilter = function () { return this.filter }; i.prototype.log = function (n, i, r) { var i = i, f, u, o, s; if ((r && (r.message && (i += " => " + r.message), r.stack && (i += " ===> " + r.stack)), !(n.getIntValue() < this.levelValue) && this.levelValue != t.OFF.getIntValue()) && (f = new e(n, i), f.setLoggerName(this.name), this.filter == null || this.filter.getIsLoggable(f))) for (u = this; u != null;) { if (o = u.getHandlers(), o != null) for (s = 0; s < o.length; s++)o[s].publish(f); u = u.getParent() } }; i.prototype.getParent = function () { return this.parent }; i.prototype.getHandlers = function () { return this.handlers == null ? emptyHandlers : this.handlers }; i.prototype.getName = function () { return this.name }; i.prototype.setLevel = function (n) { this.levelObject = n; this.levelValue = n.getIntValue() }; i.prototype.getLevel = function () { return this.levelObject }; i.prototype.addHandler = function (n) { this.handlers == null && (handlers = []); this.handlers.push(n) }; i.prototype.removeHandler = function (n) { n != null && this.handlers != null && this.handlers.remove(n) }; i.getLogger = function (n) { var u = r.getLogManager(), t = u.getLogger(n); return t == null && (t = new i(n), u.addLogger(t), t = u.getLogger(n)), t }; i.prototype.setParent = function (n) { this.parent = n }; i.prototype.getIsLoggable = function (n) { return n.getIntValue() < levelValue || levelValue == offValue ? !1 : !0 }; i.prototype.fine = function (n) { t.FINE.getIntValue() < this.levelValue || this.log(t.FINE, n) }; i.prototype.info = function (n) { t.INFO.getIntValue() < this.levelValue || this.log(t.INFO, n) }; i.prototype.config = function (n) { t.CONFIG.getIntValue() < this.levelValue || this.log(t.CONFIG, n) }; i.prototype.finer = function (n) { t.FINER.getIntValue() < this.levelValue || this.log(t.FINER, n) }; i.prototype.finest = function (n) { t.FINEST.getIntValue() < this.levelValue || this.log(t.FINEST, n) }; i.prototype.severe = function (n) { t.SEVERE.getIntValue() < this.levelValue || this.log(t.SEVERE, n) }; i.prototype.warning = function (n) { t.WARNING.getIntValue() < this.levelValue || this.log(t.WARNING, n) }; i.prototype.saveError = function (n, t) { return this.saveError(n, t.message, !0) }; i.prototype.saveError = function (n, t, i) { return i && this.warning(n + " " + t.message), !0 }; i.prototype.getIsLevelFinest = function () { return l.getIsLevelFinest() }; n.Utility.inheritPrototype(c, i); r.prototype.singleInstance = null; r.prototype.addLogger = function (n) { var t = n.getName(), i = null; return (t in this.loggers && (i = loggers[t]), i != null) ? !1 : (this.loggers[t] = n, n instanceof c || n.setParent(this.rootLogger), !0) }; r.prototype.reset = function () { for (var n in this.loggers) ResetLogger(n) }; r.prototype.resetLogger = function (n) { var t = this.getLogger(n), r, i, u; if (t != null) { for (r = t.getHandlers(), i = 0; i < r.length; i++) { u = r[i]; t.removeHandler(u); try { u.close() } catch (f) { } } n != null && n.equals("") ? t.setLevel(this.defaultLevel) : t.setLevel(null) } }; r.prototype.getLogger = function (n) { return n in this.loggers ? this.loggers[n] : null }; r.getLogManager = function () { if (!r.prototype.singleInstance) { new r; var n = r.prototype.singleInstance; n.rootLogger = new c; n.addLogger(n.rootLogger) } return r.prototype.singleInstance }; r.prototype.getLoggerNames = function () { return this.loggers }; n.Utility.inheritPrototype(h, i); h.getVLogger = function (t) { var f = r.getLogManager(), i, u; return (t || (t = ""), i = f.getLogger(t), i != null && i instanceof h) ? i : (u = new h(t), u.setLevel(n.Logging.VLogMgt.getLevel()), f.addLogger(u), u) }; n.Logging.Level = t; n.Logging.LogRecord = e; n.Logging.VLogFilter = o; n.Logging.VLogFormatter = u; n.Logging.VLogErrorBuffer = f; n.Logging.Logger = i; n.Logging.VLogger = h; n.Logging.LogManager = r; n.Logging.VLogMgt = l() }(VIS, jQuery); VIS.Controls = {}, function (n, t) { function ct(t, i, r) { var u = null; return n.ajax({ url: lt, type: "POST", datatype: "json", contentType: "application/json; charset=utf-8", async: i, data: JSON.stringify(t) }).done(function (n) { u = n; r && r(n) }), u } function i(n, r, u, f, e) { if (this instanceof i) this.ctrl = n, this.displayType = r, this.isReadOnly = u, this.colName = f, this.isMandatory = e, this.oldValue = "oldValue", this.visible, this.tag, this.setVisible(!0), this.editingGrid = null; else return new t.controls.IControl(n, r, u, f, e) } function a(r, u, f, e, o, s, h, c, l) { var p = t.DisplayType.String, a; this.obscureType = c; var v = n("<input>", { type: l ? "password" : "text", name: r, maxlength: s }), y = n('<button class="input-group-text" style="display:none"><i class="fa fa-credit-card" /><\/button>'); i.call(this, v, p, f, r, u); f || !e || c ? this.setReadOnly(!0) : this.setReadOnly(!1); this.getBtn = function (n) { if (n == 0 && c) return this.setReadOnly(!0), y }; this.showObscureButton = function (n) { n && c ? y.css("display", "") : (y.css("display", "none"), y.off("click")) }; this.getBtnCount = function () { return c ? 1 : 0 }; a = this; v.on("change", function (n) { var t, i; n.stopPropagation(); t = v.val(); this.value = t; t !== a.oldValue && (i = { newValue: t, propertyName: a.getName() }, a.fireValueChanged(i), i = null); c && a.setReadOnly(!0) }); v.on("blur", function () { var n = v.val(); a.obscureType && n != "" && a.oldValue == n && (a.ctrl.val(t.Env.getObscureValue(a.obscureType, n)), a.setReadOnly(!0)) }); y.on("click", function () { a.mField.getIsEditable(!0) && (a.setReadOnly(!1, !0, !0), v.val(a.mField.getValue()), v.focus()) }); this.disposeComponent = function () { v.off("change"); v = null; a = null } } function ht(r, u, f, e) { var s, o; r = r != null ? r.replace("[&]", "") : ""; s = ' for="' + u + '"'; e && (s = ""); o = n("<label " + s + "><\/label>"); i.call(this, o, t.DisplayType.Label, !0, e ? u : "lbl" + u); f ? o.text(r).append("<sup>*<\/sup>") : o.text(r); this.disposeComponent = function () { o = null; self = null } } function ut(r, u, f, e) { var s, o; r = r != null ? r.replace("[&]", "") : ""; s = ' for="' + u + '"'; e && (s = ""); o = n("<span " + s + "><\/span>"); i.call(this, o, t.DisplayType.Label, !0, e ? u : "lbl" + u); f ? o.text(r).append("<sup>*<\/sup>") : o.text(r); this.disposeComponent = function () { o = null; self = null; this.format && this.format.dispose(); this.format = null } } function r(r, u, f, e, o, s, h, c, l, a, v, y, p) { function nt() { var i = n("<ul class='vis-apanel-rb-ul'>"); return i.append(n("<li data-action='C'>").text(t.Msg.getMsg("OpenCSV"))), i.append(n("<li data-action='P'>").text(t.Msg.getMsg("OpenPDF"))), i } var w, g; this.actionListner; this.AD_Process_ID = c; this.AD_Form_ID = v; this.description = s; this.help = h; this.text = o; this.isLink = l; this.isRightLink = a; this.actionLink = null; this.isCsv = !1; this.isPdf = !1; this.askUserBGProcess = p; this.isBackgroundProcess = y; this.values = null; this.isIconSet = !0; var k = n("<i style='color:inherit' title='" + o + "'>"), d = n("<span style='color:inherit'>").text(o), tt = t.Application.contextUrl + "Areas/VIS/Images/base/", b = null; l ? a ? (b = n("<li>"), b.append(d).append(k)) : (b = n('<button type="button" class="vis-ev-col-wrap-button vis-ev-col-linkbutton"><\/button>'), b.append(k).append(d)) : (b = n('<button class="vis-ev-col-wrap-button">', { type: "button", name: r }), k.css("margin-right", "8px"), b.append(k).append(d)); this.setIcon = function (n, t) { t ? k.src = n : k.addClass(n) }; r.equals("PaymentRule") ? (this.readReference(195), this.setIcon("vis vis-payment")) : r.equals("DocAction") ? (this.readReference(135), this.setIcon("vis vis-cog")) : r.equals("CreateFrom") ? this.setIcon("vis vis-copy") : r.equals("Record_ID") ? (this.setIcon("vis vis-find"), b.text(t.Msg.getMsg("ZoomDocument"))) : r.equals("Posted") ? (this.readReference(234), this.setIcon("fa fa-line-chart")) : l && (this.isIconSet = !1, this.setIcon("vis vis-action")); i.call(this, b, t.DisplayType.Button, f, r, u); f || !e ? this.setReadOnly(!0) : this.setReadOnly(!1); w = this; g = null; g = nt(); b.on(t.Events.onClick, function (n) { var u, r, i, f; n.stopPropagation(); u = null; w.isReadOnly || (r = "VIS_81", i = [], i[0] = new t.DB.SqlParam("@AD_Process_ID", c), u = st(r, i), r = "VIS_149", i = [], i[0] = new t.DB.SqlParam("@AD_Process_ID", c), f = st(r, i), f == "Y" && t.context.getIsUseCrystalReportViewer() ? w.invokeActionPerformed({ source: w }) : u == "Y" ? k.w2overlay(g.clone(!0)) : w.invokeActionPerformed({ source: w })) }); if (g) g.on("click", "LI", function (t) { var i = n(t.target); i.data("action") == "P" ? (w.isPdf = !0, w.isCsv = !1) : i.data("action") == "C" && (w.isCsv = !0, w.isPdf = !1); w.invokeActionPerformed({ source: w }) }); this.setText = function (n) { var t, i; if (n == null) { d.text(""); return } t = n.indexOf("&"); t != -1 && (i = n.toUpperCase().charAt(t + 1), i != " " && (n = n.substring(0, t) + n.substring(t + 1))); d.text(n) }; this.setLayout = function (n) { this.mField && (n ? this.mField.getHeaderHeadingOnly() ? k.remove() : this.mField.getHeaderIconOnly() && d.remove() : this.mField.getIsFieldOnly() && this.mField.getShowIcon() ? d.remove() : this.mField.getIsFieldOnly() && k.remove()) }; this.disposeComponent = function () { b.off(t.Events.onClick); b = null; w = null; this.AD_Process_ID = null; this.description = null; this.help = null; this.setText = null } } function b(r, u, f, e, o, s, h) { var c = n("<input>", { type: "checkbox", name: r, value: o }), a = n('<label class="vis-ec-col-lblchkbox" />').html(o), l; h && (c.addClass("vis-ctrl-switch"), a.prepend('<i for="switch" class="vis-ctrl-switchSlider">Toggle<\/i>')); a.prepend(c); i.call(this, a, t.DisplayType.YesNo, f, r, u); this.cBox = c; l = this; this.setReadOnly = function (n) { this.isReadOnly = n; c.prop("disabled", n); a.css("opacity", n ? .7 : 1) }; f || !e ? this.setReadOnly(!0) : this.setReadOnly(!1); c.on("change", function (n) { var t, i; n.stopPropagation(); t = c.prop("checked"); t !== l.oldValue && (l.oldValue = t, i = { newValue: t, propertyName: l.getName() }, l.fireValueChanged(i), i = null) }); this.disposeComponent = function () { c.off("change"); c = null; l = null; this.cBox = null } } function o(r, u, f, e, o, s, h, c) { function d(n) { var i, r, f, e, o, u, s; if (l.lookup && !b) { if (i = l.lookup.getZoomQuery(), n || (n = l.getValue()), n == "" && (n = null), n == null || isNaN(n) || (n = parseInt(n)), i == null || n != null) { if (i = new t.Query, r = null, l.lookup != null && l.lookup instanceof t.MLookup && (f = l.lookup.getAD_Reference_Value_ID(), f != 0)) { e = "VIS_83"; o = []; o[0] = new t.DB.SqlParam("@AD_Reference_ID", f); try { u = w(e, o); u.read() && (r = u.getString(0)); u.dispose() } catch (h) { this.log.log(t.Logging.Level.SEVERE, e, h) } } r != null && r.length != 0 ? i.addRestriction(r, t.Query.prototype.EQUAL, n) : i.addRestriction(l.getColumnName(), t.Query.prototype.EQUAL, n); i.setRecordCount(1) } s = 0; s = l.mField != null && l.mField.getZoomWindow_ID() > 0 ? l.mField.getZoomWindow_ID() : l.lookup.getZoomWindow(i); (n == null || n == -1) && (i = null); t.viewManager.startWindow(s, i) } } var a, l; h || (h = t.DisplayType.Table); a = n("<select>", { name: r }); i.call(this, a, h, f, r, u); this.lookup = o; this.lastDisplay = ""; this.settingFocus = !1; this.inserting = !1; this.settingValue = !1; this.loading = !1; o != null && o.getIsValidated() && (this.loading = !0); a[0].selectedIndex = -1; f || !e ? this.setReadOnly(!0) : this.setReadOnly(!1); var g = !1, v = null, k = 0, y = null, p = {}, b = !1; o != null && ((o.getDisplayType() == t.DisplayType.List && t.context.getAD_Role_ID() == 0 || o.getDisplayType() != t.DisplayType.List) && (g = !0, o instanceof t.MLookup && o.getZoomWindow() == 0 && c < 1 && (b = !0), p[t.Actions.zoom] = b), p[t.Actions.addnewrec] = !0, (this.lookup && (this.lookup.info.keyColumn.toLowerCase() == "ad_user.ad_user_id" || this.lookup.info.keyColumn.toLowerCase() == "ad_user_id") || r === "AD_User_ID" || r === "SalesRep_ID") && (p[t.Actions.contact] = !0), v = n('<button  class="input-group-text"><i tabindex="-1" class="fa fa-ellipsis-v" /><\/button>'), p[t.Actions.refresh] = !0, t.MRole.getIsShowPreference() && (p[t.Actions.preference] = !0), y = t.AEnv.getContextPopup(p), k += 1, p = null); this.getBtnCount = function () { return k }; this.getBtn = function () { return v }; this.setVisible = function (n) { this.visible = n; n ? (v && v.show(), a.show()) : (a.hide(), v && v.hide()) }; l = this; a.on("focus", function () { var n; if (l.lookup != null) { if (n = a.val(), l.lookup.getIsValidated() && !l.lookup.getHasInactive()) { if (l.loading) { if (l.lookup.fillCombobox(u, !1, !1, !1), l.lookup.loading) return; l.refreshOptions(l.lookup.data, n); n != null && a[0].selectedIndex < 0 && (l.oldValue = "old", a.trigger("change")); l.loading = !1 } return } l.getIsReadonly() || (l.settingFocus = !0, n = a.val(), l.lookup.fillCombobox(l.getIsMandatory(), !0, !0, !0), l.refreshOptions(l.lookup.data, n), n && a[0].selectedIndex < 0 && (l.oldValue = "old", a.trigger("change")), l.settingFocus = !1) } }); a.on("change", function (n) { var t = a.val(), i; t !== l.oldValue && ((t == -1 || t == "") && (t = null), i = { newValue: t, propertyName: l.getName() }, l.fireValueChanged(i), i = null); n.stopPropagation() }); if (v) v.on(t.Events.onClick, function (n) { v.w2overlay(y.clone(!0)); n.stopPropagation() }); if (y) y.on("click", "LI", function (i) { var r = n(i.target).data("action"), u, e, f, s; if (r == t.Actions.preference) u = new t.ValuePreference(l.mField, l.getValue(), l.getDisplay()), u != null && u.showDialog(), u = null; else if (r == t.Actions.refresh) { if (o == null) return; l.settingFocus = !0; e = a.val(); l.lookup.refresh(); l.lookup.getIsValidated() ? l.lookup.fillCombobox(l.getIsMandatory(), !1, !1, !1) : l.lookup.fillCombobox(l.getIsMandatory(), !0, !1, !1); l.refreshOptions(l.lookup.data, e); l.settingFocus = !1 } else r == t.Actions.contact ? (f = l.getValue(), f && f.toString().length > 0 && (s = new t.ContactInfo(f, l.mField.getWindowNo()), s.show())) : r == t.Actions.zoom ? b || d() : r == t.Actions.addnewrec && (b || d(-10)) }); this.disposeComponent = function () { a.off("focus"); a.off("change"); v && (v.off(t.Events.onClick), v.remove()); v = null; y && y.remove(); y = null; this.lookup = null; this.lastDisplay = null; this.settingFocus = null; this.inserting = null; this.settingValue = null; a = null; l = null } } function k(r, u, f, e, o) { var l = "date", c = "9999-12-31", s, h; o == t.DisplayType.Time && (l = "time", c = ""); o == t.DisplayType.DateTime && (l = "datetime-local", c += "T24:00:00"); s = n("<input>", { type: l, name: r }); c != "" && s.attr("max", c); i.call(this, s, o, f, r, u); f || !e ? this.setReadOnly(!0) : this.setReadOnly(!1); h = this; s.on("focusout", function () { var n, t; this.editingGrid || (n = h.getValue(), h.oldValue = n, t = { newValue: n, propertyName: h.getName() }, h.fireValueChanged(t), t = null) }); this.disposeComponent = function () { s.off("change"); h = null; s = null } } function s(r, u, f, e, o, s, h) { function nt(i) { var r, u, e, o, s, f, l; if (c.lookup && !d) { if (r = c.lookup.getZoomQuery(), i || (i = c.getValue()), i == "" && (i = null), r == null || n.isEmptyObject(r) || i != null) { if (r = new t.Query, u = null, c.lookup != null && c.lookup instanceof t.MLookup && (e = c.lookup.getAD_Reference_Value_ID(), e != 0)) { o = "VIS_90"; s = []; s[0] = new t.DB.SqlParam("@AD_Reference_ID", e); try { f = w(o, s); f.read() && (u = f.getString(0)); f.dispose() } catch (a) { this.log.log(t.Logging.Level.SEVERE, o, a) } } u != null && u.length != 0 ? r.addRestriction(u, t.Query.prototype.EQUAL, i) : r.addRestriction(c.getColumnName(), t.Query.prototype.EQUAL, i); r.setRecordCount(1) } l = 0; l = c.mField != null && c.mField.getZoomWindow_ID() > 0 ? c.mField.getZoomWindow_ID() : h && h > 0 ? h : c.lookup.getZoomWindow(r); t.viewManager.startWindow(l, r) } } var it, rt, ut, k, l, y, ft, c; o || (o = t.DisplayType.Search); this.lookup = s; this.isMultiKeyTextBox = o === t.DisplayType.MultiKey; this.value = null; this.custInfoWin = null; it = null; rt = null; this.infoMultipleIds = null; ut = null; this.log = t.Logging.VLogger.getVLogger("VTextBoxButton"); var g = ""; o == t.DisplayType.Location || o == t.DisplayType.MultiKey ? g += this.isMultiKeyTextBox ? "fa fa-caret-down" : "vis vis-card" : o == t.DisplayType.Locator ? g += "vis vis-locator" : o == t.DisplayType.Search && (g += r.equals("C_BPartner_ID") || r.equals("C_BPartner_To_ID") && s.getColumnName().equals("C_BPartner.C_BPartner_ID") ? "fa fa-handshake-o" : r.equals("M_Product_ID") || r.equals("M_Product_To_ID") && s.getColumnName().equals("M_Product.M_Product_ID") ? "vis vis-product" : "fa fa-caret-down"); k = 0; l = n("<input>", { type: "text", name: r }); l.attr("autocomplete", "off"); y = n('<button   class="input-group-text"><i  tabindex="-1" class="' + g + '"><\/i><\/button>'); k += 1; var a = null, p = null, v = {}, d = !1, b = null, tt = null; if (s == null || this.isMultiKeyTextBox || (s instanceof t.MLookup && s.getZoomWindow() == 0 && h < 1 && (d = !0), v[t.Actions.zoom] = d, v[t.Actions.addnewrec] = !0, a = n('<button   class="input-group-text"><i tabindex="-1" Class="fa fa-ellipsis-v" /><\/button>'), ft = !1, r === "C_BPartner_ID" && (v[t.Actions.addnewrec] = !1, v[t.Actions.add] = !0, v[t.Actions.update] = !0), r === "M_Product_ID" && (v[t.Actions.addnewrec] = !1, v[t.Actions.add] = !1, v[t.Actions.update] = !0, v[t.Actions.addproduct] = !0), (this.lookup && (this.lookup.info.keyColumn.toLowerCase() == "ad_user.ad_user_id" || this.lookup.info.keyColumn.toLowerCase() == "ad_user_id") || r === "AD_User_ID" || r === "SalesRep_ID") && (v[t.Actions.contact] = !0), t.MRole.getIsShowPreference() && (v[t.Actions.preference] = !0), v[t.Actions.refresh] = !0, v[t.Actions.remove] = !0, p = t.AEnv.getContextPopup(v), k += 1, v = null), this.isMultiKeyTextBox && (a = n('<button   class="input-group-text"><i class="fa fa-arrow-left" aria-hidden="true"><\/i><\/button>'), k += 1), c = this, i.call(this, l, o, f, r, u), this.setReadOnly = function (n) { this.isReadOnly = n; l.prop("disabled", n ? !0 : !1); n ? y.css("opacity", .7) : y.css("opacity", 1); this.isMultiKeyTextBox && (n ? a.css("opacity", .7) : a.css("opacity", 1)) }, o == t.DisplayType.Search) { b = n("<div class='vis-autocompleteList-item vis-auto-addItem' style='background-color: rgba(var(--v-c-secondary), 1)'>" + t.Msg.getMsg("AddNew") + "<\/div>"); tt = n("<div><center>" + t.Msg.getMsg("NoDataFoundSugg") + "<\/center><\/div>").append(n("<center><\/center>").append(b)); l.vaautocomplete({ source: function (i, u) { var f = "", e; f = t.Env.parseContext2(t.context, c.lookup.windowNo, c.lookup.tabNo, c.lookup.info.validationCode, !1, !0); e = { ctx: t.context.getWindowCtx(c.lookup.windowNo), windowNo: c.lookup.windowNo, column_ID: c.lookup.info.column_ID, AD_Reference_ID: o, columnName: r, AD_Reference_Value_ID: c.lookup.info.AD_Reference_Value_ID, isParent: c.lookup.info.isParent, validationCode: t.secureEngine.encrypt(c.lookup.info.validationCode) }; n.ajax({ type: "Post", url: t.Application.contextUrl + "Form/GetAccessSqlAutoComplete", data: { columnName: r, text: i, WindowNo: c.lookup.getWindowNo(), AD_Window_ID: c.lookup.AD_Window_ID, AD_Tab_ID: c.lookup.AD_Tab_ID, AD_Field_ID: c.lookup.AD_Field_ID, Validation: JSON.stringify(f), LookupData: JSON.stringify(e) }, success: function (n) { var r = [], i, f; if (JSON.parse(n) != null) { for (result = JSON.parse(n).Table, i = 0; i < result.length; i++)f = {}, f[Object.keys(result[i])[0].toLowerCase()] = result[i][Object.keys(result[i])[0]], f[Object.keys(result[i])[1].toLowerCase()] = result[i][Object.keys(result[i])[1]], f[Object.keys(result[i])[2].toLowerCase()] = result[i][Object.keys(result[i])[2]], r.push({ id: f.id, value: t.Utility.Util.getIdentifierDisplayVal(f.finalvalue) }); u(r) } r.length == 0 && (r = [], r.push({ id: "vis-AddNew", value: t.Msg.getMsg("AddNew"), msg: t.Msg.getMsg("NoDataFound") }), u(r)) } }) }, minLength: 2, html: tt, onSelect: function (n, t) { t.id == "vis-AddNew" ? (nt(), setTimeout(function () { c.setValue(-1, !0, !0) }, 500)) : (c.setValue(t.id, !0, !0), c.editingGrid && setTimeout(function () { c.editingGrid.editField(c.gridPos.recid, c.gridPos.col, t.id) }, 500)) } }); b.on("click", function () { nt() }) } l.on("keydown", function (n) { n.keyCode != 13 && (n.keyCode != 9 || l.val().trim() == "") || n.shiftKey || l.val().length != 0 ? (n.keyCode == 46 || n.keyCode == 8) && c.getValue() != null && c.setValue(null, !0, !0) : c.actionText() && (n.stopPropagation(), n.preventDefault()) }); this.actionText = function () { var i = l.val().trim(), n; return (t.context.setContext(c.lookup.windowNo, "AttrCode", i), i != null && i.indexOf("(01)") >= 0 && (n = i, n.indexOf("(10)") >= 0 && (n = n.substring(0, n.indexOf("(10)"))), n.indexOf("(17)") >= 0 && (n = n.substring(0, n.indexOf("(17)"))), n = n.replace("(01)", ""), i = n), i == null || i.length == 0 || i.equals("%")) ? (c.openSearchForm(), !0) : !1 }; this.getDirectAccessSQL = function (n) { var i = c.getDirectAccessSQL1(t.context, r, s, n); return it = i[1], rt = i[2], i[0] }; this.getDirectAccessSQL1 = function () { return [] }; this.getWhereClause = function (n, i, r) { var u = "", f, e; try { if (r == null) return ""; if (r.getZoomQuery() != null && (u = r.getZoomQuery().getWhereClause()), f = r.getValidation(), f == null && (f = ""), u.length == 0 ? u = f : f.length > 0 && (u += " AND " + f), u.indexOf("@") != -1 && (e = t.Env.parseContext(n, r.getWindowNo(), r.getTabNo(), u, !1, !0), e.length != 0)) return e } catch (o) { } return u }; f || !e ? this.setReadOnly(!0) : this.setReadOnly(!1); this.getBtnCount = function () { return k }; this.getBtn = function (n) { return n == 0 ? y : n == 1 && a ? a : void 0 }; this.setVisible = function (n) { this.visible = n; n ? (l.css("visibility", "visible"), a && a.show(), y.show()) : (l.css("visibility", "hidden"), a && a.hide(), y.hide()) }; this.openSearchForm = function () { var o, s, f, v, u, nt, b, e; if (!c.isReadOnly && (o = l.val().trim(), typeof o == "object" && (o = ""), s = "", c.isMultiKeyTextBox && (s = c.getValue()), !c.isReadOnly) && c.lookup != null) { if (f = 0, v = c.getWhereClause(t.Env.getCtx(), r, c.lookup), c.custInfoWin != null ? n.ajax({ url: t.Application.contextUrl + "InfoWindow/GetInfoWindowID", dataType: "json", async: !1, data: { InfoSearchKey: c.custInfoWin }, success: function (n) { f = n.result } }) : c.getField() != null & f == 0 && (f = c.getField().getAD_InfoWindow_ID()), u = null, f != 0) u = new t.InfoWindow(f, o, c.lookup.windowNo, v, c.isMultiKeyTextBox, s); else { var h = h, y = r, a = null, i = null, k = 0, d = 0, p = 0, g = c.lookup.getAD_Reference_Value_ID(); if (g > 0) { a = "VIS_87"; nt = null; try { for (e = [], e[0] = new t.DB.SqlParam("@AD_Reference_ID", g), i = w(a, e); i.read();)y = i.getString(0), nt = i.getString(1), h = i.getString(2); i.close(); i = null } catch (tt) { i != null && (i.close(), i = null) } } else h = String(r).substr(0, r.length - 3), y = r; if (a = "VIS_88", e = [], e[0] = new t.DB.SqlParam("@AD_Tab_ID", t.context.getContextAsInt(c.lookup.windowNo, "0|AD_Tab_ID", !0)), p = st(a, e), y.equals("M_Product_ID") && p) k = window.DTD001 && p == 170 ? t.context.getContextAsInt(c.lookup.windowNo, "DTD001_MWarehouseSource_ID") : t.context.getContextAsInt(c.lookup.windowNo, "M_Warehouse_ID"), d = t.context.getContextAsInt(c.lookup.windowNo, "M_PriceList_ID"), b = !1, c.lookup.windowNo > 0 && (b = t.context.getWindowTabContext(c.lookup.windowNo, 1, "KeyColumnName") == "C_OrderLine_ID" || t.context.getWindowTabContext(c.lookup.windowNo, 1, "KeyColumnName") == "C_InvoiceLine_ID" || t.context.getWindowTabContext(c.lookup.windowNo, 1, "KeyColumnName") == "M_InOutLine_ID" || t.context.getWindowTabContext(c.lookup.windowNo, 1, "KeyColumnName") == "M_PackageLine_ID" || t.context.getWindowTabContext(c.lookup.windowNo, 1, "KeyColumnName") == "M_MovementLine_ID" || t.context.getWindowTabContext(c.lookup.windowNo, 1, "KeyColumnName") == "M_InventoryLine_ID" || t.context.getWindowTabContext(c.lookup.windowNo, 1, "KeyColumnName") == "M_ProductPrice_ID" || t.context.getWindowTabContext(c.lookup.windowNo, 1, "KeyColumnName") == "C_ProjectLine_ID" || t.context.getWindowTabContext(c.lookup.windowNo, 1, "KeyColumnName") == "M_RequisitionLine_ID" || t.context.getWindowTabContext(c.lookup.windowNo, 0, "KeyColumnName") == "M_PriceList_ID" || t.context.getWindowTabContext(c.lookup.windowNo, 1, "KeyColumnName") == "SAP001_StockTransferLine_ID"), u = new t.infoProduct(!0, c.lookup.windowNo, k, d, o, h, y, b, v, s); else { for (a = "VIS_89", e = [], e[0] = new t.DB.SqlParam("@tableName", h), i = w(a, e); i.read();) { f = i.getString(0); break } i.close(); i = null; u = f > 0 ? new t.InfoWindow(f, o, c.lookup.windowNo, v, c.isMultiKeyTextBox, s) : new t.infoGeneral(!0, c.lookup.windowNo, o, h, y, c.isMultiKeyTextBox, v, s) } } u.onClose = function () { var n = u.getSelectedValues(), t, i; if (n && n.length == 0) { l.closest("td").hasClass("vis-gc-vpanel-table-td3") ? window.setTimeout(function () { l.closest("tr").nextAll().children("input,select,textarea,button").focus() }, 200) : l.closest("td").hasClass("vis-gc-vpanel-table-td1") ? (t = l.closest("td").siblings(".vis-gc-vpanel-table-td3"), t && t.length > 0 && (t = t.find("input,select,textarea,button"), t && t.length > 0 ? window.setTimeout(function () { t.focus() }, 200) : window.setTimeout(function () { l.closest("tr").nextAll().children("input,select,textarea,button").focus() }, 200))) : window.setTimeout(function () { l.closest("td").siblings(".vis-gc-vpanel-table-td3").find("input,select,textarea,button").focus() }, 200); l.closest("td").nextAll().children("input,select,textarea,button").focus(); u.getRefreshStatus && u.getRefreshStatus() && c.fireRefreshUI(); return } if (c.isMultiKeyTextBox) { for (var r = "", f = 0, e = 0, f = 0, e = n.length; f < e; f++) { if (r.length == 0) { r += n[f]; continue } r += "," + n[f] } c.isMultiKeyTextBox ? c.setValue(r, !0, !0) : c.setValue(r, !1, !0) } else i = null, u.getRefreshStatus && u.getRefreshStatus() ? c.fireRefreshUI() : (n != null && n.length == 1 ? i = n[0] : (InfoMultipleIds = null, n.length > 1 && (i = n[0])), i != null && (c.isMultiKeyTextBox ? c.setValue(i, !0, !0) : (c.setValue(i, !1, !0), c.editingGrid && setTimeout(function () { c.editingGrid.editField(c.gridPos.recid, c.gridPos.col, i) }, 500)))); u = null }; u.show() } }; y.on(t.Events.onClick, c.openSearchForm); if (a) a.on(t.Events.onClick, function (n) { if (c.isMultiKeyTextBox) { if (c.isReadOnly) return; var t = c.getValue(); t && t.toString().length > 0 && c.setValue(null, !1, !0) } else a.w2overlay(p.clone(!0)); n.stopPropagation() }); if (p) p.on("click", "LI", function (i) { var u = n(i.target).data("action"), f, r, e; if (u == t.Actions.zoom) { if (d) return; nt() } else if (u == t.Actions.addnewrec) { if (d) return; nt(-10) } else if (u == t.Actions.preference) f = new t.ValuePreference(c.mField, c.getValue(), c.getDisplay()), f != null && f.showDialog(), f = null; else if (u == t.Actions.refresh) { if (!c.lookup || c.isReadOnly) return; c.lookup.refresh() } else if (u == t.Actions.add) r = c.getValue(), t.AddUpdateBPartner(c.mField.getWindowNo(), 0, t.Msg.getMsg("Customer"), null, 0, 0); else if (u == t.Actions.addproduct) r = c.getValue(), t.AddUpdateMProduct(c.mField.getWindowNo(), 0, t.Msg.getMsg("Product"), null, 0, 0); else if (u == t.Actions.update) r = c.getValue(), r && r.toString().length > 0 && t.AddUpdateBPartner(c.mField.getWindowNo(), r, t.Msg.getMsg("Customer"), null, 0, 0); else if (u == t.Actions.contact) r = c.getValue(), r && r.toString().length > 0 && (e = new t.ContactInfo(r, c.mField.getWindowNo()), e.show()); else if (u == t.Actions.remove) { if (c.isReadOnly) return; c.setValue(null, !1, !0) } }); this.disposeComponent = function () { y.off(t.Events.onClick); a && a.off(t.Events.onClick); p && p.off(t.Events.onTouchStartOrClick); p = null; c = null; l = null; y = null; a = null; this.getBtn = null; this.setVisible = null; b && b.off("click"); b = null; tt = null } } function ft(r, u, f, e, o, s, h) { var l = 6, v = 79, c, a; if (h != t.DisplayType.Memo) h == t.DisplayType.TextLong ? (l = 6, s = 1e5) : (l = s < 300 ? 2 : s < 2e3 ? 4 : 6, v = s < 300 ? 79 : s < 2e3 ? 129 : 129); else try { l = s < 300 ? 2 : s < 2e3 ? 4 : s / 500; v = s < 300 ? 79 : s < 2e3 ? 129 : 129 } catch (y) { l = s < 300 ? 2 : s < 2e3 ? 4 : 6; v = s < 300 ? 79 : s < 2e3 ? 129 : 129 } c = n("<textarea>", { name: r, maxlength: s, rows: l, style: "min-height:" + v + "px" }); i.call(this, c, h, f, r, u); f || !e ? this.setReadOnly(!0) : this.setReadOnly(!1); a = this; c.on("change", function (n) { var t, i; n.stopPropagation(); t = c.val(); t !== a.oldValue && (i = { newValue: t, propertyName: a.getName() }, a.fireValueChanged(i), i = null) }); this.disposeComponent = function () { c.off("change"); c = null; a = null } } function h(r, u, f, e, o, s, h) { var a = h, v = s, l = n("<input>", { type: "number", step: "any", name: r, maxlength: 16, "data-type": "int" }), c; l.attr("autocomplete", "off"); i.call(this, l, a, f, r, u); this.format = t.DisplayType.GetNumberFormat(a); f || !e ? this.setReadOnly(!0) : this.setReadOnly(!1); c = this; this.dotFormatter = t.Env.isDecimalPoint(); l.on("keydown", function (n) { if (n.keyCode == 189 || n.keyCode == 109 || n.keyCode == 173) { if (n.keyCode == 189 && this.value.length == 0) return !0; var t = c.format.GetConvertedNumber(this.value, c.dotFormatter); return this.value = Number(t) * -1, setTimeout(function () { l.trigger("change") }, 100), !1 } if (n.keyCode >= 37 && n.keyCode <= 40 || n.keyCode == 8 || n.keyCode == 9 || n.keyCode == 16 || n.keyCode == 17 || n.keyCode == 35 || n.keyCode == 36 || n.keyCode == 46) return !0; if (n.keyCode >= 48 && n.keyCode <= 57 && n.shiftKey == !1 || n.keyCode >= 96 && n.keyCode <= 105 && n.shiftKey == !1) return this.value.length >= v ? !1 : !0; if (n.keyCode == 189 || n.keyCode == 109 || n.keyCode == 173) return this.value = this.value * -1, !1; if (c.dotFormatter) { if (n.keyCode == 188) return !1 } else if (n.keyCode == 190 || n.keyCode == 110) return !1; if (n.keyCode == 190 || n.keyCode == 110 || n.keyCode == 188) return (this.value.indexOf(".") > -1 ? this.value = this.value.replace(".", "") : this.value.indexOf(",") > -1 && (this.value = this.value.replace(",", "")), this.value.length >= v) ? !1 : !0; if (n.ctrlKey && n.keyCode == 65) { if (this.value.length > 0) return n.stopPropagation(), l.select(), !0 } else if (n.ctrlKey && n.keyCode == 67) { if (this.value.length > 0) return n.stopPropagation(), !0 } else { if (n.ctrlKey && n.keyCode == 86) return setTimeout(function () { n.stopPropagation(); var t = n.target.value; n.target.value = t ? c.format.GetConvertedString(t, c.dotFormatter) : "" }, 10), !0; if (n.ctrlKey && n.keyCode == 88) return n.stopPropagation(), !0 } return !1 }); l.on("focus", function (n) { n.stopPropagation(); var i = n.target.value; l.attr("type", "text"); n.target.value = i ? c.format.GetConvertedString(i, c.dotFormatter) : ""; t.DisplayType.Amount == a && l.select() }); l.on("change", function (n) { var t, i; n.stopPropagation(); t = c.getValue(); this.value = t; t !== c.oldValue && (i = { newValue: t, propertyName: c.getName() }, c.fireValueChanged(i), i = null) }); l.on("blur", function (n) { var t, i, r; n.stopPropagation(); l.attr("type", "text"); t = l.val(); c.dotFormatter || (t = t.replace(".", ",")); i = c.format.GetConvertedString(t, c.dotFormatter); r = c.format.GetFormatAmount(i, "formatOnly", c.dotFormatter); l.val(r) }); this.disposeComponent = function () { l.off("keydown"); l.off("change"); l = null; c = null; this.format.dispose(); this.format = null; v = null } } function d(r, u, f, e, o, s) { var a = t.DisplayType.Integer, l = s, c = n("<input>", { type: "text", name: r, maxlength: l, "data-type": "int" }), h; i.call(this, c, a, f, r, u); this.format = t.DisplayType.GetNumberFormat(a); f || !e ? this.setReadOnly(!0) : this.setReadOnly(!1); h = this; c.on("keydown", function (n) { if (n.keyCode == 189 || n.keyCode == 109 || n.keyCode == 173) return n.keyCode == 189 && this.value.length == 0 ? !0 : (this.value = Number(this.value * -1), setTimeout(function () { c.trigger("change") }, 100), !1); if (n.keyCode >= 37 && n.keyCode <= 40 || n.keyCode == 8 || n.keyCode == 9 || n.keyCode == 16 || n.keyCode == 17 || n.keyCode == 35 || n.keyCode == 36 || n.keyCode == 46) return !0; if (this.value < 0) { if (this.value.length > t.DisplayType.INTEGER_DIGITS && n.keyCode != 8 && n.keyCode != 9 && n.keyCode != 46) return !1 } else if (this.value.length >= t.DisplayType.INTEGER_DIGITS && n.keyCode != 8 && n.keyCode != 9 && n.keyCode != 46) return !1; return n.keyCode >= 48 && n.keyCode <= 57 && n.shiftKey == !1 || n.keyCode >= 96 && n.keyCode <= 105 && n.shiftKey == !1 ? this.value.length >= l ? !1 : !0 : !1 }); c.on("change", function (n) { var t, i, r; n.stopPropagation(); t = h.getValue(); t = Globalize.parseInt(t.toString()); i = Number(h.format.GetFormatedValue(t)); t != i && (h.mField.setValue(null), t = i); t !== h.oldValue && (r = { newValue: t, propertyName: h.getName() }, h.fireValueChanged(r), r = null) }); this.disposeComponent = function () { c.off("keydown"); c.off("change"); c = null; h = null; this.format.dispose(); this.format = null; l = null } } function g(r, u, f, e, o, s, h) { o || (o = t.DisplayType.Location); this.lookup = s; this.lastDisplay = ""; this.settingFocus = !1; this.inserting = !1; this.settingValue = !1; this.value = null; var v = n("<input readonly>", { type: "text", name: r }), a = n('<button class="input-group-text"><i class="vis vis-location" aria-hidden="true"><\/i><\/button>'), l = n('<button class="input-group-text"><i class="vis vis-pencil" aria-hidden="true"><\/i><\/button>'), y = h ? 1 : 2, c = this; i.call(this, v, o, f, r, u); f || !e ? this.setReadOnly(!0) : this.setReadOnly(!1); this.getBtn = function (n) { if (y == 2) { if (n == 0) return a; if (n == 1) return l } else return l }; this.getBtnCount = function () { return y }; this.setVisible = function (n) { this.visible = n; n ? (v.show(), a.show(), l.show()) : (v.hide(), a.hide(), l.hide()) }; this.setReadOnly = function (n) { this.isReadOnly = n; v.prop("disabled", n ? !0 : !1); n ? l.css("opacity", .7) : l.css("opacity", 1); this.setBackground(!1) }; a.on(t.Events.onClick, function (n) { c.getField().gridTab && c.getField().gridTab.mDataListenerList && c.getField().gridTab.mDataListenerList[0].switchMapRow(c.value); n.stopPropagation() }); l.on(t.Events.onClick, function (n) { var r, i; (n.stopPropagation(), c.isReadOnly) || (r = null, c.mField && c.mField.vo && (r = c.mField.vo.IsMaintainVersions), i = new t.LocationForm(c.value, r), i.load(), i.showDialog(), i.onClose = function (n, t) { if (t) { c.oldValue = 0; c.lookup.refreshLocation(n); c.setValue(n); var i = { newValue: n, propertyName: c.getColumnName() }; c.fireValueChanged(i); i = null } }, i = null) }); this.disposeComponent = function () { a.off(t.Events.onClick); l.off(t.Events.onClick); c = null; v = null; a = null; l = null; this.setVisible = null } } function c(r, u, f, e, o, s) { var v; this.mandatory = u; this.onlyWarehouseId = 0; this.onlyProductId = 0; this.onlyOutgoing = null; this.windowNum = s.getWindowNo(); this.columnName = r; this.lookup = s; v = "vis vis-locator"; this.value = null; o || (o = t.DisplayType.Locator); var l = n("<input readonly>", { type: "text", name: r }), c = n('<button class="input-group-text"><i class="' + v + '" aria-hidden="true"><\/i><\/button>'), a = n('<button class="input-group-text"><i class="vis vis-find" aria-hidden="true"><\/i><\/button>'), y = 2, h = this; i.call(this, l, o, f, r, u); this.getBtnCount = function () { return y }; this.getBtn = function (n) { return n == 0 ? c : n == 1 ? a : void 0 }; this.setVisible = function (n) { this.visible = n; n ? (l.show(), c.show(), a.show()) : (c.hide(), a.hide(), l.hide()) }; this.setReadOnly = function (n) { this.isReadOnly = n; l.prop("disabled", n ? !0 : !1); n ? c.css("opacity", .7) : c.css("opacity", 1); this.setBackground(!1) }; c.on(t.Events.onClick, function (n) { if (n.stopPropagation(), !h.isReadOnly) { var t = h.getOnlyWarehouseID(), i = h.getOnlyProductID(); h.showLocatorForm(t, i) } }); a.on(t.Events.onClick, function (n) { var i, r, u, e, o, s, f, c; if (n.stopPropagation(), h.lookup) { if (i = h.lookup.getZoomQuery(), r = h.getValue(), r == null, r == "" && (r = null), i == null || r != null) { if (i = new t.Query, u = null, h.lookup != null && h.lookup instanceof t.MLookup && (e = h.lookup.getAD_Reference_Value_ID(), e != 0)) { o = "VIS_91"; s = []; s[0] = new t.DB.SqlParam("@AD_Reference_ID", e); try { f = w(o, s); f.read() && (u = f.getString(0)); f.dispose() } catch (n) { this.log.log(t.Logging.Level.SEVERE, o, n) } } u != null && u.length != 0 ? i.addRestriction(u, t.Query.prototype.EQUAL, r) : i.addRestriction(h.getColumnName(), t.Query.prototype.EQUAL, r); i.setRecordCount(1) } c = 0; c = h.mField.getZoomWindow_ID() > 0 ? h.mField.getZoomWindow_ID() : h.lookup.getZoomWindow(i); t.viewManager.startWindow(c, i) } }); this.disposeComponent = function () { c.off(t.Events.onClick); a.off(t.Events.onClick); h = null; l = null; c = null; this.getBtn = null; this.setVisible = null } } function f(r, u, f, e, o, s, h, c, l, a, v, y) { function it(n) { var i = t.Env.getCtx().getContextAsInt(p.windowNo, "C_GenAttributeSetInstance_ID"), r; p.isFromActivityForm && (i = p.C_GenAttributeSetInstance_ID); i == 0; r = new t.GenralAttributeForm(i, n, p.windowNo, p.isSearch, p.getCanSaveRecord(), p.isFromDMS); r.showDialog(); r.onClose = function (n, i, r) { t.Env.getCtx().setContext(h, "C_GenAttributeSetInstance_ID", n); k(n, i); r != null && (p.setInstanceIDs = r); p.getControl().val(i); p.editingGrid && setTimeout(function () { p.editingGrid.editField(p.gridPos.recid, p.gridPos.col, n) }, 500) } } function k(n) { if (p.log.finest("Changed M_AttributeSetInstance_ID=" + n), p.oldValue != n) { n == 0 && p.setValue(null); p.setValue(n); var t = { newValue: n, propertyName: p.colName }; p.fireValueChanged(t); t = null } } function rt(i) { var u = i == null ? 0 : i, r = t.Env.getCtx().getTabRecordContext(h, y, "M_Product_ID"), e = t.context.getTabRecordContext(h, y, "M_ProductBOM_ID"), c = t.Env.getCtx().getContextAsInt(h, "M_Locator_ID"), f; p.log.config("M_Product_ID=" + r + "/" + e + ",M_AttributeSetInstance_ID=" + u + ", AD_Column_ID=" + p.AD_Column_ID); var o = p.AD_Column_ID == 8418, s = !0, l = !1; e != 0 && (r = e); r != 0 && n.ajax({ url: t.Application.contextUrl + "PAttributes/ExcludeEntry", dataType: "json", async: !1, data: { productId: r, adColumn: p.AD_Column_ID, windowNo: h }, success: function (n) { s = n.result } }); !o && (r == 0 || s) ? (l = !0, u = 0, k(u), t.ADialog.info("VIS_PAttributeNotFound", null, null, null)) : (f = new t.PAttributesForm(u, r, c, p.C_BPartner_ID, o, p.AD_Column_ID, h), f.hasAttribute && f.showDialog(), f.onClose = function (n, t, i) { this.M_Locator_ID = i; k(n, t); p.editingGrid && setTimeout(function () { p.editingGrid.editField(p.gridPos.recid, p.gridPos.col, n) }, 500) }) } var d, nt, g; this.NO_INSTANCE = 0; this.AD_Column_ID = 0; d = "M_AttributeSetInstance_ID"; nt = !1; this.C_GenAttributeSet_ID = 0; this.C_GenAttributeSetInstance_ID = 0; this.M_Locator_ID = 0; d = r; this.value = null; this.windowNo = h; this.tabNo = y; this.lookup = s; this.C_BPartner_ID = t.Env.getCtx().getContextAsInt(this.windowNo, "C_BPartner_ID"); this.log = t.Logging.VLogger.getVLogger("VPAttribute"); g = "vis vis-pattribute"; o || (o = t.DisplayType.PAttribute); this.isFromActivityForm = c; this.isSearch = l; this.isFromDMS = a; this.isPAttribute = v; this.canSaveRecord = !0; var b = n("<input>", { type: "text", name: r }), w = n('<button class="input-group-text"><i class="' + g + '"><\/i><\/button>'), tt = 1, p = this; this.setInstanceIDs = null; i.call(this, b, o, f, r, u); f || !e ? this.setReadOnly(!0) : this.setReadOnly(!1); this.getBtnCount = function () { return tt }; this.getBtn = function (n) { if (n == 0) return w }; this.setVisible = function (n) { this.visible = n; n ? (b.show(), w.show()) : (w.hide(), b.hide()) }; this.setReadOnly = function (n) { this.isReadOnly = n; b.prop("disabled", n ? !0 : !1); n ? w.css("opacity", .7) : w.css("opacity", 1); this.setBackground(!1) }; w.on(t.Events.onClick, function (n) { var r, i; if (n.stopPropagation(), !p.isReadOnly) { if (r = p.getValue(), !p.isPAttribute) { if (i = 0, i = t.Env.getCtx().getContextAsInt(p.windowNo, "C_GenAttributeSet_ID"), i == 0 && (i = p.C_GenAttributeSet_ID, i == 0)) { t.ADialog.info("NoAttributeSet", null, null, null); return } it(i, r); return } rt(r) } }); this.SetC_GenAttributeSet_ID = function (n) { this.C_GenAttributeSet_ID = n }; this.disposeComponent = function () { w.off(t.Events.onClick); p = null; b = null; w = null; this.getBtn = null; this.setVisible = null; this.value = null; this.lookup = null } } function nt(r, u, f, e, o, s, h, c) { var y, p; this.value = null; this.windowNo = h; this.lookup = s; this.title = c; y = r; p = "vis vis-account"; o || (o = t.DisplayType.PAttribute); var v = n("<input readonly>", { type: "text", name: r }), a = n('<button class="input-group-text"><i class="' + p + '" ><\/i><\/button>'), w = 1, l = this; i.call(this, v, o, f, r, u); this.getBtnCount = function () { return w }; this.getBtn = function (n) { if (n == 0) return a }; this.setVisible = function (n) { this.visible = n; n ? (v.show(), a.show()) : (v.hide(), a.hide()) }; this.setReadOnly = function (n) { this.isReadOnly = n; v.prop("disabled", n ? !0 : !1); n ? a.css("opacity", .7) : a.css("opacity", 1); this.setBackground(!1) }; a.on(t.Events.onClick, function (n) { var u, r, i; (n.stopPropagation(), l.isReadOnly) || (u = t.Env.getCtx().getContextAsInt(l.windowNo, "C_AcctSchema_ID"), r = 0, l != null && l.getField() != null && l.getField().vo != null && l.getField().vo.AD_Table_ID != null && (r = l.getField().vo.AD_Table_ID), i = new t.AccountForm(l.title, l.lookup, u, r), i.load(), i.showDialog(), i.onClose = function (n) { if (l.oldValue != n) { l.setValue(n); var t = { newValue: n, propertyName: y }; l.fireValueChanged(t); t = null } }, i = null) }); this.disposeComponent = function () { a.off(t.Events.onClick); l = null; v = null; a = null; this.getBtn = null; this.setVisible = null; this.value = null; this.lookup = null; this.value = null; this.windowNo = null; this.title = null } } function l(r, u, f, e) { var h; this.values = null; this.log = t.Logging.VLogger.getVLogger("VImage"); var p = e, a = r, s = n("<img >"), v = n("<i>"), o = n("<span>").text("-"), c = n('<a href="javascript:;" class="vis vis-edit vis-img-ctrl-icon">'), l = null, y = "Thumb500x375"; l = n("<button >", { type: "button", name: a, "class": "vis-ev-col-img-ctrl", tabindex: "-1" }); o.css("color", "blue"); l.append(c).append(s).append(v).append(o); i.call(this, l, t.DisplayType.Button, f, a, u); f ? this.setReadOnly(!0) : this.setReadOnly(!1); h = this; c.on(t.Events.onClick, function (n) { if (n.stopPropagation(), !h.isReadOnly) { var i = new t.VImageForm(h.getValue(), o.text().trim().length); i.showDialog(); i.onClose = function (n, t) { if (t) if (h.oldValue = -1, h.oldValue != n) { n = n == "null" ? null : n; h.setValue(n); var i = { newValue: n, propertyName: a }; h.fireValueChanged(i, !0); i = null } else h.refreshImage(n) }; i = null } }); this.setText = function (n) { var t, i; if (n == null) { o.text(""); s.image.src = ""; return } t = n.indexOf("&"); t != -1 && (i = n.toUpperCase().charAt(t + 1), i != " " && (n = n.substring(0, t) + n.substring(t + 1))); o.text(n) }; this.setDimension = function (n, t) { y = "Thumb" + t + "x" + n }; this.setIcon = function (n, i) { i ? (s.attr("src", t.Application.contextUrl + "Images/" + y + "/" + i + "? timestamp =" + (new Date).getTime()), s.show(), v.hide(), o.text(""), this.ctrl.addClass("vis-input-wrap-button-image-add")) : n != null ? (s.attr("src", "data:image/jpg;base64," + n + "? timestamp =" + (new Date).getTime()), s.show(), v.hide(), o.text(""), this.ctrl.addClass("vis-input-wrap-button-image-add")) : (s.attr("src", "data:image/jpg;base64," + n), s.hide(), o.text("-"), this.ctrl.removeClass("vis-input-wrap-button-image-add")) }; this.hideText = function () { o.hide() }; this.hideEditIcon = function () { c.hide() }; this.hideEditIcon = function () { c.hide() }; this.hideEditIcon = function () { c.hide() }; this.disposeComponent = function () { l.off(t.Events.onClick); l = null; this.log = null; p = null; s = null; o = null; this.setText = null; this.setIcon = null; h = null } } function v(r, u, f, e, o) { function b() { var i = n("<ul class='vis-apanel-rb-ul'>"); return i.append(n("<a id='link' style='border-bottom: 1px solid #CCDADE;color: #535353;font-size: 12px;display: block;margin-bottom: 8px;'  href='javascript:void(0)'>" + t.Msg.getMsg("SaveTolocalFile") + "<\/a>")), i.append(n("<li data-action='" + y + "'>").text(t.Msg.getMsg("Open/LoadIntoDatabase"))), i } var l, s; this.values = null; var a = n("<span>").text(""), w = o, v = r, h = null, c = null, p = "SaveTolocalFile", y = "LoadIntoDatabase"; if (this.data = null, l = n("<input type='file' class='file' name='file'/>"), h = n("<button>", { type: "button", name: v }), h.append(a), i.call(this, h, t.DisplayType.Button, f, v, u), f || !e ? this.setReadOnly(!0) : this.setReadOnly(!1), s = this, c = b(), c) { c.on("click", "LI", function (t) { var i = n(t.target).data("action"); i == p || i == y && l.trigger("click") }); c.on("click", "a", function () { if (s.getValue() != null) { var t = (new Date).toISOString().slice(0, 19).replace(/-/g, ""), i = "data:;base64," + s.getValue(); n(this).attr("href", i).attr("download", "file-" + t + ".log") } }) } l.change(function () { var t = l[0].files[0], n = new FileReader, i = n.readAsDataURL(t); n.onloadend = function () { var t = n.result.split(",")[1], i; s.oldValue != t && (s.setValue(t), i = { newValue: t, propertyName: v }, s.fireValueChanged(i, !0), i = null) }; return }); h.on(t.Events.onClick, function (n) { s.isReadOnly || h.w2overlay(c.clone(!0)); n.stopPropagation() }); this.setText = function (n) { var t, i; if (n == null) { a.text(""); return } t = n.indexOf("&"); t != -1 && (i = n.toUpperCase().charAt(t + 1), i != " " && (n = n.substring(0, t) + n.substring(t + 1))); a.text(n) }; this.disposeComponent = function () { h.off(t.Events.onClick); h = null; this.setText = null; this.values = null; a = null; w = null; v = null; c = null; p = null; y = null; this.data = null; l = null; s = null } } function tt(r, u, f, e, o, s) { var h; this.value = null; var v = "vis vis-url", a = 0, c = n("<input>", { type: "text", name: r, maxlength: s }), l = n('<button class="input-group-text"><i class="' + v + '" ><\/i><\/button>'); a += 1; h = this; i.call(this, c, t.DisplayType.URL, f, r, u); f || !e ? this.setReadOnly(!0) : this.setReadOnly(!1); this.getBtnCount = function () { return a }; this.getBtn = function (n) { if (n == 0) return l }; this.setVisible = function (n) { this.visible = n; n ? (c.show(), l.show()) : (c.hide(), l.hide()) }; l.on(t.Events.onClick, function (n) { if ((n.stopPropagation(), h.value != null) && !h.isReadOnly) { var i = h.value.trim(); if (i.length > 0) { i.contains("http://") || i.contains("https://") || (i = "http://" + i); window.open(i); return } t.ADialog.warn("URLnotValid", !0, null) } }); c.on("change", function (n) { var t, i; n.stopPropagation(); t = c.val(); t !== h.oldValue && (i = { newValue: t, propertyName: h.getName() }, h.fireValueChanged(i), i = null) }); this.disposeComponent = function () { l.off(t.Events.onClick); c.off("change"); h = null; c = null; l = null; this.getBtn = null; this.setVisible = null; this.value = null; v = null; a = null; this.getBtnCount = null; this.getBtn = null } } function y(r, u, f, e, o, s) { var k = !1, w, y, s, b, p, d, l, v, h; s == s.FileName && (k = !0); DialogType = { OpenFile: 0, SaveFile: 1, Custom: 2 }; SelectionType = { FilesOnly: 0, DirectoryOnly: 1 }; w = SelectionType.DirectoryOnly; y = DialogType.Custom; this.log = t.Logging.VLogger.getVLogger("VFile"); s = t.DisplayType.FileName; b = "fa fa-folder-open-o"; k && (w = SelectionType.FilesOnly, b = "fa fa-file-text-o"); p = r.toUpperCase(); p.indexOf("open") != -1 || p.indexOf("load") != -1 ? y = DialogType.OpenFile : p.indexOf("save") != -1 && (y = DialogType.SaveFile); d = o; l = r; this.value = null; var g = 0, c = n("<input>", { type: "text", name: l }), a = n('<button class="input-group-text"><i class="' + b + '" /><\/button>'); g += 1; v = n("<input autocomplete='off' type='file' class='file' name='file'/>"); c.append(a); i.call(this, c, s, f, l, u); f || !e ? this.setReadOnly(!0) : this.setReadOnly(!1); this.getBtnCount = function () { return g }; this.getBtn = function (n) { if (n == 0) return a }; this.setVisible = function (n) { this.visible = n; n ? (c.show(), a.show()) : (c.hide(), a.hide()) }; h = this; a.on(t.Events.onClick, function (i) { var u, f, r; h.isReadOnly || (i.stopPropagation(), w == SelectionType.DirectoryOnly ? (r = new t.VisImportFiles(!0), r.onClose = function (n) { h.setValue(n) }, r.show()) : y == DialogType.SaveFile ? h.getValue() != null && (u = (new Date).toISOString().slice(0, 19).replace(/-/g, ""), f = "data:;base64," + h.getValue(), n(this).attr("href", f).attr("download", "file-" + u + ".log")) : (r = new t.VisImportFiles(!1), r.onClose = function () { h.setValue(name) }, r.show())) }); v.on("change", function (t) { var i, r; t.stopPropagation(); i = n(v).val().split("\\").pop(); h.oldValue != i && (h.setValue(i), r = { newValue: i, propertyName: l }, h.fireValueChanged(r), r = null) }); c.on("change", function (n) { var t, i; n.stopPropagation(); t = c.val(); this.value = t; t !== h.oldValue && (i = { newValue: t, propertyName: h.getName() }, h.fireValueChanged(i), i = null, h.setValue(t)) }); this.disposeComponent = function () { c.off(t.Events.onClick); c.off("change"); v.off("change"); c = null; d = null; l = null; v = null; h = null } } function it(r, u, f, e, o, s, h) { o || (o = t.DisplayType.AmtDimension); this.lookup = s; this.lastDisplay = ""; this.settingFocus = !1; this.inserting = !1; this.settingValue = !1; this.value = null; this.defaultValue = ""; var l = n("<input readonly>", { type: "text", name: r }), a = n('<button class="input-group-text"><i class="vis vis-amtdimension" /><\/button>'), v = 1, c = this; i.call(this, l, o, f, r, u); this.format = t.DisplayType.GetNumberFormat(t.DisplayType.Amount); this.dotFormatter = t.Env.isDecimalPoint(); f || !e ? this.setReadOnly(!0) : this.setReadOnly(!1); this.getBtn = function (n) { if (n == 0) return a }; this.getBtnCount = function () { return v }; this.hideButton = function (n) { n ? a.show() : a.hide() }; this.setVisible = function (n) { this.visible = n; n ? (l.show(), a.show()) : (l.hide(), a.hide()) }; this.setReadOnly = function (n) { this.isReadOnly = n; l.css("background-color", "#f8f8f8"); this.setBackground(n) }; this.setReadOnlyTextbox = function (n) { n ? (l.attr("readonly", "readonly"), l.attr("disabled", "disabled")) : (l.removeAttr("readonly"), l.removeAttr("disabled")) }; this.getText = function () { return l.val() }; this.setDefaultValue = function (n) { this.defaultValue = n }; a.on(t.Events.onClick, function (n) { n.stopPropagation(); c.actionText() }); this.actionText = function () { var i, r, n; c.value || (c.value = 0); i = t.Env.getCtx().getContextAsInt(h, "AD_Org_ID", !1); this.defaultValue && (c.defaultValue = c.defaultValue.replace(/@/g, "").trim().replace(".value", ""), r = t.Env.getCtx().getWindowContext(h, c.defaultValue, !1)); c.oldValue = c.value; n = new t.AmountDivision(c.value, i, r, c.isReadOnly); n.onClosing = function (n) { if (n > 0) { c.oldValue = 0; c.lookup.refreshAmountDivision(n); c.setValue(n); var t = { newValue: n, propertyName: c.getColumnName() }; c.fireValueChanged(t); t = null } }; n.show(); n = null }; this.disposeComponent = function () { a.off(t.Events.onClick); c = null; l = null; a = null; this.setVisible = null } } function p(r, u, f, e, o, s, h) { function k() { var i, n, r; c.lookup && (i = c.lookup.getZoomQuery(), n = c.getValue(), n == null, n == "" && (n = null), n == null || isNaN(n) || (n = parseInt(n)), i = new t.Query, i.addRestriction("M_ProductContainer_ID", t.Query.prototype.EQUAL, n), i.setRecordCount(1), r = 0, r = c.mField.getZoomWindow_ID() > 0 ? c.mField.getZoomWindow_ID() : c.lookup.getZoomWindow(i), t.viewManager.startWindow(r, i)) } var y, w, p, a, c; o || (o = t.DisplayType.ProductContainer); y = {}; this.lookup = s; this.lastDisplay = ""; this.settingFocus = !1; this.inserting = !1; this.settingValue = !1; this.value = null; this.defaultValue = ""; w = !1; y[t.Actions.zoom] = w; t.MRole.getIsShowPreference() && (y[t.Actions.preference] = !0); y[t.Actions.remove] = !0; p = t.AEnv.getContextPopup(y); a = n("<input>", { type: "text", name: r }); a.attr("autocomplete", "off"); var v = n('<button class="input-group-text"><i class="vis vis-pcontainer" /><\/button>'), l = n('<button   class="input-group-text"><i tabindex="-1" Class="fa fa-ellipsis-v" /><\/button>'), b = 1; if (b += 1, c = this, i.call(this, a, o, f, r, u), f || !e ? this.setReadOnly(!0) : this.setReadOnly(!1), this.getBtn = function (n) { return n == 0 ? v : n == 1 && l ? l : void 0 }, this.getBtnCount = function () { return b }, this.hideButton = function (n) { n ? (v.show(), this.getBtnCount() > 1 && l && l.show()) : (v.hide(), this.getBtnCount() > 1 && l && l.hide()) }, this.setVisible = function (n) { this.visible = n; n ? (a.show(), v.show(), this.getBtnCount() > 1 && l && l.show()) : (a.hide(), v.hide(), this.getBtnCount() > 1 && l && l.hide()) }, this.setReadOnly = function (n) { this.isReadOnly = n; a.prop("disabled", n ? !0 : !1); n ? v.css("opacity", .7) : v.css("opacity", 1); this.setBackground(!1) }, l) l.on(t.Events.onClick, function (n) { l.w2overlay(p.clone(!0)); n.stopPropagation() }); if (p) p.on("click", "LI", function (i) { var u = n(i.target).data("action"), r; if (u == t.Actions.preference) r = new t.ValuePreference(c.mField, c.getValue(), c.getDisplay()), r != null && r.showDialog(), r = null; else if (u == t.Actions.zoom) k(); else if (u == t.Actions.remove) { if (c.isReadOnly) return; c.setValue(null, !1, !0) } }); this.getText = function () { return a.val() }; this.setDefaultValue = function (n) { this.defaultValue = n }; v.on(t.Events.onClick, function (n) { (n.stopPropagation(), c.isReadOnly) || c.actionText(!0) }); this.actionText = function (i) { c.value || (c.value = 0); var r = a.val().trim(), u = t.Env.parseContext(t.Env.getCtx(), h, c.lookup.getTabNo(), c.lookup.info.validationCode, !1, !0); !r || i ? c.openForm(0, 0, r, u) : n.ajax({ url: rt + "productContainer/GetProductContainer", data: { text: r, validation: u }, success: function (n) { n = JSON.parse(n); n == "null" || n == null || n == "" || n == 0 ? c.openForm(0, 0, r, u) : c.setVal(n) }, error: function () { } }) }; a.on("keydown", function (n) { (n.keyCode == 13 || n.keyCode == 9) && c.actionText(!1) }); this.setVal = function (n) { c.oldValue = 0; c.setValue(n); var t = { newValue: n, propertyName: c.getColumnName() }; c.fireValueChanged(t, !0); t = null }; this.openForm = function (n, i, r, u) { c.oldValue = c.value; var f = new t.productContainerTree(n, i, r, u); f != null && (f.showDialog(), f.onClosing = function (n) { c.setVal(n) }); f = null }; this.disposeComponent = function () { v.off(t.Events.onClick); c = null; a = null; v = null; this.setVisible = null } } function et(r, u, f, e, o, s) { this.colSql = r; this.windowNo = u; this.cache = {}; this.isExe = e; this.headerItemID = s; this.needtoParse = !1; this.frmat = null; o && t.DisplayType.IsNumeric(o.getDisplayType()) && (this.frmat = t.DisplayType.GetNumberFormat(o.getDisplayType())); this.frmat = null; o && t.DisplayType.IsNumeric(o.getDisplayType()) && (this.frmat = t.DisplayType.GetNumberFormat(o.getDisplayType())); r.contains("@") && (this.needtoParse = !0); var c = ' for="' + f + '"', h = n("<span " + c + "><\/span>"); i.call(this, h, t.DisplayType.Label, !0, "lbl" + f); this.disposeComponent = function () { h = null; self = null; this.frmat && this.frmat.dispose(); this.format = null; this.cache = {}; this.cache = null } } function e(t, r, u, f, e, o, s) { var a = n('<div class="vis-progressCtrlWrap"><\/div>'), h = n("<input>", { type: "range", step: "1", name: t, maxlength: o, "data-type": "int" }), c = n('<output  class="vis-progress-output">'), l; a.append(c).append(h); i.call(this, a, s, u, t, r); this.rangeCtrl = h; this.oputput = c; c.text(0); this.setText = function (n) { c.text(n) }; this.setRange = function (n) { n != null ? h.val(n) : h.val(0) }; this.getRange = function () { return h.val() }; u || !f ? this.setReadOnly(!0) : this.setReadOnly(!1); l = this; c.keypress(function (t) { (t.which < 46 || t.which > 59) && t.preventDefault(); (t.which == 46 && n(this).val().indexOf(".") != -1 || t.which == 44 && n(this).val().indexOf(",") != -1) && t.preventDefault() }).on("blur", function () { n.isNumeric(h.attr("max")) && Number(h.attr("max")) < Number(n(this).text()) && n(this).text(h.attr("max")); h.val(n(this).text() || 0).change() }); h.on("input", function (n) { n.stopPropagation(); var t = h.val(); c.show(); c.text(t) }); h.on("change", function (n) { var t, i; n.stopPropagation(); t = h.val(); t !== l.oldValue && (i = { newValue: t, propertyName: l.getName() }, l.fireValueChanged(i), i = null) }); this.disposeComponent = function () { a = null; h = null; this.rangeCtrl = this.$oputput = null; l = null } } function u(r, u, f, e, o, s, h, c) { var y = t.DisplayType.TelePhone, l; this.obscureType = c; var a = n("<input>", { type: "tel", name: r, maxlength: s }), v = n('<button class="input-group-text"><i class="fa fa-phone" /><\/button>'), p = a; i.call(this, a, y, f, r, u); f || !e ? this.setReadOnly(!0) : this.setReadOnly(!1); this.getBtn = function (n) { if (n == 0) return v }; this.getBtnCount = function () { return this.editingGrid ? 0 : 1 }; l = this; a.on("change", function (n) { var t, i; n.stopPropagation(); t = l.iti ? l.iti.getNumber() : l.ctrl.val(); this.value = t; t !== l.oldValue && (i = { newValue: t, propertyName: l.getName() }, l.fireValueChanged(i), i = null); c && l.setReadOnly(!0) }); a.on("keypress", function (n) { var t = n.which ? n.which : n.keyCode; return t > 31 && (t < 48 || t > 57) ? t == 43 && this.value.indexOf("+") < 0 ? !0 : !1 : !0 }); a.on("countrychange", function () { !l.settingVal }); a.on("blur", function () { }); v.on("click", function () { var i, n; if (!l.editingGrid) if (window.VA048) { if (i = l.getValue(), !i || i == "") return; n = {}; n.tonumbers = i; n.username = ""; n.userimg = ""; n.isconference = !1; n.reftableid = -1; n.refrecordid = -1; n.windowno = 0; n.windowid = 0; n.tableid = 0; n.recordid = 0; n.withrecording = !1; n.withcall = !0; VA048.Apps.GetCallingInstance(!0, n, !1) } else t.ADialog.info("ComModuleNotInstalled") }); this.disposeComponent = function () { a.off("change"); a = null; l.iti && l.iti.destroy(); l = null } } function ot(r, u, f, e, o, s, h, c) { var y = t.DisplayType.Color, l; this.obscureType = c; var a = n("<input>", { type: "color", name: r, maxlength: s }), v = n('<button class="input-group-text"><i class="fa fa-phone" /><\/button>'), p = a; i.call(this, a, y, f, r, u); f || !e ? this.setReadOnly(!0) : this.setReadOnly(!1); this.getBtn = function (n) { if (n == 0) return v }; this.getBtnCount = function () { return 0 }; l = this; a.on("change", function (n) { var t, i; n.stopPropagation(); t = l.ctrl.val(); this.value = t; t !== l.oldValue && (i = { newValue: t, propertyName: l.getName() }, l.fireValueChanged(i), i = null); c && l.setReadOnly(!0) }); a.on("blur", function () { }); v.on("click", function () { }); this.disposeComponent = function () { a.off("change"); a = null; l = null } } var rt = t.Application.contextUrl, lt = rt + "JsonData/JDataSetWithCode", at = rt + "JsonData/ExecuteNonQuer", vt = rt + "Form/JDataSet", w = function (n, i, r) { var e = r ? !0 : !1, f = { sql: n, page: 1, pageSize: 0 }, u; return i && (f.param = i), u = null, ct(f, e, function (n) { u = (new t.DB.DataReader).toJson(n); r && r(u) }), u }, st = function (n, i, r) { var f = r ? !0 : !1, e = { sql: n, page: 1, pageSize: 0 }, u; return i && (e.param = i), u = null, ct(e, f, function (n) { i = (new t.DB.DataSet).toJson(n); var i = (new t.DB.DataSet).toJson(n); u = i.getTable(0).getRows().length > 0 ? i.getTable(0).getRow(0).getCell(0) : null; i.dispose(); i = null; f && r(u) }), u }; t.DisplayType = { String: 10, Integer: 11, Amount: 12, ID: 13, Text: 14, Date: 15, DateTime: 16, List: 17, Table: 18, TableDir: 19, YesNo: 20, Location: 21, Number: 22, Binary: 23, Time: 24, Account: 25, RowID: 26, Color: 27, Button: 28, Quantity: 29, Search: 30, Locator: 31, Image: 32, Assignment: 33, Memo: 34, PAttribute: 35, TextLong: 36, CostPrice: 37, FilePath: 38, FileName: 39, URL: 40, PrinterName: 42, Label: 44, MultiKey: 45, GAttribute: 46, AmtDimension: 47, ProductContainer: 48, ProgressBar: 49, TelePhone: 50, IsString: function (n) { return t.DisplayType.String == n }, IsText: function (n) { return n == t.DisplayType.String || n == t.DisplayType.Text || n == t.DisplayType.TextLong || n == t.DisplayType.Memo || n == t.DisplayType.FilePath || n == t.DisplayType.FileName || n == t.DisplayType.URL || n == t.DisplayType.PrinterName || n == t.DisplayType.TelePhone || n == t.DisplayType.Color ? !0 : !1 }, IsLookup: function (n) { return t.DisplayType.List == n || n == t.DisplayType.TableDir || n == t.DisplayType.Table || n == t.DisplayType.Search || n == t.DisplayType.MultiKey || n == t.DisplayType.ProductContainer ? !0 : !1 }, IsInt: function (n) { return n == t.DisplayType.Integer || n == t.DisplayType.ProgressBar ? !0 : !1 }, IsSearch: function (n) { return n == this.Search ? !0 : !1 }, IsID: function (n) { return n == t.DisplayType.ID || n == t.DisplayType.Table || n == t.DisplayType.TableDir || n == t.DisplayType.Search || n == t.DisplayType.Location || n == t.DisplayType.Locator || n == t.DisplayType.Account || n == t.DisplayType.Assignment || n == t.DisplayType.PAttribute || n == t.DisplayType.Image || n == t.DisplayType.AmtDimension || n == t.DisplayType.ProductContainer ? !0 : !1 }, IsNumeric: function (n) { return n == t.DisplayType.Amount || n == t.DisplayType.Number || n == t.DisplayType.CostPrice || n == t.DisplayType.Integer || n == t.DisplayType.Quantity || n == t.DisplayType.ProgressBar ? !0 : !1 }, IsDate: function (n) { return n == t.DisplayType.Date || n == t.DisplayType.DateTime || n == t.DisplayType.Time ? !0 : !1 }, IsLOB: function (n) { return n == t.DisplayType.Binary || n == t.DisplayType.TextLong ? !0 : !1 }, MAX_DIGITS: 28, INTEGER_DIGITS: 10, MAX_FRACTION: 12, AMOUNT_FRACTION: 2, GetNumberFormat: function (n) { return n == this.Integer || n == this.ProgressBar ? new t.Format(this.INTEGER_DIGITS, 0, 0) : n == this.Quantity ? new t.Format(this.MAX_DIGITS, this.MAX_FRACTION, 0) : n == this.Amount ? new t.Format(this.MAX_DIGITS, this.MAX_FRACTION, this.AMOUNT_FRACTION) : n == this.CostPrice ? new t.Format(this.MAX_DIGITS, this.MAX_FRACTION, this.AMOUNT_FRACTION) : new t.Format(this.MAX_DIGITS, this.MAX_FRACTION, 1) } }; t.VControlFactory = { getControl: function (n, i, w, rt) { var et, ct, ri, si, ui, wt, bt, kt, hi, ci, li, ni, ai, ti, ii, dt, vi, yi, pi, gt, yt, vt; if (!i || (et = i.getColumnName(), ct = i.getIsMandatory(!1), i.getIsHeading())) return null; var bi = i.getIsDisplayed(), fi = i.getMinValue(), ei = i.getMaxValue(), st = null, ut = i.getDisplayType(), lt = i.getIsReadOnly(), at = i.getIsEditable(!1), pt = i.getWindowNo(), oi = 0, wi = !1; return n && (oi = n.getTabNo(), wi = !n.getIsMapView()), ut == t.DisplayType.Button ? (ri = new r(et, ct, lt, at, i.getHeader(), i.getDescription(), i.getHelp(), i.getAD_Process_ID(), i.getIsLink(), i.getIsRightPaneLink(), i.getAD_Form_ID(), i.getIsBackgroundProcess(), i.getAskUserBGProcess()), ri.setField(i), ri.setReferenceKey(i.getAD_Reference_Value_ID()), st = ri) : ut == t.DisplayType.TelePhone ? (vt = new u(et, ct, lt, at, i.getDisplayLength(), i.getFieldLength(), i.getVFormat(), i.getObscureType(), i.getIsEncryptedField()), vt.setField(i), st = vt) : ut == t.DisplayType.Color ? (vt = new ot(et, ct, lt, at, i.getDisplayLength(), i.getFieldLength(), i.getVFormat(), i.getObscureType(), i.getIsEncryptedField()), vt.setField(i), st = vt) : ut == t.DisplayType.String ? (vt = new a(et, ct, lt, at, i.getDisplayLength(), i.getFieldLength(), i.getVFormat(), i.getObscureType(), i.getIsEncryptedField()), vt.setField(i), st = vt) : ut == t.DisplayType.YesNo ? (si = new b(et, ct, lt, at, i.getHeader(), i.getDescription(), i.getIsSwitch()), si.setField(i), st = si) : t.DisplayType.IsDate(ut) ? (ut == t.DisplayType.DateTime && (readOnly = !0), ui = new k(et, ct, lt, at, ut, i.getHeader()), ui.setName(et), ui.setField(i), st = ui) : t.DisplayType.IsLookup(ut) || t.DisplayType.ID == ut ? (wt = i.getLookup(), rt && wt != null && wt.disableValidation(), rt ? wt == null || ut != t.DisplayType.Search && wt.getDisplayType() != t.DisplayType.Search ? (bt = new o(et, ct, lt, at, wt, i.getDisplayLength(), ut, i.getZoomWindow_ID()), bt.setDisplayType(ut), bt.setField(i), st = bt) : (ut = t.DisplayType.Search, kt = new s(et, ct, lt, at, ut, wt, i.getZoomWindow_ID()), kt.setField(i), st = kt) : ut != t.DisplayType.Search && ut != t.DisplayType.MultiKey && ut != t.DisplayType.ProductContainer ? (bt = new o(et, ct, lt, at, wt, i.getDisplayLength(), ut, i.getZoomWindow_ID()), bt.setField(i), st = bt) : ut == t.DisplayType.ProductContainer ? (yt = new p(et, ct, lt, at, ut, i.getLookup(), pt), yt.setField(i), st = yt) : (kt = new s(et, ct, lt, at, ut, wt, i.getZoomWindow_ID()), kt.setField(i), st = kt)) : ut == t.DisplayType.Location ? (hi = new g(et, ct, lt, at, ut, i.getLookup(), wi), hi.setField(i), st = hi) : ut == t.DisplayType.Locator ? (ci = new c(et, ct, lt, at, ut, i.getLookup()), ci.setField(i), st = ci) : t.DisplayType.Text == ut || t.DisplayType.TextLong == ut || t.DisplayType.Memo == ut ? (li = new ft(et, ct, lt, at, i.getDisplayLength(), i.getFieldLength(), ut), li.setField(i), st = li) : t.DisplayType.IsNumeric(ut) ? t.DisplayType.Amount == ut || t.DisplayType.Quantity == ut || t.DisplayType.CostPrice == ut ? (ni = new h(et, ct, lt, at, i.getDisplayLength(), i.getFieldLength(), ut, "FixedHeader"), ni.setMinValue(fi), ni.setMaxValue(ei), ni.setField(i), st = ni) : t.DisplayType.Integer == ut ? (ai = new d(et, ct, lt, at, i.getDisplayLength(), i.getFieldLength(), "FixedHeader"), ai.setField(i), st = ai) : t.DisplayType.Number == ut ? (ti = new h(et, ct, lt, at, i.getDisplayLength(), i.getFieldLength(), ut, "FixedHeader"), ti.setField(i), ti.setMinValue(fi), ti.setMaxValue(ei), st = ti) : ut == t.DisplayType.ProgressBar && (ii = new e(et, ct, lt, at, i.getDisplayLength(), i.getFieldLength(), ut), ii.setField(i), ii.setMinValue(fi), ii.setMaxValue(ei), st = ii) : ut == t.DisplayType.PAttribute ? (dt = new f(et, ct, lt, at, ut, i.getLookup(), pt, !1, !1, !1, !0, oi), dt.setField(i), st = dt) : ut == t.DisplayType.GAttribute ? (dt = new f(et, ct, lt, at, ut, i.getLookup(), pt, !1, !1, !1, !1, oi), dt.setField(i), st = dt) : ut == t.DisplayType.Account ? (vi = new nt(et, ct, lt, at, ut, i.getLookup(), pt, i.getHeader()), vi.setField(i), st = vi) : ut == t.DisplayType.Binary ? (yi = new v(et, ct, lt, at, pt), yi.setField(i), st = yi) : ut == t.DisplayType.Image ? (pi = new l(et, ct, lt, pt), pi.setField(i), st = pi) : ut == t.DisplayType.URL ? (gt = new tt(et, ct, lt, at, i.getDisplayLength(), i.getFieldLength()), gt.setField(i), st = gt) : ut == t.DisplayType.FileName || ut == t.DisplayType.FilePath ? (gt = new y(et, ct, lt, at, pt, ut), gt.setField(i), st = gt) : ut == t.DisplayType.Label ? (vt = new ht(i.getHelp(), et, !1, !0), vt.setField(i), st = vt) : ut == t.DisplayType.AmtDimension ? (yt = new it(et, ct, lt, at, ut, i.getLookup(), pt), yt.setField(i), yt.setDefaultValue(i.vo.DefaultValue), st = yt) : ut == t.DisplayType.ProductContainer && (yt = new p(et, ct, lt, at, ut, i.getLookup(), pt), yt.setField(i), st = yt), st == null && (vt = new a(et, ct, lt, at, i.getDisplayLength(), i.getFieldLength(), i.getVFormat(), i.getObscureType(), i.getIsEncryptedField()), vt.setField(i), st = vt), st }, getLabel: function (n) { if (n == null) return null; var i = n.getDisplayType(); return n.getIsFieldOnly() || i == t.DisplayType.YesNo || i == t.DisplayType.Button || i == t.DisplayType.Label ? null : new t.Controls.VLabel(n.getHeader(), n.getColumnName(), n.getIsMandatory()) }, getHeaderLabel: function (n) { if (n == null) return null; var i = n.getDisplayType(); return n.getHeaderIconOnly() && n.getHeaderHeadingOnly() || n.getHeaderIconOnly() || i == t.DisplayType.Button || i == t.DisplayType.Label ? null : new t.Controls.VLabel(n.getHeader(), n.getColumnName(), n.getIsMandatory()) }, getReadOnlyControl: function (n, i) { var u, h, o; if (!i) return null; var s = i.getColumnName(), c = i.getIsMandatory(!1), a = i.getWindowNo(), f = i.getOrginalDisplayType(), v = i.getIsReadOnly(), y = i.getIsEditable(!1), e = null; return f == t.DisplayType.Image ? (u = new l(s, c, !0, a), u.setDimension(120, 140), u.hideText(), u.hideEditIcon(), e = u) : f == t.DisplayType.Button ? (h = new r(s, c, v, y, i.getHeader(), i.getDescription(), i.getHelp(), i.getAD_Process_ID(), i.getIsLink(), i.getIsRightPaneLink(), i.getAD_Form_ID(), i.getIsBackgroundProcess(), i.getAskUserBGProcess()), h.setField(i, !0), e = h) : (o = new ut(i.getHelp(), s, !1, !0), o.setField(i), t.DisplayType.IsNumeric(f) && (o.format = t.DisplayType.GetNumberFormat(f)), e = o), e }, getIcon: function (n) { return n.getFontClass() ? "<i class='" + n.getFontClass() + "'> <\/i>" : n.getAD_Image_ID() > 0 ? "<img src='" + t.Application.contextUrl + "Images/Thumb16x16/" + n.getAD_Image_ID() + ".jpg' > " : void 0 } }; i.prototype.getControl = function () { return this.ctrl }; i.prototype.getRoot = function () { return this.root ? this.root : this.ctrl }; i.prototype.getField = function () { return this.mField }; i.prototype.getName = function () { return this.colName }; i.prototype.getColumnName = function () { return this.colName }; i.prototype.getIsMandatory = function () { return this.isMandatory }; i.prototype.getIsReadonly = function () { return this.readOnly }; i.prototype.getDisplayType = function () { return this.displayType }; i.prototype.getIsVisible = function () { return this.visible }; i.prototype.getValue = function () { return this.ctrl.val() }; i.prototype.getDisplay = function () { return this.ctrl.val() }; i.prototype.getBtnCount = function () { return 0 }; i.prototype.setName = function (n, t) { t ? this.name = t + n : this.colName = n }; i.prototype.setField = function (n) { this.mField = n }; i.prototype.setValue = function () { }; i.prototype.setVisible = function (n) { this.visible = n; n ? this.ctrl.show() : this.ctrl.hide() }; i.prototype.setReadOnly = function (n) { this.isReadOnly = n; this.ctrl.prop("disabled", n ? !0 : !1); this.setBackground(!1) }; i.prototype.setHtmlStyle = function (n) { n && this.dynStyle != n ? (n.contains(":") ? (this.dynStyle || (this.oldStyle = this.ctrl.attr("style")), this.ctrl.removeAttr(n).attr("style", n)) : this.ctrl.addClass(n), this.dynStyle = n) : !n && this.dynStyle && (this.dynStyle.contains(":") ? (this.ctrl.removeAttr("style"), this.oldStyle && this.ctrl.attr("style", this.oldStyle)) : this.ctrl.removeClass(this.dynStyle), this.oldStyle = null, this.dynStyle = null) }; i.prototype.setDefaultFocus = function (n) { n && this.ctrl.focus() }; i.prototype.setMandatory = function (n) { this.isMandatory = n; this.setBackground(!1) }; i.prototype.setBackground = function (n) { if (!this.colName.startsWith("lbl") && this.displayType != t.DisplayType.Label && this.displayType != t.DisplayType.YesNo && this.displayType != t.DisplayType.Button) if (typeof n == "boolean") if (n) this.setBackground("vis-ev-col-error"); else if (this.isReadOnly) this.setBackground("vis-ev-col-readonly"); else if (this.isMandatory) { var i = this.getValue(); if (i && i.toString().length > 0) { this.setBackground(""); return } this.setBackground("vis-ev-col-mandatory") } else this.setBackground(""); else { if (this.activeClass == n) return; this.ctrl.removeClass("vis-ev-col-error"); this.ctrl.removeClass("vis-ev-col-readonly"); this.ctrl.removeClass("vis-ev-col-mandatory"); n.length > 0 && this.ctrl.addClass(n); this.activeClass = n } }; i.prototype.setDisplayType = function (n) { this.displayType = n }; i.prototype.addVetoableChangeListener = function (n) { this.vetoablechangeListner = n }; i.prototype.fireValueChanged = function (n, t) { if (this.isReadOnly) { var i = this.oldValue; this.oldValue = ""; this.setValue(i); return } this.editingGrid && (this.gridPos.dialog || t) ? window.setTimeout(function (t) { t.ctrl.parent().length != 0 && t.ctrl.detach(); t.editingGrid.editChange.call(t.editingGrid, t.ctrl[0], t.gridPos.index, t.gridPos.col, n, n.newValue); t.oldValue == n.newValue && t.vetoablechangeListner.vetoablechange(n); t = null; n = null }, 10, this) : this.vetoablechangeListner && !this.editingGrid && window.setTimeout(function (t) { t.vetoablechangeListner.vetoablechange(n); t = null; n = null }, 10, this) }; i.prototype.fireRefreshUI = function (n) { this.vetoablechangeListner && window.setTimeout(function (t) { t.vetoablechangeListner.refreshUI(n); t = null; n = null }, 10, this) }; i.prototype.addActionListner = function (n) { this.actionListner = n }; i.prototype.invokeActionPerformed = function (n) { this.actionListner && this.actionListner.actionPerformed(n) }; i.prototype.init = function () { }; i.prototype.detach = function () { this.ctrl.detach() }; i.prototype.dispose = function () { console.log("dispose "); this.ctrl.remove(); this.ctrl = null; this.mField = null; this.displayType = null; this.isReadOnly = null; this.colName = null; this.isMandatory = null; this.oldValue = null; this.vetoablechangeListner = null; this.actionListner = null; this.disposeComponent() }; t.Utility.inheritPrototype(a, i); a.prototype.setReadOnly = function (n, t) { n || !this.obscureType || t || this.mField.getIsInserting() && this.ctrl.val() == "" || (n = !0); this.isReadOnly = n; this.ctrl.prop("disabled", n ? !0 : !1); this.setBackground(!1) }; a.prototype.setValue = function (n) { this.oldValue != n && (this.obscureType && (!this.mField.getIsInserting() || this.ctrl.val() != "") ? (this.ctrl.val(t.Env.getObscureValue(this.obscureType, n)), this.setReadOnly(!0)) : this.ctrl.val(n), this.oldValue = n) }; a.prototype.getDisplay = function () { return this.ctrl.val() }; t.Utility.inheritPrototype(ht, i); t.Utility.inheritPrototype(ut, i); ut.prototype.setValue = function (n, i) { this.oldValue != n && (this.oldValue = n, this.mField.getDisplayType() == t.DisplayType.TelePhone && n && n != "- -" ? this.ctrl.html(t.VTelePhoneInstance.getHtml(n)) : (this.ctrl.text(n), i && this.ctrl.html(n))) }; ut.prototype.getValue = function () { return this.value != null ? this.ctrl.text().toString() : null }; t.Utility.inheritPrototype(r, i); r.prototype.referenceList = {}; r.prototype.setField = function (n, i) { this.mField = n; n.getShowIcon() && (n.getFontClass() != "" || n.getImageName() != "") && (n.getFontClass() != "" ? this.setIcon(n.getFontClass()) : this.setIcon(t.Application.contextUrl + "Images/Thumb16x16/" + n.getImageName(), !0)); this.setLayout(i) }; r.prototype.setReferenceKey = function (n) { n && n > 0 && n != 195 && n != 135 && n != 234 && n != 435 && this.readReference(n) }; r.prototype.setValue = function (n) { var i, r; this.value = n; i = this.text; n == null || this.colName.equals("Record_ID") || (this.values != null ? i = this.values[n] : this.lookup != null && (r = this.lookup.get(n), r != null && (i = r.getName()))); i || (i = t.Msg.getMsg("Invalid") + " { '" + n + "' }"); this.setText(i != null ? i : "") }; r.prototype.setReadOnly = function (n) { this.isReadOnly = n; this.dynStyle && this.dynStyle.indexOf("opacity") > -1 || this.ctrl.css("opacity", n ? .6 : 1); this.isLink || this.ctrl.prop("disabled", n ? !0 : !1); this.setBackground(!1) }; r.prototype.getValue = function () { return this.value != null ? this.value.toString() : null }; r.prototype.getDisplay = function () { return this.value }; r.prototype.readReference = function (n) { var r, u, i; if (this.values = null, this.referenceList && (this.values = this.referenceList[n]), this.values) return this.values; this.values = {}; r = t.Env.isBaseLanguage(t.Env.getCtx(), "") ? "VIS_82" : "VIS_148"; u = []; u[0] = new t.DB.SqlParam("@AD_Reference_ID", n); try { for (i = w(r, u); i.read();)this.values[i.getString(0)] = i.getString(1); this.referenceList[n] = this.values; i.close() } catch (f) { t.Logging.VLogger.getVLogger().get().log(t.Logging.Level.SEVERE, r, f) } }; r.prototype.getProcess_ID = function () { return this.AD_Process_ID }; r.prototype.getAD_Form_ID = function () { return this.AD_Form_ID }; r.prototype.getDescription = function () { return this.description }; r.prototype.getHelp = function () { return this.help }; r.prototype.getAskUserBGProcess = function () { return this.askUserBGProcess }; r.prototype.getIsBackgroundProcess = function () { return this.isBackgroundProcess }; t.Utility.inheritPrototype(b, i); b.prototype.setValue = function (n) { this.oldValue != n && (this.oldValue = n, this.cBox.prop("checked", n)) }; b.prototype.getValue = function () { return this.cBox.prop("checked") }; b.prototype.getDisplay = function () { return this.cBox.prop("checked").toString() }; t.Utility.inheritPrototype(o, i); o.prototype.setValue = function (n, i) { var u, f, r, e; if (this.oldValue != n) { if (this.settingValue = !0, this.oldValue = n, this.ctrl.val(n), n == null) { this.lastDisplay = ""; this.settingValue = !1; return } if (this.lookup == null) { this.lastDisplay = n.toString(); this.settingValue = !1; return } if (this.lastDisplay = this.lookup.getDisplay(n, !0), this.lastDisplay.equals("<-1>") && (this.lastDisplay = "", this.oldValue = null), this.inserting = i, u = this.lastDisplay.startsWith("<") && this.lastDisplay.endsWith(">"), f = this.ctrl.val(), f == null || this.inserting && this.lookup.getDisplayType() != t.DisplayType.Search) { if (u && this.lookup.loading) { window.setTimeout(function (t) { t.setValue(n, i); t = null; return }, 500, this); this.oldValue = "oldValue"; return } u && (this.lastDisplay = this.lookup.getDisplay(n, !1), u = this.lastDisplay.startsWith("<") && this.lastDisplay.endsWith(">")); u ? (this.oldValue = "old", this.ctrl.val(null), this.inserting && this.ctrl.trigger("change")) : this.ctrl.val() == null && (this.inserting && !this.lookup.info.isParent && this.lookup.getIsValidated() && this.lookup.allLoaded ? (this.lookup.fillCombobox(this.getIsMandatory(), !1, !1, !1), this.lookup.loading || this.refreshOptions(this.lookup.data, n)) : (r = null, this.lookup.loading || (r = this.lookup.getFromList(n)), r == null && (r = this.lookup.get(n)), r != null && (e = t.Utility.Util.getIdentifierDisplayVal(r.Name), this.ctrl.append('<option value="' + r.Key + '">' + e + "<\/option>"), this.ctrl.val(n)))); this.ctrl.val() == null && n != null && (this.oldValue = null) } this.settingValue = !1 } this.inserting = !1 }; o.prototype.getDisplayValue = function (n) { var t = ""; return n.indexOf("Images/") > -1 ? (t = n.replace("^^" + n.substring(n.indexOf("Images/"), n.lastIndexOf("^^") + 3), "_"), t.indexOf("Images/") > -1 && (t = t.replace(t.substring(t.indexOf("Images/"), t.lastIndexOf("^^") + 3), "_"))) : t = n, t }; o.prototype.getValue = function () { var n = this.ctrl.val(); return n == "-1" ? null : n }; o.prototype.refreshOptions = function (n, i) { for (var e, u = [], f = -1, r = 0; r < n.length; r++)i && i == n[r].Key && (f = r), e = t.Utility.Util.getIdentifierDisplayVal(n[r].Name), u[r] = '<option value="' + n[r].Key + '">' + e + "<\/option>"; this.ctrl.empty(); this.ctrl.html(u.join("")); this.ctrl[0].selectedIndex = f }; o.prototype.getDisplay = function () { return this.lookup == null ? this.ctrl.val() : this.lookup.getDisplay(this.ctrl.val()) }; t.Utility.inheritPrototype(k, i); k.prototype.setValue = function (n) { var i, f, e, r, u; if (this.oldValue != n) { if (this.oldValue = n, n == null || n == "") { this.ctrl.val(""); return } i = new Date(n); this.displayType != t.DisplayType.Date && i.setMinutes(-i.getTimezoneOffset() + i.getMinutes()); n = i.toISOString(); f = n.substring(0, n.length - 1); e = n.indexOf("T"); this.displayType == t.DisplayType.DateTime ? this.ctrl.val(f) : this.displayType == t.DisplayType.Date ? this.ctrl.val(f.substring(0, e)) : (r = i.getUTCHours(), u = i.getUTCMinutes(), this.ctrl.val((r < 10 ? "0" + r : r) + ":" + (u < 10 ? "0" + u : u))) } }; k.prototype.getValue = function () { var i = this.ctrl.val(), n; if (i == null || i == "") return null; if (n = null, this.displayType == t.DisplayType.Time) { n = new Date(0); n.setYear(1990); var r = i.match(/(\d+)\:(\d+)/), u = parseInt(r[1], 10), f = parseInt(r[2], 10); n.setHours(u); n.setMinutes(f) } else n = new Date(i + "Z"); try { return this.displayType == t.DisplayType.DateTime && n.setMinutes(n.getTimezoneOffset() + n.getMinutes()), n.toISOString().replace(".000Z", "Z") } catch (e) { return console.log(i), new Date } }; k.prototype.getDisplay = function () { return this.getValue() }; t.Utility.inheritPrototype(s, i); s.prototype.setValue = function (n, i, r) { var s, e, o, h, f, c, u; if (this.oldValue != n || i) { if (this.settingValue = !0, this.oldValue = n, this.value = n, n == null) { this.lastDisplay = ""; this.ctrl.val(""); this.settingValue = !1; r && (u = { newValue: n, propertyName: this.getName() }, this.fireValueChanged(u), u = null); return } if (this.lookup == null) { this.ctrl.val(n.toString()); this.lastDisplay = n.toString(); this.settingValue = !1; return } if (this.displayType !== t.DisplayType.MultiKey) this.lastDisplay = this.lookup.getDisplay(n); else { for (s = n.toString().split(","), e = "", o = 0, h = s.length; o < h; o++) { if (f = s[o], isNaN(f) || (f = Number(f)), e.length == 0) { e += this.lookup.getDisplay(f); continue } e += ", " + this.lookup.getDisplay(f) } this.lastDisplay = e } this.lastDisplay.equals("<-1>") && (this.lastDisplay = "", this.oldValue = null, this.value = null); this.value = n; c = t.Utility.Util.getIdentifierDisplayVal(this.lastDisplay); this.ctrl.val(t.Utility.decodeText(c)); this.settingValue = !1; r && ((n == -1 || n == "") && (n = null), u = { newValue: n, propertyName: this.getName() }, this.fireValueChanged(u), u = null) } else n == null && this.ctrl.val("") }; s.prototype.getValue = function () { return this.value }; s.prototype.getMultipleIds = function () { return this.infoMultipleIds }; s.prototype.getDisplay = function () { return this.lookup == null ? this.value : this.lookup.getDisplay(this.value) }; s.prototype.setCustomInfo = function (n) { n != null && (this.custInfoWin = n) }; t.Utility.inheritPrototype(ft, i); ft.prototype.setValue = function (n) { this.oldValue != n && (this.oldValue = n, this.ctrl.val(n)) }; ft.prototype.getDisplay = function () { return this.ctrl.val() }; t.Utility.inheritPrototype(h, i); h.prototype.setValue = function (n) { if (this.oldValue != n) { this.oldValue = n; n = this.format.GetFormatedValue(n); this.ctrl.attr("type", "text"); var t = this.format.GetFormatAmount(n, "init", this.dotFormatter); this.ctrl.val(t) } }; h.prototype.getValue = function () { var n = this.$super.getValue.call(this); return (n = this.format.GetConvertedNumber(n, this.dotFormatter), isNaN(n) || n === null) ? null : Number(n) }; h.prototype.getDisplay = function () { return this.ctrl.val() }; h.prototype.setMaxValue = function (t) { n.isNumeric(t) && this.ctrl.attr("max", t) }; h.prototype.setMinValue = function (t) { n.isNumeric(t) && this.ctrl.attr("min", t) }; t.Utility.inheritPrototype(d, i); d.prototype.setValue = function (n) { this.oldValue != n && (this.oldValue = n, this.ctrl.val(n)) }; d.prototype.getValue = function () { var n = this.$super.getValue.call(this); return n === null ? null : (this.editingGrid && (n = this.format.GetFormatedValue(n)), n) }; d.prototype.getDisplay = function () { return this.ctrl.val() }; t.Utility.inheritPrototype(g, i); g.prototype.setValue = function (n) { if (this.oldValue != n) { if (this.settingValue = !0, this.oldValue = n, this.value = n, n == null) { this.lastDisplay = ""; this.ctrl.val(""); this.settingValue = !1; return } if (this.lookup == null) { this.ctrl.val(n.toString()); this.lastDisplay = n.toString(); this.settingValue = !1; return } this.lastDisplay = this.lookup.getDisplay(n); this.lastDisplay.equals("<-1>") && (this.lastDisplay = "", this.oldValue = null, this.value = null); this.value = n; this.ctrl.val(t.Utility.decodeText(this.lastDisplay)); this.settingValue = !0 } }; g.prototype.getValue = function () { return this.value }; g.prototype.getDisplay = function () { return this.lookup == null ? this.value : this.lookup.getDisplay(this.value) }; t.Utility.inheritPrototype(c, i); c.prototype.getOnlyWarehouseID = function () { var r = t.Env.getCtx(), u = r.getContext(this.windowNum, "0|AD_Table_ID", !0), n, i; if ("572" == u) return 0; n = r.getContext(this.windowNum, "M_Warehouse_ID", !0); i = 0; try { n != null && n.length > 0 && (i = Number(n)) } catch (f) { } return i }; c.prototype.getOnlyProductID = function () { var r = t.Env.getCtx(), u = r.getContext(this.windowNum, "0|AD_Table_ID", !0), n, i; if ("572" == u) return 0; n = r.getContext(this.windowNum, "M_Product_ID", !0); i = 0; try { n != null && n.length > 0 && (i = Number(n)) } catch (f) { } return i }; c.prototype.showLocatorForm = function (n, i) { var u = 0, r; this.value != null && (u = Number(this.value)); this.lookup.setOnlyWarehouseID(n); this.lookup.setOnlyProductID(i); var f = "Y".equals(t.context.getWindowContext(this.windowNum, "IsReturnTrx")), e = t.Env.getCtx().isSOTrx(this.windowNum), o = (e && !f || !e && f) && this.columnName == "M_Locator_ID"; this.lookup.setOnlyOutgoing(o); this.lookup.refresh(); self = this; r = new t.LocatorForm(this.columnName, this.lookup, u, this.mandatory, n, this.windowNum); r.load(); r.showDialog(); r.onClose = function (n) { if (self.oldValue != n) { self.setValue(n); var t = { newValue: n, propertyName: self.columnName }; self.fireValueChanged(t); t = null } } }; c.prototype.setValue = function (n) { if (this.oldValue != n) { if (this.settingValue = !0, this.oldValue = n, this.value = n, n == null) { this.lastDisplay = ""; this.ctrl.val(""); this.settingValue = !1; return } if (this.lookup == null) { this.ctrl.val(n.toString()); this.lastDisplay = n.toString(); this.settingValue = !1; return } this.lastDisplay = this.lookup.getDisplay(n); this.lastDisplay.equals("<-1>") && (this.lastDisplay = "", this.oldValue = null, this.value = null); this.value = n; this.ctrl.val(this.lastDisplay); this.settingValue = !0 } }; c.prototype.getValue = function () { return this.value }; c.prototype.getDisplay = function () { return this.lookup == null ? this.value : this.lookup.getDisplay(this.value) }; t.Utility.inheritPrototype(f, i); f.prototype.setValue = function (n) { (n == null || 0 === n) && (this.ctrl.text(""), this.value = n); this.value = n; this.ctrl.val(this.lookup.getDisplay(n)) }; f.prototype.setField = function (n) { n != null && (this.windowNo = n.getWindowNo(), this.AD_Column_ID = n.getAD_Column_ID()); this.mField = n }; f.prototype.getValue = function () { return this.value }; f.prototype.genSetInstanceIDs = function () { return this.setInstanceIDs }; f.prototype.getDisplay = function () { return this.ctrl.val() }; f.prototype.getCanSaveRecord = function () { return this.canSaveRecord }; f.prototype.setCanSaveRecord = function (n) { return this.canSaveRecord = n }; t.Utility.inheritPrototype(nt, i); nt.prototype.setValue = function (n) { this.oldValue != n && (this.oldValue = n, this.value = n, this.ctrl.val(this.lookup.getDisplay(n))) }; nt.prototype.getValue = function () { return this.value }; nt.prototype.getDisplay = function () { return this.ctrl.val() }; t.Utility.inheritPrototype(l, i); l.prototype.setValue = function (n) { if (this.oldValue != n) { if (this.oldValue = n, this.value = n, n == null) { this.setIcon(null); this.value = 0; this && this.ctrl.val(null); return } this.refreshImage(n) } }; l.prototype.refreshImage = function (i) { var r = this; n.ajax({ url: t.Application.contextUrl + "VImageForm/GetImageAsByte", dataType: "json", data: { ad_image_id: i }, success: function (n) { var n = JSON.parse(n); n ? r.setIcon(n.Bytes, n.Path) : r.setIcon(null, null); r.ctrl.val(i); r = null } }) }; l.prototype.setReadOnly = function (n) { this.isReadOnly = n; this.isLink ? this.ctrl.css("opacity", n ? .6 : 1) : this.ctrl.prop("disabled", n ? !0 : !1); this.setBackground(!1) }; l.prototype.getValue = function () { return this.value }; l.prototype.getDisplay = function () { return this.value }; t.Utility.inheritPrototype(v, i); v.prototype.setValue = function (n) { var t, i; this.oldValue != n && (this.oldValue = n, n == null ? (this.setText("-"), this.value = n, this.ctrl.val(n)) : (t = "?", n.length > 0 ? (i = n, t = "#" + i.length) : t = n.GetType().FullName, this.setText(t != null ? t : ""), this.value = n, this.ctrl.val(n))) }; v.prototype.setReadOnly = function (n) { this.isReadOnly = n; this.ctrl.prop("disabled", n ? !0 : !1); this.setBackground(!1) }; v.prototype.getValue = function () { return this.value }; v.prototype.getDisplay = function () { return this.value }; t.Utility.inheritPrototype(tt, i); tt.prototype.setValue = function (n) { if (this.oldValue != n) { if (this.oldValue = n, this.value = n, n == null) { this.lastDisplay = ""; this.ctrl.val(""); return } this.value = n; this.ctrl.val(n); this.ctrl.val(n) } }; tt.prototype.getValue = function () { return this.value }; tt.prototype.getDisplay = function () { return this.ctrl.val() }; t.Utility.inheritPrototype(y, i); y.prototype.setValue = function (n) { this.oldValue != n && (this.oldValue = n, this.value = n, this.ctrl.val(n)) }; y.prototype.setReadOnly = function (n) { this.isReadOnly = n; this.ctrl.prop("disabled", n ? !0 : !1); this.setBackground(!1) }; y.prototype.getValue = function () { return this.value }; y.prototype.getDisplay = function () { return this.value }; t.Utility.inheritPrototype(it, i); it.prototype.setValue = function (n) { if (this.oldValue != n) { if (this.settingValue = !0, this.oldValue = n, this.value = n, n == null) { this.lastDisplay = ""; this.ctrl.val(""); this.settingValue = !1; return } if (this.lookup == null) { this.ctrl.val(n.toString()); this.lastDisplay = n.toString(); this.settingValue = !1; return } if (this.lastDisplay = this.lookup.getDisplay(n), this.lastDisplay && this.lastDisplay.equals("<-1>") && (this.lastDisplay = "", this.oldValue = null, this.value = null), this.value = this.lastDisplay && this.lastDisplay.indexOf("<") > -1 ? this.lastDisplay : n, this.lastDisplay) { var t = this.format.GetFormatedValue(this.lastDisplay); this.ctrl.val(this.format.GetFormatAmount(t, "init", this.dotFormatter)) } this.settingValue = !0 } }; it.prototype.getValue = function () { return this.value }; it.prototype.getDisplay = function () { return this.lookup == null ? this.value : this.lookup.getDisplay(this.value) }; t.Utility.inheritPrototype(p, i); p.prototype.setValue = function (n, i, r) { if (this.oldValue != n) { if (this.settingValue = !0, this.oldValue = n, this.value = n, n == null) { if (this.lastDisplay = "", this.ctrl.val(""), this.settingValue = !1, r) { var u = { newValue: n, propertyName: this.getName() }; this.fireValueChanged(u); u = null } return } if (this.lookup == null) { this.ctrl.val(n.toString()); this.lastDisplay = n.toString(); this.settingValue = !1; return } this.lastDisplay = this.lookup.getDisplay(n); this.lastDisplay.equals("<-1>") && (this.lastDisplay = "", this.oldValue = null, this.value = null); this.value = this.lastDisplay.indexOf("<") > -1 ? this.lastDisplay : n; this.ctrl.val(t.Utility.decodeText(this.lastDisplay)); this.settingValue = !0 } }; p.prototype.getValue = function () { return this.value }; p.prototype.getDisplay = function () { return this.lookup == null ? this.value : this.lookup.getDisplay(this.value) }; t.Utility.inheritPrototype(et, i); et.prototype.setValue = function (i, r, u) { var f = null, s = [], h, o, c, e; if (this.needtoParse) if (u && !n.isEmptyObject(u)) { for (s = t.Env.parseSQLFromRecords(this.colSql, u), h = 0; h < s.length > 0; h++)this.colSql = this.colSql.replace("@" + s[h].Key + "@", s[h].Value); f = this.colSql } else s = t.Env.parseContext2(t.context, this.windowNo, 0, this.colSql, !1, !0), f = t.Env.parseContext(t.context, this.windowNo, 0, this.colSql, !1, !0); else f = this.colSql; if (f && f.length != 0) if (o = "-1", c = f.toUpperCase().lastIndexOf("WHERE"), c > -1 && (o = f.substring(c)), this.cache[o]) this.ctrl.text(this.cache[o]), r && this.ctrl.html(this.cache[o]); else { if (f.toLowerCase().indexOf("select") == -1) { this.cache[o] = f; this.ctrl.text(f); return } e = this; n.ajax({ type: "Post", url: t.Application.contextUrl + "Form/GetKeyText", data: { Validation: JSON.stringify(s), AD_HeaderItem_ID: e.headerItemID }, success: function (n) { var i = JSON.parse(n); i || i == 0 ? (e.frmat && (i = e.frmat.GetFormatAmount(e.frmat.GetFormatedValue(i), "init", t.Env.isDecimalPoint())), e.ctrl.text(i)) : e.ctrl.text(""); e.isExe || (e.cache[o] = i) } }) } }; et.prototype.getValue = function () { return this.value != null ? this.ctrl.text().toString() : null }; t.Utility.inheritPrototype(e, i); e.prototype.setValue = function (n) { this.oldValue != n && (this.oldValue = n, this.setText(n), this.setRange(n)) }; e.prototype.getValue = function () { return this.getRange() }; e.prototype.setMaxValue = function (t) { n.isNumeric(t) ? this.rangeCtrl.attr("max", t) : this.rangeCtrl.attr("max", 100) }; e.prototype.setMinValue = function (t) { n.isNumeric(t) && this.rangeCtrl.attr("min", t) }; e.prototype.getDisplay = function () { return this.rangeCtrl.val() }; e.prototype.getControl = function (n) { return n ? (n.addClass("vis-progressCtrlWrap"), n.append(this.oputput), this.rangeCtrl) : this.ctrl }; e.prototype.setReadOnly = function (n) { this.isReadOnly = n; this.ctrl.find("input").prop("disabled", n ? !0 : !1); this.ctrl.find("output").attr("contenteditable", n ? !1 : !0); this.setBackground(!1) }; e.prototype.setHtmlStyle = function (n) { n && this.dynStyle != n ? (n.contains(":") ? (this.dynStyle || (this.oldStyle = this.ctrl.find("input").attr("style")), this.ctrl.find("input").removeAttr(n).attr("style", n), this.ctrl.find("output").removeAttr(n).attr("style", n)) : (this.ctrl.find("input").addClass(n), this.ctrl.find("output").addClass(n)), this.dynStyle = n) : !n && this.dynStyle && (this.dynStyle.contains(":") ? (this.ctrl.find("input").removeAttr("style"), this.ctrl.find("output").removeAttr("style"), this.oldStyle && (this.ctrl.find("input").attr("style", this.oldStyle), this.ctrl.find("output").attr("style", this.oldStyle))) : (this.ctrl.find("input").removeClass(this.dynStyle), this.ctrl.find("output").removeClass(this.dynStyle)), this.oldStyle = null, this.dynStyle = null) }; t.Utility.inheritPrototype(u, i); u.prototype.setReadOnly = function (n, t) { n || !this.obscureType || t || this.mField.getIsInserting() && this.ctrl.val() == "" || (n = !0); this.isReadOnly = n; this.ctrl.prop("disabled", n ? !0 : !1); this.setBackground(!1) }; u.prototype.setValue = function (n) { this.oldValue != n && (this.settingVal = !0, n ? this.iti ? this.iti.setNumber(n) : this.ctrl.val(n) : (this.iti ? this.iti.setNumber("") : this.ctrl.val(""), this.setCountry()), this.settingVal = !1, this.oldValue = n) }; u.prototype.getDisplay = function () { return this.getValue() }; u.prototype.getValue = function () { return this.iti ? this.iti.getNumber() : this.ctrl.val() }; u.prototype.init = function () { this.iti = window.intlTelInput(this.ctrl[0], { initialCountry: "auto", separateDialCode: !0, autoPlaceholder: "aggressive", formatOnDisplay: !0, geoIpLookup: function (n) { window.geoplugin_countryCode ? n(geoplugin_countryCode()) : n("IN") }, utilsScript: rt + "Areas/ViennaBase/Scripts/tel_Input/utils.js?1638200991544" }) }; u.prototype.getControl = function (n) { return n ? (this.isMasked || (this.ctrl.mask("Z0000000000000000", { translation: { "0": { pattern: /\d/ }, "9": { pattern: /\d/, optional: !0 }, Z: { pattern: /[+]/, optional: !0 } } }), this.isMasked = !0), this.ctrl) : this.ctrl }; u.prototype.setCountry = function () { this.iti && (window.geoplugin_countryCode ? this.iti.setCountry(geoplugin_countryCode()) : this.iti.setCountry("IN")) }; u.prototype.getSelectedCountryData = function () { return this.iti ? this.iti.getSelectedCountryData() : { dialCode: "+91", iso2: "en" } }; u.prototype.detach = function () { this.prnt.detach() }; t.Utility.inheritPrototype(ot, i); ot.prototype.setValue = function (n) { this.oldValue != n && (this.ctrl.val(n), this.oldValue = n) }; t.Controls.IControl = i; t.Controls.VTextBox = a; t.Controls.VLabel = ht; t.Controls.VButton = r; t.Controls.VCheckBox = b; t.Controls.VComboBox = o; t.Controls.VTextBoxButton = s; t.Controls.VTextArea = ft; t.Controls.VAmountTextBox = h; t.Controls.VNumTextBox = d; t.Controls.VLocation = g; t.Controls.VDate = k; t.Controls.VLocator = c; t.Controls.VAccount = nt; t.Controls.VPAttribute = f; t.Controls.VImage = l; t.Controls.VBinary = v; t.Controls.VFile = y; t.Controls.VAmtDimension = it; t.Controls.VProductContainer = p; t.Controls.VKeyText = et; t.Controls.VProgressBar = e; t.Controls.VSpan = ut; t.Controls.VTelePhone = u; t.Controls.VColor = ot; t.Controls.VURL = tt; t.VTelePhoneInstance = function () { function r() { if (!i) { var r = new t.Controls.VTelePhone("Mobile", !1, !1, !0, 20, 20, "", null, !1), u = n("<div>").append(r.getControl()); r.init(); u.hide(); n("body").append(u); i = r } } function u(n, t) { var f, u, o, e; return (r(), !n) ? "" : (n.indexOf("+") < 0 && i.setCountry(), i.setValue(n), f = i.iti.getSelectedCountryData(), u = i.getDisplay(), u == "" && (n.indexOf("+") < 0 && (n = "+" + f.dialCode + n), u = n), o = f.iso2, e = '<div style="display:flex"><div class="iti__selected-flag"><div class="iti__flag iti__' + o + '"><\/div><div/><div style="margin: 0 6px;', t && (e += "cursor: pointer;"), e + ('"> ' + u + "<\/div > <\/div>")) } var i = null; return { getHtml: u } }() }(jQuery, VIS), function (n, t) { function h(t, i, r) { var u = null; return n.ajax({ url: s, type: "POST", datatype: "json", contentType: "application/json; charset=utf-8", async: i, data: JSON.stringify(t) }).done(function (n) { u = n; r && r(n) }), u } function i(n) { this.log = t.Logging.VLogger.getVLogger("AccessSqlParser"); this.sqlOriginal; this.sql = []; this.tableInfo = []; this.setSql(n) } function u(n, t) { this.tableName = n; this.synonym = t } function c() { function e(t) { if (t == null) return !1; var i = t.getTableName(); return r.push(i), n.push(t), !0 } function o(t) { var r, i, u; if (t == null) return !1; for (r = !1, i = n.lenght - 1; i >= 0; i--)u = n[i], t === u && (n.splice(1, 1), r = !0); return r } function u() { var r, u, e, t; if (arguments.length == 2) return f(arguments[0], arguments[1]); if (arguments.length == 1) return f(arguments[0]); for (r = 0, u = 0, e = 0; e < n.length; e++)t = n.get(e), t != null && t.lenght > 0 && (i.info(t.toString()), u += t.reset(), r++); return r > 0 && i.info("#" + r + " (" + u + ")"), u } function f(t, f) { var e, o, s, c, h; if (t == null || t.length() == 0) return u(); if (f || (f = 0), r.indexOf(t) < 0) return 0; for (t.equals("AD_Role"), e = 0, o = 0, s = 0; s < n.length; s++)(c = n[s], c != null) && (h = c.reset(t, f), h >= 0 && e++, h > 0 && (o += h)); return e > 0 && i.fine(t + ": #" + e + " (" + o + ")"), o } var n = [], r = [], i = t.Logging.VLogger.getVLogger("CacheMgt"); return { register: e, reset: u, unregister: o } } function r(n, i, r, u, f, e) { this.m_cacheK = []; this.m_cacheV = []; this.m_tableName = n; this.m_resetAll = u ? u : !1; this.m_tableName2 = e; this.setExpireMinutes(r); t.CacheMgt.register(this) } var f = /(\d{4})-(\d{2})-(\d{2})T(\d{2})\:(\d{2})\:(\d{2})/, l = t.Logging.Level, o = t.Application.contextUrl, s = o + "JsonData/JDataSetWithCode", e = function (n, i, r, u) { var o = r ? !0 : !1, e = { sql: n, page: 1, pageSize: 0 }, f; return i && (e.param = i), f = null, h(e, o, function (n) { f = (new t.DB.DataReader).toJson(n); r && r(f) }, u), f }; t.Evaluator = { parseDepends: function (n, t) { var i, r, u; if (t != null && t.length != 0) for (i = t; i.indexOf("@") != -1;)(r = i.indexOf("@"), i = i.substring(r + 1), r = i.indexOf("@"), r != -1) && (u = i.substring(0, r), i = i.substring(r + 1), n.indexOf(u) < 0 && (n[n.length] = u)) }, evaluateLogic: function (n, i) { var u = new t.StringTokenizer(i.trim(), "&|", !0), o = u.countTokens(), r, f, e; if (o / 2 - (o + 1) / 2 == 0) return !1; for (r = this.evaluateLogicDouble(n, u.nextToken()); u.hasMoreTokens();)if (f = u.nextToken().trim(), e = this.evaluateLogicDouble(n, u.nextToken()), f.equals("&")) r = r && e; else if (f.equals("|")) r = r || e; else return !1; return r }, evaluateLogicDouble: function (n, i) { var o = new t.StringTokenizer(i.trim(), "!=^><", !0), e, u; if (o.countTokens() !== 3) return !1; e = o.nextToken().trim(); u = e.trim(); e.indexOf("@") != -1 && (e = e.replaceAll("@", " ").trim(), u = n.getValueAsString(e), u == null && (u = "")); u = u.replaceAll("'", " ").replaceAll('"', " ").trim(); var s = o.nextToken(), f = o.nextToken(), r = f.trim(); return f.indexOf("@") != -1 && f[0] == "@" && f[f.length - 1] == "@" && (f = f.replaceAll("@", " ").trim(), r = n.getValueAsString(f), r == null && (r = "")), r = r.replaceAll("'", " ").replaceAll('"', " ").trim(), e.indexOf("_ID") != -1 && u.length == 0 && (u = "0"), f.indexOf("_ID") != -1 && r.length == 0 && (r = "0"), u == "0" && (r == "" || r == "null") && (r = "0"), u.length == 0 && r == "null" && (r = ""), this.evaluateLogicTuple(u, s, r) }, evaluateLogicTuple: function (n, t, i) { if (n == null || t == null || i == null) return !1; var r = 0, u = 0; try { n.startsWith("'") || isNaN(n) || (r = Number(n)); i.startsWith("'") || isNaN(i) || (u = Number(i)) } catch (f) { r = 0; u = 0 } return t.equals("=") ? r != 0 && u != 0 ? r.compareTo(u) == 0 : n.compareTo(i) == 0 : t.equals("<") ? r != 0 && u != 0 ? r.compareTo(u) < 0 : n.compareTo(i) < 0 : t.equals(">") ? r != 0 && u != 0 ? r.compareTo(u) > 0 : n.compareTo(i) > 0 : r != 0 && u != 0 ? r.compareTo(u) != 0 : n.compareTo(i) != 0 }, getVariables: function (n) { for (var u = [], f = new StringBuilder, r = new t.StringTokenizer(n, "@"), i; r.hasMoreTokens();)f.append(r.nextToken()), r.hasMoreTokens() && (f.append("?"), i = r.nextToken(), i.indexOf("|") != -1 && (i = i.substring(0, i.indexOf("|"))), u.indexOf(i) === -1 && u.push(i)); return u }, replaceVariables: function (n, t, i) { var u = n, h = [], e, f, r, o, s; for (this.parseDepends(h, n), e = 0; e < h.length; e++) { if (f = h[e], f.indexOf("\n") != -1) break; if (r = null, i != null && (r = i.get(f)), r == null && (r = t.getContext(f)), r != null && r.length > 0) { o = null; try { o = new Number(r) } catch (c) { } if (o != null) u = u.replaceAll("@" + f + "@", o.toString()); else { s = null; try { s = new Double(r) } catch (c) { } u = s != null ? u.replaceAll("@" + f + "@", s.toString()) : u.replaceAll("@" + f + "@", r.replaceAll("'", "''")) } } else u = u.replaceAll("@" + f + "@", "NULL") } return u }, evaluateLogicByRowData: function (n, i) { var u = new t.StringTokenizer(i.trim(), "&|", !0), o = u.countTokens(), r, f, e; if (o / 2 - (o + 1) / 2 == 0) return !1; for (r = this.evaluateLogicByRowDouble(n, u.nextToken()); u.hasMoreTokens();)if (f = u.nextToken().trim(), e = this.evaluateLogicByRowDouble(n, u.nextToken()), f.equals("&")) r = r && e; else if (f.equals("|")) r = r || e; else return !1; return r }, evaluateLogicByRowDouble: function (n, i) { var o = new t.StringTokenizer(i.trim(), "!=^><", !0), e, u; if (o.countTokens() !== 3) return !1; e = o.nextToken().trim(); u = e.trim(); e.indexOf("@") != -1 && (e = e.replaceAll("@", " ").trim(), u = n.getValue(e), u == null ? u = "" : (u = u === !0 ? "Y" : u === !1 ? "N" : u, u = u.toString())); u = u.replaceAll("'", " ").replaceAll('"', " ").trim(); var s = o.nextToken(), f = o.nextToken(), r = f.trim(); return f.indexOf("@") != -1 && f[0] == "@" && f[f.length - 1] == "@" && (f = f.replaceAll("@", " ").trim(), r = n.getValue(f), r == null ? r = "" : (r = r === !0 ? "Y" : r === !1 ? "N" : r, r = r.toString())), r = r.replaceAll("'", " ").replaceAll('"', " ").trim(), e.indexOf("_ID") != -1 && u.length == 0 && (u = "0"), f.indexOf("_ID") != -1 && r.length == 0 && (r = "0"), u == "0" && (r == "" || r == "null") && (r = "0"), u.length == 0 && r == "null" && (r = ""), this.evaluateLogicTuple(u, s, r) } }; t.Query = function (n, t) { this.tableName = n ? n : ""; this.list = []; this.recordCount = 999999; this.newRecord = !1; this.isORcondition = !1; t && t == !0 && (this.isORcondition = !0) }; t.Query.prototype.addRestriction = function () { var n = null, i; if (arguments.length == 5) n = new t.QueryRestriction(arguments[0], arguments[1], arguments[2], arguments[3], arguments[4]), this.isORcondition && (n.andCondition = !1), arguments[3].toString().startsWith("-") || this.list.push(n); else if (arguments.length == 3) n = new t.QueryRestriction(arguments[0], arguments[1], arguments[2], null, null), this.isORcondition && (n.andCondition = !1), this.list.push(n); else if (arguments.length == 1) if (i = arguments[0], typeof i == "string") { if (i == null || i.trim().length == 0) return; n = new t.QueryRestriction(i); this.isORcondition && (n.andCondition = !1); this.list.push(n); this.newRecord = i.equals(t.Query.NEWRECORD) } else n = i, this.isORcondition && (n.andCondition = !1), this.list.push(n); else throw new Error("invalid arguments Addrestriction"); n = null }; t.Query.prototype.setTableName = function (n) { this.tableName = n }; t.Query.prototype.setRecordCount = function (n) { this.recordCount = n }; t.Query.prototype.setColumnName = function (n, t) { n < 0 || n >= this.list.length || (this.list[n].columnName = t) }; t.Query.prototype.getCode = function (n) { if (n < 0 || n >= this.list.length) return null; this.list[n].code }; t.Query.prototype.getInfo = function () { var i = "", n = null, t; for (this.tableName != null && (i += this.tableName + ": "), t = 0; t < this.list.length; t++)n = this.list[t], t != 0 && (i += n.andCondition ? " AND " : " OR "), i += n.getInfoName() + n.getInfoOperator() + n.getInfoDisplayAll(); return i }; t.Query.prototype.getIsActive = function () { return this.list.length != 0 }; t.Query.prototype.getIsNewRecordQuery = function () { return this.newRecord }; t.Query.prototype.getRecordCount = function () { return this.recordCount }; t.Query.prototype.getWhereClause = function () { var t = arguments.length == 1 ? arguments[0] : !1, n = "", i = null, u, r; if (typeof t == "boolean" || isNaN(t)) { for (u = t, u && (this.tableName == null || this.tableName.length == 0) && (u = !1), r = 0; r < this.list.length; r++)i = this.list[r], r != 0 && (n += i.andCondition ? " AND " : " OR "), n += u ? i.getSQL(this.tableName) : i.getSQL(null); return n.length > 0 ? " ( " + n + " ) " : n } return t >= 0 && t < this.list.Count && (i = this.list[t], n += i.GetSQL(null)), n }; t.Query.prototype.getRestrictionCount = function () { return this.list.length }; t.Query.prototype.clear = function () { this.list = [] }; t.Query.prototype.getRestrictions = function () { return this.list }; t.Query.prototype.copyRestrictions = function (n) { this.list = this.list.concat(n) }; t.Query.prototype.addRangeRestriction = function () { var n = null; n = arguments.length == 3 ? new t.QueryRestriction(arguments[0], arguments[1], arguments[2], null, null, null) : new t.QueryRestriction(arguments[0], arguments[1], arguments[2], arguments[3], arguments[4], arguments[5]); this.list.push(n) }; t.Query.prototype.getColumnName = function (n) { return n < 0 || n >= this.list.length ? null : this.list[n].columnName }; t.Query.prototype.getTableName = function () { return this.tableName }; t.Query.prototype.getOperator = function (n) { return n < 0 || n >= this.list.length ? null : this.list[n].operator }; t.Query.prototype.getCodeTo = function (n) { return n < 0 || n >= this.list.Count ? null : this.list[n].code_to }; t.Query.prototype.getInfoDisplay = function (n) { return n < 0 || n >= this.list.length ? null : this.list[n].infoDisplay }; t.Query.prototype.getInfoDisplay_to = function (n) { return n < 0 || n >= this.list.length ? null : this.list[n].infoDisplay_to }; t.Query.prototype.getInfoName = function (n) { return n < 0 || n >= this.list.length ? null : this.list[n].infoName }; t.Query.prototype.getInfoOperator = function (n) { return n < 0 || n >= this.list.length ? null : this.list[n].getInfoOperator() }; t.Query.prototype.getInfoDisplayAll = function (n) { return n < 0 || n >= _list.Count ? null : this.list[n].getInfoDisplayAll() }; t.Query.prototype.deepCopy = function () { for (var i = new t.Query(this.tableName), n = 0; n < this.list.length; n++)i.addRestriction(this.list[n]); return i }; t.Query.prototype.getNoRecordQuery = function (n, i) { var r = new t.Query(n); return i ? r.AddRestriction(t.Query.NEWRECORD) : r.AddRestriction("1=2"), r.setRecordCount(0), r }; t.Query.prototype.NEWRECORD = "2=3"; t.Query.prototype.EQUAL = "="; t.Query.prototype.EQUAL_INDEX = 0; t.Query.prototype.NOT_EQUAL = "!="; t.Query.prototype.LIKE = " LIKE "; t.Query.prototype.NOT_LIKE = " NOT LIKE "; t.Query.prototype.GREATER = ">"; t.Query.prototype.GREATER_EQUAL = ">="; t.Query.prototype.LESS = "<"; t.Query.prototype.LESS_EQUAL = "<="; t.Query.prototype.BETWEEN = " BETWEEN "; t.Query.prototype.BETWEEN_INDEX = 8; t.Query.prototype.IN = " IN "; t.Query.prototype.NOT_IN = " NOT IN "; t.Query.prototype.OPERATORS = { "=": " = ", "!=": " != ", " LIKE ": " ~ ", " NOT LIKE ": " !~ ", ">": " > ", ">=": " >= ", "<": " < ", "<=": " <= ", " BETWEEN ": " >-< " }; t.Query.prototype.CVOPERATORS = { "=": " = ", "!=": " != ", ">": " > ", "<": " < " }; t.Query.prototype.OPERATORS_ID = { "=": " = ", "!=": " != " }; t.Query.prototype.CVOPERATORS_ID = { "=": " = ", "!": " != " }; t.Query.prototype.OPERATORS_YN = { "=": " = " }; t.Query.prototype.OPERATORS_DATE_DYNAMIC = { "0": "Today", "1": "lastxDays", "2": "lastxMonth", "3": "lastxYears" }; t.Query.prototype.OPERATORS_DYNAMIC_ID = { "@#AD_User_ID@": "LoginUser" }; t.Query.prototype.getEqualQuery = function (n, i) { var r = new t.Query; return r.addRestriction(n, t.Query.prototype.EQUAL, i), r.setRecordCount(1), r }; t.QueryRestriction = function () { this.directWhereClause = null; this.columnName; this.infoName; this.operator; this.code; this.infoDisplay; this.code_to; this.infoDisplay_to; this.andCondition = !0; switch (arguments.length) { case 5: this.fnArgu5(arguments[0], arguments[1], arguments[2], arguments[3], arguments[4]); break; case 6: this.fnArgu6(arguments[0], arguments[1], arguments[2], arguments[3], arguments[4], arguments[5]); break; case 9: this.fnArgu9(arguments[0], arguments[1], arguments[2], arguments[3], arguments[4], arguments[5], arguments[6], arguments[7], arguments[8]); break; case 1: this.fnArgu1(arguments[0]); break; case 0: break; default: throw new Error("Invalid arguments"); } }; t.QueryRestriction.prototype.fnArgu5 = function (n, t, i, r, u) { var o = n.trim(), s, f, e; s = r != null ? r : o; Operator = t; f = i != null && typeof i == "Boolean" ? new Boolean(i) == !0 ? "Y" : "N" : i; f != null && typeof f == "string" && (f.startsWith("'") && (f = f.substring(1)), f.endsWith("'") && (f = f.substring(0, f.length - 2))); u != null ? e = u.toString().trim() : i != null && (e = i); this.columnName = o; this.infoName = s; this.operator = Operator; this.code = f; this.infoDisplay = e }; t.QueryRestriction.prototype.fnArgu6 = function (n, i, r, u, f, e) { var o, s; this.fnArgu5(n, t.Query.prototype.BETWEEN, i, u, f); o = r; typeof o == "string" && (o.startsWith("'") && (o = o.substring(1)), o.endsWith("'") && (o = o.substring(0, o.length - 2))); e != null ? s = e.trim() : o != null && (s = o.toString()); this.code_to = o; this.infoDisplay_to = s }; t.QueryRestriction.prototype.fnArgu9 = function (n, t, i, r, u, f, e, o, s) { this.columnName = n; this.infoName = r; this.code = t; this.code_to = i; this.infoName = r; this.infoDisplay = u; this.infoDisplay_to = f; this.operator = e; this.directWhereClause = o; this.andCondition = s }; t.QueryRestriction.prototype.fnArgu1 = function (n) { this.directWhereClause = n }; t.QueryRestriction.prototype.getInfoName = function () { return this.infoName }; t.QueryRestriction.prototype.getInfoOperator = function () { return this.operator in t.Query.OPERATORS ? t.Query.OPERATORS[this.operator] : this.operator }; t.QueryRestriction.prototype.getInfoDisplayAll = function () { if (this.infoDisplay_to == null) return this.infoDisplay; var n = this.infoDisplay; return n + (" - " + InfoDisplay_to) }; t.QueryRestriction.prototype.getSQL = function (n) { var i, r, u; return this.directWhereClause != null ? this.directWhereClause : (i = "", typeof this.code == "string" && isNaN(this.code) && this.code.toString().toUpper() != "NULLValue".toUpper() && (i += " UPPER( "), n != null && n.length > 0 ? (r = this.columnName.lastIndexOf("(") + 1, u = this.columnName.indexOf(")"), i += r != -1 && u != -1 ? this.columnName.substring(0, r) + n + "." + this.columnName.substring(r, r + (u - r)) + this.columnName.substring(u) : n + "." + this.columnName) : i += this.columnName, typeof this.code == "string" && isNaN(this.code) && this.code.toString().toUpper() != "NULLValue".toUpper() && (i += " ) "), this.code == null || "NULL".equals(this.code.toString().toUpper()) || "NULLValue".toUpper().equals(this.code.toString().toUpper()) ? i += this.operator.equals(t.Query.prototype.EQUAL) ? " IS NULL " : " IS NOT NULL " : (i += this.operator + " ", (t.Query.prototype.IN.equals(this.operator) || t.Query.prototype.NOT_IN.equals(this.operator)) && (i += "("), this.code instanceof Date || this.code && f.test(this.code.toString()) ? i += t.DB.to_date(this.code, !1) : "string" == typeof this.code ? isNaN(this.code) ? (i += " UPPER( ", i += t.DB.to_string(this.code.toString()), i += " ) ") : i += t.DB.to_string(this.code.toString()) : i += this.code, t.Query.prototype.BETWEEN.equals(this.operator) ? (i += " AND ", i += this.code_to instanceof Date || this.code_to && f.test(this.code_to.toString()) ? t.DB.to_date(this.code_to, !1) : typeof this.code_to == "string" ? t.DB.to_string(this.code_to.toString()) : this.code_to) : (t.Query.prototype.IN.equals(this.operator) || t.Query.prototype.NOT_IN.equals(this.operator)) && (i += ")")), i) }; i.prototype.FROM = " FROM "; i.prototype.FROM_LENGTH = i.prototype.FROM.length; i.prototype.WHERE = " WHERE "; i.prototype.ON = " ON "; i.prototype.setSql = function (n) { if (n == null) throw new IllegalArgumentException("No SQL"); this.sqlOriginal = n; var t = this.sqlOriginal.indexOf("\nFROM "); t != -1 && (this.sqlOriginal = this.sqlOriginal.replace("\nFROM ", this.FROM)); t = this.sqlOriginal.indexOf("\nWHERE "); t != -1 && (this.sqlOriginal = this.sqlOriginal.replace("\nWHERE ", this.WHERE)); this.parse() }; i.prototype.getSql = function () { return this.sqlOriginal }; i.prototype.setSql = function (n) { if (n == null) throw new IllegalArgumentException("No SQL"); this.sqlOriginal = n; var t = this.sqlOriginal.indexOf("\nFROM "); t != -1 && (this.sqlOriginal = this.sqlOriginal.replaceAll("\nFROM ", this.FROM)); t = this.sqlOriginal.indexOf("\nWHERE "); t != -1 && (this.sqlOriginal = this.sqlOriginal.replaceAll("\nWHERE ", this.WHERE)); this.parse() }; i.prototype.getSql = function () { return this.sqlOriginal }; i.prototype.parse = function () { var n, t; if (this.sqlOriginal == null || this.sqlOriginal.length == 0) throw new IllegalArgumentException("No SQL"); for (this.getSelectStatements(), n = 0; n < this.sql.length; n++)t = this.getTableInfo(this.sql[n].trim()), this.tableInfo.push(t); return this.tableInfo.length > 0 }; i.prototype.getSelectStatements = function () { var i = [this.sqlOriginal], n = null; try { n = this.getSubSQL(i) } catch (r) { this.log.log(t.Logging.Level.SEVERE, this.sqlOriginal, r); throw new IllegalArgumentException(this.sqlOriginal); } while (i.length != n.length) { i = n; try { n = this.getSubSQL(i) } catch (r) { this.log.log(t.Logging.Level.SEVERE, this.sqlOriginal, r); throw new IllegalArgumentException(n.length + ": " + m_sqlOriginal); } } this.sql = n }; i.prototype.getSubSQL = function (n) { for (var i, r, u, o, s, f = [], t = "", e = 0; e < n.length; e++) { for (t = n[e], i = t.indexOf("(SELECT ", 7); i != -1;) { for (r = i + 1, u = 0; r++ < t.length;)if (o = t.charAt(r), o == ")") if (u == 0) break; else u--; else o == "(" && u++; s = t.substring(i, r + 1); f.push(s); t = t.substring(0, i + 1) + "##" + t.substring(r); i = t.indexOf("(SELECT ", 7) } f.push(t) } return f }; i.prototype.getTableInfo = function (n) { var o, f, i, e, s, h, r; if (isNaN(n)) { for (o = [], n.startsWith("(") && n.endsWith(")") && (n = n.substring(1, n.length - 1)), f = n.indexOf(this.FROM), f != n.lastIndexOf(this.FROM) && this.log.log(t.Logging.Level.FINE, "More than one FROM clause - " + n); f != -1;) { for (i = n.substring(f + this.FROM_LENGTH), r = i.indexOf(this.WHERE), r != -1 && (i = i.substring(0, r)), i = i.replaceAll(" AS ", " "), i = i.replaceAll(" as ", " "), i = i.replaceAll(" INNER JOIN ", ", "), i = i.replaceAll(" LEFT OUTER JOIN ", ", "), i = i.replaceAll(" RIGHT OUTER JOIN ", ", "), i = i.replaceAll(" FULL JOIN ", ", "), r = i.indexOf(this.ON); r != -1;) { if (e = i.indexOf(")"), s = i.indexOf(this.ON, r + 4), s != -1 && (e = i.lastIndexOf(")", s)), e != -1) i = i.substring(0, r) + i.substring(e + 1); else { this.log.log(t.Logging.Level.SEVERE, "Could not remove ON " + i); break } r = i.indexOf(this.ON) } for (h = new t.StringTokenizer(i, ","); h.hasMoreTokens();) { var l = h.nextToken().trim(), c = new t.StringTokenizer(l, " "), a = null; a = c.countTokens() > 1 ? new u(c.nextToken(), c.nextToken()) : new u(l); o.push(a) } n = n.substring(0, f); f = n.lastIndexOf(this.FROM) } return o } return (r = n, r < 0 || r > this.tableInfo.length) ? null : this.tableInfo[r] }; i.prototype.getSqlStatement = function (n) { return n < 0 || n > this.sql.length ? null : this.sql[n] }; i.prototype.getNoSqlStatments = function () { return this.sql == null ? 0 : this.sql.length }; i.prototype.getMainSqlIndex = function () { if (this.sql == null) return -1; if (this.sql.length == 1) return 0; for (var n = this.sql.length - 1; n >= 0; n--)if (this.sql[n].charAt(0) != "(") return n; return -1 }; i.prototype.getMainSql = function () { if (this.sql == null) return this.sqlOriginal; if (this.sql.length == 1) return this.sql[0]; for (var n = this.sql.length - 1; n >= 0; n--)if (this.sql[n].charAt(0) != "(") return this.sql[n]; return "" }; i.prototype.size = function () { return this.tableInfo.length }; u.prototype.getSynonym = function () { return this.synonym == null ? "" : this.synonym }; u.prototype.getTableName = function () { return this.tableName }; t.TableInfo = u; t.AccessSqlParser = i; t.ZoomTarget = { log: t.Logging.VLogger.getVLogger("VIS.ZoomTarget"), getZoomAD_Window_ID: function (n, i, r, u) { var s = 0, h = 0, a, v, f, p, c, y, l, o; n.equals("M_Product"); a = "VIS_78"; v = []; v[0] = new t.DB.SqlParam("@targetTableName", n); f = null; try { p = 1; f = e(a, v); f.read() && (s = f.getInt(0), h = f.getInt(1)) } catch (w) { this.log.log(t.Logging.Level.SEVERE, a, w) } finally { f != null && f.dispose(); f = null } return h == 0 ? s : (h != 0 && s != 0 && r != null && r.length != 0 && (c = null, y = n.indexOf("Line"), y != -1 && (c = n.substring(0, y)), c != null && (u = t.dataContext.getJSONData(t.Application.contextUrl + "Form/GetZoomIsSOTrx", { parentTable: c, targetTableName: n, targetWhereClause: t.secureEngine.encrypt(r) }))), l = 0, r != null && r.length != 0 && (o = [], o = this.getZoomTargets(n, i, r), o != null && o.length > 0 && (l = o[0].Key)), l != 0) ? l : u ? s : h }, parseColumns: function (n, t) { var i, e, u, f, r; if (t != null && t.length != 0 && (i = t, !i.contains(" EXISTS ") && !i.contains(" IN ") && !i.contains("(") && !i.contains(")"))) while (i.indexOf("=") != -1) e = i.indexOf("="), u = i.substring(0, e), u = u.trim(), f = u.lastIndexOf(" ", u.length), r = u.substring(f + 1), r.indexOf(".") != -1 && (f = r.indexOf(".") + 1, r = r.substring(f, r.length)), n.indexOf(r) < 0 && n.push(r), i = i.substring(e + 1) }, evaluateWhereClause: function (n, i) { var r, s, o; if (i == null || i.length == 0) return !0; if (r = i, s = !0, r.contains(" EXISTS ") || r.contains(" IN ") || r.contains("(") || r.contains(")")) return !1; while (r.indexOf("=") != -1) { var u = r.indexOf("="), f = r.lastIndexOf(" ", u), e = r.substring(f + 1, u), h = "", c = ""; for (e.indexOf(".") != -1 && (f = e.indexOf(".") + 1, e = e.substring(f, e.length)), o = 0; o < n.length; o++)if (e.equals(n[o].Name)) { h = n[o].Value; break } if (r = r.substring(u + 1), f = 0, u = r.indexOf(" "), c = u == -1 ? r.substring(f) : r.substring(f, u), !t.Evaluator.evaluateLogicTuple(h, "=", c)) { s = !1; break } } return s }, getZoomTargets: function (i, r, u, f) { var l, s, c, h; if (arguments.length == 4) { if (f.length != 1) return null; l = f[0]; s = u.replace("?", l.toString()); s = s.replace("WHERE ", " "); this.log.fine("WhereClause : " + s); u = s } var a = [], s = "", y = null, p = 0, w = 0, b = 0, v = "VIS_80", o = null; try { for (o = e(v); o.read();)c = o.getInt(0), h = o.getString(1), h.equals("Work Center") ? p = c : h.equals("Work Center Costs") ? (w = c, y = h) : h.equals("Production Resource") && (b = c) } catch (k) { this.log.log(t.Logging.Level.SEVERE, v, k) } finally { o != null && o.dispose(); o = null } return u != "" && u && (u = t.secureEngine.encrypt(u)), n.ajax({ async: !1, url: t.Application.contextUrl + "Form/GetZoomWindow", data: { targetTableName: i, curWindow_ID: r, targetWhereClause: u }, success: function (n) { a = JSON.parse(n) } }), a } }; r.prototype.setExpireMinutes = function (n) { if (n > 0) { this.m_expire = n; var i = 6e4 * n; this.m_timeExp = t.Env.currentTimeMillis() + i } else this.m_expire = 0, this.m_timeExp = 0 }; r.prototype.expire = function () { this.m_expire != 0 && this.m_timeExp < t.Env.currentTimeMillis() && this.reset() }; r.prototype.reset = function () { var n, i; return arguments.length == 2 ? this.reset2(arguments[0], arguments[1]) : arguments.length == 1 ? this.reset2(arguments[0]) : (n = this.m_cacheK.length, this.clear(), this.m_expire != 0 && (i = 6e4 * this.m_expire, this.m_timeExp = t.Env.currentTimeMillis() + i), n) }; r.prototype.reset2 = function (n, t) { if (this.tableName == null) return -1; var i = n === this.m_tableName || n === this.m_tableName2; return i || this.m_tableName2.startsWith(n) ? t == 0 || this.m_resetAll ? reset() : this.remove(t) : -1 }; r.prototype.remove = function (n) { var t = this.m_cacheK.indexOf(n); return t > -1 ? (this.m_cacheK.splice(t, 1), this.m_cacheV.splice(t, 1), 1) : 0 }; r.prototype.get = function (n) { this.expire(); var t = this.m_cacheK.indexOf(n); return t > -1 ? this.m_cacheV[t] : null }; r.prototype.contains = function (n) { var t = this.m_cacheK.indexOf(n); return t > -1 ? !0 : !1 }; r.prototype.add = function (t, i) { var u, r; this.expire(); (typeof i == "function" || n.isFunction(i)) && (u = ""); r = this.m_cacheK.indexOf(t); r < 0 ? (this.m_cacheK.push(t), this.m_cacheV.push(i)) : this.m_cacheV[r] = i }; r.prototype.clear = function () { this.m_cacheK.length = 0; this.m_cacheV.length = 0 }; r.prototype.size = function () { return this.expire(), this.m_cacheV.length }; r.prototype.getTableName = function () { return this.m_tableName }; t.CacheMgt = c(); t.CCache = r }(jQuery, VIS), function (n) { var t = function (n, t, i, r) { this.tokenizers = t.splice ? t : t.split(""); r && (this.doBuild = r); this.src = n; this.ended = !1; this.tokens = []; this.returnDelim = i; this.curIndex = 0; this.parse() }; t.prototype = { parse: function () { do this.next(); while (!this.ended); return this.tokens }, build: function (n, t) { if (n) { if (!this.returnDelim && this.tokenizers.indexOf(n) > -1) return; this.tokens.push(this.doBuild ? this.doBuild(n, t, this.tkn) : n) } }, next: function () { var n = this, t; n.findMin(); t = n.src.slice(0, n.min); n.build(t, !1); n.src = n.src.slice(n.min).replace(n.tkn, function (t) { return n.build(t, !0), "" }); n.src || (n.ended = !0) }, findMin: function () { var n = this, r = 0, t, i; for (n.min = -1, n.tkn = ""; (t = n.tokenizers[r++]) !== undefined;)i = n.src[t.test ? "search" : "indexOf"](t), i != -1 && (n.min == -1 || i < n.min) && (n.tkn = t, n.min = i); n.min == -1 && (n.min = n.src.length) }, countTokens: function () { return this.tokens.length }, nextToken: function () { return this.hasMoreTokens() ? this.tokens[this.curIndex++] : null }, hasMoreTokens: function () { return this.curIndex < this.tokens.length ? !0 : !1 }, reset: function () { this.curIndex = -1 } }; n.StringTokenizer = t }(VIS), function (n) { function u() { function ft() { return tt } function et() { function f(u) { var f = $(u.target), e, v, o, h, c, l; if (f.hasClass("fa fa-arrow-left") && (f = f.parent()), e = f.parent(), f.hasClass("vis-menuitm-backbtn")) f.closest("ul").css("display", "none"), s.find(".vismenu-parent").show(), i.find(".vismenu-selectedMbTab").removeClass("vismenu-selectedMbTab"), i.find('[data-val="' + e.data("ulid") + '"]').siblings().show(), i.find('[data-val="' + e.data("ulid") + '"]').show(), i.find("ul:not(.vismenu-parent)").hide(), i.find("li:not(.vis-hasSubMenu)").hide(), t && t.setIsMenuHeaderClicked(!1); else if (u.target.nodeName === "LABEL" && e.data("con") == "Y") { if (v = e.data("val"), !t) return; h = t.getFilterValue(); t.setIsMenuHeaderClicked(!1); o = i.find('[data-ulid="' + v + '"]'); o.css("display", "flex").addClass("vismenu-selectedMbTab"); o.find("ul").css("display", "block"); o.find("li").hide(); o.find(".vis-subNavFirstElement").show(); o.find(".vis-menu-innerFolders").show(); o.find(".fa-minus").removeClass("fa-minus").addClass("fa-plus"); h != "A" ? o.find('li > a[data-action="' + h + '"]').parent().css("display", "flex") : o.find("li:not(.vis-menusubItem)").css("display", "flex"); s.find(".vismenu-parent").hide(); t.hideMobileEmptyFolder(); e.data("summary") == "Y" ? (e.siblings().hide(), e.hide()) : (e.parent().siblings().hide(), e.hide()) } else { if (u.target.nodeName === "LABEL") { if (Date.now() - r < 300) { u.preventDefault(); u.stopPropagation(); r = Date.now(); return } r = Date.now() } if (u.target.nodeName === "A") { if (f = $(u.target), f.data("isfavbtn") == "yes") { n.FavouriteHelper.showOverlay(f); return } if (f.data("summary") == "Y") { h = t ? t.getFilterValue() : null; s.find(".vis-navmenuItems-Container").hide(); f.parent().siblings().removeClass("vis-navSelected"); f.parent().addClass("vis-navSelected"); c = s.find("#Menu" + f.data("value")); c.removeAttr("style"); c.find(".vis-menuSum-hide").removeClass("vis-menuSum-hide"); i.find(".vismenu-hidden-header").hide(); i.find(".vis-nav-AllItems").hide(); i.find(".fa-minus").removeClass("fa-minus").addClass("fa-plus"); h != null && (h != "A" ? i.find(".fa-plus").removeClass("fa-plus").addClass("fa-minus") : i.find(".fa-minus").removeClass("fa-minus").addClass("fa-plus")); c.find(".vismenu-subSummaryNode").css("display", "none"); t && t.hideEmptyFolders(); return } a(f.data("action"), f.data("actionid")); return } if (u.target.nodeName === "I") { if (f = $(u.target), f.hasClass("vis-navAccordian")) { f.hasClass("fa-plus") ? (f.removeClass("fa-plus").addClass("fa-minus"), l = f.data("pid"), i.find('[data-ulid="' + l + '"]').show()) : (f.removeClass("fa-minus").addClass("fa-plus"), l = f.data("pid"), i.find('[data-ulid="' + l + '"]').hide()); return } if (f = f.parent(), f.data("isfavbtn") == "yes") { n.FavouriteHelper.showOverlay(f); return } } } } p.on(n.Events.onTouchStartOrClick, function (n) { n.preventDefault(); w() }); var r = Date.now(); i.on("click", function (n) { f(n) }); i.on("keyDown", function (n) { n.which == 13 && f(n) }); $(i.find(".vis-navLeftWrap a")[0]).trigger("click"); c.on(n.Events.onClick, "LI", function (n) { if (n.preventDefault(), n.target.nodeName === "I" || n.target.nodeName === "SPAN") { lt($(n.currentTarget)); return } var t = null; n.target.nodeName === "LI" ? t = $(n.target) : n.target.parentNode.nodeName === "LI" && (t = $(n.target.parentNode)); t && (y(t[0].id), v(t)); t = null }); k.on("click", function (t) { n.MRole.getIsDisableMenu() || (t.preventDefault(), window.setTimeout(function () { u.focus(); $("#vis_divTree").on("focus", "li", function (n) { var t = $(n.target); $(t).off("keydown"); $(t).on("keydown", function (n) { n.key == "Enter" && (t.siblings("label").length > 0 && $(t.siblings("label")).trigger("click"), t.siblings("a").length > 0 && $(t.siblings("label")).trigger("a")) }); $(t.siblings("label")).css("border", "1px solid rgba(var(--v-c-primary), 1)") }); $("#vis_divTree").on("focusout", "li", function (n) { var t = $(n.target); $(t.siblings("label")).css("border", "1px solid white") }) }, 2), ht()) }); it.on("click", function (n) { n.preventDefault(); w() }); nt && u.bind("input", function () { at(u.val(), this.list) }); $(window).resize(ut); window.onbeforeunload = function () { $.ajax({ url: n.Application.contextUrl + "Account/LogOffHandler", type: "POST" }) }; rt(1) } function rt(t) { window.setTimeout(function () { $.ajax({ url: n.Application.contextUrl + "Account/Refresh", complete: function () { rt(180) } }) }, 1e3 * t) } function ot() { n.Application.contextFullUrl.toLower().indexOf("softwareonthecloud.com") > -1 ? $.ajax({ url: n.Application.contextUrl + "home/GetSubscriptionDaysLeft/", success: function (t) { var i = JSON.parse(t); i && (i == "True" || i == "" ? l.css("display", "none") : i > 1 ? l.text(n.Msg.getMsg("VIS_TrialPeriod") + ": " + i + " " + n.Msg.getMsg("VIS_TrialDaysLeft")) : i == 1 && l.text(n.Msg.getMsg("VIS_TrialPeriod") + ": " + i + " " + n.Msg.getMsg("VIS_TrialDayLeft"))) }, error: function () { l.css("display", "none") } }) : l.css("display", "none") } function st() { e && e.id && e.action && (a(e.action, e.id), u.val("")); e = null } function w() { t.closePopup(); s.attr("style", "display: none !important"); p.fadeOut(); u.val(""); u.blur() } function ht() { p.fadeIn(); s.attr("style", "display: block !important") } function ut() { var t = 0; t = (n.Application.isMobile || n.Application.isIOS) && document.documentElement ? document.documentElement.clientHeight : window.innerHeight; t = t - 23; n.Utility.Util.getValueOfInt(n.context.ctx["#FRAMEWORK_VERSION"]) < 2 && (t = t - 43); n.Env.setScreenHeight(t); document.documentElement.style.setProperty("--vis-screen-height", t * .01 + "px"); n.viewManager && n.viewManager.sizeChanged(t, window.innerwidth) } function a(t, i) { n.viewManager.startAction(t, i); w() } function v(n) { if (n.length > 0) { if (n[0].id == "vis_lhome") return; g && g.removeClass("vis-app-f-selected"); g = n.addClass("vis-app-f-selected"); n = null } } function ct(n) { var t = n.data("wid"); v(c.find("LI#" + t)) } function lt(t) { r[r.length - 1] == t[0].id ? n.viewManager.closeFrame(t[0].id) : (y(t[0].id), v(t)) } function y(t) { h ? h.hide() : tt.children("div").hide(); o[t] && (h = o[t], h.css({ opacity: 0 }), h.show().animate({ opacity: 1 }, 500, "linear", function () { n.viewManager.resize(t) })); r.indexOf(t) != -1 && r.splice(r.indexOf(t), 1); r.push(t); w() } function at(n, t) { var i, r; if (n !== "" && !(n.length < 1)) for (i = 0; i < t.options.length; i++)if (t.options[i].value === n) { r = $(t.options[i]); a(r.data("action"), r.data("actionid")); u.val(""); break } } function vt() { dt(); t.init(i, $("#vis_filterMenu"), s); f.init($("#vis_home_ca"), $("#vis_userName")); yt(); historyMgr.restoreHistory(); ti(); window.addEventListener("DOMContentLoaded", n.sseManager.start, !1) } function yt() { n.MRole.getIsDisableMenu() || pt(); n.MRole.getIsDisableMenu() && ($(".vis-topMenu").hide(), $(".vis-menuHeaderLogo").show()); var t = n.MRole.getHomePage(); t && parseInt(t) > 0 && a("X", t) } function pt() { $("#vis_lhome").show(); o.vis_lhome = b; h = b.show(); n.HomeMgr.initHome(b) } function wt(n, t) { return o[n] = t, r.push(n), y(n), t } function bt(n) { var i, t; return c.find("LI#" + n).remove(), i = o[n], o[n] = null, delete o[n], r.pop(), i = null, t = "", t = r.length > 0 ? r[r.length - 1] : "vis_lhome", y(t), v(c.find("LI#" + t)), !0 } function kt(n, t, i) { var r = ["<li id=" + n + ">"], u; t && (t.indexOf(".") > -1 ? r.push('<img src= "' + t + '" />') : r.push('<i class= "' + t + '" />')); r.push("<a>" + i + '<\/a><span style="padding:0 7px;"><i class="fa fa-times-circle-o" /><\/span><\/li>'); u = $(r.join(" ")); c.append(u); v(u); u = null } function dt() { var n, i, t = []; nt || (i = u.attr("list"), n = $("#" + i), n.length > 0 && (t = [], n.find("option").each(function () { t.push({ label: this.value, value: this.value, action: $(this).data("action"), id: $(this).data("actionid") }) }), u.autocomplete({ source: t, open: function () { window.setTimeout(function () { $(".ui-autocomplete").css("z-index", 1e3); var n = window.innerHeight * 60 / 100; $(".ui-autocomplete").css("max-height", n) }) }, select: function (n, t) { e = t.item }, close: function () { st() } })), n.remove()) } function gt() { k.trigger("click") } function ni() { it.trigger("click") } function ti() { } function ii() { return d || (d = $(".vis-app-action-nav")), d } function ri() { return k } var e = null, h = null, o = {}, r = [], nt = !1, b = $("#vis_home"), ui = $("#vis_mainSection"), tt = $("#vis_mainConatiner"), c = $("#vis_taskbar"), k = $("#vis_appMenu"), s = $("#vis_mainMenu"), it = $("#vis_closeMenu"), l = $("#vis_cloud_daysleft"), u = $("#vis_menuSearch"), i = $("#vis_divTree"), p = $("#vis_menuOverlay"), d = null, g = null; return ut(), et(), ot(), { startMenuAction: a, getMainConatiner: ft, toggleContainer: y, registerView: wt, unRegisterView: bt, addTaskBarItem: kt, start: vt, activateTaskBarItemUsingID: ct, openMenu: gt, closeMenu: ni, getNavSection: ii, getMenuDiv: ri } } n.desktopMgr = u(); var f = function () { function et(s, l) { s.remove(); b = l; o = s; v = s.find("#vis_changeAuthForm"); f = s.find("#vis_home_role"); r = s.find("#vis_home_client"); i = s.find("#vis_home_org"); t = s.find("#vis_home_warehouse"); y = s.find("#vis_home_warehouseId"); e = s.find("#vis-auth-close"); u = s.find("#vis-auth-change"); tt = s.find('label[for="Login2Model_Role"]'); it = s.find('label[for="Login2Model_Client"]'); rt = s.find('label[for="Login2Model_Org"]'); ut = s.find('label[for="Login2Model_Warehouse"]'); k = f.val(); d = r.html(); g = i.html(); nt = t.html(); st(); $("body").append(c); $("body").append(o); h = n.Application.contextUrl; ot(); y.val() == "-1" && t.val(null) } function ot() { tt.text(Globalize.localize("Role")); it.text(Globalize.localize("Client")); rt.text(Globalize.localize("Organization")); ut.text(Globalize.localize("Warehouse")); u.val(n.Msg.getMsg("Change")); e.val(n.Msg.getMsg("Close")) } function st() { b.on("click", ct); c.on("click", ft); e.on("click", ft); f.on("change", l); r.on("change", l); i.on("change", l); t.on("change", l); v.submit(at) } function ht() { f.val(k); r.html(d); i.html(g); t.html(nt); y.val() == "-1" && t.val(null); u.prop("disabled", !0); a(v, []); s = !1 } function ct() { c.show(); o.show("slideDown"); e.prop("disabled", !1); u.prop("disabled", !0) } function ft(n) { return s && ht(), c.hide(), o.hide("slideUp"), n.preventDefault(), !1 } function w(n, t, i) { $.ajax(t, { data: i }).success(function (t) { lt(n, t.data) }).fail(function (n) { alert(n) }) } function l() { if (!p) { s || (s = !0, u.prop("disabled", !1)); combo = this; combo.id === f.attr("id") ? (r.empty(), i.empty(), t.empty(), w(r, h + "Account/GetClients", { Id: combo.value })) : combo.id === r.attr("id") ? (i.empty(), t.empty(), w(i, h + "Account/GetOrgs", { role: f.val(), user: n.context.getAD_User_ID(), client: combo.value })) : combo.id === i.attr("id") ? (t.empty(), w(t, h + "Account/GetWarehouse", { id: i.val() })) : combo.id === t.attr("id"); var e = $("#" + combo.id + "Name"), o = this.options[this.selectedIndex].innerHTML; e.val(o) } } function lt(n, t) { p = !0; n.empty(); var u = Globalize.localize("SelectWarehouse"); n === f ? u = Globalize.localize("SelectRole") : n === r ? u = Globalize.localize("SelectClient") : n === i && (u = Globalize.localize("SelectOrg")); $("<option />", { val: "-1", text: u }).appendTo(n); $(t).each(function () { $("<option />", { val: this.Key, text: this.Name }).appendTo(n) }); p = !1 } function at(n) { var t = $(this); a(t, []); e.prop("disabled", !0); u.prop("disabled", !0); t.find("#vis_home_langugage").val(localStorage.getItem("vis_login_langCode")); (!t.valid || t.valid()) && $.post(t.attr("action"), t.serializeArray()).done(function (n) { n = n || {}; n.success ? (window.location = n.redirect || location.href, window.location.href.indexOf("#") != -1 && location.reload()) : n.errors && (a(t, n.errors), e.prop("disabled", !1), u.prop("disabled", !1)) }).error(function () { a(t, ["An unknown error happened."]); e.prop("disabled", !1); u.prop("disabled", !1) }); n.preventDefault() } var v, f, r, i, t, b, o, e, u, k, d, g, nt, y, s = !1, p = !1, h = "", tt, it, rt, ut, c = $('<div class="vis-wakeup-main" >').hide(), vt = function (n) { return n.find(".validation-summary-errors, .validation-summary-valid") }, a = function (n, t) { var i = vt(n).removeClass("validation-summary-valid").addClass("validation-summary-errors"), r = $.map(t, function (n) { return "<li>" + Globalize.localize(n) + "<\/li>" }).join(""); i.find("ul").empty().append(r) }; return { init: et } }(), t = function () { function b(r, e, o) { i.html('<input type="radio" name="filter" id="vis_filter_radio_1" value="A" checked style="margin-bottom:5px;margin:1px;" /><label for="vis_filter_radio_1">' + n.Msg.getMsg("All") + '<\/label><br><input type="radio" name="filter" id="vis_filter_radio_2" value="W" style="margin-bottom:5px;margin:1px;" /><label for="vis_filter_radio_2">' + n.Msg.getMsg("Window") + '<\/label><br><input type="radio" name="filter" id="vis_filter_radio_3" value="X" style="margin-bottom:5px;margin:1px;"/><label for="vis_filter_radio_3">' + n.Msg.getMsg("Form") + '<\/label><br><input type="radio" name="filter" id="vis_filter_radio_4" value="P" style="margin-bottom:5px;margin:1px;"/><label for="vis_filter_radio_4">' + n.Msg.getMsg("Process") + '<\/label><br><input type="radio" name="filter" id="vis_filter_radio_5" value="R" style="margin-bottom:20px;margin:1px;"/><label for="vis_filter_radio_5">' + n.Msg.getMsg("Report") + '<\/label><br/><input type="button" name="filter" value=' + n.Msg.getMsg("Filter") + "><\/input>"); f = o; t = r; var s = []; s = k(); p = u.html(); w = s; c = e; $("body").append(i); nt(); d() } function k() { var r = [], i, n; for (u = t.find(".vis-navMainContent"), i = t.find(".vismenu-hidden-header"), n = 0; n < i.length; n++)itm = $(i[n]), r.push(itm[0].outerHTML); return r } function d() { function r() { var r = i.find("input[type=radio]:checked").val(); g(r); r == "A" ? (f.find(".vis-removeFilter").hide(), t.find(".vismenu-subSummaryNode").css("display", "none"), (n.Application.isMobile || n.Application.isIOS) && document.documentElement ? o ? (t.find(".vis-menusubItem").css("display", ""), t.find(".fa-plus").removeClass("fa-plus").addClass("fa-minus")) : (t.find(".vis-menusubItem").css("display", "none"), t.find(".fa-minus").removeClass("fa-minus").addClass("fa-plus")) : t.find(".fa-minus").removeClass("fa-minus").addClass("fa-plus")) : (f.find(".vis-removeFilter").show(), t.find(".fa-plus").removeClass("fa-plus").addClass("fa-minus")); y() } c.on("click", l); i.on("click", "input[type=button]", function (n) { n.stopPropagation(); r() }); f.find(".vis-removeFilter").on("click", function () { i.find("#vis_filter_radio_1").prop("checked", !0); r() }); f.find(".vis-menu-headerName").click(function () { v(!0); tt() }) } function g(i) { if ((n.Application.isMobile || n.Application.isIOS) && document.documentElement) { if (t.find(".vismenu-parent").is(":visible")) return; t.find(".vis-menuSum-hide").removeClass("vis-menuSum-hide"); i === "A" ? t.find("li").show() : (t.find("li").hide(), t.find(".vis-menu-innerFolders").show(), t.find(".vis-menuitm-backbtn").parent().show(), t.find('li > a[data-action="' + i + '"]').parent().show()); s() } else t.find(".vis-navSubMenu").removeClass("vis-menuSum-hide"), r.is(":visible") && r.find(".vis-navMainContent").removeAttr("style"), i === "A" ? t.find(".vis-navMainContent li").show() : (t.find(".vis-navMainContent li").hide(), t.find('.vis-navMainContent li > a[data-action="' + i + '"]').parent().show()), h() } function s() { var n, r, u, h, s, e, f; if (i.find("input[type=radio]:checked").val() != "A") { if (t.find(".vismenu-parent").is(":visible")) return; for (n = t.find(".vismenu-selectedMbTab"), r = [], n && n.length > 0 ? (r = n.find("ul"), n.find(".vis-menuSum-hide").removeClass("vis-menuSum-hide")) : (r = t.find("ul"), t.find(".vis-menuSum-hide").removeClass("vis-menuSum-hide")), e = 0; e < r.length; e++)if (u = $(r[e]), !u.hasClass("vismenu-parent")) { for (h = u.find("li"), s = !1, f = 0; f < h.length; f++) { if ($(h[f]).is(":visible") && !$(h[f]).hasClass("vis-menu-innerFolders")) { s = !1; break } s = !0 } s && (u.addClass("vis-menuSum-hide"), u.css("display", ""), u.parent().css("display", "")) } for (n && n.length > 0 && !o ? r = n.find(".vis-menuitm-backbtn") : (r = t.find(".vis-menuitm-backbtn"), n = null), e = 0; e < r.length; e++) { var u = $(r[e]).parent(), h = u.siblings(), s = !1; for (f = 0; f < h.length; f++) { if ($(h[f]).is(":visible")) { s = !1; break } s = !0 } s && (n == null || n.length == 0 || o) && (u.css("display", ""), u.addClass("vis-menuSum-hide")) } } } function h() { var e, t, f, r, n; if (i.find("input[type=radio]:checked").val() != "A") { for (e = u.find(".vis-navmenuItems-Container").find("ul"), u.find(".vis-menuSum-hide").removeClass("vis-menuSum-hide"), u.find(".vismenu-subSummaryNode").css("display", ""), t = 0; t < e.length; t++) { var o = $(e[t]), r = o.find("li"), f = !1; for (n = 0; n < r.length; n++) { if ($(r[n]).is(":visible")) { f = !1; break } f = !0 } f && o.closest(".vis-navSubMenu").addClass("vis-menuSum-hide") } for (e = u.find(".vis-navmenuItems-Container-allItems"), t = 0; t < e.length; t++) { if (f = !1, r = $(e[t]).find(".vis-navSubMenu"), r.length > 0) for (n = 0; n < r.length; n++) { if (!$(r[n]).hasClass("vis-menuSum-hide")) { f = !1; break } f = !0 } for (r = $(e[t]).find("li"), n = 0; n < r.length; n++) { if ($(r[n]).is(":visible")) { f = !1; break } f = !0 } f && $(e[t]).addClass("vis-menuSum-hide") } } else u.find(".vis-menuSum-hide").removeClass("vis-menuSum-hide") } function nt() { var u, i; if (!(n.Application.isMobile || n.Application.isIOS) || !document.documentElement) { for (u = t.find(".vis-navmenuItems-Container"), r = $("<div class='vis-nav-AllItems'><\/div>"), i = 0; i < u.length; i++)r.append($(u[i]).clone().removeAttr("style").addClass("vis-navmenuItems-Container-allItems")); r.hide(); t.find(".vis-navMainContent").append(r) } } function tt() { if ((n.Application.isMobile || n.Application.isIOS) && document.documentElement) { var i = a(); t.find("li").hide(); t.find(".vis-subNavFirstElement").show(); t.find(".vis-menu-innerFolders").show(); t.find("ul").show(); i == "A" ? t.find("li").show() : t.find('li > a[data-action="' + i + '"]').parent().show(); t.find(".vis-subNavFirstElement").css({ position: "relative", top: "0px" }); t.find(".fa-plus").removeClass("fa-plus").addClass("fa-minus"); t.find(".vismenu-parent").hide(); s(!0) } else t.find(".vis-navmenuItems-Container").hide(), r.find(".vis-navmenuItems-Container").removeAttr("style"), r.find(".vismenu-hidden-header").show(), t.find(".vis-navSelected").removeClass("vis-navSelected"), r.show(), t.find(".fa-plus").removeClass("fa-plus").addClass("fa-minus"), r.find(".vismenu-subSummaryNode").css("display", ""), h() } function l() { e = !e; var t = Math.round(f.find(".vis-navFilterIco").offset().left) - 84; n.Application.isRTL && i.css("right", "auto"); i.css("left", t); e ? i.show("slide-down") : i.hide("slide-up") } function a() { return i.find("input[type=radio]:checked").val() } function v(n) { o = n } function y() { e && l() } var u = null, p = "", w = "", c = null, e = !1, t = null, r = null, o = !1, f = null, i = $('<div class="vis-dialog vis-filter-dialog">'); return { init: b, closePopup: y, hideEmptyFolders: h, getFilterValue: a, hideMobileEmptyFolder: s, setIsMenuHeaderClicked: v } }(), r = function () { function r(t) { i.text(t); $("body").append(n) } var n = $('<div class="vis-wakeup-main"><\/div><div class="vis-wakeup-outerwrap"><div class="vis-wakeup-content"><div class="vis-wakeup-headsec"><\/div><div class="vis-wakeup-datawrp"><strong>Oh no! Something went wrong<\/strong><div class="vis-wakeup-text"><\/div><button>Refresh<\/button><\/div><\/div><\/div><\/div>'), t = n.find("button"), u = n.find(".vis-wakeup-sleep"), f = n.find(".vis-wakeup-awake"), i = n.find(".vis-wakeup-text"); t.on("click", function () { t.prop("disabled", !0); window.location.reload() }); return { init: r } }(), i = !1; $(document).ajaxError(function (t, u) { u.status === 401 ? i || (r.init(n.Msg.getMsg("UnAuthorized")), i = !0) : u.status === 999 ? i || (r.init(n.Msg.getMsg("WakeupText")), i = !0) : console.log(u.responseText) }) }(VIS), function (n) { function u() { function ot(n) { return i[n].dispose() } function rt(n, t) { v === n ? ut(t) : y === n ? ft(t) : (g === n || nt === n) && ht(t, n) } function o(i, r, u, f) { if (w) st(); else { var e = "fa fa-window-maximize"; r && (e = r); t.addTaskBarItem(i, e, u); f && i.slice(i.indexOf("_") + 1) != n.MRole.getHomePage() && (s.push(f), historyMgr.updateHistory(b(s.join(p)))) } } function st() { if (it++, it == Object.keys(i).length) { w = !1; for (var n in i) o(i[n].id, i[n].img, i[n].name, i[n].hid) } } function b(t) { return n.Utility.encode(t) } function a(n, r, u, e) { var o, h; return (t.unRegisterView(n), u && (o = s.indexOf(u), o > -1 && s.splice(o, 1), historyMgr.updateHistory(b(s.join(p)))), h = i[n], i[n] = null, delete i[n], f = null, e && pt(h)) ? !1 : !0 } function ut(t, i) { var f = null, u; return (t.toString().indexOf("&") != -1 && (f = t.split("&")[1], t = t.split("&")[0]), u = wt(t), u && !u.hasError) ? (u.refreshData(), u.show(r, o), c(u), k(), u) : (u = new n.AWindow, u.initWindow(t, i, o, v, f) && (u.onClosed = a, u.show(r), c(u), k()), u) } function k() { var n = ".w2ui-reset table{font-family: var(--v-c-font-family);"; n += Math.round(window.devicePixelRatio * 100) >= 100 ? "font-size: 0.85rem !important;}" : "font-size: 1rem !important;}"; this.styleTag ? (this.styleTag.remove(), $(".vis-gc-vtable").removeClass("w2ui-reset"), $(".vis-gc-vtable").addClass("w2ui-reset")) : $(".vis-gc-vtable").addClass("w2ui-reset"); this.styleTag = document.createElement("style"); this.styleTag.type = "text/css"; this.styleTag.innerHTML = n; $($("head")[0]).append(this.styleTag) } function ft(t, i) { t.toString().indexOf("&") != -1 && (i = t.split("&")[1], t = t.split("&")[0]); var u = new n.AWindow; n.MRole.getIsDisableMenu() && u.hideCloseIcon(!0); u.initForm(t, o, y, i) && (u.onClosed = a, u.show(r), c(u)) } function ht(t, i) { var u = new n.AWindow; u.initProcess(t, o, i, !0) && (u.onClosed = a, u.show(r), c(u)) } function ct(n) { n.onClosed = a; n.show(r); o(n.getId(), "fa fa-list-alt", n.getName(), null); c(n) } function c(n) { t.registerView(n.getId(), n.getRootLayout()); i[n.getId()] = n } function lt(t) { var i, e, u, o; try { if (historyMgr.updateHistory("#"), i = [], t.indexOf("&") != -1 && (t = t.split("&"), i = t[1].split(","), t = t[0]), t = n.Utility.decode(t), t.length > 0) for (w = !0, e = t.split(p), u = 0, o = e.length; u < o; u++)if (e[u].length > 0) { var s = e[u], f = s.substring(0, 1), r = s.substring(2); if (y === f) { if (!n.MRole.getFormAccess(r)) { console.log("No Form Access"); i && i.length > 0 && i.shift(); continue } i && i.length > 0 && (r += "&" + i.shift()) } else if (g === f || nt === f) { if (!n.MRole.getProcessAccess(r)) { console.log("No Process Access"); continue } } else if (v === f) { if (!n.MRole.getWindowAccess(r)) { console.log("No Window Access"); i && i.length > 0 && i.shift(); continue } i && i.length > 0 && (r += "&" + i.shift()) } rt(f, r) } } catch (h) { historyMgr.updateHistory("#"); console.log(h) } } function at(n) { i[n] && (f = i[n].refresh()) } function vt(n, t) { k(); for (var r in i) i[r].sizeChanged(n, t) } function yt(t, i) { if (t && i) { var r = t + "=" + i; r = b(r); window.open(n.Application.contextUrl + "#" + r); return } alert("improper data") } function pt(t) { var i, r; if (!n.Ini.getIsCacheWindow()) return !1; for (i = 0; i < e.length; i++)if (r = e[i], r.getAD_Window_ID() == t.getAD_Window_ID()) return !0; if (t.getAD_Window_ID() != 0) try { return e.push(t), e.length > 10 && e.splice(0, 1), !0 } catch (u) { return !1 } return !1 } function wt(n) { for (var i, t = 0; t < e.length; t++)if (i = e[t], i.getAD_Window_ID() == n) return e.splice(t, 1), i; return } function bt() { tt = t.getMenuDiv(); $(document).on("keydown", kt).on("keyup", dt); l = t.getNavSection(); u = l.find(".vis-app-action-nav-inner"); u.on("click", gt) } function kt(r) { if ($(".ui-widget-overlay.ui-front").length > 0 && (r.altKey && r.ctrlKey || r.altKey)) return !1; if (r.altKey && r.keyCode == 88) f.dispose(); else if (r.altKey && r.keyCode == 77) t.openMenu(); else if (tt.css("display") != "none" && r.keyCode == 27) t.closeMenu(); else if (r.altKey && r.keyCode == 76) n.ADialog.confirm("LogOut?", !0, "", "Confirm", function (n) { n && $("#logoutForm").trigger("submit") }); else if (!r.altKey && (r.ctrlKey || r.ctrlKey && r.shiftKey) && r.keyCode == 32) { if (!i || Object.keys(i).length <= 0) return; r.ctrlKey && r.shiftKey ? d(!0, !1) : d(!0, !0); r.preventDefault(); r.stopPropagation() } else r.altKey && r.ctrlKey && (r.keyCode == 37 || r.keyCode == 39) ? (f.navigateThroghtShortcut(r.keyCode == 39), r.preventDefault(), r.stopPropagation()) : f && typeof f.keyDown == "function" && f.keyDown.call(f, r) } function dt(n) { n.ctrlKey || (d(!1), h = !1) } function d(n, t) { var e, r; if (n) l.css("display", "flex"); else { h && (r = u.find(".vis-current-nav-window"), et(r)); return } h || (e = [], $.each(i, function (n, t) { t.img && t.img != "" || (t.img = "fa fa-list-alt"); var i = t.img; e.push("<div tabindex=" + n + ' data-wid="' + t.id + '" class="'); f.id == t.id && e.push("vis-current-nav-window "); e.push('vis-nav-window">'); e.push("<span>" + t.name + '<\/span><div class="vis-nav-content-wrap">'); i.indexOf(".") > -1 ? (i = i.replace("Thumb16x16", "Thumb140x120"), e.push('<img data-wid="' + t.id + '" class="vis-nav-window-img" src="' + i + '" alt="' + t.name + '"> <\/img>')) : e.push('<i data-wid="' + t.id + '" class="' + i + '"><\/i>'); e.push("<\/div><\/div>") }), u.append(e.join(" ")), h = !0); t ? (r = u.find(".vis-current-nav-window").next(), (!r || r.length <= 0) && (r = u.children().first())) : (r = u.find(".vis-current-nav-window").prev(), (!r || r.length <= 0) && (r = u.children().last())); u.find(".vis-current-nav-window").removeClass("vis-current-nav-window"); r.addClass("vis-current-nav-window").focus() } function et(n) { f.id != n.data("wid") && (t.toggleContainer(n.data("wid")), t.activateTaskBarItemUsingID(n)); l.css("display", "none"); u.empty(); h = !1 } function gt(n) { var t = $(n.target); (t.hasClass("vis-nav-window") || t.hasClass("vis-nav-window-img")) && et(t) } var g = "P", nt = "R", v = "W", y = "X", p = "!", s = [], i = {}, e = [], h = !1, l = null, u = null, tt = null, w = !1, it = 0, f = null; return bt(), { startAction: rt, restoreActions: lt, resize: at, sizeChanged: vt, startWindow: ut, startForm: ft, startCFrame: ct, startActionInNewTab: yt, closeFrame: ot } } function i(t) { var i, r; this.frame = new n.AWindow; this.frame.setName("Form"); this.onOpened = null; this.onClose = null; i = null; this.contentDispose = null; this.error = !1; this.windowNo = t || n.Env.getWindowNo(); this.hideH = !1; r = this; this.setContent = function (t) { t.getRoot && t.getRoot() || (n.Dialog.error("Error", !0, "class must define root element  and implement getRoot function"), t.dispose(), this.error = !0); t.sizeChanged || (t.sizeChanged = function () { }); t.refresh || (t.refresh = function () { }); t.dispose && (this.contentDispose = t.dispose, t.dispose = function () { r.dispose() }); i = t; this.frame.setCFrameContent(t, this.windowNo); this.hideH && this.frame.hideHeader(this.hideH) }; this.dispose = function () { this.disposing || (this.disposing = !0, this.contentDispose.call(i), this.frame && this.frame.dispose(), this.frame = null, this.onOpened = null, this.onClose = null, i = null, this.contentDispose = null, r = null) } } var t = n.desktopMgr, r = t.getMainConatiner(); i.prototype.setTitle = function (n) { this.frame.setTitle(n) }; i.prototype.getTitle = function () { return this.frame.getTitle() }; i.prototype.setName = function (n) { this.frame.setName(n) }; i.prototype.show = function () { if (this.error) { this.dispose(); return } n.viewManager.startCFrame(this.frame); this.onOpened && this.onOpened() }; i.prototype.hideHeader = function (n) { this.hideH = n; this.frame.cPanel && this.frame.hideHeader(n) }; n.viewManager = u(); n.CFrame = i }(VIS); VIS.context.m_map = {}; VIS.context.getContext = function (n) { if (n == null) throw new ArgumentException("Require Context"); if (arguments.length > 2) return typeof arguments[1] == "number" ? this.getWindowTabContext(arguments[0], arguments[1], arguments[2]) : this.getWindowContext(arguments[0], arguments[1], arguments[2]); if (arguments.length == 2) return this.getWindowContext(arguments[0], arguments[1]); var t = VIS.context.ctx[n]; return t ? t : n == "#AD_User_ID" ? VIS.context.getContext("#" + n) : n == "#AD_User_Name" ? VIS.context.getContext("#" + n) : "" }; VIS.context.getWindowContext = function (n, t, i, r) { var u, e, f; if (t == null) throw new ArgumentException("Require Context"); return typeof arguments[1] == "number" && arguments.length > 2 ? VIS.context.getTabRecordContext(arguments[0], arguments[1], arguments[2], r) : (u = "", typeof t == "number" && (u = "-" + t, t = i, i = r), e = n + u + "|" + t, u = "", typeof t == "number" && (u = "-" + t, t = i, i = r), e = n + u + "|" + t, f = "", this.m_map[n] && (f = this.m_map[n][e]), !f || f == "") ? t.startsWith("#") || t.startsWith("$") ? VIS.context.getContext(t) : i ? "" : VIS.context.getContext("#" + t) : f }; VIS.context.getWindowTabContext = function (n, t, i) { if (i == null) throw new ArgumentException("Require Context"); var r = ""; return (this.m_map[n] && (r = this.m_map[n][n + "|" + t + "|" + i]), VIS.EnvConstants.TAB_INFO == t) ? r != null ? r : "" : !r || r == "" ? VIS.context.getWindowContext(n, i, !1) : r }; VIS.context.getTabRecordContext = function (n, t, i, r) { if (i == null) throw new ArgumentException("Require Context"); var u = ""; return (this.m_map[n] && (u = this.m_map[n][n + "-" + t + "|" + i]), !u || u == "") ? VIS.context.getWindowContext(n, i, r) : u }; VIS.context.setTabRecordContext = function (n, t, i, r) { i != null && (this.m_map[n] || (this.m_map[n] = {}), this.m_map[n][n + "-" + t + "|" + i] = r == null || r === "" ? null : r) }; VIS.context.setContext = function (n, t) { return arguments.length == 4 ? this.setWindowTabContext(arguments[0], arguments[1], arguments[2], arguments[3]) : arguments.length == 3 ? this.setWindowContext(arguments[0], arguments[1], arguments[2]) : VIS.context.ctx[n] = t, n }; VIS.context.setWindowContext = function (n, t, i, r) { if (t != null) { this.m_map[n] || (this.m_map[n] = {}); var u = ""; typeof t == "number" && (u = "-" + t, t = i, i = r); this.m_map[n][n + u + "|" + t] = i == null || i === "" ? null : i } }; VIS.context.setWindowTabContext = function (n, t, i, r) { i != null && (this.m_map[n] || (this.m_map[n] = {}), this.m_map[n][n + "|" + t + "|" + i] = r == null || String(r).equals("") ? null : r) }; VIS.context.clearTabContext = function (n, t) { var i = this.m_map[n]; for (var r in i) r.startsWith(n + "-" + t + "|") && delete i[r] }; VIS.context.getAD_User_ID = function () { return VIS.context.getContextAsInt("##AD_User_ID") }; VIS.context.getAD_User_Name = function () { return this.getContext("#AD_User_Name") }; VIS.context.getAD_Role_ID = function () { return this.getContextAsInt("#AD_Role_ID") }; VIS.context.getAD_Role_Name = function () { return this.getContext("#AD_Role_Name") }; VIS.context.getAD_Client_ID = function () { return VIS.context.getContextAsInt("#AD_Client_ID") }; VIS.context.getAD_Client_Name = function () { return this.getContext("#AD_Client_Name") }; VIS.context.getAD_Org_ID = function () { return VIS.context.getContextAsInt("#AD_Org_ID") }; VIS.context.getAD_Language = function () { return VIS.context.getContext("#AD_Language") }; VIS.context.setAutoCommit = function (n, t) { VIS.context.setWindowContext(n, "AutoCommit", t ? "Y" : "N") }; VIS.context.setAutoNew = function (n, t) { VIS.context.setWindowContext(n, "AutoNew", t ? "Y" : "N") }; VIS.context.isAutoNew = function () { var n = VIS.context.getContext("AutoNew"); return n != null && n === "Y" ? !0 : !1 }; VIS.context.getStdPrecision = function () { return VIS.context.getContext("#StdPrecision") }; VIS.context.setStdPrecision = function () { return VIS.context.getContext("#StdPrecision") }; VIS.context.getIsAutoNew = function (n) { var t = this.getWindowContext(n, "AutoNew", !1); return t != null && t != "" ? t.equals("Y") ? !0 : !1 : this.isAutoNew() }; VIS.context.isAutoCommit = function () { var n = VIS.context.getContext("AutoCommit"); return n != null && n === "Y" ? !0 : !1 }; VIS.context.setContextOfWindow = function (n, t) { if (n && t) { for (prop in n) VIS.context.setWindowContext(t, prop, n[prop]); n = null } }; VIS.context.getContextAsInt = function (n, t, i) { var r = ""; if (r = arguments.length > 1 && typeof arguments[1] == "number" ? this.getWindowTabContext(arguments[0], arguments[1], arguments[2]) : arguments.length > 1 && typeof arguments[0] == "number" ? this.getWindowContext(n, t, i) : this.getContext(arguments[0]), r.length == 0) return 0; try { return parseInt(r) } catch (u) { } return 0 }; VIS.context.getWindowContextAsInt = function (n, t, i) { var r = this.getWindowContext(n, t, i); if (r.length == 0) return 0; try { return parseInt(r) } catch (u) { } return 0 }; VIS.context.getContextAsTime = function (n, t) { var i = this.getContext(n, t, !1); return i == null || i.length == 0 ? Date.now().getTime() : new Date(i).getTime() }; VIS.context.getShowClientOrg = function () { return this.getContextAsInt("#ClientOrgLevel") }; VIS.context.removeWindow = function (n) { this.m_map[n] = null; delete this.m_map[n]; key = null }; VIS.context.getWindowCtx = function (n) { var t = {}; return $.extend(t, this.ctx), n && $.extend(t, this.m_map[n]), t }; VIS.context.getEntireCtx = function () { var n = {}, t; $.extend(n, this.ctx); for (t in this.m_map) this.m_map.hasOwnProperty(t) && $.extend(n, this.m_map[t]); return n }; VIS.context.isSOTrx = function (n) { var t = !1; return (t = n ? this.getWindowContext(n, "IsSOTrx", !0) : this.getContext("IsSOTrx"), t != null && t.equals("Y")) ? !0 : !1 }; VIS.context.setIsSOTrx = function () { arguments.length == 2 ? this.setContext(arguments[0], "IsSOTrx", arguments[1] ? "Y" : "N") : this.setContext("IsSOTrx", arguments[0] ? "Y" : "N") }; VIS.context.getIsUseCrystalReportViewer = function () { return VIS.context.getContext("#USE_CRYSTAL_REPORT_VIEWER") == "Y" }; VIS.context.getLocationBulkReload = function () { return VIS.context.getContext("#LOCATION_NAME_BULK_REQUEST") == "Y" }; VIS.Msg = {}; VIS.Msg.elements = {}; VIS.I18N.getLabel = function (n, t, i, r) { var u, f; if (!VIS.I18N.labels[n]) return i && r && VIS.I18N.getLabelFromServer(n, t, i, r), "[" + n + "]"; if (u = VIS.I18N.labels[n], t && t.length && t.length > 0) for (f = 0; f < t.length; f++)u = u.replace("%" + f, t[f]); return i && r && (Object.prototype.toString.call(i[r]) === "[object Function]" ? i[r](u) : i[r] = u), u }; VIS.I18N.getLabelFromServer = function (n) { return "UNDEFINED " + n }; VIS.Msg.getMsg = function (n, t, i) { if (!VIS.I18N.labels[n]) return "[" + n + "]"; label = VIS.Utility.Util.cleanMnemonic(VIS.I18N.labels[n]); var r = label.split("      "); return t || (label = r[0]), i && r.length > 1 && (label = r[1]), label }; VIS.Msg.parseTranslation = function (n, t) { var u; if (t == null || t.length == 0) return t; for (var i = t, e, f = "", r = i.indexOf("@"); r != -1;) { if (f += i.substring(0, r), i = i.substring(r + 1, i.length), u = i.indexOf("@"), u < 0) { i = "@" + i; break } e = i.substring(0, u); f += this.translate(n, e); i = i.substring(u + 1, i.length); r = i.indexOf("@") } return f + i }; VIS.Msg.translate = function (n, t, i) { if (t == null || t.length == 0) return t; if (i) { var r = null; if ($.ajax({ url: VIS.Application.contextUrl + "JsonData/GetTranslatedText", type: "POST", datatype: "json", contentType: "application/json; charset=utf-8", async: !1, data: JSON.stringify({ Columns: t, AD_Language: VIS.Env.getAD_Language(n) }) }).done(function (n) { r = n }), r) return JSON.parse(r); r } else return VIS.Msg.translate3(VIS.Env.getAD_Language(n), n.isSOTrx(), t) }; VIS.Msg.getElement = function (n, t) { return VIS.Msg.getElement3(VIS.Env.getAD_Language(n), t, !0) }; VIS.Msg.getElement1 = function (n) { return VIS.Msg.getElement3(VIS.Env.getAD_Language(VIS.Env.getCtx()), n, !0) }; VIS.Msg.translate3 = function (n, t, i) { var u, r; return i == null || i.equals("") ? "" : (u = n, (u == null || u.length == 0) && (u = VIS.Env.getBaseAD_Language()), r = VIS.Msg.getElement3(u, i, t), !r.equals("")) ? r.trim() : (r = VIS.Msg.getMsg(i), r && r.length > 0) ? r : i }; VIS.Msg.getElement3 = function (n, t, i) { function a(n, t, i) { var r = null; return $.ajax({ url: l, type: "POST", datatype: "json", contentType: "application/json; charset=utf-8", async: t, data: JSON.stringify(n) }).done(function (n) { r = n; i && i(n) }), r } var c = VIS.Application.contextUrl, l = c + "JsonData/JDataSetWithCode", h = function (n, t, i) { var f = i ? !0 : !1, u = { sql: n, page: 1, pageSize: 0 }, r; return t && (u.param = t), r = null, a(u, f, function (n) { r = (new VIS.DB.DataReader).toJson(n); i && i(r) }), r }, r, e, s; if (t == null || t.equals("")) return ""; if (r = n, (r == null || r.length == 0) && (r = VIS.Env.getBaseAD_Language()), VIS.Msg.elements[t]) return VIS.Msg.elements[t]; var u = "", o = "", f = null; try { r == null || r.length == 0 || VIS.Env.isBaseLanguage(r, "AD_Element") ? (o = "VIS_73", e = [], e[0] = new VIS.DB.SqlParam("@ColumnName", t.toUpper()), f = h(o, e)) : (o = "VIS_74", e = [], e[0] = new VIS.DB.SqlParam("@ColumnName", t.toUpper()), e[1] = new VIS.DB.SqlParam("@AD_Language", r), f = h(o, e)); f.read() && (u = f.getString(0), i || (s = f.getString(1), s != null && s.length > 0 && (u = s))); f.close() } catch (v) { f.close() } return u != null && (u = u.trim()), VIS.Msg.elements[t] = u, u }; VIS.MRole.getDefault = function () { return VIS.MRole }; VIS.MRole.log = VIS.Logging.VLogger.getVLogger("MRole"); VIS.MRole.canUpdate = function (n, t, i, r, u) { var e = this.vo.UserLevel.trim(), f = !0, o = ""; return n == 0 && t == 0 && e.indexOf("S") == -1 ? (f = !1, o += "S") : n != 0 && t == 0 && e.indexOf("C") == -1 ? e.indexOf("O") == -1 && this.getIsOrgAccess(t, !0) || (f = !1, o += "C") : n != 0 && t != 0 && e.indexOf("O") == -1 && (f = !1, o += "O"), f && (f = this.getIsTableAccess(i, !1)), f && r != 0 && (f = this.getIsRecordAccess(i, r, !1)), !f && u && VIS.MRole.log.warning("AccessTableNoUpdate => AD_Client_ID=" + n + ", AD_Org_ID=" + t + ", UserLevel=" + e + " => missing=" + o), f }; VIS.MRole.getIsColumnAccess = function (n, t, i) { var u, f, r; if (!this.getIsTableAccess(n, i)) return !1; for (u = !0, f = this.vo.columnAccess, r = 0; r < f.length; r++)if (f[r].IsExclude) { if (f[r].AD_Table_ID == n && f[r].AD_Column_ID == t && (u = i ? !1 : !f[r].IsReadOnly, !u)) return u } else if (f[r].AD_Table_ID == n && f[r].AD_Column_ID == t && (u = i ? !0 : !f[r].IsReadOnly, !u)) return u; return !u, u }; VIS.MRole.getIsTableAccessLevel = function (n, t) { var i, r; return t ? !0 : (i = this.vo.tableAccessLevel[n], i == null) ? !1 : i.equals(VIS.Consts.ACCESSLEVEL_All) ? !0 : (r = this.vo.UserLevel.trim(), r.indexOf("S") != -1 && (i.equals(VIS.Consts.ACCESSLEVEL_SystemOnly) || i.equals(VIS.Consts.ACCESSLEVEL_SystemPlusClient))) ? !0 : r.indexOf("C") != -1 && (i.equals(VIS.Consts.ACCESSLEVEL_ClientOnly) || i.equals(VIS.Consts.ACCESSLEVEL_SystemPlusClient)) ? !0 : r.indexOf("O") != -1 && (i.equals(VIS.Consts.ACCESSLEVEL_Organization) || i.equals(VIS.Consts.ACCESSLEVEL_ClientPlusOrganization)) ? !0 : !1 }; VIS.MRole.canView = function (n) { var i = this.vo.UserLevel.trim(), t = !0; return (VIS.Consts.ACCESSLEVEL_All.equals(n) ? t = !0 : VIS.Consts.ACCESSLEVEL_SystemOnly.equals(n) && i.indexOf("S") == -1 ? t = !1 : VIS.Consts.ACCESSLEVEL_ClientOnly.equals(n) && i.indexOf("C") == -1 ? t = !1 : VIS.Consts.ACCESSLEVEL_Organization.equals(n) && i.indexOf("O") == -1 ? t = !1 : !VIS.Consts.ACCESSLEVEL_ClientPlusOrganization.equals(n) || i.indexOf("C") != -1 || i.indexOf("O") != -1 ? !VIS.Consts.ACCESSLEVEL_SystemPlusClient.equals(n) || i.indexOf("S") != -1 || i.indexOf("C") != -1 || (t = !1) : t = !1, t) ? t : (VIS.MRole.log.warning("AccessTableNoView", "Required=" + n + "() != UserLevel=" + i), t) }; VIS.MRole.getIsTableAccess = function (n, t) { var u, i, r; if (!this.getIsTableAccessLevel(n, t)) return !1; for (u = !0, i = this.vo.tableAccess, r = 0; r < i.length; r++)if (VIS.Consts.ACCESSTYPERULE_Accessing.equals(i[r].AccessTypeRule)) if (i[r].IsExclude) { if (i[r].AD_Table_ID === n) return t ? i[r].IsReadOnly : !1 } else if (u = !1, i[r].AD_Table_ID == n) return t ? !0 : !i[r].IsReadOnly; return !u, i = null, u }; VIS.MRole.getIsCanReport = function (n) { var r, t, i; if (!this.vo.IsCanReport || !this.getIsTableAccess(n, !0)) return !1; for (r = !0, t = this.vo.tableAccess, i = 0; i < t.length; i++)if (VIS.Consts.ACCESSTYPERULE_Reporting.equals(t[i].AccessTypeRule)) if (t[i].IsExclude) { if (t[i].AD_Table_ID === n) return t[i].IsCanReport } else if (r = !1, t[i].AD_Table_ID === n) return t[i].IsCanReport; return t = null, r }; VIS.MRole.getIsCanExport = function (n) { var r, t, i; if (!this.vo.IsCanExport || !this.getIsTableAccess(n, !0) || !this.getIsCanReport(n)) return !1; for (r = !0, t = this.vo.tableAccess, i = 0; i < t.length; i++)if (VIS.Consts.ACCESSTYPERULE_Exporting.equals(t[i].AccessTypeRule)) if (t[i].IsExclude) { if (t[i].AD_Table_ID === n) return t[i].IsCanExport } else if (r = !1, t[i].AD_Table_ID === n) return t[i].IsCanExport; return t = null, r }; VIS.MRole.getIsOrgAccess = function (n, t) { var i, r; if (this.vo.IsAccessAllOrgs || n == 0 && !t) return !0; for (i = this.vo.orgAccess, r = 0; r < i.length; r++)if (i[r].AD_Org_ID === n) return t ? i[r].readOnly ? !1 : !0 : !0; return i = null, !1 }; VIS.MRole.getIsRecordAccess = function (n, t, i) { for (var e = !0, u = this.vo.recordAccess, r = null, f = 0; f < u.length; f++)if (r = u[f], r.AD_Table_ID === n) if (r.IsExclude) { if (r.Record_ID === t) return u = null, i ? r.IsReadOnly : !1 } else if (e = !1, r.Record_ID === t) return u = null, i ? !0 : !r.IsReadOnly; return e }; VIS.MRole.getIsSharedRecordAccess = function (n, t) { for (var r = this.vo.sharedRecordAccess, i = null, f = !1, u = 0; u < r.length; u++)if ((i = r[u], i.AD_Table_ID == n) && i.Record_ID == t) return r = null, f = !0, !i.IsReadOnly; return !0 }; VIS.MRole.getClientWhere = function (n) { var t, r, u, i, e, f; if (this.vo.IsAccessAllOrgs) return n || this.vo.AD_Client_ID == 0 ? "AD_Client_ID=" + this.vo.AD_Client_ID : "AD_Client_ID IN (0," + this.vo.AD_Client_ID + ")"; for (t = [], n || t.push("0"), r = 0; r < this.vo.orgAccess.length; r++)u = this.vo.orgAccess[r].AD_Client_ID.toString(), t.indexOf(u) < 0 && t.push(u), u = null; for (i = new StringBuilder, e = !0, f = 0; f < t.length; f++)i.length() > 0 && (i.append(","), e = !1), i.append(t[f]); return (t = null, e) ? i.length() > 0 ? "AD_Client_ID=" + i.toString() : (this.log.log(VIS.Logging.Level.SEVERE, "No Access Org records"), "AD_Client_ID=-1") : "AD_Client_ID IN(" + i.toString() + ")" }; VIS.MRole.getOrgWhere = function (n, t) { var i, f, e, r, s; if (this.vo.IsAccessAllOrgs) return null; for (i = [], t || i.push("0"), f = this.vo.orgAccess, e = 0; e < f.length; e++)r = f[e].AD_Org_ID.toString(), t ? r.readOnly || i.indexOf(r) < 0 && i.push(r) : i.indexOf(r) < 0 && i.push(r); if (f = null, i.length == 1) return "COALESCE(" + (n == null ? "" : n + ".") + "AD_Org_ID,0)=" + i[0]; if (i.length == 0) return this.log.log(VIS.Logging.Level.SEVERE, "No Access Org records"), (n == null ? "" : n + ".") + "AD_Org_ID=-1"; var o = new StringBuilder, u = new StringBuilder, h = 0; for (s = 0; s < i.length; s++)u.length() > 0 && u.append(","), u.append(i[s]), h++, (h % 999 == 0 || h == i.length) && (o.length() > 0 && o.append(" OR "), o.append("COALESCE(" + (n == null ? "" : n + ".") + "AD_Org_ID,0) IN(").append(u.toString()).append(")"), u = null, u = new StringBuilder); return "(" + o.toString() + ")" }; VIS.MRole.getAD_Table_ID = function (n) { var t = this.vo.tableName[n]; return t != null ? t : 0 }; VIS.MRole.getSynonym = function (n) { var t = this.columnSynonym[n]; return t ? t : null }; VIS.MRole.getKeyColumnName = function (n, t) { var u = this.getSynonym(t), i, r; if (u == null) return t; for (i = 0; i < n.length; i++)if (r = n[i], t.equals("AD_User_ID")) { if (r.getTableName().equals("AD_User")) return t } else if (t.equals("AD_ElementValue_ID") && r.getTableName().equals("AD_ElementValue")) return t; return u }; VIS.MRole.getDependentAccess = function (n, t, i, r) { var u, f; if (t.length == 0 && i.length == 0) return ""; if (t.length != 0 && i.length != 0 && this.log.warning("Mixing Include and Excluse rules - Will not return values"), u = new StringBuilder(" AND "), r && u.append(" ( "), t.length == 1) u.append(n).append("=").append(t[0]); else if (t.length > 1) { for (u.append(n).append(" IN ("), f = 0; f < t.length; f++)f > 0 && u.append(","), u.append(t[f]); u.append(")") } else if (i.length == 1) u.append(n).append("<>").append(i[0]); else if (i.length > 1) { for (u.append(n).append(" NOT IN ("), f = 0; f < i.length; f++)f > 0 && u.append(","), u.append(i[f]); u.append(")") } return r && u.append(" OR ").append(n).append(" IS NULL").append(" ) "), u.toString() }; VIS.MRole.getDependentRecordWhereColumn = function (n, t) { var f = t, e = n.indexOf(t), u = e - 1, i = n.charAt(u), r; if (i == ".") { for (r = new StringBuilder; i != " " && i != "," && i != "(";)r.insert(0, i), i = n.charAt(--u); return r.append(t), r.toString() } return f }; VIS.MRole.getRecordWhere = function (n, t, i) { for (var r, h, o = new StringBuilder, s = new StringBuilder, e = !1, u = this.vo.recordAccess, f = 0; f < u.length; f++)u[f].AD_Table_ID == n && (u[f].IsExclude ? (s.length() == 0 ? s.append(t).append(" NOT IN (") : s.append(","), s.append(u[f].Record_ID)) : i && u[f].IsReadOnly || (o.length() == 0 ? o.append(t).append(" IN (") : o.append(","), o.append(u[f].Record_ID)), e = e || u[f].IsIncludeNull); return r = new StringBuilder, s.length() > 0 && (e && r.append("("), r.append(s).append(")"), e && r.append(" OR ").append(t).append(" IS NULL )"), e = !1), o.length() > 0 && (r.length() > 0 && r.append(" AND "), e && r.append("("), r.append(o).append(")"), e && r.append(" OR ").append(t).append(" IS NULL )")), this.vo.IsPersonalAccess || !this.vo.tableData[n].IsView && this.vo.tableData[n].HasKey && (h = " NOT IN ( SELECT Record_ID FROM AD_Private_Access WHERE AD_Table_ID = " + n + " AND AD_User_ID <> " + this.vo.AD_User_ID + " AND IsActive = 'Y' )", r.length() > 0 && r.append(" AND "), r.append(t).append(h)), u = null, r.toString() }; VIS.MRole.getDocWhere = function (n) { function s(n, t, i) { var r = null; return $.ajax({ url: e, type: "POST", datatype: "json", contentType: "application/json; charset=utf-8", async: t, data: JSON.stringify(n) }).done(function (n) { r = n; i && i(n) }), r } var f = VIS.Application.contextUrl, e = f + "JsonData/JDataSetWithCode", o = function (n, t, i) { var u = i ? !0 : !1, f = { sql: n, page: 1, pageSize: 0 }, r = null; return s(f, u, function (n) { t = (new VIS.DB.DataSet).toJson(n); var t = (new VIS.DB.DataSet).toJson(n); r = t.getTable(0).getRows().length > 0 ? t.getTable(0).getRow(0).getCell(0) : null; t.dispose(); t = null; u && i(r) }), r }, t, u; if (!this.vo.IsUseBPRestrictions) return ""; var i = !1, r = []; return (r[0] = new VIS.DB.SqlParam("@TableName", n), t = o("VIS_101", r), i = (t ? parseInt(t) : 0) != 0, !i) ? "" : (u = VIS.context.getAD_User_ID(), $.ajax({ type: "Get", async: !1, url: VIS.Application.contextUrl + "Form/GetDocWhere", data: { AD_User_ID: u, TableName: n }, success: function (n) { docAccess = n }, error: function (n) { console.log(n) } }), docAccess) }; VIS.MRole.addAccessSQL = function (n, t, r, u, f) { var a, h, o, d, ft, s, b, p, k, v, g, w, y, it, l, ht, rt; r && VIS.Utility.Util.isEmpty(t) && (r = !1); var e = new StringBuilder, st = "", ut = n.lastIndexOf(" ORDER BY "); for (ut != -1 ? (st = n.substring(ut), e.append(n.substring(0, ut))) : e.append(n), a = new VIS.AccessSqlParser(e.toString()), h = a.getTableInfo(a.getMainSqlIndex()), a.getMainSql().indexOf(" WHERE ") == -1 ? e.append(" WHERE ") : e.append(" AND "), o = "", h.length > 0 && (h[0].getTableName().equals(t) || h[0].getSynonym().equals(t)) && (o = h[0].getSynonym(), VIS.Utility.Util.isEmpty(o) && (o = h[0].getTableName())), !VIS.Utility.Util.isEmpty(t) && VIS.Utility.Util.isEmpty(o) && (d = "TableName not correctly parsed - TableNameIn=" + t + " - " + a, h.length > 0 && (d += " - #1 " + h[0]), d += "\n = " + n, this.log.log(VIS.Logging.Level.SEVERE, d), o = t), r && !VIS.Utility.Util.isEmpty(o) && e.append(o).append("."), e.append(this.getClientWhere(u)), this.vo.IsAccessAllOrgs || f || (e.append(" AND "), r && !VIS.Utility.Util.isEmpty(o) ? e.append(this.getOrgWhere(o, u)) : e.append(this.getOrgWhere(null, u))), this.vo.IsUseBPRestrictions && (ft = this.getDocWhere(o), ft.length() > 0 && (e.append(" AND "), e.append(ft))), s = 0, i = 0; i < h.length; i++) { if (b = h[i], p = b.getTableName(), s = this.getAD_Table_ID(p), s != 0 && !this.vo.IsAccessAllOrgs && f && (k = b.getSynonym(), (k == null || k.isEmpty()) && (k = p), e.append(" AND "), e.append(this.getOrgWhere(k, u))), s != 0 && !this.getIsTableAccess(s, !u)) { e.append(" AND 1=3"); this.log.fine("No access to AD_Table_ID=" + s + " - " + p + " - " + e); break } v = ""; r && (v = b.getSynonym(), v.length == 0 && (v = p), v += "."); v += p + "_ID"; g = this.getRecordWhere(s, v, u); g.length > 0 && (e.append(" AND ").append(g), this.log.finest("Record access - " + g)) } b = null; w = a.getMainSql(); s = 0; var nt = null, et = [], ot = [], tt = !1, c = this.vo.recordDependentAccess; for (i = 0; i < c.length; i++)(y = this.getKeyColumnName(a.getTableInfo(a.getMainSqlIndex()), c[i].KeyColumnName), y != null) && (it = w.indexOf(y), it != -1) && (l = w.charAt(it - 1), l == "," || l == "." || l == " " || l == "(") && (l = w.charAt(it + y.length), l == "," || l == " " || l == ")") && (s != 0 && s != c[i].AD_Table_ID && e.append(this.getDependentAccess(nt, et, ot, tt)), s = c[i].AD_Table_ID, c[i].IsExclude ? (ot.push(c[i].Record_ID), this.log.fine("Exclude " + y + " - " + c[i])) : u && c[i].IsReadOnly || et.push(c[i].Record_ID), tt = tt || c[i].IsIncludeNull, ht = null, ht != null ? (rt = "", nt = rt == null || rt.length() == 0 ? this.getDependentRecordWhereColumn(w, y) : rt) : nt = this.getDependentRecordWhereColumn(w, y)); return e.append(this.getDependentAccess(nt, et, ot, tt)), e.append(st), e.toString() }; VIS.MRole.getWindowAccess = function (n) { return this.vo.windowAccess[n] ? !0 : !1 }; VIS.MRole.getFormAccess = function (n) { return this.vo.formAccess[n] ? !0 : !1 }; VIS.MRole.getProcessAccess = function (n) { return this.vo.processAccess[n] ? !0 : !1 }; VIS.MRole.getIsClientAccess = function (n, t) { var r, i; if (n == 0 && !t) return !0; if (this.vo.IsAccessAllOrgs) return this.vo.AD_Client_ID == n; for (r = this.vo.orgAccess, i = 0; i < r.length; i++)if (r[i].AD_Client_ID == n && (!t || !r[i].readOnly)) return !0; return !1 }; VIS.MRole.getIsShowPreference = function () { return this.vo.IsShowPreference }; VIS.MRole.getName = function () { return this.vo.Name }; VIS.MRole.getPreferenceType = function () { return this.vo.PreferenceType }; VIS.MRole.getIsDisplayClient = function () { return this.vo.IsDisplayClient }; VIS.MRole.getIsDisplayOrg = function () { return this.vo.IsDisplayOrg }; VIS.MRole.getIsPersonalLock = function () { return this.vo.IsPersonalLock }; VIS.MRole.getIsShowSharedRecord = function () { return this.vo.ShowSharedRecords }; VIS.MRole.getMaxQueryRecords = function () { return this.vo.MaxQueryRecords }; VIS.MRole.getIsQueryMax = function (n) { var t = this.getMaxQueryRecords(); return t > 0 && n > t }; VIS.MRole.getIsShowAcct = function () { return this.vo.IsShowAcct }; VIS.MRole.getIsOverwritePriceLimit = function () { return this.vo.IsOverwritePriceLimit }; VIS.MRole.getIsOverrideReturnPolicy = function () { return this.vo.IsOverrideReturnPolicy }; VIS.MRole.getIsDisableMenu = function () { return this.vo.IsDisableMenu }; VIS.MRole.getHomePage = function () { return this.vo.HomePage }; VIS.MRole.toStringX = function (n) { var t = new StringBuilder; return t.append(VIS.Msg.translate(n, "AD_Role_ID")).append("=").append(this.getName()).append(" - ").append(VIS.Msg.translate(n, "IsCanExport")).append("=").append(this.getIsCanExport()).append(" - ").append(VIS.Msg.translate(n, "IsCanReport")).append("=").append(this.getIsCanReport()).append(VIS.Env.NL).append(VIS.Env.NL), t.toString() }, function (n, t) { function r() { function w(n) { if (n) window.setTimeout(function () { c.focus(); u.on("keydown", function (n) { if (n.keyCode == 9) l.is(":focus") ? c.focus() : c.is(":focus") ? l.focus() : c.focus(), n.preventDefault(), n.stopPropagation(); else if (n.keyCode == 27) return n.preventDefault(), n.stopPropagation(), k(n), !1 }) }, 100); else { u.focus(); u.on("keydown", function (n) { return n.preventDefault(), n.stopPropagation(), k(n), !1 }) } } function k(n) { n.stopPropagation(); f && f(); f = null; b() } function b() { a.hide(); u.css({ position: "inherit", display: "none" }); r.find(".vis-Dialog-buttons").css("display", "none"); l && l.off("click"); c && c.off("click"); u.off("keydown") } function g(t, i, c) { f = c; try { } catch (l) { } u.css({ position: "absolute", display: "flex" }); r.show(); e.removeClass(); e.addClass("vis-PopupHeader-alert vis-PopupHeader-alert-info"); h.removeClass(); h.addClass("vis-PopupContent-alert vis-PopupContent-alert-info"); o.removeClass(); o.addClass("vis-popup-headerContainer vis-popup-headerContainer-info"); y.attr("src", n.Application.contextUrl + "Areas/VIS/Images/base/info-icon.png"); _prodFound = !0; p.text(t); i ? s.text(n.Msg.getMsg(i)) : s.text(n.Msg.getMsg("Info")); a.show(); r.fadeIn(300); w(!1) } function nt(t, i, v) { f = v; try { } catch (d) { } u.css({ position: "absolute", display: "flex" }); r.show(); e.removeClass(); e.addClass("vis-PopupHeader-alert vis-PopupHeader-alert-info"); h.removeClass(); h.addClass("vis-PopupContent-alert vis-PopupContent-alert-info vis-PopupContent-alert-Confirm"); o.removeClass(); o.addClass("vis-popup-headerContainer vis-popup-headerContainer-info"); y.attr("src", n.Application.contextUrl + "Areas/VIS/Images/base/confirm-icon.png"); var k = r.find(".vis-Dialog-buttons"); k.css("display", "inherit"); l = k.find(".vis-Dialog-buttons-OK"); c = k.find(".vis-Dialog-buttons-Cancel"); _prodFound = !0; p.text(t); i ? s.text(n.Msg.getMsg(i)) : s.text(n.Msg.getMsg("Confirm")); a.show(); r.fadeIn(300); l.one("click", function () { b(); k.css("display", "none"); f(!0) }); c.one("click", function () { b(); k.css("display", "none"); f(!1) }); w(!0) } function tt(t, i, k, d) { f = d; try { } catch (nt) { } u.css({ position: "absolute", display: "flex" }); r.show(); e.removeClass(); e.addClass("vis-PopupHeader-alert vis-PopupHeader-alert-info"); h.removeClass(); h.addClass("vis-PopupContent-alert vis-PopupContent-alert-info vis-PopupContent-alert-Confirm"); o.removeClass(); o.addClass("vis-popup-headerContainer vis-popup-headerContainer-info"); y.attr("src", n.Application.contextUrl + "Areas/VIS/Images/base/confirm-icon.png"); var g = r.find(".vis-Dialog-buttons"); g.css("display", "inherit"); l = g.find(".vis-Dialog-buttons-OK"); c = g.find(".vis-Dialog-buttons-Cancel"); _prodFound = !0; p.text(t); v.empty(); v.css("display", "block"); v.append(k); i ? s.text(n.Msg.getMsg(i)) : s.text(n.Msg.getMsg("Confirm")); a.show(); r.fadeIn(300); l.one("click", function () { b(); g.css("display", "none"); v.css("display", "none"); v.empty(); f(!0) }); c.one("click", function () { b(); g.css("display", "none"); v.css("display", "none"); v.empty(); f(!1) }); w(!0) } function it(t, i, c) { f = c; try { } catch (l) { } _prodFound = !0; u.css({ position: "absolute", display: "flex" }); r.show(); e.removeClass(); e.addClass("vis-PopupHeader-alert vis-PopupHeader-alert-warn"); h.removeClass(); h.addClass("vis-PopupContent-alert vis-PopupContent-alert-warn"); o.removeClass(); o.addClass("vis-popup-headerContainer vis-popup-headerContainer-warn"); y.attr("src", n.Application.contextUrl + "Areas/VIS/Images/base/warning-icon.png"); p.text(t); i ? s.text(n.Msg.getMsg(i)) : s.text(n.Msg.getMsg("Warning")); a.show(); w(!1) } function rt(t, i, c) { f = c; try { } catch (l) { } _prodFound = !0; u.css({ position: "absolute", display: "flex" }); r.show(); e.removeClass(); e.addClass("vis-PopupHeader-alert vis-PopupHeader-alert-error"); h.removeClass(); h.addClass("vis-PopupContent-alert vis-PopupContent-alert-error"); o.removeClass(); o.addClass("vis-popup-headerContainer vis-popup-headerContainer-error"); y.attr("src", n.Application.contextUrl + "Areas/VIS/Images/base/error-icon.png"); p.text(t); i ? s.text(n.Msg.getMsg(i)) : s.text(n.Msg.getMsg("Error")); a.show(); r.fadeIn(300); w(!1) } var a = t('<div id="overlayMsgDialog" class="web_dialog_overlay"><\/div>'), u = t('<div class="vis-PopupWrap-alertmain" tabIndex=1>'), r = t('<div id="VAPOS_ErrorInfo" class="vis-PopupWrap-alert"><input class="vis-Dialog-buttons-text" type="number"  tabindex="-30" style="z-index:-44;position:absolute"  autofocus="autofocus"  >        <div class="vis-popup-headerContainer">                                                  <div class="vis-PopupHeader-alert">           <h4 id="VAPOS_CLInformation">Information<\/h4>           <span id="btnCloseInfo" class="fa fa-times"><\/span>                            <\/div>  <\/div>                                                                                          <div class="vis-PopupContent-alert">                                                                    <div class="form-group vis-PopupInput-alert" style="width: 100%">                                <img class="vis-alert-img" style="float:left"  />                                                                      <label style="width: 90%;padding-left: 10px;word-break: break-word" id="VAPOS_lblErrorInfo"><\/label>                                   <div class="vis-confirm-customUI" style="display:none"> <\/div>                        <\/div>                                                                                                <div class="vis-Dialog-buttons" style="display:none">                                           <input class="vis-Dialog-buttons-OK " type="button" value="' + n.Msg.getMsg("OK") + '" > <input  class="vis-Dialog-buttons-Cancel"  type="button" value="' + n.Msg.getMsg("Cancel") + '" >                                               <\/div>                                                                                                                                                  <\/div>                                                                                      <\/div>'); u.append(r); i.append(a).append(u); var e = r.find(".vis-PopupHeader-alert"), o = r.find(".vis-popup-headerContainer"), d = r.find("#btnCloseInfo"), s = r.find("#VAPOS_CLInformation"), y = r.find(".vis-alert-img"), h = r.find(".vis-PopupContent-alert"), p = r.find("#VAPOS_lblErrorInfo"), v = r.find(".vis-confirm-customUI"), ut = r.find("#VAPOS_busyInd"), l = null, c = null, f = null; d.on("click", function (n) { k(n) }); return { info: g, ask: nt, error: rt, warn: it, askCustomUI: tt } } var i = t("body"), u = t("#vis_buzzer"); n.ADialog = { info: function (t, i, r, u) { var f = ""; t == null || t.equals("") || (f += n.Msg.getMsg(t)); r != null && r.length > 0 && (f += "\n" + r); n.ADialogUI.info(f, u); f = null }, ask: function (t, i, r) { var u = "", f; return t == null || t.equals("") || (u += n.Msg.getMsg(t)), r != null && r.length > 0 && (u += "\n" + r), f = !1, confirm(u) && (f = !0), f }, error: function (t, i, r, u) { var f = ""; t == null || t.equals("") || (f += n.Msg.getMsg(t)); r != null && r.length > 0 && (f += "\n" + r); n.ADialogUI.error(f, u); f = null }, warn: function (t, i, r, u) { var f = ""; t == null || t.equals("") || (f += n.Msg.getMsg(t)); r != null && r.length > 0 && (f += "\n" + r); n.ADialogUI.warn(f, u); f = null }, confirm: function (t, i, r, u, f) { var e = "", o; return t == null || t.equals("") || (e += n.Msg.getMsg(t)), r != null && r.length > 0 && (e += "\n" + r), o = !1, n.ADialogUI.ask(e, u, f), o }, confirmCustomUI: function (t, i, r, u, f, e) { var o = "", s; return t == null || t.equals("") || (o += n.Msg.getMsg(t)), r != null && r.length > 0 && (o += "\n" + r), s = !1, n.ADialogUI.askCustomUI(o, u, f, e), s } }; n.ADialogCallback = { info: function (t, i, r, u) { var f = ""; t == null || t.equals("") || (f += n.Msg.getMsg(t)); i != null && i.length > 0 && (f += "\n" + i); n.ADialogUI.info(f, r, u); f = null }, error: function (t, i, r, u) { var f = ""; t == null || t.equals("") || (f += n.Msg.getMsg(t)); i != null && i.length > 0 && (f += "\n" + i); n.ADialogUI.error(f, r, u); f = null }, warn: function (t, i, r, u) { var f = ""; t == null || t.equals("") || (f += n.Msg.getMsg(t)); i != null && i.length > 0 && (f += "\n" + i); n.ADialogUI.warn(f, r, u); f = null } }; n.ADialogUI = r() }(VIS, jQuery), function (n, t) { function p(n, i, r) { var u = null; return t.ajax({ url: y, type: "POST", datatype: "json", contentType: "application/json; charset=utf-8", async: i, data: JSON.stringify(n) }).done(function (n) { u = n; r && r(n) }), u } function i(n, t, i, r, u) { this.info = n; this.lookup = null; this.allLoaded = !1; this.hasInactive = !1; this.displayType = u; this.selectedObject; this.windowNo = r; this.validationDisabled = !1; this.tabNo = 0; this.colName = ""; this.data = []; this.ctx = i; t && (this.lookup = t._lookup, this.allLoaded = t._allLoaded, this.hasInactive = t._hasInactive, this.displayType = t._displayType, this.windowNo = t._WindowNo, this.tabNo = t._TabNo, this.colName = t._columnName, this.info && (this.info.windowNo = t._WindowNo)) } function r(t, r, u, f, e, o) { if (i.call(this, t, r), this.lookupDirect = {}, this.directNullKey, this.AD_Window_ID = u, this.AD_Field_ID = f, this.AD_Tab_ID = e, this.lookupData = o, this.loading = !1, !this.lookupData) { var s = t.keyColumn; s && s.indexOf(".") > -1 && (s = s.substring(s.indexOf(".") + 1)); this.lookupData = { ctx: n.context.getWindowCtx(t.windowNo), windowNo: t.windowNo, column_ID: t.column_ID, AD_Reference_ID: r._displayType, columnName: s, AD_Reference_Value_ID: t.AD_Reference_Value_ID, isParent: t.isParent, validationCode: n.secureEngine.encrypt(t.validationCode) } } this.nextRead = 0; this.cLookup = !1; this.lookupDirectAll = {}; this.zomQuery = null; this.prepareZQuery(); this.log = n.Logging.VLogger.getVLogger("MLookup") } function f(t, r) { i.call(this, null, null, t, r, n.DisplayType.TableDir); this.lookup = {}; this.load() } function u(t, r) { i.call(this, null, null, t, r, n.DisplayType.TableDir); this.C_Locator_ID = 0; this.OnlyOrgID = 0; this.onlyWarehouseID = 0; this.onlyProductID = 0; this.onlyOutgoing = !1; this.lookup = {}; this.maxRows = 1e4; this.defaultID = ""; this.log = n.Logging.VLogger.getVLogger("MLocatorLookup"); this.load(!1); this.disposeLocal = function () { this.lookup = null; this.log = null } } function s(t, r) { i.call(this, null, null, t, r, n.DisplayType.TableDir); this.log = n.Logging.VLogger.getVLogger("MAccountLookup"); this.C_ValidCombination_ID = 0; this.combination; this.description; this.lst = {} } function a(t, r) { i.call(this, null, null, t, r, n.DisplayType.TableDir); this.NO_INSTANCE = { Key: 0, Name: "" }; this.log = n.Logging.VLogger.getVLogger("MPAttributeLookup") } function c(t, r) { i.call(this, null, null, t, r, n.DisplayType.TableDir); this.NO_INSTANCE = { Key: 0, Name: "" }; this.log = n.Logging.VLogger.getVLogger("MGAttributeLookup") } function h(t, r) { i.call(this, null, null, t, r, n.DisplayType.AmtDimension); this.lookup = {} } function l(t, r) { i.call(this, null, null, t, r, n.DisplayType.ProductContainer); this.log = n.Logging.VLogger.getVLogger("MProductContainerLookup"); this.lookup = {} } var w = n.DB, e = n.Logging.Level, v = n.Application.contextUrl, y = v + "JsonData/JDataSetWithCode", o = function (t, i, r) { var e = r ? !0 : !1, f = { sql: t, page: 1, pageSize: 0 }, u; return i && (f.param = i), u = null, p(f, e, function (t) { u = (new n.DB.DataReader).toJson(t); r && r(u) }), u }; i.prototype.INACTIVE_S = "~"; i.prototype.INACTIVE_E = "~"; i.prototype.MAX_ROWS = 1e4; i.prototype.MINUS_ONE = -1; i.prototype.getValidation = function () { return "" }; i.prototype.getWindowNo = function () { return this.windowNo }; i.prototype.getTabNo = function () { return this.tabNo }; i.prototype.setTabNo = function (n) { this.tabNo = n }; i.prototype.getFieldColName = function () { return this.colName }; i.prototype.getDisplayType = function () { return this.displayType }; i.prototype.setDisplayType = function (n) { this.displayType = n }; i.prototype.disableValidation = function () { this.validationDisabled = !0 }; i.prototype.getIsValidationDisabled = function () { return this.validationDisabled }; i.prototype.getIsValidated = function () { return !0 }; i.prototype.getHasInactive = function () { return this.hasInactive }; i.prototype.getData = function () { return [] }; i.prototype.getDisplay = function () { return "" }; i.prototype.getSelectedItem = function () { return this.selectedObject }; i.prototype.fillCombobox = function (n, t, i, r) { var u = this.selectedObject, f; this.data != null && (this.data.length = 0); this.data = this.getData(n, t, i, r); f = 0; this.data != null && (f = this.data.length); u != this.selectedObject && (u = this.selectedObject); u == null && n && f > 0 && (u = this.data[0], this.selectedObject = u) }; i.prototype.setSelectedItem = function (n) { (this.selectedObject != null && this.selectedObject !== n || this.selectedObject == null && n != null) && this.setSelectedItemAlways(n) }; i.prototype.setSelectedItemAlways = function (n) { this.selectedObject = this.data.indexOf(n) > -1 || n == null ? n : null }; i.prototype.refresh = function () { return 0 }; i.prototype.getZoomQuery = function () { return null }; i.prototype.getColumnName = function () { return this.info.keyColumn }; i.prototype.dispose = function () { this.info = null; this.lookup = null; this.allLoaded = null; this._hasInactive = null; this.selectedObject = null; this.data = null; this.ctx = null }; i.prototype.removeAllElements = function () { this.data.length > 0 && (this.data.length = 0, this.selectedObject = null) }; i.prototype.clear = function () { this.removeAllElements() }; i.prototype.gethasImageIdentifier = function () { return !1 }; n.Utility.inheritPrototype(r, i); r.prototype.prepareZQuery = function () { var r, f, u, i; if (this.info.zoomQuery != null && !t.isEmptyObject(this.info.zoomQuery)) for (r = this.info.zoomQuery, this.zomQuery = new n.Query(r._tableName), f = null, u = 0; u < r._list.length; u++)i = r._list[u], f = new n.QueryRestriction(i.ColumnName, i.Code, i.Code_to, i.InfoName, r.InfoDisplay, i.InfoDisplay_to, i.Operator, i.DirectWhereClause, i.AndCondition), this.zomQuery.addRestriction(f) }; r.prototype.initialize = function (t) { return t ? this : this.info.isParent || this.info.isKey ? (this.hasInactive = !0, this) : this.getDisplayType() == n.DisplayType.Search || this.info.isCreadedUpdatedBy ? this : (this.info.isValidated ? this.load(!0, !0) : this.fillDirectList(), this) }; r.prototype.getValidation = function () { return this.getIsValidationDisabled() ? "" : this.info.validationCode }; r.prototype.getIsValidated = function () { return this.getIsValidationDisabled() ? !0 : this.info == null ? !1 : this.info.isValidated }; r.prototype.getData = function (n, t, i, r) { var u = this.getData2(t, r), f, o, e, s; if (i && this.hasInactive) for (f = u.length; f > 0; f--)o = u[f - 1], o != null && (e = o.Name, e.startsWith(this.INACTIVE_S) && e.endsWith(this.INACTIVE_E) && (console.log(e), u.splice(f - 1, 1))); return n || (s = null, s = this.info.keyColumn != null && this.info.keyColumn.toUpperCase().endsWith("_ID") ? { Key: -1, Name: "" } : { Key: "", Name: "" }, u.unshift(s)), u }; r.prototype.getData2 = function (n, i) { return ((!this.allLoaded || t.isEmptyObject(this.lookup)) && this.refresh(i), this.info.isValidated) ? this.getObjectArray(this.lookup) : (!this.info.isValidated && n && this.refresh(i), this.getObjectArray(this.lookup)) }; r.prototype.getObjectArray = function (n) { var t = [], i = 0; for (var r in n) t[i++] = n[r]; return t }; r.prototype.getDisplay = function (t, i, r) { if (t == null) return ""; var u = i ? this.getFromList(t) : this.get(t); return u == null ? "<" + t.toString() + ">" : r ? u.Name : n.Utility.Util.getIdentifierDisplayVal(u.Name) }; r.prototype.getLovIconType = function (n) { var t = this.lookup[" " + n]; if (t) return t.icoType }; r.prototype.getLOVIconElement = function (t, i, r) { var o = this.lookup[" " + t], u, f, e; if (o && (u = o.ico, f = o.icohtml, f = f ? " style='" + f + "'" : "", u)) return u.indexOf(" ") > -1 ? r ? u : "<i class='" + u + "'" + f + "><\/i>" : (e = u.substring(u.indexOf("Images/") + 7), e = n.Application.contextUrl + "Images/Thumb32x32/" + e, r ? e : "<img src='" + e + "'" + f + "><\/img>") }; r.prototype.getLOVIconStyle = function (n) { var t = this.lookup[" " + n]; if (t) return t.icohtml }; r.prototype.get = function (i) { var r, u; return i == null || this.MINUS_ONE === i ? null : (this.info.isParent && this.nextRead < Date.now() && (this.nextRead = Date.now() + 2e3), r = this.lookup[" " + i], r) ? r : (!this.info.isParent && this.info.isValidated && this.allLoaded && this.getDirect(i, !1, !0), !this.allLoaded && t.isEmptyObject(this.lookup) && !this.info.isCreadedUpdatedBy && !this.info.isParent && this.getDisplayType() != n.DisplayType.Search && (this.load(), r = this.lookup[" " + i], r != null)) ? r : (u = !0, this.getDirect(i, !1, u)) }; r.prototype.getFromList = function (i) { var r, u; return i == null || this.MINUS_ONE === i ? null : this.info.isParent && this.nextRead < Date.now() ? (this.nextRead = Date.now() + 2e3, this.get(i)) : (r = this.lookup[" " + i], r != null) ? r : (!this.info.isParent && this.info.isValidated && this.allLoaded && this.getDirectFromList(i, !1, !0), !this.allLoaded && t.isEmptyObject(this.lookup) && !this.info.isCreadedUpdatedBy && !this.info.isParent && this.getDisplayType() != n.DisplayType.Search && (r = this.lookup[" " + i], r != null)) ? r : (u = this.info.isValidated, this.getDirectFromList(i, !1, u)) }; r.prototype.getDirect = function (i, r, u) { var e, o, f; if (i == null || this.info.queryDirect == null || this.info.queryDirect.length == 0 || i === this.directNullKey) return null; if (e = null, this.lookupDirect != null && (e = this.lookupDirect[i], e)) return e; o = this.info.keyColumn.toUpperCase().endsWith("_ID"); try { f = this; t.ajax({ url: n.Application.contextUrl + "Lookup/GetLookupDirect", async: !1, type: "post", data: { WindowNo: f.getWindowNo(), AD_Window_ID: f.AD_Window_ID, AD_Tab_ID: f.AD_Tab_ID, AD_Field_ID: f.AD_Field_ID, Key: i, IsNumber: o, LookupData: JSON.stringify(f.lookupData) }, success: function (t) { var u = (new n.DB.DataReader).toJson(t), s, v, h, c, l, a; u.read() ? (s = u.getString(2), v = u.getString(3).equals("Y"), v || (s = f.INACTIVE_S + s + f.INACTIVE_E, f.hasInactive = !0), o ? (h = u.getInt(0), c = { Key: h, Name: n.Utility.encodeText(s) }, r && (f.lookup[" " + h] = c), e = c) : (l = u.getString(1), a = { Key: l, Name: n.Utility.encodeText(s) }, r && (f.lookup[" " + l] = a), e = a), u.read() && f.log.log(n.Logging.Level.SEVERE, f.info.keyColumn + ": Not unique (first returned) for " + i)) : (f.directNullKey = i, e = null) }, error: function (t) { f.log.log(n.Logging.Level.SEVERE, t) } }) } catch (s) { this.log.log(n.Logging.Level.SEVERE, this.info.keyColumn + ": SQL=" + this.info.queryDirect + "; Key=" + i, s); e = null } return u && !r && e != null && (this.lookupDirect == null && (this.lookupDirect = {}), this.lookupDirect[i] = e), this.hasInactive = !0, e }; r.prototype.getDirectFromList = function (t, i, r) { var u, f, o, s, e, h; return t == null || this.info.queryDirect == null || this.info.queryDirect.length == 0 ? null : t === this.directNullKey ? null : (u = null, this.lookupDirect != null && (f = null, f = this.lookupDirect[" " + t], f && f != null)) ? f : (this.lookupDirectAll[" " + t] || (s = this.getFieldColName(), e = n.MLookupCache.getRecordLookup(this.getWindowNo(), this.getTabNo(), s, t), (e || !e && t == 0) && (h = { Key: t, Name: n.Utility.encodeText(e) }, this.lookupDirectAll[" " + t] = h)), this.lookupDirectAll[" " + t] ? (o = this.lookupDirectAll[" " + t], i && (this.lookup[" " + t] = o), u = o) : this.loading || (this.addInList(t), u = null), r && !i && u != null && (this.lookupDirect == null && (this.lookupDirect = {}), this.lookupDirect[" " + t] = u), this.hasInactive = !0, u) }; r.prototype.addInList = function (i) { if (!(this.info.queryDirect.length <= 0) && i != null) { var u = this.info.keyColumn.toUpperCase().endsWith("_ID"), f = this.info.queryDirect, r = this; t.ajax({ url: n.Application.contextUrl + "Lookup/GetLookupDirect", type: "post", data: { WindowNo: r.getWindowNo(), AD_Window_ID: r.AD_Window_ID, AD_Tab_ID: r.AD_Tab_ID, AD_Field_ID: r.AD_Field_ID, Key: i, IsNumber: u, LookupData: JSON.stringify(r.lookupData) }, type: "post", success: function (t) { var f = (new n.DB.DataReader).toJson(t), e, o, s; f.read() ? (e = f.getString(2), u ? (o = n.Utility.Util.getValueOfInt(f.getCell(0)), r.lookupDirectAll[" " + o] = { Key: o, Name: n.Utility.encodeText(e) }) : (s = f.getString(1), r.lookupDirectAll[" " + s] = { Key: s, Name: n.Utility.encodeText(e) })) : r.directNullKey = i }, error: function () { } }) } }; r.prototype.load = function (i, r) { var s = this.info.query, e = "", o, h, f, u; return (this.info.isValidated || (e = n.Env.parseContext2(n.context, this.getWindowNo(), this.getTabNo(), this.info.validationCode, !1, !0)), o = this.info.keyColumn.toUpperCase().endsWith("_ID"), this.hasInactive = !1, h = null, this.lookup = {}, r && (this.cLookup = !1, n.MLookupCache.loadFromCache(this.info, this))) ? this : (f = 1e3, u = this, i ? u.loading = !0 : (i = !1, f = 0), t.ajax({ url: n.Application.contextUrl + "Lookup/GetLookupData", async: i, type: "post", data: { WindowNo: u.getWindowNo(), AD_Window_ID: u.AD_Window_ID, AD_Tab_ID: u.AD_Tab_ID, AD_Field_ID: u.AD_Field_ID, Values: JSON.stringify(e), PageSize: f, LookupData: JSON.stringify(u.lookupData) }, success: function (t) { var i = (new n.DB.DataReader).toJson(t); u.readData(i, o); r && n.MLookupCache.loadEnd(u.info, u); u.loading = !1; u = null }, error: function (t) { u.log.log(n.Logging.Level.SEVERE, u.info.keyColumn + ": Loader - " + s, t) } }), 0) }; r.prototype.fillDirectList = function () { var r, i; this.info.queryAll == null || this.info.queryAll.length <= 0 || (r = this.info.queryAll, this.cLookup = !0, n.MLookupCache.loadFromCache(this.info, this)) || (i = this, t.ajax({ url: n.Application.contextUrl + "Lookup/GetLookupAll", type: "post", data: { WindowNo: i.getWindowNo(), AD_Window_ID: i.AD_Window_ID, AD_Tab_ID: i.AD_Tab_ID, AD_Field_ID: i.AD_Field_ID, PageSize: 100, LookupData: JSON.stringify(i.lookupData) }, success: function (t) { for (var o = i.info.keyColumn.endsWith("_ID"), r = (new n.DB.DataReader).toJson(t), u, f, e; r.read();)u = r.getString(2), o ? (f = r.getInt(0), i.lookupDirectAll[" " + f] = { Key: f, Name: n.Utility.encodeText(u) }) : (e = r.getString(1), i.lookupDirectAll[" " + e] = { Key: e, Name: n.Utility.encodeText(u) }); n.MLookupCache.loadEnd(i.info, i); i.loading = !1; i = null }, error: function () { } }), this.loading = !0) }; r.prototype.readData = function (t, i) { var s = {}, h = 0, f, o; for (this.allLoaded = !0; t.read();) { if (h++ > this.MAX_ROWS) { this.log.fine(this.info.keyColumn + ": Loader - Too many records"); this.allLoaded = !1; break } var e = t.getString(2), c = t.getString(3).equals("Y"), r = {}, u; c || (e = this.INACTIVE_S + e + this.INACTIVE_E, this.hasInactive = !0); i ? (u = t.getInt(0), r = { Key: u, Name: n.Utility.encodeText(e) }) : (u = t.getString(1), r = { Key: u, Name: n.Utility.encodeText(e) }); t.tables[0].columns.length > 4 && (f = t.getString(4), f && f.length > 0 ? (o = f.split("|"), r.ico = o[0], r.icohtml = o[1]) : r.ico = f, r.icoType = t.getString(5)); s[" " + u] = r } this.lookup = null; this.lookup = s; this.loading = !1 }; r.prototype.refresh = function () { if (this.getDisplayType() == n.DisplayType.Search || this.info.IsCreadedUpdatedBy || this.loading) return 0; return this.load() }; r.prototype.clear = function () { this.$super.clear.call(this); this.lookup = {} }; r.prototype.getCLookup = function () { return this.cLookup && this.lookupDirectAll, this.lookup }; r.prototype.setCLookup = function (n) { this.cLookup && (this.lookupDirectAll = n); this.lookup = n }; r.prototype.getIsLoading = function () { return this.loading }; r.prototype.setIsLoading = function (n) { this.loading = n }; r.prototype.getZoomWindow = function () { if (arguments.length == 0) return this.info.zoomWindow; var t = arguments[0]; return n.ZoomTarget.getZoomAD_Window_ID(this.info.tableName, this.windowNo, t.getWhereClause(), n.context.isSOTrx(this.windowNo)) }; r.prototype.getZoomQuery = function () { return this.zomQuery }; r.prototype.getAD_Reference_Value_ID = function () { return this.info.AD_Reference_Value_ID }; r.prototype.gethasImageIdentifier = function () { return this.info.hasImageIdentifier }; r.prototype.disableValidation = function () { var t = this.info.validationCode; this.$super.disableValidation.call(this); this.info.isValidated = !0; this.info.validationCode = ""; t != null && t.length > 0 && (t.indexOf("@") != -1 && this.getDisplayType() == n.DisplayType.Table || this.getDisplayType() == n.DisplayType.TableDir) && this.setDisplayType(n.DisplayType.Search) }; r.prototype.dispose = function () { this.$super.dispose.call(this); this.lookupDirect = null; this.directNullKey = null; this.log = null }; n.Utility.inheritPrototype(f, i); f.prototype.cacheLookup = null; f.prototype.getDisplay = function (n) { if (n == null) return ""; var t = this.getLocation(n, null); return t == null ? "<" + n.toString() + ">" : t.Name }; f.prototype.get = function (n) { if (n == null) return null; var t = this.getLocation(n, null); return t == null ? null : t }; f.prototype.getColumnName = function () { return "C_Location_ID" }; f.prototype.getLocation = function (t, i) { var r, u; if (t == null) return null; if (i) { if (t in this.lstLatLng) return this.lstLatLng[t] } else if (t in this.lookup) return this.lookup[t]; return n.context.getLocationBulkReload() ? (r = n.dataContext.getJSONData(n.Application.contextUrl + "Location/GetLocation", { id: t }), this.lookup[t] = r.LocItem, this.lstLatLng[t] = r.LocLatLng, !i) ? r.LocItem : r.LocLatLng : (u = this, n.dataContext.getJSONData(n.Application.contextUrl + "Location/GetLocation", { id: t }, function (n) { t in u.lookup || (u.lookup[t] = n.LocItem, u.lstLatLng[t] = n.LocLatLng) }), null) }; f.prototype.refreshLocation = function (t) { if (t == null) return null; var i = n.dataContext.getJSONData(n.Application.contextUrl + "Location/GetLocation", { id: t }); return this.lookup[t] = i.LocItem, this.lstLatLng[t] = i.LocLatLng, i }; f.prototype.load = function () { var t = this; if (t.lstLatLng = {}, f.prototype.cacheLookup != null) { t.lookup = f.prototype.cacheLookup.LocLookup; t.lstLatLng = f.prototype.cacheLookup.LocLatLng; t = null; return } n.dataContext.getJSONData(n.Application.contextUrl + "Location/GetLocations", "", function (n) { f.prototype.cacheLookup || (f.prototype.cacheLookup = n); t.lookup = n.LocLookup; t.lstLatLng = n.LocLatLng; t = null }) }; f.prototype.getLatLng = function (n) { if (n == null || n.toString().len < 1) return null; if (n in this.lstLatLng) return this.lstLatLng[n]; return this.getLocation(n, !0) }; f.prototype.dispose = function () { this.lstLatLng = null; this.$super.dispose.call(this); this.lookup = null }; n.Utility.inheritPrototype(u, i); u.prototype.getDefault = function () { return this.defaultID }; u.prototype.getOnlyOrgID = function () { return this.OnlyOrgID }; u.prototype.getOnlyWarehouseID = function () { return this.onlyWarehouseID }; u.prototype.getOnlyProductId = function () { return this.onlyProductID }; u.prototype.getIsOnlyOutgoing = function () { return this.onlyOutgoing }; u.prototype.setOnlyOrgID = function (n) { this.OnlyOrgID = n }; u.prototype.setOnlyWarehouseID = function (n) { this.onlyWarehouseID = n }; u.prototype.setOnlyProductID = function (n) { this.onlyProductID = n }; u.prototype.setOnlyOutgoing = function (n) { this.onlyOutgoing = n }; u.prototype.getDirect = function (t, i) { var s, u, r, f, e; if (t == null) return null; if (s = "VIS_92", u = [], u[0] = new n.DB.SqlParam("@keyValue", t), r = o(s, u), f = "", r.read()) f = r.getString(0); else return null; return r.dispose(), e = { Key: t, Name: n.Utility.encodeText(f) }, i && (this.lookup[" " + t] = e), e }; u.prototype.getIsValid = function (n) { if (n == null) return !0; var t = this.lookup[n]; return t != null }; u.prototype.load = function (i) { var o = 0, c = this.getOnlyOrgID(), l = this.getOnlyWarehouseID(), a = this.getOnlyProductId(), s = this.getIsOnlyOutgoing(), h = "1", r, f, v, u, y, e; try { } catch (p) { this.log.log(n.Logging.Level.SEVERE, sql, p); h = "Value" } this.lookup = null; this.lookup = {}; s = s != null && s.value ? !1 : !0; try { if (r = null, i) { for (t.ajax({ type: "Get", async: !1, url: n.Application.contextUrl + "Form/GetWareProWiseLocator", data: { colName: h, orgId: c, warehouseId: l, productId: a, onlyIsSOTrx: s }, success: function (t) { r = (new n.DB.DataSet).toJson(t) } }), f = r.getTable(0), v = f.getRows().length, u = 0; u < v; u++) { if (o++ > this.maxRows) { this.log.warning("Over Max Rows - " + o); break } y = n.Utility.Util.getValueOfString(f.getRow(u).getCell(4)) + "_" + n.Utility.Util.getValueOfString(f.getRow(u).getCell(1)) + "(" + n.Utility.Util.getValueOfString(f.getRow(u).getCell(2)) + ")"; this.lookup[f.getRow(u).getCell(0)] = { Key: f.getRow(u).getCell(0), Name: y } } r.dispose(); r = null; this.log.fine("Complete #" + o) } else e = this, t.ajax({ type: "Get", async: !0, url: n.Application.contextUrl + "Form/GetWareProWiseLocator", data: { colName: h, orgId: c, warehouseId: l, productId: a, onlyIsSOTrx: s }, success: function (t) { var u, f, i; r = (new n.DB.DataSet).toJson(t); try { for (u = r.getTable(0), f = u.getRows().length, i = 0; i < f; i++) { if (o++ > e.maxRows) { e.log.warning("Over Max Rows - " + o); break } e.lookup[u.getRow(i).getCell(0)] = { Key: u.getRow(i).getCell(0), Name: n.Utility.Util.getValueOfString(u.getRow(i).getCell(1)) } } r.dispose(); r = null; e.log.fine("Complete #" + o) } catch (s) { e.log(n.Logging.Level.SEVERE, "", s) } e = null } }) } catch (w) { this.log.log(n.Logging.Level.SEVERE, finalSql, w) } i && t.isEmptyObject(this.lookup) && this.log.Finer(finalSql) }; u.prototype.get = function (n) { if (n == null) return null; var i = Number(n), t = this.lookup[i]; return t != null ? t : this.getDirect(n, !0, null) }; u.prototype.getDisplay = function (n) { if (n == null) return ""; var t = this.get(n); return t == null ? "<" + n.toString() + ">" : t.Name }; u.prototype.getData = function () { var n = this.lookup; return t.map(this.lookup, function (n) { return n }) }; u.prototype.refresh = function () { this.log.fine("start"); try { this.load(!0) } catch (n) { this.log.severe("#" + this.lookup.Count) } return this.log.info("#" + this.lookup.Count), this.lookup.length }; u.prototype.getColumnName = function () { return "M_Locator.M_Locator_ID" }; u.prototype.getZoomWindow = function () { if (arguments.length == 0) return this.info.zoomWindow; var t = arguments[0]; return n.ZoomTarget.getZoomAD_Window_ID("M_Locator", this.windowNo, t.getWhereClause(), n.context.isSOTrx(this.windowNo)) }; u.prototype.dispose = function () { this.disposeLocal(); this.$super.dispose.call(this); this.lookupDirect = null; this.directNullKey = null; this.log = null; this.disposeLocal = null }; n.Utility.inheritPrototype(s, i); s.prototype.getDisplay = function (n) { return this.containsKey(n) ? this.toStringX() : "<" + n.toString() + ">" }; s.prototype.toStringX = function () { return this.C_ValidCombination_ID == 0 ? "" : this.combination }; s.prototype.containsKey = function (n) { var t = 0; return n != null && (t = parseInt(n.toString())), this.load(t) }; s.prototype.load = function (t) { var i, u, f, r, e; return t == 0 ? (this.C_ValidCombination_ID = 0, this.combination = "", this.description = "", !0) : t == this.C_ValidCombination_ID ? !0 : (i = this.lst[t], i) ? (this.C_ValidCombination_ID = t, this.combination = i.C, this.description = i.D, !0) : (u = n.MLookupCache.getRecordLookup(this.getWindowNo(), this.getTabNo(), "c_validcombination_id", t), u) ? (i = { C: u, D: "-" }, this.C_ValidCombination_ID = t, this.combination = i.C, this.description = i.D, this.lst[t] = i, !0) : (f = "VIS_94", r = [], r[0] = new n.DB.SqlParam("@ID", t), e = this, o(f, r, function (n) { var n = null; try { if (n = o(f, r), !n.read()) return !1; e.lst[n.getInt(0)] = { C: n.getString(1), D: n.getString(2) } } catch (t) { return !1 } }), !1) }; s.prototype.getColumnName = function () { return "" }; s.prototype.getData = function (i, r, u) { var o = [], f; i || o.push({ Key: -1, Name: "" }); f = null; try { for (t.ajax({ type: "Get", async: !1, url: n.Application.contextUrl + "Form/GetValidAccountCombination", data: { AD_Client_ID: AD_Client_ID, onlyActive: u }, success: function () { f = (new n.DB.DataReader).toJson(jString) } }); f.read();)o.push({ Key: f.getInt(0), Name: f.getString(1) + " - " + f.getString(2) }) } catch (s) { this.log.log(e.SEVERE, sql, s) } return o }; n.Utility.inheritPrototype(a, i); a.prototype.getDisplay = function (n) { if (n == null) return ""; var t = this.get(n); return t == null ? "<" + n.toString() + ">" : t.Name }; a.prototype.get = function (t) { var i, r, f, u; if (t == null) return null; if (i = 0, t instanceof Number) i = t; else try { i = parseInt(t.toString()) } catch (s) { this.log.log(e.SEVERE, "Value=" + t, s) } if (i == 0) return this.NO_INSTANCE; r = null; try { f = []; f[0] = new n.DB.SqlParam("@M_AttributeSetInstance_ID", i); u = o("VIS_95", f); u.read() && (r = u.getString(0), (r == null || r.length == 0) && (r = n.Logging.VLogMgt.getIsLevelFine() ? "{" + i + "}" : "")); u.dispose(); u = null } catch (s) { this.log.log(e.SEVERE, "get", s) } return r == null ? null : { Key: i, Name: r } }; a.prototype.getColumnName = function () { return "M_AttributeSetInstance_ID" }; a.prototype.dispose = function () { this.$super.dispose.call(this); this.NO_INSTANCE = null; this.log = null }; n.Utility.inheritPrototype(c, i); c.prototype.getDisplay = function (n) { if (n == null) return ""; var t = this.get(n); return t == null ? "<" + n.toString() + ">" : t.Name }; c.prototype.get = function (t) { var i, r, f, u; if (t == null) return null; if (i = 0, t instanceof Number) i = t; else try { i = parseInt(t.toString()) } catch (s) { this.log.log(e.SEVERE, "Value=" + t, s) } if (i == 0) return this.NO_INSTANCE; r = null; try { f = []; f[0] = new n.DB.SqlParam("@C_GenttributeSetInstance_ID", i); u = o("VIS_96", f); u.read() && (r = u.getString(0), (r == null || r.length == 0) && (r = n.Logging.VLogMgt.getIsLevelFine() ? "{" + i + "}" : "")); u.dispose(); u = null } catch (s) { this.log.log(e.SEVERE, "get", s) } return r == null ? null : { Key: i, Name: r } }; c.prototype.getColumnName = function () { return "C_GenAttributeSetInstance_ID" }; c.prototype.dispose = function () { this.$super.dispose.call(this); this.NO_INSTANCE = null; this.log = null }; c.prototype.getData = function (i, r, u) { var o = [], f; i || o.push({ Key: -1, Name: "" }); f = null; try { for (t.ajax({ type: "Get", async: !1, url: n.Application.contextUrl + "Form/GenAttributeSetInstance", data: { C_GenAttributeSet_ID: n.Env.getCtx().getContextAsInt(this.windowNo, "C_GenAttributeSet_ID"), onlyActive: u }, success: function () { f = (new n.DB.DataReader).toJson(jString) } }); f.read();)o.push({ Key: f.getInt(0), Name: f.getString(1) + " - " + f.getString(2) }) } catch (s) { this.log.log(e.SEVERE, sql, s) } return o }; n.MLookupFactory = { get: function (t, i, r, u, f, e, o, s) { s && s.length > 0 && (s = n.secureEngine.encrypt(s)); r && (r = n.Utility.Util.getValueOfInt(r)); var h = { ctx: t.getWindowCtx(i), windowNo: i, column_ID: r, AD_Reference_ID: u, columnName: f, AD_Reference_Value_ID: e, isParent: o, validationCode: s }, c = n.dataContext.getJSONData(n.Application.contextUrl + "JsonData/GetLookup", h); return new n.MLookup(c._vInfo, c, 0, 0, 0, h) }, getMLookUp: function (t, i, r, u) { var s = "", h = 0, c = !1, l = "", a, f, e; r && (r = n.Utility.Util.getValueOfInt(r)); a = "VIS_97"; f = null; try { e = []; e[0] = new n.DB.SqlParam("@Column_ID", r); f = o(a.toString(), e, null); f.read() && (s = f.getString(0), h = f.getInt(1), c = "Y".equals(f.getString(2)), l = f.getString(3)); f.close(); f = null } catch (v) { f != null && (f.close(), f = null) } return n.MLookupFactory.get(t, i, r, u, s, h, c, l) }, GetLookUpInfo: function (t, i, r, u, f, e, o, s) { u && (u = n.Utility.Util.getValueOfInt(u)); var h = { WindowNum: i, AD_Reference_ID: r, Column_ID: u, columnName: f, AD_Reference_Value_ID: e, IsParent: o, ValidationCode: s } } }; n.MLookupCache = { s_log: n.Logging.VLogger.getVLogger("MLookupCache"), s_loadedLookups: new n.CCache("MLookupCache"), s_sentLookups: new n.CCache("MLookupCacheSent"), s_windowLookup: {}, s_windowRecordLookup: {}, getKey: function (t) { if (t == null) return n.Env.currentTimeMillis(); var i = t.windowNo + ":"; return i + (":" + t.keyColumn + t.AD_Reference_Value_ID + t.query + t.validationCode) }, loadFromCache: function (n, i) { var u = this.getKey(n), f = null, r = !0; return this.s_loadedLookups.contains(u) && (f = this.s_loadedLookups.get(u)), f == null && (r = !1), r && t.isEmptyObject(f) && (this.s_loadedLookups.remove(u), r = !1), r && (i.setCLookup(jQuery.extend({}, f)), i.setIsLoading(!1)), r || (r = !0, this.s_sentLookups.contains(u) ? this.s_sentLookups.get(u).indexOf(i) == -1 && (i.setIsLoading(!0), this.s_sentLookups.get(u).push(i)) : (this.s_sentLookups.add(u, []), r = !1)), r }, loadEnd: function (n, i) { var f = this.getKey(n), o, e, r, u; if (i.getCLookup() && !t.isEmptyObject(i.getCLookup())) { if (this.s_loadedLookups.add(f, i.getCLookup()), this.s_sentLookups.contains(f)) { for (r = this.s_sentLookups.get(f), r.length > 0 && (o = ""), u = 0; u < r.length; u++)e = r[u], e.setCLookup(t.extend({}, i.getCLookup())), e.setIsLoading(!1); r.length = 0; this.s_sentLookups.remove(f) } } else if (this.s_sentLookups.contains(f)) { for (r = this.s_sentLookups.get(f), u = 0; u < r.length; u++)r[u].setIsLoading(!1); r.length = 0; this.s_sentLookups.remove(f) } }, cacheReset: function (n) { for (var t, s, i, h, f, e = n.toString() + ":", c = this.s_loadedLookups.size(), r = [], u = 0, o = this.s_loadedLookups.m_cacheK.length; u < o; u++) { t = this.s_loadedLookups.m_cacheK[u]; try { t != null && t.startsWith(e) && r.push(t) } catch (l) { s = "" } } for (i = 0; i < r.length; i++)this.s_loadedLookups.remove(r[i]); h = this.s_loadedLookups.size(); for (f in this.s_windowRecordLookup) f.startsWith(e) && delete this.s_windowRecordLookup[f] }, addWindowLookup: function (n, t) { if (this.s_windowLookup[n]) this.s_windowLookup[n].push(t); else { var i = []; i.push(t); this.s_windowLookup[n] = i } }, initWindowLookup: function (n) { var t, i, r; if (this.s_windowLookup[n]) { for (t = this.s_windowLookup[n], i = 0, r = t.length; i < r; i++)t[i].initialize(); t.length = 0; delete this.s_windowLookup[n] } }, addRecordLookup: function (n, t, i) { var r = n + ":" + t; this.s_windowRecordLookup[r] = i }, getRecordLookup: function (n, t, i, r) { var u = this.s_windowRecordLookup[n + ":" + t]; return u && i in u ? u[i][r] : null } }; n.Utility.inheritPrototype(h, i); h.prototype.cacheLookup = null; h.prototype.getDisplay = function (n) { if (n == null) return ""; var t = this.get(n); return t == null ? "<" + n.toString() + ">" : t }; h.prototype.get = function (t) { var i, r, f, u; if (t == null) return null; if (i = 0, t instanceof Number) i = t; else try { i = parseInt(t.toString()) } catch (s) { this.log.log(e.SEVERE, "Value=" + t, s) } if (i in this.lookup) return this.lookup[i]; if (i == 0) return this.NO_INSTANCE; r = null; try { f = []; f[0] = new n.DB.SqlParam("@C_DimAmt_ID", i); u = o("VIS_99", f); u.read() && (r = u.getString(0), (r == null || r.length == 0) && (r = n.Logging.VLogMgt.getIsLevelFine() ? "{" + i + "}" : "")); u.dispose(); u = null; this.lookup[i] = r } catch (s) { this.log.log(e.SEVERE, "get", s) } return r == null ? null : r }; h.prototype.getColumnName = function () { return "C_DimAmt_ID" }; h.prototype.refreshAmountDivision = function (t) { var r, i, f, u; if (t == null) return null; if (r = 0, t instanceof Number) r = t; else try { r = parseInt(t.toString()) } catch (s) { this.log.log(e.SEVERE, "Value=" + t, s) } if (r == 0) return this.NO_INSTANCE; i = null; try { f = []; f[0] = new n.DB.SqlParam("@C_DimAmt_ID", r); u = o("VIS_99", f); u.read() && (i = u.getString(0), (i == null || i.length == 0) && (i = n.Logging.VLogMgt.getIsLevelFine() ? "{" + r + "}" : "")); u.dispose(); u = null; this.lookup[r] = i } catch (s) { this.log.log(e.SEVERE, "get", s) } return i == null ? null : i }; h.prototype.dispose = function () { this.lstLatLng = null; this.$super.dispose.call(this); this.lookup = null }; n.Utility.inheritPrototype(l, i); l.prototype.cacheLookup = null; l.prototype.getDisplay = function (n) { if (n == null) return ""; var t = this.get(n); return t == null ? "<" + n.toString() + ">" : t.Name }; l.prototype.get = function (i) { var r, u; if (i == null) return null; if (r = 0, i instanceof Number) r = i; else try { r = parseInt(i.toString()) } catch (f) { this.log.log(e.SEVERE, "Value=" + i, f) } return r in this.lookup ? this.lookup[r] : r == 0 ? this.NO_INSTANCE : (u = null, t.ajax({ url: v + "ProductContainer/GetProductContainerInfo", data: { ID: r }, async: !1, success: function (t) { u = t ? t : n.Logging.VLogMgt.getIsLevelFine() ? "{" + r + "}" : "" }, error: function (n) { this.log.log(e.SEVERE, "get", n) } }), this.lookup[r] = u, u == null) ? null : { Key: r, Name: u } }; l.prototype.getColumnName = function () { return "M_ProductContainer_ID" }; l.prototype.dispose = function () { this.lstLatLng = null; this.$super.dispose.call(this); this.lookup = null }; n.MLookup = r; n.MLocationLookup = f; n.MAccountLookup = s; n.MPAttributeLookup = a; n.MGAttributeLookup = c; n.MLocatorLookup = u; n.MAmtDivLookup = h; n.MProductContainerLookup = l }(VIS, jQuery), function (n, t) { function i(i, r, u, f, e) { function ct() { c = t("<table style='width:100%;height:100%'><tr><td style='height:100%'><div class='vis-css-treewindow' ><\/td><\/tr><tr><td style='text-align:center'><div class='vis-tree-search'><div class='input-group'><input type='text' class='form-control ui-autocomplete-input' placeholder='Search'>  <span class='input-group-append'><button class='input-group-text'><a href='#' class='vis vis-search' tabindex='-1'><\/a><\/button><\/span><\/div><\/div><\/td><\/tr><\/table>"); h = c.find(".vis-css-treewindow"); h.css({ "max-width": "290px" }); ot = c.find(".vis-tree-search"); tt = c.find(".input-group-addon"); it = c.find("input"); a = t("<ul class='vis-apanel-rb-ul'>"); k = t("<li data-action='Copy'>").text(n.Msg.getMsg("Copy")); d = t("<li data-action='Move'>").text(n.Msg.getMsg("Move")); g = t("<li data-action='Cancel'>").text(n.Msg.getMsg("Cancel")); a.append(k); o.onDemandTree && (nt = t("<li data-action='MoveHere'>").text(n.Msg.getMsg("MoveHere")), a.append(nt)); a.append(d).append(g) } function lt() { var h, u, i, o; if (s != null && l != null && s.data("value") != l.data("value")) { h = s.parent(); s.remove(); var a = h.parent().data("value"), e = null, r = l, c = 0; l.data("summary") != "Y" ? (r = l.parent(), c = l.index(), s.insertAfter(r.children()[c]), e = r.parent().data("value")) : (u = r.find(">ul"), u.children().length > 0 ? s.insertBefore(u.children()[c]) : s.appendTo(u), e = r.data("value"), r = u); for (var f = h.children(), i = 0, v = [], p = [], i = 0; i < f.length; i++)o = t(f[i]), v.push(o.data("value")); if (a != e) for (f = r.children(), i = 0; i < f.length; i++)o = t(f[i]), p.push(o.data("value")); t.ajax({ type: "post", async: !0, url: n.Application.contextUrl + "Form/UpdateTree", data: { oldParentChildren: JSON.stringify(v), newParentChildren: JSON.stringify(p), oldId: a, newId: e, AD_Tree_ID: y, tableName: rt }, success: function (n) { console.log(n) }, error: function () { } }) } } function at() { w.length = 0; b.length = 0; h.find("LI").each(function (n, i) { var r = t(i), u = r.find(">label"); u.length < 1 && (u = r.find(">A")); w.push(r.data("value")); b.push(u.text()) }) } function et() { var i = it.val(), n, t; if (i == null || i.length < 2) { o.searchNode = !1; return } n = o.containsTextInArray(b, i, ut); n > -1 ? (t = w[n], o.currentNode = t, ut = n, o.setSelectedNode(t), o.selectionChangeListner ? o.selectionChangeListner.nodeSelectionChanged({ newValue: t, propertyName: "" }) : o.searchNode = !1) : o.searchNode = !1 } var o; this.selectionChangeListner = null; this.windowNo = i; var rt = "", p = null, w = [], b = [], ut = -1, v = null, s = null, l = null, y = 0, ft = 0; this.onDemandTree = f; this.currentNode = 0; this.searchNode = !1; this.isSummaryNode = !1; this.gc = e; var o = this, c = null, h = null, ot = null, tt = null, it = null, a = null, k, d, g, nt, st = n.Application.contextUrl, ht = st + "JsonData/ExecuteNonQuer", vt = function (n, i, r) { var f = r ? !0 : !1, u = null, e = { sql: n.join("/"), param: i }; return t.ajax({ url: ht + "ies", type: "POST", datatype: "json", contentType: "application/json; charset=utf-8", async: f, data: JSON.stringify(e) }).done(function (n) { u = n; r && r(n) }), u }; ct(); o = this; this.setSize = function (n) { h.height(n - 40) }; this.setTabID = function (n) { ft = n }; this.initTree = function (r) { y = r; (this.onDemandTree == "undefined" || this.onDemandTree == null) && (this.onDemandTree = !1); var f = { AD_Tree_ID: y, editable: u, windowNo: i, onDemandTree: this.onDemandTree, AD_Tab_ID: ft }; y = y; n.dataContext.getTreeAsString(f, function (n) { var i, r; h.html(n); at(); p = h.find(">ul"); rt = p.data("tablename"); p = p.find(">li>ul"); o.onDemandTree && h && (i = h.find("ul"), i && i.length > 1 && (r = t(i.find("ul")[0]).children(), r && r.length > 0 && !o.gc.isZoomAction ? t(r[0]).trigger("click") : o.gc.isZoomAction || (o.gc.query(o.selectionChangeListner.aPanel.curTab.getOnlyCurrentDays(), 0, !1), o.selectionChangeListner.aPanel.setBusy(!1)))) }) }; this.updateArray = function (n, t) { w.push(t); b.push(n) }; this.getRoot = function () { return c }; h.on(n.Events.onClick, function (n) { var u, r, i, f; n.target.nodeName === "INPUT" || n.target.nodeName === "LI" || n.target.nodeName === "A" ? (u = t(n.target), n.target.nodeName === "INPUT" && (u = t(n.target.parentNode)), o.selectionChangeListner && (o.onDemandTree ? (r = c.find("*.vis-css-treewindow-selected"), r.length > 0 && r.removeClass("vis-css-treewindow-selected"), i = t(t(n.target).parent()), i.find(">label").length > 0 ? i.find(">label").addClass("vis-css-treewindow-selected") : (i.find(">a").addClass("vis-css-treewindow-selected"), t(i.find("label")[0]).addClass("vis-css-treewindow-selected"))) : (r = c.find("*.vis-css-treewindow-selected"), r.length > 0 && r.removeClass("vis-css-treewindow-selected"), i = t(t(n.target).parent()), i.find(">label").length > 0 ? i.find(">label").addClass("vis-css-treewindow-selected") : (i.find(">a").addClass("vis-css-treewindow-selected"), t(i.find("label")[0]).addClass("vis-css-treewindow-selected"))), o.isSummaryNode = u.data("summary") == "Y" ? !0 : !1, o.currentNode = u.data("value"), o.selectionChangeListner.nodeSelectionChanged({ newValue: u.data("value"), propertyName: "", isSummaryNode: o.isSummaryNode })), n.stopPropagation()) : n.target.nodeName === "SPAN" && (n.target.parentNode.nodeName == "SPAN" || n.target.parentNode.nodeName == "LI") && (f = t(n.target.parentNode), n.target.parentNode.nodeName === "SPAN" && (f = t(n.target.parentNode.parentNode)), v = f, k.hide(), g.hide(), d.hide(), o.onDemandTree && nt.hide(), s != null ? (d.show(), g.show()) : (k.show(), o.onDemandTree && nt.show()), t(n.target).w2overlay(a.clone(!0))) }); tt.on(n.Events.onTouchStartOrClick, function (n) { o.searchNode = !0; et(n) }); it.on("keydown", function (n) { n.keyCode == 13 && (o.searchNode = !0, et(n)) }); a.on(n.Events.onTouchStartOrClick, "LI", function (i) { var f = t(i.target).data("action"), r, e, h, c, u, a; if (f == "Copy") s = v; else if (f == "Move") l = v, lt(), s = null, l = null, v = null; else if (f == "MoveHere") { if (r = o.selectionChangeListner.vTable.getSelection(!0), e = "", o.selectionChangeListner.aPanel.setBusy(!0), r && r.length > 0) for (h = o.selectionChangeListner.vTable.grid, c = o.selectionChangeListner.getMTab().gridTable.keyColumnName.toLower(), u = 0; u < r.length; u++)e += u == 0 ? h.get(r[u] + 1)[c] : "," + h.get(r[u] + 1)[c]; a = { nodeID: e, oldParentID: 0, newParentID: v.data("value"), AD_Tree_ID: y }; t.ajax({ url: n.Application.contextUrl + "Tree/UpdateTree", dataType: "json", data: a, success: function (n) { var t = n; t > 0 && o.selectionChangeListner.removeRecord() }, error: function () { o.selectionChangeListner.aPanel.setBusy(!1) } }); v = null; s = null } else f == "Cancel" && (s = null, v = null) }); this.getRootNode = function () { return p }; this.disposeLocal = function () { h.off(n.Events.onClick); tt.off(n.Events.onTouchStartOrClick); a.off(n.Events.onTouchStartOrClick); a = null; h = null; c.remove(); c = null; o = null } } i.prototype.containsTextInArray = function (n, t, i) { for (var r = i + 1; r < n.length; r++)if (r != -1 && n[r].trim().toLowerCase().contains(t.trim().toLowerCase())) return r; return i > -1 ? (i = -1, this.containsTextInArray(n, t, i)) : -1 }; i.prototype.addSelectionChangeListner = function (n) { this.selectionChangeListner = n }; i.prototype.setSelectedNode = function (n) { return n != -1 ? this.selectID(n, !0) : (this.currentNode = 0, !1) }; i.prototype.selectID = function (n) { var r, t, u, f, i; if (!this.onDemandTree || this.searchNode) { if (this.currentNode = n, this.searchNode = !1, r = this.getRoot(), t = r.find("li[data-value='" + n + "']"), this.isSummaryNode = t.data("summary") == "Y", t != null && t.length > 0) { for (u = r.find("*.vis-css-treewindow-selected"), u.length > 0 && u.removeClass("vis-css-treewindow-selected"), t.find(">label").length > 0 ? t.find(">label").addClass("vis-css-treewindow-selected") : t.find(">a").addClass("vis-css-treewindow-selected"), f = t; t != null;)i = t.find("input"), i.length > 0 && (i.prop("checked") || i.prop("checked", !0)), t = t.parent(), t[0].nodeName == "UL" && (t = t.parent()), t[0].nodeName == "LI" || (t = null); return f[0].scrollIntoView(), !0 } return !1 } }; i.prototype.nodeChanged = function (n, i, r, u, f, e) { var s, p, h, w, y, c, a; if (console.log("Save=" + n + ", KeyID=" + i + ", Name=" + r + ", Description=" + u + ", IsSummary=" + f + ", ImageInd=" + e), i != 0) { var v = this.getRoot(), l = !1, o = v.find("li[data-value='" + i + "']"); o != null && o.length > 0 && (l = !0); !l && n ? this.onDemandTree ? (s = v.find("*.vis-css-treewindow-selected"), s && f && (h = t(s.parent()).find("ul"), h && h.length > 0 ? t(h[0]).append(this.getNode(i, r, u, f, e, this.windowNo)) : t(s.parent()).append(t("<ul>").append(this.getNode(i, r, u, f, e, this.windowNo))))) : (s = v.find("*.vis-css-treewindow-selected"), p = s.parent("li").data("summary") == "Y", s && p ? (h = t(s.parent()).find("ul"), h && h.length > 0 ? t(h[0]).append(this.getNode(i, r, u, f, e, this.windowNo)) : t(s.parent()).append(t("<ul>").append(this.getNode(i, r, u, f, e, this.windowNo))), this.updateArray(r, i)) : (w = this.getRootNode(), y = this.getNode(i, r, u, f, e, this.windowNo), w.append(y), y[0].scrollIntoView(), this.updateArray(r, i))) : l && n ? (this.toggleTypeOfNode(o, f, i, this.windowNo, e), f && o.find(">ul").length == 0 && o.append(t("<ul>")), c = o.find(">label"), c && c.length != 0 || (c = o.find(">a")), c.length > 0 && c.text(r)) : l && !n ? (a = o.find(">ul"), a.length > 0 && (a.remove(), this.getRootNode().append(a.children())), o.remove()) : o = null; o == null } }; i.prototype.getNode = function (i, r, u, f, e, o) { r = n.Utility.encodeText(r); var s = '<li data-value="' + i + '"'; return s += f ? 'data-summary="Y" class="vis-hasSubMenu"> <input type="checkbox" id="' + o + i + '"><label for="' + o + i + '">' + r + '<\/label><span class="vis-treewindow-span"><span class="vis-css-treewindow-arrow-up"><\/span><\/span><ul><ul>' : 'data-summary="N"> <a href="javascript:void(0)" data-value="' + i + '" data-action="' + e + '" data-actionid="' + i + '"><span style="font-size:11px;margin-right:5px"' + this.getClassIcon(e) + "><\/span>" + r + '<\/a > <span class="vis-treewindow-span"><span class="vis-css-treewindow-arrow-up"> <\/span><\/span><\/li>', t(s) }; i.prototype.getIcon = function (n) { switch (n) { case "W": return "mWindow.png"; case "R": return "mReport.png"; case "P": return "mProcess.png"; case "F": return "mWorkflow.png"; case "B": return "mWorkbench.png"; case "X": return "mWindow.png"; case "V": return "mWindow.png"; case "D": return "mDocAction.png"; default: return "mWindow.png" } }; i.prototype.getClassIcon = function (n) { switch (n) { case "W": return "class = 'fa fa-window-maximize'"; case "R": return "class = 'vis vis-report'"; case "P": return "class = 'fa fa-cog'"; case "T": return "class = 'fa fa-cog'"; case "F": return "class = 'fa fa-clone'"; case "B": return "class = 'fa fa-clone'"; case "X": return "class = 'fa fa-list-alt'"; case "V": return "class = 'fa fa-clone'"; case "D": return "class = 'fa fa-clone'"; case "O": return "class = 'fa fa-circle'"; default: return "class = 'fa fa-clone'" } }; i.prototype.toggleTypeOfNode = function (t, i, r, u, f) { var h = t.data("summary") == "Y", o, e, s; i !== h ? (o = t.find(">ul"), o.remove(), t.data("summary", i ? "Y" : "N"), t.toggleClass("vis-hasSubMenu"), i ? t.html('<input type="checkbox" id="' + u + r + '"><label for="' + u + r + '">' + name + '<\/label><span class="vis-treewindow-span"><span class="vis-css-treewindow-arrow-up"><\/span><\/span>') : t.html('<img src="' + n.Application.contextUrl + "Areas/VIS/Images/login/" + this.getIcon(f) + '">  <a href="javascript:void(0)" data-value="' + r + '" data-action="' + f + '" data-actionid="' + r + '"> ' + name + '<\/a><span class="vis-treewindow-span"><span class="vis-css-treewindow-arrow-up"> <\/span><\/span>'), o.length > 0 && t.append(o)) : i || (e = t.find(">a"), e.length > 0 && (s = e.data("action"), e != f && (t.find(">img").attr("src", n.Application.contextUrl + "Areas/VIS/Images/login/" + this.getIcon(f)), e.data("action", f)), e = s = null)) }; i.prototype.dispose = function () { this.disposeLocal(); this.addPropertyChangeListner = null }; n.TreePanel = i }(VIS, jQuery), function (n, t) { function l(n, i, r) { var u = null; return t.ajax({ url: y, type: "POST", datatype: "json", contentType: "application/json; charset=utf-8", async: i, data: JSON.stringify(n) }).done(function (n) { u = n; r && r(n) }), u } function v(i, r, u) { var f = null; return i.sql = n.secureEngine.encrypt(i.sql), t.ajax({ url: w, type: "POST", datatype: "json", contentType: "application/json; charset=utf-8", async: r, data: JSON.stringify(i) }).done(function (n) { f = n; u && u(n) }), f } function f(t) { var i, r; for (this.vo = t._vo, this.tabs = [], i = 0; i < t._tabs.length; i++)r = new n.GridTab(t._tabs[i], this.vo), r.setGridWindow(this), this.tabs.push(r); t = null } function i(t, i) { this.gTab = t; this.vo = t._vo; this.gridTable = new n.GridTable(t._gridTable); this.gridTable.onlyCurrentDays = this.vo.onlyCurrentDays; this.gridTable.MaintainVerOnApproval = this.vo.MaintainVerOnApproval; this.gridTable.IsMaintainVersions = this.vo.IsMaintainVersions; this.gridTable.IsHideVerNewRecord = this.vo.IsHideVerNewRecord; this.parents = []; this.orderBys = []; this.depOnFieldColumn = []; this.depOnField = []; this.tabPanels = []; this.linkColumnName = t._linkColumnName; this.extendedWhere = t._extendedWhere; this.keyColumnName = ""; this.defaultFocusField; this.isThroughRoleCenter = !1; this.query = new n.Query; this.oldQuery = "0=9"; this.linkValue = "999999"; this.currentRow = -1; this.hasPanel = !1; this.isHeaderPanel = !1; this.headerPanel = null; this.isHPanelNotShowInMultiRow = !1; this.mDataStatusEvent; this.mDataListenerList = []; this.loadFields(); this.loadTabPanels(); this.loadHeaderPanelItems(); this.gridTable.addDataStatusListener(this); this.gridTable.setAD_Tab_ID(this.vo.AD_Tab_ID); this.log = n.Logging.VLogger.getVLogger("VIS.GridTab"); this.loadData(i); i = null; this.gridWindow = null; this.outerWhereCondition = null } function u(t) { this.gTable = t; this.readOnly = this.gTable._readOnly; this.AD_Table_ID = t._AD_Table_ID; this.deleteable = this.gTable._deleteable; this.gridFields = []; this.keyColumnName = ""; this.isOpen = !1; this.inserting = !1; this.SQL_Select = ""; this.SQL_Count = ""; this.SQL = ""; this.bufferList = []; this.defaultModel = {}; this.pazeSize = n.Env.getWINDOW_PAGE_SIZE(); this.newRow = -1; this.compareDB = !0; this.treeNode_ID = 0; this.treeTable_ID = 0; this.treeID = 0; this.selectedTreeNode = 0; this.ShowSummaryNodes = !1; this.isSummaryyNode = !1; this.isZoomAction = !1; this.currentPage; this.dopaging; t = null; this.mSortList; this.AD_Tab_ID = 0; this.log = n.Logging.VLogger.getVLogger("VIS.GridTable"); this.card_ID = 0; this.lastFocus = null } function r(t) { this.gfield = t; this.vo = t._vo; this.vo.orginalDispaly = t._vo.displayType; this.oldValue; this.value; this.inserting; this.error; this.valueNoFire = !0; this.gridTab = null; var i = null; (this.vo.IsDisplayedf || this.vo.IsDisplayedMR || this.vo.ColumnName.toLower().equals("createdby") || t._vo.ColumnName.toLower().equals("updatedby") || this.vo.IsHeaderPanelitem) && (t._vo.lookupInfo != null && n.DisplayType.IsLookup(t._vo.displayType) ? n.DisplayType.IsLookup(t._vo.displayType) && (i = new n.MLookup(t._vo.lookupInfo, t._lookup, t._vo.AD_Window_ID, t._vo.AD_Field_ID, t._vo.AD_Tab_ID), this.vo.tabNo > 0 ? (i.initialize(!0), n.MLookupCache.addWindowLookup(this.vo.windowNo, i)) : i.initialize()) : t._vo.displayType == n.DisplayType.Location ? i = new n.MLocationLookup(n.context, t._vo.windowNo) : t._vo.displayType == n.DisplayType.Locator ? i = new n.MLocatorLookup(n.context, t._vo.windowNo) : t._vo.displayType == n.DisplayType.Account ? (i = new n.MAccountLookup(n.context, t._vo.windowNo), i.setTabNo(this.vo.tabNo)) : t._vo.displayType == n.DisplayType.PAttribute ? i = new n.MPAttributeLookup(n.context, t._vo.windowNo) : t._vo.displayType == n.DisplayType.GAttribute ? i = new n.MGAttributeLookup(n.context, t._vo.windowNo) : t._vo.displayType == n.DisplayType.AmtDimension ? i = new n.MAmtDivLookup(n.context, t._vo.windowNo) : t._vo.displayType == n.DisplayType.ProductContainer && (i = new n.MProductContainerLookup(n.context, t._vo.windowNo))); this.lookup = i; this.propertyChangeListner; this.log = n.Logging.VLogger.getVLogger("VIS.GridField"); t = null } function h(n) { this.tPanel = n; this.vo = n._vo } function e(t, i, r, u, f) { this.mTotalPage = 1; this.mCurrentPage = 1; this.mPageSize = n.Env.getWINDOW_PAGE_SIZE(); this.totalRecords = 1; this.m_totalRows = i; this.m_changed = r; this.m_autoSave = u; this.m_inserting = f; this.m_AD_Message; this.m_info = null; this.m_isError = !1; this.m_isWarning = !1; this.m_confirmed = !1; this.m_allLoaded = !0; this.m_loadedRows = -1; this.m_currentRow = -1; this.m_changedColumn = -1; this.m_columnName = null; this.Created; this.CreatedBy; this.Updated; this.UpdatedBy; this.Info; this.AD_Table_ID; this.Record_ID; this.source = t } var o = n.Logging.Level, c = n.Application.contextUrl, y = c + "JsonData/JDataSetWithCode", p = c + "JsonData/ExecuteNonQuer", w = c + "Form/JDataSet", s = function (t, i, r) { var e = r ? !0 : !1, f = { sql: t, page: 1, pageSize: 0 }, u; return i && (f.param = i), u = null, l(f, e, function (t) { u = (new n.DB.DataReader).toJson(t); r && r(u) }), u }, b = function (t, i, r) { var e = r ? !0 : !1, f = { sql: t, page: 1, pageSize: 0 }, u; return i && (f.param = i), u = null, l(f, e, function (t) { u = (new n.DB.DataSet).toJson(t); r && r(u) }), u }, d = function (t, i, r) { var f = r ? !0 : !1, e = { sql: t, page: 1, pageSize: 0 }, u; return i && (e.param = i), u = null, l(e, f, function (t) { i = (new n.DB.DataSet).toJson(t); var i = (new n.DB.DataSet).toJson(t); u = i.getTable(0).getRows().length > 0 ? i.getTable(0).getRow(0).getCell(0) : null; i.dispose(); i = null; f && r(u) }), u }, g = function (t, i, r) { var f = r ? !0 : !1, e = { sql: t, page: 1, pageSize: 0 }, u; return i && (e.param = i), u = null, v(e, f, function (t) { i = (new n.DB.DataSet).toJson(t); var i = (new n.DB.DataSet).toJson(t); u = i.getTable(0).getRows().length > 0 ? i.getTable(0).getRow(0).getCell(0) : null; i.dispose(); i = null; f && r(u) }), u }, a = function (t, i, r) { var e = r ? !0 : !1, f = { sql: t, page: 1, pageSize: 0 }, u; return i && (f.param = i), u = null, v(f, e, function (t) { u = (new n.DB.DataReader).toJson(t); r && r(u) }), u }, nt = function (n, i, r) { var f = r ? !0 : !1, u = null, e = { sql: n.join("/"), param: i }; return t.ajax({ url: p + "ies", type: "POST", datatype: "json", contentType: "application/json; charset=utf-8", async: f, data: JSON.stringify(e) }).done(function (n) { u = n; r && r(n) }), u }; f.prototype.getTabs = function () { return this.tabs }; f.prototype.getTab = function (n) { return n < 0 || n + 1 > this.tabs.length ? null : this.tabs[n] }; f.prototype.getIsAppointment = function () { return this.vo.IsAppointment }; f.prototype.getIsTask = function () { return this.vo.IsTask }; f.prototype.getIsEmail = function () { return this.vo.IsEmail }; f.prototype.getIsLetter = function () { return this.vo.IsLetter }; f.prototype.getIsSms = function () { return this.vo.IsSms }; f.prototype.getIsChat = function () { return this.vo.IsChat }; f.prototype.getIsAttachment = function () { return this.vo.IsAttachment }; f.prototype.getIsHistory = function () { return this.vo.IsHistory }; f.prototype.getIsRecordShared = function () { return this.vo.IsRecordShared }; f.prototype.getWindowType = function () { return this.vo.WindowType }; f.prototype.getIsCheckRequest = function () { return this.vo.IsCheckRequest }; f.prototype.getIsCopyReocrd = function () { return this.vo.IsCopyReocrd }; f.prototype.getIsSubscribedRecord = function () { return this.vo.IsSubscribedRecord }; f.prototype.getIsZoomAcross = function () { return this.vo.IsZoomAcross }; f.prototype.getIsCreatedDocument = function () { return this.vo.IsCreatedDocument }; f.prototype.getIsUploadedDocument = function () { return this.vo.IsUploadedDocument }; f.prototype.getIsViewDocument = function () { return this.vo.IsViewDocument }; f.prototype.getIsAttachDocumentFrom = function () { return this.vo.IsAttachDocumentFrom }; f.prototype.getIsGenerateAttachmentCode = function () { return this.vo.IsGenerateAttachmentCode }; f.prototype.getIsFaxEmail = function () { return this.vo.IsFaxEmail }; f.prototype.getIsMarkToExport = function () { return this.vo.IsMarkToExport }; f.prototype.getIsArchive = function () { return this.vo.IsArchive }; f.prototype.getIsImportMap = function () { return this.vo.IsImportMap }; f.prototype.getIsAttachmail = function () { return this.vo.IsAttachmail }; f.prototype.getIsRoleCenterView = function () { return this.vo.IsRoleCenterView }; f.prototype.getIsSOTrx = function () { return this.vo.IsSOTrx }; f.prototype.getIsTransaction = function () { return this.vo.IsTransaction }; f.prototype.getName = function () { return this.vo.Name }; f.prototype.getWindowWidth = function () { return this.vo.WinWidth }; f.prototype.getHasPanel = function () { return this.vo.hasPanel }; f.prototype.getFontName = function () { return this.vo.FontName }; f.prototype.getAD_Image_ID = function () { return this.vo.AD_Image_ID }; f.prototype.getImageUrl = function () { return this.vo.ImageUrl }; f.prototype.getIsCompositeView = function () { return this.vo.IsCompositeView }; f.prototype.getIsHideTabLinks = function () { return this.vo.IsHideTabLinks }; f.prototype.getIsHideToolbar = function () { return this.vo.IsHideToolbar }; f.prototype.getIsHideActionbar = function () { return this.vo.IsHideActionbar }; f.prototype.dispose = function () { var n; for (originalLength = this.tabs.length, n = originalLength; n > 0; n--)gtab = this.tabs.pop(), gtab.dispose(), gtab = null; this.tabs.length = 0; this.vo = null; this.tabs = null }; i.prototype.setGridWindow = function (n) { this.gridWindow = n }; i.prototype.getParentTab = function () { var n = this.getParentTabNo(); return n < 0 || n == this.vo.tabNo ? null : this.gridWindow.getTab(n) }; i.prototype.getParentTabNo = function () { var t = this.vo.tabNo, i = this.vo.TabLevel, r = i - 1; if (r < 0) return t; while (r < i && t > 0) t--, i = n.context.getContextAsInt(this.vo.windowNo, t, "TabLevel"); return t }; i.prototype.getAD_Tab_ID = function () { return this.vo.AD_Tab_ID }; i.prototype.getAD_Window_ID = function () { return this.vo.AD_Window_ID }; i.prototype.getAD_Table_ID = function () { return this.vo.AD_Table_ID }; i.prototype.getTableName = function () { return this.vo.TableName }; i.prototype.getName = function () { return this.vo.Name }; i.prototype.getDescription = function () { return this.vo.Description }; i.prototype.getIsSortTab = function () { return this.vo.IsSortTab }; i.prototype.getDependentOn = function () { var t = []; return n.Evaluator.parseDepends(t, this.vo.DisplayLogic), t }; i.prototype.getTabLevel = function () { return this.vo.TabLevel }; i.prototype.getWindowNo = function () { return this.vo.windowNo }; i.prototype.getTabNo = function () { return this.vo.tabNo }; i.prototype.getIsSingleRow = function () { return this.vo.IsSingleRow }; i.prototype.getTabLayout = function () { return this.vo.TabLayout }; i.prototype.getNewRecordView = function () { return this.vo.NewRecordView }; i.prototype.getIsDisplayed = function (t) { var i = this.vo.DisplayLogic, r; return i == null || i.equals("") ? !0 : t ? i.indexOf("@#") != -1 && (r = n.Env.parseContext(n.context, 0, i, !1, !0).trim(), r.Length != 0) ? n.Evaluator.evaluateLogic(this, i) : !0 : n.Evaluator.evaluateLogic(this, i) }; i.prototype.getValueAsString = function (t) { var i = n.context.getContext(this.vo.windowNo, "tb_Index", !0); return (value = i == this.vo.tabNo ? n.context.getWindowContext(this.vo.windowNo, this.vo.tabNo, t, !0) : n.context.getWindowContext(this.vo.windowNo, t, !0), !value) ? "" : value.toString() }; i.prototype.getIsCurrent = function () { if (!this.gridTable.getIsOpen() || !this.oldQuery.equals(this.query.getWhereClause())) return !1; if (!this.getIsDetail()) return !0; var t = n.context.getWindowContext(this.vo.windowNo, this.getLinkColumnName()); return this.linkValue.equals(t) }; i.prototype.getIsDetail = function () { return this.parents.length > 0 || this.vo.AD_Column_ID != 0 ? !0 : !1 }; i.prototype.getField = function (n) { return this.gridTable.getField(n) }; i.prototype.getFieldById = function (n) { return this.gridTable.getFieldById(n) }; i.prototype.getFields = function () { return this.gridTable.getFields() }; i.prototype.getLinkColumnName = function () { return this.linkColumnName ? this.linkColumnName : "" }; i.prototype.getOnlyCurrentDays = function () { return this.getIsZoomAction() ? 0 : this.vo.onlyCurrentDays }; i.prototype.getShowSummaryLevel = function () { return this.vo.ShowSummaryLevel }; i.prototype.getIsTPBottomAligned = function () { return this.vo.TabPanelAlignment == "H" }; i.prototype.getIsTreeTab = function () { return this.vo.HasTree }; i.prototype.getRowCount = function () { return this.gridTable.getRowCount() }; i.prototype.getRecords = function () { return this.gridTable.getDataTable() }; i.prototype.getCurrentRow = function () { return this.currentRow }; i.prototype.getOrderByClause = function (n) { var i, t; if (this.vo.orderByClause.length > 0) return this.vo.OrderByClause; for (this.vo.orderByClause = "", i = 0; i < 3; i++)t = this.orderBys[i], t && t != null && t != "" && t.length > 0 && (this.vo.orderByClause.length > 0 && (this.vo.OrderByClause += ","), this.vo.orderByClause += t); return this.vo.orderByClause.Length > 0 ? this.vo.orderByClause : (this.vo.orderByClause = "Created", n > 0 && (this.vo.orderByClause += " DESC"), this.vo.orderByClause) }; i.prototype.getTableModel = function () { return this.gridTable }; i.prototype.getIsOpen = function () { return this.gridTable != null ? this.gridTable.getIsOpen() : !1 }; i.prototype.getIsQueryActive = function () { return this.query != null ? this.query.getIsActive() : !1 }; i.prototype.getDependantFields = function (n) { var i = [], r, t; if (this.depOnFieldColumn.indexOf(n) != -1) for (r = this.depOnFieldColumn.length, t = 0; t < r; t++)this.depOnFieldColumn[t].equals(n) && i.indexOf(this.depOnField[t]) < 0 && i.push(this.depOnField[t]); return i }; i.prototype.getIsReadOnly = function () { if (this.vo.IsReadOnly) return !0; if (this.vo.ReadOnlyLogic == null || this.vo.ReadOnlyLogic.equals("")) return this.vo.IsReadOnly; return n.Evaluator.evaluateLogic(this, this.vo.ReadOnlyLogic) }; i.prototype.getIsQueryNewRecord = function () { return this.query != null ? this.query.getIsNewRecordQuery() : !1 }; i.prototype.getIsAutoNewRecord = function () { return this.vo.IsAutoNewRecord === !0 }; i.prototype.getHideFGFrom = function () { return this.vo.HideFieldGroupFrom }; i.prototype.getIsInsertRecord = function () { if (this.getIsReadOnly()) return !1; var n = !1; return this.vo.RecordLimit > 0 && (n = this.gridTable.getTotalRowCount() >= this.vo.RecordLimit), this.vo.IsInsertRecord && !n }; i.prototype.getIsHideTabName = function () { return this.vo.HideTabName }; i.prototype.getIsResetLayout = function () { return this.vo.ResetLayout }; i.prototype.getIsHideGridToggle = function () { return this.vo.IsHideGridToggle }; i.prototype.getIsHideCardToggle = function () { return this.vo.IsHideCardToggle }; i.prototype.getIsHideRecordNav = function () { return this.vo.IsHideRecordNav }; i.prototype.getIncluded_Tab_ID = function () { return this.vo.Included_Tab_ID }; i.prototype.getIsAlwaysUpdateField = function () { for (var t, n = 0; n < this.gridTable.getColumnCount(); n++)if (t = this.gridTable.getField(n), t.getIsAlwaysUpdateable()) return !0; return !1 }; i.prototype.getValue = function (n) { if (n == null) return null; var t = this.gridTable.getField(n); return this.getValueOfField(t) }; i.prototype.getValueOfField = function (n) { return n == null ? null : n.getValue() }; i.prototype.getAD_Process_ID = function () { return this.vo.AD_Process_ID }; i.prototype.getRecord_ID = function () { return this.gridTable.getKeyID(this.currentRow) }; i.prototype.getDummyRecordID = function () { return this.gridTable.getDummyRecordID(this.currentRow) }; i.prototype.getKeyID = function (n) { return this.gridTable.getKeyID(n) }; i.prototype.getFooterInfo = function (i, r, u, f, e) { return new Promise(function (f, o) { var s; if (i.startsWith("C_Order") || i.startsWith("C_Invoice")) { var s, l = i.startsWith("C_Order"), h = null, c = null; try { h = new n.MessageFormat(n.Msg.getMsg("OrderSummary")); c = new n.MessageFormat(n.Msg.getMsg("OrderSummaryMC")) } catch (a) { o(""); return } if (h == null || c == null) { f(""); return } s = 0; s = l ? r.getContextAsInt(u, "C_Order_ID") : r.getContextAsInt(u, "C_Invoice_ID"); s < 1 && e > 0 && (s = e); t.ajax({ type: "Get", async: !0, url: n.Application.contextUrl + "Form/GetTrxInfo", data: { Record_ID: s, isOrder: l }, success: function (t) { var s, l; try { var arguments = [], e = !1, i = (new n.DB.DataReader).toJson(t), u = n.DisplayType.GetNumberFormat(n.DisplayType.Amount); i.read() && (s = i.getInt(0), arguments[0] = s, arguments[1] = u.getLocaleAmount(i.getDecimal(2)), arguments[2] = u.getLocaleAmount(i.getDecimal(3)), l = i.getString(1), arguments[3] = l, arguments[4] = u.getLocaleAmount(i.getDecimal(4)), arguments[5] = r.getContext("$CurrencyISO"), e = !0) } catch (a) { o("") } e ? arguments[2] === arguments[4] ? f(h.format(arguments)) : f(c.format(arguments)) : f(" ") }, error: function () { o("") } }) } }) }; i.prototype.getTrxInfo = function (i, r, u) { var e, f, l, a, v, y, p; if (i.startsWith("C_Order") || i.startsWith("C_Invoice")) { var e, h = i.startsWith("C_Order"), o = null, s = null; try { o = new n.MessageFormat(n.Msg.getMsg("OrderSummary")); s = new n.MessageFormat(n.Msg.getMsg("OrderSummaryMC")) } catch (w) { } if (o == null || s == null) return " "; var arguments = [], c = !1, f = null; try { e = 0; e = h ? r.getContextAsInt(u, "C_Order_ID") : r.getContextAsInt(u, "C_Invoice_ID"); f = null; t.ajax({ type: "Get", async: !1, url: n.Application.contextUrl + "Form/GetTrxInfo", data: { Record_ID: e, isOrder: h }, success: function (t) { f = (new n.DB.DataReader).toJson(t) } }); f.read() && (l = f.getInt(0), arguments[0] = l, a = f.getDecimal(2).toLocaleString(), arguments[1] = a, v = f.getDecimal(3).toLocaleString(), arguments[2] = v, y = f.getString(1), arguments[3] = y, p = f.getDecimal(4).toLocaleString(), arguments[4] = p, arguments[5] = r.getContext("$CurrencyISO"), c = !0) } catch (w) { } finally { f != null && f.dispose() } return c ? arguments[2] === arguments[4] ? o.format(arguments) : s.format(arguments) : " " } }; i.prototype.getIsProcessed = function () { var i = this.gridTable.findColumn("Processed"), t; if (i != -1) { if (t = this.gridTable.getValueAt(this.currentRow, i), typeof t == "string") return "Y".equals(t); if (typeof t == "boolean") return t } return "Y".equals(n.context.getWindowContext(this.vo.windowNo, this.vo.tabNo, "Processed")) }; i.prototype.getKeyColumnName = function () { return this.keyColumnName }; i.prototype.getAD_ColumnSortOrder_ID = function () { return this.vo.AD_ColumnSortOrder_ID }; i.prototype.getIsMapView = function () { return this.vo.locationCols && this.vo.locationCols.length > 0 ? !0 : !1 }; i.prototype.getMapColumns = function () { return this.vo.locationCols }; i.prototype.getAD_ColumnSortYesNo_ID = function () { return this.vo.AD_ColumnSortYesNo_ID }; i.prototype.getWhereClause = function () { return this.vo.WhereClause }; i.prototype.getSearchQuery = function (t) { for (var r = null, u = this.getFields(), i = null, f = 0; f < u.length; f++)(i = u[f], i.getIsVirtualColumn()) || i.getColumnName().toLowerCase() != "export_id" && n.DisplayType.IsText(i.getDisplayType()) && (r || (r = new n.Query(this.getTableName(), !0)), r.addRestriction(i.getColumnName(), n.Query.prototype.LIKE, t, i.getColumnName(), t)); return u = null, i = null, r }; i.prototype.getParentColumnNames = function () { return this.parents }; i.prototype.clearSelectedRow = function () { for (var n, i = this.gridTable.getFields().length, t = 0; t < i; t++)n = this.gridTable.getField(t), n.getIsKey() ? n.setValue(null, !1) : n.setNullValue() }; i.prototype.setCurrentRow = function (n, t) { var f = -1, c = this.verifyRow(n), r, s, u, i, h, o; for (this.currentRow = c, r = this.gridTable.getRow(this.currentRow), r && (f = r.recid), s = this.gridTable.getFields().length, u = 0; u < s; u++)i = this.gridTable.getField(u), r ? (h = r[i.getColumnName().toLowerCase()], i.setValue(h, this.gridTable.getIsInserting())) : i.getIsKey() ? i.setValue(null, !1) : i.setNullValue(); return t ? (this.mDataStatusEvent != null && this.mDataStatusEvent.getTotalRows() != this.gridTable.rowCount && (this.mDataStatusEvent = null), this.mDataStatusEvent == null && (this.mDataStatusEvent = new e(null, this.getRowCount(), this.gridTable.getIsInserting(), !1, this.gridTable.getIsInserting()), this.mDataStatusEvent.AD_Table_ID = this.getAD_Table_ID(), this.mDataStatusEvent.setPageInfo(this.gridTable.currentPage, this.gridTable.rowCount, this.gridTable.pazeSize)), this.mDataStatusEvent.setCurrentRow(this.currentRow), o = this.mDataStatusEvent.getAD_Message(), (o == null || o.length == 0) && this.mDataStatusEvent.setInfo("NavigateOrUpdate", null, !1, !1), this.fireDataStatusChanged(this.mDataStatusEvent), f) : f }; i.prototype.fireDataStatusEventOnly = function () { this.mDataStatusEvent == null && (this.mDataStatusEvent = new e(null, this.getRowCount(), this.gridTable.getIsInserting(), !1, this.gridTable.getIsInserting()), this.mDataStatusEvent.AD_Table_ID = this.getAD_Table_ID(), this.mDataStatusEvent.setPageInfo(this.gridTable.currentPage, this.gridTable.rowCount, this.gridTable.pazeSize)); this.mDataStatusEvent.setCurrentRow(this.currentRow); var n = this.mDataStatusEvent.getAD_Message(); (n == null || n.length == 0) && this.mDataStatusEvent.setInfo("NavigateOrUpdate", null, !1, !1); this.fireDataStatusChanged(this.mDataStatusEvent) }; i.prototype.getLastFocus = function () { return this.gridTable.getLastFocus() }; i.prototype.setLastFocus = function (n) { this.gridTable.setLastFocus(n) }; i.prototype.setQuery = function (t) { t == null ? this.query = new n.Query : (this.query = t, this.vo.onlyCurrentDays = 0) }; i.prototype.setValue = function (t, i) { var r, u; if (!(t instanceof n.GridField)) { if (t == null) return "NoColumn"; t = this.gridTable.getField(t) } return t == null ? "NoField" : (r = t.getDisplayType(), i == null || i.toString() == "" ? i = null : i === 0 && (n.DisplayType.IsID(r) || r == n.DisplayType.List) && !this.getIsStdColumn(t.getColumnName().toUpper()) && (i = null), u = this.gridTable.findColumn(t.getColumnName()), this.gridTable.setValueAt(i, this.currentRow, u, !1), this.processFieldChange(t)) }; i.prototype.getIsStdColumn = function (n) { return n == "AD_USER_ID" || n == "AD_ROLE_ID" || n == "AD_CLIENT_ID" || n == "AD_ORG_ID" ? !0 : !1 }; i.prototype.addDataStatusListener = function (n) { this.mDataListenerList.push(n) }; i.prototype.removeDataStatusListener = function (n) { for (var t = this.mDataListenerList.length - 1; t >= 0; t--)this.mDataListenerList[t] === n && (this.mDataListenerList[t] = null, this.mDataListenerList.splice(t, 1)) }; i.prototype.needSave = function (n, t) { return n ? this.gridTable.needSave(-2, t) : t ? this.gridTable.needSave() : this.gridTable.needSave(t) }; i.prototype.loadFields = function () { for (var n, t, i, e, f, u = 0; u < this.gTab._gridTable.m_fields.length; u++) { for (n = new r(this.gTab._gridTable.m_fields[u]), n.setGridTab(this), this.gridTable.gridFields.push(n), n.getIsDefaultFocus() && (this.defaultFocusField = n), t = n.getColumnName(), n.getIsKey() && (this.keyColumnName = t, this.gridTable.setKeyColumnName(t)), n.getIsParentColumn() && this.parents.push(t), i = n.getSortNo(), i == 0 || (Math.abs(i) == 1 ? (this.orderBys[0] = t, i < 0 && (this.orderBys[0] += " DESC")) : Math.abs(i) == 2 ? (this.orderBys[1] = t, i < 0 && (this.orderBys[1] += " DESC")) : Math.abs(i) == 3 && (this.orderBys[2] = t, i < 0 && (this.orderBys[2] += " DESC"))), e = n.getDependentOn(), f = 0; f < e.length; f++)this.depOnFieldColumn.push(e[f]), this.depOnField.push(n); (t.equals("IsActive") || t.equals("Processed") || t.equals("Processing")) && (this.depOnFieldColumn.push(t), this.depOnField.push(null)); n = null } }; i.prototype.loadTabPanels = function () { var n, t; if (this.gTab._panels && this.gTab._panels.length > 0) for (this.hasPanel = !0, n = 0; n < this.gTab._panels.length; n++)t = new h(this.gTab._panels[n]), this.tabPanels.push(t); else this.hasPanel = !1 }; i.prototype.loadHeaderPanelItems = function () { this.vo.HeaderItems && (this.isHeaderPanel = !0, headerPanel = this.vo.HeaderItems, this.isHPanelNotShowInMultiRow = this.vo.HPanelNotShowInMultiRow) }; i.prototype.getIsHeaderPanel = function () { return this.isHeaderPanel }; i.prototype.getHeaderPanelItems = function () { return headerPanel }; i.prototype.getHeaderHeight = function () { return this.vo.HeaderHeight && this.vo.HeaderHeight > 0 ? this.vo.HeaderHeight + "px" : "200px" }; i.prototype.getHeaderWidth = function () { return this.vo.HeaderWidth && this.vo.HeaderWidth > 0 ? this.vo.HeaderWidth + "px" : "250px" }; i.prototype.getHeaderBackColor = function () { return this.vo.HeaderBackColor }; i.prototype.getHeaderPadding = function () { return this.vo.HeaderPadding }; i.prototype.getHeaderHorizontal = function () { return this.vo.HeaderAlignment.equals("H") ? !0 : !1 }; i.prototype.getHasPanel = function () { return this.hasPanel }; i.prototype.getTabPanels = function () { return this.tabPanels }; i.prototype.validateQuery = function (t) { var i, r, h, u, c, e, f, v, l; if (t == null || t.getRestrictionCount() == 0) return null; if (t.getRestrictionCount() != 1 || (i = t.getColumnName(0), i == null) || i.indexOf("(") != -1) return t.getWhereClause(); if (r = null, i.equals("R_RequestRelated_ID") ? r = "R_Request_ID" : i.startsWith("C_DocType") ? r = "C_DocType_ID" : i.equals("CreatedBy") || i.equals("UpdatedBy") ? r = "AD_User_ID" : i.equals("Orig_Order_ID") ? r = "C_Order_ID" : i.equals("Orig_InOut_ID") && (r = "M_InOut_ID"), r != null) { if (this.getField(r) != null) return t.setColumnName(0, r), t.getWhereClause(); r = null } if (this.getField(i) != null) return t.getWhereClause(); h = "VIS_104"; f = []; f[0] = new n.DB.SqlParam("@colName", i); u = null; try { u = s(h, f); u.read() && (r = u.getString(0)) } catch (a) { return this.log.log(o.SEVERE, "(ref) - Column=" + i, a), t.getWhereClause() } finally { u != null && u.dispose() } if (r != null) { if (t.setColumnName(0, r), this.getField(r) != null) return this.log.fine("Column " + i + " replaced with " + r), t.getWhereClause(); i = r } c = null; e = this.getKeyColumnName(); h = "VIS_105"; f = []; f[0] = new n.DB.SqlParam("@colName", i); f[1] = new n.DB.SqlParam("@tabKeyColumn", e); try { u = s(h, f); u.read() && (c = u.getString(0)) } catch (a) { return this.log.log(o.SEVERE, "Column=" + i + ", Key=" + e, a), null } finally { u != null && u.dispose() } return e.equals("AD_Reference_ID") ? (h = "VIS_106", f = [], f[0] = new n.DB.SqlParam("@colName", i), v = d(h, f), "AD_Reference_ID=" + v) : c == null ? (this.log.info("Not successfull - Column=" + i + ", Key=" + e + ", Query=" + t), t.getWhereClause()) : (t.setTableName("xx"), l = "EXISTS (SELECT * FROM " + c + " xx WHERE " + t.getWhereClause(!0) + " AND xx." + e + "=" + this.getTableName() + "." + e + ")", this.log.fine(l), l) }; i.prototype.setTreeNodeID = function (n) { this.treeNode_ID = n; this.gridTable.treeNode_ID = n }; i.prototype.setTreeID = function (n) { this.treeID = n; this.gridTable.treeID = n }; i.prototype.setTreeTable = function (n) { this.treeTable_ID = n; this.gridTable.treeTable_ID = n }; i.prototype.setShowSummaryNodes = function (n) { this.ShowSummaryNodes = n; this.gridTable.ShowSummaryNodes = n }; i.prototype.setIsZoomAction = function (n) { this.isZoomAction = n; this.gridTable.isZoomAction = n }; i.prototype.getIsZoomAction = function () { return this.isZoomAction }; i.prototype.prepareQuery = function (t, i, r, u) { var v = !0, w = !1, h, f, y, s, e, p, k, c, a, o, l; if (n.context.clearTabContext(this.vo.windowNo, this.vo.tabNo), h = this.oldQuery.equals(this.query.getWhereClause()) && this.vo.onlyCurrentDays == t, this.getIsTreeTab() && (this.getShowSummaryLevel() || this.gridTable.setDoPaging(!1), this.getShowSummaryLevel() && (this.gridTable.setDoPaging(!0), h = !1)), this.oldQuery = this.query.getWhereClause(), this.vo.onlyCurrentDays = t, f = "", u || (f += this.vo.WhereClause), !this.ShowSummaryNodes && this.getShowSummaryLevel() && (f += f.length > 0 ? " AND IsSummary='N'" : " IsSummary='N'"), this.getOnlyCurrentDays() > 0 && (f.length > 0 && (f += " AND "), y = this.findColumn("Processed") != -1, y && (f += "(Processed='N' OR "), f += r ? "Created>=" : "Updated>=", f += "addDays(SysDate, -" + this.vo.onlyCurrentDays + ")", y && (f += ")")), this.isThroughRoleCenter || this.getIsDetail() && (s = this.getLinkColumnName(), s.equals("") ? (f.length > 0 && (f += " AND "), f += " 2=3", v = !1) : (e = "", e = this.vo.tabNo > 0 ? n.context.getTabRecordContext(this.vo.windowNo, this.getParentTabNo(), s, !0) : n.context.getTabRecordContext(this.vo.windowNo, this.getParentTabNo(), s), h && (h = this.linkValue.equals(e), w = !h), this.linkValue = e, e.length == 0 ? (f.length > 0 && (f += " AND "), f += " 2=4", v = !1) : (f.length > 0 && (f += " AND "), "NULL".equals(e.toUpper()) ? f += s + " IS NULL " : (f += s + "=", f += s.endsWith("_ID") ? e : "'" + e + "'")))), this.query.getIsActive() && (p = this.validateQuery(this.query), p == null || w || (f.length > 0 && (f += " AND "), f += p)), this.extendedWhere = f.toString(), this.mDataStatusEvent = null, this.gridTable.getIsOpen()) h ? this.gridTable.dataRefreshAll() : this.gridTable.dataRequery(f.toString()); else { if (!this.isZoomAction && (k = "VIS_107", c = [], c[0] = new n.DB.SqlParam("@AD_User_ID", n.Env.getCtx().getAD_User_ID()), c[1] = new n.DB.SqlParam("@AD_Client_ID", n.Env.getCtx().getAD_Client_ID()), c[2] = new n.DB.SqlParam("@AD_Tab_ID", this.gridTable.AD_Tab_ID), c[3] = new n.DB.SqlParam("@AD_Table_ID", this.gridTable.AD_Table_ID), a = "", o = b(k, c), o && o.tables[0].rows && o.tables[0].rows.length > 0)) { for (l = 0; l < o.tables[0].rows.length; l++)n.Env.getCtx().getAD_User_ID() == o.tables[0].rows[l].cells.ad_user_id && this.gridTable.AD_Tab_ID == o.tables[0].rows[l].cells.ad_tab_id && (a = o.tables[0].rows[l].cells.code); a && (f = f.length > 0 ? f + " AND " + a : a) } this.gridTable.setSelectWhereClause(f.toString()); this.gridTable.open(i) } return v }; i.prototype.dataRefresh = function () { var n = this.currentRow, t = this.gridTable.dataRefresh(n); return this.setCurrentRow(n, !0), t }; i.prototype.dataRefreshAll = function () { this.mDataStatusEvent = null; this.getTableModel().dataRefreshAll() }; i.prototype.dataIgnore = function () { this.gridTable.dataIgnore(!0) && (this.setCurrentRow(this.currentRow, !1), this.currentRow < 0 && (this.currentRow = 0), this.IsSharedAccess(), this.gridTable.fireDataStatusIEvent("Ignored", "")) }; i.prototype.getLinkWhereClause = function () { var t = "", i, r; return this.getIsDetail() && (i = this.getLinkColumnName(), i.equals("") ? (t.length > 0 && (t += " AND "), t += " 2=3") : (r = n.context.getTabRecordContext(this.vo.windowNo, this.getParentTabNo(), i, !0), i = this.getTableName() + "." + i, r.length == 0 ? (t.length > 0 && (t += " AND "), t += " 2=4") : (t.length > 0 && (t += " AND "), "NULL".equals(r.toUpper()) ? t += i + " IS NULL " : (t += i + "=", t += i.endsWith("_ID") ? r : "'" + r + "'")))), t }; i.prototype.SetSelectedNode = function (n) { this.gridTable.selectedTreeNode = n }; i.prototype.SetIsSummaryNode = function (n) { this.gridTable.isSummaryyNode = n }; i.prototype.dataSave = function (t) { try { var i = this.gridTable.dataSave(t) == n.GridTable.prototype.SAVE_OK; return t && this.setCurrentRow(this.currentRow, !1), i, i } catch (r) { this.log.log(n.Logging.Level.SEVERE, "#" + this.vo.tabNo + " - row=" + this.currentRow, r) } return !1 }; i.prototype.dataNew = function (t) { var r, u, f, i; if (!this.getIsInsertRecord()) return this.log.warning("Insert Not allowed in TabNo=" + this.vo.tabNo), null; if (this.vo.tabNo > 0) { if (r = "Y".equals(n.context.getWindowContext(this.vo.windowNo, "Processed")), r) return this.log.warning("Not allowed in TabNo=" + this.vo.tabNo + " -> Processed=" + r), null; this.log.finest("Processed=" + r) } if (u = this.gridTable.dataNew(this.currentRow, t), !u) return u; for (this.setCurrentRow(this.currentRow + 1, !0), f = this.getFieldCount(), this.gridTable.setDisableNotification(!0), i = 0; i < f; i++)this.processCallout(this.getField(i)); for (i = 0; i < f; i++)this.getField(i).setError(!1); return this.IsSharedAccess(), this.gridTable.setDisableNotification(!1), this.gridTable.fireDataStatusIEvent(t ? "UpdateCopied" : "Insertdata", ""), u }; i.prototype.dataDelete = function (n) { var t = this.gridTable.dataDelete(n, this.currentRow); return this.setCurrentRow(this.currentRow, !0), this.IsSharedAccess(), t }; i.prototype.findColumn = function (n) { return this.gridTable.findColumn(n) }; i.prototype.navigate = function (n, t, i) { var u = -1, r = null; return !i && (n === this.currentRow || (r = this.verifyRow(n), r === this.currentRow)) ? u : (r = r != null ? r : this.currentRow, this.gridTable.dataSave(r, !1) && (u = this.setCurrentRow(r, t)), this.IsSharedAccess(), u) }; i.prototype.IsSharedAccess = function () { var u, i, r; if (this.gridTable.getIsInserting()) { this.IsSharedReadOnly = !1; this.isCurrentRecordShare = !1; return } (u = this.getAD_Table_ID(), i = this.getRecord_ID(), i < 0 && this.getRecords().length && this.currentRow > -1 && this.getTableName() && this.getRecords()[this.currentRow] && (i = this.getRecords()[this.currentRow][this.getTableName().toLower() + "_id"]), i && i < 0) || (r = this, t.ajax({ async: !1, url: n.Application.contextUrl + "RecordShared/GetSharedRecordAccess", data: { AD_Table_ID: u, Record_ID: i }, success: function (n) { n = JSON.parse(n); n = n.split("_"); r.IsSharedReadOnly = n[0].toLowerCase() == "true" ? !0 : !1; r.isCurrentRecordShare = n[1] == "N" ? !1 : !0 }, error: function (n) { console.log(n) } })) }; i.prototype.verifyRow = function (n) { var t = n, i; return this.gridTable.getIsOpen() ? (i = this.getRowCount(), i == 0) ? -1 : (t >= i ? t = i - 1 : t < 0 && (t = 0), t) : -1 }; i.prototype.navigateRelative = function (n) { return this.navigate(this.currentRow + n) }; i.prototype.hasDependants = function (n) { return this.depOnFieldColumn.indexOf(n) !== -1 }; i.prototype.dataStatusChanged = function (n) { var i = n.getCurrentRow(), r = n.getAD_Message(), t; n.setCurrentRow(this.currentRow); this.mDataStatusEvent = n; i == this.currentRow ? (t = this.gridTable.getField(n.getChangedColumn()), t != null) : this.fireDataStatusChanged(this.mDataStatusEvent) }; i.prototype.fireDataStatusChanged = function (n) { var u = this.mDataListenerList, t, i, f, r; if (u.length != 0) { if (n.getCurrentRow() >= 0) { if (n.Created = this.getValue("Created"), n.CreatedBy = this.getValue("CreatedBy"), n.Updated = this.getValue("Updated"), n.UpdatedBy = this.getValue("UpdatedBy"), n.Record_ID = this.getKeyID(n.getCurrentRow()), t = new StringBuilder(this.getTableName()), this.keyColumnName != null && this.keyColumnName.length > 0) t.append(" - ").append(this.keyColumnName).append("=").append(n.Record_ID); else for (i = 0; i < this.parents.length; i++)f = this.parents[i], t.append(" - ").append(f).append("=").append(this.getValue(f)); n.Info = t.toString() } for (n.setInserting(this.gridTable.getIsInserting()), r = 0; r < u.length; r++)u[r].dataStatusChanged(n) } }; i.prototype.processFieldChange = function (n) { return this.processDependencies(n), this.processCallout(n) }; i.prototype.processDependencies = function (t) { var r = t.getColumnName(), f, u, i, e; if (this.hasDependants(r)) for (f = this.getDependantFields(r), u = 0; u < f.length; u++) { if (i = f[u], i != null && i.getLookup() instanceof n.MLookup && (e = i.getLookup(), e.getValidation().indexOf("@" + r + "@") != -1)) if (r == "C_BPartner_ID" && i.getColumnName() == "C_BPartner_Location_ID") continue; else { if (i.getValue() == null) continue; if (this.log.fine(r + " changed - " + i.getColumnName() + " set to null"), i.getValue() == null) return; this.setValue(i, null) } i != null && i.getLookup() instanceof n.MLocatorLookup } }; i.prototype.processCallout = function (t) { var l = t.getCallout(), e, i; if (l.length == 0 || this.getIsProcessed()) return ""; for (var v = t.getValue(), y = t.getOldValue(), a = new n.StringTokenizer(l, ";,", !1); a.hasMoreTokens();) { var u = a.nextToken().trim(), h = null, f = null, r = u, c = u.lastIndexOf("."); try { c != -1 && (r = u.substring(0, c).replace("ViennaAdvantage", "VIS").replace("VAdvantage", "VIS"), e = n.Utility.getFunctionByName(r, window), e || r.startsWith("VIS") || (r = "VIS" + r.substring(r.indexOf(".")), e = n.Utility.getFunctionByName(r, window)), h = new e, f = u.substring(c + 1)) } catch (s) { return this.log.log(o.SEVERE, r, s), "Callout Invalid: " + r + " (" + s.toString() + ")" } if (h == null || f == null || f.length == 0) return "Callout Invalid: " + f; i = ""; try { i = h.start(n.context, f, this.vo.windowNo, this, t, v, y) } catch (s) { return this.log.log(n.Logging.Level.SEVERE, "start", s), i = "Callout Invalid: " + s.toString() } if (i && !i.toString().equals("")) return i instanceof Error && (i = i.toString() + "-> " + u), this.log.warning(i), i } return "" }; i.prototype.getFieldCount = function () { return this.gridTable.getColumnCount() }; i.prototype.getCM_ChatID = function () { var t; return ((this.chats == null || this.chats.length == 0) && this.loadChats(), this.chats == null) ? 0 : (t = this.getRecord_ID(), this.hasKey(this.chats, t)) ? n.Utility.Util.getValueOfInt(this.getKeyValue(this.chats, t)) : 0 }; i.prototype.getCM_SubScribedID = function () { var t; return ((this._subscribe == null || this._subscribe.length == 0) && this.loadSubscribe(), this._subscribe == null) ? 0 : (t = this.getRecord_ID(), this.hasKey(this._subscribe, t)) ? n.Utility.Util.getValueOfInt(this.getKeyValue(this._subscribe, t)) : 0 }; i.prototype.hasKey = function (n, t) { for (var i = 0; i < n.length; i++)if (n[i].ID === t) return !0; return !1 }; i.prototype.getKeyValue = function (n, t) { for (var i = 0; i < n.length; i++)if (n[i].ID === t) return n[i].value; return 0 }; i.prototype.getCommitWarning = function () { return this.vo.CommitWarning }; i.prototype.getField = function (n) { return this.gridTable.getField(n) }; i.prototype.dispose = function () { if (this.gTab = null, this.vo = null, this.gridTable.removeDataStatusListener(this), this.gridTable.dispose(), this.gridTable = null, this.mDataListenerList != null) for (var n = this.mDataListenerList.length - 1; n >= 0; n--)this.mDataListenerList[n] = null, this.mDataListenerList.splice(n, 1) }; i.prototype.getIsLocked = function () { if (!n.MRole.getIsPersonalLock() || this.isDataLoading || (this._Lock == null && this.loadLocks(), this._Lock == null || this._Lock.length == 0)) return !1; var t = this.getRecord_ID(); return this._Lock.indexOf(t) > -1 }; i.prototype.loadLocks = function () { var f = n.context.getAD_User_ID(), r, i, t, u; if (this.canHaveAttachment()) { r = "VIS_108"; i = []; i[0] = new n.DB.SqlParam("@AD_User_ID", f); i[1] = new n.DB.SqlParam("@AD_Table_ID", this.vo.AD_Table_ID); t = null; try { for (this._Lock == null ? this._Lock = [] : this._Lock.length = 0, t = s(r, i); t.read();)u = n.Utility.Util.getValueOfInt(t.get("Record_ID")), this._Lock.push(u); t.close(); t = null } catch (e) { this.log.log(o.SEVERE, r, e) } this.log.fine("#" + this._Lock.length) } }; i.prototype.loadSubscribe = function () { var r, i, t, u, f; if (this.canHaveAttachment()) { r = "VIS_109"; i = []; i[0] = new n.DB.SqlParam("@AD_User_ID", n.context.getAD_User_ID()); i[1] = new n.DB.SqlParam("@AD_Table_ID", this.getAD_Table_ID()); t = null; try { for (this._subscribe = [], this._subscribe == null ? this._subscribe = {} : this._subscribe.length = 0, t = s(r, i); t.read();)u = n.Utility.Util.getValueOfInt(t.getString(1)), f = n.Utility.Util.getValueOfInt(t.getString(0)), this._subscribe.push({ ID: u, value: f }); t = null } catch (e) { } } }; i.prototype.loadDocuments = function () { var r, i, t, u, f; if (this.canHaveAttachment()) { r = "VIS_110"; i = []; i[0] = new n.DB.SqlParam("@ad_table_id", this.getAD_Table_ID()); t = null; try { for (this.viewDocument = [], this.viewDocument == null ? this.viewDocument = {} : this.viewDocument.length = 0, t = s(r, i); t.read();)u = n.Utility.Util.getValueOfInt(t.getString(1)), f = n.Utility.Util.getValueOfInt(t.getString(0)), this.viewDocument.push({ ID: u, value: f }); t = null } catch (e) { } } }; i.prototype.loadChats = function () { var r, i, t, u, f; if (this.canHaveAttachment()) { r = "VIS_111"; i = []; i[0] = new n.DB.SqlParam("@AD_Table_ID", this.getAD_Table_ID()); t = null; try { for (this.chats = [], this.chats == null ? this.chats = {} : this.chats.length = 0, t = s(r, i); t.read();)u = n.Utility.Util.getValueOfInt(t.getString(1)), f = n.Utility.Util.getValueOfInt(t.getString(0)), this.chats.push({ ID: u, value: f }); t = null } catch (e) { } } }; i.prototype.canHaveAttachment = function () { return this.keyColumnName.endsWith("_ID") ? !0 : !1 }; i.prototype.hasChat = function () { if (this.isDataLoading || (this.chats == null && this.loadChats(), this.chats == null)) return !1; var n = this.getRecord_ID(); return this.hasKey(this.chats, n) }; i.prototype.hasDocument = function () { if (this.isDataLoading || (this.viewDocument == null && this.loadDocuments(), this.viewDocument == null)) return !1; var n = this.getRecord_ID(); return this.hasKey(this.viewDocument, n) }; i.prototype.hasShared = function (n) { if (this.isDataLoading || ((this.sharedRecords == null || n == !0) && this.loadShared(), this.sharedRecords == null)) return !1; var t = this.getRecord_ID(); return t == -1 && (t = this.getDummyRecordID()), this.hasKey(this.sharedRecords, t) }; i.prototype.HasSubscribed = function () { if (this.isDataLoading || (this._subscribe == null && this.loadSubscribe(), this._subscribe == null)) return !1; var n = this.getRecord_ID(); return this.hasKey(this._subscribe, n) }; i.prototype.loadShared = function () { var r, i, t, u; if (n.MRole.getIsShowSharedRecord() == !0) { r = "VIS_157"; i = []; i[0] = new n.DB.SqlParam("@AD_Table_ID", this.getAD_Table_ID()); t = null; try { for (this.sharedRecords = [], t = s(r, i); t.read();)u = n.Utility.Util.getValueOfInt(t.getString(0)), this.sharedRecords.push({ ID: u }); t = null } catch (f) { } } }; i.prototype.loadAttachments = function () { var r, i, t, u, f; if (this.canHaveAttachment()) { r = "VIS_112"; i = []; i[0] = new n.DB.SqlParam("@AD_Table_ID", this.getAD_Table_ID()); t = null; try { for (this._attachments = [], t = s(r, i); t.read();)u = n.Utility.Util.getValueOfInt(t.getString(1)), f = n.Utility.Util.getValueOfInt(t.getString(0)), this._attachments.push({ ID: u, value: f }); t = null } catch (e) { } } }; i.prototype.loadMarking = function () { var i = [], t, r, u; i[0] = new n.DB.SqlParam("@AD_Table_ID", this.getAD_Table_ID()); t = null; try { for (this._marking = [], t = s("VIS_113", i); t.read();)r = n.Utility.Util.getValueOfInt(t.getString(1)), u = n.Utility.Util.getValueOfInt(t.getString(0)), this._marking.push({ ID: r, value: u }); t = null } catch (f) { } }; i.prototype.hasAttachment = function () { if (this.isDataLoading || (this._attachments == null && this.loadAttachments(), this._attachments == null)) return !1; var n = this.getRecord_ID(); return this.hasKey(this._attachments, n) }; i.prototype.hasMarked = function () { if (this.isDataLoading || (this._marking == null && this.loadMarking(), this._marking == null)) return !1; var n = this.getRecord_ID(); return this.hasKey(this._marking, n) }; i.prototype.loadData = function () { this.isDataLoading = !1; this.isExportLoading = !1; this._attachments = this.gTab._attachments; this.chats = this.gTab._chats; this._lock = this.gTab._pAccess; this._subscribe = this.gTab._subscribe; this.viewDocument = this.gTab._documents; this.sharedRecords = this.gTab._sharedRec }; i.prototype.locks = function (t, i, r) { var u = t.getAD_User_ID(); n.dataContext.updateInsertLocks(u, this.vo.AD_Table_ID, i, r); this.loadLocks() }; i.prototype.setRecordStatus = function (n) { var t = n }; u.prototype.ctx = n.context; u.prototype.SAVE_OK = "O"; u.prototype.SAVE_ERROR = "E"; u.prototype.SAVE_ACCESS = "A"; u.prototype.SAVE_MANDATORY = "M"; u.prototype.SAVE_ABORT = "U"; u.prototype.SAVE_REGEX_ERROR = "R"; u.prototype.getReadOnly = function () { return !1 }; u.prototype.setAD_Tab_ID = function (n) { this.AD_Tab_ID = n }; u.prototype.getField = function (n) { var r, t, i; if (isNaN(n)) { if (n == null || n.length == 0) return null; for (r = this.gridFields.length, t = 0; t < r; t++)if (i = this.gridFields[t], n.equals(i.getColumnName(), !0)) return i; return null } return n < 0 || n >= this.gridFields.length ? null : this.gridFields[n] }; u.prototype.getFieldById = function (n) { var r, t, i; if (n < 1) return null; for (r = this.gridFields.length, t = 0; t < r; t++)if (i = this.gridFields[t], n === i.getAD_Field_ID()) return i; return null }; u.prototype.getIsInserting = function () { return this.inserting }; u.prototype.getColumnCount = function () { return this.gridFields.length }; u.prototype.getFields = function () { return this.gridFields }; u.prototype.getWhereClause = function (t) { for (var f, i, r, h = this.gridFields.length, e = null, u = null, s = 0; s < h; s++)if (f = this.gridFields[s], f.getIsKey()) { if (i = f.getColumnName().toLowerCase(), r = t[i], r == null) return this.log.log(n.Logging.Level.WARNING, "PK data is null - " + i), null; e = i.toUpperCase().endsWith("_ID") ? new StringBuilder(i).append("=").append(r) : new StringBuilder(i).append("=").append(n.DB.to_string(r.toString())) } else if (f.getIsParentColumn()) { if (i = f.getColumnName().toLowerCase(), r = t[i], r == null) { this.log.log(o.INFO, "FK data is null - " + i); continue } u == null ? u = new StringBuilder : u.append(" AND "); i.toUpperCase().endsWith("_ID") ? u.append(i).append("=").append(r) : u.append(i).append("=").append(n.DB.to_string(r.toString())) } return e != null ? e.toString() : u != null ? u.toString() : (this.log.log(o.WARNING, "No key Found"), null) }; u.prototype.getIsOpen = function () { return this.isOpen }; u.prototype.getTableID = function () { return this.gTable._AD_Table_ID }; u.prototype.getDataTable = function () { return this.bufferList }; u.prototype.getSortModel = function () { return this.mSortList }; u.prototype.getRow = function (n) { return this.mSortList[n] }; u.prototype.getRowCount = function () { return this.mSortList ? this.mSortList.length : this.bufferList ? this.bufferList.length : 0 }; u.prototype.getTotalRowCount = function () { return this.rowCount }; u.prototype.getValueAt = function (n, t) { var i = this.getRow(n); return i && t in i ? i[t] : null }; u.prototype.checkMaxMin = function () { for (var i, o = new StringBuilder, e = this.gridFields.length, r = "", u = "", f = 0; f < e; f++)if (i = this.gridFields[f], n.DisplayType.IsNumeric(i.getDisplayType())) if (r = i.getMaxValue(), u = i.getMinValue(), t.isNumeric(r) && t.isNumeric(u)) { if (Number(i.getValue()) > Number(i.getMaxValue()) || Number(i.getValue()) < Number(i.getMinValue())) return n.ADialog.error("ValidationError", !0, ": " + n.Msg.getMsg("VIS_ValueOf") + " " + i.getHeader() + " " + n.Msg.getMsg("VIS_MustBetween") + " " + i.getMinValue() + " " + n.Msg.getMsg("VIS_And") + " " + i.getMaxValue()), !1 } else if (t.isNumeric(r)) { if (Number(i.getValue()) > Number(r)) return n.ADialog.error("ValidationError", !0, ": " + n.Msg.getMsg("VIS_ValueOf") + " " + i.getHeader() + " " + n.Msg.getMsg("VIS_Lessthan") + " " + r), !1 } else if (t.isNumeric(u) && Number(i.getValue()) < Number(u)) return n.ADialog.error("ValidationError", !0, ": " + n.Msg.getMsg("VIS_ValueOf") + " " + i.getHeader() + " " + n.Msg.getMsg("VIS_Greaterthan") + " " + u), !1; return !0 }; u.prototype.getMandatory = function (n) { for (var t, u, i = new StringBuilder, e = this.gridFields.length, f = !1, r = 0; r < e; r++)t = this.gridFields[r], t.getIsMandatory(!0) && (u = t.getColumnName().toLowerCase(), (n[u] == null || n[u].toString().length == 0) && (t.setInserting(!0), t.setError(!0), i.length() > 0 && i.append(", "), i.append(t.getHeader()), f || (this.lastFocus = t.propertyChangeListner.getControl(), f = !0))); return i.length() == 0 ? "" : i.toString() }; u.prototype.getLastFocus = function () { return this.lastFocus }; u.prototype.setLastFocus = function (n) { this.lastFocus = n }; u.prototype.getErrorColumns = function () { for (var i, n = new StringBuilder, r = this.gridFields.length, t = 0; t < r; t++)i = this.gridFields[t], i.getIsError() && (n.length() > 0 && n.append(", "), n.append(i.getHeader())); return n.length() == 0 ? "" : n.toString() }; u.prototype.getClientOrg = function (n) { var u = -1, t, i, r; return this.gTable._indexClientColumn != -1 && (t = this.getValueAt(n, "ad_client_id"), t != null && (u = t)), i = 0, this.gTable._indexOrgColumn != -1 && (r = this.getValueAt(n, "ad_org_id"), r != null && (i = r)), [u, i] }; u.prototype.getKeyID = function (n) { if (this.gTable._indexKeyColumn != -1) try { var t = this.getValueAt(n, this.keyColumnName.toLowerCase()); return t == null || isNaN(t) ? -1 : t } catch (i) { return -1 } return -1 }; u.prototype.getDummyRecordID = function (n) { try { var t = this.getValueAt(n, this._tableName + "_ID"); return t == null || isNaN(t) ? -1 : t } catch (i) { return -1 } return -1 }; u.prototype.setKeyColumnName = function (n) { this.keyColumnName = n }; u.prototype.setTableName = function (n) { this.isOpen || n != null && n.length != 0 && (this.gTable._tableName = n) }; u.prototype.setReadOnly = function (n) { this.readOnly = n }; u.prototype.setDeleteable = function (n) { this.gTable._deleteable = n }; u.prototype.setOrderClause = function (n) { this.gTable._orderClause = n; this.gTable._orderClause == null && (this.gTable._orderClause = "") }; u.prototype.setSelectWhereClause = function (n) { return this.isOpen ? !1 : (this.gTable._whereClause = n, this.gTable._whereClause == null && (this.gTable._whereClause = ""), !0) }; u.prototype.setDoPaging = function (n) { this.dopaging = n }; u.prototype.setCurrentPage = function (n) { this.currentPage = n }; u.prototype.setCurrentPageRelative = function (n) { var t = this.currentPage; isNaN(n) ? t = Math.ceil(this.rowCount / this.pazeSize) : n !== 0 ? t += n : t = 1; this.currentPage = t }; u.prototype.setSortModel = function (n) { this.mSortList = null; this.mSortList = n }; u.prototype.setCardID = function (n) { this.card_ID = n }; u.prototype.resetCard = function () { this.cardTempalte = null; this.setCardID(0) }; u.prototype.setValueAt = function (n, i, r, u) { var f, e, o, s; !this.isOpen || i < 0 || r < 0 || this.rowCount == 0 || (f = this.getField(r), e = this.getValueAt(i, f.getColumnName().toLowerCase()), u || (e != null || n != null) && e !== n) && (o = this.getRow(i), this.rowChanged = i, this.rowData == null && (this.rowData = {}, t.extend(this.rowData, o)), f.setValue(n, this.inserting), o[f.getColumnName().toLowerCase()] = n, this.disableNotification || (s = this.createDSE(), s.setChangedColumn(r, f.getColumnName()), this.fireDataStatusChanged(s))) }; u.prototype.setDisableNotification = function (n) { this.disableNotification = n }; u.prototype.needSave = function (n, t) { var i = n, r = t; return (arguments.length == 0 ? (i = this.rowChanged, r = !1) : arguments.length == 1 ? (i = arguments[0], r = !1) : (i = arguments[0], r = arguments[1]), typeof this.changed == "undefined" || !this.changed && (this.rowChanged == -1 || typeof this.rowChanged == "undefined")) ? !1 : this.changed && (typeof this.rowChanged == "undefined" || this.rowChanged == -1) && r ? !1 : i == this.rowChanged ? !1 : !0 }; u.prototype.findColumn = function (n) { for (var r, i = this.gridFields, t = 0; t < i.length; t++)if (r = i[t], n.equals(r.getColumnName(), !0)) return t; return -1 }; u.prototype.createSelectSql = function () { var t = this.gTable, u, s, i, r, f; if (this.columns = [], this.gridFields.length == 0 || t._tableName == null || t._tableName.equals("")) return ""; var e = new StringBuilder("SELECT "), o = null, h = null; for (u = 0; u < this.gridFields.length; u++)u > 0 && e.append(", "), s = this.gridFields[u], this.columns.push(s.getColumnName()); return h = null, e.append(" FROM ").append(t._tableName), this.SQL_Select = e.toString(), this.SQL_Count = "SELECT COUNT(*) FROM " + t._tableName, i = new StringBuilder(""), r = t._whereClause, r.length > 0 && (i.append(" WHERE "), r.indexOf("@") == -1 ? i.append(r) : (f = n.Env.parseContext(this.ctx, t._windowNo, r, !1), (!f || f.length == 0) && r.length > 0 ? i.append("11=12") : i.append(f)), r.toUpperCase().indexOf("=NULL") > 0 && this.log.Severe("Invalid NULL - " + _tableName + "=" + r)), this.whereClause = i, this.SQL = this.SQL_Select + i.toString(), this.SQL_Count += i.toString(), t._withAccessControl && (this.SQL = n.MRole.addAccessSQL(this.SQL, t._tableName, n.MRole.SQL_FULLYQUALIFIED, n.MRole.SQL_RO), this.SQL_Count = "SELECT COUNT(*) FROM " + t._tableName + this.SQL.substring(this.SQL_Select.length)), this.SQL_Direct = o != null ? o.toString() + " " + this.SQL_Count.substring(this.SQL_Count.indexOf(" COUNT(*) FROM") + 9) : "", t._orderClause.equals("") || (this.SQL += " ORDER BY " + t._orderClause, this.SQL_Direct += " ORDER BY " + t._orderClause), this.SQL }; u.prototype.open = function (i) { var u, r; if (this.maxRows = i, this.isOpen) return this.dataRefreshAll(), !0; if (this.createSelectSql(), this.SQL == null || this.SQL.equals("") || !this.columns || this.columns.length == 0) return !1; this.rowCount = 0; u = 0; this.rowCount = u; this.bufferList.length = 0; r = this; this.pazeSize = Number(n.Env.getWINDOW_PAGE_SIZE()); var f = this.createGridFieldArr(this.gridFields, !0), e = { page: this.dopaging ? this.currentPage : 0, pageSize: this.dopaging ? this.pazeSize : 0, treeID: this.treeID, treeNode_ID: this.treeNode_ID, card_ID: this.card_ID, ad_Tab_ID: this.AD_Tab_ID, tableName: this.gTable._tableName }, o = this.createObsecureFields(this.gridFields); return t.ajax({ url: c + "Window/GetWindowRecords", type: "post", data: { ctx: n.context.getWindowCtx(r.gTable._windowNo), Columns: this.columns, TableName: this.gTable._tableName, WhereClause: n.secureEngine.encrypt(this.whereClause), ObscureFields: o, sqlIn: e, AD_Window_ID: r.gridFields[0].getAD_Window_ID(), WindowNo: r.gTable._windowNo, AD_Tab_ID: r.AD_Tab_ID, SummaryOnly: r.ShowSummaryNodes, Encryptedfields: f, AD_Table_ID: r.AD_Table_ID, MaxRows: r.maxRows, DoPaging: r.dopaging }, success: function (n) { var t = JSON.parse(n); t.RecordCount > 0 ? (r.rowCount = t.RecordCount, r.isOpen = !0, (!r.dopaging || r.pazeSize > r.rowCount) && (r.pazeSize = r.rowCount), r.changed = !1, r.rowChanged = -1, r.fillData(t)) : (r.bufferList != null && (r.bufferList.length = 0), r.mSortList != null && (r.mSortList = null), r.currentPage = 1, r.isOpen = !0, r.changed = !1, r.rowChanged = -1, window.setTimeout(function () { r.fireQueryCompleted(!0) }, 300, r)) }, error: function () { } }), !0 }; u.prototype.fillData = function (t) { var i = null, r = this, a, c, l, h, f, e, s, u; if (this.treeNode_ID > 0) { try { if (i = (new n.DB.DataSet).toJson(t.Tables), i != null) { if (l = 0, i.getTables().length != 0) for (h = i.getTable(0).getRows(), f = i.getTable(0).getColumnsName(), e = 0; e < h.length; e++) { for (s = h[e].getJSCells(), u = 0; u < f.length; u++)s[f[u]] = r.readDataOfColumn(f[u], s[f[u]]); r.bufferList[e] = s; l++ } i.dispose(); i = null } } catch (v) { this.log.Log(o.SEVERE, r.SQL, v) } r.fireQueryCompleted(!0); r = null } else { try { if (a = null, c = null, t && (i = (new n.DB.DataSet).toJson(t.Tables), a = t.LookupDirect, c = t.CardViewTpl), i != null) { if (l = 0, i.getTables().length != 0) { for (h = i.getTable(0).getRows(), f = i.getTable(0).getColumnsName(), e = 0; e < h.length; e++) { for (s = h[e].getJSCells(), u = 0; u < f.length; u++)s[f[u]] = r.readDataOfColumn(f[u], s[f[u]]); r.bufferList[e] = s; l++ } console.log(i.getTable(0).lookupDirect) } i.dispose(); i = null } a && n.MLookupCache.addRecordLookup(r.gTable._windowNo, r.gTable._tabNo, a); r.cardTempalte = c; dataIn.card_ID > 0 && c && c.DisableWindowPageSize && (r.pazeSize = r.rowCount, r.currentPage = 1) } catch (v) { } r.fireQueryCompleted(!0); r = null } }; u.prototype.getCardTemplate = function () { return this.cardTempalte }; u.prototype.readDataOfColumn = function (t, i) { var u, f, r, o, e; if (i == null) return i; try { if (u = this.getField(t), u == null) return i; f = u.getColumnName(); r = u.getDisplayType(); n.DisplayType.IsID(r) && (f.endsWith("_ID") || f.endsWith("_Acct")) || f.endsWith("atedBy") || f.endsWith("_ID_1") || f.endsWith("_ID_2") || f.endsWith("_ID_3") || r == n.DisplayType.Integer ? i = n.Utility.Util.getValueOfInt(i) : n.DisplayType.IsNumeric(r) ? i = n.Utility.Util.getValueOfDecimal(i) : n.DisplayType.IsDate(r) ? dte = null : r == n.DisplayType.RowID ? i = null : r == n.DisplayType.YesNo ? (o = i.toString(), u.getIsEncryptedColumn() && (o = this.decrypt(o)), i = o.equals("Y")) : n.DisplayType.IsLOB(r) ? (e = i, e == null && (i = null), i = typeof e == typeof string ? e.toString() : e) : i = i.toString(); u.getIsEncryptedColumn() && r != n.DisplayType.YesNo && (i = this.decrypt(i)); u.getObscureType() && r != n.DisplayType.YesNo && (i = this.decrypt(i)) } catch (s) { console.log(s) } return i }; u.prototype.encrypt = function (t) { return t == null || t.length < 1 ? t : n.secureEngine.encrypt(t) }; u.prototype.decrypt = function (t) { return t == null || t.length < 1 ? t : n.secureEngine.isEncrypted(t) ? n.secureEngine.decrypt(t) : t }; u.prototype.dataSave = function (n, t) { return arguments.length == 2 ? !this.changed && (typeof this.rowChanged == "undefined" || this.rowChanged == -1) ? !0 : n == this.rowChanged ? !0 : this.dataSaveL(t) == u.prototype.SAVE_OK : this.dataSaveL(t) }; u.prototype.dataSaveL = function (i) { var o, c, w, b, v, p, u, e, f, tt, r; if (!this.isOpen) return this.log.warning("Error - Open=" + this.isOpen), this.SAVE_ERROR; if (this.rowChanged == -1 && (this.log.config("NoNeed - Changed=" + this.changed + ", Row=" + this.rowChanged), !i)) return this.SAVE_OK; if (this.rowData == null) return this.log.fine("No Changes"), this.SAVE_ERROR; if (this.readOnly) return log.warning("IsReadOnly - ignored"), this.dataIgnore(), this.SAVE_ACCESS; if (this.rowChanged == -1) if (this.newRow != -1) this.rowChanged = this.newRow; else return this.fireDataStatusEEvent("SaveErrorNoChange", "", !1), this.SAVE_ERROR; var k = this.getClientOrg(this.rowChanged), d = k[0], g = k[1]; if (!n.MRole.canUpdate(d, g, this.AD_Table_ID, 0, !0)) return this.fireDataStatusEEvent("AccessTableNoUpdate", "", !0), this.dataIgnore(), this.SAVE_ACCESS; for (o = this.getRow(this.rowChanged), u = 0; u < this.gridFields.length; u++)if (c = this.gridFields[u], n.DisplayType.IsString(c.getDisplayType()) && c.value != null && c.value.toString().trim().length > 0 && !new RegExp(c.getVFormat()).test(c.value)) return this.fireDataStatusEEvent("RegexFailed", (c.getHeader() == "" ? c.getColumnName() : c.getHeader()) + "\n", !0), c.propertyChangeListner.ctrl.focus(), this.SAVE_ERROR; if (w = this.getMandatory(o), w.length != 0) return this.fireDataStatusEEvent("FillMandatory", w + "\n", !0), this.SAVE_MANDATORY; if (this.checkMaxMin()) { if (b = this.getErrorColumns(), b.length != 0) return this.fireDataStatusEEvent("Error", b + "\n", !0), this.SAVE_ERROR; v = 0; this.inserting || (v = this.getKeyID(this.rowChanged)); var nt = [], y = this.gridFields, it = y.length; nt = this.createGridFieldArr(y); var a = this.createGridFieldArr(y, !0), s = this.createObsecureFields(y), l = {}, h = {}; if (t.extend(!0, l, o), t.extend(!0, h, this.rowData), a && a.length > 0) for (p = a.length, u = 0; u < p; u++)l[a[u]] && (l[a[u]] = this.encrypt(l[a[u]])), h[a[u]] && (h[a[u]] = this.encrypt(h[a[u]])); if (s && s.length > 0) for (p = s.length, u = 0; u < p; u++)(l[s[u]] || l[s[u]] == 0) && (l[s[u]] = this.encrypt(l[s[u]])), (h[s[u]] || h[s[u]] == 0) && (h[s[u]] = this.encrypt(h[s[u]])); if (e = { Record_ID: v, AD_Table_ID: this.AD_Table_ID, TableName: this.gTable._tableName, Inserting: this.inserting, CompareDB: this.compareDB, RowData: l, OldRowData: h, ManualCmd: i, WhereClause: this.getWhereClause(o), Fields: nt, AD_Client_ID: d, AD_Org_ID: g, Columns: this.columns, AD_WIndow_ID: y[0].getAD_Window_ID(), MaintainVersions: !1, UnqFields: this.gFieldUnique, Ctx: n.context.getWindowCtx(this.gTable._windowNo), WindowNo: this.gTable._windowNo }, this.selectedTreeNode > 0 && (e.SelectedTreeNodeID = this.selectedTreeNode, this.isSummaryyNode && (e.TreeID = this.treeID, e.ParentNodeID = this.selectedTreeNode)), this.treeNode_ID > 0 && (e.ParentNodeID = this.treeNode_ID, e.TreeID = this.treeID, e.TreeTableID = this.treeTable_ID), this.onlyCurrentDays == 0 && (this.IsMaintainVersions || this.maintainVersionFieldChanged(l, h))) { if (f = this, h.updatedby == null) { if (this.IsHideVerNewRecord) e.MaintainVersions = !0, e.ImmediateSave = !0, e.ValidFrom = (new Date).toISOString(); else if (!this.MaintainVerOnApproval || this.MaintainVerOnApproval && n.context.getWindowContext(this.gTable._windowNo, n.Env.approveCol) == "Y") { e.MaintainVersions = !0; e.ImmediateSave = !0; e.ValidFrom = (new Date).toISOString(); f.showVersions(f, v, e, o, !0); return } return r = f.dataSaveDB(e, o), r.Status == "E" ? r.FireEEvent || r.FireIEvent || n.ADialog.info(r.ErrorMsg) : r.VersionResult && (r.RowData = e.RowData, r.VersionResult.KeyColName != "" && (o[r.VersionResult.KeyColName.toLower()] = r.VersionResult.Record_ID, o.isactive = r.VersionResult.IsActive), f.fireTableModelChanged(n.VTable.prototype.ROW_REFRESH, o, f.rowChanged), f.fireRowChanged(!0, f.getKeyID(f.rowChanged)), f.rowData = null, f.changed = !1, f.compareDB = !0, f.rowChanged = -1, f.newRow = -1, f.inserting = !1, r.ErrorMsg != null && f.log.log(n.Logging.Level.SEVERE, r.ErrorMsg), r.FireEEvent ? f.fireDataStatusEEvent(r.EventParam.Msg, r.EventParam.Info, r.EventParam.IsError, r.IsWarning) : r.FireIEvent && f.fireDataStatusIEvent(r.EventParam.Msg, r.EventParam.Info, r.EventParam.IsError), r.Status == "W" && n.ADialog.info("SentForApproval")), r.Status } if (this.MaintainVerOnApproval && n.context.getWindowContext(this.gTable._windowNo, n.Env.approveCol) != "Y") return r = this.dataSaveDB(e, o), r.Status; tt = n.dataContext.getJSONData(n.Application.contextUrl + "JsonData/CheckVersions", { RowData: e }); tt.result ? n.ADialog.confirm("FoundVersions", !0, "", "Confirm", function (n) { n && f.showVersions(f, v, e, o, !1) }) : f.showVersions(f, v, e, o, !1) } else return r = this.dataSaveDB(e, o), r.Status } }; u.prototype.showVersions = function (t, i, r, u, f) { var e = new n.MasterDataVersion(t.gTable._tableName, t.gridFields, i, r.WhereClause, t.IsMaintainVersions, f, function (i, f, e) { r.MaintainVersions = !0; r.ImmediateSave = i; r.ValidFrom = f; r.VerRecID = e; var s = t.rowChanged, o = t.dataSaveDB(r, u); return o.Status != "O" && (o.Status == "E" ? o.FireEEvent || o.FireIEvent || n.ADialog.info(o.ErrorMsg) : o.VersionResult && (t.rowChanged = s, o.RowData = r.RowData, o.VersionResult.KeyColName != "" && (u[o.VersionResult.KeyColName.toLower()] = o.VersionResult.Record_ID, u.isactive = o.VersionResult.IsActive), t.fireTableModelChanged(n.VTable.prototype.ROW_REFRESH, u, t.rowChanged), t.fireRowChanged(!0, t.getKeyID(t.rowChanged)), t.rowData = null, t.changed = !1, t.compareDB = !0, t.rowChanged = -1, t.newRow = -1, t.inserting = !1, o.ErrorMsg != null && t.log.log(n.Logging.Level.SEVERE, o.ErrorMsg), o.FireEEvent ? t.fireDataStatusEEvent(o.EventParam.Msg, o.EventParam.Info, o.EventParam.IsError, o.IsWarning) : o.FireIEvent && (o.EventParam.Info = "VER", t.fireDataStatusIEvent(o.EventParam.Msg, o.EventParam.Info, o.EventParam.IsError)), o.Status == "W" ? n.ADialog.info("SentForApproval") : o.Status == "F" ? n.ADialog.info("SavedForFuture") : o.Status == "B" && n.ADialog.info("SavedForBackDate"))), o.Status }); e.show() }; u.prototype.dataSaveDB = function (i, r) { var u = n.dataContext.insertOrUpdateWRecord(i); return u = JSON.parse(u), u.IsError || (u.RowData && t.extend(!0, r, this.readDataOfObject(u.RowData)), this.fireTableModelChanged(n.VTable.prototype.ROW_REFRESH, r, this.rowChanged), this.fireRowChanged(!0, this.getKeyID(this.rowChanged)), this.rowData = null, this.changed = !1, this.compareDB = !0, this.rowChanged = -1, this.newRow = -1, this.inserting = !1), u.ErrorMsg != null && this.log.log(n.Logging.Level.SEVERE, u.ErrorMsg), u.FireEEvent ? this.fireDataStatusEEvent(u.EventParam.Msg, u.EventParam.Info, u.EventParam.IsError, u.IsWarning) : u.FireIEvent && this.fireDataStatusIEvent(u.EventParam.Msg, u.EventParam.Info, u.EventParam.IsError), u }; u.prototype.createGridFieldArr = function (n, t) { var u = n.length, f, r, i; if (t) { if (this.gFieldLessData) return this.gFieldLessData; for (this.gFieldLessData = [], r = 0; r < u; r++)i = n[r], f = i.getColumnName().toLowerCase(), i.getIsEncryptedColumn() && this.gFieldLessData.push(f); return this.gFieldLessData } if (this.gFieldData) return this.gFieldData; for (this.gFieldData = [], this.gFieldUnique = [], r = 0; r < u; r++)i = n[r], this.gFieldData.push({ IsVirtualColumn: i.getIsVirtualColumn(), DisplayType: i.getDisplayType(), ColumnName: i.getColumnName(), IsKey: i.getIsKey(), ColumnSQL: i.getColumnSQL(!0), IsEncryptedColumn: i.getIsEncryptedColumn(), IsParentColumn: i.getIsParentColumn(), Name: i.getHeader(), IsUnique: i.getIsUnique(), IsObscure: i.getObscureType() ? !0 : !1 }), i.getIsUnique() && !i.getIsVirtualColumn() && i.getIsDisplayed() && this.gFieldUnique.push(i.getColumnName()); return this.gFieldData }; u.prototype.createObsecureFields = function (n) { var r = n.length, t, i; if (this.gFieldObscureList) return this.gFieldObscureList; for (this.gFieldObscureList = [], t = 0; t < r; t++)i = n[t], i.getObscureType() && this.gFieldObscureList.push(i.getColumnName().toLowerCase()); return this.gFieldObscureList }; u.prototype.dataRefreshAll = function () { this.inserting = !1; this.dataIgnore(); this.close(!1); this.open(this.maxRows); this.dseEvent = "Refreshed" }; u.prototype.dataRequery = function (n) { return this.close(!1), this.setSelectWhereClause(n), this.rowData = null, this.changed = !1, this.rowChanged = -1, this.inserting = !1, this.open(this.maxRows), this.dseEvent = "Refreshed", !0 }; u.prototype.dataRefresh = function (i) { var e, u, f, r; if (i < 0 || this.getRowCount() == 0 || this.inserting) return null; e = this.getRow(i); this.dataIgnore(); u = this.getWhereClause(e); (u == null || u.length == 0) && (u = "1=2"); f = null; r = null; try { t.ajax({ url: c + "Window/GetWindowRecord", async: !1, type: "post", data: { ctxp: n.context.getWindowCtx(this.gTable._windowNo), Columns: this.columns, TableName: this.gTable._tableName, AD_Window_ID: this.gridFields[0].getAD_Window_ID(), AD_Tab_ID: this.AD_Tab_ID, WindowNo: this.gTable._windowNo, WhereClause: n.secureEngine.encrypt(u), Encryptedfields: this.createGridFieldArr(this.gridFields, !0), ObscureFields: this.createObsecureFields(this.gridFields) }, success: function (t) { r = (new n.DB.DataReader).toJson(t) }, error: function () { } }); r.read() && (f = this.readData(r)); f.recid = e.recid } catch (s) { return console.log(s), sql = n.secureEngine.decrypt(sql), this.log.log(o.SEVERE, sql, s), this.fireDataStatusEEvent("RefreshError", sql, !0), null } finally { r != null && r.dispose() } return this.rowData = null, this.changed = !1, this.rowChanged = -1, this.inserting = !1, this.fireTableModelChanged(n.VTable.prototype.ROW_REFRESH, f), this.fireDataStatusIEvent("Refreshed", ""), f }; u.prototype.getRowFromDB = function (i, r) { var s, e; if (i < 0 || this.getRowCount() == 0 || this.inserting) return null; s = this.getRow(i); e = this.getWhereClause(s); (e == null || e.length == 0) && (e = "1=2"); var f = null, u = null, a = r ? !0 : !1, h = null; r && (h = this); try { t.ajax({ url: c + "Window/GetWindowRecord", async: a, type: "post", data: { ctxp: n.context.getWindowCtx(this.gTable._windowNo), Columns: this.columns, TableName: this.gTable._tableName, AD_Window_ID: this.gridFields[0].getAD_Window_ID(), AD_Tab_ID: this.AD_Tab_ID, WindowNo: this.gTable._windowNo, WhereClause: n.secureEngine.encrypt(e), Encryptedfields: this.createGridFieldArr(this.gridFields, !0), ObscureFields: this.createObsecureFields(this.gridFields) }, success: function (t) { u = (new n.DB.DataReader).toJson(t); r && (u.read() && (f = h.readData(u)), f.recid = s.recid, r(f)) }, error: function () { } }); r || (u.read() && (f = this.readData(u)), f.recid = s.recid) } catch (l) { return console.log(l), sql = n.secureEngine.decrypt(sql), this.log.log(o.SEVERE, sql, l), null } finally { u != null && u.dispose() } return f }; u.prototype.dataNew = function (t, i) { var c, s, e, a, h, o, u, f; if (this.log.info("Current=" + t + ", Copy=" + i), this.readOnly) return this.fireDataStatusEEvent("AccessCannotInsert", "", !0), !1; if (this.inserting = !0, c = this.gridFields.length, this.rowData = {}, s = {}, e = this.gTable._windowNo + n.EnvConstants.WINDOW_TEMP, i) for (a = this.getRow(t), o = 0; o < c; o++) { var u = this.gridFields[o], r = u.getColumnName(), l = r.toLowerCase(); u.getIsVirtualColumn() || (u.getIsKey() || r.equals("AD_Client_ID") || r.equals("IsActive") || r.startsWith("Created") || r.startsWith("Updated") || r.equals("EntityType") || r.equals("DocumentNo") || r.equals("Processed") || r.equals("IsSelfService") || r.equals("DocAction") || r.equals("DocStatus") || r.startsWith("Ref_") || r.equals("Posted") || r.equals("GrandTotal") || r.equals("TotalLines") || r.equals("C_CashLine_ID") || r.equals("C_Payment_ID") || r.equals("IsPaid") || r.equals("IsAllocated") || r.equalsIgnoreCase("C_Location_ID") || r.equals("IsApproved") || r.equals("IsDelivered") || r.equals("IsInvoiced") || r.equals("TotalDr") || r.equals("TotalCr") || r.equalsIgnoreCase("I_IsImported") ? (f = u.getDefault(this.ctx, e), s[l] = f, f != null && this.ctx.setWindowContext(e, u.getColumnName(), f.toString())) : u.getIsCopy() ? (h = a[r.toLowerCase()], s[l] = h, h != null && this.ctx.setWindowContext(e, u.getColumnName(), h.toString())) : (f = u.getDefault(this.ctx, e), s[l] = f, f != null && this.ctx.setWindowContext(e, u.getColumnName(), f.toString()))) } else for (o = 0; o < c; o++)u = this.gridFields[o], f = u.getDefault(this.ctx, e), s[u.getColumnName().toLowerCase()] = f, f != null && this.ctx.setWindowContext(e, u.getColumnName(), f.toString()); return this.ctx.removeWindow(e), this.changed = !0, this.compareDB = !0, this.newRow = t + 1, this.getRowCount() < this.newRow && (this.newRow = this.getRowCount()), this.rowChanged = this.newRow, this.rowCount++, s.recid = this.rowCount, this.pazeSize++, this.fireTableModelChanged(n.VTable.prototype.ROW_ADD, s, this.newRow, null), this.log.fine("Current=" + this.currentRow + ", New=" + this.newRow + " - complete"), !0 }; u.prototype.dataDelete = function (t, i) { var f, l, r, s, w; if (!t || t.length < 0) return !1; if (this.readOnly) return this.fireDataStatusEEvent("AccessCannotDelete", "", !0), !1; if (!this.deleteable) return this.fireDataStatusEEvent("AccessNotDeleteable", "", !0), !1; var h = this.gTable._indexKeyColumn != -1, y = this.gTable._indexProcessedColumn > 0 && !this.gTable._tableName.startsWith("I_"), e = [], c = [], a = [], v = [], p = this.AD_Table_ID, u = null; for (f = 0; f < t.length; f++) { if (u = this.mSortList[t[f]], y && (l = this.getValueAt(t[f], "processed"), l != null && l)) { e.push(u.recid); continue } c.push(u.recid); h ? a.push(u[this.keyColumnName.toLowerCase()]) : v.push(this.getWhereClause(u)) } if (r = null, c.length > 0) s = { RecIds: c, HasKeyColumn: h, TableName: this.gTable._tableName, AD_Table_ID: p }, h ? s.SingleKeyWhere = a : s.MultiKeyWhere = v, r = n.dataContext.deleteWRecords(s), r = JSON.parse(r); else if (e.length > 0) return this.fireDataStatusEEvent("CannotDeleteTrx", "", !0), !1; if (r) { if (w = null, selIndexOrId = r.UnDeletedRecIds && r.UnDeletedRecIds.length > 0 ? r.UnDeletedRecIds : e.length > 0 ? e : i, r.DeletedRecIds && r.DeletedRecIds.length > 0 && (this.rowCount -= r.DeletedRecIds.length, this.fireTableModelChanged(n.VTable.prototype.ROW_DELETE, r.DeletedRecIds, selIndexOrId), r.RecIds && r.RecIds.length > 0 && this.fireRowChanged(!1, r.RecIds)), r.ErrorMsg && this.log.log(o.SEVERE, r.ErrorMsg), r.InfoMsg && this.log.log(o.Info, r.InfoMsg), r.IsError) return r.FireEEvent && this.fireDataStatusEEvent(r.EventParam.Msg, r.EventParam.Info, r.EventParam.IsError), !1; this.changed = !1; this.rowChanged = -1; this.fireDataStatusIEvent("Deleted", "") } return !0 }; u.prototype.dataDeleteAsync = function (t, i) { var r = this; return new Promise(function (u) { var e, a, p, h; if (!t || t.length < 0) { u(!1); return } if (r.readOnly) { r.fireDataStatusEEvent("AccessCannotDelete", "", !0); u(!1); return } if (!r.deleteable) { r.fireDataStatusEEvent("AccessNotDeleteable", "", !0); u(!1); return } var c = r.gTable._indexKeyColumn != -1, w = r.gTable._indexProcessedColumn > 0 && !r.gTable._tableName.startsWith("I_"), s = [], l = [], v = [], y = [], b = r.AD_Table_ID, f = null; for (e = 0; e < t.length; e++) { if (f = r.mSortList[t[e]], w && (a = r.getValueAt(t[e], "processed"), a != null && a)) { s.push(f.recid); continue } l.push(f.recid); c ? v.push(f[r.keyColumnName.toLowerCase()]) : y.push(r.getWhereClause(f)) } if (p = null, l.length > 0) h = { RecIds: l, HasKeyColumn: c, TableName: r.gTable._tableName, AD_Table_ID: b }, c ? h.SingleKeyWhere = v : h.MultiKeyWhere = y, p = n.dataContext.deleteWRecords(h).then(function (t) { if (t = JSON.parse(t), t) { if (selIndexOrId = t.UnDeletedRecIds && t.UnDeletedRecIds.length > 0 ? t.UnDeletedRecIds : s.length > 0 ? s : i, t.DeletedRecIds && t.DeletedRecIds.length > 0 && (r.rowCount -= t.DeletedRecIds.length, r.fireTableModelChanged(n.VTable.prototype.ROW_DELETE, t.DeletedRecIds, selIndexOrId), t.RecIds && t.RecIds.length > 0 && r.fireRowChanged(!1, t.RecIds)), t.ErrorMsg && r.log.log(o.SEVERE, t.ErrorMsg), t.InfoMsg && r.log.log(o.Info, t.InfoMsg), t.IsError) { t.FireEEvent && r.fireDataStatusEEvent(t.EventParam.Msg, t.EventParam.Info, t.EventParam.IsError); u(!1); return } r.changed = !1; r.rowChanged = -1; r.fireDataStatusIEvent("Deleted", ""); u(!0); return } }); else if (s.length > 0) { r.fireDataStatusEEvent("CannotDeleteTrx", "", !0); u(!1); return } }) }; u.prototype.readData = function (n) { var r = {}, u = this.gridFields.length, t = null, i; try { for (i = 0; i < u; i++)t = this.gridFields[i].getColumnName().toLowerCase(), r[t] = this.readDataOfColumn(t, n.getCell(t)), t = null; return r } catch (f) { throw f; } }; u.prototype.readDataOfObject = function (t) { var f = {}, e = this.gridFields.length, r = null, i = [], u; try { for (u = 0; u < e; u++)r = this.gridFields[u].getColumnName().toLowerCase(), f[r] = this.readDataOfColumn(r, t[r]), this.gridFields[u].getDisplayType() == n.DisplayType.Image && i.push("imgurlcolumn" + r), r = null; if (i && i.length > 0) for (k = 0; k < i.length; k++)f[i[k]] = this.readDataOfColumn(i[k], t[i[k]]); return f } catch (o) { throw o; } }; u.prototype.close = function (n) { this.isOpen && (n, !this.inserting, this.bufferList != null && (this.bufferList.length = 0, this.bufferList = null, this.bufferList = [], this.mSortList = null), this.mSortList != null && (this.mSortList = null), n && this.dispose(), this.isOpen = !1) }; u.prototype.dataIgnore = function (i) { if (this.inserting || this.changed || !(this.rowChanged < 0)) { if (this.inserting) this.rowCount--, this.pazeSize--, this.changed = !1, this.rowChanged = -1, this.inserting = !1, this.fireTableModelChanged(n.VTable.prototype.ROW_UNDO, this.mSortList[this.newRow].recid, this.newRow); else if (this.rowData != null) { var r = this.getRow(this.rowChanged); t.extend(r, this.rowData) } return this.changed = !1, this.rowChanged = -1, this.rowData = null, this.inserting = !1, this.newRow = -1, i || this.fireDataStatusIEvent("Ignored", ""), !0 } }; u.prototype.createDSE = function () { var t = this.changed, n; return this.rowChanged != -1 && (t = !0), n = new e(null, this.getRowCount(), t, !1, this.inserting), n.setPageInfo(this.currentPage, this.rowCount, this.pazeSize), n.AD_Table_ID = this.gTable._AD_Table_ID, n.Record_ID = null, n }; u.prototype.fireDataStatusChanged = function (n) { this.mDataListener && this.mDataListener.dataStatusChanged(n); n = null }; u.prototype.fireTableModelChanged = function (n, t, i, r) { this.mCardModelListener && this.mCardModelListener.tableModelChanged(n, t, i, r); this.mTableModelListener && this.mTableModelListener.tableModelChanged(n, t, i, r) }; u.prototype.fireRowChanged = function (n, t) { this.mRowChangedListener && this.mRowChangedListener.rowChanged(n, t) }; u.prototype.fireDataStatusIEvent = function (n, t) { var i = this.createDSE(); i.setInfo(n, t, !1, !1); this.fireDataStatusChanged(i) }; u.prototype.fireQueryCompleted = function (n) { this.mQueryCompletedListener && this.mQueryCompletedListener.queryCompleted(n); n = null }; u.prototype.fireDataStatusEEvent = function (n, t, i, r) { if (arguments.length === 1) this.fireDataStatusEEvent(arguments[0].value, arguments[0].name, !0, !1); else { var u = this.createDSE(); r ? i = !r : r = !i; u.setInfo(n, t, i, r); this.fireDataStatusChanged(u) } }; u.prototype.addDataStatusListener = function (n) { this.mDataListener = n }; u.prototype.removeDataStatusListener = function () { this.mDataListener = null }; u.prototype.addQueryCompleteListner = function (n) { this.mQueryCompletedListener = n }; u.prototype.removeQueryCompleteListner = function () { this.mQueryCompletedListener = null }; u.prototype.addTableModelListener = function (n) { this.mTableModelListener = n }; u.prototype.removeTableModelListener = function (n) { this.mTableModelListener = null; n = null }; u.prototype.addCardModelListener = function (n) { this.mCardModelListener = n }; u.prototype.removeCardModelListener = function (n) { this.mCardModelListener = null; n = null }; u.prototype.addRowChangedListener = function (n) { this.mRowChangedListener = n }; u.prototype.removeRowChangedListener = function (n) { this.mRowChangedListener = null; n = null }; u.prototype.updateTableModel = function (t) { var i = t.getColumnName(), r = t.getDisplayType(); r == n.DisplayType.Integer || n.DisplayType.IsID(r) && (i.endsWith("_ID") || i.endsWith("_Acct") || i.endsWith("_ID_1") || i.endsWith("_ID_2") || i.endsWith("_ID_3")) || i.endsWith("atedBy") ? this.defaultModel[i.toLowerCase()] = new Number : n.DisplayType.IsNumeric(r) ? this.defaultModel[i.toLowerCase()] = new Number : n.DisplayType.IsDate(r) ? this.defaultModel[i.toLowerCase()] = new Date : r == n.DisplayType.RowID ? (dc = new DataColumn(i, typeof Object), this.defaultModel[i.toLowerCase()] = {}) : this.defaultModel[i.toLowerCase()] = r == n.DisplayType.YesNo ? new Boolean : n.DisplayType.IsLOB(r) ? new String : new String }; u.prototype.dispose = function () { var n, t; for (originalLength = this.gridFields.length, t = originalLength; t > 0; t--)n = this.gridFields.pop(), n.dispose(), n = null; this.gridFields.length = 0; this.gTable = null; this.gridFields = null; this.gFieldLessData = null; this.gFieldData = null; this.gFieldUnique = null }; u.prototype.maintainVersionFieldChanged = function (n, t) { var i, r; if (this.gridFields && this.gridFields.length > 0) for (i = 0; i < this.gridFields.length; i++)if (this.gridFields[i].vo.IsMaintainVersions && (r = this.gridFields[i].vo.ColumnName.toLowerCase(), n[r] != t[r])) return !0; return !1 }; r.prototype.PROPERTY = "FieldValue"; r.prototype.INSERTING = "FieldValueInserting"; r.prototype.setGridTab = function (n) { this.gridTab = n }; r.prototype.getIsInserting = function () { return this.inserting }; r.prototype.getIsDisplayed = function (t) { var u; if (arguments.length == 0) return this.vo.IsDisplayedf; if (!this.vo.IsDisplayedf) return !1; if (this.vo.DisplayLogic == null || this.vo.DisplayLogic.equals("")) return !0; if (t) { for (var i = !1, r = [], f = [], e = new n.StringTokenizer(this.vo.DisplayLogic, "[]"); e.hasMoreTokens();)u = e.nextToken(), u.trim() != " & ".trim() ? (i = n.Evaluator.evaluateLogic(this, u), r.push(i)) : f.push(u); return r.length > 1 && (f[0].trim().equals("&") ? i = r.indexOf(!1) > -1 ? !1 : !0 : f[0].trim().equals("|") && r.indexOf(!0) > -1 && (i = !0)), i } return !0 }; r.prototype.getIsDisplayedMR = function (t) { var u; if (arguments.length == 0) return this.vo.IsDisplayedMR; if (!this.vo.IsDisplayedMR) return !1; if (this.vo.DisplayLogic == null || this.vo.DisplayLogic.equals("")) return !0; if (t) { for (var i = !1, r = [], f = [], e = new n.StringTokenizer(this.vo.DisplayLogic, "[]"); e.hasMoreTokens();)u = e.nextToken(), u.trim() != " & ".trim() ? (i = n.Evaluator.evaluateLogic(this, u), r.push(i)) : f.push(u); return r.length > 1 && (f[0].trim().equals("&") ? i = r.indexOf(!1) > -1 ? !1 : !0 : f[0].trim().equals("|") && r.indexOf(!0) > -1 && (i = !0)), i } return !0 }; r.prototype.getColumnName = function () { return this.vo.ColumnName }; r.prototype.getIsLongField = function () { return this.vo.DisplayLength >= 30 }; r.prototype.getFieldColSpan = function () { return this.vo.DisplayLength <= 9 ? 1 : this.vo.DisplayLength <= 19 ? 2 : this.vo.DisplayLength <= 29 ? 3 : 4 }; r.prototype.getIsMandatory = function (t) { var r, i; return t && this.vo.mandatoryLogic != null && this.vo.mandatoryLogic.length > 0 && (r = n.Evaluator.evaluateLogic(this, this.vo.mandatoryLogic), r) ? !0 : !this.vo.IsMandatoryUI || this.getIsVirtualColumn() ? !1 : (i = this.vo, i.IsKey && i.ColumnName.endsWith("_ID") || i.ColumnName.startsWith("Created") || i.ColumnName.startsWith("Updated") || i.ColumnName.equals("M_AttributeSetInstance_ID")) ? !1 : this.getIsDisplayed(t) }; r.prototype.getDisplayType = function () { return this.vo.displayType }; r.prototype.getOrginalDisplayType = function () { return this.vo.orginalDispaly }; r.prototype.getIsVirtualColumn = function () { return this.vo.ColumnSQL && this.vo.ColumnSQL.length > 0 ? !0 : !1 }; r.prototype.getIsReadOnly = function () { return this.getIsVirtualColumn() ? !0 : this.vo.IsReadOnly }; r.prototype.setReadOnly = function (n) { this.vo.IsReadOnly = n }; r.prototype.getIsEditable = function (t, i) { var r = this.vo, o, u, h, f, s, c; if (this.getIsVirtualColumn()) return !1; if (r.ColumnName.equals("Posted") || r.ColumnName.equals("Record_ID") && (r.displayType == n.DisplayType.Button || this.getOrginalDisplayType() == n.DisplayType.Button) || (o = i && !(this.vo.DisplayLogic == null || this.vo.DisplayLogic.equals("")), r.IsAlwaysUpdateable && !r.tabReadOnly && !o)) return !0; if (r.tabReadOnly || r.IsReadOnly || !r.IsUpdateable && !this.inserting || r.ColumnName.equals(n.context.getWindowTabContext(r.windowNo, r.tabNo, "LinkColumnName"))) return !1; if (u = n.context, t) { h = parseInt(u.getTabRecordContext(r.windowNo, r.tabNo, "AD_Client_ID")); r.ColumnName.equals("AD_Org_ID") && (u.getWindowContext(r.windowNo, "AD_Org_ID") == null || u.getWindowContext(r.windowNo, "AD_Org_ID").length == 0) && u.setWindowContext(r.windowNo, "AD_Org_ID", u.getContext("#AD_Org_ID")); var l = parseInt(u.getTabRecordContext(r.windowNo, r.tabNo, "AD_Org_ID")), e = u.getWindowTabContext(r.windowNo, r.tabNo, "KeyColumnName"), a = r.AD_Window_ID; if (("EntityType".equals(e) && (e = "AD_EntityType_ID"), e.toUpperCase().endsWith("_ID") || (e += "_ID"), f = u.getWindowTabContext(r.windowNo, r.tabNo, e), f == "" && this.gridTab && (f = u.getWindowTabContext(r.windowNo, r.tabNo, this.gridTab.getTableName() + "_ID")), f == "" && (f = 0), s = r.AD_Table_ID, !n.MRole.canUpdate(h, l, s, f, !1) || !n.MRole.getWindowAccess(a)) || !n.MRole.getIsColumnAccess(s, this.vo.AD_Column_ID, !1) || this.gridTab && this.gridTab.IsSharedReadOnly) return !1 } return t && r.ReadOnlyLogic.length > 0 && (c = !n.Evaluator.evaluateLogic(this, r.ReadOnlyLogic), !c) ? !1 : r.ColumnName.equals("Processing") || r.ColumnName.equals("DocAction") || r.ColumnName.equals("GenerateTo") ? !0 : t && (u.getWindowContext(r.windowNo, r.tabNo, "Processed").equals("Y") || u.getWindowContext(r.windowNo, r.tabNo, "Processing").equals("Y")) && !o ? !1 : r.ColumnName.equals("IsActive") ? !0 : t && !u.getWindowContext(r.windowNo, r.tabNo, "IsActive").equals("Y") ? !1 : i ? this.getIsDisplayedMR(t) : this.getIsDisplayed(t) }; r.prototype.evaluateLogicsOnly = function () { var t = this.vo, i = !1; return t.ReadOnlyLogic.length > 0 && (i = n.Evaluator.evaluateLogic(this, t.ReadOnlyLogic)), !i && t.DisplayLogic.length > 0 && (i = n.Evaluator.evaluateLogic(this, t.DisplayLogic)), i }; r.prototype.getWindowNo = function () { return this.vo.windowNo }; r.prototype.getIsHeading = function () { return this.vo.IsHeading }; r.prototype.getIsSameLine = function () { return this.vo.IsSameLine }; r.prototype.getHeader = function () { return this.vo.Header }; r.prototype.getDescription = function () { return this.vo.Description }; r.prototype.getHelp = function () { return this.vo.Help }; r.prototype.getAD_Process_ID = function () { return this.vo.AD_Process_ID }; r.prototype.getAD_Form_ID = function () { return this.vo.AD_Form_ID }; r.prototype.getAD_Column_ID = function () { return this.vo.AD_Column_ID }; r.prototype.getAD_Field_ID = function () { return this.vo.AD_Field_ID }; r.prototype.getFieldGroup = function () { return this.vo.FieldGroup }; r.prototype.getIsFieldOnly = function () { return this.vo.IsFieldOnly }; r.prototype.getShowLabel = function () { return !0 }; r.prototype.getIsKey = function () { return this.vo.IsKey }; r.prototype.getIsParentColumn = function () { return this.vo.IsParent }; r.prototype.getSortNo = function () { return this.vo.SortNo }; r.prototype.getMRSeqNo = function () { return this.vo.mrSeqNo }; r.prototype.getIsSelectionColumn = function () { return this.vo.IsSelectionColumn }; r.prototype.getSelectionSeqNo = function () { return this.vo.SelectionSeqNo }; r.prototype.getIsIncludedColumn = function () { return this.vo.IsIncludedColumn }; r.prototype.getDependentOn = function () { var t = [], i = this.getColumnName(); return i.equals("M_AttributeSetInstance_ID") ? t.push("M_Product_ID") : (i.equals("M_Locator_ID") || i.equals("M_LocatorTo_ID")) && (t.push("M_Product_ID"), t.push("M_Warehouse_ID")), n.Evaluator.parseDepends(t, this.vo.DisplayLogic), n.Evaluator.parseDepends(t, this.vo.ReadOnlyLogic), this.lookup != null && n.Evaluator.parseDepends(t, this.lookup.getValidation()), t }; r.prototype.getAD_Window_ID = function () { return this.vo.AD_Window_ID }; r.prototype.getAD_InfoWindow_ID = function () { return this.vo.AD_InfoWindow_ID }; r.prototype.getValueAsString = function (t) { var i = n.context.getWindowContext(this.vo.windowNo, this.vo.tabNo, t, !0); return i ? i.toString() : "" }; r.prototype.getColumnSQL = function (t) { return arguments.length == 0 ? this.vo.ColumnName : this.vo.ColumnSQL != null && this.vo.ColumnSQL.length > 0 ? t ? (this.vo.displayType == n.DisplayType.YesNo, this.vo.ColumnSQL + " AS " + this.vo.ColumnName) : (this.vo.displayType == n.DisplayType.YesNo, this.vo.ColumnSQL) : (this.vo.displayType == n.DisplayType.YesNo, this.vo.ColumnSQL) }; r.prototype.getIsLink = function () { return this.vo.isLink }; r.prototype.getIsRightPaneLink = function () { return this.vo.isRightPaneLink }; r.prototype.getColumnWidth = function () { return this.vo.ColumnWidth }; r.prototype.getIsAlwaysUpdateable = function () { return this.getIsVirtualColumn() || !this.vo.IsUpdateable ? !1 : this.vo.IsAlwaysUpdateable }; r.prototype.getIsEncryptedField = function () { return this.vo.IsEncryptedField }; r.prototype.getIsEncrypted = function () { if (this.vo.IsEncryptedField) return !0; var n = this.getObscureType(); return n != null && n.length > 0 ? !0 : this.vo.ColumnName.equals("Password") }; r.prototype.getObscureType = function () { return this.vo.ObscureType }; r.prototype.getDisplayLength = function () { return this.vo.DisplayLength }; r.prototype.getFieldLength = function () { return this.vo.FieldLength }; r.prototype.getMinValue = function () { return this.vo.ValueMin }; r.prototype.getMaxValue = function () { return this.vo.ValueMax }; r.prototype.getVFormat = function () { return this.vo.VFormat }; r.prototype.getVFormatError = function () { return this.vo.VFormatError }; r.prototype.getLookup = function () { return this.lookup }; r.prototype.getIsError = function () { return this.error }; r.prototype.getIsCopy = function () { return this.vo.IsCopy }; r.prototype.getCallout = function () { return this.vo.Callout }; r.prototype.getValue = function () { return this.value }; r.prototype.getIsIdentifier = function () { return this.vo.IsIdentifier }; r.prototype.getOldValue = function () { return this.oldValue }; r.prototype.getIsRange = function () { return this.vo.isRange }; r.prototype.getIsRange = function () { return this.vo.isRange }; r.prototype.getIsParentValue = function () { var i = n.context, t; return this.parentValue != null ? this.parentValue : (n.DisplayType.IsID(this.vo.displayType) && this.vo.tabNo != 0 ? (t = i.getWindowTabContext(this.vo.windowNo, this.vo.tabNo, "LinkColumnName"), this.parentValue = t.length == 0 ? !1 : this.vo.ColumnName.equals(t), this.parentValue && this.log.config(this.parentValue + " - Link(" + t + ", W=" + this.vo.windowNo + ",T=" + this.vo.tabNo + ") = " + this.vo.ColumnName)) : this.parentValue = !1, this.parentValue) }; r.prototype.getDefault = function (t, i) { var r = this.vo, c, u, s, w, f, l, v, h, g; if (r.IsKey || r.displayType == n.DisplayType.RowID || n.DisplayType.IsLOB(r.displayType)) return null; if (this.getIsParentValue() && n.Utility.Util.isEmpty(r.DefaultValue)) return c = t.getWindowContext(r.windowNo, r.ColumnName), this.gridTab && (c = t.getWindowContext(r.windowNo, this.gridTab.getParentTabNo(), r.ColumnName)), this.log.fine("[Parent] " + r.ColumnName + "=" + c), this.createDefault(r.ColumnName, c); if (r.ColumnName.equals("IsActive")) return this.log.fine("[IsActive] " + r.ColumnName + "=Y"), !0; if (n.Consts.ACCESSLEVEL_SystemOnly.equals(t.getWindowTabContext(r.windowNo, r.tabNo, "AccessLevel")) && (r.ColumnName.equals("AD_Client_ID") || r.ColumnName.equals("AD_Org_ID"))) return this.log.fine("[SystemAccess] " + r.ColumnName + "=0"), 0; if (n.Consts.ACCESSLEVEL_SystemPlusClient.equals(t.getWindowTabContext(r.windowNo, r.tabNo, "AccessLevel")) && r.ColumnName.equals("AD_Org_ID")) return this.log.fine("[ClientAccess] " + r.ColumnName + "=0"), 0; if (u = "", r.DefaultValue.startsWith("@SQL=")) { var y = r.DefaultValue.substring(5), e = n.Env.parseContext(t, r.windowNo, y, !1, !0), p = e.toUpperCase(); if (p.indexOf("DELETE ") != -1 && p.indexOf("UPDATE ") != -1 && p.indexOf("DROP ") != -1 && (e = ""), e.equals("")) this.log.log(o.WARNING, "(" + r.ColumnName + ") - Default SQL variable parse failed: " + y); else { s = null; try { s = a(e); s.read() ? u = s.getString(0) : this.log.log(o.WARNING, "(" + r.ColumnName + ") - no Result: " + e); s.close() } catch (k) { e.endsWith("=") ? this.log.log(o.SEVERE, "(" + r.ColumnName + ") " + y, k) : this.log.log(o.WARNING, "(" + r.ColumnName + ") " + e, k) } finally { s != null && s.dispose() } } if (u != null && u.length > 0) return this.log.fine("[SQL] " + r.ColumnName + "=" + u), this.createDefault("", u) } if (!r.DefaultValue.equals("") && !r.DefaultValue.startsWith("@SQL=")) for (u = "", w = new n.StringTokenizer(r.DefaultValue, ",;", !1); w.hasMoreTokens();) { if (f = w.nextToken().trim(), f.equals("@SysDate@") || f.equals("@Now@")) return l = new Date, l.setMilliseconds(0), l.setSeconds(0), l.toISOString(); if (f.indexOf("@") != -1 ? (u = t.getWindowContext(r.windowNo, f.replaceAll("@", " ").trim()), r.ColumnName != "AD_Org_ID" || n.MRole.getIsOrgAccess(Number(u), !1) || (u = f)) : u = f.startsWith("'") && f.endsWith("'") ? f.length - 2 > 0 ? f.substring(1, f.length - 1) : f.replaceAll("'", "") : f, u.length > 0) return this.log.fine("[DefaultValue] " + r.ColumnName + "=" + u), this.createDefault(f, u) } if (this.lookup != null && !n.Utility.Util.isEmpty(this.lookup.getValidation())) { var nt = this.lookup.getValidation(), d = n.Evaluator.getVariables(nt), b = !1; for (v = 0; v < d.length; v++)if (h = d[v], !h.startsWith("#") && h.toUpperCase().endsWith("_ID") && !h.equals(r.ColumnName) && (g = t.getWindowContext(i, h), b = n.Utility.Util.isEmpty(g), b)) break; if (b) return this.lookup.clear(), null } return (u = n.Env.getPreference(t, r.AD_Window_ID, r.ColumnName, !1), u !== "") ? (this.log.fine("[UserPreference] " + r.ColumnName + "=" + u), this.createDefault("", u)) : (u = n.Env.getPreference(t, r.AD_Window_ID, r.ColumnName, !0), u !== "") ? (this.log.fine("[SystemPreference] " + r.ColumnName + "=" + u), this.createDefault("", u)) : r.displayType == n.DisplayType.Button && !r.ColumnName.toUpperCase().endsWith("_ID") ? (this.log.fine("[Button=N] " + r.ColumnName), "N") : this.vo.displayType == n.DisplayType.YesNo ? (this.log.fine("[YesNo=N] " + r.ColumnName), !1) : r.ColumnName.toUpperCase().endsWith("_ID") ? (this.log.fine("[ID=null] " + r.ColumnName), null) : n.DisplayType.IsNumeric(r.displayType) ? (this.log.fine("[Number=0] " + r.ColumnName), this.createDefault("", "0")) : (this.log.fine("[NONE] " + r.ColumnName), null) }; r.prototype.getDefault2 = function (t, i) { var r = this.vo, l, u, s, p, f, k, d, c, h, nt; if (r.IsKey || r.displayType == n.DisplayType.RowID || n.DisplayType.IsLOB(r.displayType)) return null; if (this.getIsParentValue() && n.Utility.Util.isEmpty(r.DefaultValue2)) return l = t.getWindowContext(r.windowNo, r.ColumnName), this.log.fine("[Parent] " + r.ColumnName + "=" + l), this.createDefault(r.ColumnName, l); if (r.ColumnName.equals("IsActive")) return this.log.fine("[IsActive] " + r.ColumnName + "=Y"), !0; if (n.Consts.ACCESSLEVEL_SystemOnly.equals(t.getWindowTabContext(r.windowNo, r.tabNo, "AccessLevel")) && (r.ColumnName.equals("AD_Client_ID") || r.ColumnName.equals("AD_Org_ID"))) return this.log.fine("[SystemAccess] " + r.ColumnName + "=0"), 0; if (n.Consts.ACCESSLEVEL_SystemPlusClient.equals(t.getWindowTabContext(r.windowNo, r.tabNo, "AccessLevel")) && r.ColumnName.equals("AD_Org_ID")) return this.log.fine("[ClientAccess] " + r.ColumnName + "=0"), 0; if (u = "", r.DefaultValue2.startsWith("@SQL=")) { var v = r.DefaultValue2.substring(5), e = n.Env.parseContext(t, r.windowNo, v, !1, !0), y = e.toUpperCase(); if (y.indexOf("DELETE ") != -1 && y.indexOf("UPDATE ") != -1 && y.indexOf("DROP ") != -1 && (e = ""), e.equals("")) this.log.log(o.WARNING, "(" + r.ColumnName + ") - Default SQL variable parse failed: " + v); else { s = null; try { s = a(e); s.read() ? u = s.getString(0) : this.log.log(o.WARNING, "(" + r.ColumnName + ") - no Result: " + e); s.close() } catch (b) { e.endsWith("=") ? this.log.log(o.SEVERE, "(" + r.ColumnName + ") " + v, b) : this.log.log(o.WARNING, "(" + r.ColumnName + ") " + e, b) } finally { s != null && s.dispose() } } if (u != null && u.length > 0) return this.log.fine("[SQL] " + r.ColumnName + "=" + u), this.createDefault("", u) } if (!r.DefaultValue2.equals("") && !r.DefaultValue2.startsWith("@SQL=")) for (u = "", p = new n.StringTokenizer(r.DefaultValue2, ",;", !1); p.hasMoreTokens();) { if (f = p.nextToken().trim(), f.equals("@SysDate@") || f.equals("@Now@")) return k = new Date, d = k.toISOString(), d; if (u = f.indexOf("@") != -1 ? t.getWindowContext(r.windowNo, f.replaceAll("@", " ").trim()) : f.startsWith("'") && f.endsWith("'") ? f.length - 2 > 0 ? f.substring(1, f.length - 1) : f.replaceAll("'", "") : f, u.length > 0) return this.log.fine("[DefaultValue2] " + r.ColumnName + "=" + u), this.createDefault(f, u) } if (this.lookup != null && !n.Utility.Util.isEmpty(this.lookup.getValidation())) { var tt = this.lookup.getValidation(), g = n.Evaluator.getVariables(tt), w = !1; for (c = 0; c < g.length; c++)if (h = g[c], !h.startsWith("#") && h.toUpperCase().endsWith("_ID") && !h.equals(r.ColumnName) && (nt = t.getWindowContext(i, h), w = n.Utility.Util.isEmpty(nt), w)) break; if (w) return this.lookup.clear(), null } return (u = n.Env.getPreference(t, r.AD_Window_ID, r.ColumnName, !1), u !== "") ? (this.log.fine("[UserPreference] " + r.ColumnName + "=" + u), this.createDefault("", u)) : (u = n.Env.getPreference(t, r.AD_Window_ID, r.ColumnName, !0), u !== "") ? (this.log.fine("[SystemPreference] " + r.ColumnName + "=" + u), this.createDefault("", u)) : r.displayType == n.DisplayType.Button && !r.ColumnName.toUpperCase().endsWith("_ID") ? (this.log.fine("[Button=N] " + r.ColumnName), "N") : this.vo.displayType == n.DisplayType.YesNo ? (this.log.fine("[YesNo=N] " + r.ColumnName), !1) : r.ColumnName.toUpperCase().endsWith("_ID") ? (this.log.fine("[ID=null] " + r.ColumnName), null) : n.DisplayType.IsNumeric(r.displayType) ? (this.log.fine("[Number=0] " + r.ColumnName), this.createDefault("", "0")) : (this.log.fine("[NONE] " + r.ColumnName), null) }; r.prototype.getIsEncryptedColumn = function () { return this.vo.IsEncryptedColumn }; r.prototype.getZoomWindow_ID = function () { return this.vo.ZoomWindow_ID }; r.prototype.getIsDefaultFocus = function () { return this.vo.IsDefaultFocus }; r.prototype.getStyleLogic = function () { return this.vo.StyleLogic || (this.vo.StyleLogic = ""), this.vo.StyleLogic }; r.prototype.createDefault = function (t, i) { var u, f, r, e; if (i == null || i.length == 0) return null; try { if (!this.vo.IsReadOnly && this.vo.ValidationCode != "" && this.vo.ValidationCode.indexOf(i) != -1) return null; if (this.vo.ColumnName.endsWith("atedBy") || this.vo.ColumnName.toUpperCase().endsWith("_ID")) { try { return (u = parseInt(i), u < 0) ? null : u } catch (s) { this.log.warning("Cannot parse: " + i + " - " + s.message) } return 0 } if (this.vo.displayType == n.DisplayType.Integer) return parseInt(i); if (n.DisplayType.IsNumeric(this.vo.displayType)) return parseFloat(i); if (n.DisplayType.IsDate(this.vo.displayType)) { try { return r = null, isNaN(Number(i)) ? r = new Date(i) : (r = new Date, console.log(this.vo.ColumnName + "==>[1n] " + r), r.setMinutes(-r.getTimezoneOffset() + r.getMinutes()), console.log(this.vo.ColumnName + "==>[3n] " + r.toISOString())), r.setMilliseconds(0), r.setSeconds(0), r.toISOString() } catch (c) { } f = i + "2014-01-01T01:00:05Z".substring(i.length); try { new Date(f).toISOString() } catch (l) { this.log.warning("Cannot convert to Timestamp: " + f) } return r = new Date, r.setMilliseconds(0), r.setSeconds(0), r.toISOString() } if (this.vo.displayType == n.DisplayType.YesNo) return "Y".equals(i); if (t.equals("@#Date@")) try { e = new Date(parseInt(i)); i = e.toLocaleDateString() } catch (a) { } return i } catch (h) { this.log.log(o.SEVERE, this.vo.ColumnName + " - " + h.message) } return null }; r.prototype.setValue = function (t, i) { this.inserting || (this.oldValue = this.value); this.value = t; this.inserting = i; this.error = !1; this.updateContext(); var r = this.oldValue; i && (r = this.INSERTING); (r !== t || this.forcefirepropchange) && this.propertyChangeListner && this.propertyChangeListner.setValue(t, i); this.forcefirepropchange = this.inserting || this.vo.displayType == n.DisplayType.YesNo }; r.prototype.setCardViewSeqNo = function (n) { this.cardViewSeq = n }; r.prototype.getCardViewSeqNo = function () { return this.cardViewSeq }; r.prototype.setCardFieldStyle = function (n) { this.cardFieldStyle = n }; r.prototype.getCardFieldStyle = function () { return this.cardFieldStyle }; r.prototype.setCardIconHide = function (n) { this.cardHideIcon = n }; r.prototype.isCardIconHide = function () { return this.cardHideIcon }; r.prototype.setCardTextHide = function (n) { this.cardTextHide = n }; r.prototype.isCardTextHide = function () { return this.cardTextHide }; r.prototype.updateContext = function () { var t = this.vo, u = n.DisplayType, r = n.context, i = this.value, f; t.displayType == u.Text || t.displayType == u.Memo || t.displayType == u.TextLong || t.displayType == u.Binary || t.displayType == u.RowID || this.getIsEncrypted() || (i == "undefined" || i == null ? this.getIsParentTabField() ? this.gridTab && r.setTabRecordContext(t.windowNo, t.tabNo, t.ColumnName, null) : r.setWindowContext(t.windowNo, t.ColumnName, null) : typeof i == typeof Boolean || t.displayType == u.YesNo ? (f = i.toString().toLowerCase() == "true" || i.toString() == "Y" ? "Y" : "N", this.getIsParentTabField() ? this.gridTab && r.setTabRecordContext(t.windowNo, t.tabNo, t.ColumnName, f) : r.setWindowContext(t.windowNo, t.ColumnName, f)) : typeof i == typeof date || u.IsDate(t.displayType) ? this.getIsParentTabField() ? this.gridTab && r.setTabRecordContext(t.windowNo, t.tabNo, t.ColumnName, i) : r.setWindowContext(t.windowNo, t.ColumnName, i) : this.getIsParentTabField() ? this.gridTab && r.setTabRecordContext(t.windowNo, t.tabNo, t.ColumnName, i.toString()) : r.setWindowContext(t.windowNo, t.ColumnName, i == null ? null : i.toString())) }; r.prototype.getIsParentTabField = function (n) { if (!this.gridTab) return !1; n || (n = this.vo.ColumnName); var t = this.gridTab.getParentTab(); return t == null ? !1 : t.getField(n) != null }; r.prototype.setNullValue = function () { this.valueNoFire && (this.oldValue = this.value); this.value = null; this.inserting = !1; this.error = !1; this.oldValue !== this.value && this.propertyChangeListner && this.propertyChangeListner.setValue(this.value) }; r.prototype.setPropertyChangeListener = function (n) { this.propertyChangeListner = n }; r.prototype.setError = function (n) { this.error = n }; r.prototype.setInserting = function (n) { this.inserting = n }; r.prototype.getAD_Reference_Value_ID = function () { return this.vo.AD_Reference_Value_ID }; r.prototype.setDisplayType = function (n) { this.vo.displayType = n }; r.prototype.setDisplayLength = function (n) { this.vo.DisplayLength = n }; r.prototype.setDisplayed = function (n) { this.vo.IsDisplayedf = n }; r.prototype.setValueNoFire = function (n) { this.valueNoFire = n }; r.prototype.getLoadRecursiveData = function () { return this.vo.LoadRecursiveData }; r.prototype.getShowChildOfSelected = function () { return this.vo.ShowChildOfSelected }; r.prototype.getIsBackgroundProcess = function () { return this.vo.IsBackgroundProcess }; r.prototype.getAskUserBGProcess = function () { return this.vo.AskUserBGProcess }; r.prototype.getIsHeaderPanelitem = function () { return this.vo.IsHeaderPanelitem }; r.prototype.getHeaderOverrideReference = function () { return this.vo.HeaderOverrideReference }; r.prototype.getHeaderStyle = function () { return this.vo.HeaderStyle }; r.prototype.getHeaderHeadingOnly = function () { return this.vo.HeaderHeadingOnly }; r.prototype.getHeaderSeqno = function () { return this.vo.HeaderSeqno }; r.prototype.getHeaderIconOnly = function () { return this.vo.HeaderIconOnly }; r.prototype.getHtmlStyle = function () { return this.vo.HtmlStyle }; r.prototype.getGridImageStyle = function () { return this.vo.GridImageStyle }; r.prototype.getShowIcon = function () { return this.vo.ShowIcon }; r.prototype.getAD_Image_ID = function () { return this.vo.AD_Image_ID }; r.prototype.getFontClass = function () { return this.vo.FontClass }; r.prototype.getPlaceHolder = function () { return this.vo.PlaceHolder }; r.prototype.getImageName = function () { return this.vo.ImageName }; r.prototype.getCellSpace = function () { return this.vo.CellSpace }; r.prototype.getFieldBreadth = function () { return this.vo.FieldBreadth }; r.prototype.getIsLineBreak = function () { return this.vo.LineBreak }; r.prototype.getIsFieldgroupDefault = function () { return this.vo.FieldGroupDefault }; r.prototype.getShowFilterOption = function () { return this.vo.ShowFilterOption }; r.prototype.getIsUnique = function () { return this.vo.IsUnique }; r.prototype.getIsSwitch = function () { return this.vo.IsSwitch }; r.prototype.getIsAction = function () { return this.vo.IsAction }; r.prototype.getTabSeqNo = function () { return this.vo.TabSeqNo }; r.prototype.getAction = function () { return this.vo.ADAction }; r.prototype.getActionName = function () { return this.vo.ADActionName }; r.prototype.refreshLookup = function () { return !this.lookup || this.lookup.getValidation().length == 0 ? !0 : (this.lookup.refresh(), this.lookup.getIsValidated()) }; r.prototype.dispose = function () { this.lookup != null && (this.lookup.dispose(), this.lookup = null); this.gfield = null; this.vo = null; this.propertyChangeListner = null }; h.prototype.getName = function () { return this.vo.Name }; h.prototype.getAD_Tab_ID = function () { return this.vo.AD_Tab_ID }; h.prototype.getIconPath = function () { return this.vo.IconPath }; h.prototype.getIsDefault = function () { return this.vo.IsDefault }; h.prototype.getClassName = function () { return this.vo.Classname }; h.prototype.getAD_TabPanel_ID = function () { return this.vo.AD_TabPanel_ID }; h.prototype.getSeqNo = function () { return this.vo.SeqNo }; h.prototype.getExtraInfo = function () { return this.vo.ExtraInfo }; e.prototype.getRecord_ID = function () { return this.Record_ID }; e.prototype.setLoading = function (n) { this.m_allLoaded = !1; this.m_loadedRows = n }; e.prototype.getIsLoading = function () { return !this.m_allLoaded }; e.prototype.getLoadedRows = function () { return this.m_loadedRows }; e.prototype.setCurrentRow = function (n) { this.m_currentRow = n }; e.prototype.setCurrentPage = function (n) { this.mCurrentPage = n }; e.prototype.getCurrentRow = function () { return this.m_currentRow }; e.prototype.getTotalRows = function () { return this.m_totalRows }; e.prototype.getTotalRecords = function () { return this.totalRecords }; e.prototype.getCurrentPage = function () { return this.mCurrentPage }; e.prototype.getTotalPage = function () { return this.mTotalPage }; e.prototype.getPageSize = function () { return this.mPageSize }; e.prototype.setInfo = function (n, t, i, r) { this.m_AD_Message = n; this.m_info = t; this.m_isError = i; this.m_isWarning = r }; e.prototype.setPageInfo = function (n, t, i) { this.mCurrentPage = n; this.mPageSize = i; t < 1 || t < i ? (this.mcurrentPage = 1, this.mTotalPage = 1) : this.mTotalPage = i == 0 ? 1 : Math.ceil(t / i); this.totalRecords = t }; e.prototype.setInserting = function (n) { this.m_inserting = n }; e.prototype.getIsInserting = function () { return this.m_inserting }; e.prototype.getAD_Message = function () { return this.m_AD_Message }; e.prototype.getInfo = function () { return this.m_info }; e.prototype.getIsError = function () { return this.m_isError }; e.prototype.getIsWarning = function () { return this.m_isWarning }; e.prototype.getMessage = function () { var n = new StringBuilder; return this.m_inserting && n.append("+"), n.append(this.m_changed ? this.m_autoSave ? "*" : "?" : " "), this.m_totalRows == 0 ? n.append(this.m_currentRow) : n.append(this.m_currentRow + 1), n.append("/"), this.m_allLoaded ? n.append(this.m_totalRows) : n.append(this.m_loadedRows).append("->").append(this.m_totalRows), n.toString() }; e.prototype.getIsChanged = function () { return this.m_changed }; e.prototype.getIsFirstRow = function () { return this.m_totalRows == 0 ? !0 : this.m_currentRow == 0 }; e.prototype.getIsLastRow = function () { return this.m_totalRows == 0 ? !0 : this.m_currentRow == this.m_totalRows - 1 }; e.prototype.getIsFirstPage = function () { return this.mTotalPage < 2 ? !0 : this.mCurrentPage < 2 }; e.prototype.getIsLastPage = function () { return this.mTotalPage < 2 ? !0 : this.mCurrentPage >= this.mTotalPage }; e.prototype.setChangedColumn = function (n, t) { this.m_changedColumn = n; this.m_columnName = t }; e.prototype.getChangedColumn = function () { return this.m_changedColumn }; e.prototype.getColumnName = function () { return this.m_columnName }; e.prototype.setConfirmed = function (n) { this.m_confirmed = n }; e.prototype.getIsConfirmed = function () { return this.m_confirmed }; n.GridWindow = f; n.GridTab = i; n.GridTable = u; n.GridField = r }(VIS, jQuery), function (n, t) { function i(i) { function e() { r = t("<div class='vis-height-full vis-app-aform-root' >"); u = t('<div class="vis-busyindicatorouterwrap"><div class="vis-busyindicatorinnerwrap"><i class="vis-busyindicatordiv"><\/i><\/div><\/div>'); f = t("<div class='vis-height-full'>"); r.append(f).append(u) } this.$parent; this.mPanel; this.ctx = n.Env.getCtx(); this.log = n.Logging.VLogger.getVLogger("VIS.AForm"); var r, u, f; e(); this.setSize = function (n) { r.height(n); f.height(n) }; this.setSize(i); this.getRoot = function () { return r }; this.getContentGrid = function () { return f }; this.setBusy = function (n, t) { isLocked = n; n ? u[0].style.visibility = "visible" : (u[0].style.visibility = "hidden", t) }; this.disposeComponent = function () { r.remove(); r = null; f.remove(); f = null; u.remove(); u = null; this.$parentWindow = null; this.ctx = null; this.getRoot = null; this.getContentGrid = null; this.setBusy = null; this.setSize = null } } i.prototype.openForm = function (t, i, r, u) { var f, o, e; if (t.IsReport) return n.ADialog.info("Form Report is not supported"), !1; this.parent = i; f = ""; f = t.Prefix + t.ClassName; console.log(f); this.log.info("Form Name= " + t.Name + ", Class=" + f); this.ctx.setWindowContext(r, "WindowName", t.DisplayName); try { o = n.Utility.getFunctionByName(f, window); e = new o(r); e.init(r, this, u); this.mPanel = e; e = null } catch (s) { return this.log.log(n.Logging.Level.WARNING, "Class=" + f + ", AD_Form Name=" + t.Name, s), !1 } return this.setBusy(!1), this.windowNo = r, this.setTitle(n.Env.getHeader(this.ctx, r)), this.parent.setName(t.DisplayName), i = null, !0 }; i.prototype.setTitle = function (t) { this.parent && this.parent.setTitle(n.Utility.Util.cleanMnemonic(t)) }; i.prototype.hideHeader = function (n) { this.parent && this.parent.hideHeader(n) }; i.prototype.hideCloseIcon = function (n) { this.parent && this.parent.hideCloseIcon(n) }; i.prototype.sizeChanged = function (n, t) { this.setSize(n); this.mPanel && this.mPanel.sizeChanged && this.mPanel.sizeChanged(n, t) }; i.prototype.refresh = function () { this.mPanel && this.mPanel.refresh && this.mPanel.refresh() }; i.prototype.dispose = function () { this.disposed || (this.disposed = !0, this.mPanel && (this.mPanel.disposeComponent && this.mPanel.dispose(), this.mPanel = null), this.parent && (this.parent.dispose(), this.parent = null), n.Env.clearWinContext(this.ctx, this.windowNo), this.disposeComponent()) }; n.AForm = i }(VIS, jQuery), function (n, t) { function i(i, r, u, f) { function nt() { var i, u; g = t("<div style='position:relative;width:100%'>"); s = t('<div class="vis-busyindicatorouterwrap"><div class="vis-busyindicatorinnerwrap"><i class="vis-busyindicatordiv"><\/i><\/div><\/div>'); p = t("<table  class='vis-process-table'>"); h = t("<button class='vis-button-ok' tabindex=0>").text(n.Msg.getMsg("OK")); a = t("<button class='vis-button-close'>").text(n.Msg.getMsg("Close")); s.css("top", "0px"); h.hide(); a.hide(); p.height(r); s.height(r); c = t("<div>"); g.append(p).append(s); v.append(s); l = t('<select style="display:none;width:100%">'); y = t('<label  class="vis-ec-col-lblchkbox" style="display: none;"><input type="checkbox">' + n.Msg.translate(n.context, "IsBackgroundProcess") + "<\/label>"); b = t(y.find("input")[0]); o = t("<span class='vis-process-description-Span' style='height: 40px;'>").val("asassasasasasaasa"); c.append(o); k = t('<div class="input-group vis-input-wrap">'); i = t('<div class="vis-control-wrap">'); w = t('<label style="display:none;">' + n.Msg.getMsg("ChooseReportType") + "<\/label>"); u = t('<div style="display:inherit"><\/div>'); e.parameterFixedArea.append(k); k.append(i); i.append(y).append(l).append(w); c.append(u); c.append(h).append(a); e.$divDesc.append(c) } var e = null, v, d, g, s, c, p, h, a, o, l, w, b, y, k; this.parent; this.mPanel; this.ctx = n.Env.getCtx(); this.isLocked = !1; this.log = n.Logging.VLogger.getVLogger("VIS.AProcess"); this.isComplete = !1; this.jpObj = null; this.splitUI = u; this.extrnalForm = f; this.partitionContainer = null; this.parameterContainer = null; this.reportContainer = null; this.reportToolbar = null; this.isReport = !1; this.calculateWidth = !0; this.hideclose = !1; this.showParameterClose = !0; this.cssForAll = null; this.visRepformatIcons = null; this.visSaveCsvIcons = null; this.visSavePdfIcons = null; this.visArchiveIcons = null; this.visRequeryIcons = null; this.visCustomizeIcons = null; this.visPrintIcons = null; this.toolbarColor = null; v = null; d = t('<i class="fa fa-bars vis-apanel-lb-img" title="Actions"><\/i>'); this.splitUI && (this.partitionContainer = t('<div class="vis-process-outer-wrap">'), this.parameterContainer = t('<div class="vis-process-left-sidebar vis-leftsidebarouterwrap">'), this.reportAreaContainer = t('<div class="vis-process-main-wrap">'), this.reportToolbar = t('<div class="vis-process-toolbar vis-processtoolpadd">'), this.parameterFixedArea = t('<div class="vis-process-parm-top">'), this.parameterContainer.append(t('<div class="vis-apanel-lb-toggle"><\/div>').append(d)).append(this.parameterFixedArea), v = t('<div class="vis-process-outer-main-wrap">'), this.$divDesc = t('<div class="vis-process-description">'), this.reportContainer = t('<div class="vis-process-result">'), this.reportAreaContainer.append(this.reportToolbar).append(this.$divDesc).append(this.reportContainer), v.append(this.parameterContainer).append(this.reportAreaContainer), this.partitionContainer.append(v), this.showParameterClose = !1); e = this; this.loadFileTypes = function () { var i = this; t.ajax({ url: n.Application.contextUrl + "JsonData/GetReportFileTypes/", dataType: "json", data: { AD_Process_ID: e.jpObj.AD_Process_ID }, success: function (r) { var u, f, e; if (r != null) { if (u = jQuery.parseJSON(r), u.length == 0) { i.showReportTypes(!1); return } for (l.append("<option value='S'>" + n.Msg.getMsg("Select") + "<\/option>"), f = 0; f < u.length; f++)e = t("<option value=" + u[f].Key + ">" + u[f].Name + "<\/li>"), l.append(e), e = null } } }) }; nt(); this.setSize = function (n) { s.height(n); this.setMsg && this.setMsg("") }; this.setSize(r); this.isBackground = function () { return b.is(":checked") }; this.getRoot = function () { return g }; this.getContentGrid = function () { return c }; this.setBusy = function (n) { isLocked = n; n ? (s[0].style.visibility = "visible", s.css("display", "")) : (s[0].style.visibility = "hidden", s.css("display", "none")) }; this.setMsg = function (n) { var r = o.find("b"), u, i, f, s; if (o.text().length > 0 && n && n.length > 0 ? (u = t("<span>" + n + "<\/span>"), this.reportContainer.removeClass("vis-process-result"), this.reportContainer.addClass("vis-process-detail-result"), this.reportContainer.empty(), this.reportContainer.append(u)) : o.append(n), i = "", this.isReport && (!r || r.length <= 0) && (i = t('<strong class="vis-process-papapa vis-procss-more"    style="position: fixed;right: 29px;top:96px"><i class="glyphicon glyphicon-chevron-down"><\/i><\/strong>'), o.append(i)), f = t(o.find("p")[0]), i = o.find(".vis-process-papapa"), this.isReport && (s = f.width(), s + 45 > o.width() ? i.show() : i.hide()), this.isReport && (!r || r.length <= 0)) i.on("click", function () { var t = e.reportAreaContainer.height(), n = i.find("i"); n.hasClass("glyphicon-chevron-up") ? (n.addClass("glyphicon-chevron-down"), n.removeClass("glyphicon-chevron-up"), o.css({ height: "40px" })) : (n.addClass("glyphicon-chevron-up"), n.removeClass("glyphicon-chevron-down"), o.css({ height: "" })); e.reportContainer.height(t - (e.$divDesc.height() + 20)) }); this.setMsgHeight(this.isReport) }; this.setMsgHeight = function (n) { n ? (o.css("height", "40px"), o.css("max-height", "")) : (o.css("height", ""), e.parent && o.css("max-height", e.parent.getContentGrid().height() - 100 + "px")); this.reportContainer.height(this.reportAreaContainer.height() - (this.$divDesc.height() + 20)); this.reportAreaContainer.width(this.partitionContainer.width() - this.parameterContainer.width()) }; this.setParameterHeights = function (n) { var i = this, r = t(i.partitionContainer.find(".vis-process-outer-main-wrap")[0]), u, f; n && (i.partitionContainer.height(n), r.height(n)); u = r.height(); f = t(i.partitionContainer.find(".vis-pro-para-root")[0]); f.height(u - 114 + "px") }; this.getParametersContainer = function () { return this.parameterContainer }; this.getReportAreaContainer = function () { return this.reportContainer }; this.getContentTable = function () { return p }; this.getBusyIndicator = function () { return s }; this.getToolbar = function () { return this.reportToolbar }; this.additemtoToolbar = function () { var n = t('<div class="vis-ad-w-p-t-close vis-ad-process-close"><i class="vis vis-cross"><\/i><\/div>'); e.reportToolbar.append(n).append(t('<div class="vis-ad-w-p-t-name vis-ad-process-header"><h5>' + e.parent.getName() + "<\/h5><\/div >")); n.on("click", function () { e.parent.dispose() }) }; this.showCloseIcon = function (n) { this.hideclose = n ? !1 : !0 }; this.showOkIcon = function (n) { n ? (this.parameterContainer.append(t('<div style="overflow:auto;padding:0 10px">').append(h)), h.removeClass(""), h.addClass("vis-process-ok-btn VIS_Pref_btn-2"), h.show(), window.setTimeout(function () { h.focus() }, 100)) : h.hide() }; this.showParameterCloseIcon = function (n) { this.showParameterClose = n ? !0 : !1 }; this.getShowParameterCloseIcon = function () { return this.showParameterClose }; this.setCssForToolbarIcons = function (n) { this.cssForAll = n }; this.setReportFormatIcons = function (n) { this.visRepformatIcons = n }; this.setSaveCsvIcons = function (n) { this.visSaveCsvIcons = n }; this.setSavePdfIcons = function (n) { this.visSavePdfIcons = n }; this.setArchiveIcons = function (n) { this.visArchiveIcons = n }; this.setRequeryIcons = function (n) { this.visRequeryIcons = n }; this.setCustomizeIcons = function (n) { this.visCustomizeIcons = n }; this.setPrintIcons = function (n) { this.visPrintIcons = n }; this.setToolbarColor = function (n) { this.toolbarColor = n }; this.getFileType = function () { return l.val() }; this.reportBytes = null; this.reportPath = null; this.showReportTypes = function (n) { n ? (l.css("display", "block"), w.css("display", "block")) : (l.css("display", "none"), w.css("display", "none")) }; this.showBackgroundProcess = function (n) { n ? (e.parameterFixedArea.addClass("vis-process-pram-checkbox-text"), y.css("display", "flex")) : (e.parameterFixedArea.removeClass("vis-process-pram-checkbox-text"), y.css("display", "none")) }; this.enableBackgroundSetting = function (n) { b.prop("checked"); n || k.hide() }; this.archiveDocument = function (i, r) { i.setBusy(!0); t.ajax({ url: n.Application.contextUrl + "JsonData/ArchiveDoc/", dataType: "json", type: "post", data: { AD_Process_ID: r.pi.getAD_Process_ID(), Name: r.pi.getTitle(), AD_Table_ID: r.pi.getTable_ID(), Record_ID: r.pi.getRecord_ID(), C_BPartner_ID: 0, isReport: !0, binaryData: e.reportBytes, reportPath: e.reportPath }, success: function () { n.ADialog.info("Archived", !0, "", ""); i.setBusy(!1) } }) }; h.on("click", function () { e.onclickTrigger(e) }); this.onclickTrigger = function (t) { var i, r, u; if (t.isComplete) { t.dispose(); return } i = null; i = new n.ProcessInfo(t.jpObj.Name, t.jpObj.AD_Process_ID, 0, 0); i.setAD_User_ID(t.ctx.getAD_User_ID()); i.setAD_Client_ID(t.ctx.getAD_Client_ID()); i.setUseCrystalReportViewer(n.context.getIsUseCrystalReportViewer()); i.setIsBackground(b.is(":checked")); i.setIsReport(t.isReport); i.setActionOrigin(t.ActionOrigin); r = n.context.getWindowContext(t.windowNo, "WindowName"); r || (r = "Menu"); i.setOriginName(r); u = new n.ProcessCtl(t, i, null); i.setFileType(l.val()); t.windowNo ? u.process(t.windowNo) : u.process(n.Env.getWindowNo()); u = null }; a.on("click", function () { e.parent.dispose() }); d.on("click", function (n) { n.stopPropagation(); n.preventDefault(); e.parameterContainer.width() > 40 ? (e.parameterContainer.css("flex-basis", "40px"), e.parameterFixedArea.hide(), e.getParametersContainer().find(".vis-pro-para-root").hide(), e.getParametersContainer().find(".vis-process-ok-btn").hide()) : (e.parameterContainer.css("flex-basis", "280px"), e.parameterFixedArea.show(), e.getParametersContainer().find(".vis-pro-para-root").show(), e.getParametersContainer().find(".vis-process-ok-btn").show()) }); this.disposeComponent = function () { h && h.off("click"); a && a.off("click"); c && c.remove(); c = null; this.reportContainer && this.reportContainer.remove(); this.parameterContainer && this.parameterContainer.remove(); this.reportToolbar && this.reportToolbar.remove(); this.partitionContainer && this.partitionContainer.remove(); s && s.remove(); s = null; h = a = o = null; this.$parentWindow = null; this.isComplete = !1; this.jpObj = null; e = null } } function e(n, i, r) { var u = null; return t.ajax({ url: o, type: "POST", datatype: "json", contentType: "application/json; charset=utf-8", async: i, data: JSON.stringify(n) }).done(function (n) { u = n; r && r(n) }), u } var r = n.Application.contextUrl, u = r + "JsonData/ExecuteNonQuer", f = function (n, i, r) { var e = r ? !0 : !1, f = null, o = { sql: n.join("/"), param: i }; return t.ajax({ url: u + "yWithCode", type: "POST", datatype: "json", contentType: "application/json; charset=utf-8", async: e, data: JSON.stringify(o) }).done(function (n) { f = n; r && r(n) }), f }; i.prototype.init = function (t, i, r) { if (t.Name == null || t.Name == "") return n.ADialog.info("Process Name is empty"), fasle; if (this.ctx.setWindowContext(r, "IsSOTrx", t.IsSOTrx), i.getContentGrid().append(this.getRoot()), this.isReport = t.IsReport, this.setMsg(t.MessageText), this.setBusy(!1), this.parent = i, this.jpObj = t, this.additemtoToolbar(), t.IsReport ? (this.showReportTypes(!0), this.loadFileTypes(), t.IsCrystal && n.context.getIsUseCrystalReportViewer() && this.parameterFixedArea.hide()) : (this.showBackgroundProcess(!0), this.enableBackgroundSetting(t.IsBackground)), this.setMsgHeight(t.IsReport), t.HasPara || this.showOkIcon(!0), this.splitUI && t.HasPara) this.onclickTrigger(this); return this.splitUI && (this.parent.getContentGrid().empty(), this.parent.getContentGrid().append(this.partitionContainer)), this.windowNo = r, !0 }; i.prototype.setActionOrigin = function (n) { this.ActionOrigin = n }; i.prototype.setTitle = function (t) { this.parent && this.parent.setTitle(n.Utility.Util.cleanMnemonic(t)) }; i.prototype.lockUI = function () { this.isLocked = !0; this.setBusy(!0) }; i.prototype.unlockUI = function (t) { t.logs && t.logs.length > 0 && (t.logs = null); n.ProcessInfoUtil.setLogFromDB(t); var i = ""; t && t.getSummary() ? i = "<p style='float: left;width: 100%;'><font color=\"" + (t.getIsError() ? "#FF0000" : "#0000FF") + '">** ' + t.getSummary() + "<\/font><\/p>" : this.jpObj.IsReport || (i = "<p style='float: left;width: 100%;'><font color=\"" + (t.getIsError() ? "#FF0000" : "#0000FF") + '">** <\/font><\/p>'); i += t.customHTML && t.customHTML != "" ? t.customHTML : t.getLogInfo(!0); this.setMsg(i); this.setBusy(!1); t.setSummary(""); this.isLocked = !1 }; i.prototype.getIsUILocked = function () { return this.isLocked }; i.prototype.dispose = function () { this.disposed || (this.disposed = !0, this.mPanel && (this.mPanel.dispose(), this.mPanel = null), this.parent && (this.parent.dispose(), this.parent = null), n.Env.clearWinContext(this.ctx, this.windowNo), this.disposeComponent()) }; var r = n.Application.contextUrl, o = r + "JsonData/JDataSetWithCode", u = r + "JsonData/ExecuteNonQuer", s = function (t, i, r) { var o = r ? !0 : !1, f = { sql: t, page: 1, pageSize: 0 }, u; return i && (f.param = i), u = null, e(f, o, function (t) { u = (new n.DB.DataReader).toJson(t); r && r(u) }), u }, h = function (t, i, r) { var f = r ? !0 : !1, o = { sql: t, page: 1, pageSize: 0 }, u = null; return e(o, f, function (t) { i = (new n.DB.DataSet).toJson(t); var i = (new n.DB.DataSet).toJson(t); u = i.getTable(0).getRows().length > 0 ? i.getTable(0).getRow(0).getCell(0) : null; i.dispose(); i = null; f && r(u) }), u }, f = function (n, i, r) { var e = r ? !0 : !1, f = null, o = { sql: n, param: i }; return t.ajax({ url: u + "iesWithCode", type: "POST", datatype: "json", contentType: "application/json; charset=utf-8", async: e, data: JSON.stringify(data) }).done(function (n) { f = n; r && r(n) }), f }; i.prototype.createUI = function (i, r, u) { function wt(t) { var i; return r.pi.setFileType(t), r.pi.setActionOrigin(e.ActionOrigin), i = n.context.getWindowContext(e.windowNo, "WindowName"), i || (i = "Menu"), r.pi.setOriginName(i), { processInfo: r.pi.toJson(), parameterList: r.paraList } } function bt(t, i) { n.dataContext.executeProcess(t, function (n) { if (n.error != null) { r.pi.setSummary(n.error, !0); r.unlock(); r = null; return } var t = JSON.parse(n.result); if (t.IsError) { r.pi.setSummary(t.Message, !0); r.unlock(); r = null; return } i(t) }) } function ft(i, r) { var f, u, o, s, c, h; try { if (i.HTML) { if (r.getRightInnerDiv().html(i.HTML), f = document.getElementsByClassName("vis-reptabledetect"), f.length > 0) { for (u = 0, o = 0, s = 0, c = f.length; s < c; s++)o = t(f[s]).width(), o > u && (u = o); r.getRightDiv().width(t(window).width() - 10); r.getRightDiv().css("min-width", t(window).width() + "px"); r.getRightInnerDiv().width(u + 50) } r.getRightInnerDiv().width(u) } else i.ReportFilePath && (h = t("<iframe style = 'width:100%;height:99.4%;' pluginspage='http://www.adobe.com/products/acrobat/readstep2.html'>"), h.attr("src", n.Application.contextUrl + i.ReportFilePath), r.getRightDiv().empty().append(h), e.reportPath = i.ReportFilePath) } catch (l) { } r.setBusy(!1) } function ii() { i.setBusy(!0); window.setTimeout(function () { if (r.pi.dynamicAction && r.pi.dynamicAction.length > 0) yt(r.REPORT_TYPE_PDF, r.pi.getPageNo()); else if (r.pi.GetAD_ReportView_ID() > 0) ni(r.pi.getPageNo(), 0, null); else if (r.pi.getIsJasperReport()) getJasperReport(r.REPORT_TYPE_PDF, r.pi.getPageNo()); else if (r.pi.getIsReportFormat()) { var u = ui(r.pi.getAD_Process_ID(), r.pi.getTitle(), r.pi.getAD_PInstance_ID(), r.pi.getTable_ID(), r.pi.getRecord_ID(), r.pi.getPageNo(), r.pi.getPageSize(), !1); t.ajax({ url: n.Application.contextUrl + "ReportCom/ExecuteReport", type: "Post", data: u, success: function (r) { var u = JSON.parse(r), f; at ? window.open(n.Application.contextUrl + u) : (f = t("<iframe style = 'width:100%;height:99.4%;' pluginspage='http://www.adobe.com/products/acrobat/readstep2.html'>"), f.attr("src", n.Application.contextUrl + u), i.getRightDiv().empty().append(f)); e.reportPath = u; i.setBusy(!1) } }) } else bt(wt(r.REPORT_TYPE_PDF), function (n) { ft(n, i) }) }, 200) } function si() { e.visRepformatIcons && e.visRepformatIcons.length != 0 || (e.visRepformatIcons = e.cssForAll ? e.cssForAll + "vis vis-format" : "vis vis-format"); e.visSaveCsvIcons = e.visSaveCsvIcons && e.visSaveCsvIcons.length != 0 ? e.visSaveCsvIcons + " vis-report-icon " : " vis vis-save-csv"; e.visSavePdfIcons = e.visSavePdfIcons && e.visSavePdfIcons.length != 0 ? e.visSavePdfIcons + " vis-report-icon " : " vis vis-save-pdf"; e.visArchiveIcons = e.visArchiveIcons && e.visArchiveIcons.length != 0 ? e.visArchiveIcons + " vis-report-icon " : " vis vis-archive"; e.visRequeryIcons = e.visRequeryIcons && e.visRequeryIcons.length != 0 ? e.visRequeryIcons + " vis-report-icon " : " vis vis-refresh"; e.visCustomizeIcons = e.visCustomizeIcons && e.visCustomizeIcons.length != 0 ? e.visCustomizeIcons + " vis-report-icon " : " vis vis-customize"; e.visPrintIcons = e.visPrintIcons && e.visPrintIcons.length != 0 ? e.visPrintIcons + " vis-report-icon " : " vis vis-print " } function ri(n, t) { var i = r.pi.getOriginName(); return i || (i = "Menu"), { AD_Process_ID: r.pi.getAD_Process_ID(), Name: r.pi.getTitle(), AD_PInstance_ID: r.pi.getAD_PInstance_ID(), AD_Table_ID: r.pi.getTable_ID(), Record_ID: r.pi.getRecord_ID(), pageNumber: n, page_Size: t, saveAll: !1, ActionOrigin: r.pi.getActionOrigin(), OriginName: i } } function vt(n, t, i, u, f, e) { return { processInfo: r.pi.toJson(), queryInfo: JSON.stringify(n), code: t, isCreateNew: i, treeID: f, node_ID: u, IsSummary: e } } function ui(n, t, i, u, f, e, o, s) { var h = r.pi.getOriginName(); return h || (h = "Menu"), { AD_Process_ID: n, Name: t, AD_PInstance_ID: i, AD_Table_ID: u, Record_ID: f, pageNumber: e, page_Size: o, printAllPages: s, ActionOrigin: r.pi.getActionOrigin(), OriginName: h } } function fi(t, i, r, u, f) { t.HTML && t.HTML.length > 0 ? ft(t, i) : u == 0 ? (window.open(n.Application.contextUrl + t.ReportFilePath), i.setBusy(!1)) : ot(u, t.ReportFilePath, f, t) } function ot(i, r, u, f) { u.setBulkBusy(!1); t("#forreportdownload").addClass("hide"); st += '<input type="checkbox" data-num="' + f + '"  data-url="' + n.Application.contextUrl + r + '" checked />'; nt += 1; ei(nt / i * 100); nt == i && setTimeout(function () { ei(100); hi(n.Msg.getMsg("Generated")); t("<form>", { id: "download_form", html: st, action: "#", Class: "hide" }).appendTo(document.body).submit() }, 1e3) } function ei(n) { var i = t("#reportcreate").find(".progress-bar").width() * 100 / t("#reportcreate").width(); isNaN(i) && (i = 0); i <= n && t("#reportcreate").removeClass("hide").find(".progress-bar").attr("aria-valuenow", n).css({ width: n + "%" }).text(n.toFixed(0) + "%") } function oi() { t("#reportcreateresult").removeClass().text("") } function hi(n) { oi(); t("#reportcreateresult").addClass("alert alert-success").text(n); t("#forreportdownload").removeClass("hide") } function yt(u) { var f = { processInfo: r.pi.toJson() }; t.ajax({ url: n.Application.contextUrl + r.pi.dynamicAction, type: "Post", data: f, success: function (f) { var o = JSON.parse(f), s; return at || u != r.REPORT_TYPE_PDF ? window.open(n.Application.contextUrl + o) : (s = t("<iframe style = 'width:100%;height:99.4%;' pluginspage='http://www.adobe.com/products/acrobat/readstep2.html'>"), s.attr("src", n.Application.contextUrl + o), i.getRightDiv().empty().append(s), e.reportPath = o.ReportFilePath), i.setBusy(!1), o.ReportFilePath } }) } function gt(u, f, e) { r.pi.setPageNo(u); var o = { processInfo: r.pi.toJson() }; t.ajax({ url: n.Application.contextUrl + r.pi.dynamicAction, type: "Post", data: o, success: function (n) { n = JSON.parse(n); ot(e, n, f, u); i.setBusy(!1) } }) } var y = null, tt = null, o = null, it = null, p = null, a = null, v = null, rt = null, ut = null, w = null, b = !1, s = [], pt = null, h = null, l = null, k = null, d = null, e = this, g = null, ht, kt, dt, ct, c, et, lt, at, ni, ti, nt, ci, st; if (r.pi.setActionOrigin(e.ActionOrigin), ht = n.context.getWindowContext(e.windowNo, "WindowName"), ht || (ht = "Menu"), r.pi.setOriginName(ht), kt = r.pi.get_AD_PrintFormat_Table_ID(), b = n.MRole.getDefault().getIsCanExport(kt), dt = [], ct = -1, s = [], c = null, t.ajax({ type: "Get", async: !1, url: n.Application.contextUrl + "Form/GetPrintFormatDetails", data: { AD_Table_ID: kt }, success: function (t) { var i, r; c = (new n.DB.DataReader).toJson(t); try { while (c.read()) ct = parseInt(ct) + 1, i = c.getString(1), dt.indexOf(i) > -1 && (i = i + "_" + (parseInt(ct) + 1)), r = {}, r.ID = n.Utility.Util.getValueOfInt(c.get(0)), r.Name = i, r.IsDefault = c.getString(3), dt.push(c.getString(1)), s.push(r); c.close() } catch (u) { c.close() } c = null } }), si(), pt = t("<div>"), h = t('<select class="vis-selectcsview-page">'), l = t("<ul class='vis-apanel-rb-ul'>"), e.cssForAll ? (k = t("<li><a  title='" + n.Msg.getMsg("SaveAllRecordCsv") + "' class='vis vis-csv-all'><\/a><\/li>"), d = t("<li><a  title='" + n.Msg.getMsg("SaveAllPagePdf") + "' class='vis vis-pdf-all'><\/a><\/li>")) : (k = t("<li><a  title='" + n.Msg.getMsg("SaveAllRecordCsv") + "' class='vis vis-csv-all'><\/a><\/li>"), d = t("<li><a  title='" + n.Msg.getMsg("SaveAllPagePdf") + "' class='vis vis-pdf-all'><\/a><\/li>")), g = t("<div class='vis-report-header vis-ad-print-process'>"), g.append(t('<div class="vis-ad-w-p-t-name vis-ad-process-header"><h5>' + e.parent.getName() + "<\/h5><\/div >")), y = t('<div class="vis-icon-menuclose"><i class="vis vis-cross"><\/i><\/div >'), tt = t('<div class="vis-report-top-icons">'), o = t('<ul  class="vis-reporticonsulprint">'), w = t("<li><a class='" + e.visRepformatIcons + "'><\/a><\/li>"), l.append(t('<li data-id="-1">').append(n.Msg.getMsg("NewReport"))), pt.append(l), o.append(w), b && (rt = t("<li><a title='" + n.Msg.getMsg("SaveCSVPage") + "' class='vis vis-save-csv'><\/a><\/li>"), o.append(rt)), r.pi.getSupportPaging() && b) { for (o.append(k), et = 1; et < r.pi.getTotalPages() + 1; et++)h.append(t("<option value=" + et + ">" + et + "<\/option>")); tt.append(h) } b && (ut = t("<li><a title='" + n.Msg.getMsg("SavePDFDocumentPage") + "' class='vis vis-save-pdf'><\/a><\/li>"), o.append(ut)); r.pi.getSupportPaging() && b ? o.append(d) : (rt.find("a").attr("title", n.Msg.getMsg("SaveCSV")), ut.find("a").attr("title", n.Msg.getMsg("SavePdf"))); n.context.ctx["#BULK_REPORT_DOWNLOAD"] == "Y" ? (k.css("display", ""), d.css("display", "")) : (k.css("display", "none"), d.css("display", "none")); it = t("<li><a title='" + n.Msg.getMsg("Archive") + "'  class='vis vis-archive'><\/a><\/li>"); o.append(it); p = t("<li><a title='" + n.Msg.getMsg("Requery") + "'  class='vis vis-refresh'><\/a><\/li>"); o.append(p); a = t("<li><a style='cursor:pointer;' class='vis vis-customize'><\/a><\/li>"); o.append(a); v = t("<li><a style='cursor:pointer;' class='vis vis-print'><\/a><\/li>"); o.append(v); u.HTML || (v.css("display", "none"), a.css("display", "none"), w.css("display", "none")); tt.append(o); g.append(tt); e.hideclose || g.append(y); e.splitUI ? (e.reportToolbar.removeClass("vis-processtoolpadd"), e.reportToolbar.empty().append(g), e.reportContainer.empty().append(i.getRoot()), e.extrnalForm && e.getContentTable().empty().append(e.reportContainer)) : (e.parent.getContentGrid().append(g).append(i.getRoot()), i.getRoot().css("width", t(window).width())); lt = e.parent; at = /ipad|iphone|ipod|mobile|android|blackberry|webos|windows phone/i.test(navigator.userAgent.toLowerCase()); y.off("click"); p.off("click"); a.off("click"); v.off("click"); w.off("click"); l.off("click"); it.off("click"); y.on("click", function () { i && (i.dispose(), i = null); lt && (lt.dispose(), lt = null); r.pi && r.pi.dispose(); r.pi = null; o.empty(); y.off("click"); p.off("click"); a.off("click"); v.off("click"); w.off("click"); l.off("click"); y = null; tt = null; o = null; it = null; p = null; a = null; v = null; rt = null; ut = null; handleEvents = null }); p.on("click", function () { i.setBusy(!0); i.getRightInnerDiv().html(""); i.getRightInnerDiv().width(0); r.pi.dynamicAction && r.pi.dynamicAction.length > 0 ? yt(r.REPORT_TYPE_PDF, h.val()) : ii() }); a.on("click", function () { var t = new n.Query; t.addRestriction("AD_PrintFormat_ID", n.Query.prototype.EQUAL, r.pi.AD_PrintFormat_ID); n.viewManager.startWindow(240, t) }); v.on("click", function () { if (i.getIsHtmlReport()) { var n = window.open(); n.document.write("<html><head>"); n.document.write("<\/head><body >"); n.document.write(i.getHtml()); n.document.write("<\/body><\/html>"); n.print(); n.close() } }); w.on("click", function () { var i, u, r; for (l.empty(), i = 0; i < s.length; i++)u = s[i].IsDefault == "Y" ? "vis-mainfavitem" : "vis-mainnonfavitem", r = t('<li><a data-isdefbtn="no" data-id="' + s[i].ID + '">' + s[i].Name + "<\/a><\/li>"), l.append(r); l.append(t('<li><a data-id="-1">' + n.Msg.getMsg("NewReport") + "<\/a>")); t(this).w2overlay(pt.clone(!0), { css: { height: "300px" } }) }); l.on("click", "LI", function (u) { var v, h, y, o, c, p, l, a, w; if (i.setBusy(!0), v = t(u.target), h = v.data("id"), v.data("isdefbtn") == "yes") { for (y = "VIS_76", o = [], o[0] = new n.DB.SqlParam("@tableID", r.pi.Ad_Table_ID), o[1] = new n.DB.SqlParam("@tabID", curTab.getAD_Tab_ID()), f(sql, o), y = "VIS_77", o = [], o[0] = new n.DB.SqlParam("@printForamt", h), f(sql, o), c = 0; c < s.length; c++)s[c].IsDefault = s[c].ID == h ? "Y" : "N"; return } AD_PrintFormat_ID = h; p = !1; h == -1 && (h = r.pi.get_AD_PrintFormat_Table_ID, p = !0); l = []; a = new n.Query(r.pi.getPrintFormatTableName()); l.push(a.getTableName()); l.push(a.getWhereClause(!0)); w = vt(l, a.getCode(0), false0, 0, !1); t.ajax({ url: n.Application.contextUrl + "JsonData/GenerateReport/", dataType: "json", data: w, type: "POST", success: function (n) { var t = jQuery.parseJSON(n); if (t.IsError) { r.pi.setSummary(t.Message, !0); r.unlock(); r = null; return } ft(t.repInfo, i); e.reportPath = t.repInfo.ReportFilePath } }) }); it.on("click", function () { e.archiveDocument(i, r) }); if (b) { rt.on("click", function () { r.pi.setFileType("C"); r.pi.getPageNo() == 1 ? (r.pi.setAD_PInstance_ID(0), i.setBusy(!0), bt(wt(r.REPORT_TYPE_CSV), function (t) { window.open(n.Application.contextUrl + t.ReportFilePath); i.setBusy(!1) })) : (i.setBusy(!0), window.setTimeout(function () { if (r.pi.dynamicAction && r.pi.dynamicAction.length > 0) yt(r.REPORT_TYPE_CSV, r.pi.getPageNo()); else if (r.pi.GetAD_ReportView_ID() > 0) ti(h.val(), 0, null); else if (r.pi.getIsJasperReport()) f("C", r.pi.getPageNo()); else { pageNo = h.val(); var u = ri(pageNo, r.pi.getPageSize()); t.ajax({ url: n.Application.contextUrl + "ReportCom/ExecuteReportforCsv", type: "Post", data: u, success: function (t) { var r = JSON.parse(t); window.open(n.Application.contextUrl + "TempDownload/" + r); i.setBusy(!1) } }) } }, 100)) }); ut.on("click", function () { r.pi.setFileType(r.REPORT_TYPE_PDF); r.pi.getPageNo() == 1 ? (i.setBusy(!0), bt(wt(r.REPORT_TYPE_PDF), function (n) { ft(n, i) })) : ii() }); h.on("change", function () { var u, f, o; pageNo = h.val(); r.pi.GetAD_ReportView_ID() > 0 ? (i.setBusy(!0), u = [], r.pi.setPageNo(pageNo), f = new n.Query(r.pi.getPrintFormatTableName()), r.pi.getPrintFormatTableName() && (u.push(f.getTableName()), u.push(f.getWhereClause(!0))), o = vt(u, "", !1, 0, 0, !1), t.ajax({ url: n.Application.contextUrl + "JsonData/GenerateReport/", dataType: "json", type: "POST", data: o, success: function (n) { var t = jQuery.parseJSON(n); if (t.IsError) { r.pi.setSummary(t.Message, !0); r.unlock(); r = null; return } ft(t.repInfo, i); e.reportPath = t.repInfo.ReportFilePath } })) : r.pi.setPageNo(pageNo) }); function f(u) { r.pi.setFileType(u); var f = { processInfo: r.pi.toJson() }; t.ajax({ url: n.Application.contextUrl + "JasperReport/ExecuteReport", type: "Post", data: f, success: function (f) { var o = JSON.parse(f), s; at ? window.open(n.Application.contextUrl + o) : (u == r.REPORT_TYPE_PDF ? (s = t("<iframe style = 'width:100%;height:99.4%;' pluginspage='http://www.adobe.com/products/acrobat/readstep2.html'>"), s.attr("src", n.Application.contextUrl + o), i.getRightDiv().empty().append(s)) : window.open(n.Application.contextUrl + o), e.reportPath = o); i.setBusy(!1) } }) } function u(u, f, e) { var o; r.pi.setPageNo(u); o = { processInfo: r.pi.toJson() }; t.ajax({ url: n.Application.contextUrl + "JasperReport/ExecuteReport", type: "Post", data: o, success: function (n) { n = JSON.parse(n); ot(f, n, e, u); i.setBusy(!1) } }) } k.on("click", function () { i.setBusy(!0); nt = 0; st = ""; r.pi.setFileType("C"); window.setTimeout(function () { var i = new n.BulkDownload(e.windowNo, "CSV"), t; if (i.onClose = function () { }, i.show(), r.pi.dynamicAction && r.pi.dynamicAction.length > 0) for (t = 1; t <= r.pi.getTotalPages(); t++)gt(t, i, r.pi.getTotalPages()); else if (r.pi.GetAD_ReportView_ID() > 0) for (t = 1; t <= r.pi.getTotalPages(); t++)ti(t, r.pi.getTotalPages(), i); else if (r.pi.getIsJasperReport()) for (t = 1; t <= r.pi.getTotalPages(); t++)u(t, r.pi.getTotalPages(), i); else for (t = 1; t <= r.pi.getTotalPages(); t++)o(t, i, r.pi.getTotalPages()); r.pi.setPageNo(h.val()) }, 100) }); function o(u, f, e) { var s = "", o; r.pi.dynamicAction && r.pi.dynamicAction.length > 0 ? s = yt(r.REPORT_TYPE_CSV, u) : (o = ri(u, r.pi.getPageSize()), t.ajax({ url: n.Application.contextUrl + "ReportCom/ExecuteReportforCsv", type: "Post", data: o, success: function (n) { var t = JSON.parse(n); t = "TempDownload/" + t; ot(e, t, f, u); i.setBusy(!1) } })) } ni = function (u, f, o) { var s = [], h = new n.Query(r.pi.getPrintFormatTableName()), c; s.push(h.getTableName()); s.push(h.getWhereClause(!0)); c = vt(s, "", !1, 0, 0, !1); t.ajax({ url: n.Application.contextUrl + "JsonData/GenerateReport/", dataType: "json", data: c, type: "POST", success: function (t) { t == null && n.ADialog.error("ERRORGettingRepData"); var s = jQuery.parseJSON(t), r = s.repInfo; if (r.ErrorText) { n.ADialog.error(r.ErrorText); i.setBusy(!0); return } fi(r, i, u, f, o); i.setBusy(!1); e.reportPath = r.ReportFilePath } }) }; ti = function (u, f, o) { var s = [], h = new n.Query(r.pi.getPrintFormatTableName()), c; s.push(h.getTableName()); s.push(h.getWhereClause(!0)); c = vt(s, "", !1, 0, 0, !1); t.ajax({ url: n.Application.contextUrl + "JsonData/GenerateReport/", dataType: "json", data: c, type: "POST", success: function (t) { t == null && n.ADialog.error("ERRORGettingRepData"); var s = jQuery.parseJSON(t), r = s.repInfo; if (r.ErrorText) { n.ADialog.error(r.ErrorText); setBusy(!1); return } fi(r, i, u, f, o); e.reportPath = r.ReportFilePath; i.setBusy(!1) } }) }; d.on("click", function () { i.setBusy(!0); nt = 0; st = ""; r.pi.setFileType(r.REPORT_TYPE_PDF); window.setTimeout(function () { var i = new n.BulkDownload(e.windowNo, "PDF"), t; if (i.onClose = function () { }, i.show(), r.pi.dynamicAction && r.pi.dynamicAction.length > 0) for (t = 1; t <= r.pi.getTotalPages(); t++)gt(t, i, r.pi.getTotalPages()); else if (r.pi.GetAD_ReportView_ID() > 0) for (t = 1; t <= r.pi.getTotalPages(); t++)ni(t, r.pi.getTotalPages(), i); else if (r.pi.getIsJasperReport()) for (t = 1; t <= r.pi.getTotalPages(); t++)u(t, r.pi.getTotalPages(), i); else for (t = 1; t <= r.pi.getTotalPages(); t++)s(t, i, r.pi.getTotalPages()); r.pi.setPageNo(h.val()) }, 100) }); nt = 0; function s(u, f, o) { var h = "", s; r.pi.dynamicAction && r.pi.dynamicAction.length > 0 ? h = gt(r.REPORT_TYPE_CSV, u) : (s = ui(r.pi.getAD_Process_ID(), r.pi.getTitle(), r.pi.getAD_PInstance_ID(), r.pi.getTable_ID(), r.pi.getRecord_ID(), u, r.pi.getPageSize(), !1), t.ajax({ url: n.Application.contextUrl + "ReportCom/ExecuteReport", type: "Post", data: s, success: function (n) { var t = JSON.parse(n); ot(o, t, f, u); e.reportPath = t; i.setBusy(!1) } })) } ci = function () { for (var i, r, u, n = 0; n < arguments.length; n++)i = t('<iframe style="visibility: collapse;"><\/iframe>'), t("body").append(i), r = i[0].contentDocument, u = '<form action="' + arguments[n] + '" method="GET"><\/form>', r.write(u), t("form", r).submit(), setTimeout(function (n) { return function () { n.remove() } }(i), 2e3) }; st = "" } }; i.prototype.showReport = function (t, i, r) { var u = this; this.splitUI || (this.mPanel && (this.mPanel.dispose(), this.mPanel = null), this.disposeComponent()); this.mPanel = t; this.pCtl = r; this.createUI(t, r, i); this.parent.hideHeader(!0); t.setBusy(!1); (n.context.ctx.$AutoArchive == "1" || n.context.ctx.$AutoArchive == "2") && u.archiveDocument(t, r) }; i.prototype.showTelerikReport = function (n, t) { var i = new KJS.TelerikContainer(n, t); i.getRoot().height(this.parent.getContentGrid().height()); this.parent.getContentGrid().empty(); this.parent.getContentGrid().append(i.getRoot()); i.init() }; i.prototype.setReportBytes = function (n) { this.reportBytes = n }; i.prototype.setReportPath = function (n) { this.reportPath = n }; i.prototype.sizeChanged = function (n, t) { this.setSize(n, t); this.mPanel && this.mPanel.sizeChanged && !this.splitUI && this.mPanel.sizeChanged(n, t); this.setParameterHeights && this.setParameterHeights(n, t) }; i.prototype.refresh = function () { this.setParameterHeights && this.setParameterHeights(); this.mPanel && this.mPanel.refresh && this.mPanel.refresh(); this.setMsg && this.setMsg("") }; n.AProcess = i }(VIS, jQuery), function (n, t) { function i(n, t) { this.parent = n; this.pi = t; this.windowNo; this.paraList = null; this.splitUI = n.splitUI; this.parameters = null; this.cansplitUI = function (n) { splitUI = n }; this.getFileType = function () { return n.getFileType() }; this.setBusy = function (t) { n.setBusy(t) }; this.isBackground = function () { return n.isBackground() } } function r(i, r, u) { function h() { o = t("<div class='vis-height-full'>"); f = t("<div class='vis-height-full'>"); f.css("background-color", "rgba(var(--v-c-primary), .3)"); $innerRightDiv = t("<div class='vis-height-full' style='padding:5px;'>"); o.append(f); o.append(s); u ? (f.append($innerRightDiv), $innerRightDiv.html(i)) : r.getIsBiHtml() ? (e = t("<iframe style = 'width:100%;height:99.4%;'>"), e.attr("src", n.Application.contextUrl + "BiPanel/GetHTMLReport?info=" + window.encodeURIComponent(i)), f.css("height", "95%"), f.css("width", "100%"), f.append(e)) : (e = t("<iframe style = 'width:100%;height:99.4%;' pluginspage='http://www.adobe.com/products/acrobat/readstep2.html'>"), e.attr("src", n.Application.contextUrl + i), f.css("height", "95%"), f.css("width", "100%"), f.append(e)) } this.bytes = null; this.RptFileName = i; this.Pi = r; var o = null, f = null; $innerRightDiv = null; var e = null, s = t("<div class='vis-apanel-busy' style='width:98%;height:98%;position:absolute'>"); h(); this.getRoot = function () { return o }; this.getRightDiv = function () { return f }; this.getRightInnerDiv = function () { return $innerRightDiv }; this.getIsHtmlReport = function () { return u }; this.getHtml = function () { return i }; this.disposeComponent = function () { o != null && (o.remove(), o = null) }; this.setBusy = function (n) { s.css("display", n ? "block" : "none") }; this.sizeChanged = function () { }; this.refresh = function () { e && (window.setTimeout(function () { e.css("height", "99.4%") }, 50), e.css("height", e.height() - 1)) } } i.prototype.REPORT_TYPE_CSV = "C"; i.prototype.REPORT_TYPE_PDF = "P"; i.prototype.REPORT_TYPE_RTF = "R"; i.prototype.REPORT_TYPE_BIHTML = "B"; i.prototype.ORIGIN_WINDOW = "W"; i.prototype.ORIGIN_FORM = "F"; i.prototype.ORIGIN_MENU = "P"; i.prototype.process = function (t) { var i, r; this.lock(); this.windowNo = t; this.pi.setWindowNo(t); i = this; this.jObjectFromServer = null; r = { processInfo: this.pi.toJson() }; n.dataContext.process(r, function (n) { if (n.error != null) { i.pi.setSummary(n.error, !0); i.unlock(); i = null; return } var t = JSON.parse(n.result); if (t.IsError) { i.pi.setSummary(t.Message, !0); i.unlock(); i = null; return } i.complete(t); i = null }) }; i.prototype.complete = function (t) { var i, u, r, f, e; if (this.jObjectFromServer = t, this.pi.setAD_PInstance_ID(t.AD_PInstance_ID), this.pi.setIsBiHtml(t.IsBiHTMlReport), this.pi.setCustomHTML(t.CustomHTML), this.pi.set_AD_PrintFormat_ID(t.AD_PrintFormat_ID), t && t.ReportProcessInfo && (this.pi.setIsReport(t.ReportProcessInfo.IsReport), this.pi.setTotalPages(t.ReportProcessInfo.TotalPage), this.pi.setSupportPaging(t.ReportProcessInfo.SupportPaging), this.pi.setPageSize(t.ReportProcessInfo.PageSize)), t.ShowParameter) { this.pi.setAD_PInstance_ID(t.AD_PInstance_ID); try { i = new n.ProcessParameter(this.pi, this, this.windowNo); this.splitUI && (this.parent.parameterContainer.append(i.getRoot()), this.parent.setParameterHeights()); i.initDialog(t.ProcessFields); this.splitUI ? i.showCloseIcon(this.parent.getShowParameterCloseIcon()) : (i.showDialog(), i = null) } catch (o) { this.pi.setSummary(o.message, !0) } this.unlock() } else t.IsTelerikReport ? window.KJS && this.parent && this.parent.showTelerikReport(this.pi.AD_PInstance_ID, this.pi.getTable_ID()) : (this.unlock(), this.parent && (t.AskForNewTab && t.HTML && t.HTML.length > 0 ? n.ADialog.confirm("VIS_OpenNewTab", !0, "", "Confirm", function (i) { i && window.open(n.Application.contextUrl + t.ReportFilePath) }) : t.ReportFilePath ? (u = /ipad|iphone|ipod|mobile|android|blackberry|webos|windows phone/i.test(navigator.userAgent.toLowerCase()), u ? window.open(n.Application.contextUrl + t.ReportFilePath) : this.parent.setReportBytes ? (this.parent.setReportBytes(t.Report), this.parent.setReportPath(t.ReportFilePath), r = null, f = !1, t.HTML && t.HTML.length > 0 ? (r = new n.PdfViewer(t.HTML, null, !0), this.parent.showReport(r, t, this)) : t.ReportFilePath && t.ReportFilePath.length > 0 && (r = new n.PdfViewer(t.ReportFilePath, this.pi), f = !0, this.parent.showReport(r, t, this))) : window.open(n.Application.contextUrl + t.ReportFilePath)) : this.pi.getUseCrystalReportViewer() && this.pi.getIsReport() && (e = new n.ReportViewerContainer(this), e.show()))), this.setBusy(!1), this.dispose() }; i.prototype.onProcessDialogClosed = function (t, i) { var r, u; t && (r = this, this.paraList = i, this.lock(), u = { processInfo: r.pi.toJson(), parameterList: i }, n.dataContext.executeProcess(u, function (n) { if (n.error != null) { r.pi.setSummary(n.error, !0); r.unlock(); r = null; return } var t = JSON.parse(n.result); if (t.IsError) { r.pi.setSummary(t.Message, !0); r.unlock(); r = null; return } r.complete(t); this.splitUI || (r = null) })) }; i.prototype.unlock = function () { var t = this.jObjectFromServer ? this.jObjectFromServer.Result : null; t != null && t.indexOf("@") != -1 ? this.pi.setSummary(n.Msg.parseTranslation(n.Env.getCtx(), t)) : t && this.pi.setSummary(t); this.jObjectFromServer && this.pi.setError(this.jObjectFromServer.IsError); this.parent && this.parent.unlockUI(this.pi) }; i.prototype.lock = function () { this.parent && this.parent.lockUI(this.pi) }; i.prototype.dispose = function () { this.splitUI || (this.parent = null) }; r.prototype.dispose = function () { this.disposeComponent() }; n.PdfViewer = r; n.ProcessCtl = i }(VIS, jQuery), function (n, t) { function i(t, i, r, u) { this.title = t; this.AD_Process_ID = i; this.table_ID = r; this.tableName = ""; this.record_ID = u; this.AD_User_ID = 0; this.AD_Client_ID = 0; this.className = null; this.AD_PInstance_ID = 0; this.summary = ""; this.error = !1; this.batch = !1; this.timeout = !1; this.parameter = null; this.AD_PrintFormat_Table_ID = 0; this.AD_PrintFormat_ID = 0; this.isReportFormat = !1; this.isCrystal = !1; this.totalrecords = 0; this.isTelerikReport = !1; this.supportPaging = !1; this.dynamicAction = ""; this.pageSize = n.context.ctx["#REPORT_PAGE_SIZE"]; this.totalPage = 1; this.pageNo = 1; this.fileType = n.ProcessCtl.prototype.REPORT_TYPE_PDF; this.windowNo = 0; this.tableName = ""; this.AD_Window_ID = 0; this.AD_ReportView_ID = 0; this.printFormatTableName = ""; this.useCrystalReportViewer = !1; this.isReport = !1; this.isBackground = !1; this.ActionOrigin = ""; this.OriginName = ""; this.isBiHtml = !1 } function u(n, t) { n.className = t.ClassName; n.record_ID = t.Record_ID; n.error = t.Error; n.AD_PInstance_ID = t.AD_PInstance_ID; n.summary = t.Summary; n.table_ID = t.AD_Table_ID; n.tableName = t.AD_TableName; n.AD_User_ID = t.AD_User_ID; n.AD_Client_ID = t.AD_Client_ID; n.batch = t.Batch; n.timeout = t.TimeOut; n.AD_PrintFormat_Table_ID = t.AD_PrintFormat_Table_ID; n.printFormatTableName = t.PrintFormatTableName; n.AD_PrintFormat_ID = t.AD_PrintFormat_ID; n.isCrystal = t.IsCrystal; n.isReportFormat = t.IsReportFormat; n.totalrecords = parseInt(t.TotalRecords); n.isTelerikReport = t.IsTelerikReport; n.supportPaging = t.SupportPaging; n.dynamicAction = t.DynamicAction; n.pageSize = t.PageSize; n.title = t.Title; n.AD_Process_ID = t.Process_ID; n.totalPage = t.TotalPage; n.pageNo = t.PageNo; n.windowNo = t.WindowNo; n.AD_ReportView_ID = t.AD_ReportView_ID; n.isJasperReport = t.IsJasperReport; n.useCrystalReportViewer = t.UseCrystalReportViewer; n.isReport = t.IsReport; n.isBackground = t.IsBackground; n.ActionOrigin = t.ActionOrigin; n.OriginName = t.OriginName } function s(n, i, r) { var u = null; return t.ajax({ url: e, type: "POST", datatype: "json", contentType: "application/json; charset=utf-8", async: i, data: JSON.stringify(n) }).done(function (n) { u = n; r && r(n) }), u } function r(n, t, i, r, u) { this.P_ID; this.P_Date; this.P_Number; this.P_Msg; n ? this.setLog_ID(n) : this.setLog_ID(this.Log_ID++); this.setP_ID(t); this.setP_Date(i); this.setP_Number(r); this.setP_Msg(u) } i.prototype.toJson = function () { return { Title: this.title, Process_ID: this.AD_Process_ID, AD_PInstance_ID: this.AD_PInstance_ID, Record_ID: this.record_ID, Error: this.error, Summary: this.getSummary(), ClassName: this.className, AD_Table_ID: this.table_ID, AD_TableName: this.tableName, AD_User_ID: this.AD_User_ID, AD_Client_ID: this.AD_Client_ID, Batch: this.batch, TimeOut: this.timeout, AD_PrintFormat_Table_ID: this.AD_PrintFormat_Table_ID, PrintFormatTableName: this.printFormatTableName, AD_PrintFormat_ID: this.AD_PrintFormat_ID, SupportPaging: this.supportPaging, DynamicAction: this.dynamicAction, PageSize: this.pageSize, TotalPage: this.totalPage, PageNo: this.pageNo, FileType: this.fileType, AD_Window_ID: this.AD_Window_ID, WindowNo: this.windowNo, AD_ReportView_ID: this.AD_ReportView_ID, UseCrystalReportViewer: this.useCrystalReportViewer, IsReport: this.isReport, IsBackground: this.isBackground, ActionOrigin: this.ActionOrigin, OriginName: this.OriginName } }; i.prototype.fromJson = function (n) { var t = null; return t = this instanceof i ? this : new i(n.Title, n.Process_ID), n && n.length > 0 && u(t, n), t }; i.prototype.setPrintFormatTableName = function (n) { this.printFormatTableName = n }; i.prototype.getPrintFormatTableName = function () { return this.printFormatTableName }; i.prototype.setSupportPaging = function (n) { this.supportPaging = n }; i.prototype.getSupportPaging = function () { return this.supportPaging }; i.prototype.setTotalPages = function (n) { this.totalPage = n }; i.prototype.getTotalPages = function () { return this.totalPage }; i.prototype.setPageNo = function (n) { this.pageNo = n }; i.prototype.getPageNo = function () { return this.pageNo }; i.prototype.setPageSize = function (n) { this.pageSize = n }; i.prototype.getPageSize = function () { return this.pageSize }; i.prototype.setError = function (n) { this.error = n }; i.prototype.getIsError = function () { return this.error }; i.prototype.getIsBatch = function () { return this.batch }; i.prototype.setIsBatch = function (n) { this.batch = n }; i.prototype.getAD_PInstance_ID = function () { return this.AD_PInstance_ID }; i.prototype.setAD_PInstance_ID = function (n) { this.AD_PInstance_ID = n }; i.prototype.getAD_Process_ID = function () { return this.AD_Process_ID }; i.prototype.setAD_Process_ID = function (n) { this.AD_Process_ID = n }; i.prototype.getClassName = function () { return this.className }; i.prototype.setClassName = function (n) { this.className = n; n != null && n.length == 0 && (this.className = null) }; i.prototype.getTable_ID = function () { return this.table_ID }; i.prototype.setTable_ID = function (n) { this.table_ID = n }; i.prototype.setTable_Name = function (n) { this.tableName = n }; i.prototype.getTable_Name = function () { return this.tableName }; i.prototype.setPrintFormatTableName = function (n) { this.printFormatTableName = n }; i.prototype.getPrintFormatTableName = function () { return this.printFormatTableName }; i.prototype.getRecord_ID = function () { return this.record_ID }; i.prototype.setRecord_ID = function (n) { this.record_ID = n }; i.prototype.getTitle = function () { return this.title }; i.prototype.setTitle = function (n) { this.title = n }; i.prototype.setAD_Client_ID = function (n) { this.AD_Client_ID = n }; i.prototype.getAD_Client_ID = function () { return this.AD_Client_ID }; i.prototype.setAD_User_ID = function (n) { this.AD_User_ID = n }; i.prototype.getAD_User_ID = function () { return this.AD_User_ID }; i.prototype.getParameter = function () { return this.parameter }; i.prototype.setParameter = function (n) { this.parameter = n }; i.prototype.setIsTimeout = function (n) { this.timeout = n }; i.prototype.getIsTimeout = function () { return this.timeout }; i.prototype.set_AD_PrintFormat_Table_ID = function (n) { this.AD_PrintFormat_Table_ID = n }; i.prototype.get_AD_PrintFormat_Table_ID = function () { return this.AD_PrintFormat_Table_ID }; i.prototype.set_AD_PrintFormat_ID = function (n) { this.AD_PrintFormat_ID = n }; i.prototype.Get_AD_PrintFormat_ID = function () { return this.AD_PrintFormat_ID }; i.prototype.setIsCrystal = function (n) { this.isCrystal = n }; i.prototype.getIsCrystal = function () { return this.isCrystal }; i.prototype.setIsTelerikReport = function (n) { this.isTelerikReport = n }; i.prototype.getIsTelerikReport = function () { return this.isTelerikReport }; i.prototype.setIsReportFormat = function (n) { this.isReportFormat = n }; i.prototype.getIsReportFormat = function () { return this.isReportFormat }; i.prototype.getTotalRecord = function () { return this.totalrecords }; i.prototype.getFileType = function () { return this.fileType }; i.prototype.setFileType = function (n) { this.fileType = n }; i.prototype.setWindowNo = function (n) { this.windowNo = n }; i.prototype.getWindowNo = function () { return this.windowNo }; i.prototype.setUseCrystalReportViewer = function (n) { this.useCrystalReportViewer = n }; i.prototype.getUseCrystalReportViewer = function () { return this.useCrystalReportViewer }; i.prototype.setIsReport = function (n) { this.isReport = n }; i.prototype.getIsReport = function () { return this.isReport }; i.prototype.GetAD_ReportView_ID = function () { return this.AD_ReportView_ID }; i.prototype.SetAD_ReportView_ID = function (n) { this.AD_ReportView_ID = n }; i.prototype.setIsJasperReport = function (n) { this.isJasperReport = n }; i.prototype.getIsJasperReport = function () { return this.isJasperReport }; i.prototype.setAD_Window_ID = function (n) { this.AD_Window_ID = n }; i.prototype.getAD_Window_ID = function () { return this.AD_Window_ID }; i.prototype.setIsBackground = function (n) { this.isBackground = n }; i.prototype.getIsBackground = function () { return this.isBackground }; i.prototype.getActionOrigin = function () { return this.ActionOrigin }; i.prototype.setActionOrigin = function (n) { this.ActionOrigin = n }; i.prototype.getOriginName = function () { return this.OriginName }; i.prototype.setOriginName = function (n) { this.OriginName = n }; i.prototype.setIsBiHtml = function (n) { this.isBiHtml = n }; i.prototype.getIsBiHtml = function () { return this.isBiHtml }; i.prototype.setSummary = function (n, t) { arguments.length == 2 && this.setError(t); this.summary = n }; i.prototype.getSummary = function () { return this.summary }; i.prototype.setCustomHTML = function (n) { this.customHTML = n }; i.prototype.getCustomHTML = function () { return this.customHTML }; i.prototype.addLog = function (n, t, i, u, f) { return this.addLogEntry(new r(n, t, i, u, f)) }; i.prototype.addLogEntry = function (n) { var r, t, i, u; if (n == null) return null; for (this.logs == null && (this.logs = []), r = n.getLog_ID(), t = 0; t < this.logs.length; t++)if (i = this.logs[t], u = i.getLog_ID(), r == u) return i; return this.logs.push(n), n }; i.prototype.getLogInfo = function (t) { var i, u, r, s; if (this.logs == null) return ""; i = new StringBuilder; t && i.append('<div class=\'vis-process-result-table\'><table width="100%" border="0" cellspacing="0" cellpadding="2">'); var f = !1, e = !1, o = !1; for (u = 0; u < this.logs.length; u++)r = this.logs[u], r.getP_Date() != null && (f = !0), r.getP_Number() != null && (e = !0), r.getP_Msg() != null && (o = !0); for (u = 0; u < this.logs.length; u++)t ? i.append("<tr>") : u > 0 && i.append("\n"), r = this.logs[u], r.getP_Date() != null ? (i.append(t ? "<td>" : ""), s = r.getP_Date(), i.append(t ? "<\/td>" : " \t")) : f && i.append(t ? "<td>&nbsp;<\/td>" : " \t"), r.getP_Number() != null ? i.append(t ? "<td>" : "").append(r.getP_Number()).append(t ? "<\/td>" : " \t") : e && i.append(t ? "<td>&nbsp;<\/td>" : " \t"), r.getP_Msg() != null ? i.append(t ? "<td>" : "").append(n.Msg.parseTranslation(n.Env.getCtx(), r.getP_Msg())).append(t ? "<\/td>" : "") : o && i.append(t ? "<td>&nbsp;<\/td>" : ""), t && i.append("<\/tr>"); return t && i.append("<\/table><\/div>"), i.toString() }; i.prototype.dispose = function () { this.title = null; this.AD_Process_ID = null; this.table_ID = null; this.tableName = null; this.record_ID = null; this.AD_User_ID = null; this.AD_Client_ID == null; this.className = null; this.AD_PInstance_ID = null; this.summary = null; this.error = null; this.batch = null; this.timeout = null; this.parameter = null; this.AD_PrintFormat_Table_ID = null; this.AD_PrintFormat_ID = null; this.isReportFormat = null; this.isCrystal = null; this.totalrecords = null; this.isJasperReport = null; this.customHTML = null }; var f = n.Application.contextUrl, e = f + "JsonData/JDataSetWithCode", o = function (t, i, r) { var e = r ? !0 : !1, f = { sql: t, page: 1, pageSize: 0 }, u; return i && (f.param = i), u = null, s(f, e, function (t) { u = (new n.DB.DataReader).toJson(t); r && r(u) }), u }; n.ProcessInfoUtil = { setLogFromDB: function (t) { var r = [], i; r[0] = new n.DB.SqlParam("@AD_PInstance_ID", t.getAD_PInstance_ID()); i = null; try { for (i = o("VIS_144", r); i.read();)t.addLog(i.getInt(0), i.getInt(1), i.getDateTime(2), i.getDecimal(3), i.getString(4)) } catch (u) { console.log(u) } finally { i && i.dispose() } } }; r.prototype.Log_ID = 0; r.prototype.getLog_ID = function () { return this.Log_ID }; r.prototype.setLog_ID = function (n) { this.Log_ID = n }; r.prototype.getP_ID = function () { return this.P_ID }; r.prototype.setP_ID = function (n) { this.P_ID = n }; r.prototype.getP_Date = function () { return this.P_Date }; r.prototype.setP_Date = function (n) { this.P_Date = n }; r.prototype.getP_Number = function () { return this.P_Number }; r.prototype.setP_Number = function (n) { this.P_Number = n }; r.prototype.getP_Msg = function () { return this.P_Msg }; r.prototype.setP_Msg = function (n) { this.P_Msg = n }; n.ProcessInfo = i }(VIS, jQuery), function (n, t) { function i(i, r, u) { function b() { e = t("<div class='vis-pro-para-root'>"); l = t("<table class='vis-processpara-table vis-formouterwrpdiv'>"); p = t('<div class="vis-processbtnwrap">'); v = t('<div class="vis-para-maxheight">'); v.append(l); e.append(v).append(p); h = t('<input type="button" class="vis-process-ok-btn" >').val(n.Msg.getMsg("OK")); h.addClass("VIS_Pref_btn-2"); o = t("<input type='button'>").val(n.Msg.getMsg("Close")); o.addClass("VIS_Pref_btn-2"); c || v.css("height", "auto") } var c, e, l, a, y, w, s, h, o, p, v, f; this.pi = i; this.parent = r; this.windowNo = u; this.gridFields = []; this.depOnFieldColumn = []; this.depOnField = []; this.vEditors = []; this.vEditors2 = []; this.mFields = []; this.mFields2 = []; this.isOkClicked = !1; c = r.splitUI; this.onClosed; b(); f = this; this.addLine = function () { a = y = w = s = null; a = t("<tr>"); y = t("<td class=''>"); s = t("<td class='vis-processpara-table-td3'>"); l.append(a.append(s)); c && (l.width("100%"), a.addClass("vis-processpara-table-SplitUI"), s.addClass("vis-processpara-table-SplitUI")) }; this.addFields = function (n, i) { var r, u, f, e, c, o, h; n; i && (r = null, n && (r = n.getControl()), u = t('<div class="input-group vis-input-wrap">'), f = t('<div class="vis-control-wrap">'), s.append(u), u.append(f), e = i.getControl().attr("placeholder", " ").attr("data-placeholder", ""), f.append(e), r && f.append(r), i.getBtnCount() > 0 ? (i.getControl().attr("placeholder", " ").attr("data-placeholder", "").attr("data-hasbtn", " "), e.attr("type") == "date", c = i.getBtn(0), o = t('<div class="input-group-append">'), o.append(c), u.append(o), h = i.getBtn(1), h && o.append(h)) : e.attr("type") == "date") }; this.addButtons = function () { this.addLine(); p.append(o).append(h) }; this.canOpenDialog = function (n) { c = n }; this.showCloseIcon = function (n) { n || o.hide() }; this.showDialog = function () { e.dialog({ modal: !0, width: "auto", closeText: n.Msg.getMsg("close"), close: function () { if (f.parent) f.parent.onProcessDialogClosed(f.isOkClicked, f.parameterList); f.dispose(); f = null } }); window.setTimeout(function () { o.focus() }, 200) }; this.getRoot = function () { var n = this; return e }; this.onClose = function (n) { f.isOkClicked = n; e.dialog("close") }; o.on(n.Events.onTouchStartAndClick, function (n) { n.stopPropagation(); n.preventDefault(); f.onClose(!1) }); h.on(n.Events.onTouchStartAndClick, function (t) { var i; if (c) { if (f.isOkClicked = !0, r.setBusy(!0), i = f.saveParameters(), !i) { r.setBusy(!1); return } f.pi.setAD_PInstance_ID(0); f.pi.setPageNo(1); f.parent.getFileType() ? f.pi.setFileType(f.parent.getFileType()) : f.pi.setFileType(n.ProcessCtl.prototype.REPORT_TYPE_PDF); f.pi.setIsBackground(f.parent.isBackground()); f.parameterList = i; f.parent.onProcessDialogClosed(f.isOkClicked, f.parameterList) } else { if (t.stopPropagation(), t.preventDefault(), i = f.saveParameters(), !i) return; f.parameterList = i; f.onClose(!0, i) } }); this.setHeights = function () { }; this.disposeComponent = function () { o.off(n.Events.onTouchStartOrClick); h.off(n.Events.onTouchStartOrClick); e.dialog("destroy"); e.remove(); f = null; this.gridFields.length = 0; this.gridFields = null; this.depOnFieldColumn.length = 0; this.depOnFieldColumn - null; this.depOnField.length = 0; this.depOnField = null; this.vEditors.length = 0; this.vEditors2.length = 0; this.mFields.length = 0; this.mFields2.length = 0; this.parent = null; this.parameterList = null; this.pi = null; this.addLine = null; this.addFields = null; this.addButtons = null; this.showDialog = null; this.onClose = null; this.isOkClicked = null; e = l = a = y = w = s = h = o = null } } i.prototype.initDialog = function (i) { for (var c, o, a, r, l, h, f, s, u = null, e = 0, v = i.length; e < v; e++) { for (u = new n.GridField(i[e]), this.addLine(), this.mFields.push(u), c = u.getDependentOn(!1), o = 0; o < c.length; o++)this.depOnField.push(u), this.depOnFieldColumn.push(c[o]); a = n.VControlFactory.getLabel(u); r = n.VControlFactory.getControl(null, u, !1); r && (s = u.getDefault(n.context, this.windowNo), r.setValue(s), r.addVetoableChangeListener(this), u.getDisplayType() == n.DisplayType.AmtDimension && (r.hideButton(!1), r.setReadOnlyTextbox(!1), r.getControl().css("width", "100%"))); u.setPropertyChangeListener(r); this.vEditors.push(r); this.addFields(a, r); e == 0 && r && r.setDefaultFocus(!0); u.getIsRange() ? (this.addLine(), l = {}, t.extend(!0, l, i[e]), h = new n.GridField(l), this.mFields2.push(h), f = n.VControlFactory.getControl(null, h, !1), f && (s = h.getDefault2(n.context, this.windowNo), f.setValue(s), f.addVetoableChangeListener(this), u.getDisplayType() == n.DisplayType.AmtDimension && (f.hideButton(!1), f.setReadOnlyTextbox(!1), f.getControl().css("width", "100%"))), this.vEditors2.push(f), this.addFields(null, f)) : (this.mFields2.push(null), this.vEditors2.push(null)) } return this.addButtons(), !0 }; i.prototype.vetoablechange = function (t) { var f, r, o, c, s, i, l, u, h, e; for (console.log(t), f = t.newValue == null ? "" : t.newValue.toString(), r = t.propertyName, i = 0; i < this.mFields.length; i++)if (this.mFields[i].getColumnName().toLower() == r.toLower()) if (o = this.vEditors[i], o instanceof n.Controls.IControl && (c = this.mFields[i].getIsEditable(!0), o.setReadOnly(c)), this.mFields[i].getDisplayType() == n.DisplayType.YesNo) { f.toString() == "Y" || f.toString() == "N" ? n.Env.getCtx().setWindowContext(this.windowNo, r, f.toString()) : n.Env.getCtx().setWindowContext(this.windowNo, r, f.toString().toLowerCase() == "true" ? "Y" : "N"); break } else { n.Env.getCtx().setWindowContext(this.windowNo, r, f); break } if (this.depOnFieldColumn.indexOf(r) !== -1) for (s = this.getDependantFields(r), i = 0, l = s.length; i < l; i++)if (u = s[i], u != null) if (r == "M_Product_ID" && (u.getColumnName() == "M_Locator_ID" || u.getColumnName() == "M_LocatorTo_ID")) continue; else { if (h = u.getDefault(n.Env.getCtx(), this.windowNo), h == null) for (e = 0; e < this.vEditors.length; e++)if (this.vEditors[e].colName == u.getColumnName()) { this.vEditors[e].ctrl[0].selectedIndex = -1; break } u.refreshLookup(); u.setValue(h, !0) } }; i.prototype.getDependantFields = function (n) { var i = [], r, t; if (this.depOnFieldColumn.indexOf(n) != -1) for (r = this.depOnFieldColumn.length, t = 0; t < r; t++)this.depOnFieldColumn[t].equals(n) && i.indexOf(this.depOnField[t]) < 0 && i.push(this.depOnField[t]); return i }; i.prototype.saveParameters = function () { for (var r = new StringBuilder, p = this.mFields.length, t = 0, u, w, c, l, a, v, y, i, h, o, t = 0; t < p; t++)u = this.mFields[t], u.getIsMandatory(!0) && (w = this.vEditors[t], c = w.getValue(), c == null || c.toString().length == 0 ? (u.setInserting(!0), u.setError(!0), r.length() > 0 && r.append(", "), r.append(u.getHeader())) : u.setError(!1), l = this.vEditors2[t], l != null && (a = l.getValue(), v = this.mFields2[t], a == null || a.toString().length == 0 ? (u.setInserting(!0), v.setError(!0), r.length() > 0 && r.append(", "), r.append(u.getHeader())) : v.setError(!1))); if (r.length() != 0) return n.ADialog.error("FillMandatory", !0, r.toString()), !1; for (y = [], i = {}, t = 0; t < p; t++) { var f = this.vEditors[t], e = this.vEditors2[t], s = f.getValue(); (f.getDisplayType() == n.DisplayType.AmtDimension && (s = f.getText()), h = null, e != null && (h = e.getValue(), e.getDisplayType() == n.DisplayType.AmtDimension && (s = e.getText())), s !== null && s !== "" || h !== null && h !== "") && (i = {}, o = this.mFields[t], i.Name = o.getColumnName(), i.DisplayType = o.getDisplayType(), i.Result = s, i.Result2 = h, i.LoadRecursiveData = o.getLoadRecursiveData(), i.ShowChildOfSelected = o.getShowChildOfSelected(), i.AD_Column_ID = o.getAD_Column_ID(), i.Info = f.getDisplay(), f.getDisplayType() == n.DisplayType.MultiKey && (i.Info = f.lastDisplay), e != null && (i.Info_To = e.getDisplay()), y.push(i)) } return y }; i.prototype.dispose = function () { this.disposeComponent() }; n.ProcessParameter = i }(VIS, jQuery), function (n, t) { var i = n.Application.contextUrl, u = i + "JsonData/GetGridWindow", f = i + "JsonData/InsertOrUpdateWRecords", e = i + "JsonData/DeleteWRecords", o = i + "JsonData/GetWindowRecords", s = i + "JsonData/GetWindowRecordsForTreeNode", h = i + "JsonData/GetFormInfo", c = i + "JsonData/GetProcessInfo", r = i + "JsonData/Process", l = i + "JsonData/ExecuteProcess", a = i + "JsonData/UpdateOrInsertPersonalLock", w = i + "JsonData/JDataSet", b = i + "JsonData/ExecuteNonQuer", v = i + "JsonData/GetCardViewDetail", y = i + "JsonData/GetLocLatLng", p = function () { function p(n, r) { t.ajax({ url: i + "JsonData/UpdateCtx", type: "POST", datatype: "json", contentType: "application/json; charset=utf-8", async: !0, data: JSON.stringify({ dCtx: n }) }).done(function (n) { r && r(n) }) } function w(n, i, r, u, f) { var e = { AD_Window_ID: n, AD_Tab_ID: i, AD_CardView_ID: r, SQL: u }; t.ajax({ url: v, type: "POST", datatype: "json", contentType: "application/json; charset=utf-8", async: !0, data: JSON.stringify(e) }).done(function (n) { if (f) { var t = null; n && (t = n, typeof n == "string" && (t = JSON.parse(n))); f(t) } }) } function b(n, i) { t.ajax({ url: u, type: "GET", datatype: "json", async: !0, data: n }).done(function (n) { i && i(n) }) } function k(n) { var i = null; return t.ajax({ url: f, type: "POST", datatype: "json", contentType: "application/json; charset=utf-8", async: !1, data: JSON.stringify(n) }).done(function (n) { i = n }), i } function d(n) { return new Promise(function (i) { var r = null; return t.ajax({ url: e, type: "POST", datatype: "json", contentType: "application/json; charset=utf-8", data: JSON.stringify(n) }).done(function (n) { r = n; i(r) }), r }) } function g(i, r, u, f, e, s, h) { var c = { fields: r, sqlIn: i, rowCount: u, sqlCount: f, AD_Table_ID: e, obscureFields: s }; t.ajax({ url: o, type: "POST", datatype: "json", contentType: "application/json; charset=utf-8", async: !0, data: JSON.stringify(c) }).done(function (t) { if (h) { var i = JSON.parse(t), r = null, u = null, f = null; i && (r = (new n.DB.DataSet).toJson(i.Tables), u = i.LookupDirect, f = i.CardViewTpl); h(r, u, f) } }) } function nt(i, r, u, f, e, o, h, c) { var l = { fields: r, sqlIn: i, rowCount: u, sqlCount: f, AD_Table_ID: e, treeID: o, treeNodeID: h }; t.ajax({ url: s, type: "POST", datatype: "json", contentType: "application/json; charset=utf-8", async: !0, data: JSON.stringify(l) }).done(function (t) { if (c) { var i = null; t && (i = (new n.DB.DataSet).toJson(t)); c(i) } }) } function tt(r, u, f) { var e = null; return t.ajax({ url: i + "JsonData/GetWindowRecord", type: "POST", datatype: "json", contentType: "application/json; charset=utf-8", async: !1, data: JSON.stringify({ sql: r, fields: u, obscureFields: f }) }).done(function (t) { t && (e = (new n.DB.DataReader).toJson(t)) }), e } function it(n, i, r, u) { var f = null, e = { AD_User_ID: n, AD_Table_ID: i, Record_ID: r, locked: u }; return t.ajax({ url: a, type: "POST", datatype: "json", contentType: "application/json; charset=utf-8", async: !1, data: JSON.stringify(e) }).done(function (n) { f = n }), f } function rt(i, r) { var f = null, u; return i.indexOf(n.Application.contextUrl) == -1 && (i = n.Application.contextUrl + i), u = r, (typeof r != "object" || r === null || Array.isArray(r)) && (u = { fields: r }), t.ajax({ url: i, type: "POST", datatype: "json", contentType: "application/json; charset=utf-8", async: !1, data: JSON.stringify(u) }).done(function (n) { n && (f = JSON.parse(n)) }).fail(function (n, t, i) { alert(i) }), f } function ut(n, i) { t.ajax({ url: h, type: "GET", datatype: "json", async: !0, data: n }).done(function (n) { i && i(n) }) } function ft(n, i) { t.ajax({ url: c, type: "GET", datatype: "json", async: !0, data: n }).done(function (n) { i && i(n) }) } function et(n, i) { var f = i ? !0 : !1, u = null; return t.ajax({ url: r, type: "POST", datatype: "json", async: f, data: n }).done(function (n) { u = n; i && i(n) }), u } function ot(n, i) { t.ajax({ url: r, type: "GET", datatype: "json", async: !1, data: n }).done(function (n) { i && i(n) }) } function st(n, i) { var u = i ? !0 : !1, r = null; return t.ajax({ url: l, type: "POST", datatype: "json", contentType: "application/json; charset=utf-8", async: u, data: JSON.stringify(n) }).done(function (n) { r = n; i && i(n) }), r } function ht(n, i, r) { var f = r ? !0 : !1, u = null; return t.ajax({ url: n, type: "POST", datatype: "json", contentType: "application/json; charset=utf-8", async: f, data: JSON.stringify(i) }).done(function (n) { n && (u = n, typeof n == "string" && (u = JSON.parse(n))); f && r(u) }), u } function ct(n, i, r) { var f = r ? !0 : !1, u = null; return t.ajax({ url: n, type: "POST", datatype: "json", contentType: "application/json; charset=utf-8", async: f, data: JSON.stringify(i) }).done(function (n) { n && (u = n, typeof n == "string" && (u = JSON.parse(n))); f && r(u) }), u } function lt(i, r) { t.ajax({ url: n.Application.contextUrl + "Chat/LoadChat", data: i, type: "GET", cache: !1, datatype: "Json", success: function (n) { r && r(n) } }) } function at(i) { t.ajax({ url: n.Application.contextUrl + "Chat/SaveChat", type: "POST", dataType: "Json", data: i, success: function (n) { n ? console.log("Chat Saved") : console.log("Chat Not Saved") }, error: function () { console.log("Chat Not Saved") } }) } function vt(n, r) { var u = null, f = r ? !0 : !1; return t.ajax({ url: i + "Tree/GetTreeAsString", async: f, data: n }).done(function (n) { u = n; r && r(n) }), u } function yt(i, r, u, f, e) { var o, s; i == 0 ? (o = n.Application.contextUrl + "Subscribe/Subscribe", s = { AD_Window_ID: r, Record_ID: u, AD_Table_ID: f }) : (o = n.Application.contextUrl + "Subscribe/UnSubscribe", s = { AD_Window_ID: r, Record_ID: u, AD_Table_ID: f }); t.ajax({ url: o, type: "GET", dataType: "Json", data: s, success: function (t) { t == 0 ? i == 0 ? n.ADialog.error("SubscriptionFailed") : n.ADialog.error("UnSubscriptionFailed") : t == 2 && n.ADialog.info("AlreadyUnsubscribed"); e() }, error: function (t) { n.ADialog.error(n.Msg.getMsg("Error") + t.statusText) } }) } return { insertOrUpdateWRecord: k, getWindowJString: b, deleteWRecords: d, getWindowRecords: g, getWindowRecordsForTreeNode: nt, getWindowRecord: tt, updateInsertLocks: it, getFormDataString: ut, getProcessDataString: ft, process: et, processAsyncFalse: ot, executeProcess: st, updateClientCtx: p, getJSONRecord: rt, getJSONData: ht, subscribeUnsubscribeRecords: yt, getChatRecords: lt, saveChat: at, getTreeAsString: vt, getCardViewInfo: w, postJSONData: ct } }(); n.dataContext = p }(VIS, jQuery); VIS.Model = VIS.Model || {}, function (n) { function t(t) { t || (t = "CalloutEngine"); this.log = n.Logging.VLogger.getVLogger(t) } var i = !1; t.prototype.isCalloutActive = function () { return i }; t.prototype.setCalloutActive = function (n) { i = n }; t.prototype.start = function (t, i, r, u, f, e, o) { var c, l, s, h; if (i == null || i.length == 0) throw new Error("No Method Name"); if (c = "", l = i + " - " + f.getColumnName() + "=" + e + " (old=" + o + ") {active=" + this.isCalloutActive() + "}", this.isCalloutActive() || this.log.info(l.toString()), s = this[i], s == null && (i = i.charAt(0).toUpperCase() + i.substr(1), s = this[i], !s)) throw new Error("Method not found: " + i); if (h = s.length, !(h == 5 || h == 6)) throw new Error("Method " + i + " has invalid no of arguments: " + h); try { c = h == 6 ? this[i](t, r, u, f, e, o) : this[i](t, r, u, f, e) } catch (a) { this.setCalloutActive(!1); this.log.log(n.Logging.Level.SEVERE, "start: " + i, a); c = a.toString() } return c }; t.prototype.DateAcct = function (n, t, i, r, u, f) { return this.isCalloutActive() ? "" : u ? (i.setValue("DateAcct", u), i.getTableName() == "C_BankStatementLine" && i.setValue("ValutaDate", u), this.setCalloutActive(!1), n = t = i = r = u = f = null, "") : "" }; t.prototype.Rate = function (t, i, r, u, f, e) { if (this.isCalloutActive() || f == null) return ""; this.setCalloutActive(!0); var s = f, o = n.Env.ZERO; return n.Utility.Util.getValueOfDouble(s) != 0 && (o = (1 / s).toFixed(12)), u.getColumnName().toString() == "MultiplyRate" ? r.setValue("DivideRate", o) : r.setValue("MultiplyRate", o), this.log.info(u.getColumnName() + "=" + s + " => " + o), this.setCalloutActive(!1), t = i = r = u = f = e = null, "" }; n.Model.CalloutEngine = t; n.CalloutEngine = t }(VIS, jQuery), function (n, t) { function i() { function nr(n, i, r) { var u = null; return t.ajax({ url: di, type: "POST", datatype: "json", contentType: "application/json; charset=utf-8", async: i, data: JSON.stringify(n) }).done(function (n) { u = n; r && r(n) }), u } function tr(n) { si = n; rr() } function y() { var r = t(window).width(), e = t(".row.scrollerHorizontal > div").length, s; e = e - 1; t(".scrollerHorizontal").width(r); var l = r / e - 20, i = parseInt(l), o = {}; if (n.Application.isRTL && (t("#welcomeScreen").css({ right: "0", left: "auto" }), t(".vis-welcomeScreenFeeds > .row").css("margin-right", "0px")), r >= 1366 && (t("#workflowActivity").css("display") == "none" ? (t("#welcomeScreen").width(i), o = n.Application.isRTL ? { width: i, right: i + 20 } : { width: i, left: i + 20 }, t("#fllupsScreen").animate(o, 200, function () { }), o = n.Application.isRTL ? { width: i, right: i * 2 + 40 } : { width: i, left: i * 2 + 40 }, t("#favLinks").animate(o, 200, function () { })) : t("#workflowActivity").css("display") == "block" && (s = r + i + 20, t(".scrollerHorizontal").width(s), ot.scroll(), t("#welcomeScreen").width(i), o = n.Application.isRTL ? { width: i, right: i + 20 } : { width: i, left: i + 20 }, t("#workflowActivity").animate(o, 200, function () { pt.scroll() }), o = n.Application.isRTL ? { width: i, right: i * 2 + 40 } : { width: i, left: i * 2 + 40 }, t("#fllupsScreen").animate(o, 200, function () { }), o = n.Application.isRTL ? { width: i, right: i * 3 + 60 } : { width: i, left: i * 3 + 60 }, t("#favLinks").animate(o, 200, function () { })), t("#vis_userDate").show()), r > 1024 && r < 1366) t("#workflowActivity").css("display") == "none" ? (n.Application.isRTL ? (t("#fllupsScreen").css("right", i + 20), t("#favLinks").css("right", i * 2 + 40)) : (t("#fllupsScreen").css("left", i + 20), t("#favLinks").css("left", i * 2 + 40)), t("#welcomeScreen,#fllupsScreen,#favLinks").width(i)) : t("#workflowActivity").css("display") == "block" && (s = r + i + 20, t(".scrollerHorizontal").width(s), ot.scroll(), t("#welcomeScreen,#fllupsScreen,#favLinks,#workflowActivity").width(i), n.Application.isRTL ? (t("#workflowActivity").css("right", i + 20), t("#fllupsScreen").css("right", i * 2 + 40), t("#favLinks").css("right", i * 3 + 60)) : (t("#workflowActivity").css("left", i + 20), t("#fllupsScreen").css("left", i * 2 + 40), t("#favLinks").css("left", i * 3 + 60))), t("#vis_userDate").show(); else if (r >= 1e3 && r <= 1024) { if (t("#workflowActivity").css("display") == "none") { var h = r / 2, u = parseInt(h), c = u * e; t(".scrollerHorizontal").width(c); n.Application.isRTL ? (t("#fllupsScreen").css("right", u), t("#favLinks").css("right", u * 2)) : (t("#fllupsScreen").css("left", u), t("#favLinks").css("left", u * 2)); t("#welcomeScreen,#fllupsScreen,#favLinks").width(u - 20) } else if (t("#workflowActivity").css("display") == "block") { e = e + 1; var h = r / 2, u = parseInt(h), c = u * e; t(".scrollerHorizontal").width(c); ot.scroll(); t("#welcomeScreen,#fllupsScreen,#favLinks,#workflowActivity").width(u - 20); n.Application.isRTL ? (t("#workflowActivity").css("right", u), t("#fllupsScreen").css("right", u * 2), t("#favLinks").css("right", u * 3)) : (t("#workflowActivity").css("left", u), t("#fllupsScreen").css("left", u * 2), t("#favLinks").css("left", u * 3)) } t("#vis_userDate").show() } else if (r < 1e3) { if (t("#workflowActivity").css("display") == "none") { var h = r * e, u = parseInt(h), f = r; t(".scrollerHorizontal").width(u); n.Application.isRTL ? (t("#fllupsScreen").css("right", f), t("#favLinks").css("right", f * 2)) : (t("#fllupsScreen").css("left", f), t("#favLinks").css("left", f * 2)); t("#welcomeScreen,#fllupsScreen,#favLinks").width(f - 20) } else if (t("#workflowActivity").css("display") == "block") { e = e + 1; var h = r * e, u = parseInt(h), f = r; t(".scrollerHorizontal").width(u); ot.scroll(); t("#welcomeScreen,#fllupsScreen,#favLinks,#workflowActivity").width(f - 20); n.Application.isRTL ? (t("#workflowActivity").css("right", f), t("#fllupsScreen").css("right", f * 2), t("#favLinks").css("right", f * 3)) : (t("#workflowActivity").css("left", f), t("#fllupsScreen").css("left", f * 2), t("#favLinks").css("left", f * 3)) } t("#vis_userDate").hide() } } function ir() { var i = new Date, t = i.getHours(); return t < 12 ? n.Msg.getMsg("GoodMorning") : t < 17 ? n.Msg.getMsg("GoodAfternoon") : n.Msg.getMsg("GoodEvening") } function rr() { si.load(n.Application.contextUrl + "Home/Home", function () { function cr(i, r, u) { sr.show(); er = !0; var f = n.Application.contextUrl + "Home/GetJSONFllups"; t.ajax({ url: f, data: { fllPageSize: i, fllPage: r, isRef: u }, type: "GET", cache: !1, datatype: "json", success: function (i) { var r = JSON.parse(i), f = 0, o = "", s = "", h = "", a, c, l, e; if (r.lstFollowups.length > 0) { u && di.text(r.FllCnt); for (a in r.lstFollowups) { if (c = r.lstFollowups[f].ChatID + "-" + r.lstFollowups[f].RecordID + "-" + r.lstFollowups[f].SubscriberID + "-" + r.lstFollowups[f].TableID + "-" + r.lstFollowups[f].WinID + "-" + r.lstFollowups[f].TableName, r.lstFollowups[f].Cdate != null && r.lstFollowups[f].Cdate != "" && (l = new Date(r.lstFollowups[f].Cdate), h = Globalize.format(l, "F", Globalize.cultureSelector)), r.lstFollowups[f].AD_Image_ID == 0) s = "<i data-fll='UID' data-UID='" + r.lstFollowups[f].AD_User_ID + "' class='fa fa-user'><\/i>"; else for (e in r.lstUserImg) if (r.lstUserImg[e].AD_Image_ID == r.lstFollowups[f].AD_Image_ID) { s = r.lstUserImg[e].UserImg != "NoRecordFound" && r.lstUserImg[e].UserImg != "FileDoesn'tExist" && r.lstUserImg[e].UserImg != null ? "<div class='vis-feedimgwrap'  data-fll='UID' data-UID='" + r.lstFollowups[f].AD_User_ID + "'><img data-fll='UID' data-UID='" + r.lstFollowups[f].AD_User_ID + "' alt='" + n.Msg.getMsg("UserImage") + "' title='" + n.Msg.getMsg("UserImage") + "' class='userAvatar-Feeds' src='" + n.Application.contextUrl + r.lstUserImg[e].UserImg + "?" + new Date(t.now()).getSeconds() + "'/><\/div>" : "<i data-fll='UID' data-UID='" + r.lstFollowups[f].AD_User_ID + "' class='fa fa-user'><\/i>"; break } o += "<div id=" + c + " data-fll='divfllups' class='vis-feedContainer'><div class='vis-feedTitleBar'><h3> " + r.lstFollowups[f].WinName + " : " + r.lstFollowups[f].Identifier + " <\/h3><div class='vis-feedTitleBar-buttons'><ul><li> <a href='javascript:void(0)'  data-fll='azoomfllups'  title='" + n.Msg.getMsg("ViewFollowups") + "'  class='vis vis-find'><\/a><\/li><li> <a href='javascript:void(0)'  data-fll='asubscribefllups'  title='" + n.Msg.getMsg("UnsubscribeFollowups") + "' class='fa fa-rss'><\/a><\/li><\/ul> <\/div><\/div><div id='divfllcmntdata" + r.lstFollowups[f].ChatID + "' data-fll='fll-cmnt' class='vis-feedDetails'><div class='vis-feedDetails-cmnt' data-fll='fll-cmnt'>" + s + "<p> <strong data-fll='UID' data-UID='" + r.lstFollowups[f].AD_User_ID + "'>"; o += r.lstFollowups[f].AD_User_ID == n.Env.getCtx().getAD_User_ID() ? n.Msg.getMsg("Me") + " <\/strong> <br />" : r.lstFollowups[f].Name + "<\/strong> <br />"; o += n.Utility.encodeText(r.lstFollowups[f].ChatData) + "<\/p><p class='vis-feedDateTime'>" + h + "<\/p><\/div><\/div><a id='divfllvm_" + r.lstFollowups[f].ChatID + "'  data-fll='viewmorefllupscmnt' href='javascript:void(0)' class='vis-viewMoreComments'><span class='vis-feedIcons vis-icon-viewMoreComments'><\/span>" + n.Msg.getMsg("ViewMoreComments") + "...<\/a><a id='divfllvl_" + r.lstFollowups[f].ChatID + "' style='display:none;'  data-fll='viewlessfllupscmnt' href='javascript:void(0)' class='vis-viewMoreComments'><span class='vis-feedIcons vis-icon-viewMoreComments'><\/span>" + n.Msg.getMsg("ViewLessComments") + "...<\/a> <div class='clearfix'><\/div> <div id=" + r.lstFollowups[f].ChatID + " class='vis-feedMessage'> <input id='txtFllCmnt" + r.lstFollowups[f].ChatID + "' data-fll='txtcmntfll' placeholder='" + n.Msg.getMsg("TypeMessage") + "' type='text' value='' /> <span  id='btnFllCmnt" + r.lstFollowups[f].ChatID + "' data-fll='btncmntfll' title='" + n.Msg.getMsg("PostMessage") + "'  class='vis vis-sms' ><\/span> <div class='clearfix'><\/div> <\/div><\/div> "; f++ } ut.append(o) } else br == !1 && (n.Application.isRTL ? ut.append("<p style='margin-top: 200px;text-align: center '>" + n.Msg.getMsg("VIS_NotSubscribedYet") + "<\/p>") : ut.append("<p style='margin-top: 200px;text-align: center '>" + n.Msg.getMsg("VIS_NotSubscribedYet") + "<\/p>")); er = !1; ai = !0; sr.hide() }, error: function () { ai = !0 } }) } function kr(i, r, u) { var f = n.Application.contextUrl + "Home/GetJSONFllupsCmnt/"; t.ajax({ url: f, data: { FllupsID: i, fllCmntPageSize: r, fllCmntPage: u }, type: "GET", cache: !1, datatype: "json", success: function (i) { var r = JSON.parse(i), u = 0, e = "", c = "", a = r.lstFollowups[u].ChatID, s = "", o, l, f, h; for (o in r.lstFollowups) { if (r.lstFollowups[o].Cdate != null && r.lstFollowups[o].Cdate != "" && (l = new Date(r.lstFollowups[o].Cdate), c = Globalize.format(l, "F", Globalize.cultureSelector)), r.lstFollowups[u].AD_Image_ID == 0) s = "<i data-fll='UID' data-UID='" + r.lstFollowups[u].AD_User_ID + "' class='fa fa-user'><\/i>"; else for (f in r.lstUserImg) if (r.lstUserImg[f].AD_Image_ID == r.lstFollowups[u].AD_Image_ID) { s = r.lstUserImg[f].UserImg != "NoRecordFound" && r.lstUserImg[f].UserImg != "FileDoesn'tExist" && r.lstUserImg[f].UserImg != null ? "<div class='vis-feedimgwrap' data-fll='UID' data-UID='" + r.lstFollowups[u].AD_User_ID + "'><img  alt='" + n.Msg.getMsg("UserImage") + "'  title='" + n.Msg.getMsg("UserImage") + "'  class='userAvatar-Feeds' src='" + r.lstUserImg[f].UserImg + "?" + new Date(t.now()).getSeconds() + "'/><\/div>" : "<i  data-fll='UID' data-UID='" + r.lstFollowups[u].AD_User_ID + "'    class='fa fa-user'><\/i>"; break } e += "<div class='vis-feedDetails-cmnt'  data-fll='fll-cmnt'>" + s + "<p> <strong  data-fll='UID' data-UID='" + r.lstFollowups[u].AD_User_ID + "'>"; e += r.lstFollowups[u].AD_User_ID == n.Env.getCtx().getAD_User_ID() ? n.Msg.getMsg("Me") + " <\/strong> <br />" : r.lstFollowups[u].Name + "<\/strong> <br />"; e += n.Utility.encodeText(r.lstFollowups[u].ChatData) + "<\/p><p class='vis-feedDateTime'>" + c + "<\/p><\/div>"; u++ } h = t("#divfllcmntdata" + a); h.html(""); h.append(e) }, error: function () { console.log("Error") } }) } function lr(i, r) { var u = n.Application.contextUrl + "Home/PostFllupsCmnt/"; t.ajax({ url: u, data: { fllChatID: si, fllSubscriberID: fr, cmntTxt: i }, type: "POST", cache: !1, datatype: "json", success: function (u) { var s = new Date, h = Globalize.format(s, "F", Globalize.cultureSelector), f = u, c = n.context.getContext("##AD_User_Name"), e = "", o; e = f !== null ? f != "NoRecordFound" && f != "FileDoesn'tExist" ? "<div class='vis-feedimgwrap'  data-fll='UID' data-UID='" + n.Env.getCtx().getAD_User_ID() + "' ><img data-fll='UID' data-UID='" + n.Env.getCtx().getAD_User_ID() + "'  alt='" + n.Msg.getMsg("UserImage") + "'  class='userAvatar-Feeds' src='" + f + "?" + new Date(t.now()).getSeconds() + "' /><\/div>" : "<i data-fll='UID' data-UID='" + n.Env.getCtx().getAD_User_ID() + "' class='fa fa-user'><\/i>" : "<i data-fll='UID' data-UID='" + n.Env.getCtx().getAD_User_ID() + "' class='fa fa-user'><\/i>"; o = "<div class='vis-feedDetails-cmnt' data-fll='fll-cmnt'>" + e + "<p> <strong  data-fll='UID' data-UID='" + n.Env.getCtx().getAD_User_ID() + "'>" + n.Msg.getMsg("Me") + "<\/strong><br />" + n.Utility.encodeText(i) + "<\/p><p class='vis-feedDateTime'>" + h + "<\/p><\/div>"; r.append(o) }, error: function () { console.log("Error") } }) } var or, tr, ai; et = !1; at = !1; k = !1; f = !1; l = t("#sAlrtTxtType"); h = t("#hAlrtTxtTypeCount"); b = t("#ulHomeTabMenu"); wt = t("#divTabMenuDataLoder"); c = t("#spanWelcomeTabtopHdr"); wi = t("#searchData"); ot = t("#dataContainer"); ut = t("#fllupsList"); pt = t("#workflowActivityData"); vi = t("#userLinks-List"); yi = t("#userFavs-List"); a = t("#hlnkTabDataRef"); i = t("#welcomeScreenFeedsList"); pi = t("#favLinks"); r = 1; w = t("#workflowActivity"); gt = t("#divTabMenuDataLoder"); vt = t("#workflowActivityDetails"); ft = t("#hWelcomeScreenSwapHdr"); v = t("#sNewNts"); p = t("#WFSearchshow"); tt = t("#divNoticeCount"); rt = t("#divRequestCount"); ni = t("#divNotesCount"); ti = t("#divAptCount"); ri = t("#divKPI"); e = 10; u = 0; o = 0; s = 0; y(); t(window).resize(y); t("div.vis-workflowActivityTitleBar-buttons ul li .vis-icon-check").on(n.Events.onTouchStartOrClick, function () { t("#workflowActivity").hide(); t(".vis-activityContainer").removeClass("vis-activeFeed"); y(); ot.scroll() }); t("#btnWFAClose").on(n.Events.onTouchStartOrClick, function () { t("#workflowActivity").hide(); t(".vis-activityContainer").removeClass("vis-activeFeed"); y(); ot.scroll() }); n.changeUserImage(); t("#userFav-Tab").click(function () { t("#userLinks div").removeClass("row userLinks_activeTab"); t("#userLinks div").addClass("row userLinks_inactiveTab"); t("#userFavs div").removeClass("row userFavs_inactiveTab"); t("#userFavs div").addClass("row userFavs_activeTab"); t("#userLinks-List").hide("fast"); t("#userFavs-List").show("fast", function () { setTimeout(function () { }, 0) }) }); t("#userLinks-Tab").click(function () { t("#userFavs div").removeClass("row userFavs_activeTab"); t("#userFavs div").addClass("row userFavs_inactiveTab"); t("#userLinks div").removeClass("row userLinks_inactiveTab"); t("#userLinks div").addClass("row userLinks_activeTab"); t("#userFavs-List").hide("fast"); t("#userLinks-List").show("fast", function () { setTimeout(function () { }, 0) }) }); n.shortcutMgr.init(t("#userLinks-List"), t("#userFavs-List")); t(".vis-welcomeScreenFeeds").hide(); t(".vis-icon-userfeeds").off("click"); t(".vis-icon-userfeeds").on("click", function () { t(".vis-welcomeScreen-Data").hide("slow"); t(".vis-welcomeScreenFeeds").show("fast") }); t(".vis-welcomeScreenTab-notificationBubbles").on("click", function () { return !1 }); or = ir(); t("#vis-userGreeting").text(or); a.on("click", function () { if (f = !0, et == !1 && r != hi) if (r == yt) d = 0, e = g, u = nt, s = 0, it(), ei(); else if (r == ui) y(), v.hide(), p.show(), l.empty(), l.append(n.Msg.getMsg("WorkflowActivities")), h.empty(), h.append(t("#divfActivity").html()), ft.empty(), ft.append(n.Msg.getMsg("Activity")), d = 0, e = g, u = nt, s = 0, st == null && (st = new n.wfActivity(i, vt, pt, i, p)), st.Load(!0); else if (r == ct) d = 0, e = g, u = nt, s = 0, it(), oi(); else if (r == bt) d = 0, e = g, u = nt, s = 0, WSP.wspHomeMgr.viewWSPHome(bt, f); else if (r == kt) d = 0, e = g, u = nt, s = 0, WSP.wspHomeMgr.viewWSPHome(kt, f); else { if (r == ci) return; r == ht ? (d = 0, e = g, u = nt, s = 0, it(), WSP.wspHomeMgr.viewWSPHome(ht, f)) : r == lt ? (d = 0, e = g, u = nt, s = 0, it(), WSP.wspHomeMgr.viewWSPHome(lt, f)) : r == fi && (w.hide(), y(), d = 0, e = g, u = nt, s = 0, it(), p.hide(), VADB.Apps.KpiHomeScreen(i, gt, v, w, vt, ft, ri)) } }); i.on("click", function (i) { var o = t(i.target).data("vishomercrd"), e; if (r == ct) { if (i.target.tagName === "SPAN" && o === "more") { if (t(i.target.parentNode.parentNode).data("vishomercrd") == "more-details") { var s = i.target.parentNode.parentNode.id, h = t("#snoticetitle_" + s), c = t("#snoticedesc_" + s), l = t("#snoticemore_" + s); l.hide(); h.hide(); c.show(); t("#snoticeless_" + s).show() } } else if (t(i.target.parentNode.parentNode).data("vishomercrd") == "more-details") { var s = i.target.parentNode.parentNode.id, h = t("#snoticetitle_" + s), c = t("#snoticedesc_" + s), l = t("#snoticemore_" + s); l.show(); h.show(); c.hide(); t("#snoticeless_" + s).hide() } if (o === "view") { var e = i.target.id, u = e.toString().split("|"), a = u[0], v = u[1], y = u[2], nt = u[3], f = new n.Query; f.addRestriction(v + "_ID", n.Query.prototype.EQUAL, n.Utility.Util.getValueOfInt(a)); n.viewManager.startWindow(y, f) } else if (o === "liview") { var e = i.target.firstChild.id, u = e.toString().split("|"), a = u[0], v = u[1], y = u[2], nt = u[3], f = new n.Query; f.addRestriction(v + "_ID", n.Query.prototype.EQUAL, n.Utility.Util.getValueOfInt(a)); n.viewManager.startWindow(y, f) } else if (o === "approve") e = i.target.id, li(e, !0); else if (o === "liapprove") e = i.target.firstChild.id, li(e, !0); else if (o === "lispecial") { var e = i.target.firstChild.id, u = e.toString().split("|"), p = u[0], w = u[1], b = u[2], f = new n.Query; f.addRestriction(w + "_ID", n.Query.prototype.EQUAL, n.Utility.Util.getValueOfInt(p)); n.viewManager.startWindow(b, f) } else if (o === "lispecial1") { var e = i.target.id, u = e.toString().split("|"), p = u[0], w = u[1], b = u[2], f = new n.Query; f.addRestriction(w + "_ID", n.Query.prototype.EQUAL, n.Utility.Util.getValueOfInt(p)); n.viewManager.startWindow(b, f) } } else if (r == yt) if (o === "view") { var e = i.target.id, u = e.toString().split("|"), k = u[0], d = u[1], g = u[2], f = new n.Query; f.addRestriction(d + "_ID", n.Query.prototype.EQUAL, n.Utility.Util.getValueOfInt(k)); n.viewManager.startWindow(g, f) } else if (o === "liview") { var e = i.target.firstChild.id, u = e.toString().split("|"), k = u[0], d = u[1], g = u[2], f = new n.Query; f.addRestriction(d + "_ID", n.Query.prototype.EQUAL, n.Utility.Util.getValueOfInt(k)); n.viewManager.startWindow(g, f) } }); tr = !0; i.bind("scroll", function () { if (t(this).scrollTop() + t(this).innerHeight() >= this.scrollHeight * .75 && tr) if (tr = !1, setTimeout(function () { tr = !0 }, 100), k = !0, f = !1, r == ui) if (o = parseInt(t("#divfActivity").html()), s = u * e, s <= o && st != null) u += 1, st.AppendRecord(u, e); else return; else if (r == ct) if (o = parseInt(tt.text()), s = u * e, u += 1, s <= o) oi(); else return; else if (r == yt) if (o = parseInt(rt.text()), s = u * e, u += 1, s <= o) ei(); else return; else if (r == ht && window.WSP) if (o = parseInt(ti.text()), s = u * e, u += 1, s <= o) WSP.wspHomeMgr.doScrollWSPHome(ht, u, e); else return; else if (r == lt && window.WSP) if (o = parseInt(ni.text()), s = u * e, s <= o) u += 1, WSP.wspHomeMgr.doScrollWSPHome(lt, u, e); else return }); var ar = t("#hlnkFllupsRef"), di = t("#follupsCount"), sr = t("#divFllMainLoder"), ki = "", vr = "", dt = "", yr = 0, gi = 10, nr = 1, ur = 0, hr = 0, pr = 10, wr = 0, si = 0, fr = 0, br = !1, rr = !1, er = !1; ut.on("click", function (i) { var u = t(i.target).data("fll"), f, e, o, c, s, r, h, l, a; if (u === "viewmorefllupscmnt") dt = i.target.parentNode.id, si = 0, fr = 0, si = i.target.parentNode.children[3].id, kr(dt, pr, wr), f = i.target.id, e = f.split("_"), t("#divfllvl_" + e[1]).show(), t("#" + f).hide(); else if (u === "viewlessfllupscmnt") dt = i.target.parentNode.id, si = 0, fr = 0, si = i.target.parentNode.children[3].id, f = i.target.id, e = f.split("_"), t("#divfllvm_" + e[1]).show(), o = t("#divfllcmntdata" + e[1]), c = o.find("div:last-child"), o.empty(), o.html(c), t("#" + f).hide(); else if (u === "azoomfllups") dt = i.target.parentNode.parentNode.parentNode.parentNode.parentNode.id, r = dt.toString().split("-"), s = new n.Query, s.addRestriction(r[5] + "_ID", n.Query.prototype.EQUAL, n.Utility.Util.getValueOfInt(r[1])), n.viewManager.startWindow(r[4], s); else if (u === "asubscribefllups") dt = i.target.parentNode.parentNode.parentNode.parentNode.parentNode.id, r = dt.toString().split("-"), t.ajax({ url: n.Application.contextUrl + "Subscribe/UnSubscribe", type: "GET", dataType: "Json", data: { AD_Window_ID: r[4], Record_ID: r[1], AD_Table_ID: r[3] }, success: function (i) { if (i == !1) alert(n.Msg.getMsg("UnSubscription Failed")); else { t("#" + dt).animate({ width: "100%", height: "132px", "margin-top": "-132px" }, 700, function () { t("#" + dt).remove() }); var r = di.text(); di.text(r - 1) } } }); else if (u === "btncmntfll") si = i.target.parentNode.id, FllupsData = t("#" + i.target.parentNode.parentNode.children[1].id), ki = t("#" + i.target.previousElementSibling.id), vr = t("#" + i.target.id), h = t(ki).val(), h !== "" && (l = new Date, a = Globalize.format(l, "F", Globalize.cultureSelector), lr(h, FllupsData), t(ki).val("")); else if (u == "UID") { var v = t(i.target).data("uid"), y = n.Env.getWindowNo(), p = new n.ContactInfo(v, y); p.show() } }); ut.on("keydown", function (n) { var u = t(n.target).data("fll"), i, r; u === "txtcmntfll" && (dt = n.target.parentNode.parentNode.id, si = n.target.parentNode.id, FllupsData = t("#" + n.target.parentNode.parentNode.children[1].id), ki = t("#" + n.target.id), i = t(ki).val(), i !== "" && i !== null && (r = n.charCode || n.keyCode, r === bi && (lr(i, FllupsData), t(ki).val("")))) }); ai = !0; ut.bind("scroll", function () { if (t(this).scrollTop() + t(this).innerHeight() >= this.scrollHeight * .75 && ai) { if (rr = !1, ai = !1, ur = di.text(), ur > gi) if (hr = nr * gi, nr += 1, hr <= ur) cr(gi, nr, rr); else { ai = !0; return } ai = !0 } }); ar.on("click", function () { er == !1 && (gi = 10, nr = 1, yr = di.text(), rr = !0, ut.empty(), cr(gi, nr, rr)) }); b.off("click"); ii(); window.WSP ? (at = !0, p.hide(), WSP.wspHomeMgr.initWSPHome(i, b, vt, pt, w, gt, ft, v, l, h, ti, ni)) : console.log("PleaseInstallWSPModule") }) } function ur() { return { activeTabType: r } } function ei() { wt.show(); et = !0; t.ajax({ url: n.Application.contextUrl + "Home/GetJSONHomeRequest", data: { pagesize: e, page: u, isTabDataRef: f }, type: "GET", datatype: "json", cache: !1, success: function (t) { var u = JSON.parse(t.data), c = "", e, p, v, y, s, l, a; if (u.length > 0) { r == yt && f && (o = parseInt(t.count), rt.empty(), rt.show(), h.empty(), rt.text(t.count), h.text(t.count)); for (e in u) p = "", (u[e].StartDate != null || u[e].StartDate != "") && (s = new Date(u[e].StartDate), p = Globalize.format(s, "d", Globalize.cultureSelector)), v = "", u[e].NextActionDate != null ? (s = new Date(u[e].NextActionDate), v = Globalize.format(s, "d", Globalize.cultureSelector)) : v = "&nbsp;-----------", y = "", (u[e].CreatedDate != null || u[e].CreatedDate != "") && (s = new Date(u[e].CreatedDate), y = Globalize.format(s, "F", Globalize.cultureSelector)), l = u[e].Summary, l.length > 80 && (l = l.substr(0, 80) + "..."), a = u[e].CaseType, a.length > 30 && (a = a.substr(0, 30) + "..."), c += "<div class='vis-activityContainer'><div class='vis-feedTitleBar'><h3>#" + u[e].DocumentNo + "<\/h3><div class='vis-feedTitleBar-buttons'><ul>", u[e].Name && u[e].Name.length > 0 && (c += "<li class='vis-home-request-BP'>" + u[e].Name + "<\/li>"), + "<li class='vis-home-request-BP'>" + u[e].Name + "<\/li>", c += "<li data-vishomercrd='liview'><a href='javascript:void(0)' data-vishomercrd='view' id=" + u[e].R_Request_ID + "|" + u[e].TableName + "|" + u[e].AD_Window_ID + "  title='" + n.Msg.getMsg("View") + "'  class='vis vis-find'><\/a><\/li><\/ul><\/div><\/div><div  class='vis-feedDetails vis-pt-0 vis-pl-0'><div class='vis-table-request'><ul><li><span>" + n.Msg.getMsg("Priority") + ":<\/span><br>" + u[e].Priority + "<\/li><li><span>" + n.Msg.getMsg("Status") + ":<\/span><br>" + u[e].Status + "<\/li><li><span>" + n.Msg.getMsg("NextActionDate") + ":<\/span><br>" + v + "<\/li><\/ul><\/div><p class='vis-maintain-customer-p'><strong>" + n.Utility.encodeText(a) + " <\/strong><br /><span>" + n.Msg.getMsg("Message") + ":<\/span><br>" + n.Utility.encodeText(l) + "<\/p><p class='vis-feedDateTime'  style=' width: 69%; margin-right: 10px;'>" + y + "<\/p><\/div><\/div>" } else i.find(".vis-table-request").length == 0 && k == !1 && (c = n.Application.isRTL ? "<p style=' margin-top:200px;text-align: center'>" + n.Msg.getMsg("NoRecordFound") + "<\/p>" : "<p style=' margin-top:200px;text-align: center'>" + n.Msg.getMsg("NoRecordFound") + "<\/p>", rt.empty(), h.empty(), rt.text(0), rt.hide(), h.text(0)); et = !1; ii(); r == yt && i.append(c); wt.hide() } }) } function oi() { et = !0; wt.show(); t.ajax({ url: n.Application.contextUrl + "Home/GetJSONHomeNotice", data: { pagesize: e, page: u, isTabDataRef: f }, type: "GET", datatype: "json", success: function (t) { var u = JSON.parse(t.data), s = "", a = null, e, v, l, c, y; if (u.length > 0) { r == ct && f && (o = parseInt(t.count), tt.empty(), tt.show(), h.empty(), tt.text(t.count), h.text(t.count)); for (e in u) u[e].CDate != null && u[e].CDate != "" && (v = new Date(u[e].CDate), a = Globalize.format(v, "F", Globalize.cultureSelector)), l = "", c = n.Utility.encodeText(u[e].Title), c = ai(c), u[e].Description = ai(u[e].Description), y = u[e].Description, l = y.length <= 100 ? "<pre><strong style='color:#666666' data-vishomercrd='title' id='" + u[e].AD_Note_ID + "'>" + c + "<\/strong><\/pre>" : "<pre><strong  id='snoticetitle_" + u[e].AD_Note_ID + "'  style='color:#666666;' >" + c + "...<\/strong><strong id='snoticedesc_" + u[e].AD_Note_ID + "' style='display:none; color:#666666;'>" + n.Utility.encodeText(u[e].Description) + "...<\/strong> <span id='snoticemore_" + u[e].AD_Note_ID + "' data-vishomercrd='more' style='color:rgba(var(--v-c-primary), 1); float:right;height:20px'>" + n.Msg.getMsg("more") + "<\/span><span id='snoticeless_" + u[e].AD_Note_ID + "' data-vishomercrd='less' style='display:none; color:rgba(var(--v-c-primary), 1); float:right;height:20pxvis-feedTitleBar'>" + n.Msg.getMsg("less") + "<\/span><\/pre>", s += "<div data-vishomercrd='view-recrd-cntainer' id='divrecdcntnr_" + u[e].AD_Note_ID + "' class='vis-activityContainer'> <div class='vis-feedTitleBar'>", s += u[e].SpecialTable ? "<h3>" + n.Utility.encodeText(u[e].MsgType) + "<\/h3>" : "<h3>" + n.Utility.encodeText(u[e].MsgType) + "<\/h3>", s += " <div class='vis-feedTitleBar-buttons'>  <ul>", s += "<li data-vishomercrd='liapprove'><a href='javascript:void(0)' data-vishomercrd='approve'  id=" + u[e].AD_Note_ID + "  title='" + n.Msg.getMsg("Acknowledge") + "' class='vis vis-markx'><\/a><\/li><li data-vishomercrd='liview'><a href='javascript:void(0)' data-vishomercrd='view' id=" + u[e].AD_Note_ID + "|" + u[e].TableName + "|" + u[e].AD_Window_ID + "|" + u[e].Record_ID + " title='" + n.Msg.getMsg("View") + "' class='vis vis-find'><\/a><\/li><\/ul>  <\/div><\/div><div data-vishomercrd='more-details' id=" + u[e].AD_Note_ID + " class='vis-feedDetails'>" + l + " <p class='vis-feedDateTime'>" + n.Utility.encodeText(a) + "<\/p> <\/div> <\/div>" } else i.find(".vis-feedTitleBar").length == 0 && (s = n.Application.isRTL ? "<p style=' margin-top:200px;text-align: center'>" + n.Msg.getMsg("NoRecordFound") + "<\/p>" : "<p style=' margin-top:200px;text-align: center'>" + n.Msg.getMsg("NoRecordFound") + "<\/p>", r == ct && (tt.empty(), h.empty(), tt.hide(), tt.text(t.count), h.text(t.count))); et = !1; ii(); wt.hide(); r == ct && i.append(s) } }) } function li(i, r) { t.ajax({ url: n.Application.contextUrl + "Home/ApproveNotice", data: { Ad_Note_ID: i, isAcknowldge: r }, type: "POST", datatype: "json", success: function (n) { var r = JSON.parse(n); t("#divrecdcntnr_" + i).animate({ width: "0px", height: "132px", "margin-left": "800px" }, 700, "", function () { t("#divrecdcntnr_" + i).remove() }) } }) } function ii() { b.off("click"); b.on("click", function (ut) { var ot, wt; if (a.show(), i.css({ "margin-left": "auto", "margin-top": "auto" }), i.css({ "text-align": "", "margin-top": "" }), t(".vis-welcomeScreenTabMenu li").removeClass("vis-activeTab"), ut.target.nodeName == "LI" ? t(ut.target).addClass("vis-activeTab") : ut.target.nodeName == "A" && t(ut.target.parentNode).addClass("vis-activeTab"), ot = t(ut.target).data("vishome"), ot === "userprofile") c.show(), r = hi, k = !1, f = !0, t("li .vis-welcomeScreenTab-notificationBubbles").removeClass("blank").addClass("vis-feedsAlert"), t("li:first-child .vis-welcomeScreenTab-notificationBubbles").removeClass("vis-feedsAlert").addClass("blank"), t("li:last-child .vis-welcomeScreenTab-notificationBubbles").removeClass("vis-feedsAlert").addClass("blank"), t(".vis-welcomeScreenContainer > div").fadeOut("fast"), t(".vis-welcomeScreen-Data").fadeIn("fast"), v.hide(), p.hide(), w.hide(), y(); else if (ot === "KPI") t(".vis-welcomeScreen-Data").hide("fast"), t(".vis-welcomeScreenFeeds").fadeIn("fast"), l.html(""), c.show(), l.html(n.Msg.getMsg("KPI")), c.removeClass().addClass("vis-welcomeScreenContentTittle-icon vis vis-kpi"), i.css({ "text-align": "", "margin-top": "" }), r = fi, window.VADB && window.VADB != null && VADB.Apps.KpiHomeScreen != undefined ? (i.css({ "text-align": "auto" }), r = fi, k = !1, f = !0, t(".vis-welcomeScreenTab-notificationBubbles").removeClass("vis-feedsAlert").addClass("blank"), a.css("margin-right", "17px"), b.off("click"), VADB.Apps.KpiHomeScreen(i, gt, v, w, vt, ft, ri), w.hide(), y(), v.show(), p.hide()) : (a.hide(), i.html(n.Msg.getMsg("PleaseInstallVADashboard")), n.Application.isRTL ? i.css({ "text-align": "center", "margin-top": "200px" }) : i.css({ "text-align": "center", "margin-top": "200px" })); else if (ot === "workflow") c.show(), b.off("click"), i.css("overflow-y", "auto"), i.css({ "text-align": "auto" }), r = ui, k = !1, f = !0, a.css("margin-right", "17px"), c.removeClass().addClass("vis-welcomeScreenContentTittle-icon vis vis-userfeed"), t(".vis-welcomeScreenTab-notificationBubbles").removeClass("vis-feedsAlert").addClass("blank"), t(".vis-welcomeScreen-Data").hide("slow"), t(".vis-welcomeScreenFeeds").fadeIn("fast"), w.hide(), y(), v.hide(), p.show(), l.empty(), l.append(n.Msg.getMsg("WorkflowActivities")), h.empty(), h.append(t("#divfActivity").html()), ft.empty(), ft.append(n.Msg.getMsg("Activity")), it(), d = 0, e = g, u = nt, s = 0, st = new n.wfActivity(i, vt, pt, i, p), st.Load(!1); else if (ot === "notice") c.show(), b.off("click"), r = ct, k = !1, f = !0, a.css("margin-right", "17px"), i.css("overflow-y", "auto"), i.css({ "text-align": "auto" }), c.removeClass().addClass("vis-welcomeScreenContentTittle-icon vis vis-notice"), t(".vis-welcomeScreenTab-notificationBubbles").removeClass("vis-feedsAlert").addClass("blank"), t(".vis-welcomeScreen-Data").hide("slow"), t(".vis-welcomeScreenFeeds").fadeIn("fast"), l.html(n.Msg.getMsg("Notice")), v.hide(), p.hide(), o = parseInt(tt.text()), tt.text(o), h.text(o), et == !1 && (d = 0, e = 10, u = 1, s = 0, it(), oi()), w.hide(), y(); else if (ot === "mytask") t(".vis-welcomeScreen-Data").hide("slow"), t(".vis-welcomeScreenFeeds").fadeIn("fast"), l.html(""), l.html(n.Msg.getMsg("MyTask")), c.removeClass().addClass("vis-welcomeScreenContentTittle-icon vis vis-mytasks"), i.css({ "text-align": "", "margin-top": "" }), r = bt, at ? (i.css({ "text-align": "auto" }), b.off("click"), c.show(), r = bt, k = !1, f = !1, i.css("overflow-y", "hidden"), t(".vis-welcomeScreenTab-notificationBubbles").removeClass("vis-feedsAlert").addClass("blank"), v.show(), p.hide(), h.html(t("#divMyTaskCount").html()), a.css("margin-right", "17px"), WSP.wspHomeMgr.viewWSPHome(bt, f), w.hide(), y()) : (a.hide(), i.html(n.Msg.getMsg("PleaseInstallWSPModule")), n.Application.isRTL ? i.css({ "text-align": "center", "margin-top": "200px" }) : i.css({ "text-align": "center", "margin-top": "200px" })); else if (ot === "taskassignbyme") t(".vis-welcomeScreen-Data").hide("slow"), t(".vis-welcomeScreenFeeds").fadeIn("fast"), l.html(""), l.html(n.Msg.getMsg("TaskAssignByMe")), c.removeClass().addClass("vis-welcomeScreenContentTittle-icon vis vis-taskassigned"), i.css({ "text-align": "", "margin-top": "" }), r = kt, at ? (i.css({ "text-align": "auto" }), c.show(), b.off("click"), k = !1, f = !1, r = kt, i.css("overflow-y", "hidden"), t(".vis-welcomeScreenTab-notificationBubbles").removeClass("vis-feedsAlert").addClass("blank"), v.show(), p.hide(), h.html(parseInt(t("#divTaskAssignBymeCount").html())), a.css("margin-right", "17px"), WSP.wspHomeMgr.viewWSPHome(kt, f), w.hide(), y()) : (a.hide(), i.html(n.Msg.getMsg("PleaseInstallWSPModule")), n.Application.isRTL ? i.css({ "text-align": "center", "margin-top": "200px" }) : i.css({ "text-align": "center", "margin-top": "200px" })); else if (ot === "documentrecive") c.show(), a.css("margin-right", "17px"), a.hide(), r = ci, k = !1, f = !0, w.hide(), y(), i.css("overflow-y", "auto"), i.css({ "text-align": "auto" }), l.html(n.Msg.getMsg("Documents")), o = 0, h.html(o), c.removeClass().addClass("vis-welcomeScreenContentTittle-icon vis vis-document"), t(".vis-welcomeScreenTab-notificationBubbles").removeClass("vis-feedsAlert").addClass("blank"), t(".vis-welcomeScreen-Data").hide("slow"), t(".vis-welcomeScreenFeeds").fadeIn("fast"), it(), wt = "<p style=' margin-top:200px;text-align:center'>" + n.Msg.getMsg("PleaseInstallDMSModule") + "<\/p>", i.html(wt), v.hide(), p.hide(); else if (ot === "request") { c.show(); b.off("click"); r = yt; k = !1; f = !0; i.css("overflow-y", "auto"); i.css({ "text-align": "auto" }); c.removeClass().addClass("vis-welcomeScreenContentTittle-icon fa fa-bell-o"); t(".vis-welcomeScreenTab-notificationBubbles").removeClass("vis-feedsAlert").addClass("blank"); t(".vis-welcomeScreen-Data").hide("slow"); t(".vis-welcomeScreenFeeds").fadeIn("fast"); v.show(); p.hide(); a.css("margin-right", "17px"); l.html(n.Msg.getMsg("Requests")); o = parseInt(rt.text()); h.html(o); et == !1 && (d = 0, e = g, u = nt, s = 0, it(), ei()); w.hide(); y(); v.off("click"); v.on("click", function () { var i = gi("VIS_129"), t = new n.Query; t.addRestriction("R_Request_ID", n.Query.prototype.EQUAL, 0); n.viewManager.startWindow(i, t) }) } else ot === "appointments" ? (t(".vis-welcomeScreen-Data").hide("slow"), t(".vis-welcomeScreenFeeds").fadeIn("fast"), l.html(""), l.html(n.Msg.getMsg("Appointment")), c.removeClass().addClass("vis-welcomeScreenContentTittle-icon vis vis-appointment"), i.css({ "text-align": "", "margin-top": "" }), r = ht, at ? (i.css({ "text-align": "auto" }), b.off("click"), c.show(), r = ht, k = !1, f = !0, a.css("margin-right", "17px"), i.css("overflow-y", "auto"), t(".vis-welcomeScreenTab-notificationBubbles").removeClass("vis-feedsAlert").addClass("blank"), v.hide(), p.hide(), o = parseInt(ti.text()), h.html(o), d = 0, e = g, u = nt, s = 0, WSP.wspHomeMgr.viewWSPHome(ht, f), w.hide(), y()) : (a.hide(), i.html(n.Msg.getMsg("PleaseInstallWSPModule")), n.Application.isRTL ? i.css({ "text-align": "center", "margin-top": "200px" }) : i.css({ "text-align": "center", "margin-top": "200px" }))) : ot === "notes" && (t(".vis-welcomeScreen-Data").hide("slow"), t(".vis-welcomeScreenFeeds").fadeIn("fast"), l.html(""), l.html(n.Msg.getMsg("MyNotes")), c.removeClass().addClass("vis-welcomeScreenContentTittle-icon vis vis-contacts"), i.css({ "text-align": "", "margin-top": "" }), r = lt, at ? (i.css({ "text-align": "auto" }), b.off("click"), r = lt, c.show(), k = !1, f = !0, a.css("margin-right", "17px"), i.css("overflow-y", "auto"), t(".vis-welcomeScreenTab-notificationBubbles").removeClass("vis-feedsAlert").addClass("blank"), v.show(), p.hide(), o = parseInt(ni.text()), h.html(o), d = 0, e = g, u = nt, s = 0, it(), WSP.wspHomeMgr.viewWSPHome(lt, f), w.hide(), y()) : (a.hide(), i.html(n.Msg.getMsg("PleaseInstallWSPModule")), n.Application.isRTL ? i.css({ "text-align": "center", "margin-top": "200px" }) : i.css({ "text-align": "center", "margin-top": "200px" }))) }) } function it() { i.children().length > 0 && i.children().remove(); i.empty() } function ai(n) { var t, i, r; if (n.lastIndexOf("UTC") > 0 && (t = n.split("UTC"), n = n.replaceAll("UTC", ""), t.length > 0)) for (i = 0; i < t.length; i++)dt = t[i].substring(t[i].lastIndexOf(": ") + 1, t[i].length), (dt.lastIndexOf("AM") > 0 || dt.lastIndexOf("PM") > 0) && (r = new Date(dt + "UTC"), n = n.replace(dt, " " + r.toLocaleString())); return n } var si = null, ot = null, ut = null, pt = null, vi = null, yi = null, i = null, a = null, pi = null, r = null, w = null, at = null, gt = null, vt = null, ft = null, st = null, et = null, f = null, b = null, wt = null, tt = null, rt = null, ni = null, ti = null, ri = null, l = null, h = null, c = null, wi = null, bi = 13, hi = 1, yt = 2, ui = 3, ht = 4, bt = 5, kt = 6, ci = 7, ct = 8, lt = 9, fi = 10, g = 10, nt = 1, k = null, d = null, e = null, u = null, o = null, s = null, v = null, p = null, ki = n.Application.contextUrl, di = ki + "JsonData/JDataSetWithCode", gi = function (t, i, r) { var f = r ? !0 : !1, e = { sql: t, page: 1, pageSize: 0 }, u = null; return nr(e, f, function (t) { i = (new n.DB.DataSet).toJson(t); var i = (new n.DB.DataSet).toJson(t); u = i.getTable(0).getRows().length > 0 ? i.getTable(0).getRow(0).getCell(0) : null; i.dispose(); i = null; f && r(u) }), u }; return t("#vis_appInfoWindow").click(function () { n.InfoMenu.show(t(this)) }), { initHome: tr, adjustDivSize: y, BindMenuClick: ii, getActiveTab: ur } } n.HomeMgr = i() }(VIS, jQuery), function (n, t) { function i() { function e() { i = t("#vis-textStatus"); t.ajax({ url: n.Application.contextUrl + "Home/SaveStatus", dataType: "json", type: "POST", async: !1, data: { status: i.val() }, success: function (n) { JSON.parse(n).length > 0 ? (i.css("visibility", "hidden"), f.css("visibility", "hidden"), u.css("visibility", "hidden"), r.css("visibility", "visible"), r.text(JSON.parse(n))) : (i.css("visibility", "visible"), f.css("visibility", "hidden"), u.css("visibility", "hidden"), r.css("visibility", "visible"), r.text(JSON.parse(n))) } }) } var i = t("#vis-textStatus"), u = t("#vis-img-OKStatus"), f = t("#vis-img-CancelStatus"), r = t("#vis-labelStatus"); t("#vis-file-input").change(function () { var u = document.getElementById("vis-file-input").files[0], i, r, f; if (u != null) { if (i = u.type.split("/").pop().toLowerCase(), i != "jpeg" && i != "jpg" && i != "png" && i != "ico" && i != "webp" && i != "svg") return n.ADialog.info("SelectImageOnly"), !1; r = new XMLHttpRequest; f = new FormData; f.append("file", u); r.open("POST", n.Application.contextUrl + "Home/SaveImageAsByte", !0); r.send(f); r.addEventListener("load", function (n) { var i = n.target.response, r = JSON.parse(i), u = JSON.parse(r); t(".vis-userAvatar-Container").find("i").remove().find("img").remove(); t(".vis-userAvatar-Container").find("img").remove(); t(".vis-userAvatar-Container").append('<img id="imgUsrImage" alt="User avatar" class="vis-userAvatar-Large"><\/img>'); t("#imgUsrImage").attr("src", "data:image/jpg;base64," + u) }, !1) } }); t("#vis-file-input-remove").on("click", function () { t(".vis-userAvatar-Container").find("img").length > 0 && n.ADialog.confirm("ConfirmDeleteImage", !0, "", "Confirm", function (i) { i && t.ajax({ url: n.Application.contextUrl + "Home/DeleteUserImage", success: function () { t(".vis-userAvatar-Container").find("img").remove(); t(".vis-userAvatar-Container").append('<i id="imgUsrImage" class="vis-userAvatar-Large vis vis-user"><\/i>'); t(".vis-app-user-img-wrap").find("img").remove(); document.getElementById("vis-file-input").value = null }, error: function () { } }) }) }); u.on("click", function () { e() }); f.on("click", function () { i.css("visibility", "hidden"); f.css("visibility", "hidden"); u.css("visibility", "hidden"); r.css("visibility", "visible") }); i.on("focus", function () { f.css("visibility", "visible"); u.css("visibility", "visible") }); i.on("keypress", function (n) { var t = n.keyCode || n.which; t == 13 && e() }); i.on("blur", function () { }); r.on("click", function () { r.css("visibility", "hidden"); i.css("visibility", "visible"); i.val(r.text()); i.focus() }) } n.changeUserImage = i }(VIS, jQuery), function (n, t) { function r() { function s(t, i) { e = t; r = e.find("#vis_linkScroll"); n.favMgr.init(i); h(); c() } function h() { n.dataContext.getJSONData(n.Application.contextUrl + "Home/GetShortcutItems", null, function (t) { var u, i, e; if (f = t, u = null, i = ['<ul class="vis-userLinks-ListMenu">'], t) for (e = 0; e < t.length; e++)u = t[e], i.push('<li data-index="' + e + '" ><a data-index="' + e + '" href="javascript:void(0)">'), u.HasImage ? !u.IsImageByteArray && u.IconUrl.indexOf(".") < 0 ? i.push('<i data-index="' + e + '" class="' + u.IconUrl + '"') : (i.push('<img data-index="' + e + '"  src="'), u.IsImageByteArray ? i.push("data:image/*;base64," + u.IconBytes) : i.push(n.Application.contextUrl + u.IconUrl)) : i.push('<i data-index="' + e + '" class="vis vis-shortcut"'), i.push('" />'), i.push(u.ShortcutName + "<\/a><\/li>"); i.push("<\/ul>"); r.empty(); r.html(i.join(" ")); i = []; l(t.length) }) } function c() { r.on("click", function (r) { var e = t(r.target).data("index"), u, h, s, a, l, c; if ((e || e == "0") && e < f.length) if (u = f[e], u.HasChild) h = new i(u.KeyID), h.show(), h = null; else if (u.Url || u.Url.length > 0) n.Env.startBrowser(u.Url); else if (u.SpecialAction && u.SpecialAction.length > 0) { s = u.SpecialAction; a = u.ActionName; try { l = n.Utility.getFunctionByName(s, window); c = new l; c.show(); c = null } catch (r) { return o.log(n.Logging.Level.WARNING, "Class=" + s + ", Action Class Name=" + s, r), !1 } } else { if (u.Action == null || u.Action.length <= 0 || u.ActionID < 1) return; n.viewManager.startAction(u.Action, u.ActionID) } }) } function l(i) { u.empty(); u.append(t("<span><i class='fa fa-link' aria-hidden='true' style='transform: rotate(90deg);'><\/i><\/span>")); u.append(n.Msg.getMsg("Links") + " - "); u.append(t("<strong>").append(i)) } var e, r, f = null, o = n.Logging.VLogger.getVLogger("ShortCut"), u = t("#userLinks-Tab"); return { init: s } } function i(i) { function s() { n.dataContext.getJSONData(n.Application.contextUrl + "Home/GetSettingItems", { AD_Shortcut_ID: i }, function (t) { var r, i, e; if (u = t, r = null, i = ['<ul class="vis-userLinks-ListMenu">'], t) for (e = 0; e < t.length; e++)r = t[e], i.push('<li data-index="' + e + '" ><a data-index="' + e + '" href="javascript:void(0)">'), r.HasImage ? !r.IsImageByteArray && r.IconUrl.indexOf(".") < 0 ? i.push('<i data-index="' + e + '" class="' + r.IconUrl + '"') : (i.push('<img data-index="' + e + '"  src="'), r.IsImageByteArray ? i.push("data:image/*;base64," + r.IconBytes) : i.push(n.Application.contextUrl + r.IconUrl)) : i.push('<i data-index="' + e + '" class="vis vis-shortcut"'), i.push('" />'), i.push(r.ShortcutName + "<\/a><\/li>"); i.push("<\/ul>"); f.empty(); f.html(i.join(" ")); h() }) } function h() { f.on("click", function (i) { var e = t(i.target).data("index"), f, s, l, c, h; if ((e || e == "0") && e < u.length) { if (f = u[e], f.HasChild) n.Msg.getMsg("settingDialog"); else if (f.Url || f.Url.length > 0) n.Env.startBrowser(f.Url); else if (f.SpecialAction && f.SpecialAction.length > 0) { s = f.SpecialAction; l = f.ActionName; try { c = n.Utility.getFunctionByName(s, window); h = new c; h.show(); h = null } catch (i) { return o.log(n.Logging.Level.WARNING, "Class=" + s + ", Action Class Name=" + s, i), !1 } } else { if (f.Action == null || f.Action.length <= 0 || f.ActionID < 1) return; n.viewManager.startAction(f.Action, f.ActionID) } r.close() } }) } var e = t("<div>"), f = t('<div style="width:auto;z-index:1">').html('<div class="vis-busyindicatorouterwrap"><div class="vis-busyindicatorinnerwrap"><i class="vis-busyindicatordiv"><\/i><\/div><\/div>'), o = n.Logging.VLogger.getVLogger("SettingDialog"), r, u; e.append(f); r = null; u = null; this.show = function () { r = new n.ChildDialog; r.setWidth(540); r.setHeight(400); r.setTitle(n.Msg.getMsg("Setting")); r.setContent(e); r.show() }; this.disposeComponent = function () { f.off("click"); f.remove(); u && (u.length = 0); u = null; this.show = null; e = null; r && r.dispose() }; s() } i.prototype.dispose = function () { this.disposeComponent() }; n.shortcutMgr = r() }(VIS, jQuery), function (n, t) { var i = n.historyMgr || {}, r; "replaceState" in history ? i.replaceHash = function (n) { ("" + n).charAt(0) !== "#" && (n = "#" + n); history.replaceState("", "", n) } : (r = location.hash, i.replaceHash = function (n) { location.hash !== r && history.back(); location.hash = n }); i.updateHistory = function (n) { i.replaceHash(n) }; i.restoreHistory = function () { var n = i.geHashtLocation(); t.viewManager.restoreActions(n) }; i.geHashtLocation = function () { var n = location.hash; return n.length > 1 ? n.substring(1) : "" }; n.historyMgr = i }(window, VIS); var CryptoJS = CryptoJS || function (n, t) { var u = {}, f = u.lib = {}, o = function () { }, i = f.Base = { extend: function (n) { o.prototype = this; var t = new o; return n && t.mixIn(n), t.hasOwnProperty("init") || (t.init = function () { t.$super.init.apply(this, arguments) }), t.init.prototype = t, t.$super = this, t }, create: function () { var n = this.extend(); return n.init.apply(n, arguments), n }, init: function () { }, mixIn: function (n) { for (var t in n) n.hasOwnProperty(t) && (this[t] = n[t]); n.hasOwnProperty("toString") && (this.toString = n.toString) }, clone: function () { return this.init.prototype.extend(this) } }, r = f.WordArray = i.extend({ init: function (n, i) { n = this.words = n || []; this.sigBytes = i != t ? i : 4 * n.length }, toString: function (n) { return (n || l).stringify(this) }, concat: function (n) { var i = this.words, r = n.words, u = this.sigBytes, t; if (n = n.sigBytes, this.clamp(), u % 4) for (t = 0; t < n; t++)i[u + t >>> 2] |= (r[t >>> 2] >>> 24 - 8 * (t % 4) & 255) << 24 - 8 * ((u + t) % 4); else if (65535 < r.length) for (t = 0; t < n; t += 4)i[u + t >>> 2] = r[t >>> 2]; else i.push.apply(i, r); return this.sigBytes += n, this }, clamp: function () { var i = this.words, t = this.sigBytes; i[t >>> 2] &= 4294967295 << 32 - 8 * (t % 4); i.length = n.ceil(t / 4) }, clone: function () { var n = i.clone.call(this); return n.words = this.words.slice(0), n }, random: function (t) { for (var i = [], u = 0; u < t; u += 4)i.push(4294967296 * n.random() | 0); return new r.init(i, t) } }), e = u.enc = {}, l = e.Hex = { stringify: function (n) { var u = n.words, i, t, r; for (n = n.sigBytes, i = [], t = 0; t < n; t++)r = u[t >>> 2] >>> 24 - 8 * (t % 4) & 255, i.push((r >>> 4).toString(16)), i.push((r & 15).toString(16)); return i.join("") }, parse: function (n) { for (var i = n.length, u = [], t = 0; t < i; t += 2)u[t >>> 3] |= parseInt(n.substr(t, 2), 16) << 24 - 4 * (t % 8); return new r.init(u, i / 2) } }, s = e.Latin1 = { stringify: function (n) { var r = n.words, i, t; for (n = n.sigBytes, i = [], t = 0; t < n; t++)i.push(String.fromCharCode(r[t >>> 2] >>> 24 - 8 * (t % 4) & 255)); return i.join("") }, parse: function (n) { for (var i = n.length, u = [], t = 0; t < i; t++)u[t >>> 2] |= (n.charCodeAt(t) & 255) << 24 - 8 * (t % 4); return new r.init(u, i) } }, a = e.Utf8 = { stringify: function (n) { try { return decodeURIComponent(escape(s.stringify(n))) } catch (t) { throw Error("Malformed UTF-8 data"); } }, parse: function (n) { return s.parse(unescape(encodeURIComponent(n))) } }, h = f.BufferedBlockAlgorithm = i.extend({ reset: function () { this._data = new r.init; this._nDataBytes = 0 }, _append: function (n) { "string" == typeof n && (n = a.parse(n)); this._data.concat(n); this._nDataBytes += n.sigBytes }, _process: function (t) { var f = this._data, s = f.words, u = f.sigBytes, e = this.blockSize, o = u / (4 * e), o = t ? n.ceil(o) : n.max((o | 0) - this._minBufferSize, 0), i; if (t = o * e, u = n.min(4 * t, u), t) { for (i = 0; i < t; i += e)this._doProcessBlock(s, i); i = s.splice(0, t); f.sigBytes -= u } return new r.init(i, u) }, clone: function () { var n = i.clone.call(this); return n._data = this._data.clone(), n }, _minBufferSize: 0 }), c; return f.Hasher = h.extend({ cfg: i.extend(), init: function (n) { this.cfg = this.cfg.extend(n); this.reset() }, reset: function () { h.reset.call(this); this._doReset() }, update: function (n) { return this._append(n), this._process(), this }, finalize: function (n) { return n && this._append(n), this._doFinalize() }, blockSize: 16, _createHelper: function (n) { return function (t, i) { return new n.init(i).finalize(t) } }, _createHmacHelper: function (n) { return function (t, i) { return new c.HMAC.init(n, i).finalize(t) } } }), c = u.algo = {}, u }(Math); (function () { var n = CryptoJS, t = n.lib.WordArray; n.enc.Base64 = { stringify: function (n) { var i = n.words, u = n.sigBytes, f = this._map, t, e, r; for (n.clamp(), n = [], t = 0; t < u; t += 3)for (e = (i[t >>> 2] >>> 24 - 8 * (t % 4) & 255) << 16 | (i[t + 1 >>> 2] >>> 24 - 8 * ((t + 1) % 4) & 255) << 8 | i[t + 2 >>> 2] >>> 24 - 8 * ((t + 2) % 4) & 255, r = 0; 4 > r && t + .75 * r < u; r++)n.push(f.charAt(e >>> 6 * (3 - r) & 63)); if (i = f.charAt(64)) for (; n.length % 4;)n.push(i); return n.join("") }, parse: function (n) { var e = n.length, f = this._map, i = f.charAt(64), o, s; i && (i = n.indexOf(i), -1 != i && (e = i)); for (var i = [], u = 0, r = 0; r < e; r++)r % 4 && (o = f.indexOf(n.charAt(r - 1)) << 2 * (r % 4), s = f.indexOf(n.charAt(r)) >>> 6 - 2 * (r % 4), i[u >>> 2] |= (o | s) << 24 - 8 * (u % 4), u++); return t.create(i, u) }, _map: "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=" } })(), function (n) { function i(n, t, i, r, u, f, e) { return n = n + (t & i | ~t & r) + u + e, (n << f | n >>> 32 - f) + t } function r(n, t, i, r, u, f, e) { return n = n + (t & r | i & ~r) + u + e, (n << f | n >>> 32 - f) + t } function u(n, t, i, r, u, f, e) { return n = n + (t ^ i ^ r) + u + e, (n << f | n >>> 32 - f) + t } function f(n, t, i, r, u, f, e) { return n = n + (i ^ (t | ~r)) + u + e, (n << f | n >>> 32 - f) + t } for (var o = CryptoJS, e = o.lib, c = e.WordArray, s = e.Hasher, e = o.algo, t = [], h = 0; 64 > h; h++)t[h] = 4294967296 * n.abs(n.sin(h + 1)) | 0; e = e.MD5 = s.extend({ _doReset: function () { this._hash = new c.init([1732584193, 4023233417, 2562383102, 271733878]) }, _doProcessBlock: function (n, e) { for (var v, a, l = 0; 16 > l; l++)v = e + l, a = n[v], n[v] = (a << 8 | a >>> 24) & 16711935 | (a << 24 | a >>> 8) & 4278255360; var l = this._hash.words, v = n[e + 0], a = n[e + 1], y = n[e + 2], p = n[e + 3], w = n[e + 4], b = n[e + 5], k = n[e + 6], d = n[e + 7], g = n[e + 8], nt = n[e + 9], tt = n[e + 10], it = n[e + 11], rt = n[e + 12], ut = n[e + 13], ft = n[e + 14], et = n[e + 15], o = l[0], s = l[1], h = l[2], c = l[3], o = i(o, s, h, c, v, 7, t[0]), c = i(c, o, s, h, a, 12, t[1]), h = i(h, c, o, s, y, 17, t[2]), s = i(s, h, c, o, p, 22, t[3]), o = i(o, s, h, c, w, 7, t[4]), c = i(c, o, s, h, b, 12, t[5]), h = i(h, c, o, s, k, 17, t[6]), s = i(s, h, c, o, d, 22, t[7]), o = i(o, s, h, c, g, 7, t[8]), c = i(c, o, s, h, nt, 12, t[9]), h = i(h, c, o, s, tt, 17, t[10]), s = i(s, h, c, o, it, 22, t[11]), o = i(o, s, h, c, rt, 7, t[12]), c = i(c, o, s, h, ut, 12, t[13]), h = i(h, c, o, s, ft, 17, t[14]), s = i(s, h, c, o, et, 22, t[15]), o = r(o, s, h, c, a, 5, t[16]), c = r(c, o, s, h, k, 9, t[17]), h = r(h, c, o, s, it, 14, t[18]), s = r(s, h, c, o, v, 20, t[19]), o = r(o, s, h, c, b, 5, t[20]), c = r(c, o, s, h, tt, 9, t[21]), h = r(h, c, o, s, et, 14, t[22]), s = r(s, h, c, o, w, 20, t[23]), o = r(o, s, h, c, nt, 5, t[24]), c = r(c, o, s, h, ft, 9, t[25]), h = r(h, c, o, s, p, 14, t[26]), s = r(s, h, c, o, g, 20, t[27]), o = r(o, s, h, c, ut, 5, t[28]), c = r(c, o, s, h, y, 9, t[29]), h = r(h, c, o, s, d, 14, t[30]), s = r(s, h, c, o, rt, 20, t[31]), o = u(o, s, h, c, b, 4, t[32]), c = u(c, o, s, h, g, 11, t[33]), h = u(h, c, o, s, it, 16, t[34]), s = u(s, h, c, o, ft, 23, t[35]), o = u(o, s, h, c, a, 4, t[36]), c = u(c, o, s, h, w, 11, t[37]), h = u(h, c, o, s, d, 16, t[38]), s = u(s, h, c, o, tt, 23, t[39]), o = u(o, s, h, c, ut, 4, t[40]), c = u(c, o, s, h, v, 11, t[41]), h = u(h, c, o, s, p, 16, t[42]), s = u(s, h, c, o, k, 23, t[43]), o = u(o, s, h, c, nt, 4, t[44]), c = u(c, o, s, h, rt, 11, t[45]), h = u(h, c, o, s, et, 16, t[46]), s = u(s, h, c, o, y, 23, t[47]), o = f(o, s, h, c, v, 6, t[48]), c = f(c, o, s, h, d, 10, t[49]), h = f(h, c, o, s, ft, 15, t[50]), s = f(s, h, c, o, b, 21, t[51]), o = f(o, s, h, c, rt, 6, t[52]), c = f(c, o, s, h, p, 10, t[53]), h = f(h, c, o, s, tt, 15, t[54]), s = f(s, h, c, o, a, 21, t[55]), o = f(o, s, h, c, g, 6, t[56]), c = f(c, o, s, h, et, 10, t[57]), h = f(h, c, o, s, k, 15, t[58]), s = f(s, h, c, o, ut, 21, t[59]), o = f(o, s, h, c, w, 6, t[60]), c = f(c, o, s, h, it, 10, t[61]), h = f(h, c, o, s, y, 15, t[62]), s = f(s, h, c, o, nt, 21, t[63]); l[0] = l[0] + o | 0; l[1] = l[1] + s | 0; l[2] = l[2] + h | 0; l[3] = l[3] + c | 0 }, _doFinalize: function () { var u = this._data, r = u.words, t = 8 * this._nDataBytes, i = 8 * u.sigBytes, f; for (r[i >>> 5] |= 128 << 24 - i % 32, f = n.floor(t / 4294967296), r[(i + 64 >>> 9 << 4) + 15] = (f << 8 | f >>> 24) & 16711935 | (f << 24 | f >>> 8) & 4278255360, r[(i + 64 >>> 9 << 4) + 14] = (t << 8 | t >>> 24) & 16711935 | (t << 24 | t >>> 8) & 4278255360, u.sigBytes = 4 * (r.length + 1), this._process(), u = this._hash, r = u.words, t = 0; 4 > t; t++)i = r[t], r[t] = (i << 8 | i >>> 24) & 16711935 | (i << 24 | i >>> 8) & 4278255360; return u }, clone: function () { var n = s.clone.call(this); return n._hash = this._hash.clone(), n } }); o.MD5 = s._createHelper(e); o.HmacMD5 = s._createHmacHelper(e) }(Math), function () { var t = CryptoJS, n = t.lib, i = n.Base, r = n.WordArray, n = t.algo, u = n.EvpKDF = i.extend({ cfg: i.extend({ keySize: 4, hasher: n.MD5, iterations: 1 }), init: function (n) { this.cfg = this.cfg.extend(n) }, compute: function (n, t) { for (var i, o, f = this.cfg, u = f.hasher.create(), e = r.create(), h = e.words, s = f.keySize, f = f.iterations; h.length < s;) { for (i && u.update(i), i = u.update(n).finalize(t), u.reset(), o = 1; o < f; o++)i = u.finalize(i), u.reset(); e.concat(i) } return e.sigBytes = 4 * s, e } }); t.EvpKDF = function (n, t, i) { return u.create(i).compute(n, t) } }(); CryptoJS.lib.Cipher || function (n) { var i = CryptoJS, t = i.lib, f = t.Base, e = t.WordArray, c = t.BufferedBlockAlgorithm, l = i.enc.Base64, y = i.algo.EvpKDF, o = t.Cipher = c.extend({ cfg: f.extend(), createEncryptor: function (n, t) { return this.create(this._ENC_XFORM_MODE, n, t) }, createDecryptor: function (n, t) { return this.create(this._DEC_XFORM_MODE, n, t) }, init: function (n, t, i) { this.cfg = this.cfg.extend(i); this._xformMode = n; this._key = t; this.reset() }, reset: function () { c.reset.call(this); this._doReset() }, process: function (n) { return this._append(n), this._process() }, finalize: function (n) { return n && this._append(n), this._doFinalize() }, keySize: 4, ivSize: 4, _ENC_XFORM_MODE: 1, _DEC_XFORM_MODE: 2, _createHelper: function (n) { return { encrypt: function (t, i, r) { return ("string" == typeof i ? v : u).encrypt(n, t, i, r) }, decrypt: function (t, i, r) { return ("string" == typeof i ? v : u).decrypt(n, t, i, r) } } } }); t.StreamCipher = o.extend({ _doFinalize: function () { return this._process(!0) }, blockSize: 1 }); var s = i.mode = {}, a = function (t, i, r) { var f = this._iv, u; for (f ? this._iv = n : f = this._prevBlock, u = 0; u < r; u++)t[i + u] ^= f[u] }, r = (t.BlockCipherMode = f.extend({ createEncryptor: function (n, t) { return this.Encryptor.create(n, t) }, createDecryptor: function (n, t) { return this.Decryptor.create(n, t) }, init: function (n, t) { this._cipher = n; this._iv = t } })).extend(); r.Encryptor = r.extend({ processBlock: function (n, t) { var i = this._cipher, r = i.blockSize; a.call(this, n, t, r); i.encryptBlock(n, t); this._prevBlock = n.slice(t, t + r) } }); r.Decryptor = r.extend({ processBlock: function (n, t) { var i = this._cipher, r = i.blockSize, u = n.slice(t, t + r); i.decryptBlock(n, t); a.call(this, n, t, r); this._prevBlock = u } }); s = s.CBC = r; r = (i.pad = {}).Pkcs7 = { pad: function (n, t) { for (var i = 4 * t, i = i - n.sigBytes % i, f = i << 24 | i << 16 | i << 8 | i, r = [], u = 0; u < i; u += 4)r.push(f); i = e.create(r, i); n.concat(i) }, unpad: function (n) { n.sigBytes -= n.words[n.sigBytes - 1 >>> 2] & 255 } }; t.BlockCipher = o.extend({ cfg: o.cfg.extend({ mode: s, padding: r }), reset: function () { var t; o.reset.call(this); var n = this.cfg, i = n.iv, n = n.mode; this._xformMode == this._ENC_XFORM_MODE ? t = n.createEncryptor : (t = n.createDecryptor, this._minBufferSize = 1); this._mode = t.call(n, this, i && i.words) }, _doProcessBlock: function (n, t) { this._mode.processBlock(n, t) }, _doFinalize: function () { var t = this.cfg.padding, n; return this._xformMode == this._ENC_XFORM_MODE ? (t.pad(this._data, this.blockSize), n = this._process(!0)) : (n = this._process(!0), t.unpad(n)), n }, blockSize: 4 }); var h = t.CipherParams = f.extend({ init: function (n) { this.mixIn(n) }, toString: function (n) { return (n || this.formatter).stringify(this) } }), s = (i.format = {}).OpenSSL = { stringify: function (n) { var t = n.ciphertext; return n = n.salt, (n ? e.create([1398893684, 1701076831]).concat(n).concat(t) : t).toString(l) }, parse: function (n) { var t, i; return n = l.parse(n), t = n.words, 1398893684 == t[0] && 1701076831 == t[1] && (i = e.create(t.slice(2, 4)), t.splice(0, 4), n.sigBytes -= 16), h.create({ ciphertext: n, salt: i }) } }, u = t.SerializableCipher = f.extend({ cfg: f.extend({ format: s }), encrypt: function (n, t, i, r) { r = this.cfg.extend(r); var u = n.createEncryptor(i, r); return t = u.finalize(t), u = u.cfg, h.create({ ciphertext: t, key: i, iv: u.iv, algorithm: n, mode: u.mode, padding: u.padding, blockSize: n.blockSize, formatter: r.format }) }, decrypt: function (n, t, i, r) { return r = this.cfg.extend(r), t = this._parse(t, r.format), n.createDecryptor(i, r).finalize(t.ciphertext) }, _parse: function (n, t) { return "string" == typeof n ? t.parse(n, this) : n } }), i = (i.kdf = {}).OpenSSL = { execute: function (n, t, i, r) { return r || (r = e.random(8)), n = y.create({ keySize: t + i }).compute(n, r), i = e.create(n.words.slice(t), 4 * i), n.sigBytes = 4 * t, h.create({ key: n, iv: i, salt: r }) } }, v = t.PasswordBasedCipher = u.extend({ cfg: u.cfg.extend({ kdf: i }), encrypt: function (n, t, i, r) { return r = this.cfg.extend(r), i = r.kdf.execute(i, n.keySize, n.ivSize), r.iv = i.iv, n = u.encrypt.call(this, n, t, i.key, r), n.mixIn(i), n }, decrypt: function (n, t, i, r) { return r = this.cfg.extend(r), t = this._parse(t, r.format), i = r.kdf.execute(i, n.keySize, n.ivSize, t.salt), r.iv = i.iv, u.decrypt.call(this, n, t, i.key, r) } }) }(), function () { for (var i, tt, s = CryptoJS, y = s.lib.BlockCipher, h = s.algo, t = [], p = [], w = [], b = [], k = [], d = [], c = [], l = [], a = [], v = [], u = [], f = 0; 256 > f; f++)u[f] = 128 > f ? f << 1 : f << 1 ^ 283; for (var r = 0, e = 0, f = 0; 256 > f; f++) { i = e ^ e << 1 ^ e << 2 ^ e << 3 ^ e << 4; i = i >>> 8 ^ i & 255 ^ 99; t[r] = i; p[i] = r; var o = u[r], g = u[o], nt = u[g], n = 257 * u[i] ^ 16843008 * i; w[r] = n << 24 | n >>> 8; b[r] = n << 16 | n >>> 16; k[r] = n << 8 | n >>> 24; d[r] = n; n = 16843009 * nt ^ 65537 * g ^ 257 * o ^ 16843008 * r; c[i] = n << 24 | n >>> 8; l[i] = n << 16 | n >>> 16; a[i] = n << 8 | n >>> 24; v[i] = n; r ? (r = o ^ u[u[u[nt ^ o]]], e ^= u[u[e]]) : r = e = 1 } tt = [0, 1, 2, 4, 8, 16, 32, 64, 128, 27, 54]; h = h.AES = y.extend({ _doReset: function () { for (var n, f = this._key, e = f.words, r = f.sigBytes / 4, f = 4 * ((this._nRounds = r + 6) + 1), u = this._keySchedule = [], i = 0; i < f; i++)i < r ? u[i] = e[i] : (n = u[i - 1], i % r ? 6 < r && 4 == i % r && (n = t[n >>> 24] << 24 | t[n >>> 16 & 255] << 16 | t[n >>> 8 & 255] << 8 | t[n & 255]) : (n = n << 8 | n >>> 24, n = t[n >>> 24] << 24 | t[n >>> 16 & 255] << 16 | t[n >>> 8 & 255] << 8 | t[n & 255], n ^= tt[i / r | 0] << 24), u[i] = u[i - r] ^ n); for (e = this._invKeySchedule = [], r = 0; r < f; r++)i = f - r, n = r % 4 ? u[i] : u[i - 4], e[r] = 4 > r || 4 >= i ? n : c[t[n >>> 24]] ^ l[t[n >>> 16 & 255]] ^ a[t[n >>> 8 & 255]] ^ v[t[n & 255]] }, encryptBlock: function (n, i) { this._doCryptBlock(n, i, this._keySchedule, w, b, k, d, t) }, decryptBlock: function (n, t) { var i = n[t + 1]; n[t + 1] = n[t + 3]; n[t + 3] = i; this._doCryptBlock(n, t, this._invKeySchedule, c, l, a, v, p); i = n[t + 1]; n[t + 1] = n[t + 3]; n[t + 3] = i }, _doCryptBlock: function (n, t, i, r, u, f, e, o) { for (var b = this._nRounds, h = n[t] ^ i[0], c = n[t + 1] ^ i[1], l = n[t + 2] ^ i[2], s = n[t + 3] ^ i[3], a = 4, w = 1; w < b; w++)var v = r[h >>> 24] ^ u[c >>> 16 & 255] ^ f[l >>> 8 & 255] ^ e[s & 255] ^ i[a++], y = r[c >>> 24] ^ u[l >>> 16 & 255] ^ f[s >>> 8 & 255] ^ e[h & 255] ^ i[a++], p = r[l >>> 24] ^ u[s >>> 16 & 255] ^ f[h >>> 8 & 255] ^ e[c & 255] ^ i[a++], s = r[s >>> 24] ^ u[h >>> 16 & 255] ^ f[c >>> 8 & 255] ^ e[l & 255] ^ i[a++], h = v, c = y, l = p; v = (o[h >>> 24] << 24 | o[c >>> 16 & 255] << 16 | o[l >>> 8 & 255] << 8 | o[s & 255]) ^ i[a++]; y = (o[c >>> 24] << 24 | o[l >>> 16 & 255] << 16 | o[s >>> 8 & 255] << 8 | o[h & 255]) ^ i[a++]; p = (o[l >>> 24] << 24 | o[s >>> 16 & 255] << 16 | o[h >>> 8 & 255] << 8 | o[c & 255]) ^ i[a++]; s = (o[s >>> 24] << 24 | o[h >>> 16 & 255] << 16 | o[c >>> 8 & 255] << 8 | o[l & 255]) ^ i[a++]; n[t] = v; n[t + 1] = y; n[t + 2] = p; n[t + 3] = s }, keySize: 8 }); s.AES = y._createHelper(h) }(), function (n, t) { var i = t.enc.Utf8.parse(n.context.getContext("#key")), r = t.enc.Utf8.parse(n.context.getContext("#key")); n.secureEngine = { encrypt: function (n) { var u = ""; return (n || n === 0) && (u = t.AES.encrypt(t.enc.Utf8.parse(n.toString()), i, { keySize: 16, iv: r, mode: t.mode.CBC, padding: t.pad.Pkcs7 })), u.toString() }, decrypt: function (n) { var u = ""; return (n || n.length > 12) && (u = t.AES.decrypt(n, i, { keySize: 16, iv: r, mode: t.mode.CBC, padding: t.pad.Pkcs7 })), u.toString(t.enc.Utf8) }, isEncrypted: function (n) { if (n || n.length > 12) return !0 } } }(VIS, CryptoJS), function (n, t) { function i(i) { this.frame; this.windowNo; var ci = null, ir = null, li = null, it = null, lt = null, at = null, vt = null, rr = null, w = null, yt = null, ai = null, dr = null, rt = null, pt = null, b = null, wt = null, ut = null, ur = null, fr = null, k = null, bt = null, kt = null, vi = null, yi = null, ft = null, et = null, ot = null, er = null, pi = null, wi = this, gr = null, bi = null, dt = null, gt = null, or = null, sr = null, hr = null, cr = null, ki = null, di = null, lr = null, ar = null, vr = null, nu = null, c = null, f = null, tu = null, iu = null, ni = null, ru = null, ti = null, d = null, ii = null, e = null, gi = null, ri = !1, uu = null, ui = null, y = null, g = null, o = null, st = null, fi = !1, fu = null, ei = null, nt = null, u = null, oi = !1, ht = null, ct = null, si = null, nr = null, tr = null, u = null, eu = null, l = null, a = null, h = null, p = null, v = null, hi = null, ou = null, yr = null, pr = null, s = t("<div class='vis-forms-container'>"), tt = t('<div class="vis-busyindicatorouterwrap"><div class="vis-busyindicatorinnerwrap"><i class="vis-busyindicatordiv"><\/i><\/div><\/div>'), r = n.Env.getWindowNo(); this.log = n.Logging.VLogger.getVLogger("UserPreference"); this.load = function () { tt[0].style.visibility = "visible"; s.load(n.Application.contextUrl + "UserPreference/Index/?windowno=" + r + "&adUserId=" + n.context.getAD_User_ID(), function () { wi.init(s); var n = s.find("#content_" + r); n != null; tt[0].style.visibility = "hidden" }) }; this.init = function (wi) { function nf(n) { tt[0].style.visibility = n ? "visible" : "hidden" } function io(n) { var t = new Date, i = ("0" + t.getDate()).slice(-2), r = ("0" + (t.getMonth() + 1)).slice(-2), u = t.getFullYear() + "-" + r + "-" + i; n.val(u) } function co() { t.ajax({ type: "POST", async: !1, url: n.Application.contextUrl + "UserPreference/GetSavedDetail", dataType: "json", data: { isTask: !0 }, success: function (t) { fi = !1; ri = !1; oi = !1; var i = JSON.parse(t); i.IsSyncInBackground == "false" ? (ii.prop("checked", !1), gi = !1) : (ii.prop("checked", !0), gi = !0); i.IsCalSyncInBackground == "false" ? (g.prop("checked", !1), st = !1) : (g.prop("checked", !0), st = !0); d.val(i.TaskAuthCode); d.val().length > 0 && (ti.html(n.Msg.getMsg("RemoveLink")), ri = !0); y.val(i.CalendarAuthCode); y.val().length > 0 && (ui.html(n.Msg.getMsg("RemoveLink")), fi = !0); nt.val(i.ContactAuthCode); nt.val().length > 0 && (ei.html(n.Msg.getMsg("RemoveLink")), oi = !0) } }) } function lo() { var t = n.Application.contextUrl + "JsonData/GetThemes"; n.dataContext.getJSONData(t, null, ao) } function ao(n) { var t = [], r, u, i; if (n) { for (r = 0, u = n.length; r < u; r++)i = n[r], t.push("<li>"), t.push('<div class="vis-theme-rec" data-color="'), t.push(i.PColor), t.push("|"), t.push(i.OnPColor), t.push("|"), t.push(i.SColor), t.push("|"), t.push(i.OnSColor), t.push('" data-id="' + i.Id + '" >'), t.push('<span class="vis-theme-color" style="background-color:rgba(' + i.PColor + ',1)"><\/span>'), t.push('<span class="vis-theme-color" style="background-color:rgba(' + i.OnPColor + ',1)"><\/span>'), t.push('<span class="vis-theme-color" style="background-color:rgba(' + i.SColor + ',1)"><\/span>'), t.push('<span class="vis-theme-color" style="background-color:rgba(' + i.OnSColor + ',1)"><\/span>'), t.push("<\/div>"), t.push("<\/li>"); ou.append(t.join("")) } } function tf(i, r) { t.ajax({ type: "POST", async: !1, url: n.Application.contextUrl + "UserPreference/GetGmailAuthorizationCode", dataType: "json", data: { isTask: i, isContact: r }, success: function (n) { var t = JSON.parse(n); t != null && t.length > 0 && window.open(t) } }) } function rf(i, r, f, s, h) { t.ajax({ type: "POST", async: !1, url: n.Application.contextUrl + "UserPreference/SaveGmailAccountSettings", dataType: "json", data: { authCodes: f, isTask: i, isSyncInBackground: r, isRemoveLink: s, isContact: h }, success: function (t) { var r = JSON.parse(t); i ? r.toString() == "false" ? (e.css("color", "red"), e.text(n.Msg.getMsg("RecordNotSaved")), e.show()) : r.toString() == "true" ? (e.css("color", "green"), e.text(n.Msg.getMsg("RecordSaved")), s ? (d.val(""), ti.html(n.Msg.getMsg("Save")), ii.prop("checked", !1), ri = !1, d.removeAttr("disabled"), e.text(n.Msg.getMsg("LinkRemoved"))) : (ti.html(n.Msg.getMsg("RemoveLink")), d.attr("disabled", !0), ri = !0), e.show()) : window.open(r) : h ? r.toString() == "false" ? (u.css("color", "red"), u.text(n.Msg.getMsg("RecordNotSaved")), u.show()) : r.toString() == "true" ? (u.css("color", "green"), u.text(n.Msg.getMsg("RecordSaved")), s ? (nt.val(""), ei.html(n.Msg.getMsg("Save")), oi = !1, nt.removeAttr("disabled"), u.text(n.Msg.getMsg("LinkRemoved"))) : (ei.html(n.Msg.getMsg("RemoveLink")), nt.attr("disabled", !0), oi = !0), u.show()) : window.open(r) : r.toString() == "false" ? (o.css("color", "red"), o.text(n.Msg.getMsg("RecordNotSaved")), o.show()) : r.toString() == "true" ? (o.css("color", "green"), o.text(n.Msg.getMsg("RecordSaved")), s ? (y.val(""), ui.html(n.Msg.getMsg("Save")), g.prop("checked", !1), fi = !1, y.removeAttr("disabled"), o.text(n.Msg.getMsg("LinkRemoved"))) : (ui.html(n.Msg.getMsg("RemoveLink")), y.attr("disabled", !0), fi = !0), o.show()) : window.open(r) } }) } function vo() { po(); si != null && si.append(bu); yo() } function yo() { if (window.WSP) { var i = n.Application.contextUrl + "WSP/ContactSettings/GetSavedDetail"; t.ajax({ type: "GET", async: !0, url: i, dataType: "json", success: function (n) { var t = JSON.parse(n), i; ht.val(t.Username); ct.val(t.Password); t.Role != "" && si.val(t.Role); i = t.IsUpdate; i.toString().toLowerCase() == "false" ? (nr.prop("checked", !1), tr = !1) : (nr.prop("checked", !0), tr = !0) } }) } } function po() { if (window.WSP) { var i = n.Application.contextUrl + "WSP/ContactSettings/GetRole"; t.ajax({ type: "GET", async: !0, url: i, dataType: "json", success: function (t) { var r = JSON.parse(t), i; for (bu += "<option value='-1'  selected='selected'>" + n.Msg.getMsg("SelectRole") + "<\/option>", i = 0; i < r.length; i++)bu += "<option value='" + r[i].RoleID + "'>" + r[i].RoleName + "<\/option>" } }) } } function wo(i, r, f, e) { var o = n.Application.contextUrl + "WSP/ContactSettings/SaveGmailContactSettings"; t.ajax({ type: "POST", async: !1, url: o, dataType: "json", data: { username: i, password: r, role_ID: f, isUpdateExisting: e }, success: function (t) { var i = JSON.parse(t); i.toString() == "false" ? (u.css("color", "red"), u.text(n.Msg.getMsg("RecordNotSaved")), u.show()) : (u.css("color", "green"), u.text(n.Msg.getMsg("RecordSaved")), u.show()) } }) } function ro() { var r, u, t, i, f; n.Env.getCtx().setContext("AutoCommit", ci.prop("checked") ? "Y" : "N"); n.Ini.setValueToLocalStorage(n.IniConstants.P_A_NEW, at.prop("checked") ? "Y" : "N"); n.Env.getCtx().setContext("AutoNew", at.prop("checked") ? "Y" : "N"); n.Ini.setValueToLocalStorage(n.IniConstants.P_TRACEFILE, yt.prop("checked") ? "Y" : "N"); r = w.find("option:selected").val(); u = n.Logging.Level.prototype.getLevel(r); n.Logging.VLogMgt.setLevel(u); n.Ini.setValueToLocalStorage(n.IniConstants.P_TRACELEVEL, w.find("option:selected").val()); t = rt[0].selectedIndex; n.Ini.setValueToLocalStorage(n.IniConstants.CO_SHOWLEVEL, t < 0 ? 0 : t); n.Env.getCtx().setContext("#ClientOrgLevel", t < 0 ? 0 : t); n.Ini.setValueToLocalStorage(n.IniConstants.W_PAGESIZE, b.find("option:selected").val()); n.Env.getCtx().setContext("#ShowWorkSpacePageSize", b.find("option:selected").val()); i = ut.find("option:selected").val(); n.Ini.setValueToLocalStorage(n.IniConstants.WIN_PAGESIZE, i); n.Env.setWINDOW_PAGE_SIZE(i); n.Ini.setValueToLocalStorage(n.IniConstants.P_Show_Mini_Grid, pt.prop("checked") ? "Y" : "N"); n.Env.getCtx().setContext("#ShowMiniGrid", pt.prop("checked") ? "Y" : "N"); n.Ini.setValueToLocalStorage(n.IniConstants.P_Print_Native_Digits, wt.prop("checked") ? "Y" : "N"); n.Env.getCtx().setContext("#PrintNativeDigits", wt.prop("checked") ? "Y" : "N"); n.Ini.setValueToLocalStorage(n.IniConstants.P_A_LOGIN, li.prop("checked") ? "Y" : "N"); n.Ini.setValueToLocalStorage(n.IniConstants.P_STORE_PWD, ir.prop("checked") ? "Y" : "N"); n.Env.getCtx().setContext("#ShowAcct", lt.prop("checked") ? "Y" : "N"); n.Env.getCtx().setContext("#ShowTrl", it.prop("checked") ? "Y" : "N"); n.Env.getCtx().setContext("#ShowAdvanced", vt.prop("checked") ? "Y" : "N"); n.Ini.setValueToLocalStorage(n.IniConstants.P_CACHE_WINDOW, rr.prop("checked") ? "Y" : "N"); n.Ini.setValueToLocalStorage(n.IniConstants.P_TRACEFILE, yt.prop("checked") ? "Y" : "N"); f = ko({ IsAutoCommit: ci.prop("checked") ? "Y" : "N", IsShowAcct: lt.prop("checked") ? "Y" : "N", IsShowTrl: it.prop("checked") ? "Y" : "N", IsShowAdvanced: vt.prop("checked") ? "Y" : "N" }) } function uf(n) { for (var u, r, e = n.length, f = "", i = 0; i < e; i += 1) { for (f += "<tr class='VIS_Pref-tbl-Row'>", u = 0; u < n[i].length; u += 1)r = n[i][u], f += u == 0 ? i % 2 ? "<td class='VIS_Pref_table-row2'>" + r + "<\/td>" : "<td class='VIS_Pref_table-row1'>" + r + "<\/td>" : u == n[i].length - 1 ? i % 2 ? "<td class='VIS_Pref_table-row2'>" + r + "<\/td>" : "<td class='VIS_Pref_table-row1'>" + r + "<\/td>" : i % 2 ? "<td class='VIS_Pref_table-row2'>" + r + "<\/td>" : "<td class='VIS_Pref_table-row1'>" + r + "<\/td>"; f += " <\/tr>" } ft.find("tbody > tr").eq(0).after(t.parseHTML(f)); vu = null; f = null } function bo() { lt.prop("checked", n.Env.getCtx().ctx["#ShowAcct"] == "Y" ? !0 : !1); it.prop("checked", n.Env.getCtx().ctx["#ShowTrl"] == "Y" ? !0 : !1); vt.prop("checked", n.Env.getCtx().ctx["#ShowAdvanced"] == "Y" ? !0 : !1) } function ko(i) { var r = null; yr != null && (n.dataContext.postJSONData(n.Application.contextUrl + "Theme/SaveForUser", { id: yr, uid: n.context.getAD_User_ID() }, function () { }), n.Application.theme = pr); t.ajax({ url: n.Application.contextUrl + "UserPreference/SavePrefrence", type: "POST", datatype: "json", contentType: "application/json; charset=utf-8", async: !1, data: JSON.stringify({ pref: i }) }).done(function (n) { r = n; s.dialog("close") }) } var ff, ef, of, sf, hf, cf, lf, af, vf, yf, pf, wf, bf, kf, df, gf, ne, te, ie, re, ue, fe, ee, oe, se, he, ce, le, ae, ve, ye, pe, wu, we, be, ke, de, ge, no, to, du, lu, cu, su, pu, au, gu, bu; ci = wi.find("#chkAutoCommit_" + r); ir = wi.find("#chkStorePassword_" + r); li = wi.find("#chkAutoLogin_" + r); it = wi.find("#chkShowTranslationTab_" + r); lt = wi.find("#chkShowAccountingTab_" + r); at = wi.find("#chkAutoNewRecord_" + r); vt = wi.find("#chkShowAdvancedTab_" + r); rr = wi.find("#chkCacheWindows_" + r); w = wi.find("#cmbTraceLevel_" + r); yt = wi.find("#chkTraceFile_" + r); ai = wi.find("#dt_Date_" + r); dr = wi.find("#chkDictionaryMaintain_" + r); rt = wi.find("#cmbClientOrg_" + r); pt = wi.find("#chkShowMiniGrid_" + r); b = wi.find("#cmbPageSize_" + r); wt = wi.find("#chkNativeDigit_" + r); ut = wi.find("#cmbWindowPageSize_" + r); ur = wi.find("#lblVariableName_" + r); fr = wi.find("#lblVariableValue_" + r); et = wi.find("#btnOk_" + r); ot = wi.find("#btnCancel_" + r); er = wi.find("#btnRole_" + r); pi = wi.find("#contextlst_" + r); ft = wi.find("#prefErrortbl_" + r); et.hide(); ot.hide(); gr = wi.find("#btnChangePws_" + r); bi = wi.find("#txtCurrentPws_" + r); dt = wi.find("#txtNewPws_" + r); gt = wi.find("#txtConformPws_" + r); or = wi.find("#chkIsEmail_" + r); sr = wi.find("#chkIsNotice_" + r); hr = wi.find("#chkIsSMS_" + r); cr = wi.find("#chkIsFax_" + r); ki = wi.find("#txtUserName_" + r); di = wi.find("#txtPws_" + r); lr = wi.find("#btnEmailConfig_" + r); ar = wi.find("#btnSubstitute_" + r); vr = wi.find("#btnSaveChanges_" + r); nu = wi.find("#btnSaveChangePassword_" + r); iu = wi.find("#lblPrefSave_" + r); tu = wi.find("#btnSave_" + r); ru = wi.find("#vbtnGmailAuth_" + r); ti = wi.find("#vbtnSyncGmailTask_" + r); d = wi.find("#txtAuthCode_" + r); ii = wi.find("#chkIsSyncBackground_" + r); e = wi.find("#lblTaskSettingMessage_" + r); e.hide(); uu = wi.find("#vbtnGmailCalAuth_" + r); ui = wi.find("#vbtnSyncGmailCalendar_" + r); y = wi.find("#txtCalAuthCode_" + r); g = wi.find("#chkCalIsSyncBackground_" + r); o = wi.find("#lblCalendarSettingMessage_" + r); o.hide(); fu = wi.find("#vbtnGmailContactAuth_" + r); ei = wi.find("#vbtnSyncGmailContact_" + r); nt = wi.find("#txtContactAuthCode_" + r); u = wi.find("#lblContactSettingMessage_" + r); u.hide(); co(); ht = wi.find("#txtGmailUserName_" + r); ct = wi.find("#txtGmailPassword_" + r); si = wi.find("#cmbSettingRole_" + r); nr = wi.find("#chkbxUpdateExisting_" + r); eu = wi.find("#vbtnSyncGmailContact_" + r); u = wi.find("#lblContactSettingMessage_" + r); u.hide(); vo(); l = wi.find("#cmbRole_" + r); l.on("change", function () { wr() }); a = wi.find("#cmbClient_" + r); a.on("change", function () { br() }); h = wi.find("#cmbOrg_" + r); h.on("change", function () { kr() }); p = wi.find("#cmbWareHouse_" + r); $btnTheme = wi.find("#btnTheme_" + r); v = {}; hu(); lo(); var uo = wi.find("#lblUserSetMenu_" + r), fo = wi.find("#lblPreferenceMenu_" + r), eo = wi.find("#lblContextMenu_" + r), oo = wi.find("#lblErrorMenu_" + r); if (uo.text(n.Msg.getMsg("UserSetting")), fo.text(n.Msg.getMsg("Preference")), eo.text(n.Msg.getMsg("Context")), oo.text(n.Msg.getMsg("PreferenceError")), ff = wi.find("#lblchangePwsHeader_" + r), ff.text(n.Msg.getMsg("ChangePassword")), ef = wi.find("#lblAutoMatic_" + r), ef.text(n.Msg.getMsg("AutoCommit")), of = wi.find("#imgAutoMatic_" + r), of.text(n.Msg.getMsg("AutoCommit", !0)), sf = wi.find("#lblTranslation_" + r), sf.text(n.Msg.getMsg("ShowTranslationTab")), hf = wi.find("#imgTranslation_" + r), hf.text(n.Msg.getMsg("ShowTranslationTab")), cf = wi.find("#lblShowAccounting_" + r), cf.text(n.Msg.getMsg("ShowAcctTab")), lf = wi.find("#imgShowAccounting_" + r), lf.text(n.Msg.getMsg("ShowAcctTab")), af = wi.find("#lblAutoNewRecord_" + r), af.text(n.Msg.getMsg("AutoNew")), vf = wi.find("#imgAutoNewRecord_" + r), vf.text(n.Msg.getMsg("AutoNew")), yf = wi.find("#lblShowAdvanced_" + r), yf.text(n.Msg.getMsg("ShowAdvancedTab")), pf = wi.find("#imgShowAdvanced_" + r), pf.text(n.Msg.getMsg("ShowAdvancedTab")), wf = wi.find("#lblCacheWindows_" + r), wf.text(n.Msg.getMsg("CacheWindow")), bf = wi.find("#imgCacheWindows_" + r), bf.text(n.Msg.getMsg("CacheWindow")), kf = wi.find("#vlblClientOrg_" + r), kf.text(n.Msg.getMsg("Show")), df = wi.find("#imgClientOrg_" + r), df.text(n.Msg.getMsg("ClientOrg")), gf = wi.find("#lblWindowPageSize_" + r), gf.text(n.Msg.getMsg("WindowPageSize")), ne = wi.find("#imgWindowPageSize_" + r), ne.text(n.Msg.getMsg("WindowPageSize")), te = wi.find("#lblAutoLogin_" + r), te.text(n.Msg.getMsg("AutoLogin")), ie = wi.find("#imgAutoLogin_" + r), ie.text(n.Msg.getMsg("AutoLogin")), re = wi.find("#lblStorePassword_" + r), re.text(n.Msg.getMsg("StorePassword")), ue = wi.find("#imgStorePassword_" + r), ue.text(n.Msg.getMsg("StorePassword")), fe = wi.find("#lblTraceLevel_" + r), fe.text(n.Msg.getMsg("TraceLevel")), ee = wi.find("#imgTraceLevel_" + r), ee.text(n.Msg.getMsg("TraceLevel")), oe = wi.find("#lblTraceFile_" + r), oe.text(n.Msg.getMsg("TraceFile")), se = wi.find("#imgTraceFile_" + r), se.text(n.Msg.getMsg("TraceFile")), he = wi.find("#lblNativeDigit_" + r), he.text(n.Msg.getMsg("PrintNativeDigits")), ce = wi.find("#imgNativeDigit_" + r), ce.text(n.Msg.getMsg("PrintNativeDigits")), le = wi.find("#vlblDateText_" + r), le.text(n.Msg.getMsg("Date")), ae = wi.find("#imgDateText_" + r), ae.text(n.Msg.getMsg("Date")), ve = wi.find("#vlblthemeText_" + r), ve.text(n.Msg.getMsg("SelectTheme")), ye = wi.find("#imgThemetext" + r), ye.text(n.Msg.getMsg("SelectTheme")), hi = wi.find("#vis_pref_theme" + r), ou = hi.find("ul"), wu = wi.find("#vlblPageSize_" + r), wu.text(n.Msg.getMsg("Pagesize")), pe = wi.find("#imgPageSize_" + r), pe.text(n.Msg.getMsg("Pagesize")), wu = wi.find("#vlblPageSize_" + r), wu.text(n.Msg.getMsg("Pagesize")), we = wi.find("#lblContext_" + r), we.text(n.Msg.getMsg("Context")), c = wi.find("#lblRecordSave_" + r), f = wi.find("#lblChangePasswordMessage_" + r), c.hide(), iu.hide(), f.hide(), be = wi.find("#pchangePws_" + r), be.text(n.Msg.getMsg("PPasswordInfo")), ke = wi.find("#pNotification_" + r), ke.text(n.Msg.getMsg("PNotificationInfo")), de = wi.find("#pEmailConfig_" + r), de.text(n.Msg.getMsg("PEmailConfigInfo")), ge = wi.find("#pSubstitute_" + r), ge.text(n.Msg.getMsg("PSubstituteInfo")), no = wi.find("#pContext_" + r), no.text(n.Msg.getMsg("PContextInfo")), to = wi.find("#pError_" + r), to.text(n.Msg.getMsg("PErrorInfo")), w != null) { var ku = [n.Logging.Level.OFF.getIntValue(), n.Logging.Level.SEVERE.getIntValue(), n.Logging.Level.WARNING.getIntValue(), n.Logging.Level.INFO.getIntValue(), n.Logging.Level.CONFIG.getIntValue(), n.Logging.Level.FINE.getIntValue(), n.Logging.Level.FINER.getIntValue(), n.Logging.Level.FINEST.getIntValue(), n.Logging.Level.ALL.getIntValue()], so = [n.Logging.Level.OFF.getName(), n.Logging.Level.SEVERE.getName(), n.Logging.Level.WARNING.getName(), n.Logging.Level.INFO.getName(), n.Logging.Level.CONFIG.getName(), n.Logging.Level.FINE.getName(), n.Logging.Level.FINER.getName(), n.Logging.Level.FINEST.getName(), n.Logging.Level.ALL.getName()], cu = 0; for (su = 0; su < ku.length; su++)w.append(" <option value=" + ku[su] + ">" + so[su] + "<\/option>"), n.Ini.getLocalStorage(n.IniConstants.P_TRACELEVEL) == ku[su] && (cu = su); w.prop("selectedIndex", cu) } if (rt != null) { for (du = [n.Msg.getMsg("Client+Org"), n.Msg.getMsg("Client"), n.Msg.getMsg("Org"), n.Msg.getMsg("None")], cu = 0, su = 0; su < du.length; su++)rt.append("<option>" + du[su] + "<\/option>"), n.Ini.getLocalStorage(n.IniConstants.CO_SHOWLEVEL) == su && (cu = su); rt.prop("selectedIndex", cu) } if (b != null) { for (lu = [5, 6, 7, 8, 9, 10], cu = 0, su = 0; su < lu.length; su++)b.append("<option>" + lu[su] + "<\/option>"), n.Ini.getLocalStorage(n.IniConstants.W_PAGESIZE) == lu[su] && (cu = su); b.prop("selectedIndex", cu) } if (ut != null) { for (lu = [50, 100, 500], cu = 0, su = 0; su < lu.length; su++)ut.append("<option>" + lu[su] + "<\/option>"), n.Ini.getLocalStorage(n.IniConstants.WIN_PAGESIZE) == lu[su] && (cu = su); ut.prop("selectedIndex", cu) } if (pi != null) { var vu = n.context.getEntireCtx(), yu = [], su = 0, ho = Object.keys(vu).length; for (pu = 0; pu < ho; pu += 1)yu[su++] = ' <li class="VIS_Pref_li-err" ><span >', yu[su++] = Object.keys(vu)[pu] + " == " + vu[Object.keys(vu)[pu]], yu[su++] = "<\/span><\/li>"; pi.append(yu.join("")); vu = null; yu = null } k = wi.find("#vchkErrorOnly_" + r); bt = wi.find("#vbtnReset_" + r); kt = wi.find("#vbtnSaveToFile_" + r); n.context && !n.context.getAD_Role_ID() == 0 && wi.find(".VIS_Pref_err_btnLeft").hide(); vi = wi.find("#vbtnLogDate_" + r); yi = wi.find("#vbtnDownLog_" + r); io(vi); yi.on("click", function () { var i = vi.val(); i = i ? new Date(i).toISOString() : (new Date).toISOString(); nf(!0); t.ajax({ type: "POST", url: n.Application.contextUrl + "UserPreference/DownloadServerLog", dataType: "json", data: { logDate: i }, success: function (t) { if (t) { var i = "TempDownload/" + t; window.open(n.Application.contextUrl + i); io(vi) } else n.ADialog.info("VIS_NoLogFound", null, null); nf(!1) }, error: function () { nf(!1) } }) }); k.prop("checked", !0); ft != null && (au = n.Logging.VLogErrorBuffer.get(!0).getLogData(k.prop("checked")), ni = au, uf(au)); hi.on("click", "div.vis-theme-rec", function (i) { var r = t(i.currentTarget); pr = r.data("color"); yr = Number(r.data("id")); n.themeMgr && n.themeMgr.applyTheme(pr) }); $btnTheme.on("click", function () { var t = new n.ThemeCnfgtor; t.show() }); kt.on("click", function () { var i, n, r, u; if (au = ni, au.length > 0) { for (i = "", n = 0; n < au.length; n++)i += au[n] + "\n"; r = (new Date).toISOString().slice(0, 19).replace(/-/g, ""); u = "data:text/csv;base64," + window.btoa(i); t(this).attr("href", u).attr("download", "file-" + r + ".csv") } }); bo(); ci.prop("checked", n.Env.getCtx().isAutoCommit()); at.prop("checked", n.Env.getCtx().isAutoNew()); li.prop("checked", n.Ini.getLocalStorage(n.IniConstants.P_A_LOGIN) == "N" ? !1 : !0); ir.prop("checked", n.Ini.getLocalStorage(n.IniConstants.P_STORE_PWD) == "N" ? !1 : !0); pt.prop("checked", n.Ini.getLocalStorage(n.IniConstants.P_Show_Mini_Grid) == "N" ? !1 : !0); wt.prop("checked", n.Ini.getLocalStorage(n.IniConstants.P_Print_Native_Digits) == "Y" ? !0 : !1); rr.prop("checked", n.Ini.getLocalStorage(n.IniConstants.P_CACHE_WINDOW) == "Y" ? !0 : !1); yt.prop("checked", n.Ini.getLocalStorage(n.IniConstants.P_TRACEFILE) == "Y" ? !0 : !1); gu = new Date(Number(n.Env.getCtx().ctx["#Date"])); gu != null && ai.val(Globalize.format(gu, "yyyy-MM-dd")); pi.on("click", "li", function () { var n = t(this).text().split("==")[0], i = t(this).text().split("==")[1]; ur.text(n.toString()); fr.text(i.toString()) }); t(".VIS_Pref_meni li").on("click", function () { t(".VIS_Pref_menu li").removeClass("active"); t(this).addClass("active") }); bt.on("click", function () { var t = n.Logging.VLogErrorBuffer.get(!0).resetBuffer(k.prop("checked")); ni = t; t != null ? uf(t) : ft.find("tr:gt(0)").remove() }); t(".VIS_Pref_btn-pass-click").on("click", function () { t(".VIS_Pref_new-password").css("display", "block"); t(".VIS_Pref_Save").css("display", "block") }); t(".VIS_Pref_close-btn").click(function () { t(".VIS_Pref_new-password").css("display", "none"); t(".VIS_Pref_Save").css("display", "none") }); t(".VIS_Pref_link-1").click(function () { t(".VIS_Pref_content-right").css("display", "block"); t(".VIS_Pref_content-right-2").css("display", "none"); t(".VIS_Pref_content-right-3").css("display", "none"); t(".VIS_Pref_content-right-4").css("display", "none"); t(".VIS_Pref_content-right-5").css("display", "none") }); t(".VIS_Pref_link-2").click(function () { t(".VIS_Pref_content-right").css("display", "none"); t(".VIS_Pref_content-right-2").css("display", "block"); t(".VIS_Pref_content-right-3").css("display", "none"); t(".VIS_Pref_content-right-4").css("display", "none"); t(".VIS_Pref_content-right-5").css("display", "none") }); t(".VIS_Pref_link-3").click(function () { t(".VIS_Pref_content-right").css("display", "none"); t(".VIS_Pref_content-right-2").css("display", "none"); t(".VIS_Pref_content-right-3").css("display", "block"); t(".VIS_Pref_content-right-4").css("display", "none"); t(".VIS_Pref_content-right-5").css("display", "none") }); t(".VIS_Pref_link-4").click(function () { t(".VIS_Pref_content-right").css("display", "none"); t(".VIS_Pref_content-right-2").css("display", "none"); t(".VIS_Pref_content-right-3").css("display", "none"); t(".VIS_Pref_content-right-4").css("display", "flex"); t(".VIS_Pref_content-right-5").css("display", "none") }); t(".VIS_Pref_link-5").click(function () { window.WSP ? (t(".VIS_Pref_content-right").css("display", "none"), t(".VIS_Pref_content-right-2").css("display", "none"), t(".VIS_Pref_content-right-3").css("display", "none"), t(".VIS_Pref_content-right-4").css("display", "none"), t(".VIS_Pref_content-right-5").css("display", "block")) : alert("please download WSP !!!") }); i && t(".VIS_Pref_link-5").trigger("click"); tu.on("click", function () { ro() }); et.on("click", function () { ro() }); ot.on("click", function () { s.dialog("close") }); k.on("click", function () { var t = null; ft.find("tr").slice(1, -1).remove(); t = n.Logging.VLogErrorBuffer.get(!0).getLogData(k.prop("checked")); ni = t; t != null && uf(t) }); er.on("click", function () { var t = n.MRole.toStringX(n.Env.getCtx()) }); nu.on("click", function () { var r = bi.val(), i = dt.val(), u = gt.val(), e = ki.val(), o = di.val(); if (r.length <= 0 || i.length <= 0 || u.length <= 0) { f.css("color", "red"); f.text(n.Msg.getMsg("FillMandatory")); f.show(); return } if (i != u) { f.css("color", "red"); f.text(n.Msg.getMsg("samePassword")); f.show(); return } t.ajax({ type: "POST", async: !1, url: n.Application.contextUrl + "UserPreference/SaveChangePassword", dataType: "json", data: { AD_User_ID: n.context.getAD_User_ID(), currentPws: r, newPws: i }, success: function (t) { returnValue = t.result; f.show(); returnValue == "OK" ? (f.css("color", "green"), f.text(n.Msg.getMsg("Passwordchanged"))) : (f.css("color", "red"), f.text(returnValue)) } }) }); vr.on("click", function () { var i = bi.val(), r = dt.val(), u = gt.val(), v = ki.val(), y = di.val(); if ((!(i.length <= 0) || !(r.length <= 0) || !(u.length <= 0)) && (!(i.length > 0) || !(r.length > 0) || !(u.length > 0))) { c.text(n.Msg.getMsg("mandatoryFields")); return } if (dt.text().localeCompare(gt.text()) == -1) { c.text(n.Msg.getMsg("samePassword")); return } var e = l.val(), o = a.val(), s = h.val(), f = p.val(); if (e == undefined || o == undefined || s == undefined) { c.text(n.Msg.getMsg("VIS_FillLogin")); return } f == undefined && (f = 0); t.ajax({ type: "POST", async: !1, url: n.Application.contextUrl + "UserPreference/SaveUserSettings", dataType: "json", data: { AD_User_ID: n.context.getAD_User_ID(), currentPws: i, newPws: r, conformPws: u, chkEmail: or.prop("checked"), chkNotice: sr.prop("checked"), chkSMS: hr.prop("checked"), chkFax: cr.prop("checked"), emailUserName: v, emailPws: y, AD_Role_ID: e, AD_Client_ID: o, AD_Org_ID: s, M_Warehouse_ID: f }, success: function (n) { returnValue = n.result; c.show(); c.css("color", "green"); c.text(returnValue.Msg); returnValue.IsSaved || c.css("color", "red") } }) }); lr.on("click", function () { var t = 0, i; try { t = n.dataContext.getJSONData(n.Application.contextUrl + "UserPreference/GetWindowID", { WindowName: "Mail Configuration" }, null); t > 0 && (i = new n.Query, i.addRestriction("AD_User_ID", n.Query.prototype.EQUAL, n.context.getAD_User_ID()), n.viewManager.startWindow(t, i)) } catch (r) { this.log.log(n.Logging.Level.SEVERE, sql, r) } s.dialog("close") }); ar.on("click", function () { var t = 0, i; try { t = n.dataContext.getJSONData(n.Application.contextUrl + "UserPreference/GetWindowID", { WindowName: "User Substitute" }, null); t > 0 && (i = new n.Query, i.addRestriction("AD_User_ID", n.Query.prototype.EQUAL, n.context.getAD_User_ID()), n.viewManager.startWindow(t, i)) } catch (r) { this.log.log(n.Logging.Level.SEVERE, sql, r) } s.dialog("close") }); ru.on("click", function () { tf(!0, !1) }); ti.on("click", function () { e.css("color", "gray"); e.text(n.Msg.getMsg("PleaseWait")); e.show(); window.setTimeout(function () { rf(!0, gi, d.val(), ri, !1) }, 500) }); ii.on("click", function (n) { gi = n.originalEvent.target.checked }); fu.on("click", function () { tf(!1, !0) }); ei.on("click", function () { u.css("color", "gray"); u.text(n.Msg.getMsg("PleaseWait")); u.show(); window.setTimeout(function () { rf(!1, !1, nt.val(), oi, !0) }, 500) }); uu.on("click", function () { tf(!1, !1) }); ui.on("click", function () { o.css("color", "gray"); o.text(n.Msg.getMsg("PleaseWait")); o.show(); window.setTimeout(function () { rf(!1, st, y.val(), fi, !1) }, 500) }); g.on("click", function (n) { st = n.originalEvent.target.checked }); nr.on("click", function (n) { tr = n.originalEvent.target.checked }); eu.on("click", function () { ht.val() && ht.val() != "" && ht.val().length != 0 && ct.val() && ct.val() != "" && ct.val().length != 0 && (u.css("color", "gray"), u.text(n.Msg.getMsg("PleaseWait")), u.show(), window.setTimeout(function () { wo(ht.val(), ct.val(), si.val(), tr) }, 500)) }); bu = null }; var hu = function () { t.ajax({ url: n.Application.contextUrl + "UserPreference/GetDefaultLogin", dataType: "json", data: { AD_User_ID: n.context.getAD_User_ID() }, success: function (n) { var t = JSON.parse(n); v.AD_Role_ID = t.AD_Role_ID; v.AD_Client_ID = t.AD_Client_ID; v.AD_Org_ID = t.AD_Org_ID; v.M_Warehouse_ID = t.M_Warehouse_ID; su() } }) }, su = function () { t.ajax({ url: n.Application.contextUrl + "UserPreference/GetUserRoles", dataType: "json", data: { sql: "" }, success: function (n) { var t = JSON.parse(n), i = ""; for (var r in t) i += "<option value=" + t[r].RecKey + ">" + t[r].Name + "<\/option>"; l.append(i); l.val(v.AD_Role_ID); i = null; t = null; wr() } }) }, wr = function () { var i = l.val(), r; (a.empty(), h.empty(), p.empty(), i != undefined) && (r = i, i = null, t.ajax({ url: n.Application.contextUrl + "UserPreference/GetLoginData", dataType: "json", data: { sql: r }, success: function (n) { var t = JSON.parse(n), i = ""; for (var u in t) i += "<option value=" + t[u].RecKey + ">" + t[u].Name + "<\/option>"; a.append(i); a.val(v.AD_Client_ID); i = null; t = null; r = null; br() } })) }, br = function () { var i = l.val(), r = a.val(), u; (h.empty(), p.empty(), i != undefined && r != undefined) && (u = "", t.ajax({ url: n.Application.contextUrl + "UserPreference/GetOrgData", dataType: "json", data: { roleId: i, clientId: r }, success: function (n) { var t = JSON.parse(n), f = ""; for (var e in t) f += "<option value=" + t[e].RecKey + ">" + t[e].Name + "<\/option>"; h.append(f); h.val(v.AD_Org_ID); f = null; t = null; u = null; i = null; r = null; kr() } })) }, kr = function () { var i = h.val(); (p.empty(), i != undefined) && t.ajax({ url: n.Application.contextUrl + "UserPreference/GetWarehouseData", dataType: "json", data: { orgId: i }, success: function (n) { var t = JSON.parse(n), r = ""; for (var u in t) r += "<option value=" + t[u].RecKey + ">" + t[u].Name + "<\/option>"; p.append(r); p.val(v.M_Warehouse_ID); r = null; t = null; sql = null; i = null } }) }; this.showDialog = function () { var i = t(window).width() - 150, r = t(window).height() - 40; tt.height(r); tt.width(i); s.append(tt); s.dialog({ modal: !1, title: n.Msg.getMsg("Preference"), width: i, height: r, position: { at: "center top", of: window }, close: function () { n.Application.theme && n.Application.theme != "" && n.themeMgr.applyTheme(n.Application.theme); wi.dispose(); s.dialog("destroy"); t("#ui-datepicker-div").remove(); s = null; wi = null } }) }; this.show = function () { this.load(); this.showDialog() }; this.disposeComponent = function () { wi = null; hi && hi.off("click"); et && et.off("click"); ot && ot.off("click"); bt && bt.off("click"); kt && kt.off("click"); yi && yi.off("click"); li = null; it = null; lt = null; at = null; vt = null; yt = null; w = null; ni = null; dr = null; rt = null; pt = null; b = null; wt = null; ut = null; ur = null; fr = null; it = null; k = null; bt = null; kt = null; ft = null; er = null; et = null; ot = null; gr = null; bi = null; dt = null; gt = null; or = null; sr = null; hr = null; cr = null; ki = null; di = null; lr = null; ar = null; vr = null; lblUserSetMenu = null; lblPreferenceMenu = null; lblContextMenu = null; lblErrorMenu = null; lblchangePwsHeader = null; lblAutoMatic = null; imgAutoMatic = null; lblTranslation = null; imgTranslation = null; lblShowAccounting = null; imgShowAccounting = null; lblAutoNewRecord = null; imgAutoNewRecord = null; lblShowAdvanced = null; imgShowAdvanced = null; lblCacheWindows = null; imgCacheWindows = null; vlblClientOrg = null; imgClientOrg = null; lblWindowPageSize = null; imgWindowPageSize = null; lblAutoLogin = null; imgAutoLogin = null; lblStorePassword = null; imgStorePassword = null; lblTraceLevel = null; imgTraceLevel = null; lblTraceFile = null; imgTraceFile = null; lblNativeDigit = null; imgNativeDigit = null; vlblDateText = null; imgDateText = null; vlblPageSize = null; imgPageSize = null; vlblPageSize = null; lblContext = null; ai.datepicker("destroy"); ai = null; l.off("change"); a.off("change"); h.off("change"); l = null; a = null; h = null; p = null; su = null; br = null; wr = null; kr = null; this.disposeComponent = null } } n.Framework = n.Framework || {}; i.prototype.dispose = function () { this.disposeComponent(); this.frame && this.frame.dispose(); this.frame = null }; n.Framework.UserPreference = i }(VIS, jQuery), function (n, t) { function i(i, r) { var e = this, u = t("<div>"), h = t('<div class="vis-busyindicatorouterwrap"><div class="vis-busyindicatorinnerwrap"><i class="vis-busyindicatordiv"><\/i><\/div><\/div>'), f = n.Env.getWindowNo(), v = null, y = null, s = null, d, g; this.onClose = null; var nt = null, p = null, c = null, l = null, k = null, b = null, o = !1, w = null, a = null; (i == null || i == "null") && (i = 0); d = function () { u.load(n.Application.contextUrl + "VImageForm/Index/?windowno=" + f + "&ad_image_id=" + i, function () { h[0].style.visibility = "visible"; g(u); h[0].style.visibility = "hidden" }) }; g = function (t) { v = u.find("#btnOk_" + f); y = u.find("#btnCancel_" + f); s = u.find("#btnImgDelete_" + f); i > 0 ? s.css("display", "inline-block") : s.css("display", "none"); p = t.find("#fileUpload_" + f); c = t.find("#holderDiv_" + f); l = t.find("#imgUsrImage_" + f); c.css("width", w - 48); a > 180 && c.css("height", a - 180); r > 0 ? l.hide() : l[0].width > 300 && c.css("overflow", "auto"); k = t.find("#lblfileUpload_" + f); b = t.find("#chkDataBaseSave_" + f); p.on("change", function () { l.show(); var t = p[0].files[0], n = new FileReader; return n.onload = function (n) { l.removeAttr("src").attr("src", n.target.result); c.css("overflow", "auto") }, n.readAsDataURL(t), o = !0, n = null, t = null, !1 }); b.on("change", function () { return o = !0, !1 }); v.on("click", function () { if (o) { var r = new XMLHttpRequest, t = new FormData; t.append("file", p[0].files[0]); t.append("isDatabaseSave", b.prop("checked")); t.append("ad_image_id", 0); r.open("POST", n.Application.contextUrl + "VImageForm/SaveImage", !0); r.send(t); r.addEventListener("load", function (n) { var i = n.target.response, f; if (i = JSON.parse(i), f = i.result, e.onClose) e.onClose(f, o); r = null; t = null; u.dialog("close") }, !1) } else { if (e.onClose) e.onClose(i, o); u.dialog("close") } }); y.on("click", function () { u.dialog("close") }); s.on("click", function () { o = !0; var t = new XMLHttpRequest, r = new FormData; r.append("ad_image_id", i); t.open("POST", n.Application.contextUrl + "VImageForm/DeleteImage", !0); t.send(r); t.addEventListener("load", function (n) { var i = n.target.response, f; if (i = JSON.parse(i), f = i.result, e.onClose) e.onClose(f, o); t = null; r = null; u.dialog("close") }, !1) }) }; this.showDialog = function () { d(); w = t(window).width() - 150; a = t(window).height() - 40; h.height(a); h.width(w); u.append(h); u.dialog({ modal: !0, title: n.Msg.getMsg("ImageDialog"), width: w, height: a, position: { at: "center top", of: window }, close: function () { e.dispose(); e = null; u.dialog("destroy"); u = null } }) }; this.disposeComponent = function () { e = null; v && v.off("click"); y && y.off("click"); s && s.off("click"); h = null; f = null; v = null; y = null; s = null; nt = null; p = null; c = null; l = null; k = null; b = null; o = !1; w = null; a = null; this.disposeComponent = null } } i.prototype.dispose = function () { this.disposeComponent() }; n.VImageForm = i }(VIS, jQuery), function (n, t) { t.IniConstants = { log: t.Logging.VLogger.getVLogger(" VIS.Ini"), ENV_PREFIX: "env.", VIENNA_HOME: "VIENNA_HOME", VIENNA_PROPERTY_FILE: "vienna.properties", VIENNA_ENV_FILE: "viennaEnv.properties", P_UID: "ApplicationUserID", DEFAULT_UID: "UserPwd", P_PWD: "ApplicationPassword", DEFAULT_PWD: "UserPwd", P_STORE_PWD: "StorePassword", DEFAULT_STORE_PWD: !0, P_TRACELEVEL: "TraceLevel", DEFAULT_TRACELEVEL: "WARNING", P_TRACEFILE: "TraceFile", DEFAULT_TRACEFILE: !1, P_INI: "FileNameINI", DEFAULT_INI: "", P_CONNECTION: "Connection", DEFAULT_CONNECTION: "", P_A_LOGIN: "AutoLogin", DEFAULT_A_LOGIN: !1, P_A_NEW: "AutoNew", DEFAULT_A_NEW: !0, P_VIENNASYS: "ViennaSys", DEFAULT_VIENNASYS: !1, P_CACHE_WINDOW: "CacheWindow", DEFAULT_CACHE_WINDOW: !1, P_TEMP_DIR: "TempDir", DEFAULT_TEMP_DIR: "", P_ROLE: "Role", DEFAULT_ROLE: "", P_CLIENT: "Client", DEFAULT_CLIENT: "", P_ORG: "Organization", DEFAULT_ORG: "", P_WAREHOUSE: "Warehouse", DEFAULT_WAREHOUSE: "", P_TODAY: "CDate264", DEFAULT_TODAY: Date.now, P_PRINTPREVIEW: "PrintPreview", DEFAULT_PRINTPREVIEW: !0, P_WARNING: "Warning", DEFAULT_WARNING: "Do_not_change_any_of_the_data_as_they_will_have_undocumented_side_effects.", P_PRINTER: "Printer", DEFAULT_PRINTER: "", P_DBUSED: "dbused", DEFAULT_DBUSED: "", P_DB_NAME: "dbname", DEFAULT_DB_NAME: "", P_DBUSER_ID: "dbuserid", DEFAULT_DBUSER_ID: "", P_DBPWD: "dbpwd", DEFAULT_DB_PWD: "", P_DB_PORT: "dbport", DEFAULT_DB_PORT: "", P_DB_HOST: "dbhost", DEFAULT_DB_HOST: "", CO_SHOWLEVEL: "ClientOrgLevel", DEFAULT_CO_SHOWLEVEL: "2", W_PAGESIZE: "WorkSpacePageSize", DEFAULT_W_PAGESIZE: "5", WIN_PAGESIZE: "WindowPageSize", DEFAULT_WIN_PAGESIZE: "50", P_Show_Mini_Grid: "ShowMiniGrid", DEFAULT_MiniGrid_Status: !1, P_Print_Native_Digits: "PrintNativeDigits", DEFAULT_Native_Digits_Status: !0, P_WELCOME_SCREEN: "HideWelcomeScreen", DEFAULT_SCREEN_STATUS: !1, P_APP_TYPE: "AppType", DEFAULT_APP_TYPE: "VServer", P_APP_HOST: "AppHost", DEFAULT_APP_HOST: "localhost", P_APP_PORT: "AppPort", DEFAULT_APP_PORT: "2090", _VIENNASYS: "VFramworkSys", _XML_DOC_PATH: "appconn.xml", _XML_ROOT: "//connectionvar" }; t.Ini = function () { function n(n, t) { localStorage.setItem(n, t) } function i(n) { return localStorage.getItem(n) } function r() { localStorage.clear() } function u(n) { localStorage.removeItem(n) } function f() { return localStorage.getItem(t.IniConstants.P_CACHE_WINDOW) == "Y" } function e() { return t.Ini.getLocalStorage(t.IniConstants.P_TRACELEVEL) != null ? t.Logging.Level.prototype.getLevel(t.Ini.getLocalStorage(t.IniConstants.P_TRACELEVEL)) : t.Logging.Level.INFO } function o() { for (var i = [t.IniConstants.P_A_NEW, t.IniConstants.P_TRACEFILE, t.IniConstants.P_TRACELEVEL, t.IniConstants.CO_SHOWLEVEL, t.IniConstants.W_PAGESIZE, t.IniConstants.WIN_PAGESIZE, t.IniConstants.P_Show_Mini_Grid, t.IniConstants.P_Print_Native_Digits, t.IniConstants.P_A_LOGIN, t.IniConstants.P_STORE_PWD, t.IniConstants.P_CACHE_WINDOW, t.IniConstants.P_PRINTPREVIEW, t.IniConstants.P_TRACEFILE], r = {}, n = 0; n < i.length; n++)i[n] == "AutoNew" ? t.context.setContext(i[n], t.Ini.getLocalStorage(i[n]) == null ? "N" : t.Ini.getLocalStorage(i[n])) : t.context.setContext("#" + i[n], t.Ini.getLocalStorage(i[n])), r[i[n]] = t.Ini.getLocalStorage(i[n]); r["#TimezoneOffset"] = (new Date).getTimezoneOffset().toString(); r["#ClientLanguage"] = window.navigator.language; t.dataContext.updateClientCtx(r) } return { setValueToLocalStorage: n, getLocalStorage: i, clearLocalStorage: r, removeLocalStorageItem: u, updateLocalContextFromIni: o, getIsCacheWindow: f, getTraceLevel: e } }() }(jQuery, VIS), function (n, t) { function i(i, r) { function nt(n) { tt.css("display", n ? "block" : "none") } this.onClose = null; var o = i, b = this, u = t("<div style='position:relative;'>"), tt = t('<div class="vis-busyindicatorouterwrap"><div class="vis-busyindicatorinnerwrap"><i class="vis-busyindicatordiv"><\/i><\/div><\/div>'), f = n.Env.getWindowNo(), it = null, s = null, h = null, c = null, l = null, a = null, v = null, k = null, y = null, p = null, d = null, rt = null, w = null, g = null, ft = null, ut = null, e = !1, et = r; this.load = function () { u.load(n.Application.contextUrl + "Location/Locations/?windowno=" + f + "&locationId=" + o + "&AD_Language=" + n.context.getContext("#AD_Language"), function () { u.append(tt); nt(!0); b.init(); nt(!1) }) }; this.init = function () { function tt(i) { var r = null; t.ajax({ url: n.Application.contextUrl + "Location/SaveLocation", type: "POST", datatype: "json", contentType: "application/json; charset=utf-8", async: !1, data: JSON.stringify({ pref: i }) }).done(function (n) { if (r = n, o = r.locationid, ut = r.locaddress, this.location = o, nt(!1), b.onClose) b.onClose(o, e); u.dialog("close"); e = null }) } var r, i; w = u.find("#btnOk_" + f); g = u.find("#btnCancel_" + f); it = u.find("#lstLocation_" + f); s = u.find("#txtCountry_" + f); h = u.find("#txtAddress1_" + f); c = u.find("#txtAddress2_" + f); l = u.find("#txtAddress3_" + f); a = u.find("#txtAddress4_" + f); n.Application.isRTL && (w.removeClass("pull-left"), w.addClass("pull-right"), u.find("Sup").css("float", "right"), t(u.find(".cat2 a")[0]).removeClass("pull-right"), t(u.find(".cat2 a")[0]).addClass("pull-left"), t(u.find(".cat3 a")[0]).removeClass("pull-right"), t(u.find(".cat3 a")[0]).addClass("pull-left")); h.val() && h.val(h.val()); c.val() && c.val(c.val()); l.val() && (r = u.find("#aCollection"), i = u.find(".cat" + t(r).attr("data-prod-cat")), i ? i.length > 0 && i.toggle() : u.find(".cat" + t(r).attr("data-prod-close")).hide(), l.val(l.val())); a.val() && (r = u.find(".cat3").find("a")[0], i = u.find(".cat" + t(r).attr("data-prod-cat")), i ? i.length > 0 && i.toggle() : u.find(".cat" + t(r).attr("data-prod-close")).hide(), a.val(a.val())); v = u.find("#txtCity_" + f); v.val() && v.val(v.val()); k = u.find("#txtState_" + f); y = u.find("#txtZipCode_" + f); y.val() && y.val(y.val()); p = u.find("#countryhdn_" + f).val(); d = u.find("#Statehdn_" + f).val(); s.autocomplete({ source: function (i, r) { i.term.trim().length != 0 && t.ajax({ url: n.Application.contextUrl + "Location/GetCountry", dataType: "json", data: { style: "full", name_startsWith: i.term }, success: function (n) { n.result == "ok" ? r(null) : r(t.map(n.result, function (n) { return { label: n.Name, value: n.Name, id: n.Key } })) } }) }, minLength: 1, select: function (n, t) { t.item.id == 0 && s.val(""); p = t.item.id }, open: function () { u.find(this).removeClass("ui-corner-all").addClass("ui-corner-top") }, close: function () { u.find(this).removeClass("ui-corner-top").addClass("ui-corner-all"); Number(p) > 0 ? e = !0 : s.val("") } }); k.autocomplete({ source: function (i, r) { i.term.trim().length != 0 && t.ajax({ url: n.Application.contextUrl + "Location/GetStates", dataType: "json", data: { style: "full", name_startsWith: i.term, countryId: p }, success: function (n) { n.result == "ok" ? r(null) : r(t.map(n.result, function (n) { return { label: n.Name, value: n.Name, id: n.Key } })) } }) }, minLength: 1, select: function (n, t) { d = t.item.id }, open: function () { u.find(this).removeClass("ui-corner-all").addClass("ui-corner-top") }, close: function () { u.find(this).removeClass("ui-corner-top").addClass("ui-corner-all") } }); it.autocomplete({ source: function (i, r) { i.term.trim().length != 0 && t.ajax({ url: n.Application.contextUrl + "Location/GetAddresses", dataType: "json", data: { style: "full", name_startsWith: i.term }, success: function (n) { n.result == "ok" ? r(null) : r(t.map(n.result, function (n) { return { label: n.ADDRESS, value: n.ADDRESS, C_COUNTRY_ID: n.C_COUNTRY_ID, C_LOCATION_ID: n.C_LOCATION_ID, C_REGION_ID: n.C_REGION_ID, COUNTRYNAME: n.COUNTRYNAME, ADDRESS1: n.ADDRESS1, ADDRESS2: n.ADDRESS2, ADDRESS3: n.ADDRESS3, ADDRESS4: n.ADDRESS4, CITYNAME: n.CITYNAME, STATENAME: n.STATENAME, ZIPCODE: n.ZIPCODE } })) } }) }, minLength: 1, select: function (n, t) { s.val(t.item.COUNTRYNAME); h.val(t.item.ADDRESS1); c.val(t.item.ADDRESS2); l.val(t.item.ADDRESS3); a.val(t.item.ADDRESS4); v.val(t.item.CITYNAME); k.val(t.item.STATENAME); y.val(t.item.ZIPCODE); e = !0; d = t.item.C_REGION_ID; o = 0; rt = 0; p = t.item.C_COUNTRY_ID }, open: function () { u.find(this).removeClass("ui-corner-all").addClass("ui-corner-top") }, close: function () { u.find(this).removeClass("ui-corner-top").addClass("ui-corner-all") } }); w.on("click", function () { if (nt(!0), Number(p) <= 0) { n.ADialog.warn("SelectCountry", !0, null); nt(!1); return } et && e && (o = 0); var t = { countryName: s.val(), addvalue1: h.val(), addvalue2: c.val(), addvalue3: l.val(), addvalue4: a.val(), cityValue: v.val(), stateValue: k.val(), zipValue: y.val(), clocationId: o, countryId: p, stateId: d, cityId: rt }, i = tt(t) }); g.on("click", function () { u.dialog("close") }); u.find(".VIS-Location-toggler").click(function (n) { n.preventDefault(); var t = u.find(".cat" + u.find(this).attr("data-prod-cat")); t && t.length > 0 ? t.toggle() : u.find(".cat" + u.find(this).attr("data-prod-close")).hide() }); s.bind("change", function () { e = !0 }); h.bind("change", function () { e = !0 }); c.bind("change", function () { e = !0 }); l.bind("change", function () { e = !0 }); a.bind("change", function () { e = !0 }); v.bind("change", function () { e = !0 }); k.bind("change", function () { e = !0 }); y.bind("change", function () { e = !0 }) }; this.showDialog = function () { u.append(tt); u.dialog({ modal: !0, resizable: !1, title: n.Msg.getMsg("Location"), closeText: n.Msg.getMsg("close"), width: 620, position: { at: "center top", of: window }, close: function () { b.dispose(); b = null; u.dialog("destroy"); u = null } }) }; this.disposeComponent = function () { b = null; w && w.off("click"); g && g.off("click"); o = 0; it = null; s = null; h = null; c = null; l = null; a = null; v = null; k = null; y = null; p = null; d = null; rt = null; w = null; g = null; ft = null; ut = null; this.disposeComponent = null } } i.prototype.dispose = function () { this.disposeComponent() }; n.LocationForm = i }(VIS, jQuery), function (n, t) { function i(i, r, u, f, e, o) { function pt() { function o() { var n = nt.prop("checked"); n ? (it.hide(), rt.show(), v.removeClass("vis-gc-vpanel-table-readOnly"), y.removeClass("vis-gc-vpanel-table-readOnly"), p.removeClass("vis-gc-vpanel-table-readOnly"), w.removeClass("vis-gc-vpanel-table-readOnly"), c.removeClass("vis-gc-vpanel-table-readOnly"), c.removeAttr("disabled")) : (rt.hide(), it.show(), v.addClass("vis-gc-vpanel-table-readOnly"), y.addClass("vis-gc-vpanel-table-readOnly"), p.addClass("vis-gc-vpanel-table-readOnly"), w.addClass("vis-gc-vpanel-table-readOnly"), c.addClass("vis-gc-vpanel-table-readOnly"), c.attr("disabled", !0)); v.attr("readonly", !n); y.attr("readonly", !n); p.attr("readonly", !n); w.attr("readonly", !n) } function r() { var n = c.find("option:selected").text() + " " + g + " " + v.val() + " " + g + " " + y.val() + " " + g + " " + p.val(); w.val(n) } function lt() { d.on("click", function () { if (wt(), k.onClose) k.onClose(u); s.dialog("close") }); b.on("click", function () { s.dialog("close") }); nt.change(function () { o() }); ut.change(function () { }); v.change(function () { r() }); y.change(function () { r() }); p.change(function () { r() }); c.change(function () { r() }); ft.on("click", function () { l.val() == "" ? (l.autocomplete({ source: t.map(a.data, function (n) { return { label: n.Name, value: n.Name, locatorID: n.Key } }), minLength: 0 }).bind("focus", function () { l.val().length == 0 && l.autocomplete("search", "") }), l.trigger("focus")) : l.autocomplete("search") }) } var i, e; if (d = s.find("#btnOk_" + h), b = s.find("#btnCancel_" + h), vt = s.find("#cmbLocator_" + h), l = s.find("#lstLocator_" + h), ft = s.find("#locatorSearch_" + h), nt = s.find("#chkCreateNew_" + h), ut = s.find("#txtWarehouseInfo_" + h), c = s.find("#cmbWarehouse_" + h), v = s.find("#txtX_" + h), y = s.find("#txtY_" + h), p = s.find("#txtZ_" + h), w = s.find("#txtValue_" + h), tt = s.find("#divchkCreateNew_" + h), it = s.find("#divWarehouseInfo_" + h), rt = s.find("#divWarehouse_" + h), et = s.find("#lblX_" + h), ot = s.find("#lblY_" + h), st = s.find("#lblZ_" + h), ht = s.find("#lblValue_" + h), ct = s.find("#lblWarehouse_" + h), n.Application.isRTL && (b.css("margin-right", "10px"), tt.children(0).css("float", "left")), a.refresh(), a.fillCombobox(f, !0, !0, !1), i = n.dataContext.getJSONData(n.Application.contextUrl + "Locator/GetWarehouse", { Warehouse_ID: at }, null), i != null) for (e in i) c.append(" <option value=" + i[e].M_Warehouse_ID + ">" + i[e].Name + "<\/option>"); c.prop("selectedIndex", 0); a.data.length > 0 && u == 0 && (u = a.data[0].Key); yt(i); l.autocomplete({ source: function (n, i) { (n == null || n.term == null || n.term.trim().length != 0) && a.data.length > 0 && i(t.map(a.data, function (n) { return { label: n.Name, value: n.Name, locatorID: n.Key } })) }, minLength: 1, select: function (n, t) { u = t.item.locatorID; yt(i) }, open: function () { t(this).removeClass("ui-corner-all").addClass("ui-corner-top") }, close: function () { t(this).removeClass("ui-corner-top").addClass("ui-corner-all") } }); a.getIsOnlyOutgoing() && tt.hide(); o(); lt() } function wt() { var i; if (nt.prop("checked")) { i = ""; w.val().trim().length == 0 && (i += ht.val() + " - "); v.val().trim().length == 0 && (i += et.val() + " - "); y.val().trim().length == 0 && (i += ot.val() + " - "); p.val().trim().length == 0 && (i += st.val() + " - "); var f = ct.val(), o = w.val(), s = v.val(), h = y.val(), l = p.val(), r = c.find("option:selected").val(); r != 0 && e != r && (e = r); e == 0 && (i += f + " - "); i.length != 0 ? n.ADialog.error("FillMandatory", !0, i.substring(0, i.length - 3)) : t.ajax({ url: n.Application.contextUrl + "Locator/Save", dataType: "json", async: !1, data: { warehouseId: e, tValue: o, tX: s, tY: h, tZ: l }, success: function (n) { returnValue = n.locatorId; u = returnValue; a.refresh() } }) } else k.change = !0 } function yt(t) { var f = "", s = "", i = n.dataContext.getJSONData(n.Application.contextUrl + "Locator/GetWarehouseData", { Locator_ID: u }, null), o, r; if (t != null && i != null && (ut.val(i.Name), v.val(i.x), y.val(i.y), p.val(i.z), w.val(i.Value), e = i.M_Warehouse_ID, s = i.wValue, f = i.Separator, l.length > 0 && (l[0].value = i.Name + "_" + i.Value + "(" + i.x + i.Separator + i.y + i.Separator + i.z + ")")), g = f, o = i.Value, w.val(o), t != null) for (r in t) if (e == t[r].M_Warehouse_ID) { c.prop("selectedIndex", r); break } } this.onClose = null; this.change = !1; var s = t("<div style='position:relative;'>"), lt = t('<div class="vis-busyindicatorouterwrap"><div class="vis-busyindicatorinnerwrap"><i class="vis-busyindicatordiv"><\/i><\/div><\/div>'), d = null, b = null, k = this, g = null, i = i, u = u, f = f, at = e, e = 0, h = o, a = r, l = null, ft = null, vt = null, nt = null, tt = null, it = null, rt = null, ut = null, c = null, v = null, y = null, p = null, w = null, et = null, ot = null, st = null, ht = null, ct = null; setBusy = function (n) { lt.css("display", n ? "block" : "none") }; this.load = function () { s.load(n.Application.contextUrl + "Locator/Index/?windowno=" + h + "&locatorId=" + u, function () { setBusy(!0); pt(); setBusy(!1) }) }; this.showDialog = function () { s.append(lt); s.dialog({ modal: !0, resizable: !1, title: n.Msg.translate(n.Env.getCtx(), "Locator"), width: 510, position: { at: "center top", of: window }, close: function () { k.dispose(); k = null; s.dialog("destroy"); s = null } }) }; this.disposeComponent = function () { d && d.off("click"); b && b.off("click"); d = null; b = null; k = null; l = null; ft = null; i = null; u = null; f = null; at = null; e = null; h = null; a = null; tt = null; it = null; rt = null; vt = null; nt = null; ut = null; c = null; v = null; y = null; p = null; w = null; et = null; ot = null; st = null; ht = null; ct = null; this.disposeComponent = null; this.load = null; g = null } } i.prototype.dispose = function () { this.disposeComponent() }; n.LocatorForm = i }(VIS, jQuery), function (n, t) { function i(i, r, u) { function o(n) { s.css("display", n ? "block" : "none") } function h(n) { var t = '<div class="vis-valpreferencedatawrp" id="fisrt_' + n.windowNum + '"><div class="input-group vis-input-wrap" style="flex: 1;"><div class="vis-control-wrap"><input class="VIS_Pref_pass vis-gc-vpanel-table-readOnly" data-placeholder="" placeholder=" " style="margin-bottom: 0;" type="text" readonly="true" id="vtxtAttribute_' + n.windowNum + '" /><label class=" VIS_Pref_Label_Font" id="vlblAttributeText_' + n.windowNum + '">test<\/label><\/div><\/div><label class="VIS_Pref_Label_Font" id="vlblAttribute_' + n.windowNum + '">test<\/label><\/div><div class="vis-valpreferencedatawrp" id="second_' + n.windowNum + '"><div class="input-group vis-input-wrap" style="flex: 1;"><div class="vis-control-wrap"><input class="VIS_Pref_pass vis-gc-vpanel-table-readOnly" data-placeholder="" placeholder=" " style="margin-bottom: 0;" type="text" readonly="true" id="vtxtSearchKey_' + n.windowNum + '" /><label class="VIS_Pref_Label_Font" id="vlblValueText_' + n.windowNum + '">test<\/label><\/div><\/div><label class="VIS_Pref_Label_Font" id="vlblValue_' + n.windowNum + '">test<\/label><\/div><\/div><\/div><div style="width: 100%; float: left">    <div> <div class="VIS_Pref_col-50"><input  type="checkbox" id="vchkTenant_' + n.windowNum + '" ><label class="VIS_Pref_Label_Font">test<\/label><\/div>   <div class="VIS_Pref_col-50"> <input  type="checkbox" id="vchkOrg_' + n.windowNum + '" /><label class="VIS_Pref_Label_Font">test<\/label><\/div> <div class="VIS_Pref_col-50"><input  type="checkbox" id="vchkUser_' + n.windowNum + '" /><label class="VIS_Pref_Label_Font">test<\/label><\/div>  <div class="VIS_Pref_col-50"> <input  type="checkbox" id="vchkWindow_' + n.windowNum + '" /><label class="VIS_Pref_Label_Font">test<\/label><\/div> <\/div><div id="divMsg_' + n.windowNum + '" style="width: 100%; float: left; margin-bottom: 5px; margin-top: 5px; text-align: left"><label class="VIS_Pref_Label_Font" id="vlblMsg_' + n.windowNum + '">test<\/label><\/div><div style="height: 10%; width: 100%; float: left"> <button type="button" id="btnDelete_' + n.windowNum + '"  class="VIS_Pref_btn-2"  style="float: left" value="Ok" role="button" aria-disabled="false"><i class="vis vis-delete"><\/i><\/button> <input id= "btnCancel_' + n.windowNum + '" class="VIS_Pref_btn-2" style="float:right" type="button" value="Cancel" /><input id="btnOK_' + n.windowNum + '"  class="VIS_Pref_btn-2" style="float:right; margin-right:10px" type="button" value="Ok" /><\/div>'; f.append(t) } if (i == null) return null; var e = this, f = t("<div class='vis-forms-container' style='position:relative;'>"), s = t('<div class="vis-busyindicatorouterwrap"><div class="vis-busyindicatorinnerwrap"><i class="vis-busyindicatordiv"><\/i><\/div><\/div>'); if (this.Okbtn = null, this.cancelbtn = null, this.deletebtn = null, this.txtAttribute = null, this.lblAttribute = null, this.txtSearchKey = null, this.lblValue = null, this.lblAttribute = null, this.lblValueText = null, this.lblLevelText = null, this.chkTenant = null, this.chkOrg = null, this.chkUser = null, this.chkWindow = null, this.lblMsg = null, this.userchk = null, this.tenantchk = null, this.windowchk = null, this.orgchk = null, this.aValue = null, this.aDisplayValue = null, r != null && (this.aValue = r, typeof r == Boolean && (this.aValue = r ? "Y" : "N"), this.aDisplayValue = u == null ? this.aValue : u), this.AD_Window_ID = i.getAD_Window_ID(), this.aAttribute = i.getColumnName(), this.aDisplayAttribute = i.getHeader(), this.aDisplayType = i.getDisplayType(), this.AD_Reference_ID = 0, this.windowNum = i.getWindowNo(), "Value".equals(this.aAttribute) || "DocumentNo".equals(this.aAttribute)) return null; this.AD_Client_ID = n.context.getAD_Client_ID(); this.AD_Org_ID = n.context.getWindowContext(this.windowNum, "AD_Org_ID", !0); this.AD_User_ID = n.context.getAD_User_ID(); this.role = n.MRole.getDefault(); this.load = function () { h(e); f.append(s); o(!0); e.init(f); o(!1) }; this.init = function () { this.lblAttributeText = f.find("#vlblAttributeText_" + this.windowNum); this.lblValueText = f.find("#vlblValueText_" + this.windowNum); this.lblLevelText = f.find("#vlblLevelText_" + this.windowNum); this.deletebtn = f.find("#btnDelete_" + this.windowNum); this.txtAttribute = f.find("#vtxtAttribute_" + this.windowNum); this.txtSearchKey = f.find("#vtxtSearchKey_" + this.windowNum); this.chkTenant = f.find("#vchkTenant_" + this.windowNum); this.chkOrg = f.find("#vchkOrg_" + this.windowNum); this.chkUser = f.find("#vchkUser_" + this.windowNum); this.chkWindow = f.find("#vchkWindow_" + this.windowNum); this.lblMsg = f.find("#vlblMsg_" + this.windowNum); this.lblAttribute = f.find("#vlblAttribute_" + this.windowNum); this.lblValue = f.find("#vlblValue_" + this.windowNum); this.Okbtn = f.find("#btnOK_" + this.windowNum); this.cancelbtn = f.find("#btnCancel_" + this.windowNum); n.Application.isRTL && (this.Okbtn.css("margin-right", "-128px"), this.cancelbtn.css("margin-right", "55px"), this.lblAttributeText.css("text-align", "right"), this.lblValueText.css("text-align", "right"), this.lblLevelText.css("text-align", "right"), this.chkOrg.css("margin-right", "0px"), this.chkTenant.css("margin-right", "37px"), f.find("#divMsg_" + this.windowNum).css("text-align", "right")); this.txtAttribute.val(this.aDisplayAttribute == null ? "" : this.aDisplayAttribute); this.lblAttribute.text(this.aAttribute == null ? "" : this.aAttribute); this.txtSearchKey.val(this.aDisplayValue == null ? "" : n.Utility.decodeText(this.aDisplayValue)); this.lblValue.text(this.aValue); this.lblAttributeText.text(n.Msg.getMsg("Attribute")); this.lblValueText.text(n.Msg.getMsg("SearchKey")); this.lblLevelText.text(n.Msg.getMsg("ValuePreferenceSetFor")); this.chkTenant.next("label").text(n.Msg.getMsg("Tenant")); this.chkOrg.next("label").text(n.Msg.getMsg("Org")); this.chkUser.next("label").text(n.Msg.getMsg("UserContact")); this.chkWindow.next("label").text(n.Msg.getMsg("Window")); this.chkTenant.prop("disabled", !0); this.chkTenant.prop("checked", !0); this.chkUser.prop("checked", !0); this.chkWindow.prop("checked", !0); n.MRole.PREFERENCETYPE_Client.equals(n.MRole.getPreferenceType()) || (this.chkOrg.prop("disabled", !0), this.chkOrg.prop("checked", !0)); n.MRole.PREFERENCETYPE_Client.equals(n.MRole.getPreferenceType()) || n.MRole.PREFERENCETYPE_Organization.equals(n.MRole.getPreferenceType()) || (this.chkUser.prop("disabled", !0), this.chkUser.prop("checked", !0)); this.setExplanation(); this.Okbtn.on("click", function () { o(!0); e.save(); o(!1); f.dialog("close") }); this.cancelbtn.on("click", function () { f.dialog("close") }); this.deletebtn.on("click", function () { e.delete(); f.dialog("close") }); t("[id^=vch]").click(function () { e.setExplanation() }) }; this.showDialog = function () { f.append(s); o(!0); setTimeout(this.load(), 5); f.dialog({ modal: !0, title: n.Msg.getMsg("ValuePreference"), width: 530, position: { at: "center top", of: window }, close: function () { e.dispose(); f.dialog("destroy"); f = null } }) }; this.disposeComponent = function () { this.Okbtn && this.Okbtn.off("click"); this.cancelbtn && this.cancelbtn.off("click"); this.deletebtn && this.deletebtn.off("click"); t("[id^=vch]") && t("[id^=vch]").off("click"); this.Okbtn = null; this.cancelbtn = null; this.deletebtn = null; s = null; e = null; this.disposeComponent = null } } i.prototype.setExplanation = function () { var t = "For "; this.chkTenant.prop("checked") && this.chkOrg.prop("checked") ? t += "this Client and Organization" : this.chkTenant.prop("checked") && !this.chkOrg.prop("checked") ? t += "all Organizations of this Client" : !this.chkTenant.prop("checked") && this.chkOrg.prop("checked") ? (this.chkOrg.prop("checked", !1), t += "entire System") : t += "entire System"; t += this.chkUser.prop("checked") ? ", this User" : ", all Users"; t += this.chkWindow.prop("checked") ? " and this Window" : " and all Windows"; n.Env.isBaseLanguage() && this.lblMsg.text(t.toString()); this.orgchk = this.chkOrg.prop("checked"); this.userchk = this.chkUser.prop("checked"); this.windowchk = this.chkWindow.prop("checked"); this.tenantchk = this.chkTenant.prop("checked") }; i.prototype.getADPreferenceID = function () { var t = "", i = this.tenantchk ? this.AD_Client_ID : 0, r, u; return t += "AD_Client_ID=" + i, i = this.orgchk ? this.AD_Org_ID : 0, t += " AND AD_Org_ID=" + i, t += this.userchk ? " AND AD_User_ID=" + this.AD_User_ID : " AND AD_User_ID IS NULL", t += this.windowchk ? " AND AD_Window_ID=" + this.AD_Window_ID : " AND AD_Window_ID IS NULL", t += " AND Attribute='" + this.aAttribute + "'", r = 0, t = n.secureEngine.encrypt(t), u = n.dataContext.getJSONData(n.Application.contextUrl + "ValuePreference/GetPrefrenceID", { sql: t }, null), u > 0 && (r = n.Utility.Util.getValueOfInt(u)), r }; i.prototype.delete = function () { var i = !1, r = this.getADPreferenceID(), u = this; return r > 0 ? t.ajax({ url: n.Application.contextUrl + "ValuePreference/Delete", dataType: "json", data: { preferenceId: r }, success: function (t) { i = t.result; i && (n.Env.getCtx().setContext(u.getContextKey(), null), n.ADialog.info("ValuePreferenceDeleted", !0, "", null)) } }) : n.ADialog.warn("ValuePreferenceNotFound", !0, "", null), i }; i.prototype.save = function () { var i, r, u; if (this.aValue == null) if (n.DisplayType.IsLookup(this.displayType)) this.aValue = "-1"; else if (n.DisplayType.IsDate(this.displayType)) this.aValue = " "; else return n.ADialog.warn("ValuePreferenceNotInserted", !0, "", null), !1; else if (this.aValue.toString().indexOf("@") != -1) return !1; return i = !1, this.orgchk = this.chkOrg.prop("checked"), this.userchk = this.chkUser.prop("checked"), this.windowchk = this.chkWindow.prop("checked"), this.tenantchk = this.chkTenant.prop("checked"), r = this, u = this.getADPreferenceID(), t.ajax({ url: n.Application.contextUrl + "ValuePreference/Save", dataType: "json", data: { preferenceId: u, clientId: this.tenantchk ? this.AD_Client_ID : 0, orgId: this.orgchk ? this.AD_Org_ID : 0, chkWindow: this.windowchk, AD_Window_ID: this.AD_Window_ID, chkUser: this.userchk, attribute: this.aAttribute, userId: this.AD_User_ID, value: this.aValue }, success: function (t) { i = t.result; i ? (n.Env.getCtx().setContext(r.getContextKey(), r.aValue), n.ADialog.info("ValuePreferenceInserted", !0, "", null)) : n.ADialog.warn("ValuePreferenceNotInserted", !0, "", null) } }), i }; i.prototype.getContextKey = function () { return this.windowchk ? "P" + this.AD_Window_ID + "|" + this.aAttribute : "P|" + this.aAttribute }; i.prototype.dispose = function () { this.disposeComponent() }; n.ValuePreference = i }(VIS, jQuery), function (n, t) { function i(i, r, u, f, e, o, s) { function pi() { t.ajax({ url: n.Application.contextUrl + "PAttributes/Load", dataType: "json", async: !1, data: { mAttributeSetInstanceId: k, mProductId: tt, productWindow: et, windowNo: v, AD_Column_ID: o, window_ID: ot, IsSOTrx: kt, IsInternalUse: ui }, success: function (t) { if (returnValue = t.result, returnValue.Error != null) { n.ADialog.error(returnValue.Error, null, null, null); it.hasAttribute = !1; return } h.html(returnValue.tableStucture); h.append(ni); returnValue.ControlList && (c = returnValue.ControlList.split(",")); vi = returnValue.MAttributeSetID; ct = returnValue.IsCanCreate; lt = returnValue.IsCanEdit } }) } function wi(t) { var i, r; if (l.val(""), p.val(""), a.val(Globalize.format(new Date, "yyyy-MM-dd")), t = jQuery.parseJSON(t), t.result != null) for (i in t.result) if (c) { r = h.find("[attribute_id=" + i + "]"); r.attr("id").contains("cmb") ? r.val(n.Utility.Util.getValueOfInt(t.result[i])) : r.val(t.result[i]); continue } l != null && t.lot != "" ? l.val(t.lot) : p != null && t.serial != "" && p.val(t.serial); a != null && t.gdate != "" && a.val(Globalize.format(new Date(t.gdate), "yyyy-MM-dd")) } function bi() { var t = !0, f = !1, i, r, u; if (nt.prop("checked")) f = gt.val().length > 0 ? !0 : !1; else if (rt.prop("checked")) { if (i = l.val(), t = !1, r = n.dataContext.getJSONData(n.Application.contextUrl + "PAttributes/CheckUniqueLot", null, null), r > 0 && (u = di(i), u)) return t = !0, n.ADialog.Info("LotNoExists", null, null, null), !1; t || ei() } else { if (t = !1, n.Env.getCtx().setContext(w, "AttrCode", ht), it.onClose) it.onClose(k, wt, ft); b(!1); h.dialog("close") } t && ei() } function ei() { var f = [], u, i; if (c) for (u = 0; u < c.length; u++)if (i = h.find("#" + c[u]), c[u].toString().contains("cmb")) i.find("option:selected").length > 0 ? f.push({ Key: Number(i.find("option:selected").val()), Name: i.find("option:selected").text() }) : f.push({ Key: 0, Name: i.val() }); else { if (i.attr("class").contains("vis-gc-vpanel-table-mandatory") && i.val().trim().length == 0) return n.ADialog.warn("FillMandatoryFields", !0, null), b(!1), !1; i.attr("type") == "number" && (i.val().contains(".") || i.val(i.val().concat(".0"))); f.push({ Key: 0, Name: i.val() }) } t.ajax({ url: n.Application.contextUrl + "PAttributes/Save", type: "POST", dataType: "json", contentType: "application/json; charset=utf-8", data: JSON.stringify({ windowNoParent: w, strLotString: l.val(), strSerNo: p.val(), dtGuaranteeDate: new Date(a.val()), strAttrCode: vt.val(), productWindow: et, mAttributeSetInstanceId: k, mProductId: r, windowNo: v, description: gt.val(), isEdited: nt.prop("checked"), lst: f }), success: function (t) { if (returnValue = t.result, returnValue) if (returnValue.Error != null) n.ADialog.info("", null, returnValue.Error, null), b(!1); else { if (n.Env.getCtx().setContext(w, "AttrCode", returnValue.attrCode), it.onClose) it.onClose(returnValue.M_AttributeSetInstance_ID, returnValue.M_AttributeSetInstanceName, ft); b(!1); h.dialog("close") } }, error: function (n, t) { console.log(t); b(!1) } }) } function ki() { var t, r, f, i; it.log.config(""); t = 0; w != -1 && (window.DTD001 && ot == 170 ? t = n.Env.getCtx().getContextAsInt(w, "DTD001_MWarehouseSource_ID") : (ot == 143 || ri == "Blanket Sales Order" || ot == 169 || ot == 168 || ot == 341) && (t = n.Env.getCtx().getContextAsInt(w, "M_Warehouse_ID"))); r = ""; try { r = n.dataContext.getJSONData(n.Application.contextUrl + "PAttributes/GetTitle", { Warehouse_ID: t, Product_ID: tt }, null) } catch (u) { console.log(u) } f = -1; i = new n.PAttributeInstance(r, t, ft, tt, bt, p.val(), l.val(), a.val(), kt); i.showDialog(); i.onClose = function (n, t, i, r) { n != -1 && (k = n, wt = t, ft = i, ht = r, ii = !0, b(!0), hi(), rt.prop("checked") && (rt.prop("checked", !1), oi()), nt.prop("checked") && (nt.prop("checked", !1), si()), lt && (dt.show(), nt.show())) }; i = null } function oi() { var n = rt.prop("checked"), i, t; if (nt.attr("disabled", n), l && (l.attr("readOnly", !n), n ? l.removeClass("vis-gc-vpanel-table-readOnly") : l.addClass("vis-gc-vpanel-table-readOnly")), y && (n ? (y.removeClass("vis-gc-vpanel-table-readOnly"), y.removeAttr("disabled")) : (y.attr("disabled", !0), y.addClass("vis-gc-vpanel-table-readOnly"))), d && (n ? d.removeAttr("disabled") : d.attr("disabled", !0)), p && (p.attr("readOnly", !n), n ? p.removeClass("vis-gc-vpanel-table-readOnly") : p.addClass("vis-gc-vpanel-table-readOnly")), g && (n ? g.removeAttr("disabled") : g.attr("disabled", !0)), a && (a.prop("disable", n), n ? (a.removeClass("vis-gc-vpanel-table-readOnly"), a.removeAttr("disabled")) : (a.addClass("vis-gc-vpanel-table-readOnly"), a.attr("disabled", !0))), c) for (i = 0; i < c.length; i++)t = h.find("#" + c[i]), t.attr("readOnly", !n), n ? (t.removeClass("vis-gc-vpanel-table-readOnly"), t.removeAttr("disabled")) : (t.addClass("vis-gc-vpanel-table-readOnly"), t.attr("disabled", !0)) } function si() { var n = nt.prop("checked"), i, t; if (rt.attr("disabled", n), l && (l.attr("readOnly", !n), n ? l.removeClass("vis-gc-vpanel-table-readOnly") : l.addClass("vis-gc-vpanel-table-readOnly")), y && (n ? (y.removeClass("vis-gc-vpanel-table-readOnly"), y.removeAttr("disabled")) : (y.attr("disabled", !0), y.addClass("vis-gc-vpanel-table-readOnly"))), d && (n ? d.removeAttr("disabled") : d.attr("disabled", !0)), p && (p.attr("readOnly", !n), n ? p.removeClass("vis-gc-vpanel-table-readOnly") : p.addClass("vis-gc-vpanel-table-readOnly")), g && (n ? g.removeAttr("disabled") : g.attr("disabled", !0)), a && (a.prop("disable", n), n ? (a.removeClass("vis-gc-vpanel-table-readOnly"), a.removeAttr("disabled")) : (a.addClass("vis-gc-vpanel-table-readOnly"), a.attr("disabled", !0))), c) for (i = 0; i < c.length; i++)t = h.find("#" + c[i]), t.attr("readOnly", !n), n ? (t.removeClass("vis-gc-vpanel-table-readOnly"), t.removeAttr("disabled")) : (t.addClass("vis-gc-vpanel-table-readOnly"), t.attr("disabled", !0)) } function di(t) { var i = !1, r; try { r = n.dataContext.getJSONData(n.Application.contextUrl + "PAttributes/CheckAttribute", { Window_No: w, Product_ID: tt, LotNumber: t }, null); r > 0 && (i = !0) } catch (u) { console.log(u) } return i } function gi(n) { y.append(new Option(n.Name, n.Key, !0, !0)); y.change() } function hi() { if (c) for (var i = 0; i < c.length; i++)c[i].toString().contains("cmb") ? h.find("#" + c[i]).prop("selectedIndex", -1) : h.find("#" + c[i]).val(""); t.ajax({ url: n.Application.contextUrl + "PAttributes/GetAttribute", dataType: "json", data: { mAttributeSetInstanceId: k, mProductId: tt, productWindow: et, windowNo: v, AD_Column_ID: o, attrcode: ht }, success: function (n) { returnValue = n; returnValue != null && wi(returnValue); b(!1) }, error: function (n, t) { console.log(t); b(!1) } }) } function nr() { if (y != null && y.change(function () { var n = y.find("option:selected").val(), t = y.find("option:selected").text(); n != null && n != -1 ? (l.val(t), l.attr("readOnly", !0), l.addClass("vis-gc-vpanel-table-readOnly"), ci = n) : (l.attr("readOnly", !1), l.removeClass("vis-gc-vpanel-table-readOnly")) }), rt != null && rt.change(function () { oi() }), nt != null && nt.change(function () { si() }), vt != null) vt.on("keydown", function (n) { (n.keyCode == 13 || n.keyCode == 9) && (b(!0), ht = vt.val(), hi()) }); if (ut != null) ut.on("click", function () { b(!0); bi() }); if (st != null) st.on("click", function () { h.dialog("close") }); if (at != null) { b(!0); at.on("click", function () { ki() }); b(!1) } if (d != null) d.on("click", function () { t.ajax({ url: n.Application.contextUrl + "PAttributes/CreateLot", dataType: "json", async: !1, data: { mAttributeSetInstanceId: k, mProductId: tt }, success: function (n) { returnValue = n.result; gi(returnValue) } }) }); if (g != null) g.on("click", function () { t.ajax({ url: n.Application.contextUrl + "PAttributes/GetSerNo", dataType: "json", async: !1, data: { mAttributeSetInstanceId: k, mProductId: tt }, success: function (n) { returnValue = n.result; p.val(returnValue) } }) }); c } function b(n) { ni.css("display", n ? "block" : "none") } var fi, yt, pt; this.onClose = null; var it = this, h = t("<div style='position:relative'>"), ni = t('<div class="vis-busyindicatorouterwrap"><div class="vis-busyindicatorinnerwrap"><i class="vis-busyindicatordiv"><\/i><\/div><\/div>'), v = n.Env.getWindowNo(), k = null, ft = null, wt = null, tt = null, bt = null, ti = null, w = null, ci = null, ht = "", et = !1, ii = !1, li = 40, ai = {}, c = null, vi = null, ot = 0, ri = "", kt = !1, ui = !1, ct = !1, lt = !1; if (this.log = n.Logging.VLogger.getVLogger("PAttributesForm"), this.log.config("M_AttributeSetInstance_ID=" + i + ", M_Product_ID=" + r + ", C_BPartner_ID=" + f + ", ProductW=" + et + ", Column=" + o), k = i, tt = r, bt = f, et = e, ti = o, w = s, ft = u, w != -1 && (fi = n.context.getWindowTabContext(w, 0, "AD_Tab_ID"), ot = n.dataContext.getJSONRecord("InfoProduct/GetWindowID", fi.toString()), ri = n.context.getContext(w, "WindowName"), kt = n.context.isSOTrx(w), ui = n.context.getWindowTabContext(w, 0, "IsInternalUse")), tt != 0) { this.hasAttribute = !0; pi(); var ut = h.find("#btnOk_" + v), st = h.find("#btnCancel_" + v), at = h.find("#btnSelect_" + v), d = h.find("#btnLot_" + v), g = h.find("#btnSerNo_" + v), y = h.find("#cmbLot_" + v), yi = h.find("#cmdNew_" + v), rt = h.find("#chkNewEdit_" + v), dt = h.find("#lblEdit_" + v), nt = h.find("#chkEdit_" + v), gt = h.find("#txtDescription_" + v), l = h.find("#txtLotString_" + v), p = h.find("#txtSerNo_" + v), a = h.find("#dtpicGuaranteeDate_" + v), vt = h.find("#txtAttrCode_" + v); if (at.children(0).attr("src", n.Application.contextUrl + "Areas/VIS/Images/base/Locator10.png"), n.Application.isRTL && (ut.css("margin-right", "0px"), ut.css("margin-left", "10px"), ut.css("float", "left"), st.css("margin-right", "0px"), st.css("float", "left")), !et) if (ct ? rt.prop("checked", k == 0) : yi.hide(), k > 0 || !ct) { if (l && (l.attr("readOnly", !0), l.addClass("vis-gc-vpanel-table-readOnly")), y && (y.attr("disabled", !0), y.addClass("vis-gc-vpanel-table-readOnly")), d && d.attr("disabled", !0), p && (p.attr("readOnly", !0), p.addClass("vis-gc-vpanel-table-readOnly")), g && g.attr("disabled", !0), a && (a.prop("disable", !0), a.addClass("vis-gc-vpanel-table-readOnly"), a.attr("disabled", !0)), c) for (yt = 0; yt < c.length; yt++)pt = h.find("#" + c[yt]), pt.attr("readOnly", !0), pt.addClass("vis-gc-vpanel-table-readOnly"), pt.attr("disabled", !0); lt || (dt.hide(), nt.hide()); !ct & !lt && d.hide() } else dt.hide(), nt.hide(); nr(); this.showDialog = function () { if (h.dialog({ modal: !0, title: n.Msg.translate(n.Env.getCtx(), "M_AttributeSetInstance_ID"), width: 490, close: function () { it.dispose(); it = null; h.dialog("destroy"); h = null } }), c && i == 0) for (var t = 0; t < c.length; t++)c[t].toString().contains("cmb") && h.find("#" + c[t]).prop("selectedIndex", -1); b(!1) }; this.disposeComponent = function () { ut && ut.off("click"); st && st.off("click"); n.Env.clearWinContext(n.Env.getCtx(), v); n.Env.getCtx().setContext(n.Env.WINDOW_INFO, n.Env.TAB_INFO, "M_AttributeSetInstance_ID", k); n.Env.getCtx().setContext(n.Env.WINDOW_INFO, n.Env.TAB_INFO, "M_Locator_ID", ft); ft = null; wt = null; tt = null; bt = null; ti = null; w = null; et = null; ii = null; li = 0; ai = null; ut = null; st = null; at = null; d = null; g = null; y = null; rt = null; gt = null; l = null; p = null; a = null; it = null; v = null; k = null; this.disposeComponent = null } } } i.prototype.dispose = function () { this.disposeComponent() }; n.PAttributesForm = i }(VIS, jQuery), function (n, t) { function i(i, r, u, f, e, o, s, h, c) { function bt(t) { var f; if (l.log.config("C_BPartner_ID=" + t), t != 0) { var u = 0, i = 0, r = null; try { r = n.dataContext.getJSONData(n.Application.contextUrl + "PAttributes/GetBPData", { Product_ID: ut, BPartner_ID: t }, null); r != null && (u = r.ShelfLifeMinPct, f = r.PCT, f > 0 && (i = f), i = r.ShelfLifeMinDays) } catch (e) { console.log(e) } u > 0 && (k = " AND COALESCE(TRUNC((daysBetween(TRUNC(asi.GuaranteeDate,'DD'),TRUNC(SysDate,'DD'))/p.GuaranteeDays)*100),0)>=" + u, l.log.config("PAttributeInstance.dynInit - ShelfLifeMinPct=" + u)); i > 0 && (k += " AND COALESCE(daysBetween(TRUNC(asi.GuaranteeDate,'DD'),TRUNC(SysDate,'DD')),0)>=" + i, l.log.config("PAttributeInstance.dynInit - ShelfLifeMinDays=" + i)) } v = at; rt != 0 && (v = v.concat(" AND NVL(l.M_Warehouse_ID,0) IN (0," + rt + ")")); v += " ORDER BY asi.GuaranteeDate, QtyOnHand DESC"; tt.append(w); ot.append(p).append(a); b.append(it).append(tt).append(et).append(ot); ct ? w.prop("checked", !1) : w.prop("checked", !0); dt() } function yt() { var o, u, i, t; v == null && (v = ""); var f = [], r = v, e = v.lastIndexOf(" ORDER BY "); w.prop("checked") || (r = v.substring(0, e) + ft, k.length > 0 && (r += k), r += v.substring(e)); l.log.finest(r); try { if (o = n.secureEngine.encrypt(r), dr = n.dataContext.getJSONData(n.Application.contextUrl + "PAttributes/GetAttributeData", { Sq1Atribute: o, Product_ID: ut }, null), dr != null && dr.length > 0) { u = 1; for (i in dr) t = {}, t.M_AttributeSetInstance_ID = dr[i].M_AttributeSetInstance_ID, t.Description = dr[i].Description, t.Lot = dr[i].Lot, t.SerNo = dr[i].SerNo, t.GuaranteeDate = dr[i].GuaranteeDate, t.Value = dr[i].Value, t.QtyReserved = dr[i].QtyReserved, t.QtyOrdered = dr[i].QtyOrdered, t.QtyOnHand = dr[i].QtyOnHand, t.GoodForDays = dr[i].GoodForDays, t.ShelfLifeDays = dr[i].ShelfLifeDays, t.ShelfLifeRemainingPct = dr[i].ShelfLifeRemainingPct, t.M_Locator_ID = dr[i].M_Locator_ID, t.AttrCode = dr[i].AttrCode, t.recid = u, u++, f.push(t) } pt() } catch (s) { console.log(s) } kt(f) } function kt(i) { l.dGrid != null && (l.dGrid.destroy(), l.dGrid = null); l.arrListColumns.length == 0 && (l.arrListColumns.push({ field: "Description", caption: n.Msg.translate(n.Env.getCtx(), "Description"), sortable: !0, size: "16%", min: 150, hidden: !1 }), l.arrListColumns.push({ field: "Lot", caption: n.Msg.translate(n.Env.getCtx(), "Lot"), sortable: !0, size: "10%", min: 100, hidden: !1 }), l.arrListColumns.push({ field: "SerNo", caption: n.Msg.getElement(n.Env.getCtx(), "SerNo"), sortable: !0, size: "10%", min: 100, hidden: !1 }), l.arrListColumns.push({ field: "GuaranteeDate", caption: n.Msg.getElement(n.Env.getCtx(), "GuaranteeDate"), sortable: !0, size: "10%", min: 100, hidden: !1, render: "date", options: { format: "yyyy-mm-dd" } }), l.arrListColumns.push({ field: "Value", caption: n.Msg.getElement(n.Env.getCtx(), "M_Locator_ID"), sortable: !0, size: "10%", min: 100, hidden: !1 }), l.arrListColumns.push({ field: "QtyReserved", caption: n.Msg.getElement(n.Env.getCtx(), "QtyReserved"), sortable: !0, size: "15%", min: 100, hidden: !1 }), l.arrListColumns.push({ field: "QtyOrdered", caption: n.Msg.getElement(n.Env.getCtx(), "QtyOrdered"), sortable: !0, size: "15%", min: 100, hidden: !1 }), l.arrListColumns.push({ field: "QtyOnHand", caption: n.Msg.getElement(n.Env.getCtx(), "QtyOnHand"), sortable: !0, size: "15%", min: 100, hidden: !1 }), l.arrListColumns.push({ field: "GoodForDays", caption: n.Msg.getElement(n.Env.getCtx(), "GoodForDays"), sortable: !0, size: "15%", min: 100, hidden: !1 }), l.arrListColumns.push({ field: "ShelfLifeDays", caption: n.Msg.getElement(n.Env.getCtx(), "ShelfLifeDays"), sortable: !0, size: "15%", min: 100, hidden: !1 }), l.arrListColumns.push({ field: "ShelfLifeRemainingPct", caption: n.Msg.getElement(n.Env.getCtx(), "ShelfLifeRemainingPct"), sortable: !0, size: "20%", min: 100, hidden: !1 }), l.arrListColumns.push({ field: "M_Locator_ID", caption: n.Msg.getElement(n.Env.getCtx(), "M_Locator_ID"), sortable: !0, size: "16%", min: 150, hidden: !0 }), l.arrListColumns.push({ field: "M_AttributeSetInstance_ID", caption: n.Msg.translate(n.Env.getCtx(), "ID"), sortable: !0, size: "16%", min: 150, hidden: !0 }), l.arrListColumns.push({ field: "AttrCode", caption: n.Msg.getElement(n.Env.getCtx(), "AttrCode"), sortable: !0, size: "16%", min: 150, hidden: !0 })); setTimeout(10); w2utils.encodeTags(i); l.dGrid = t(et).w2grid({ name: "gridPinstance" + y, show: { toolbar: !0, footer: !0 }, recordHeight: 30, columns: l.arrListColumns, records: i, multiSearch: !0, searches: [{ field: "Description", caption: "Description", type: "text" }, { field: "Lot", caption: "Lot", type: "text" }, { field: "SerNo", caption: "SerNo", type: "text" }, { field: "GuaranteeDate", caption: "GuaranteeDate", type: "date", options: { format: "yyyy-mm-dd" } }], onClick: function () { l.dGrid.records.length > 0 && a.removeAttr("disabled") } }); vt || (o ? l.dGrid.search("all", o) : s && l.dGrid.search("all", s)); it.css("display", "none") } function pt() { var n = -1, t = n != -1, i; l.dGrid != null && (n = Number(l.dGrid.getSelection().toString()), g = -1, nt = null, d = 0, t = n != -1, t && n > 0 && (i = l.dGrid.get(n).M_AttributeSetInstance_ID, i > 0 && (g = i, nt = l.dGrid.get(n).Description, d = l.dGrid.get(n).M_Locator_ID, lt = l.dGrid.get(n).AttrCode))); a.attr("disabled", !0); t && a.removeAttr("disabled"); l.log.fine("M_AttributeSetInstance_ID=" + g + " - " + nt + "; M_Locator_ID=" + d) } function dt() { if (a != null) a.on(n.Events.onTouchStartOrClick, function () { if (pt(), l.onClose) l.onClose(g, nt, d, lt); b.dialog("close") }); if (p != null) p.on(n.Events.onTouchStartOrClick, function () { b.dialog("close") }); w != null && w.change(function () { vt = !0; yt() }) } var l = this, k; this.onClose = null; var b = t("<div>"), it = t('<div class="vis-busyindicatorouterwrap"><div class="vis-busyindicatorinnerwrap"><i class="vis-busyindicatordiv"><\/i><\/div><\/div>'), rt = r, d = u, ut = f, st = e, ht = i, ct = c; this.arrListColumns = []; this.dGrid = null; var g = -1, nt = null, lt = "", v = "", ft = "", wt = "", at = " patr.M_Product_ID=@M_Product_ID AND patr.M_AttributeSetInstance_ID != 0"; ft = " AND s.QtyOnHand>0"; k = ""; this.log = n.Logging.VLogger.getVLogger("PAttributeInstance"); var y = n.Env.getWindowNo(), w = t("<input id='chkShowAll_" + y + "' type='checkbox' ><span><label id='lblShowAll_" + y + "' class='VIS_Pref_Label_Font'>" + n.Msg.getMsg("VIS_ShowAll") + "<\/label><\/span>"), a = t("<input id='btnOk_" + y + "' class='VIS_Pref_btn-2' style='float: right; margin-right: 10px;' type='button' value='" + n.Msg.getMsg("OK") + "'>"), p = t("<input id='btnCancel_" + y + "' class='VIS_Pref_btn-2' style='float: right;margin-right: 0px;' type='button' value='" + n.Msg.getMsg("Cancel") + "'>"), tt = t("<div id='topdiv_" + y + "' style='float: left; width: 100%; height: 7%; text-align: right;'>"), et = t("<div id='middeldiv_" + y + "' style='float: left; width: 100%; height: 79%;'>"), ot = t("<div id='bottomdiv_" + y + "' style='float: left; width: 100%; height: 14%;'>"), vt = !1; n.Application.isRTL && (tt.css("text-align", "left"), a.css("margin-right", "0px"), a.css("margin-left", "10px"), a.css("float", "left"), p.css("margin-right", "0px"), p.css("float", "left")); this.showDialog = function () { b.dialog({ modal: !0, title: ht, width: 600, height: 450, resizable: !1, close: function () { l.dispose(); l = null; b.dialog("destroy"); b = null } }); yt() }; this.disposeComponent = function () { a && a.off("click"); p && p.off("click"); a = null; p = null; y = null; this.onClose = null; it = null; rt = null; d = null; ut = null; st = null; ht = null; ct = null; this.arrListColumns = null; this.dGrid = null; wt = null; at = null; ft = null; k = null; this.log = null; w = null; tt = null; et = null; ot = null; g = null; nt = null; v = null; this.disposeComponent = null }; bt(st) } i.prototype.dispose = function () { this.disposeComponent() }; n.PAttributeInstance = i }(VIS, jQuery), function (n, t) { function i(i, r, u, f, e, o) { function rt() { t.ajax({ url: n.Application.contextUrl + "GenralAttribute/Load", dataType: "json", async: !1, data: { mAttributeSetInstanceId: v, vadms_AttributeSet_ID: p, windowNo: h }, success: function (t) { if (returnValue = t.result, n.Env.getCtx().setContext(h, "C_GenAttributeSet_ID", p), returnValue.Error != null) { n.ADialog.error(returnValue.Error, null, null, null); return } s.html(returnValue.tableStucture); a = returnValue.ControlList.split(",") } }) } function ut() { for (var r, u = [], i = 0; i < a.length; i++)r = s.find("#" + a[i]), a[i].toString().contains("cmb") ? u.push({ Key: Number(r.find("option:selected").val()), Name: r.find("option:selected").text() }) : u.push({ Key: 0, Name: n.Utility.decodeText(r.val()) }); t.ajax({ url: n.Application.contextUrl + "GenralAttribute/Save", type: "POST", dataType: "json", contentType: "application/json; charset=utf-8", async: !1, data: JSON.stringify({ windowNoParent: w, mAttributeSetInstanceId: v, vadms_AttributeSet_ID: p, windowNo: h, lst: u }), success: function (n) { if (returnValue = n.result, l.onClose) l.onClose(returnValue.M_AttributeSetInstance_ID, returnValue.M_AttributeSetInstanceName) } }) } function ft() { for (var r, u = [], i = 0; i < a.length; i++)r = s.find("#" + a[i]), a[i].toString().contains("cmb") ? u.push({ Key: Number(r.find("option:selected").val()), Name: r.find("option:selected").text() }) : u.push({ Key: 0, Name: r.val() }); t.ajax({ url: n.Application.contextUrl + "GenralAttribute/SearchValues", type: "POST", dataType: "json", contentType: "application/json; charset=utf-8", async: !1, data: JSON.stringify({ windowNoParent: Number(w), mAttributeSetInstanceId: v, vadms_AttributeSet_ID: p, windowNo: h, lst: u }), success: function (n) { if (returnValue = n.result, l.onClose) { returnValue.M_AttributeSetInstanceName == null && (returnValue.M_AttributeSetInstanceName = returnValue.Description); l.onClose(returnValue.M_AttributeSetInstance_ID, returnValue.M_AttributeSetInstanceName, returnValue.GenSetInstance) } } }) } var l, s; this.onClose = null; l = this; s = t("<div>"); this.log = n.Logging.VLogger.getVLogger("GenralAttributeForm"); var h = n.Env.getWindowNo(), v = null, k = null, d = null, w = u, p = 0, g = !1, nt = 40, tt = o, it = {}, b = !1, c = null, y = null, a = null; this.log.config("C_GenAttributeSetInstance_ID=" + i); v = i; p = r; tt = o; b = f; rt(); c = s.find("#btnOk_" + h); y = s.find("#btnCancel_" + h); e ? (c.attr("disabled", !1), c.css("opacity", "1")) : (c.attr("disabled", !0), c.css("opacity", "0.6")); n.Application.isRTL && y.css("margin-right", "10px"); this.btnSelect = s.find("#btnSelect_" + h); this.txtDescription = s.find("#txtDescription_" + h); c.on("click", function () { b ? ft() : ut(); s.dialog("close") }); y.on("click", function () { s.dialog("close") }); this.showDialog = function () { s.dialog({ modal: !0, title: n.Msg.translate(n.Env.getCtx(), "C_GenAttributeSetInstance_ID"), width: 400, close: function () { l.dispose(); l = null; s.dialog("destroy"); s = null } }) }; this.disposeComponent = function () { c && c.off("click"); y && y.off("click"); n.Env.clearWinContext(n.Env.getCtx(), h); n.Env.getCtx().setContext(n.Env.WINDOW_INFO, n.Env.TAB_INFO, "M_AttributeSetInstance_ID", v); c = null; y = null; mLocatorId = null; k = null; mProductId = null; d = null; adColumnId = null; w = null; productWindow = null; g = null; nt = 0; it = null; l = null; h = null; v = null; this.disposeComponent = null } } i.prototype.dispose = function () { this.disposeComponent() }; n.GenralAttributeForm = i }(VIS, jQuery), function (n, t) { function i(i, r, u, f) { function of(i, r, u) { var f = null; return i.sql = n.secureEngine.encrypt(i.sql), t.ajax({ url: rf, type: "POST", datatype: "json", contentType: "application/json; charset=utf-8", async: r, data: JSON.stringify(i) }).done(function (n) { f = n; u && u(n) }), f } function bu(n, i, r) { var u = null; return t.ajax({ url: nf, type: "POST", datatype: "json", contentType: "application/json; charset=utf-8", async: i, data: JSON.stringify(n) }).done(function (n) { u = n; r && r(n) }), u } this.onClose = null; var ti = t("<div style='position:relative;'>"), ei = t('<div class="vis-busyindicatorouterwrap"><div class="vis-busyindicatorinnerwrap"><i class="vis-busyindicatordiv"><\/i><\/div><\/div>'), s = this, pu = i, oi = r, at = u, o = n.Env.getWindowNo(), wu = null, di = new n.Controls.VLabel, k = null, wt = null, d = null, nt = null, tt = null, g = null, it = null, rt = null, ut = null, ft = null, et = null, ot = null, st = null, ht = null, ct = null, lt = null, h = null, c = null, l = null, a = null, v = null, y = null, p = null, w = null, b = null, gi = null, nr = null, tr = null, ir = null, rr = null, ur = null, fr = null, er = null, or = null, sr = !1, hr = !1, cr = !1, lr = !1, ar = !1, vr = !1, yr = !1, pr = !1, wr = !1, br = n.Application.contextUrl, nf = br + "JsonData/JDataSetWithCode", tf = br + "JsonData/ExecuteNonQuer", rf = br + "Form/JDataSet", uf = function (t, i, r) { var e = r ? !0 : !1, f = { sql: t, page: 1, pageSize: 0 }, u; return i && (f.param = i), u = null, bu(f, e, function (t) { u = (new n.DB.DataReader).toJson(t); r && r(u) }), u }, vt = function (t, i, r) { var f = r ? !0 : !1, e = { sql: t, page: 1, pageSize: 0 }, u; return i && (e.param = i), u = null, bu(e, f, function (t) { i = (new n.DB.DataSet).toJson(t); var i = (new n.DB.DataSet).toJson(t); u = i.getTable(0).getRows().length > 0 ? i.getTable(0).getRow(0).getCell(0) : null; i.dispose(); i = null; f && r(u) }), u }, ff = function (n, i, r) { var f = r ? !0 : !1, u = null, e = { sql: n, param: i }; return t.ajax({ url: tf + "yWithCode", type: "POST", datatype: "json", contentType: "application/json; charset=utf-8", async: f, data: JSON.stringify(e) }).done(function (n) { u = n; r && r(n) }), u }, ef = function (t, i, r) { var e = r ? !0 : !1, f = { sql: t, page: 1, pageSize: 0 }, u; return i && (f.param = i), u = null, of(f, e, function (t) { u = (new n.DB.DataReader).toJson(t); r && r(u) }), u }; this.log = n.Logging.VLogger.getVLogger("AccountForm"); this.log.config("C_AcctSchema_ID=" + at + ", C_ValidCombination_ID=" + oi.C_ValidCombination_ID); var sf = 181, kr = "AC", dr = "AY", gr = "BP", nu = "LF", tu = "LT", iu = "MC", ru = "OO", uu = "OT", fu = "PJ", eu = "PR", ou = "SA", su = "SR", hu = "U1", cu = "U2", si = "X1", hi = "X2", ci = "X3", li = "X4", ai = "X5", vi = "X6", yi = "X7", pi = "X8", wi = "X9", dt = t("<table>"); dt.css("width", "100%"); var bt = t("<tr>"), gt = null, ni = null, ri = null, ui = null, fi = null, lu = null, bi = null, ku = null, du = null, ki = null, gu = null, yt = null, hf = !1, au = null, ii = null, e = null, vu = null, yu = null, pt = null, kt = null; this.load = function () { ti.load(n.Application.contextUrl + "AccountForm/Index/?windowno=" + o, function () { s.setBusy(!0); s.init(ti); s.setBusy(!1) }) }; this.setBusy = function (n) { ei.css("display", n ? "block" : "none") }; this.init = function (i) { function br() { n.Env.getCtx().setContext(o, "C_AcctSchema_ID", at); t.ajax({ url: n.Application.contextUrl + "AccountForm/LoadControls", dataType: "json", data: { windowNo: o, C_AcctSchema_ID: at }, success: function (n) { returnValue = n.result; pu(returnValue); kt = returnValue } }) } function pu(i) { n.AEnv.getGridWindow(o, 153, function (r) { var bu, yu, ku, pu, wu, kt, bt, ri, ei, di, fi, ti, du, lu, au; if (r.error != null) { n.ADialog.error(r.error); self.dispose(); self = null; return } if (bu = JSON.parse(r.result), n.context.setContextOfWindow(JSON.parse(r.wCtx), o), yu = new n.GridWindow(bu), yu != null) { for (e = yu.getTabs()[0], e.getField("Alias").setDisplayLength(15), e.getField("Combination").setDisplayLength(15), e.getField("AD_Client_ID").setDisplayed(!1), e.getField("C_AcctSchema_ID").setDisplayed(!1), e.getField("IsActive").setDisplayed(!1), e.getField("IsFullyQualified").setDisplayed(!1), kt = 0; kt < e.getFieldCount(); kt++)bt = e.getField(kt), bt.getIsDisplayed(!0) || bt.setDisplayed(!1); for (ku = o + "_" + at, yt = new n.GridController(!1, !1, ku), yt.initGrid(!0, o, s, e), yt.setVisible(!0), window.innerHeight > 700 ? yt.sizeChanged(window.innerHeight - 230, window.innerWidth) : yt.sizeChanged(window.innerHeight - 215, window.innerWidth), ki.append(yt.getRoot()), yt.activate(), i.IsHasAlies && (pu = e.getField("Alias"), k = n.VControlFactory.getControl(e, pu, !1), u(pu, k, !1)), wu = e.getField("Combination"), wt = n.VControlFactory.getControl(e, wu, !1), u(wu, wt, !1), kt = 0; kt < i.Elements.length; kt++) { var ui = returnValue.Elements[kt].Type, gt = returnValue.Elements[kt].IsMandatory, br = returnValue.Elements[kt].IsHeavyData, ni = returnValue.Elements[kt].Name; if (ui.equals(ru)) { bt = e.getField("AD_Org_ID"); d = n.VControlFactory.getControl(e, bt, !1); u(bt, d, gt, ni, ru); d.fireValueChanged = t; function t() { var t = d.getValue(); n.Env.getCtx().setContext(o, "AcctOrg_ID", t) } } else if (ui.equals(kr)) bt = e.getField("Account_ID"), nt = n.VControlFactory.getControl(e, bt, !1), nt.setValue(at), u(bt, nt, gt, ni, kr); else if (ui.equals(ou)) bt = e.getField("C_SubAcct_ID"), tt = n.VControlFactory.getControl(e, bt, !1), u(bt, tt, gt, ni, ou); else if (ui.equals(eu)) bt = e.getField("M_Product_ID"), g = n.VControlFactory.getControl(e, bt, !1), g.getBtn(), u(bt, g, gt, ni, eu); else if (ui.equals(gr)) bt = e.getField("C_BPartner_ID"), it = n.VControlFactory.getControl(e, bt, !1), u(bt, it, gt, ni, gr); else if (ui.equals(iu)) bt = e.getField("C_Campaign_ID"), rt = n.VControlFactory.getControl(e, bt, !1), u(bt, rt, gt, ni, iu); else if (ui.equals(nu)) bt = e.getField("C_LocFrom_ID"), ut = n.VControlFactory.getControl(e, bt, !1), u(bt, ut, gt, ni, nu); else if (ui.equals(tu)) bt = e.getField("C_LocTo_ID"), ft = n.VControlFactory.getControl(e, bt, !1), u(bt, ft, gt, ni, tu); else if (ui.equals(fu)) bt = e.getField("C_Project_ID"), et = n.VControlFactory.getControl(e, bt, !1), u(bt, et, gt, ni, fu); else if (ui.equals(su)) bt = e.getField("C_SalesRegion_ID"), ot = n.VControlFactory.getControl(e, bt, !1), u(bt, ot, gt, ni, su); else if (ui.equals(uu)) bt = e.getField("AD_OrgTrx_ID"), st = n.VControlFactory.getControl(e, bt, !1), u(bt, st, gt, ni, uu); else if (ui.equals(dr)) bt = e.getField("C_Activity_ID"), ht = n.VControlFactory.getControl(e, bt, !1), u(bt, ht, gt, ni, dr); else if (ui.equals(hu)) bt = e.getField("User1_ID"), ct = n.VControlFactory.getControl(e, bt, !1), u(bt, ct, gt, ni, hu); else if (ui.equals(cu)) bt = e.getField("User2_ID"), lt = n.VControlFactory.getControl(e, bt, !1), u(bt, lt, gt, ni, cu); else if (ui.equals(si)) if (bt = e.getField("UserElement1_ID"), i.Elements[kt].AD_Column_ID > 0) if (fi = "VIS_125", ti = [], ti[0] = new n.DB.SqlParam("@AD_Column_ID", i.Elements[kt].AD_Column_ID), ri = vt(fi, ti), br) { ei = n.MLookupFactory.getMLookUp(n.Env.getCtx(), o, i.Elements[kt].AD_Column_ID, n.DisplayType.Search); h = new n.Controls.VTextBoxButton(ri, gt, !1, !0, n.DisplayType.Search, ei); u(bt, h, gt, ni, si); h.fireValueChanged = t; function t() { gi = h.getValue(); sr = !0 } } else di = n.MLookupFactory.getMLookUp(n.Env.getCtx(), o, i.Elements[kt].AD_Column_ID, n.DisplayType.TableDir), h = new n.Controls.VComboBox(ri, !1, !1, !0, di, 150, n.DisplayType.TableDir, 0), u(bt, h, gt, ni, si), sr = !1; else continue; else if (ui.equals(hi)) if (bt = e.getField("UserElement2_ID"), i.Elements[kt].AD_Column_ID > 0) if (fi = "VIS_125", ti = [], ti[0] = new n.DB.SqlParam("@AD_Column_ID", i.Elements[kt].AD_Column_ID), ri = vt(fi, ti), br) { ei = n.MLookupFactory.getMLookUp(n.Env.getCtx(), o, i.Elements[kt].AD_Column_ID, n.DisplayType.Search); c = new n.Controls.VTextBoxButton(ri, gt, !1, !0, n.DisplayType.Search, ei); u(bt, c, gt, ni, hi); c.fireValueChanged = t; function t() { nr = c.getValue(); hr = !0 } } else di = n.MLookupFactory.getMLookUp(n.Env.getCtx(), o, i.Elements[kt].AD_Column_ID, n.DisplayType.TableDir), c = new n.Controls.VComboBox(ri, !1, !1, !0, di, 150, n.DisplayType.TableDir, 0), u(bt, c, gt, ni, hi), hr = !1; else continue; else if (ui.equals(ci)) if (bt = e.getField("UserElement3_ID"), i.Elements[kt].AD_Column_ID > 0) if (fi = "VIS_125", ti = [], ti[0] = new n.DB.SqlParam("@AD_Column_ID", i.Elements[kt].AD_Column_ID), ri = vt(fi, ti), br) { ei = n.MLookupFactory.getMLookUp(n.Env.getCtx(), o, i.Elements[kt].AD_Column_ID, n.DisplayType.Search); l = new n.Controls.VTextBoxButton(ri, gt, !1, !0, n.DisplayType.Search, ei); u(bt, l, gt, ni, ci); l.fireValueChanged = t; function t() { tr = l.getValue(); cr = !0 } } else di = n.MLookupFactory.getMLookUp(n.Env.getCtx(), o, i.Elements[kt].AD_Column_ID, n.DisplayType.TableDir), l = new n.Controls.VComboBox(ri, !1, !1, !0, di, 150, n.DisplayType.TableDir, 0), u(bt, l, gt, ni, ci), cr = !1; else continue; else if (ui.equals(li)) if (bt = e.getField("UserElement4_ID"), i.Elements[kt].AD_Column_ID > 0) if (fi = "VIS_125", ti = [], ti[0] = new n.DB.SqlParam("@AD_Column_ID", i.Elements[kt].AD_Column_ID), ri = vt(fi, ti), br) { ei = n.MLookupFactory.getMLookUp(n.Env.getCtx(), o, i.Elements[kt].AD_Column_ID, n.DisplayType.Search); a = new n.Controls.VTextBoxButton(ri, gt, !1, !0, n.DisplayType.Search, ei); u(bt, a, gt, ni, li); a.fireValueChanged = t; function t() { ir = a.getValue(); lr = !0 } } else di = n.MLookupFactory.getMLookUp(n.Env.getCtx(), o, i.Elements[kt].AD_Column_ID, n.DisplayType.TableDir), a = new n.Controls.VComboBox(ri, !1, !1, !0, di, 150, n.DisplayType.TableDir, 0), u(bt, a, gt, ni, li), lr = !1; else continue; else if (ui.equals(ai)) if (bt = e.getField("UserElement5_ID"), i.Elements[kt].AD_Column_ID > 0) if (fi = "VIS_125", ti = [], ti[0] = new n.DB.SqlParam("@AD_Column_ID", i.Elements[kt].AD_Column_ID), ri = vt(fi, ti), br) { ei = n.MLookupFactory.getMLookUp(n.Env.getCtx(), o, i.Elements[kt].AD_Column_ID, n.DisplayType.Search); v = new n.Controls.VTextBoxButton(ri, gt, !1, !0, n.DisplayType.Search, ei); u(bt, v, gt, ni, ai); v.fireValueChanged = t; function t() { rr = v.getValue(); ar = !0 } } else di = n.MLookupFactory.getMLookUp(n.Env.getCtx(), o, i.Elements[kt].AD_Column_ID, n.DisplayType.TableDir), v = new n.Controls.VComboBox(ri, !1, !1, !0, di, 150, n.DisplayType.TableDir, 0), u(bt, v, gt, ni, ai), ar = !1; else continue; else if (ui.equals(vi)) if (bt = e.getField("UserElement6_ID"), i.Elements[kt].AD_Column_ID > 0) if (fi = "VIS_125", ti = [], ti[0] = new n.DB.SqlParam("@AD_Column_ID", i.Elements[kt].AD_Column_ID), ri = vt(fi, ti), br) { ei = n.MLookupFactory.getMLookUp(n.Env.getCtx(), o, i.Elements[kt].AD_Column_ID, n.DisplayType.Search); y = new n.Controls.VTextBoxButton(ri, gt, !1, !0, n.DisplayType.Search, ei); u(bt, y, gt, ni, vi); y.fireValueChanged = t; function t() { ur = y.getValue(); vr = !0 } } else di = n.MLookupFactory.getMLookUp(n.Env.getCtx(), o, i.Elements[kt].AD_Column_ID, n.DisplayType.TableDir), y = new n.Controls.VComboBox(ri, !1, !1, !0, di, 150, n.DisplayType.TableDir, 0), u(bt, y, gt, ni, vi), vr = !1; else continue; else if (ui.equals(yi)) if (bt = e.getField("UserElement7_ID"), i.Elements[kt].AD_Column_ID > 0) if (fi = "VIS_125", ti = [], ti[0] = new n.DB.SqlParam("@AD_Column_ID", i.Elements[kt].AD_Column_ID), ri = vt(fi, ti), br) { ei = n.MLookupFactory.getMLookUp(n.Env.getCtx(), o, i.Elements[kt].AD_Column_ID, n.DisplayType.Search); p = new n.Controls.VTextBoxButton(ri, gt, !1, !0, n.DisplayType.Search, ei); u(bt, p, gt, ni, yi); p.fireValueChanged = t; function t() { fr = p.getValue(); yr = !0 } } else di = n.MLookupFactory.getMLookUp(n.Env.getCtx(), o, i.Elements[kt].AD_Column_ID, n.DisplayType.TableDir), p = new n.Controls.VComboBox(ri, !1, !1, !0, di, 150, n.DisplayType.TableDir, 0), u(bt, p, gt, ni, yi), yr = !1; else continue; else if (ui.equals(pi)) if (bt = e.getField("UserElement8_ID"), i.Elements[kt].AD_Column_ID > 0) if (fi = "VIS_125", ti = [], ti[0] = new n.DB.SqlParam("@AD_Column_ID", i.Elements[kt].AD_Column_ID), ri = vt(fi, ti), br) { ei = n.MLookupFactory.getMLookUp(n.Env.getCtx(), o, i.Elements[kt].AD_Column_ID, n.DisplayType.Search); w = new n.Controls.VTextBoxButton(ri, gt, !1, !0, n.DisplayType.Search, ei); u(bt, w, gt, ni, pi); w.fireValueChanged = t; function t() { er = w.getValue(); pr = !0 } } else di = n.MLookupFactory.getMLookUp(n.Env.getCtx(), o, i.Elements[kt].AD_Column_ID, n.DisplayType.TableDir), w = new n.Controls.VComboBox(ri, !1, !1, !0, di, 150, n.DisplayType.TableDir, 0), u(bt, w, gt, ni, pi), pr = !1; else continue; else if (ui.equals(wi)) if (bt = e.getField("UserElement9_ID"), i.Elements[kt].AD_Column_ID > 0) if (fi = "VIS_125", ti = [], ti[0] = new n.DB.SqlParam("@AD_Column_ID", i.Elements[kt].AD_Column_ID), ri = vt(fi, ti), br) { ei = n.MLookupFactory.getMLookUp(n.Env.getCtx(), o, i.Elements[kt].AD_Column_ID, n.DisplayType.Search); b = new n.Controls.VTextBoxButton(ri, gt, !1, !0, n.DisplayType.Search, ei); u(bt, b, gt, ni, wi); b.fireValueChanged = t; function t() { or = b.getValue(); wr = !0 } } else di = n.MLookupFactory.getMLookUp(n.Env.getCtx(), o, i.Elements[kt].AD_Column_ID, n.DisplayType.TableDir), b = new n.Controls.VComboBox(ri, !1, !1, !0, di, 150, n.DisplayType.TableDir, 0), u(bt, b, gt, ni, wi), wr = !1; else continue } pt.css("display", "none"); bi.html(dt); ii = new n.Query; ii.addRestriction("C_AcctSchema_ID", n.Query.prototype.EQUAL, at); fi = "VIS_126"; ti = []; ti[0] = new n.DB.SqlParam("@tblID_s", f); du = vt(fi, ti); du == "GL_JournalLine" && ii.addRestriction("IsFullyQualified", n.Query.prototype.EQUAL, "Y"); oi.C_ValidCombination_ID == 0 ? e.setQuery(n.Query.prototype.getEqualQuery("1", "2")) : (lu = new n.Query, lu.addRestriction("C_AcctSchema_ID", n.Query.prototype.EQUAL, at), lu.addRestriction("C_ValidCombination_ID", n.Query.prototype.EQUAL, oi.C_ValidCombination_ID), e.setQuery(lu)); yt.query(0, 0, !1); vu.text(i.Description); au = dt.find('[name="AD_Org_ID"]'); window.setTimeout(function () { var r; ki.css("width", "73%"); bi.parent().css({ width: "27%", padding: "0 10px 0 0" }); var u = t(dt.find("button").parent().find("input")[0]).width(), i = []; if (i[0] = new n.DB.SqlParam("@tblID_s", f), r = vt("VIS_126", i), r == "GL_JournalLine") au.on("click", function () { au.find("option[value=0]").length != 0 && au.find("option[value=0]").remove() }) }, 200) } }) } function u(i, r, u, f, e) { var l, c, h, o; s.log.fine("Field=" + i); bt = t("<tr>"); dt.append(bt); l = n.VControlFactory.getLabel(i); r.setReadOnly(!1); r.setMandatory(u); i.setPropertyChangeListener(r); c = t("<td>"); bt.append(c.css("padding", "4px 0px 2px 0px")); c.append(l.getControl().addClass("VIS_Pref_Label_Font")); e != undefined && (e == "X1" || e == "X2" || e == "X3" || e == "X4" || e == "X5" || e == "X6" || e == "X7" || e == "X8" || e == "X9") && c.find("label").text(f); bt = t("<tr>"); dt.append(bt); h = t("<td>"); r.getBtnCount() >= 2 ? (bt.append(h), o = t("<Div class='vis-act-frm-parm'>"), h.append(o), window.innerHeight > 700 ? (o.append(r.getControl().css("width", "85%")), o.append(r.getBtn(0))) : (o.append(r.getControl().css("width", "85%")), o.append(r.getBtn(0).css("width", "30px").css("-webkit-appearance", "none").css("height", "30px").css("padding", "0px").css("border-color", "#BBBBBB")))) : (bt.append(h), h.append(r.getControl().css("width", "100%"))) } function r(n) { return n == null || n == 0 ? !0 : !1 } function wu() { if (au = e.getValue("C_ValidCombination_ID"), s.onClose) s.onClose(au); i.dialog("close") } function ti(t) { var i = null, u; i = ii != null ? jQuery.extend(!0, {}, ii) : new n.Query; t && k != null && k.getValue().toString().length > 0 && (u = k.getValue().toString().toUpperCase(), u.endsWith("%") || (u += "%"), i.addRestriction("UPPER(Alias)", i.LIKE, u)); t && wt.getValue().toString().length > 0 && (u = wt.getValue().toString().toUpperCase(), u.endsWith("%") || (u += "%"), i.addRestriction("UPPER(Combination)", i.LIKE, u)); d != null && d.getValue() != null && i.addRestriction("AD_Org_ID", i.EQUAL, n.Utility.Util.getValueOfInt(d.getValue())); nt == null || r(nt.getValue()) || i.addRestriction("Account_ID", i.EQUAL, n.Utility.Util.getValueOfInt(nt.getValue())); tt == null || r(tt.getValue()) || i.addRestriction("C_SubAcct_ID", i.EQUAL, n.Utility.Util.getValueOfInt(tt.getValue())); g == null || r(g.getValue()) || i.addRestriction("M_Product_ID", i.EQUAL, n.Utility.Util.getValueOfInt(g.getValue())); it == null || r(it.getValue()) || i.addRestriction("C_BPartner_ID", i.EQUAL, n.Utility.Util.getValueOfInt(it.getValue())); rt == null || r(rt.getValue()) || i.addRestriction("C_Campaign_ID", i.EQUAL, n.Utility.Util.getValueOfInt(rt.getValue())); ut == null || r(ut.getValue()) || i.addRestriction("C_LocFrom_ID", i.EQUAL, n.Utility.Util.getValueOfInt(ut.getValue())); ft == null || r(ft.getValue()) || i.addRestriction("C_LocTo_ID", i.EQUAL, n.Utility.Util.getValueOfInt(ft.getValue())); et == null || r(et.getValue()) || i.addRestriction("C_Project_ID", i.EQUAL, n.Utility.Util.getValueOfInt(et.getValue())); ot == null || r(ot.getValue()) || i.addRestriction("C_SalesRegion_ID", i.EQUAL, n.Utility.Util.getValueOfInt(ot.getValue())); st == null || r(st.getValue()) || i.addRestriction("AD_OrgTrx_ID", i.EQUAL, n.Utility.Util.getValueOfInt(st.getValue())); ht == null || r(ht.getValue()) || i.addRestriction("C_Activity_ID", i.EQUAL, n.Utility.Util.getValueOfInt(ht.getValue())); ct == null || r(ct.getValue()) || i.addRestriction("User1_ID", i.EQUAL, n.Utility.Util.getValueOfInt(ct.getValue())); lt == null || r(lt.getValue()) || i.addRestriction("User2_ID", i.EQUAL, n.Utility.Util.getValueOfInt(lt.getValue())); h == null || r(h.getValue()) || i.addRestriction("UserElement1_ID", i.EQUAL, n.Utility.Util.getValueOfInt(h.getValue())); c == null || r(c.getValue()) || i.addRestriction("UserElement2_ID", i.EQUAL, n.Utility.Util.getValueOfInt(c.getValue())); l == null || r(l.getValue()) || i.addRestriction("UserElement3_ID", i.EQUAL, n.Utility.Util.getValueOfInt(l.getValue())); a == null || r(a.getValue()) || i.addRestriction("UserElement4_ID", i.EQUAL, n.Utility.Util.getValueOfInt(a.getValue())); v == null || r(v.getValue()) || i.addRestriction("UserElement5_ID", i.EQUAL, n.Utility.Util.getValueOfInt(v.getValue())); y == null || r(y.getValue()) || i.addRestriction("UserElement6_ID", i.EQUAL, n.Utility.Util.getValueOfInt(y.getValue())); p == null || r(p.getValue()) || i.addRestriction("UserElement7_ID", i.EQUAL, n.Utility.Util.getValueOfInt(p.getValue())); w == null || r(w.getValue()) || i.addRestriction("UserElement8_ID", i.EQUAL, n.Utility.Util.getValueOfInt(w.getValue())); b == null || r(b.getValue()) || i.addRestriction("UserElement9_ID", i.EQUAL, n.Utility.Util.getValueOfInt(b.getValue())); e.setQuery(i); yt.query(0, 0, !1) } function bu() { k != null && k.setValue(""); wt.setValue(""); di.Content = ""; di.Visible = !1; pt.val(""); d.setValue(null); nt.setValue(null); tt != null && tt.setValue(null); g != null && g.setValue(null); it != null && it.setValue(null); rt != null && rt.setValue(null); ut != null && ut.setValue(null); ft != null && ft.setValue(null); et != null && et.setValue(null); ot != null && ot.setValue(null); st != null && st.setValue(null); ht != null && ht.setValue(null); ct != null && ct.setValue(null); lt != null && lt.setValue(null); h != null && h.setValue(null); c != null && c.setValue(null); l != null && l.setValue(null); a != null && a.setValue(null); v != null && v.setValue(null); y != null && y.setValue(null); p != null && p.setValue(null); w != null && w.setValue(null); b != null && b.setValue(null) } function nf() { var o = null, u = "", ui = null, fi, br, yt, vt, si, hi, ci, li, ai, vi, yi, pi, wi, bi, ki, di, pt, wt, bt, dt, gt, ni, ti, ii, ri, kr, dr; for (kt.IsHasAlies && (ui = k.getValue(), ui == null && o != null && (o = o.concat(n.Msg.translate(n.Env.getCtx(), "Alias")).concat(", "))), fi = [], vt = 0; vt < kt.Elements.length; vt++)br = kt.Elements[vt], fi.push(br.Name); if (t.ajax({ url: n.Application.contextUrl + "AccountForm/GetValidCombination", dataType: "json", type: "POST", async: !1, data: { accountSchemaElements: JSON.stringify(kt), Elements: JSON.stringify(kt.Elements), aseList: JSON.stringify(fi), value: ui, strinB: o }, success: function (n) { u = n }, error: function (n) { console.log(n) } }), o != null) { n.ADialog.info("FillMandatory", !0, o.ToString().Substring(0, o.Length - 2), null); return } if (d == null || d.getValue() == null) { n.ADialog.info("FillMandatory", !0, n.Msg.getElement(n.Env.getCtx(), "AD_Org_ID"), null); return } if (nt == null || r(nt.getValue())) { n.ADialog.info("FillMandatory", !0, n.Msg.getElement(n.Env.getCtx(), "Account_ID"), null); s.setBusy(!1); return } u = u.concat("AD_Client_ID=" + n.Env.getCtx().getAD_Client_ID() + " AND C_AcctSchema_ID=" + at); s.log.fine("Check = " + u.toString()); var gr = k.getValue().toString(), f = 0, e = null, oi = k.getValue().toString(), i = null; try { i = ef(u, null); i.read() && (f = i.tables[0].rows[0].cells.c_validcombination_id, e = i.tables[0].rows[0].cells.alias); i.close(); i = null } catch (nu) { f = 0; i != null && (i.close(), i = null) } if (s.log.fine("ID=" + f + ", Alias=" + e), e == null && (e = ""), f != 0 && kt.IsHasAlies && oi.equals(e)) { yt = []; oi.toString().length == 0 ? (u = "VIS_127", yt[0] = new n.DB.SqlParam("@IDvalue", f)) : (u = "VIS_128", yt[0] = new n.DB.SqlParam("@f_alies", oi), yt[1] = new n.DB.SqlParam("@IDvalue", f)); vt = 0; try { ff(u, yt) } catch (nu) { } } if (f != 0) { ei(f, at); return } s.log.config("New"); e = null; k != null && (e = k.getValue().toString()); si = 0; tt != null && tt.getValue() != null && (si = tt.getValue()); hi = 0; g == null || r(g.getValue()) || (hi = g.getValue()); ci = 0; it == null || r(it.getValue()) || (ci = it.getValue()); li = 0; st == null || r(st.getValue()) || (li = st.getValue()); ai = 0; ut == null || r(ut.getValue()) || (ai = ut.getValue()); vi = 0; ft == null || r(ft.getValue()) || (vi = ft.getValue()); yi = 0; ot == null || r(ot.getValue()) || (yi = ot.getValue()); pi = 0; et == null || r(et.getValue()) || (pi = et.getValue()); wi = 0; rt == null || r(rt.getValue()) || (wi = rt.getValue()); bi = 0; ht == null || r(ht.getValue()) || (bi = ht.getValue()); ki = 0; ct == null || r(ct.getValue()) || (ki = ct.getValue()); di = 0; lt == null || r(lt.getValue()) || (di = lt.getValue()); pt = 0; h == null || r(h.getValue()) || (pt = h.getValue()); wt = 0; c == null || r(c.getValue()) || (wt = c.getValue()); bt = 0; l == null || r(l.getValue()) || (bt = l.getValue()); dt = 0; a == null || r(a.getValue()) || (dt = a.getValue()); gt = 0; v == null || r(v.getValue()) || (gt = v.getValue()); ni = 0; y == null || r(y.getValue()) || (ni = y.getValue()); ti = 0; p == null || r(p.getValue()) || (ti = p.getValue()); ii = 0; w == null || r(w.getValue()) || (ii = w.getValue()); ri = 0; b == null || r(b.getValue()) || (ri = b.getValue()); kr = d.getValue(); dr = nt.getValue(); sr && gi != null && (pt = gi); hr && nr != null && (wt = nr); cr && tr != null && (bt = tr); lr && ir != null && (dt = ir); ar && rr != null && (gt = rr); vr && ur != null && (ni = ur); yr && fr != null && (ti = fr); pr && er != null && (ii = er); wr && or != null && (ri = or); t.ajax({ url: n.Application.contextUrl + "AccountForm/Save", dataType: "json", data: { AD_Client_ID: n.Env.getCtx().getAD_Client_ID(), AD_Org_ID: kr, C_AcctSchema_ID: at, AD_Account_ID: dr, C_SubAcct_ID: si, M_Product_ID: hi, C_BPartner_ID: ci, AD_OrgTrx_ID: li, C_LocFrom_ID: ai, C_LocTo_ID: vi, C_SRegion_ID: yi, C_Project_ID: pi, C_Campaign_ID: wi, C_Activity_ID: bi, User1_ID: ki, User2_ID: di, UserElement1_ID: pt, UserElement2_ID: wt, UserElement3_ID: bt, UserElement4_ID: dt, UserElement5_ID: gt, UserElement6_ID: ni, UserElement7_ID: ti, UserElement8_ID: ii, UserElement9_ID: ri, Alias: e }, success: function (n) { returnValue = n.result; ei(returnValue.C_ValidCombination_ID, returnValue.C_AcctSchema_ID) } }) } function ei(t, i) { var r = null, u; try { u = []; u[0] = new n.DB.SqlParam("@C_ValidCombination_ID", t); u[1] = new n.DB.SqlParam("@C_AcctSchema_ID", i); r = uf("VIS_124", u); r.read() && (k != null && k.setValue(r.getString("Alias")), wt != null && wt.setValue(r.getString("Combination")), d != null && d.setValue(r.getInt("AD_Org_ID")), nt != null && nt.setValue(r.getInt("Account_ID")), tt != null && tt.setValue(r.getInt("C_SubAcct_ID")), g != null && r.getInt("M_Product_ID") != 0 && g.setValue(r.getInt("M_Product_ID")), it != null && r.getInt("C_BPartner_ID") != 0 && it.setValue(r.getInt("C_BPartner_ID")), rt != null && rt.setValue(r.getInt("C_Campaign_ID")), ut != null && ut.setValue(r.getInt("C_LocFrom_ID")), ft != null && ft.setValue(r.getInt("C_LocTo_ID")), et != null && et.setValue(r.getInt("C_Project_ID")), ot != null && ot.setValue(r.getInt("C_SalesRegion_ID")), st != null && st.setValue(r.getInt("AD_OrgTrx_ID")), ht != null && ht.setValue(r.getInt("C_Activity_ID")), ct != null && ct.setValue(r.getInt("User1_ID")), lt != null && lt.setValue(r.getInt("User2_ID")), h != null && r.getInt("UserElement1_ID") != 0 && h.setValue(r.getInt("UserElement1_ID")), c != null && r.getInt("UserElement2_ID") != 0 && c.setValue(r.getInt("UserElement2_ID")), l != null && r.getInt("UserElement3_ID") != 0 && l.setValue(r.getInt("UserElement3_ID")), a != null && r.getInt("UserElement4_ID") != 0 && a.setValue(r.getInt("UserElement4_ID")), v != null && r.getInt("UserElement5_ID") != 0 && v.setValue(r.getInt("UserElement5_ID")), y != null && r.getInt("UserElement6_ID") != 0 && y.setValue(r.getInt("UserElement6_ID")), p != null && r.getInt("UserElement7_ID") != 0 && p.setValue(r.getInt("UserElement7_ID")), w != null && r.getInt("UserElement8_ID") != 0 && w.setValue(r.getInt("UserElement8_ID")), b != null && r.getInt("UserElement9_ID") != 0 && b.setValue(r.getInt("UserElement9_ID")), pt != null && pt.text(r.getString("Description"))); r.close(); r = null } catch (f) { r != null && (r.close(), r = null) } ti(!1) } gt = i.find("#btnOk_" + o); ni = i.find("#btnCancel_" + o); ri = i.find("#btnRefresh_" + o); ui = i.find("#btnUndo_" + o); fi = i.find("#btnSave_" + o); lu = i.find("#lblParameter_" + o); bi = i.find("#parameterDiv_" + o); ku = i.find("#bottumDiv_" + o); du = i.find("#discriptionDiv_" + o); ki = i.find("#accDiv_" + o); gu = i.find("#acctbl_" + o); vu = i.find("#lblbottumMsg_" + o); yu = i.find("#lblCount_" + o); pt = i.find("#lblbottumMsg2_" + o); n.Application.isRTL && (gt.css("margin-right", "-128px"), ni.css("margin-right", "55px")); gt.val(n.Msg.getMsg("OK")); ni.val(n.Utility.Util.cleanMnemonic(n.Msg.getMsg("Cancel"))); lu.val(n.Msg.getMsg("Parameter")); br(); gt.on("click", function () { s.setBusy(!0); wu(); s.setBusy(!1) }); ni.on("click", function () { i.dialog("close") }); ri.on("click", function () { s.setBusy(!0); ti(!0); s.setBusy(!1) }); ui.on("click", function () { bu() }); fi.on("click", function () { s.setBusy(!0); nf(); s.setBusy(!1) }) }; this.showDialog = function () { var n = t(window).width() - 50, i = t(window).height() - 60; ei.height(i); ei.width(n); ti.append(ei); ti.dialog({ modal: !1, resizable: !1, title: pu, width: n, height: i, position: { at: "center top", of: window }, close: function () { s.dispose(); ti.dialog("destroy"); ti = null; s = null } }) }; this.dataStatusChanged = function (n) { var t = e.getValue("Description"); wu = e.getValue("COMBINATION"); t != null && t.length > 0 ? pt.css("display", "inline-block") : pt.css("display", "none"); pt.text(t); yu.text(n.totalRecords) }; this.disposeComponent = function () { gt && gt.off("click"); ni && ni.off("click"); ri && ri.off("click"); ui && ui.off("click"); fi && fi.off("click"); pu = null; oi = null; at = null; o = null; wu = null; di = null; k = null; wt = null; d = null; nt = null; tt = null; g = null; it = null; rt = null; ut = null; ft = null; et = null; ot = null; st = null; ht = null; ct = null; lt = null; this.log = null; sf = null; kr = null; dr = null; gr = null; nu = null; tu = null; iu = null; ru = null; uu = null; fu = null; eu = null; ou = null; su = null; hu = null; cu = null; si = null; hi = null; ci = null; li = null; ai = null; vi = null; yi = null; pi = null; wi = null; dt = null; bt = null; gt = null; ni = null; ri = null; ui = null; fi = null; lu = null; bi = null; ku = null; du = null; ki = null; gu = null; yt = null; hf = !1; au = null; ii = null; e = null; vu = null; yu = null; pt = null; kt = null } } i.prototype.dispose = function () { this.disposeComponent() }; n.AccountForm = i }(VIS, jQuery), function (n, t) { function i() { function di() { var d, wt, v, r; h = t("<label id='lblReportQ_" + i.windowNo + "' class='vis-ec-col-lblchkbox'><input id='chkReportQ_" + i.windowNo + "' type='checkbox' style='margin-left: 0px;' class='VIS_Pref_automatic'>" + n.Msg.translate(n.Env.getCtx(), "IsReport") + "<\/label>"); bt = new n.Controls.VLabel; y = new n.Controls.VLabel; kt = new n.Controls.VLabel; dt = new n.Controls.VLabel; gt = new n.Controls.VLabel; ni = new n.Controls.VLabel; ti = new n.Controls.VLabel; ii = new n.Controls.VLabel; d = n.MLookupFactory.get(n.Env.getCtx(), i.windowNo, 0, n.DisplayType.Search, "C_BPartner_ID", 0, !1, null); ft = new n.Controls.VTextBoxButton("C_BPartner_ID", !1, !1, !0, n.DisplayType.Search, d); p = new n.Controls.VComboBox("", !1, !1, !0); o = new n.Controls.VComboBox("", !1, !1, !0); et = new n.Controls.VTextBox("NameQ", !1, !1, !0, 50, 50, "NameQ"); ot = new n.Controls.VTextBox("DescriptionQ", !1, !1, !0, 50, 50, "DescriptionQ"); st = new n.Controls.VTextBox("CommentQ", !1, !1, !0, 50, 50, "CommentQ"); et.getControl().val("%%"); ot.getControl().val("%%"); st.getControl().val("%%"); w = new n.Controls.VComboBox("", !1, !1, !0); ri = t("<input id='dtpCreatedFromQ_" + i.windowNo + "' type='date'>"); ui = t("<input id='dtpCreatedToQ_" + i.windowNo + "' type='date'>"); fi = new n.Controls.VLabel; ei = new n.Controls.VLabel; oi = new n.Controls.VLabel; si = new n.Controls.VLabel; hi = new n.Controls.VLabel; ht = new n.Controls.VTextBox("CreatedBy", !1, !0, !0, 50, 50, "CreatedBy"); g = new n.Controls.VTextBox("Name", !1, !1, !0, 50, 50, "Name"); nt = new n.Controls.VTextBox("Description", !1, !1, !0, 50, 50, "Description"); tt = new n.Controls.VTextArea("Comment", !1, !1, !0, 200, 200); ct = t("<input id='dtpCreatedOn_" + i.windowNo + "' readonly class='vis-gc-vpanel-table-readOnly'>"); lt = new n.Controls.VLabel; s = t("<input id='btnOk_" + i.windowNo + "' class='VIS_Pref_btn-2 vis-frm-button' style=' margin-top: 0px; margin-right: 0px;' type='button' value='Ok'>"); it = t("<input id='btnSave_" + i.windowNo + "' class='VIS_Pref_btn-2' style='margin-top: 0px;float: right;' type='button' value='Save'>"); at = t("<input id='btnNext_" + i.windowNo + "' class='VIS_Pref_btn-2' style='margin: 10px; display: none;'  type='button' value='>>'>"); vt = t("<input id='btnPre_" + i.windowNo + "' class='VIS_Pref_btn-2' style='margin: 10px; display: none;' type='button' value='<<'>"); it.val(n.Msg.getMsg("Save")); s.val(n.Msg.getMsg("OK")); wt = n.Application.contextUrl + "Areas/VIS/Images/base/arrow-left.png"; f = t("<div class='vis-archive-left-sidebar' id='topLeftDiv_" + i.windowNo + "'><div id='topToggalDiv_" + i.windowNo + "' class='vis-archive-l-s-head'><button id='btnToggal_" + i.windowNo + "' class='vis-archive-sb-t-button'><i class='vis vis-arrow-left'><\/i><\/button><\/div><\/div>"); this.btnToggal = f.find("#btnToggal_" + i.windowNo); u = t("<div class='vis-archive-l-s-content vis-leftsidebarouterwrap' id='topleftparaDiv_" + i.windowNo + "'>"); ci = t("<div  class='vis-archive-l-s-content-inner' id='topleftInnerParaDiv_" + i.windowNo + "'>"); u.append(ci); f.append(u); f.css("width", l); var b = t("<table style='width: 100%' class='vis-formouterwrpdiv'>"), a = t("<tr>"), e = t("<td style='padding: 0px 10px 0px;'>"), v = t('<div class="input-group vis-input-wrap">'), r = t('<div class="vis-control-wrap">'); ci.append(b); b.append(a); a.append(e); e.append(v); v.append(r); r.append(h); a = t("<tr>"); e = t("<td style='padding: 0px 10px 0px;'>"); var v = t('<div class="input-group vis-input-wrap">'), r = t('<div class="vis-control-wrap">'), rt = t('<div class="input-group-append">'); b.append(a); a.append(e); e.append(v); v.append(r); v.append(rt); r.append(ft.getControl().attr("data-placeholder", "").attr("placeholder", " ").attr("data-hasbtn", " ").addClass("VIS-Search-hide")); rt.append(ft.getBtn(0).addClass("VIS-Search-hide")); r.append(bt.getControl().addClass("VIS-Search-hide").addClass("VIS_Pref_Label_Font")); r.append(o.getControl()); r.append(y.getControl().addClass("VIS_Pref_Label_Font")); y.getControl().hide(); o.getControl().hide(); a = t("<tr>"); e = t("<td style='padding: 0px 10px 0px;'>"); v = t('<div class="input-group vis-input-wrap">'); r = t('<div class="vis-control-wrap">'); b.append(a); a.append(e); e.append(v); v.append(r); r.append(p.getControl()); r.append(kt.getControl().addClass("VIS_Pref_Label_Font")); a = t("<tr>"); e = t("<td style='padding: 0px 10px 0px;'>"); v = t('<div class="input-group vis-input-wrap">'); r = t('<div class="vis-control-wrap">'); b.append(a); a.append(e); e.append(v); v.append(r); r.append(et.getControl().attr("data-placeholder", "").attr("placeholder", " ")); r.append(dt.getControl().addClass("VIS_Pref_Label_Font")); a = t("<tr>"); e = t("<td style='padding: 0px 10px 0px;'>"); v = t('<div class="input-group vis-input-wrap">'); r = t('<div class="vis-control-wrap">'); b.append(a); a.append(e); e.append(v); v.append(r); r.append(ot.getControl().attr("data-placeholder", "").attr("placeholder", " ")); r.append(gt.getControl().addClass("VIS_Pref_Label_Font")); a = t("<tr>"); e = t("<td style='padding: 0px 10px 0px;'>"); v = t('<div class="input-group vis-input-wrap">'); r = t('<div class="vis-control-wrap">'); b.append(a); a.append(e); e.append(v); v.append(r); r.append(st.getControl().attr("data-placeholder", "").attr("placeholder", " ")); r.append(ni.getControl().addClass("VIS_Pref_Label_Font")); a = t("<tr>"); e = t("<td style='padding: 0px 10px 0px;'>"); v = t('<div class="input-group vis-input-wrap">'); r = t('<div class="vis-control-wrap">'); b.append(a); a.append(e); e.append(v); v.append(r); r.append(w.getControl()); r.append(ti.getControl().addClass("VIS_Pref_Label_Font")); a = t("<tr>"); e = t("<td style='padding: 0px 10px 0px;'>"); v = t('<div class="input-group vis-input-wrap">'); r = t('<div class="vis-control-wrap">'); b.append(a); a.append(e); e.append(v); v.append(r); r.append(ri); r.append(ii.getControl().addClass("VIS_Pref_Label_Font")); a = t("<tr>"); e = t("<td style='padding: 0px 10px 0px;'>"); v = t('<div class="input-group vis-input-wrap">'); r = t('<div class="vis-control-wrap">'); b.append(a); a.append(e); e.append(v); v.append(r); r.append(ui); li = t("<div class='vis-frm-bot-btn-wrp' id='leftBottomDiv_" + i.windowNo + "'>"); f.append(li); li.append(s); c = t("<div id='topRightDiv_" + i.windowNo + "' class='vis-frm-grid-wrap'>"); yt = t("<div id='rightTopDiv_" + i.windowNo + "' style='float: left; width: 100%; height: 55%;'>"); pt = t("<div id='rightBottomDiv_" + i.windowNo + "' style='float: left; width: 100%;margin-top: 5px; margin-bottom: 10px; '>"); yt.css("height", "calc(100% - 274px)"); pt.css("height", ki); b = t("<table style='width: 100%; ' class='vis-formouterwrpdiv'>"); a = t("<tr>"); e = t("<td colspan='4' style='text-align: right; height: 10px;'>"); pt.append(b); b.append(a); a.append(e); e.append(vt).append(lt.getControl().css("display", "inline-block").css("margin-top", "20px").css("margin-right", "10px").css("margin-left", "10px").addClass("VIS_Pref_Label_Font")).append(at); lt.getControl().css("display", "none"); a = t("<tr>"); e = t("<td colspan='2' class='VIS-archive-table-padding'>"); v = t('<div class="input-group vis-input-wrap">'); r = t('<div class="vis-control-wrap">'); b.append(a); a.append(e); e.append(v); v.append(r); r.append(ht.getControl().attr("data-placeholder", "").attr("placeholder", " ").addClass("VIS_Pref_Label_Font")); r.append(fi.getControl().addClass("VIS_Pref_Label_Font")); e = t("<td colspan='2' class='VIS-archive-table-padding'>"); v = t('<div class="input-group vis-input-wrap">'); r = t('<div class="vis-control-wrap">'); b.append(a); a.append(e); e.append(v); v.append(r); r.append(ct.addClass("VIS_Pref_Label_Font")); r.append(ei.getControl().addClass("VIS_Pref_Label_Font")); a = t("<tr>"); e = t("<td colspan='2' class='VIS-archive-table-padding'>"); v = t('<div class="input-group vis-input-wrap">'); r = t('<div class="vis-control-wrap">'); b.append(a); a.append(e); e.append(v); v.append(r); r.append(g.getControl().attr("data-placeholder", "").attr("placeholder", " ").addClass("VIS_Pref_Label_Font")); r.append(oi.getControl().addClass("VIS_Pref_Label_Font")); e = t("<td colspan='2' class='VIS-archive-table-padding'>"); v = t('<div class="input-group vis-input-wrap">'); r = t('<div class="vis-control-wrap">'); b.append(a); a.append(e); e.append(v); v.append(r); r.append(nt.getControl().attr("data-placeholder", "").attr("placeholder", " ").addClass("VIS_Pref_Label_Font")); r.append(si.getControl().addClass("VIS_Pref_Label_Font")); a = t("<tr>"); e = t("<td colspan='4' class='VIS-archive-table-padding'>"); v = t('<div class="input-group vis-input-wrap">'); r = t('<div class="vis-control-wrap">'); b.append(a); a.append(e); e.append(v); v.append(r); r.append(tt.getControl().attr("data-placeholder", "").attr("placeholder", " ").addClass("VIS_Pref_Label_Font")); r.append(hi.getControl().addClass("VIS_Pref_Label_Font")); ai = t("<div style='float: left; width: 100%;height: 40px;position: relative;' id='rightBottomSaveDiv_" + i.windowNo + "'>"); ai.append(it); c.append(yt).append(pt).append(ai); ut.append(k); ut.append(f).append(c) } function gi() { y.getControl().text(n.Msg.translate(n.Env.getCtx(), "AD_Process_ID")); kt.getControl().text(n.Msg.translate(n.Env.getCtx(), "AD_Table_ID")); bt.getControl().text(n.Msg.translate(n.Env.getCtx(), "C_BPartner_ID")); dt.getControl().text(n.Msg.translate(n.Env.getCtx(), "Name")); gt.getControl().text(n.Msg.translate(n.Env.getCtx(), "Description")); ni.getControl().text(n.Msg.translate(n.Env.getCtx(), "Help")); ti.getControl().text(n.Msg.translate(n.Env.getCtx(), "CreatedBy")); ii.getControl().text(n.Msg.translate(n.Env.getCtx(), "Created")); fi.getControl().text(n.Msg.translate(n.Env.getCtx(), "CreatedBy")); ei.getControl().text(n.Msg.translate(n.Env.getCtx(), "Created")); oi.getControl().text(n.Msg.translate(n.Env.getCtx(), "Name")); si.getControl().text(n.Msg.translate(n.Env.getCtx(), "Description")); hi.getControl().text(n.Msg.translate(n.Env.getCtx(), "Help")); lt.getControl().text(n.Msg.translate(n.Env.getCtx(), "NoRecordFound")) } function nr() { var c = n.context.getAD_Role_ID(), i = !0, s = "VIS_153", f = [], e, t; f[0] = new n.DB.SqlParam("@param1", c); for (var l = { sql: s, param: f }, e = n.dataContext.getJSONData(n.Application.contextUrl + "JsonData/JDataSetWithCode", l), t = (new n.DB.DataReader).toJson(JSON.stringify(e)), r, u; t.read();)r = n.Utility.Util.getValueOfInt(t.getString(0)), u = n.Utility.encodeText(t.getString(1)), i && (o.getControl().append(" <option><\/option>"), i = !1), o.getControl().append(" <option value=" + r + ">" + u + "<\/option>"); t.close(); i = !0; o.getControl().prop("selectedIndex", 0); s = "VIS_154"; f = []; f[0] = new n.DB.SqlParam("@param1", c); for (var l = { sql: s, param: f }, e = n.dataContext.getJSONData(n.Application.contextUrl + "JsonData/JDataSetWithCode", l), t = (new n.DB.DataReader).toJson(JSON.stringify(e)); t.read();)r = n.Utility.Util.getValueOfInt(t.getString(0)), u = n.Utility.encodeText(t.getString(1)), i && (p.getControl().append(" <option><\/option>"), i = !1), p.getControl().append(" <option value=" + r + ">" + u + "<\/option>"); for (t.close(), i = !0, p.getControl().prop("selectedIndex", 0), e = n.dataContext.getJSONData(n.Application.contextUrl + "ArchiveViewer/GetUserList", {}), t = (new n.DB.DataReader).toJson(JSON.stringify(e)); t.read();)r = n.Utility.Util.getValueOfInt(t.getString(0)), u = n.Utility.encodeText(t.getString(1)), i && (w.getControl().append(" <option><\/option>"), i = !1), w.getControl().append(" <option value=" + r + ">" + u + "<\/option>"); t.close(); i = !0; w.getControl().prop("selectedIndex", 0); a > 0 && (h.find("input").prop("checked", !0), wt()) } function wt() { var t = "", s = h.find("input").prop("checked"), l = null, u, c, r, e, f, y; l = n.MRole.getDefault(); try { if (!l.getIsCanReport()) { i.log.warning("User/Role cannot Report AD_User_ID=" + n.context.getAD_User_ID()); return } t = t.concat(" AND IsReport=").concat(s ? "'Y'" : "'N'"); s && (u = o.getControl().find("option:selected").val(), u != "" && u != null && (t = t.concat(" AND AD_Process_ID=").concat(u))); a > 0 ? (t = t.concat(" AND ((AD_Table_ID=").concat(a), v > 0 && (t = t.concat(" AND Record_ID=").concat(v)), t = t.concat(")"), a == X_C_BPartner.Table_ID && v > 0 && (t = t.concat(" OR C_BPartner_ID=").concat(v)), t = t.concat(")"), a = 0, v = 0) : (u = p.getControl().find("option:selected").val(), u != "" && u != null && (t = t.concat(" AND AD_Table_ID=").concat(u))); s || (c = ft.getValue(), t = c != null ? t.concat(" AND C_BPartner_ID=").concat(c) : t.concat(" AND C_BPartner_ID IS NOT NULL")); r = et.getControl().val(); r != null && r != "%%" && r.length > 0 && (t = r.indexOf("%") != -1 || r.indexOf("_") != -1 ? t.concat(" AND LOWER(Name) LIKE LOWER( ").concat("'").concat(r).concat("')") : t.concat(" AND LOWER(Name)= LOWER(").concat("'").concat(r).concat("')")); r = ot.getControl().val(); r != null && r != "%%" && r.length > 0 && (t = r.indexOf("%") != -1 || r.indexOf("_") != -1 ? t.concat(" AND LOWER(Description) LIKE LOWER( ").concat("'").concat(r).concat("')") : t.concat(" AND LOWER(Description)= LOWER(").concat("'").concat(r).concat("')")); r = st.getControl().val(); r != null && r != "%%" && r.length > 0 && (t = r.indexOf("%") != -1 || r.indexOf("_") != -1 ? t.concat(" AND LOWER(Help) LIKE LOWER( ").concat("'").concat(r).concat("')") : t.concat(" AND LOWER(Help)= LOWER(").concat("'").concat(r).concat("')")); e = w.getControl().find("option:selected").val(); e != null && e > 0 && (t = t.concat(" AND CreatedBy=").concat(e)); f = ri.val(); f != "" && (t = t.concat(" AND ").concat("TRUNC(").concat("Created,'DD') >= ").concat(n.DB.to_date(f))); f = ui.val(); f != "" && (t = t.concat(" AND ").concat("TRUNC(").concat("Created,'DD') <= ").concat(n.DB.to_date(f))); i.log.fine(t.toString()); t = t.concat(" AND (AD_Process_ID IS NULL OR AD_Process_ID IN (SELECT AD_Process_ID FROM AD_Process_Access WHERE AD_Role_ID=").concat(n.context.getAD_Role_ID()).concat("))"); t = t.concat(" AND (AD_Table_ID IS NULL OR (AD_Table_ID IS NOT NULL AND AD_Process_ID IS NOT NULL) OR AD_Table_ID IN (SELECT t.AD_Table_ID FROM AD_Tab t INNER JOIN AD_Window_Access wa ON (t.AD_Window_ID=wa.AD_Window_ID) WHERE wa.AD_Role_ID=").concat(n.context.getAD_Role_ID()).concat("))"); i.log.finest(t.toString()) } catch (b) { } y = t; fr(y) } function pi(n, t) { return n == null ? t == null : t == null ? !1 : n.equals(t) } function tr() { var u; if (!(r.getSelection().length < 0)) { var f = g.getControl().val(), e = nt.getControl().val(), o = tt.getControl().val(), i = Number(r.getSelection().toString()); r.get(i) != null && (u = !1, pi(f, r.get(i).NAME) || f != null && f.length > 0 && (u = !0), pi(e, r.get(i).DESCRIPTION) || (u = !0), pi(o, r.get(i).HELP) || (u = !0), d = r.get(i).AD_ARCHIVE_ID, u && t.ajax({ url: n.Application.contextUrl + "Common/UpdateArchive", dataType: "json", data: { name: f, des: e, help: o, archiveId: d }, success: function (n) { n.result && wt() } })) } } function wi(u) { r != null && (r.destroy(), r = null); e.length == 0 && (e.push({ field: "NAME", caption: n.Msg.translate(n.Env.getCtx(), "NAME"), sortable: !0, size: "16%", min: 150, hidden: !1 }), e.push({ field: "DESCRIPTION", caption: n.Msg.translate(n.Env.getCtx(), "DESCRIPTION"), sortable: !0, size: "16%", min: 150, hidden: !1 }), e.push({ field: "HELP", caption: n.Msg.getElement(n.Env.getCtx(), "HELP"), sortable: !0, size: "16%", min: 150, hidden: !1 }), e.push({ field: "CREATEDBY", caption: n.Msg.getElement(n.Env.getCtx(), "CREATEDBY"), sortable: !0, size: "16%", min: 150, hidden: !1 }), e.push({ field: "CREATED", caption: n.Msg.getElement(n.Env.getCtx(), "CREATED"), sortable: !0, size: "16%", min: 150, hidden: !1 }), e.push({ field: "View", caption: n.Msg.translate(n.Env.getCtx(), "View"), sortable: !0, size: "80px", min: 150, hidden: !1, render: function () { return '<div><i class="vis vis-download" title="View record" style="opacity: 1; font-size: 1rem"><\/i><\/div>' } }), e.push({ field: "AD_ARCHIVE_ID", caption: n.Msg.translate(n.Env.getCtx(), "AD_ARCHIVE_ID"), hidden: !0 })); setTimeout(10); w2utils.encodeTags(u); r = t(yt).w2grid({ name: "gridArchive" + i.windowNo, recordHeight: 40, columns: e, records: u, onClick: function (n) { n.column == 5 && r.records.length > 0 && ir(n.recid); rr(n.recid) } }) } function ir(i) { d = r.get(i).AD_ARCHIVE_ID; t.ajax({ url: n.Application.contextUrl + "Common/DownloadPdf", dataType: "json", data: { archiveId: d }, success: function (t) { t.result != null && (t.result.indexOf("TempDownload") > -1 ? window.open(n.Application.contextUrl + t.result) : window.open("data:application/pdf;base64, " + t.result)) } }) } function rr(n) { g.getControl().val(r.get(n).NAME); nt.getControl().val(r.get(n).DESCRIPTION); tt.getControl().val(r.get(n).HELP); ht.getControl().val(r.get(n).CREATEDBY); r.get(n).CREATED != null && ct.val(r.get(n).CREATED); d = r.get(n).AD_ARCHIVE_ID } function ur(t) { var r = "", u, i; try { u = n.dataContext.getJSONData(n.Application.contextUrl + "ArchiveViewer/GetUserName", { userId: t }); i = (new n.DB.DataReader).toJson(JSON.stringify(u)); i.read() && (r = i.getString("Name")); i.close() } catch (f) { } return r } function fr(t) { var u = [], i, e, o; try { for (var s = n.dataContext.getJSONData(n.Application.contextUrl + "ArchiveViewer/GetArchieveData", { whereClause: t }), r = (new n.DB.DataReader).toJson(JSON.stringify(s)), f = 1; r.read();)i = {}, i.NAME = r.getString("NAME"), i.DESCRIPTION = r.getString("DESCRIPTION"), i.HELP = r.getString("HELP"), i.CREATEDBY = ur(r.getString("CREATEDBY")), e = r.getString("CREATED"), o = new Date(e), CreatedOn = o.toLocaleDateString(), i.CREATED = CreatedOn, i.AD_ARCHIVE_ID = r.getInt("AD_ARCHIVE_ID"), i.recid = f, f++, u.push(i); r.close() } catch (h) { } return wi(u), u } function er() { g.getControl().val(""); nt.getControl().val(""); tt.getControl().val(""); ht.getControl().val(""); ct.val(null) } function or() { if (s != null) s.on(n.Events.onTouchStartOrClick, function () { k[0].style.visibility = "visible"; wt(); er(); k[0].style.visibility = "hidden" }); if (it != null) it.on(n.Events.onTouchStartOrClick, function () { k[0].style.visibility = "visible"; tr(); k[0].style.visibility = "hidden" }); if (at != null) at.on(n.Events.onTouchStartOrClick, function () { alert("btnNext") }); if (vt != null) vt.on(n.Events.onTouchStartOrClick, function () { alert("btnPre") }); if (this.btnToggal != null) var i = 0; this.btnToggal.on(n.Events.onTouchStartOrClick, function () { rt ? (i = n.Application.isRTL ? 180 : 0, btnToggal.animate({ borderSpacing: i }, { step: function (n) { t(this).css("-webkit-transform", "rotate(" + n + "deg)"); t(this).css("-moz-transform", "rotate(" + n + "deg)"); t(this).css("transform", "rotate(" + n + "deg)") }, duration: "slow" }, "linear"), rt = !1, f.animate({ width: l }, "slow"), u.animate({ width: l }, "slow"), u.find("table").css("display", "block"), s.css("display", "block"), c.animate({ width: vi }, "slow", null, function () { r.resize() })) : (i = n.Application.isRTL ? 0 : 180, btnToggal.animate({ borderSpacing: i }, { step: function (n) { t(this).css("-webkit-transform", "rotate(" + n + "deg)"); t(this).css("-moz-transform", "rotate(" + n + "deg)"); t(this).css("transform", "rotate(" + n + "deg)") }, duration: "slow" }, "linear"), rt = !0, f.animate({ width: b }, "slow"), u.animate({ width: b }, "slow"), u.find("table").css("display", "none"), s.css("display", "none"), c.animate({ width: yi }, "slow", null, function () { r.resize() })) }); h.change(function () { o.getControl().hide(); y.getControl().hide(); t(".VIS-Search-hide").show(); h.find("input").prop("checked") && (o.getControl().show(), y.getControl().show(), t(".VIS-Search-hide").hide()) }) } this.log = n.Logging.VLogger.getVLogger("VIS.ArchiveViewer"); this.frame; this.windowNo; var a = 0, v = 0, i = this, rt = !1, ut = t("<div class='vis-forms-container' style='width: 100%; height: 100%; background-color: white;'>"), k = t('<div class="vis-busyindicatorouterwrap" style="visibility: hidden"><div class="vis-busyindicatorinnerwrap"><i class="vis-busyindicatordiv"><\/i><\/div><\/div>'), e = [], r = null, d = 0, h = null, bt = null, y = null, kt = null, dt = null, gt = null, ni = null, ti = null, ii = null, ft = null, p = null, et = null, ot = null, st = null, w = null, o = null, ri = null, ui = null, fi = null, ei = null, oi = null, si = null, hi = null, g = null, nt = null, tt = null, ht = null, ct = null, lt = null, s = null, it = null, at = null, vt = null; this.btnToggal = null; var f = null, c = null, u = null, ci = null, li = null, yt = null, pt = null, ai = null, l = 260, b = 50, vi = t(window).width() - l, yi = t(window).width() - b, sr = t(window).height() - 193, bi = t(window).height() - 382, ki = t(window).height() - (bi + 55 + 118); this.sizeChanged = function (n, t) { vi = t - (l + 1); yi = t - (b + 1); rt == !0 ? (f.animate({ width: b }, "slow"), u.animate({ width: b }, "slow"), u.find("table").css("display", "none"), s.css("display", "none"), c.animate({ width: yi }, "slow", null, function () { r.resize() })) : (f.animate({ width: l }, "slow"), u.animate({ width: l }, "slow"), u.find("table").css("display", "block"), s.css("display", "block"), c.animate({ width: vi }, "slow", null, function () { r.resize() })) }; this.display = function () { wi() }; this.load = function () { di(); gi(); nr(); or() }; this.getRoot = function () { return ut }; this.disposeComponent = function () { ut = null } } n.Apps = n.Apps || {}; n.Apps.AForms = n.Apps.AForms || {}; var r = n.Application.contextUrl, u = r + "JsonData/JDataSetWithCode"; i.prototype.sizeChanged = function () { }; i.prototype.init = function (n, t) { this.frame = t; this.windowNo = n; this.load(); this.frame.getContentGrid().append(this.getRoot()); this.display() }; i.prototype.dispose = function () { this.disposeComponent(); this.frame && this.frame.dispose(); this.frame = null }; n.Apps.AForms.ArchiveViewer = i }(VIS, jQuery), function (n, t) { function i() { function l() { r.onClose && r.onClose(); r.dispose(); r = null } var i = t("<div><\/div>"), u = "Dialog", f = "auto", e = "auto", o = !0, s = !1, h = !0, c = { at: "center center", of: window }, r; this.onOkClick = null; this.onCancelClick = null; this.onClose = null; this.setTitle = function (n) { u = n }; this.setModal = function (n) { o = n }; this.changeTitle = function (n) { i.dialog("widget").find(".ui-dialog-title").text(n) }; this.setHeight = function (n) { f = n }; this.setWidth = function (n) { e = n }; this.setPosition = function (n) { c = n }; this.setEnableResize = function (n) { h = n }; r = this; this.setContent = function (n) { i.empty(); i.append(n) }; this.getRoot = function () { return i }; this.hidebuttons = function () { i.dialog("widget").find(".ui-dialog-buttonpane .ui-button").hide(); i.dialog("widget").find(".ui-widget-content").css("border", "0px"); i.dialog("widget").find(".ui-dialog-buttonpane").css("padding", "0px"); i.dialog("widget").find(".ui-dialog-buttonpane").css("margin-top", "0px"); i.dialog("widget").find(".ui-dialog .ui-dialog-buttonpane").hide() }; this.hideButtons = function () { i.dialog("widget").find(".ui-dialog-buttonpane .ui-button").hide(); i.dialog("widget").find(".ui-widget-content").css("border", "0px"); i.dialog("widget").find(".ui-dialog-buttonpane").css("padding", "0px"); i.dialog("widget").find(".ui-dialog-buttonpane").css("margin-top", "0px"); i.dialog("widget").find(".ui-dialog .ui-dialog-buttonpane").hide() }; this.close = function () { i.dialog("close"); this.dispose() }; this.show = function () { var a = "", v = "margin-right:12px"; n.Application.isRTL && (a = "margin-right:7px;", v = ""); i.dialog({ height: f, width: e, title: u, modal: o, resizable: h, closeOnEscape: !s, closeText: n.Msg.getMsg("close"), position: c, buttons: [{ text: n.Msg.getMsg("Ok"), click: function (n) { var f = n.target, u; t(f).attr("disabled", !0); u = !0; r.onOkClick && (u = r.onOkClick(n)); u == !0 || u == undefined ? i != null && i.dialog("close") : t(f).attr("disabled", !1) }, style: v }, { text: n.Msg.getMsg("Cancel"), click: function () { r.onCancelClick && r.onCancelClick(); i && i.dialog("close") }, style: a }], close: l }); t(document).on("keydown", function (n) { if (event.altKey && event.keyCode == 37) return n.preventDefault(), !1; n.stopPropagation() }); return t(".ui-dialog .ui-dialog-buttonpane").css("border-width", "0 0 0"), s && t(".ui-dialog-titlebar-close").remove(), i }; this.dispose = function () { i != null && (i.dialog("destroy"), i.remove()); i = null; this.Show = null; this.setContent = null; this.setTitle = null } } n.ChildDialog = i }(VIS, jQuery), function (n, t) { function i(i, r, u, f, e) { function a() { } function v() { o.onOkClick = function (i) { var r = l.val(); if (t.trim(r) == "" || r == "" || r == null) return n.ADialog.info("EnterData"), i != undefined && i.preventDefault(), !1; s.prop.ChatText = r; n.dataContext.saveChat(s.prop) }; o.onCancelClick = function () { } } function y(i, r, u) { n.dataContext.getChatRecords(u, function (t) { var r = JSON.parse(t), h, u, o, e; s.prop.ChatID = r.chatId; h = ""; for (u in r.subChat) { var l = new Date(r.subChat[u].ChatDate), c = l.toLocaleString(), f = '   <div class="vis-chatboxwrap">'; if (f += n.Application.isRTL ? '<div class="vis-chatimgwrap">' : '<div class="vis-chatimgwrap">', o = !1, r.subChat[u].AD_Image_ID == 0) f += "<i class='fa fa-user' data-uID='" + r.subChat[u].AD_User_ID + "'><\/i>", o = !0; else for (e in r.userimages) if (r.userimages[e].AD_Image_ID == r.subChat[u].AD_Image_ID && r.userimages[e].UserImg != "NoRecordFound" && r.userimages[e].UserImg != "FileDoesn'tExist") { f += '<img  data-uID="' + r.subChat[u].AD_User_ID + '" src="' + n.Application.contextUrl + r.userimages[e].UserImg + '" />'; o = !0; break } o == !1 && (f += "<i class='fa fa-user' data-uID='" + r.subChat[u].AD_User_ID + "'><\/i>"); f += '<\/div><div class="vis-chatdetailwrap"><div style="display: flex;">'; f += n.Application.isRTL ? '<span data-uID="' + r.subChat[u].AD_User_ID + '" class="vis-chatusername">' : '<span data-uID="' + r.subChat[u].AD_User_ID + '" class="vis-chatusername">'; f += n.Env.getCtx().getAD_User_ID() == r.subChat[u].AD_User_ID ? "Me" : r.subChat[u].UserName; f += n.Application.isRTL ? '<\/span><span style="font-size: .75rem; padding-right: 5px;">' + c + '<\/span><\/div><div  style="overflow:auto">' : '<\/span><span style="font-size: .75rem; padding-right: 5px;">' + c + "<\/span><\/div><div>"; f += n.Application.isRTL ? '<span style="font-size: .75rem;padding-right:5px">' + n.Utility.encodeText(r.subChat[u].ChatData) + "<\/span><\/div>" : '<span style="font-size: .75rem;padding-right:5px">' + n.Utility.encodeText(r.subChat[u].ChatData) + "<\/span><\/div>"; f += "<\/div>"; f += "            <\/div>  "; h += f } i.html(h) }); i.on("click", function (i) { var u, f; (t(i.target).is("span") || t(i.target).is("img")) && (u = t(i.target).data("uid"), u != undefined && u != null && u > 0 && (f = new n.ContactInfo(u, r), f.show(), o.close())) }) } var o, s; this.onClose = null; var h = t('<div class="vis-forms-container"><\/div>'), c = t('<div class="vis-chatdetailouterwrap"><\/div>'), l = t('<textarea  id="input-chat-new" class="vis-chat-msgbox"  maxlength="500" />'); h.append(c).append(l); this.winNo = e; o = null; this.prop = { WindowNo: e, ChatID: r, AD_Table_ID: u, Record_ID: i, Description: f, TrxName: null, ChatText: "", page: 0, pageSize: 10 }; y(c, e, this.prop); s = this; a(); this.show = function () { o = new n.ChildDialog; o.setContent(h); o.setHeight(450); o.setWidth(655); o.setTitle(n.Msg.getMsg("Chat")); o.setModal(!0); o.onClose = function () { s.onClose && s.onClose(); s.dispose() }; o.show(); v() }; this.dispose = function () { this.prop = null; c = null; h.remove(); h = null; o = null; s = null } } n.Chat = i }(VIS, jQuery), function (n, t) { function i(i, r, u, f, e, o, s, h) { function ct() { b(!0); s = 0; parentRecord_ID = 0; parentOrg = 0; h && h.getTabLevel() > 0 && (s = h.getParentTab().getAD_Table_ID(), parentRecord_ID = h.getParentTab().getRecord_ID(), parentOrg = h.getParentTab().getValue("AD_Org_ID")); var t = { AD_Table_ID: r, Record_ID: i, parentTableID: s, parentRecord_ID: parentRecord_ID, parentOrg: parentOrg }, u = n.dataContext.getJSONData(n.Application.contextUrl + "RecordShared/GetSharedRecord", t, null); k = u; vt(k); b(!1) } function et() { var i, f, r, o, n, u, e; if (p.removeAttr("checked"), y.val() == "") for (i = t.grep(k, function (n) { return a.find("option:selected").val() == "A" ? n.value.toLowerCase().indexOf(l.val().toLowerCase()) != -1 || n.name.toLowerCase().indexOf(l.val().toLowerCase()) != -1 : a.find("option:selected").val() != "A" && l.val() != "" ? (n.value.toLowerCase().indexOf(l.val().toLowerCase()) != -1 || n.name.toLowerCase().indexOf(l.val().toLowerCase()) != -1) && n.isLegalEntity == a.find("option:selected").val() : n.isLegalEntity == a.find("option:selected").val() }), c.find(".tbList tr").hide(), n = 0; n < i.length; n++)c.find('.tbList .chkOrgID[value="' + i[n].ID + '"]').closest("tr").show(); else { for (i = [], f = 0; f < k.length; f++)for (r = 0; r < w.length; r++)k[f].ID === w[r].ID && (w[r].ParentID == y.attr("data-id") || w[r].ParentName.toLowerCase().indexOf(y.val().toLowerCase()) != -1) && i.push(k[f]); for (o = t.grep(i, function (n) { return a.find("option:selected").val() == "A" ? n.value.toLowerCase().indexOf(l.val().toLowerCase()) != -1 || n.name.toLowerCase().indexOf(l.val().toLowerCase()) != -1 : a.find("option:selected").val() != "A" && l.val() != "" ? (n.value.toLowerCase().indexOf(l.val().toLowerCase()) != -1 || n.name.toLowerCase().indexOf(l.val().toLowerCase()) != -1) && n.isLegalEntity == a.find("option:selected").val() : n.isLegalEntity == a.find("option:selected").val() }), c.find(".tbList tr").hide(), n = 0; n < o.length; n++)c.find('.tbList .chkOrgID[value="' + o[n].ID + '"]').closest("tr").show() } l.val() != "" || y.val() != "" || a.find("option:selected").val() != "A" ? (u = c.find(".tbList tr:visible .chkOrgID").length, e = c.find(".tbList tr:visible .chkOrgID:checked").length, u > 0 && u == e ? p.attr("checked", "checked").prop("checked", "checked") : p.removeAttr("checked")) : (u = c.find(".tbList tr:visible .chkOrgID").length, e = c.find(".tbList tr .chkOrgID:checked").length, u > 0 && u == e ? p.attr("checked", "checked").prop("checked", "checked") : p.removeAttr("checked")) } function vt(n) { var i, t; if (c.find(".tbList").html(""), n) { for (i = "", t = 0; t < n.length; t++)n[t].isSummary != !0 && (i += n[t].AD_OrgShared_ID ? '<tr class="vis-rowSuccess">' : "<tr>", i += '<\/td><td width="40px">', n[t].AD_OrgShared_ID ? (i += '<input type="checkbox" checked class="chkOrgID" parentid="' + n[t].parentID + '" data-shareid="' + n[t].AD_OrgShared_ID + '" value="' + n[t].ID + '">', ot.push(n[t].AD_OrgShared_ID), n[t].CanEdit && rt(!0), lt = n[t].CanEdit) : i += '<input type="checkbox" class="chkOrgID" parentid="' + n[t].parentID + '" value="' + n[t].ID + '">', i += '<\/td><td title="' + n[t].value + '">' + n[t].value + '<\/td><td title="' + n[t].name + '">' + n[t].name + '<\/td><td width="120px" class="text-center">' + n[t].isLegalEntity + '<\/td><td width="120px" class="text-center">', i += n[t].isReadonly ? '<input type="checkbox" name="" id="" class="chkIsReadOnly" checked/>' : '<input type="checkbox" name="" id="" class="chkIsReadOnly" />', i += "<\/td>", i += n[t].ChildShare ? '<td width="120px" class="text-center" style="display:none"><input type="checkbox" name="" id="" checked class="chkIsChildShare" /> <\/td>' : '<td width="120px" class="text-center" style="display:none"><input type="checkbox" name="" id="" checked class="chkIsChildShare" /> <\/td>', + '</tr>'); c.find(".tbList").append(i); c.find(".tbList .chkOrgID").on("click", function () { var n = c.find(".tbList .chkOrgID:checked"), t, i; n && n.length > 0 ? rt(!0) : ot && ot.length == 0 && rt(!0); t = c.find(".tbList tr .chkOrgID").length; i = c.find(".tbList tr .chkOrgID:checked").length; t == i ? p.attr("checked", "checked").prop("checked", "checked") : p.removeAttr("checked") }) } } function b(n) { n && ft != null && ft.css({ display: "block" }); n || ft == null || ft.css({ display: "none" }) } function rt(n) { n ? ut.css("opacity", "1").prop("disabled", "") : ut.css("opacity", "0.5").prop("disabled", "true") } function yt() { at.click(function () { g.showOrgStructure() }); y.keyup(function () { y.removeAttr("data-id"); et() }); l.keyup(function () { et() }); a.change(function () { et() }); p.change(function () { var n = !1; this.checked ? (n = !0, rt(!0)) : rt(!0); c.find(".tbList .chkOrgID").each(function () { t(this).is(":visible") && (this.checked = n) }) }); ut.click(function () { it.text(""); b(!0); var h = { AD_Table_ID: r, record_ID: i, Tab_ID: u, Window_ID: f, WindowNo: e, list: [], Parent_ID: o, ParentTable_ID: s }; c.find(".tbList .chkOrgID:checked").each(function () { h.list.push({ AD_OrgShared_ID: Number(this.value), isReadonly: t(this).closest("tr").find(".chkIsReadOnly").is(":checked"), shareID: t(this).data("shareid"), ChildShare: t(this).closest("tr").find(".chkIsChildShare").is(":checked"), parentID: t(this).attr("parentid") }) }); t.ajax({ type: "post", url: n.Application.contextUrl + "RecordShared/SaveRecord", data: h, success: function (t) { JSON.parse(t) == "OK" ? (it.text(n.Msg.getMsg("Saved")), ct(), c.find(".tbList").scrollTop(0), l.val(""), y.val(""), a.val("A"), v.close()) : it.text(n.Msg.getMsg("RecordsNotSaved")); b(!1) }, error: function () { it.text(n.Msg.getMsg("RecordsNotSaved")); b(!1) } }) }); ht.click(function () { v.close() }) } var w, d, nt, tt; this.onClose = null; var v = null, g = this, k = [], ot = [], st = []; if (h && h.getFields() && (st = h.getFields()), o == "999999" && (o = 0), w = [], d = "", st.length > 0) if (nt = t.grep(st, function (n) { return n.getIsIdentifier() == !0 }), nt.length > 0) for (tt = 0; tt < nt.length; tt++)d += h.getValue(nt[tt].getColumnName()), tt + 1 != nt.length && (d += "_"); else d = h.getValue("Value") && h.getValue("Value").length > 0 ? h.getValue("Value") : h.getValue("Name") && h.getValue("Name").length > 0 ? h.getValue("Name") : i; else d = i; var lt = !0, c = t('<div class="vis-actionWindowWrapper"><div class="vis-apanel-busy vis-recordSharedbusy" style="display:none"><\/div><div class="vis-actionFeilds" ><div class="vis-actionFeild"><div class="input-group vis-input-wrap vis-cusmg"><div class="vis-control-wrap"><input type="text"  id="txtSummaryOrg_' + e + '" maxlength="40" class=""  placeholder="' + n.Msg.getMsg("SummaryOrg") + '" data-placeholder="' + n.Msg.getMsg("SummaryOrg") + '"><label>' + n.Msg.getMsg("SummaryOrg") + '<\/label><\/div><div class="input-group-append"><button id="btnShowSummaryOrg_' + e + '" tabindex="-1" class="input-group-text"><i tabindex="-1" class="fa fa-search"><\/i><\/button><\/div><\/div><\/div><div class="vis-actionFeild"><div class="input-group vis-input-wrap vis-cusmg"><div class="vis-control-wrap"><select id="ddlLegalEntities_' + e + '" class="" placeholder=" " data-placeholder="" data-hasbtn=" "><option value="A">' + n.Msg.getMsg("All") + '<\/option><option value="Y">' + n.Msg.getMsg("Yes") + '<\/option><option value="N">' + n.Msg.getMsg("No") + "<\/option><\/select><label> " + n.Msg.getMsg("LegalEntities") + '<\/label><\/div><\/div><\/div><div class="vis-actionFeild"><div class="input-group vis-input-wrap vis-cusmg"><div class="vis-control-wrap"><input type="text" id="txtSearchKey_' + e + '" maxlength="40" class="" placeholder="' + n.Msg.getMsg("SearchKeyValue") + "/" + n.Msg.getMsg("Name") + '" data-placeholder="' + n.Msg.getMsg("SearchKeyValue") + '"><label>' + n.Msg.getMsg("SearchKeyValue") + "/" + n.Msg.getMsg("Name") + '<\/label><\/div><\/div><\/div><\/div><div class="vis-tableSection"><div class="vis-actionWishlistTable"><div class="vis-tableHeaderWishlist p-1 pl-2"><span class="vis-tableHeadingTtl">' + n.Msg.getMsg("Org") + '<\/span><\/div><div class="vis-gridtable"><table class="vis-gridSingletable"><thead class="vis-gridTableHeader"><tr><th width="40px"><input type="checkbox" name="" id="chkAll_' + e + '" class="inputCheckbox "><\/th><th>' + n.Msg.getMsg("SearchKeyValue") + "<\/th><th>" + n.Msg.getMsg("Org") + '<\/th><th width="120px" class="text-center">' + n.Msg.getMsg("LegalEntities") + '<\/th><th width="120px" class="text-center">' + n.Msg.getMsg("ReadOnly") + '<\/th><th width="120px" class="text-center" style="display:none">' + n.Msg.getMsg("ChildShare") + '<\/th><\/tr><\/thead><tbody class="vis-gridTableBody tbList"><\/tbody><\/table><div class="vis-wishlistActionBtn d-flex align-items-center justify-content-between mt-2"><div><span id="lblMsg_' + e + '"><\/span><\/div><div><button class="vis-actionBtn mr-1" id="btnCancel_' + e + '">' + n.Msg.getMsg("Cancel") + '<\/button><button class="vis-actionBtn mr-2"  style="cursor:default;" id="btnOk_' + e + '">' + n.Msg.getMsg("OK") + "<\/button><\/div><\/div><\/div><\/div><\/div><\/div>"), y = c.find("#txtSummaryOrg_" + e), at = c.find("#btnShowSummaryOrg_" + e), a = c.find("#ddlLegalEntities_" + e), l = c.find("#txtSearchKey_" + e), ut = c.find("#btnOk_" + e), ht = c.find("#btnCancel_" + e), it = c.find("#lblMsg_" + e), p = c.find("#chkAll_" + e), ft = c.find(".vis-recordSharedbusy"); t.ajax({ type: "post", url: n.Application.contextUrl + "RecordShared/GetOrgStructure", data: {}, success: function (n) { w = JSON.parse(n); b(!1) }, error: function () { b(!1) } }); yt(); ct(); this.dispose = function () { c.remove(); c = null; v = null; g = null; y = null; a = null; l = null; ut = null; ht = null; it = null }; this.show = function () { v = new n.ChildDialog; v.setContent(c); v.setWidth("75%"); v.setTitle(n.Msg.getMsg("RecordShared") + " (" + d + ")"); v.setModal(!0); v.onClose = function () { g.onClose && (g.onClose(), g.dispose()) }; v.show(); v.hidebuttons() }; this.showOrgStructure = function () { function f(n, t) { for (var u, r = [], i = 0; i < n.length; i++)n[i].ParentID === t && n[i].Issummary == "Y" && (u = { ID: n[i].ID, Name: n[i].Name, Children: f(n, n[i].ID) }, r.push(u)); return r } function e(n, i) { var h = t("<ul class='small collapse' style='list-style-type: none;' id='sub-item-" + u + "'><\/ul>"), f; for (u++, f = 0; f < n.length; f++) { var r = n[f], o = t("<li class='deeper parent'><\/li>"), c = '<span data-toggle="collapse" data-parent="#menu-group-1" style="margin-left:-14px" href="#sub-item-' + u + '" class="mr-1 sign"><i class="fa fa-plus" onclick="$(this).toggleClass(\'fa-plus fa-minus\')"><\/i><\/span>', l = t("<span  class='vis-orglbl' data-id=" + r.ID + "><\/span>").text(r.Name), s = t('<a class="" href="#"><\/a>'); r.Children.length > 0 && s.append(c); s.append(l); o.append(s); r.Children.length > 0 && e(r.Children, o); h.append(o) } i.append(h) } var i, r, u, o; y.val(""); y.removeAttr("data-id"); i = new n.ChildDialog; r = t('<div id="left" >    <ul id="menu-group-1" class="nav menu">        <li class="item-1 deeper parent">            <a class="" href="#">                <span data-toggle="collapse" data-parent="#menu-group-1" href="#sub-item-1" class="sign"><i class="fa fa-folder-o" onclick="$(this).toggleClass(\'fa-folder-o fa-folder-open-o\')"><\/i><\/span>                <span class="vis-orglbl">' + n.Msg.getMsg("SummaryOrg") + "<\/span>            <\/a>        <\/li>    <\/ul><\/div>"); u = 1; o = f(w, 0); e(o, r.find(".item-1")); i.setContent(r); r.on("click", ".vis-orglbl", function () { if (t(this).attr("data-id")) { var n = Number(t(this).attr("data-id")); y.val(t(this).text()).attr("data-id", n); et(); i.close() } }); i.setHeight(500); i.setWidth(450); i.setTitle(n.Msg.getMsg("SummaryOrg")); i.setModal(!0); i.show(); i.hidebuttons() } } n.RecordShared = i }(VIS, jQuery), function (n, t) { function u() { t.ajax({ url: n.Application.contextUrl + "InfoMenu/LoadMenu", dataType: "json", error: function () { alert("No DATA") }, success: function (n) { var r = n.result, u, f; for (u in r) f = t("<li data-id='" + r[u].AD_InfoWindow_ID + "' >"), f.append(r[u].Name), i.append(f) } }) } var r = t("<div/>"), i; r.css("width", "100%"); r.css("height", "100%"); i = t("<ul class='vis-apanel-rb-ul'>"); i.css("width", "100%"); i.css("height", "100%"); r.append(i); i.on("click", "LI", function (i) { var r = t(i.target).data("id"), u = new n.InfoWindow(r, null, 0, null, null); u.show() }); u(); n.InfoMenu = { show: function (n) { n.w2overlay(r.clone(!0), { css: { height: "300px" } }) } } }(VIS, jQuery), function (n, t) { function i(i, r, u, f, e, o) { function oi() { var f, i, u, o; y.css("width", "100%"); y.css("height", "100%"); y.css("position", "relative"); lt = t("<div class='vis-info-l-s-wrap vis-leftsidebarouterwrap'>"); ft = t("<div>"); lt.append(ft); et = t("<div class='vis-info-datasec'>"); rt = t("<div class='vis-info-btnsec'>"); ut.append(lt); ut.append(et); ut.append(rt); f = n.Msg.getMsg("Refresh"); f.indexOf("&") > -1 && (f = f.replace("&", "")); i = n.Msg.getMsg("Cancel"); i.indexOf("&") > -1 && (i = i.replace("&", "")); u = n.Msg.getMsg("Ok"); u.indexOf("&") > -1 && (u = u.replace("&", "")); ot = t("<div class='vis-info-btnswrap'>"); st = t("<button class='VIS_Pref_btn-2'>").append(i); it = t("<button class='VIS_Pref_btn-2'>").append(u); o = t("<div class='vis-info-btnleft'>"); ht = t("<button class='VIS_Pref_btn-2' style='margin-top: 10px;'>").append(t("<i class='vis vis-refresh'><\/i>")); vt = t('<div class="vis-info-pagingwrp">'); yi(); vt.append(yt); ot.append(st); ot.append(it); o.append(ht); rt.append(o); rt.append(vt); rt.append(ot); p = t('<div class="vis-busyindicatorouterwrap"><div class="vis-busyindicatorinnerwrap"><i class="vis-busyindicatordiv"><\/i><\/div><\/div>'); y.append(ut); y.append(p); e == !0 && w.selectedIDs != null && w.selectedIDs.length > 0 && (c = w.selectedIDs.split(",").map(Number), r = null) } function si() { it.on("click", function () { ni() }); ht.on("click", function () { p[0].style.visibility = "visible"; f != null && f != undefined && f.length > 0 && (f = n.Env.parseContext(n.Env.getCtx(), u, f, !1, !1)); tt(!0, v.val()) }); st.on("click", function () { w.onClose != null && w.onClose(); at() }); if (!n.Application.isMobile) y.on("keyup", function (t) { t.keyCode === 13 && (p[0].style.visibility = "visible", f != null && f != undefined && f.length > 0 && (f = n.Env.parseContext(n.Env.getCtx(), u, f, !1, !1)), tt(!0, v.val())) }) } function hi() { w.onClose != null && w.onClose(); at() } function ct(n) { n ? it.prop("disabled", "true").css({ cursor: "default", opacity: ".5" }) : it.prop("disabled", "").css({ cursor: "pointer", opacity: "1" }) } function ai() { ct(!1) } function vi(n) { var i, t; if (!e) { ct(!0); return } if (n.index) t = w2ui[n.target].records[n.index][keyCol], c.indexOf(t) > -1 && c.splice(c.indexOf(t), 1); else for (i = 0; i < w2ui[n.target].records.length; i++)t = w2ui[n.target].records[i][keyCol], c.indexOf(t) > -1 && c.splice(c.indexOf(t), 1); window.setTimeout(function () { c.length == 0 && w2ui[n.target].getSelection().length == 0 && ct(!0) }, 50) } function yi() { yt = t('<ul class="vis-statusbar-ul">'); pt = t('<li class="flex-fill"><section class="vis-ad-w-p-s-result"><span><\/span><\/section><\/li>'); b = t('<li style="opacity: 1;"><div><i class="vis vis-shiftleft" title="' + n.Msg.getMsg("FirstPage") + '" style="opacity: 0.6;"><\/i><\/div><\/li>'); k = t('<li style="opacity: 1;"><div><i class="vis vis-pageup" title="' + n.Msg.getMsg("PageUp") + '" style="opacity: 0.6;"><\/i><\/div><\/li>'); v = t("<select>"); bt = t("<li>").append(v); d = t('<li style="opacity: 1;"><div><i class="vis vis-pagedown" title="' + n.Msg.getMsg("PageDown") + '" style="opacity: 0.6;"><\/i><\/div><\/li>'); g = t('<li style="opacity: 1;"><div><i class="vis vis-shiftright" title="' + n.Msg.getMsg("LastPage") + '" style="opacity: 0.6;"><\/i><\/div><\/li>'); kt = pt.find(".vis-ad-w-p-s-result").find("span"); yt.append(pt).append(b).append(k).append(bt).append(d).append(g); pi() } function pi() { b.on("click", function () { t(this).css("opacity") == "1" && tt(!0, 1) }); k.on("click", function () { t(this).css("opacity") == "1" && tt(!0, parseInt(v.val()) - 1) }); d.on("click", function () { t(this).css("opacity") == "1" && tt(!0, parseInt(v.val()) + 1) }); g.on("click", function () { t(this).css("opacity") == "1" && tt(!0, parseInt(v.find("Option:last").val())) }); v.on("change", function () { tt(!0, v.val()) }) } function wi(n) { var i, o; if (v.empty(), n.TotalPage > 0) { for (i = 0; i < n.TotalPage; i++)v.append(t("<option value=" + (i + 1) + ">" + (i + 1) + "<\/option>")); v.val(n.CurrentPage); n.TotalPage > n.CurrentPage ? (d.css("opacity", "1"), g.css("opacity", "1")) : (d.css("opacity", "0.6"), g.css("opacity", "0.6")); n.CurrentPage > 1 ? (b.css("opacity", "1"), k.css("opacity", "1")) : (b.css("opacity", "0.6"), k.css("opacity", "0.6")); n.TotalPage == 1 && (b.css("opacity", "0.6"), k.css("opacity", "0.6"), d.css("opacity", "0.6"), g.css("opacity", "0.6")) } else b.css("opacity", "0.6"), k.css("opacity", "0.6"), d.css("opacity", "0.6"), g.css("opacity", "0.6"); var s = n.CurrentPage, e = n.PageSize, r = n.TotalRecords, u = (s - 1) * e, f = u + e; f > r && (f = r); r == 0 && (u -= 1); o = fi + " " + (u + 1) + "-" + f + " " + ei + " " + r; kt.text(o) } var gt, ni, at; this.onClose = null; this.selectedIDs = o; var y = t("<div class='vis-forms-container'>"), ut = t("<div class='vis-info-subroot'>"), ti = !0, ii, ri, ui, lt, ft, et, rt, p, ot, st, it, ht, nt = null, l = null, h = null, wt = !1, s = []; this.keyCol = ""; this.windowNo = u; var w = this, c = [], a = null, vt, yt, b, k, bt, d, g, v, pt, kt = null, fi = n.Msg.getMsg("ShowingResult"), ei = n.Msg.getMsg("of"); oi(); si(); this.show = function () { var r = w; t.ajax({ url: n.Application.contextUrl + "InfoWindow/GetSearchColumn/?Ad_InfoWindow_ID=" + i, dataType: "json", error: function () { alert(n.Msg.getMsg("ERRORGettingSchema")); p[0].style.visibility = "hidden" }, success: function (t) { if (t.result == null || t.result.Schema == null) { alert(n.Msg.getMsg("ERRORGettingSchema")); return } if (l = t.result, h = l.Schema, h == null) { alert(n.Msg.getMsg("ERRORGettingSchema")); return } ci(r) } }) }; var ci = function (i) { var pt = null, e = null, it = t("<table>"), o, a, p, ut, ii, yt, w, c, ti, ot, st, ht; it.css("width", "100%"); var k = null, wt = 0, b = !1, bt = null, kt = null, ct = null; for (o in h) if (h[o].IsQueryCriteria) { b = !1; var gt = t("<td class='vis-gc-vpanel-table-td1'>"), rt = t('<div class="input-group vis-input-wrap">'), g = t('<div class="vis-control-wrap">'), nt = t('<div class="input-group-append">'); if (k = t("<tr>"), it.append(k), k.append(gt), gt.append(rt), rt.append(g), a = {}, bt = h[o].AD_Reference_ID, e = dt(h[o].AD_Reference_ID, h[o].ColumnName, h[o].Name, h[o].AD_Reference_Value_ID, h[o].lookup), a.Ctrl = e, a.InfoColumnID = h[o].InfoColumnID, h[o].SetValue != null) { if (p = !1, h[o].Condition != null) { for (var d = [], lt = [], ni = new n.StringTokenizer(h[o].Condition, "[]"); ni.hasMoreTokens();)ut = ni.nextToken(), ut.trim() != " & ".trim() ? (p = n.Evaluator.evaluateLogic(i, ut), d.push(p)) : lt.push(ut); d.length > 1 ? lt[0].trim().equals("&") ? p = d.indexOf(!1) > -1 ? !1 : !0 : lt[0].trim().equals("|") && d.indexOf(!0) > -1 && (p = !0) : d.length == 1 && d[0] == !0 && (p = !0) } else p = !0; p && (bt == n.DisplayType.YesNo ? h[o].SetValue.toUpperCase() == "Y" ? e.getControl().find("input").prop("checked", !0) : h[o].SetValue.toUpperCase() == "N" && e.getControl().find("input").prop("checked", !1) : h[o].SetValue.contains("@") ? (kt = h[o].SetValue.substring(1, h[o].SetValue.lastIndexOf("@")), ct = n.context.getWindowContext(u, kt, !1), ct.equals("") ? e.setValue(null) : e.setValue(ct)) : e.setValue(h[o].SetValue)) } if (a.AD_Reference_ID = h[o].AD_Reference_ID, a.ColumnName = h[o].SelectClause, a.SearchColumnName = a.ColumnName.toUpperCase().indexOf(" AS ") > -1 ? a.ColumnName.substring(0, a.ColumnName.toUpperCase().indexOf(" AS ")) : a.ColumnName, h[o].ISIDENTIFIER && r != null && e.setValue(r), ii = t("<td>"), w = e.getBtnCount(), w == 2 ? (b, g.append(e.getControl().attr("data-placeholder", "").attr("placeholder", " ")), c = e.getBtn(0), c != null && (nt.append(c.css("class", "vis-controls-txtbtn-table-td2")), e.getControl().attr("data-hasbtn", " ")), c = e.getBtn(1), c != null && (nt.append(c.css("class", "vis-controls-txtbtn-table-td2")), e.getControl().attr("data-hasbtn", " ")), w = -1, e = null, rt.append(nt)) : w == 1 ? (b, g.append(e.getControl().attr("data-placeholder", "").attr("placeholder", " ")), c = e.getBtn(0), c != null && (nt.append(c.css("class", "vis-controls-txtbtn-table-td2")), e.getControl().attr("data-hasbtn", " ")), w = -1, e = null, rt.append(nt)) : (b && e.getControl(), h[o].AD_Reference_ID == n.DisplayType.YesNo && e.getControl(), g.append(e.getControl().attr("data-placeholder", "").attr("placeholder", " "))), h[o].IsRange) { a.IsRange = !0; var at = t('<div class="input-group vis-input-wrap">'), et = t('<div class="vis-control-wrap">'), vt = t('<div class="input-group-append">'); k = t("<tr>"); it.append(k); e = dt(h[o].AD_Reference_ID, h[o].ColumnName, h[o].Name); a.CtrlTo = e; yt = t("<td>"); k.append(yt); yt.append(at); at.append(et); w = e.getBtnCount(); w == 2 ? (b && e.getControl(), et.append(e.getControl().attr("data-placeholder", "").attr("placeholder", " ")), c = e.getBtn(0), c != null && (vt.append(c.css("class", "vis-controls-txtbtn-table-td2")), e.getControl().attr("data-hasbtn", " ")), c = e.getBtn(1), c != null && (vt.append(c.css("class", "vis-controls-txtbtn-table-td2")), e.getControl().attr("data-hasbtn", " ")), w = -1, e = null, at.append(vt)) : (b && e.getControl(), h[o].AD_Reference_ID == n.DisplayType.YesNo ? e.getControl() : e.getControl(), et.append(e.getControl().attr("data-placeholder", "").attr("placeholder", " "))); et.append(new n.Controls.VLabel(n.Msg.getMsg("To"), h[o].ColumnName).getControl()) } else a.IsRange = !1; wt = wt + 1; s.push(a); h[o].AD_Reference_ID == n.DisplayType.YesNo || h[o].AD_Reference_ID == n.DisplayType.Button || h[o].AD_Reference_ID == n.DisplayType.Label ? b = !0 : (pt = new n.Controls.VLabel(h[o].Name, h[o].ColumnName), ti = pt.getControl(), g.append(ti)) } ft.append(it); ot = n.Msg.getMsg("Refresh"); ot.indexOf("&") > -1 && (ot = ot.replace("&", "")); st = n.Msg.getMsg("Cancel"); st.indexOf("&") > -1 && (st = st.replace("&", "")); ht = n.Msg.getMsg("Ok"); ht.indexOf("&") > -1 && (ht = ht.replace("&", "")); y.dialog({ width: 1020, height: 487, resizable: !1, title: l.WindowName, modal: !0, closeText: n.Msg.getMsg("close"), close: hi }); f != null && f != undefined && f.length > 0 && (f = n.Env.parseContext(n.Env.getCtx(), u, f, !1, !1)); tt(!0, v.val()) }, dt = function (t, i, r, f, e) { var o = null, y, c, p, l, e, w, a, b, k, d, g, nt, tt, s, v, it, rt, h; return t == n.DisplayType.Button ? (y = new n.Controls.VButton(i, !1, !1, !0, r, null, null, 0), o = y) : t == n.DisplayType.String ? (c = new n.Controls.VTextBox(i, !1, !1, !0, 50, 100, null, null, !1), o = c, c.click = function () { wt = !0 }) : t == n.DisplayType.YesNo ? (p = new n.Controls.VCheckBox(i, !1, !1, !0, r, null), o = p) : n.DisplayType.IsDate(t) ? (t == n.DisplayType.DateTime && (readOnly = !0), l = new n.Controls.VDate(i, !1, !1, !0, t, r), l.setName(i), o = l) : n.DisplayType.IsLookup(t) || n.DisplayType.ID == t ? (e = n.MLookupFactory.get(n.Env.getCtx(), u, 0, t, i, f, !1, null), t != n.DisplayType.Search && t != n.DisplayType.MultiKey ? (w = new n.Controls.VComboBox(i, !1, !1, !0, e, 50), o = w) : (t = n.DisplayType.Search, a = new n.Controls.VTextBoxButton(i, !1, !1, !0, t, e), a.getBtn(), o = a)) : t == n.DisplayType.Location ? (b = new n.Controls.VLocation(i, !1, !1, !0, t, null), o = b) : t == n.DisplayType.Locator ? (k = new n.Controls.VLocator(i, !1, !1, !0, t, e), o = k) : n.DisplayType.Text == t || n.DisplayType.TextLong == t ? (d = new n.Controls.VTextArea(i, !1, !1, !0, 50, 100, t), o = d) : n.DisplayType.IsNumeric(t) ? n.DisplayType.Amount == t ? (g = new n.Controls.VAmountTextBox(i, !1, !1, !0, 50, 100, t, r), o = g) : n.DisplayType.Integer == t ? (nt = new n.Controls.VNumTextBox(i, !1, !1, !0, 50, 100, r), o = nt) : n.DisplayType.Number == t && (tt = new n.Controls.VAmountTextBox(i, !1, !1, !0, 50, 100, t, r), o = tt) : t == n.DisplayType.PAttribute ? (s = new n.Controls.VPAttribute(i, !1, !1, !0, t, e, u, !1, !1, !1, !0), s.getBtn(0), o = s) : t == n.DisplayType.GAttribute ? (s = new n.Controls.VPAttribute(i, !1, !1, !0, t, e, u, !1, !1, !1, !1), s.getBtn(0), o = s) : t == n.DisplayType.Account ? (v = new n.Controls.VAccount(i, !1, !1, !0, t, e, u, r), v.getBtn(0), o = v) : t == n.DisplayType.Binary ? (it = new n.Controls.VBinary(i, !1, !1, !0, u), o = it) : t == n.DisplayType.Image ? (rt = new n.Controls.VImage(i, !1, !1, u), o = rt) : t == n.DisplayType.URL ? (h = new n.Controls.VURL(i, !1, !1, !0, 50, 100), o = h) : (t == n.DisplayType.FileName || t == n.DisplayType.FilePath) && (h = new n.Controls.VFile(i, !1, !1, !0, u, t), o = h), o }, tt = function (r, u) { var tt, d, v, it, ut, st, g, ft, b, nt; if (e && w2ui[a] && keyCol) { tt = w2ui[a].getSelection(); for (d in tt) c.indexOf(w2ui[a].get(tt[d])[keyCol]) == -1 && c.push(w2ui[a].get(tt[d])[keyCol]) } gt(); var et = "SELECT ", k = null, ot = null, ct = t.makeArray(h).length; for (d in h) if (h[d].IsKey) { k = h[d].SelectClause; ot = String(k).indexOf(".") > -1 ? String(k).substring(String(k).lastIndexOf(".") + 1, String(k).length) : k; k = h[d].SelectClause; keyCol = ot.toUpperCase(); break } if (r == !0) { var rt = " ", y = null, ht = !1; for (v = 0; v < s.length; v++) { if (y = s[v].Ctrl.getValue(), y == null || y.length == 0 || y == 0 && s[v].AD_Reference_ID != n.DisplayType.YesNo || y == -1 || !y) { s[v].Value = null; continue } if (s[v].Value = y, s[v].AD_Reference_ID == n.DisplayType.Date && s[v].IsRange && y == null && (y = s[v].CtrlTo.getValue(), s[v].Value = y), s[v].AD_Reference_ID == n.DisplayType.String || s[v].AD_Reference_ID == n.DisplayType.Text || s[v].AD_Reference_ID == n.DisplayType.TextLong) s[v].Value = y; else if (s[v].AD_Reference_ID == n.DisplayType.Date) { var it = null, ut = null, w = new Date(s[v].Ctrl.getValue()); s[v].IsRange && (s[v].CtrlTo.getValue() == null ? (w = new Date, s[v].ValueTo = new Date) : s[v].ValueTo = new Date(s[v].CtrlTo.getValue())) } else if (s[v].AD_Reference_ID == n.DisplayType.DateTime) { var it = null, ut = null, w = new Date(s[v].Ctrl.getValue()); s[v].Value = w; s[v].IsRange ? (w = new Date(s[v].CtrlTo.getValue()), ut = "TO_DATE( '" + (Number(w.getMonth()) + 1) + "-" + w.getDate() + "-" + w.getFullYear() + " " + w.getHours() + ":" + w.getMinutes() + ":" + w.getSeconds() + "', 'MM-DD-YYYY HH24:MI:SS')", s[v].ValueTo = ut) : rt += s[v].SearchColumnName + " =" + it } else s[v].AD_Reference_ID == n.DisplayType.YesNo ? s[v].Value = s[v].Ctrl.getValue() : (it = null, ut = null, it = s[v].Ctrl.getValue(), s[v].Value = it, s[v].IsRange && s[v].Ctrl.getValue() && (y = s[v].Ctrl.getValue() == !0 ? "Y" : "", s[v].ValueTo = y)); ht = !0 } st = ""; l.OTHERCLAUSE != null && (o != null && o.length > 0 ? (g = "", l.OTHERCLAUSE.indexOf("ORDER BY") > -1 && (g = l.OTHERCLAUSE.substr(0, l.OTHERCLAUSE.indexOf("ORDER BY")), st = l.OTHERCLAUSE.substr(l.OTHERCLAUSE.indexOf("ORDER BY"))), g && String(g).toUpperCase().indexOf("WHERE") > -1 && (l.FromClause.toUpperCase().indexOf("WHERE") > -1 || rt.length > 1 || f != null && f.length > 1) && (g = String(g).replace("WHERE", "AND")), et += " " + g) : (String(l.OTHERCLAUSE).toUpperCase().indexOf("WHERE") > -1 && (l.FromClause.toUpperCase().indexOf("WHERE") > -1 || rt.length > 1 || f != null && f.length > 1) && (l.OTHERCLAUSE = String(l.OTHERCLAUSE).replace("WHERE", "AND")), et += " " + l.OTHERCLAUSE)) } if (u || (u = 1), ft = [], s && Object.keys(s).length > 0) for (b = 0; b < Object.keys(s).length; b++)nt = {}, nt.AD_Reference_ID = s[b].AD_Reference_ID, nt.IsRange = s[b].IsRange, nt.InfoColumnID = s[b].InfoColumnID, nt.Value = s[b].Value, nt.ValueTo = s[b].ValueTo, ft.push(nt); t.ajax({ url: n.Application.contextUrl + "InfoWindow/GetData", dataType: "json", type: "POST", data: { tableName: l.TableName, pageNo: u, SelectedIDs: o, Requery: r, InfoID: i, ValidationCode: n.secureEngine.encrypt(f), SrchCtrls: JSON.stringify(ft) }, error: function () { alert(n.Msg.getMsg("ErrorWhileGettingData")); p[0].style.visibility = "hidden"; return }, success: function (t) { var i = JSON.parse(t); if (i == null) { p[0].style.visibility = "hidden"; return } if (i.Error) { n.ADialog.error(i.Error); p[0].style.visibility = "hidden"; return } wi(i.pSetting); li(i.data) } }) }, li = function (i) { var r, s, l, u; if (i == null) { alert(n.Msg.getMsg("NoDataFound")); p[0].style.visibility = "hidden"; return } var o = [], v = [], f = null; for (u in i) (r = { resizable: !0 }, h[u]) && (f = h[u].AD_Reference_ID, r.caption = h[u].Name, r.field = i[u].ColumnName.toUpperCase(), r.columnName = i[u].ColumnName.toUpperCase(), r.origColName = i[u].ColumnName, r.sortable = !0, r.hidden = !h[u].IsDisplayed, r.size = "100px", n.DisplayType.IsNumeric(f) ? r.render = f == n.DisplayType.Integer ? "int" : function (t, i, r) { var u = n.Utility.Util.getValueOfDecimal(t[o[r].field]); return u.toLocaleString() } : n.DisplayType.IsDate(f) ? r.render = f == n.DisplayType.Date ? function (n, t, i) { var r = n[o[i].field]; return r ? (r = new Date(r), r = r.toLocaleDateString()) : r = "", r } : f == n.DisplayType.DateTime ? function (n, t, i) { var r = n[o[i].field]; return r ? (r = new Date(r), r = r.toDateString()) : r = "", r } : function (n, t, i) { var r = n[o[i].field]; return r ? (r = new Date(r), r = r.toLocaleTimeString()) : r = "", r } : f == n.DisplayType.Location || f == n.DisplayType.Locator ? r.render = "int" : f == n.DisplayType.Account ? r.render = "int" : f == n.DisplayType.PAttribute ? r.render = "int" : f == n.DisplayType.Button ? r.render = function () { return "<div>button<\/div>" } : f == n.DisplayType.Image ? r.render = function () { return "<div>Image<\/div>" } : n.DisplayType.IsLOB(f) && (r.render = function () { return "<div>[Lob-blob]<\/div>" }), o[u] = r); for (s = 0; s < i[0].RowCount; s++) { l = {}; for (u in i) l[i[u].ColumnName.toUpperCase()] = i[u].Values[s]; l.recid = s + 1; v[s] = l } if (a = "gridInfodata" + Math.random(), a = a.replace(".", ""), w2utils.encodeTags(v), nt = t(et).w2grid({ name: a, recordHeight: 40, show: { toolbar: !1, columnHeaders: !0, lineNumbers: !1, selectColumn: !0, toolbarReload: !1, toolbarColumns: !0, toolbarSearch: !1, toolbarAdd: !1, toolbarDelete: !1, toolbarSave: !1, selectionBorder: !1, recordTitles: !1 }, columns: o, records: v, multiSelect: e, onUnselect: vi, onSelect: ai }), e && c && c.length > 0) for (itm in c) for (u in w2ui[a].records) w2ui[a].records[u][keyCol] == c[itm] && (w2ui[a].select(parseInt(u) + 1), ct(!1)); else ct(!0); p[0].style.visibility = "hidden" }; gt = function () { nt != null && nt.destroy(); nt = null }; ni = function () { var t = w2ui[a].getSelection(), i; for (item in t) { c.indexOf(w2ui[a].get(t[item])[keyCol]) == -1 && c.push(w2ui[a].get(t[item])[keyCol]); i = w2ui[a].columns; for (col in i) n.Env.getCtx().setContext(u, n.EnvConstants.TAB_INFO, i[col].columnName, w2ui[a].get(t[item])[i[col].columnName]) } w.onClose != null && c.length > 0 && w.onClose(); at() }; this.getSelectedValues = function () { return c }; at = function () { it.off("click"); ht.off("click"); st.off("click"); y.off("keyup"); b.off("click"); k.off("click"); d.off("click"); g.off("click"); v.off("change"); et = null; ft = null; nt != null && nt.destroy(); nt = null; ut = null; ti = null; ii = ri = ui = lt = ft = et = rt = null; p = ot = st = it = ht = null; b = k = d = g = v = null; nt = null; l = null; h = null; wt = null; s = null; keyCol = null; w = null; c = null; y != null && (y.dialog("destroy"), y.remove()); y = null; this.disposeComponent = null; this.displaySchema = null; this.getControl = null; this.displayData = null; this.loadData = null; this.disposeDataSec = null; this.btnOKClick = null; this.getSelectedValues = null; this.disposeComponent = null } } i.prototype.getValueAsString = function (t) { return n.context.getWindowContext(this.windowNo, t, !0) }; n.InfoWindow = i }(VIS, jQuery), function (n, t) { function i(i, r, u, f) { function vs() { function dr(t) { t && (br = s.find("option:selected").val()); it = 1; y = []; s.val() != 0 ? y[0] = s.val() : y = ct; li(y, null, function (t) { ki(t); po(s.val(), function () { t.length != 0 ? (e.val(t[0].DimensionTypeVal), cu(e.val()), c.setValue(0), st = !1, tt.empty().append(n.Msg.getMsg("Add")), s.val() != -1 && e.val() != 0 ? (p.css("display", "block"), tt.css("display", "block"), ni.html() == "" ? k.getRoot().parent().css("height", "448px") : k.getRoot().parent().css("height", "469px")) : (p.css("display", "none"), tt.css("display", "none"), ni.html() == "" ? k.getRoot().parent().css("height", "390px") : k.getRoot().parent().css("height", "410px"))) : (cu(e.val()), s.val() != -1 && e.val() != 0 ? (p.css("display", "block"), tt.css("display", "block"), ni.html() == "" ? k.getRoot().parent().css("height", "448px") : k.getRoot().parent().css("height", "469px")) : (p.css("display", "none"), tt.css("display", "none"), ni.html() == "" ? k.getRoot().parent().css("height", "390px") : k.getRoot().parent().css("height", "410px"))) }) }) } var u, b, nt, tu, hi, ci, hr, iu, lr, vr, pr, wr; sf = t("<label>"); hf = t("<label>"); cf = t("<label>"); lf = t("<label>"); ro = t("<label>"); af = t("<label>"); ni = t("<label>"); s = t("<select tabindex='2'>"); e = t("<select tabindex='3'>"); ai = t("<select>"); c = new n.Controls.VAmountTextBox("Amount", !1, !1, !0, 50, 100, n.DisplayType.Amount, n.Msg.getMsg("Amount")); a = new n.Controls.VAmountTextBox("ModalAmount", !1, !1, !0, 50, 100, n.DisplayType.Amount, n.Msg.getMsg("Amount")); v = new n.Controls.VAmountTextBox("TotalAmount", !1, !0, !0, 50, 100, n.DisplayType.Amount, n.Msg.getMsg("Amount")); ft = new n.Controls.VAmountTextBox("Total", !1, !0, !0, 50, 100, n.DisplayType.Amount, n.Msg.getMsg("Amount")); tt = t("<a style='cursor:pointer;' tabindex='7'>"); ir = t("<a>"); tf = t("<a style='cursor:pointer;' tabindex='12'>"); rf = t("<a style='cursor:pointer;' tabindex='13'>"); ee = t("<div class='VIS-AMTD-Grid'>"); ne = t("<div class='VIS-AMTD-SubGrid'>"); g = t("<div class='VIS-AMTD-formDynmicInput'>"); d = t("<div class='VIS-AMTD-formDynmicInput'>"); go = t("<button>"); ns = t("<button>"); cr = t("<div class='VIS-AMTD-Modal' id='updateModal'>"); fe = t("<div class='VIS-AMTD-Modal-Content'>"); io = t("<span class='VIS-AMTD-Close'>"); statusSpanShowRecordNo = t("<label>"); statusSpanShowRecordNo.addClass("vis-statusbar-pageMsg"); io.append("X"); sr = t('<ul class="vis-statusbar-ul"><\/ul>'); we = t('<div class="VIS-AMTD-StatusContainer"><\/div>'); fo = t('<li  style="opacity: 0.6;"><div><i class="vis vis-shiftleft" style="opacity: 1;" action="first" title="First Page" ><\/i><\/div><\/li>'); sr.append(fo); eo = t('<li style="opacity: 0.6;"><div><i class="vis vis-pageup" style="opacity: 1;" action="prev" title="Page Down" ><\/i><\/div><\/li>'); sr.append(eo); gt = t('<select class="vis-statusbar-combo" style="width:50px;"><\/select>'); u = t("<li><\/li>"); u.append(gt); sr.append(u); oo = t('<li style="opacity: 1;"><div><i class="vis vis-pagedown" style="opacity: 1;" action="next" title="Page Up" alt="Page Down" src="' + n.Application.contextUrl + 'Areas/VIS/Images/base/PageDown16.png"><\/div><\/li>'); sr.append(oo); so = t('<li style="opacity: 1;"><div><i class="vis vis-shiftright" style="opacity: 1;" action="last" title="Last Page" ><\/i><\/div><\/li>'); sr.append(so); we.append(sr); wo = []; h = 0; st = !1; bo = 0; ko = 0; te = ""; ht = ""; ur = ""; fr = ""; er = ""; rt = ""; yi = ""; pi = ""; wi = ""; ct = ""; si = ""; ts = 0; ct = []; y = []; be = 0; uf = !0; w = 0; yr = 30; it = 1; ls = 0; ar = 0; br = -1; ho = 0; bi = n.DisplayType.GetNumberFormat(n.DisplayType.Amount); ie = t("<div class='VIS-AMTD-formWrap'>"); lu = t("<input type='button' class='VIS_Pref_btn-2 pull-left' tabindex='16' >"); tt.append(n.Msg.getMsg("Add")); ir.append(n.Msg.getMsg("Cancel")); tf.append(n.Msg.getMsg("Update")); rf.append(n.Msg.getMsg("Cancel")); lu.val(n.Msg.getMsg("OK")); sf.append(n.Msg.translate(n.Env.getCtx(), "C_AcctSchema_ID")); hf.append(n.Msg.translate(n.Env.getCtx(), "ElementType")); cf.append(n.Msg.getMsg("TotalAmount")); lf.append(n.Msg.getMsg("Amount")); ro.append(n.Msg.getMsg("Amount")); ir.css("display", "none"); af.append(n.Msg.getMsg("Total")); b = t("<div class='VIS-AMTD-formData input-group vis-input-wrap'>"); nt = t("<div class='vis-control-wrap'>"); b.append(nt); nt.append(s).append(sf); var r = t("<div class='VIS-AMTD-formData input-group vis-input-wrap'>"), gr = t("<div class='vis-control-wrap'>"), nu = t('<div class="vis-excelimportbtn VIS-AMTD-formBtns" style=" display: block; "><a tabindex="" class="vis vis-doc-excel"><\/a><\/div>'); r.append(gr); r.append(nu); gr.append(e).append(hf); tu = t('<div style="float: right;margin-right: 5px;display:none" ><input id="VIS-AMTD-file-input" style="display:none" type="file"  accept=".xls,.xlsx"><label title="' + n.Msg.getMsg("VIS_ExcelImport") + '"  for="VIS-AMTD-file-input" ><\/label><\/div>'); r.append(tu); lo = r.find("#VIS-AMTD-file-input"); hi = t("<div class='VIS-AMTD-formData input-group vis-input-wrap'>"); ci = t("<div class='vis-control-wrap'>"); hi.append(ci); ci.append(v.getControl().attr("placeholder", " ").attr("data-placeholder", "")).append(cf); p = t("<div class='VIS-AMTD-formData VIS-AMTD-amountTxt input-group vis-input-wrap'>"); hr = t("<div class='vis-control-wrap'>"); p.append(hr); hr.append(c.getControl().attr("placeholder", " ").attr("data-placeholder", "")).append(lf); fi = t("<div class='VIS-AMTD-formData VIS-AMTD-amountTxt input-group vis-input-wrap'>"); iu = t("<div class='vis-control-wrap'>"); fi.append(iu); fi.append(a.getControl().attr("placeholder", " ").attr("data-placeholder", "")).append(ro); re = t("<div class='VIS-AMTD-formBtns'>"); lr = t("<div>"); lr.append(tt); re.append(lr); ue = t("<div class='VIS-AMTD-ModalformBtns'>"); vr = t("<div>"); vr.append(tf).append(rf); ue.append(vr); pr = t("<div class='VIS-AMTD-formData input-group vis-input-wrap'>"); wr = t("<div class='vis-control-wrap'>"); fe.append(d).append(fi).append(ue); cr.append(fe); ee.append(ne).append(cr).append(we); pr.append(wr); wr.append(ft.getControl().attr("placeholder", " ").attr("data-placeholder", "")).append(af); su = t("<div style='color:green;font-size:small'>"); su.append(ni); ie.append(su).append(hi).append(b).append(r).append(g).append(p).append(re); of.append(ie).append(ee).append(pr).append(lu); kr.append(of).append(no); f && of.addClass("VIS-AMTD-ReadOnly"); s.on("change", function () { o("visible"); var t = !0; s.val() == 0 && (t = !1, li(ct, null, function (t) { t.length != 0 && n.ADialog.confirm("ConfirmSelectAllAcctSchema", !0, "", "Confirm", function (t) { t ? (o("visible"), ct.length && n.dataContext.getJSONRecord("AmountDivision/SetDAcctType", { allAcctSchemaID: ct, did: i }), ef(), li(ct, null, function (t) { o("visible"); ki(t); br = s.find("option:selected").val(); h = 0; c.setValue(0); st = !1; ir.css("display", "none"); e.val() == "AC" || e.val() == "U1" || e.val() == "U2" ? p.css("width", "26%") : p.css("width", "33.3%"); tt.empty().append(n.Msg.getMsg("Add")); ft.setValue(0); dr(!1) })) : (s.val(br), e.val(ar), dr(!1)) }) })); li(ct, null, function () { dr(t); o("hidden") }); hu = s.find("option:selected").attr("precision") }); e.on("change", function () { o("visible"); li(y, null, function (t) { if (t.length != 0) n.ADialog.confirm("ConfirmChangeDimensionType", !0, "", "Confirm", function (t) { if (t) o("visible"), cu(e.val()), ar = e.find("option:selected").val(), c.setValue(0), st = !1, ir.css("display", "none"), e.val() == "AC" || e.val() == "U1" || e.val() == "U2" ? p.css("width", "26%") : p.css("width", "33.3%"), tt.empty().append(n.Msg.getMsg("Add")), ct.length && n.dataContext.getJSONRecord("AmountDivision/SetDAcctType", { allAcctSchemaID: ct, did: i }), li(y, null, function (n) { ki(n); ef(); ft.setValue(0) }), o("hidden"); else return e.val(ar), ao(), o("hidden"), !1; ao() }); else { if (cu(e.val()), !co) return o("hidden"), n.ADialog.warn("VIS_ElementDifferent"), !1; ar = e.find("option:selected").val(); e.val() == "AC" ? ui.showColumn("C_BPartner") : ui.hideColumn("C_BPartner") } ao(); e.focus(); o("hidden") }) }); tt.on("keydown", function (n) { if (n.keyCode == 13 && (o("visible"), de())) { st || h++; var t = e.find("option:selected").val(); t == "AC" ? (l(e.find("option:selected").text(), ot.val(), c.getValue(), h, s.find("Option:selected").val(), e.find("option:selected").val(), vi.getValue(), ti, 0, ht.getValue(), et.val()), ai.val("-1"), vi.setValue("-1")) : t == "AY" ? (l(e.find("option:selected").text(), ii.find("option:selected").text(), c.getValue(), h, s.find("Option:selected").val(), e.find("option:selected").val(), ii.find("option:selected").val(), -1, 0, 0, ""), ii.val(-1)) : t == "BP" ? (l(e.find("option:selected").text(), et.val(), c.getValue(), h, s.find("Option:selected").val(), e.find("option:selected").val(), ht.getValue(), -1, 0, 0, ""), et.val(""), ht.setValue("-1")) : t == "LF" || t == "LT" ? (l(e.find("option:selected").text(), rr.val(), c.getValue(), h, s.find("Option:selected").val(), e.find("option:selected").val(), ur.getValue(), -1, 0, 0, ""), rr.val(""), ur.setValue("-1")) : t == "MC" ? (l(e.find("option:selected").text(), kt.find("option:selected").text(), c.getValue(), h, s.find("Option:selected").val(), e.find("option:selected").val(), kt.find("option:selected").val(), -1, 0, 0, ""), kt.val(-1)) : t == "OO" || t == "OT" ? (l(e.find("option:selected").text(), at.find("option:selected").text(), c.getValue(), h, s.find("Option:selected").val(), e.find("option:selected").val(), at.find("option:selected").val(), -1, 0, 0, ""), at.val("-1")) : t == "PJ" ? (l(e.find("option:selected").text(), di.val(), c.getValue(), h, s.find("Option:selected").val(), e.find("option:selected").val(), fr.getValue(), -1, 0, 0, ""), di.val(""), fr.setValue("-1")) : t == "PR" ? (l(e.find("option:selected").text(), gi.val(), c.getValue(), h, s.find("Option:selected").val(), e.find("option:selected").val(), er.getValue(), -1, 0, 0, ""), gi.val(""), er.setValue("-1")) : t == "SA" ? l(e.find("option:selected").text(), "", c.getValue(), h, s.find("Option:selected").val(), e.find("option:selected").val(), "", -1, 0, 0, "") : t == "SR" ? (l(e.find("option:selected").text(), ri.find("option:selected").text(), c.getValue(), h, s.find("Option:selected").val(), e.find("option:selected").val(), ri.find("option:selected").val(), -1, 0, 0, ""), ri.val("-1")) : t == "U1" || t == "U2" ? (l(e.find("option:selected").text(), ot.val(), c.getValue(), h, s.find("Option:selected").val(), e.find("option:selected").val(), vi.getValue(), ti, 0, ht.getValue(), et.val()), ai.val("-1"), ot.val(""), vi.setValue("-1")) : (t == "X1" || t == "X2" || t == "X3" || t == "X4" || t == "X5" || t == "X6" || t == "X7" || t == "X8" || t == "X9") && (l(e.find("option:selected").text(), vt.find("option:selected").text(), c.getValue(), h, s.find("Option:selected").val(), e.find("option:selected").val(), vt.find("option:selected").val(), -1, 0, 0, ""), vt.val(-1)) } }); tt.on("click", function () { if (o("visible"), de()) { st || h++; var n = e.find("option:selected").val(); n == "AC" ? (l(e.find("option:selected").text(), ot.val(), c.getValue(), h, s.find("Option:selected").val(), e.find("option:selected").val(), vi.getValue(), ti, 0, ht.getValue(), et.val()), ai.val("-1"), vi.setValue("-1"), et.val(""), ht.setValue("-1")) : n == "AY" ? (l(e.find("option:selected").text(), ii.find("option:selected").text(), c.getValue(), h, s.find("Option:selected").val(), e.find("option:selected").val(), ii.find("option:selected").val(), -1, 0, 0, ""), ii.val(-1)) : n == "BP" ? (l(e.find("option:selected").text(), et.val(), c.getValue(), h, s.find("Option:selected").val(), e.find("option:selected").val(), ht.getValue(), -1, 0, 0, ""), et.val(""), ht.setValue("-1")) : n == "LF" || n == "LT" ? (l(e.find("option:selected").text(), rr.val(), c.getValue(), h, s.find("Option:selected").val(), e.find("option:selected").val(), ur.getValue(), -1, 0, 0, ""), rr.val(""), ur.setValue("-1")) : n == "MC" ? (l(e.find("option:selected").text(), kt.find("option:selected").text(), c.getValue(), h, s.find("Option:selected").val(), e.find("option:selected").val(), kt.find("option:selected").val(), -1, 0, 0, ""), kt.val(-1)) : n == "OO" || n == "OT" ? (l(e.find("option:selected").text(), at.find("option:selected").text(), c.getValue(), h, s.find("Option:selected").val(), e.find("option:selected").val(), at.find("option:selected").val(), -1, 0, 0, ""), at.val("-1")) : n == "PJ" ? (l(e.find("option:selected").text(), di.val(), c.getValue(), h, s.find("Option:selected").val(), e.find("option:selected").val(), fr.getValue(), -1, 0, 0, ""), di.val(""), fr.setValue("-1")) : n == "PR" ? (l(e.find("option:selected").text(), gi.val(), c.getValue(), h, s.find("Option:selected").val(), e.find("option:selected").val(), er.getValue(), -1, 0, 0, ""), gi.val(""), er.setValue("-1")) : n == "SA" ? l(e.find("option:selected").text(), "", c.getValue(), h, s.find("Option:selected").val(), e.find("option:selected").val(), "", -1, 0, 0, "") : n == "SR" ? (l(e.find("option:selected").text(), ri.find("option:selected").text(), c.getValue(), h, s.find("Option:selected").val(), e.find("option:selected").val(), ri.find("option:selected").val(), -1, 0, 0, ""), ri.val("-1")) : n == "U1" || n == "U2" ? (l(e.find("option:selected").text(), ot.val(), c.getValue(), h, s.find("Option:selected").val(), e.find("option:selected").val(), vi.getValue(), ti, 0, ht.getValue(), et.val()), ai.val("-1"), ot.val(""), vi.setValue("-1")) : (n == "X1" || n == "X2" || n == "X3" || n == "X4" || n == "X5" || n == "X6" || n == "X7" || n == "X8" || n == "X9") && (l(e.find("option:selected").text(), vt.find("option:selected").text(), c.getValue(), h, s.find("Option:selected").val(), e.find("option:selected").val(), vt.find("option:selected").val(), -1, 0, 0, ""), vt.val(-1)) } }); nu.on("click", function () { if (t("#VIS-AMTD-file-input").val(""), e.val() == "0") return n.ADialog.error("VIS_DimensionType", !0, "", ""), !1; lo.trigger("click") }); lo.on("change", function () { var r = this, i = t("#VIS-AMTD-file-input").val(); if (i = i.substring(i.lastIndexOf(".")), [".xlsx", ".xls"].indexOf(i) < 0) return n.ADialog.error("VIS_InValidFile", !0, "", ""), !1; window.setTimeout(function () { o("visible"); _result = t.parseJSON(n.UploadAmountDimension(r, null)); ys(_result) }, 400) }); ir.on("click", function () { o("visible"); cu(e.val()); c.setValue(0); st = !1; ir.css("display", "none"); e.val() == "AC" || e.val() == "U1" || e.val() == "U2" ? p.css("width", "26%") : p.css("width", "33.3%"); tt.empty().append(n.Msg.getMsg("Add")); o("hidden") }); tf.on("keydown", function (n) { if (n.keyCode == 13 && (o("visible"), de())) { var t = e.find("option:selected").val(); t == "AC" ? (l(e.find("option:selected").text(), bt.val(), a.getValue(), h, s.find("Option:selected").val(), e.find("option:selected").val(), oi.getValue(), ti, w, rt.getValue(), lt.val()), ei.val("-1"), oi.setValue("-1"), lt.val(""), rt.setValue("-1")) : t == "AY" ? (l(e.find("option:selected").text(), pt.find("option:selected").text(), a.getValue(), h, s.find("Option:selected").val(), e.find("option:selected").val(), pt.find("option:selected").val(), -1, w, 0, ""), pt.val(-1)) : t == "BP" ? (l(e.find("option:selected").text(), lt.val(), a.getValue(), h, s.find("Option:selected").val(), e.find("option:selected").val(), rt.getValue(), -1, w, 0, ""), lt.val(""), rt.setValue("-1")) : t == "LF" || t == "LT" ? (l(e.find("option:selected").text(), or.val(), a.getValue(), h, s.find("Option:selected").val(), e.find("option:selected").val(), yi.getValue(), -1, w, 0, ""), or.val(""), yi.setValue("-1")) : t == "MC" ? (l(e.find("option:selected").text(), dt.find("option:selected").text(), a.getValue(), h, s.find("Option:selected").val(), e.find("option:selected").val(), dt.find("option:selected").val(), -1, w, 0, ""), dt.val(-1)) : t == "OO" || t == "OT" ? (l(e.find("option:selected").text(), yt.find("option:selected").text(), a.getValue(), h, s.find("Option:selected").val(), e.find("option:selected").val(), yt.find("option:selected").val(), -1, w, 0, ""), yt.val("-1")) : t == "PJ" ? (l(e.find("option:selected").text(), nr.val(), a.getValue(), h, s.find("Option:selected").val(), e.find("option:selected").val(), pi.getValue(), -1, w, 0, ""), nr.val(""), pi.setValue("-1")) : t == "PR" ? (l(e.find("option:selected").text(), tr.val(), a.getValue(), h, s.find("Option:selected").val(), e.find("option:selected").val(), wi.getValue(), -1, w, 0, ""), tr.val(""), wi.setValue("-1")) : t == "SA" ? l(e.find("option:selected").text(), "", c.getValue(), h, s.find("Option:selected").val(), e.find("option:selected").val(), "", -1, w, 0, "") : t == "SR" ? (l(e.find("option:selected").text(), wt.find("option:selected").text(), a.getValue(), h, s.find("Option:selected").val(), e.find("option:selected").val(), wt.find("option:selected").val(), -1, w, 0, ""), wt.val("-1")) : t == "U1" || t == "U2" ? (l(e.find("option:selected").text(), bt.val(), a.getValue(), h, s.find("Option:selected").val(), e.find("option:selected").val(), oi.getValue(), ti, w, 0, ""), ei.val("-1"), bt.val(""), oi.setValue("-1")) : (t == "X1" || t == "X2" || t == "X3" || t == "X4" || t == "X5" || t == "X6" || t == "X7" || t == "X8" || t == "X9") && (l(e.find("option:selected").text(), ut.find("option:selected").text(), a.getValue(), h, s.find("Option:selected").val(), e.find("option:selected").val(), ut.find("option:selected").val(), -1, w, 0, ""), ut.val(-1)) } }); tf.on("click", function () { if (o("visible"), de()) { var n = e.find("option:selected").val(); n == "AC" ? (l(e.find("option:selected").text(), bt.val(), a.getValue(), h, s.find("Option:selected").val(), e.find("option:selected").val(), oi.getValue(), ti, w, rt.getValue(), lt.val()), ei.val("-1"), oi.setValue("-1"), lt.val(""), rt.setValue("-1")) : n == "AY" ? (l(e.find("option:selected").text(), pt.find("option:selected").text(), a.getValue(), h, s.find("Option:selected").val(), e.find("option:selected").val(), pt.find("option:selected").val(), -1, w, 0, ""), pt.val(-1)) : n == "BP" ? (l(e.find("option:selected").text(), lt.val(), a.getValue(), h, s.find("Option:selected").val(), e.find("option:selected").val(), rt.getValue(), -1, w, 0, ""), lt.val(""), rt.setValue("-1")) : n == "LF" || n == "LT" ? (l(e.find("option:selected").text(), or.val(), a.getValue(), h, s.find("Option:selected").val(), e.find("option:selected").val(), yi.getValue(), -1, w, 0, ""), or.val(""), yi.setValue("-1")) : n == "MC" ? (l(e.find("option:selected").text(), dt.find("option:selected").text(), a.getValue(), h, s.find("Option:selected").val(), e.find("option:selected").val(), dt.find("option:selected").val(), -1, w, 0, ""), dt.val(-1)) : n == "OO" || n == "OT" ? (l(e.find("option:selected").text(), yt.find("option:selected").text(), a.getValue(), h, s.find("Option:selected").val(), e.find("option:selected").val(), yt.find("option:selected").val(), -1, w, 0, ""), yt.val("-1")) : n == "PJ" ? (l(e.find("option:selected").text(), nr.val(), a.getValue(), h, s.find("Option:selected").val(), e.find("option:selected").val(), pi.getValue(), -1, w, 0, ""), nr.val(""), pi.setValue("-1")) : n == "PR" ? (l(e.find("option:selected").text(), tr.val(), a.getValue(), h, s.find("Option:selected").val(), e.find("option:selected").val(), wi.getValue(), -1, w, 0, ""), tr.val(""), wi.setValue("-1")) : n == "SA" ? l(e.find("option:selected").text(), "", c.getValue(), h, s.find("Option:selected").val(), e.find("option:selected").val(), "", -1, w, 0, "") : n == "SR" ? (l(e.find("option:selected").text(), wt.find("option:selected").text(), a.getValue(), h, s.find("Option:selected").val(), e.find("option:selected").val(), wt.find("option:selected").val(), -1, w, 0, ""), wt.val("-1")) : n == "U1" || n == "U2" ? (l(e.find("option:selected").text(), bt.val(), a.getValue(), h, s.find("Option:selected").val(), e.find("option:selected").val(), oi.getValue(), ti, w, 0, ""), ei.val("-1"), bt.val(""), oi.setValue("-1")) : (n == "X1" || n == "X2" || n == "X3" || n == "X4" || n == "X5" || n == "X6" || n == "X7" || n == "X8" || n == "X9") && (l(e.find("option:selected").text(), ut.find("option:selected").text(), a.getValue(), h, s.find("Option:selected").val(), e.find("option:selected").val(), ut.find("option:selected").val(), -1, w, 0, ""), ut.val(-1)) } }); rf.on("click", function () { st = !1; cr.css("display", "none") }); rf.on("keydown", function (n) { n.keyCode == 13 && (st = !1, cr.css("display", "none")) }); sr.on(n.Events.onTouchStartOrClick, "LI", function (n) { var i; if (o("visible"), t(n.target).attr("action") == "first") it != 1 && (it = 1, li(y, null, function (n) { ki(n); gt.val(it) })); else if (t(n.target).attr("action") == "prev") it != 1 && (it--, li(y, null, function (n) { ki(n); gt.val(it) })); else if (t(n.target).attr("action") == "next") { if (i = vo(), it >= i) { o("hidden"); return } it++; li(y, null, function (n) { ki(n); gt.val(it) }) } else if (t(n.target).attr("action") == "last") { if (i = vo(), it >= i) { o("hidden"); return } it = i; li(y, null, function (n) { ki(n); gt.val(it) }) } o("hidden") }); gt.on("change", function () { o("visible"); it != gt.val() && (it = gt.val(), li(y, null, function (n) { ki(n); gt.val(it) })); o("hidden") }); lu.on("click", function () { if (o("visible"), Math.abs(parseFloat(ft.getValue())) > Math.abs(parseFloat(v.getValue()))) n.ADialog.warn("LineTotalNotGrater"), v.getControl().focus(), o("hidden"); else if (v.getValue() != "" && v.getValue() != 0) y = [], s.val() == 0 ? y = ct : y[0] = s.val(), yo(i, v.getValue(), -1, y, "", "", "", -1, -1, -1, 0, "", 0, function () { ru.onClosing(i); k.close() }); else { ru.onClosing(i); k.close() } }) } function ys(i) { if (i != null) { if (i._filename == null || i._filename == "" || i._path == null || i._path == "") return; if (i._error != null && i._error != "") { n.ADialog.info(i._error, null, "", ""); return } var u = i._path, c = i._filename, f = e.find("option:selected").val(), o = s.find("Option:selected").val(), h = parseFloat(v.getValue()), r = []; r.push(u); r.push(f); r.push(o); r.push(h); t.ajax({ url: n.Application.contextUrl + "AmountDivision/GetDataFromExcelOrText", type: "POST", datatype: "json", contentType: "application/json; charset=utf-8", async: !1, data: JSON.stringify(r), success: function (t) { var i = !0; i = ps(t); ff == 0 && i && n.ADialog.warn("VIS_InCorrectData", null, "", "") }, error: function () { as[0].style.visibility = "hidden"; n.ADialog.info(n.Msg.getMsg("error"), null, "", "") } }) } } function ps(t) { var u = parseFloat(v.getValue()), f, r, i; if (t = JSON.parse(t), f = parseFloat(t.result[0].TotalAmount), u > 0 && f > u || u < 0 && Math.abs(f) > Math.abs(u)) return n.ADialog.warn("LineTotalNotGrater"), o("hidden"), !1; for (ff = 0, r = 0; r < t.result.length; r++)i = e.find("option:selected").val(), i == "AY" || i == "BP" || i == "MC" || i == "OO" || i == "OT" || i == "PJ" || i == "PR" || i == "SR" ? parseInt(t.result[r].Record_ID) > 0 && (l(e.find("option:selected").text(), t.result[r]["Search Key/Name"], t.result[r].Amount, h, s.find("Option:selected").val(), e.find("option:selected").val(), t.result[r].Record_ID, -1, w, 0, ""), ff++) : i == "U1" || i == "U2" || i == "AC" ? t.result[r].AccoutId != 0 && t.result[r].BPartnerId != 0 && (l(e.find("option:selected").text(), t.result[r].AccountValue, t.result[r].Amount, h, s.find("Option:selected").val(), e.find("option:selected").val(), t.result[r].AccoutId, t.result[r].C_Element_ID, w, t.result[r].BPartnerId, t.result[r]["Search Key/Name"]), ei.val("-1"), bt.val(""), oi.setValue("-1"), ff++) : (i == "X1" || i == "X2" || i == "X3" || i == "X4" || i == "X5" || i == "X6" || i == "X7" || i == "X8" || i == "X9") && parseInt(t.result[r].Record_ID) != 0 && (l(e.find("option:selected").text(), t.result[r]["Search Key/Name"], t.result[r].Amount, h, s.find("Option:selected").val(), e.find("option:selected").val(), t.result[r].Record_ID, -1, w, 0, ""), ut.val(-1), ff++); o("hidden") } function ao() { e.val() == "" || e.val() == 0 ? (p.css("display", "none"), tt.css("display", "none"), ni.html() == "" ? k.getRoot().parent().css("height", "390px") : k.getRoot().parent().css("height", "410px")) : (p.css("display", "block"), tt.css("display", "block"), ni.html() == "" ? k.getRoot().parent().css("height", "448px") : k.getRoot().parent().css("height", "469px")) } function ef() { var r = !1, t = "", f = "", e, o; for (ni.empty(), ni.append(""), e = n.dataContext.getJSONRecord("AmountDivision/GetDimMaxAmount", { dAmtId: i }), maxDimension = (new n.DB.DataReader).toJson(JSON.stringify(e)); maxDimension.read();)maxDimension.getInt(0) != null ? (su.css("display", "block"), r = !0, f = bi.GetFormatedValue(maxDimension.getString(0)), t += t == "" ? maxDimension.getString(1) : "," + maxDimension.getString(1)) : (ni.append(""), r = !1, window.setTimeout(function () { k.getRoot().parent().css("height", "448px") }, 200)); r && (t.length > 55 && (t = t.substring(0, 55) + "..."), ni.append(n.Msg.getMsg("MaxDimensionAmount") + " : " + f + " " + n.Msg.getMsg("ForAcctSchema") + " : " + t), window.setTimeout(function () { k.getRoot().parent().css("height", "470px") }, 200)); i != 0 ? (o = n.dataContext.getJSONRecord("AmountDivision/GetDimAmount", { dAmtId: i }), Math.abs(parseFloat(u)) > 0 ? v.setValue(u) : v.setValue(o)) : u ? v.setValue(u) : v.setValue(0); ni.html() == "" && (su.css("display", "none"), k.getRoot().parent().css("height", "448px")) } function de() { return v.getValue() == 0 || v.getValue() == "" && v.getValue().trim().length == 0 ? (n.ADialog.warn("ValidateTotalAmount"), v.getControl().focus(), o("hidden"), !1) : s.val() == "" || s.val() == -1 ? (n.ADialog.warn("ValidateAcctSchema"), s.focus(), o("hidden"), !1) : e.val() == "" || e.val() == 0 ? (n.ADialog.warn("ValidateDimType"), e.focus(), o("hidden"), !1) : v.getValue() == 0 || v.getValue() == "" && v.getValue().trim().length == 0 ? (n.ADialog.warn("ValidateTotalAmount"), v.getControl().focus(), o("hidden"), !1) : st ? st ? a.getValue() == 0 || a.getValue() == "" && a.getValue().trim().length == 0 ? (n.ADialog.warn("ValidateAmount"), a.getControl().focus(), o("hidden"), !1) : Math.abs(parseFloat(a.getValue())) > Math.abs(parseFloat(v.getValue())) ? (n.ADialog.warn("LineTotalNotGrater"), a.getControl().focus(), o("hidden"), !1) : parseFloat(a.getValue()) > 0 && parseFloat(v.getValue()) < 0 ? (n.ADialog.warn("VIS_NegativeAmount"), c.getControl().focus(), o("hidden"), !1) : parseFloat(a.getValue()) < 0 && parseFloat(v.getValue()) > 0 ? (n.ADialog.warn("VIS_PositiveAmount"), c.getControl().focus(), o("hidden"), !1) : rs() ? (o("hidden"), !0) : (o("hidden"), !1) : (o("hidden"), !0) : c.getValue() == 0 || c.getValue() == "" && c.getValue().trim().length == 0 ? (n.ADialog.warn("ValidateAmount"), c.getControl().focus(), o("hidden"), !1) : Math.abs(parseFloat(c.getValue())) > Math.abs(parseFloat(v.getValue())) ? (n.ADialog.warn("LineTotalNotGrater"), c.getControl().focus(), o("hidden"), !1) : parseFloat(c.getValue()) > 0 && parseFloat(v.getValue()) < 0 ? (n.ADialog.warn("VIS_NegativeAmount"), c.getControl().focus(), o("hidden"), !1) : parseFloat(c.getValue()) < 0 && parseFloat(v.getValue()) > 0 ? (n.ADialog.warn("VIS_PositiveAmount"), c.getControl().focus(), o("hidden"), !1) : rs() ? (o("hidden"), !0) : (o("hidden"), !1) } function rs() { if (e.val() != 0) if (st) { if (e.val() == "AC") return bt.val() == "" ? (n.ADialog.warn("ValidateAcctElement"), bt.focus(), o("hidden"), !1) : (o("hidden"), !0); if (e.val() == "AY") return pt.val() == -1 || pt.val() == null ? (n.ADialog.warn("ValidateActivity"), pt.focus(), o("hidden"), !1) : (o("hidden"), !0); if (e.val() == "BP") return lt.val() == "" ? (n.ADialog.warn("ValidateBPartner"), lt.focus(), o("hidden"), !1) : (o("hidden"), !0); if (e.val() == "LF" || e.val() == "LT") return or.val() == "" ? (n.ADialog.warn("ValidateLocation"), or.focus(), o("hidden"), !1) : (o("hidden"), !0); if (e.val() == "MC") return dt.val() == -1 || dt.val() == null ? (n.ADialog.warn("ValidateCamp"), kt.focus(), o("hidden"), !1) : (o("hidden"), !0); if (e.val() == "OO" || e.val() == "OT") return yt.val() == -1 || yt.val() == null ? (n.ADialog.warn("ValidateOrg"), yt.focus(), o("hidden"), !1) : (o("hidden"), !0); if (e.val() == "PJ") return nr.val() == "" ? (n.ADialog.warn("ValidateProject"), nr.focus(), o("hidden"), !1) : (o("hidden"), !0); if (e.val() == "PR") return tr.val() == "" ? (n.ADialog.warn("ValidateProduct"), tr.focus(), o("hidden"), !1) : (o("hidden"), !0); if (e.val() == "SA") return !0; if (e.val() == "SR") return wt.val() == -1 || wt.val() == null ? (n.ADialog.warn("ValidateSales"), wt.focus(), o("hidden"), !1) : (o("hidden"), !0); if (e.val() == "U1" || e.val() == "U2") return ei.val() == -1 || ei.val() == null ? (n.ADialog.warn("ValidateElement"), ei.focus(), o("hidden"), !1) : bt.val() == "" ? (n.ADialog.warn("ValidateAcctElement"), bt.focus(), o("hidden"), !1) : (o("hidden"), !0); if (e.val() == "X1" || e.val() == "X2" || e.val() == "X3" || e.val() == "X4" || e.val() == "X5" || e.val() == "X6" || e.val() == "X7" || e.val() == "X8" || e.val() == "X9") return ut.val() == -1 || ut.val() == null ? (n.ADialog.warn("ValidateUElement"), ut.focus(), o("hidden"), !1) : (o("hidden"), !0) } else { if (e.val() == "AC") return ot.val() == "" ? (n.ADialog.warn("ValidateAcctElement"), ot.focus(), o("hidden"), !1) : (o("hidden"), !0); if (e.val() == "AY") return ii.val() == -1 || ii.val() == null ? (n.ADialog.warn("ValidateActivity"), ii.focus(), o("hidden"), !1) : (o("hidden"), !0); if (e.val() == "BP") return et.val() == "" ? (n.ADialog.warn("ValidateBPartner"), et.focus(), o("hidden"), !1) : (o("hidden"), !0); if (e.val() == "LF" || e.val() == "LT") return rr.val() == "" ? (n.ADialog.warn("ValidateLocation"), rr.focus(), o("hidden"), !1) : (o("hidden"), !0); if (e.val() == "MC") return kt.val() == -1 || kt.val() == null ? (n.ADialog.warn("ValidateCamp"), kt.focus(), o("hidden"), !1) : (o("hidden"), !0); if (e.val() == "OO" || e.val() == "OT") return at.val() == -1 || at.val() == null ? (n.ADialog.warn("ValidateOrg"), at.focus(), o("hidden"), !1) : (o("hidden"), !0); if (e.val() == "PJ") return di.val() == "" ? (n.ADialog.warn("ValidateProject"), di.focus(), o("hidden"), !1) : (o("hidden"), !0); if (e.val() == "PR") return gi.val() == "" ? (n.ADialog.warn("ValidateProduct"), gi.focus(), o("hidden"), !1) : (o("hidden"), !0); if (e.val() == "SA") return !0; if (e.val() == "SR") return ri.val() == -1 || ri.val() == null ? (n.ADialog.warn("ValidateSales"), ri.focus(), o("hidden"), !1) : (o("hidden"), !0); if (e.val() == "U1" || e.val() == "U2") return ot.val() == -1 || ot.val() == null ? (n.ADialog.warn("ValidateElement"), ot.focus(), o("hidden"), !1) : ot.val() == "" ? (n.ADialog.warn("ValidateAcctElement"), ot.focus(), o("hidden"), !1) : (o("hidden"), !0); if (e.val() == "X1" || e.val() == "X2" || e.val() == "X3" || e.val() == "X4" || e.val() == "X5" || e.val() == "X6" || e.val() == "X7" || e.val() == "X8" || e.val() == "X9") return vt.val() == -1 || vt.val() == null ? (n.ADialog.warn("ValidateUElement"), vt.focus(), o("hidden"), !1) : (o("hidden"), !0) } } function li(r, u, f) { var l = []; return t.ajax({ dataType: "json", type: "POST", url: n.Application.contextUrl + "AmountDivision/GetDiminsionLine", data: { accountingSchema: JSON.stringify(r), dimensionID: i, DimensionLineID: 0, pageNo: it, pSize: yr }, success: function (t) { var i, r; if (t) { if (t = JSON.parse(t), uf = !0, t.length > 0) { for (i = 0; i < t.length; i++)if (i == 0 && uf) { for (ke = t[i].TotalRecord, r = vo(), gt.empty(), b = 1; b < r + 1; b++)gt.empty().append("<option value=" + b + ">" + b + "<\/option>"); gt.val(1); uf = !1 } u && (s.val(t[0].AcctSchema), po(s.val(), function () { e.val(t[0].DimensionTypeVal); cu(e.val()); ar = t[0].DimensionTypeVal; br = t[0].AcctSchema; ft.setValue(bi.GetFormatedValue(t[0].TotalLineAmount)) })); u || (ar = t[0].DimensionTypeVal, br = t[0].AcctSchema, ft.setValue(bi.GetFormatedValue(t[0].TotalLineAmount))) } else gt.empty().append('<option value="1">1<\/option>'), ft.setValue(bi.GetFormatedValue(0)); h = t.length; c.setValue(0); st = !1; tt.empty().append(n.Msg.getMsg("Add")); l = t; f && f(t) } else n.ADialog.error("ErrorGettingData"), o("hidden") }, error: function () { o("hidden"); n.ADialog.error("ErrorGettingData"); return } }), l } function o(n) { no[0].style.visibility = n } function vo() { var n = ke % yr; return n != 0 ? parseInt(ke / yr) + 1 : parseInt(ke / yr) } function yo(r, u, f, e, s, c, l, a, v, y, p, w, b, k) { o("visible"); u = bi.GetFormatedValue(u); f = bi.GetFormatedValue(f); t.ajax({ dataType: "json", type: "POST", url: n.Application.contextUrl + "AmountDivision/InsertDimensionLine", data: { recordId: r, totalAmount: u, lineAmount: f, acctSchemaID: JSON.stringify(e), elementTypeID: c, dimensionValue: a, elementID: v, oldDimensionName: y, bpartner_ID: n.Utility.Util.getValueOfInt(p), oldBPartner_ID: b }, success: function (t) { var u, r; t = JSON.parse(t); t[0] != "" ? (i = t[0], ef(), st ? (n.ADialog.info("UpdatedDimLine"), w2ui[si].set(h, { DimensionName: l }), w2ui[si].set(h, { DimensionValueAmount: f }), w2ui[si].set(h, { CalculateDimValAmt: f }), (c == "AC" || c == "U1" || c == "U2") && (w2ui[si].set(h, { C_BPartner: w }), w2ui[si].set(h, { C_BPartner_ID: p })), r = bi.GetFormatedValue((parseFloat(parseFloat(ft.getValue()) - parseFloat(be)) + parseFloat(f)).toFixed(hu)), ft.setValue(r)) : (u = w2ui[si].records.length, c == "AC" || c == "U1" || c == "U2" ? w2ui[si].add({ recid: u + 1, DimensionType: s, DimensionName: l, C_BPartner: w, DimensionValueAmount: f, lineAmountID: t[1], CalculateDimValAmt: f, C_BPartner_ID: p }) : w2ui[si].add({ recid: u + 1, DimensionType: s, DimensionName: l, DimensionValueAmount: f, lineAmountID: t[1], CalculateDimValAmt: f }), r = bi.GetFormatedValue((parseFloat(ft.getValue()) + parseFloat(f)).toFixed(hu)), ft.setValue(r)), o("hidden")) : (n.ADialog.error("ErrorGettingData"), o("hidden")); k && k() }, error: function () { o("hidden"); n.ADialog.error("ErrorGettingData"); retval = !1; loading = !1 } }) } function l(t, r, u, f, e, s, h, l, p, w, b) { var d, g, k; if (u = bi.GetFormatedValue(u.toFixed(hu)), d = "", y = [], e == 0 ? y = ct : y[0] = e, st) if (k = {}, k.dTypeVal = s, k.dAmtId = i, k.acctSchemaId = y.toString(), k.dLineId = p, k.dNameVal = h, k.cbPartId = w, d = n.dataContext.getJSONRecord("AmountDivision/CheckDuplicate", k), d == null || d < 1) k = p.toString(), g = n.dataContext.getJSONRecord("AmountDivision/GetTempDimLineAmount", k), Math.abs(parseFloat(ft.getValue()) + parseFloat(u) - parseFloat(g)) <= Math.abs(parseFloat(v.getValue())) ? yo(i, v.getValue(), u, y, t, s, r, h, l, ho, w, b, is, function () { ge() }) : (n.ADialog.warn("LineTotalNotGrater"), a.setValue(0), a.getControl().focus(), ge()); else return n.ADialog.warn("NameExists"), a.setValue(0), o("hidden"), !1; else if (Math.abs(parseFloat(ft.getValue()) + parseFloat(u)) <= Math.abs(parseFloat(v.getValue()))) if (k = {}, k.dTypeVal = s, k.dAmtId = i, k.acctSchemaId = y.toString(), k.dLineId = "0", k.dNameVal = h, k.cbPartId = w, d = n.dataContext.getJSONRecord("AmountDivision/CheckDuplicate", k), d == null || d < 1) yo(i, v.getValue(), u, y, t, s, r, h, l, 0, w, b, 0, function () { ge() }); else return n.ADialog.warn("NameExists"), f = f - 1, c.setValue(0), o("hidden"), !1; else n.ADialog.warn("LineTotalNotGrater"), c.setValue(0), c.getControl().focus(), f = f - 1, ge() } function ge() { c.setValue(0); st = !1; ir.css("display", "none"); cr.css("display", "none"); e.val() == "AC" || e.val() == "U1" || e.val() == "U2" ? p.css("width", "26%") : p.css("width", "33.3%"); tt.empty().append(n.Msg.getMsg("Add")) } function us() { au = null; at = null; vf = null; ii = null; yf = null; kt = null; pf = null; ri = null; wf = null; vt = null; vr = null; et = null; bf = null; di = null; kf = null; gi = null; df = null; gf = null; ai = null; oe = null; yt = null; se = null; pt = null; he = null; dt = null; ce = null; wt = null; le = null; ut = null; wr = null; lt = null; ae = null; nr = null; ve = null; tr = null; ye = null; pe = null; ei = null; g.empty(); d.empty(); ti = 0; co = !0 } function cu(n) { us(); n == "AC" ? os() : n == "AY" ? bs() : n == "BP" ? nh() : n == "LF" ? es() : n == "LT" ? es() : n == "MC" ? ks() : n == "OO" ? fs(n) : n == "OT" ? fs(n) : n == "PJ" ? th() : n == "PR" ? ih() : n == "SA" || (n == "SR" ? ds() : n == "U1" || n == "U2" ? os() : (n == "X1" || n == "X2" || n == "X3" || n == "X4" || n == "X5" || n == "X6" || n == "X7" || n == "X8" || n == "X9") && gs()) } function ws(r, u) { t.ajax({ url: n.Application.contextUrl + "AmountDivision/GetAccountingSchema", dataType: "json", data: { OrgID: r }, type: "POST", error: function () { o("hidden"); alert(n.Msg.getMsg("ErrorWhileGettingData")); return }, success: function (r) { var c = r.dAcctId, l = !1, e = JSON.parse(r.acctData), f, h; if (e.Error) { n.ADialog.error(e.Error); o("hidden"); return } for (s.empty().append('<option selected="selected" value="-1">Please select<\/option>'), f = 0; f < e.length; f++)f == 0 && s.append('<option precision="' + hu + '" value="0">ALL<\/option>'), c == e[f].Key && (l = !0), s.append(t('<option precision="' + e[f].Precision + '"><\/option>').val(e[f].Key).html(e[f].Value)), ct.push(e[f].Key); l && (h = n.dataContext.getJSONRecord("AmountDivision/GetAcctSchemaByActId", { dAmtId: i }), (h == "" || h == null || h < 1) && (s.val(c), po(c))); u && (o("visible"), u(), o("hidden")) } }) } function po(i, r) { o("visible"); t.ajax({ url: n.Application.contextUrl + "AmountDivision/GetDiminsionType", dataType: "json", data: "{}", type: "POST", error: function () { alert(n.Msg.getMsg("ErrorWhileGettingData")); o("hidden"); return }, success: function (u) { var f = JSON.parse(u), u, h, s; if (f.Error) { n.ADialog.error(f.Error); o("hidden"); return } for (u = n.dataContext.getJSONData(n.Application.contextUrl + "AmountDivision/GetElementType", { acctSchemaId: i, allAcctIds: ct }, null), h = (new n.DB.DataReader).toJson(u.eleType), e.empty().append('<option selected="selected" value="0">Please select<\/option>'); h.read();)for (s = 0; s < f.length; s++)if (f[s].Key == h.getString(0)) { e.append(t("<option><\/option>").val(f[s].Key).html(h.getString(1))); break } r && r(); o("hidden") } }) } function rh(t, r, u) { n.ADialog.confirm("DeleteConfirm", !0, "", "Confirm", function (f) { if (f) { o("visible"); n.dataContext.getJSONRecord("AmountDivision/SetDimLine", { dLineId: t, acctId: y[0], dAmtId: i }); w2ui[si].select(u); console.log("selected Rows : " + w2ui[si].getSelection().length); w2ui[si].delete(!0); var e = parseFloat((ft.getValue() - parseFloat(r)).toFixed(hu)); ft.setValue(e); ef(); o("hidden") } }) } function uh(r, u, f) { o("visible"); var c = []; cr.css("display", "table"); e.val() == "AC" || e.val() == "U1" || e.val() == "U2" ? fi.css({ width: "11%", "padding-right": "0" }) : (p.css("width", "33.3%"), fi != undefined && fi != null && fi.css("width", "33.3%")); st = !0; y = []; s.val() == 0 ? y = ct : y[0] = s.val(); t.ajax({ dataType: "json", type: "POST", url: n.Application.contextUrl + "AmountDivision/GetDiminsionLine", data: { accountingSchema: JSON.stringify(y), dimensionID: i, DimensionLineID: r[0], pageNo: it, pSize: yr }, success: function (n) { if (n) { c = JSON.parse(n); h = f; w = r.toString(); var t = e.val(); DimensionNameVal = c[0].DimensionNameVal; ho = c[0].DimensionNameVal; a.setValue(c[0].CalculateDimValAmt); be = c[0].CalculateDimValAmt; is = c[0].C_BPartner_ID; e.val() == "AC" ? (ti = c[0].ElementID, oi.setValue(DimensionNameVal), rt.setValue(c[0].C_BPartner_ID > 0 ? c[0].C_BPartner_ID : -1)) : t == "AY" ? (pt.focus(), pt.val(DimensionNameVal)) : t == "BP" ? (rt.getControl(0).val(rt.getDisplay()), rt.setValue(DimensionNameVal)) : t == "LF" || t == "LT" ? (yi.getControl(0).val(yi.getDisplay()), yi.setValue(DimensionNameVal)) : t == "MC" ? (dt.focus(), dt.val(DimensionNameVal)) : t == "OO" || t == "OT" ? (yt.focus(), yt.val(DimensionNameVal)) : t == "PJ" ? (pi.getControl(0).val(pi.getDisplay()), pi.setValue(DimensionNameVal)) : t == "PR" ? (wi.getControl(0).val(wi.getDisplay()), wi.setValue(DimensionNameVal)) : t == "SA" || (t == "SR" ? (wt.focus(), wt.val(DimensionNameVal)) : t == "U1" || t == "U2" ? (ti = c[0].ElementID, oi.setValue(DimensionNameVal), rt.setValue(c[0].C_BPartner_ID > 0 ? c[0].C_BPartner_ID : -1)) : (t == "X1" || t == "X2" || t == "X3" || t == "X4" || t == "X5" || t == "X6" || t == "X7" || t == "X8" || t == "X9") && (ut.focus(), ut.val(DimensionNameVal))); o("hidden") } } }) } var ki, ss; i && i.toString().indexOf("<") > -1 && (i = 0); this.onClose = null; this.onClosing = null; var kr = t("<div style='width:100%;height:100%;position:relative;display: flex;'>"), of = t("<div class='VIS-AMTD-MainContent vis-formouterwrpdiv'>"), no = t('<div class="vis-busyindicatorouterwrap"><div class="vis-busyindicatorinnerwrap"><i class="vis-busyindicatordiv"><\/i><\/div><\/div>'), fh = t("<table>"), s, e, v, at, c, tt, lu, ir, hs, sf, hf, cf, au, lf, ft, af, vf, ii, yf, kt, pf, ri, wf, vt, vr, et, to, rr, bf, di, kf, gi, df, gf, ai, ot, vi, yr = null, it = null, dr = null, ui = null, ne = null, g = null, wo = null, nt = n.Env.getWindowNo(), h = null, st = null, bo = null, ko = null, te = null, ht = null, ur = null, fr = null, er = "", rt = null, yi = null, pi = null, wi = null, y = null, cs = null, k = new n.ChildDialog, ie = null, vu = null, gr = null, hr = null, yu = null, hi = null, nu = null, pu = null, tu = null, iu = null, wu = null, bu = null, p = null, go = null, ns = null, ts = null, ct = null, ru = this, re = null, ue = null, cr = null, fe = null, io = null, ee = null, pr = null, uu = null, lr = null, ku = null, ci = null, fu = null, du = null, eu = null, ou = null, gu = null, nf = null, fi = null, d = null, yt, a, tf, rf, oe, ro, se, pt, he, dt, ce, wt, le, ut, wr, lt, uo, or, ae, nr, ve, tr, ye, pe, ei, bt, oi, we = null, sr = null, fo = null, eo = null, gt = null, oo = null, so = null, uf = null, si = null, w = null, be = null, ni = null, su = null, bi = null; this.dotFormatter = n.Env.isDecimalPoint(); var hu = n.Env.getCtx().getContextAsInt("#StdPrecision"), ls = null, ar = null, br = null, ho = null, ke = 0, ti = 0, co = !0, is = 0, as = null, lo = null, ff = 0; this.vetoablechange = function (n) { n.propertyName == "Amount" ? c.setValue(n.newValue) : n.propertyName == "ModalAmount" && a.setValue(n.newValue) }; var fs = function (i) { var r, u, h; g.css({ width: "33.3%" }); d.css({ width: "33.3%" }); p.css("width", "33.3%"); au = t("<label>"); oe = t("<label>"); r = ""; r = i == "OO" ? " AND IsSummary='N' AND IsCostCenter='N' AND IsProfitCenter='N'" : " AND IsSummary='N' AND (IsCostCenter='Y' OR IsProfitCenter='Y')"; var f = n.MLookupFactory.get(n.Env.getCtx(), nt, 0, n.DisplayType.TableDir, "AD_Org_ID", 0, !1, "AD_Org_ID<>0" + r), e = n.MLookupFactory.get(n.Env.getCtx(), nt, 0, n.DisplayType.TableDir, "AD_Org_ID", 0, !1, "AD_Org_ID<>0" + r), o = new n.Controls.VComboBox("Org_ID", !1, !1, !0, f, 50), s = new n.Controls.VComboBox("Org_ID", !1, !1, !0, e, 50); at = o.getControl().attr("placeholder", " ").attr("data-placeholder", ""); at.find("option[value=0]").remove(); at.attr("tabindex", "4"); yt = s.getControl().attr("placeholder", " ").attr("data-placeholder", ""); yt.attr("tabindex", "9"); au.append(n.Msg.translate(n.Env.getCtx(), "Org_ID")); oe.append(n.Msg.translate(n.Env.getCtx(), "Org_ID")); vu = t("<div class='VIS-AMTD-formData input-group vis-input-wrap'>"); vu.css("width", "100%"); u = t('<div class="vis-control-wrap">'); pr = t("<div class='VIS-AMTD-formData input-group vis-input-wrap'>"); pr.css("width", "100%"); h = t('<div class="vis-control-wrap">'); vu.append(u); u.append(at).append(au); g.append(vu); pr.append(pr); pr.append(yt).append(oe); d.append(pr); at.focus(); yt.focus() }, bs = function () { var i, r; g.css({ width: "33.3%" }); d.css({ width: "33.3%" }); p.css("width", "33.3%"); vf = t("<label>"); se = t("<label>"); var u = n.MLookupFactory.get(n.Env.getCtx(), nt, 0, n.DisplayType.TableDir, "C_Activity_ID", 0, !1, null), f = n.MLookupFactory.get(n.Env.getCtx(), nt, 0, n.DisplayType.TableDir, "C_Activity_ID", 0, !1, null), e = new n.Controls.VComboBox("C_Activity_ID", !1, !1, !0, u, 50), o = new n.Controls.VComboBox("C_Activity_ID", !1, !1, !0, f, 50); ii = e.getControl().attr("placeholder", " ").attr("data-placeholder", ""); ii.attr("tabindex", "4"); pt = o.getControl().attr("placeholder", " ").attr("data-placeholder", ""); pt.attr("tabindex", "9"); vf.append(n.Msg.translate(n.Env.getCtx(), "C_Activity_ID")); yu = t("<div class='VIS-AMTD-formData input-group vis-input-wrap'>"); yu.css("width", "100%"); i = t("<div class='vis-control-wrap'>"); yu.append(i); i.append(ii).append(vf); g.append(yu); ii.focus(); se.append(n.Msg.translate(n.Env.getCtx(), "C_Activity_ID")); ku = t("<div class='VIS-AMTD-formData input-group vis-input-wrap'>"); ku.css("width", "100%"); r = t("<div class='vis-control-wrap'>"); ku.append(r); r.append(pt).append(se); d.append(ku); pt.focus() }, ks = function () { var i, r; g.css({ width: "33.3%" }); d.css({ width: "33.3%" }); p.css("width", "33.3%"); yf = t("<label>"); he = t("<label>"); var u = n.MLookupFactory.get(n.Env.getCtx(), nt, 0, n.DisplayType.TableDir, "C_Campaign_ID", 0, !1, null), f = n.MLookupFactory.get(n.Env.getCtx(), nt, 0, n.DisplayType.TableDir, "C_Campaign_ID", 0, !1, null), e = new n.Controls.VComboBox("C_Campaign_ID", !1, !1, !0, u, 50), o = new n.Controls.VComboBox("C_Campaign_ID", !1, !1, !0, f, 50); kt = e.getControl().attr("placeholder", " ").attr("data-placeholder", ""); kt.attr("tabindex", "4"); dt = o.getControl().attr("placeholder", " ").attr("data-placeholder", ""); dt.attr("tabindex", "9"); yf.append(n.Msg.translate(n.Env.getCtx(), "C_Campaign_ID")); pu = t("<div class='VIS-AMTD-formData input-group vis-input-wrap'>"); pu.css("width", "100%"); i = t("<div class='vis-control-wrap'>"); pu.append(i); i.append(kt).append(yf); g.append(pu); kt.focus(); he.append(n.Msg.translate(n.Env.getCtx(), "C_Campaign_ID")); du = t("<div class='VIS-AMTD-formData input-group vis-input-wrap'>"); du.css("width", "100%"); r = t("<div class='vis-control-wrap'>"); du.append(r); r.append(dt).append(he); d.append(du); dt.focus() }, ds = function () { var u, f, i, e, o, r; g.css({ width: "33.3%" }); d.css({ width: "33.3%" }); p.css("width", "33.3%"); pf = t("<label>"); ce = t("<label>"); u = n.MLookupFactory.get(n.Env.getCtx(), nt, 0, n.DisplayType.TableDir, "C_SalesRegion_ID", 0, !1, null); f = new n.Controls.VComboBox("C_SalesRegion_ID", !1, !1, !0, u, 50); ri = f.getControl().attr("placeholder", " ").attr("data-placeholder", ""); ri.attr("tabindex", "4"); pf.append(n.Msg.translate(n.Env.getCtx(), "C_SalesRegion_ID")); wu = t("<div class='VIS-AMTD-formData input-group vis-input-wrap'>"); wu.css("width", "100%"); i = t("<div class='vis-control-wrap'>"); wu.append(i); i.append(ri).append(pf); g.append(wu); ri.focus(); e = n.MLookupFactory.get(n.Env.getCtx(), nt, 0, n.DisplayType.TableDir, "C_SalesRegion_ID", 0, !1, null); o = new n.Controls.VComboBox("C_SalesRegion_ID", !1, !1, !0, e, 50); wt = o.getControl().attr("placeholder", " ").attr("data-placeholder", ""); wt.attr("tabindex", "9"); ce.append(n.Msg.translate(n.Env.getCtx(), "C_SalesRegion_ID")); gu = t("<div class='VIS-AMTD-formData input-group vis-input-wrap'>"); gu.css("width", "100%"); r = t("<div class='vis-control-wrap'>"); gu.append(r); r.append(wt).append(ce); d.append(gu); wt.focus() }, gs = function () { var f, i, r, u; for (vt = t("<select>"), ut = t("<select>"), f = n.dataContext.getJSONRecord("AmountDivision/GetUserElement", { aid: y[0], eType: e.find("option:selected").val() }), i = (new n.DB.DataReader).toJson(JSON.stringify(f)), g.css({ width: "33.3%" }), d.css({ width: "33.3%" }), p.css("width", "33.3%"), wf = t("<label>"), vt.empty().append("<option value=-1><\/option>"), ut.empty().append("<option value=-1><\/option>"); i.read();)vt.append("<option value=" + i.getInt(0) + ">" + i.getString(1) + "<\/option>"), ut.append("<option value=" + i.getInt(0) + ">" + i.getString(1) + "<\/option>"); vt.attr("tabindex", "4"); wf.append(n.Msg.translate(n.Env.getCtx(), "AD_Column_ID")); bu = t("<div class='VIS-AMTD-formData input-group vis-input-wrap'>"); bu.css("width", "100%"); r = t("<div class='vis-control-wrap'>"); bu.append(r); r.append(vt).append(wf); g.append(bu); vt.focus(); le = t("<label>"); ut.attr("tabindex", "9"); le.append(n.Msg.translate(n.Env.getCtx(), "AD_Column_ID")); nf = t("<div class='VIS-AMTD-formData input-group vis-input-wrap'>"); nf.css("width", "100%"); u = t("<div class='vis-control-wrap'>"); nf.append(u); u.append(ut).append(le); d.append(nf); ut.focus() }, nh = function () { var e, i, r, o, u, f; g.css({ width: "33.3%" }); d.css({ width: "33.3%" }); p.css("width", "33.3%"); vr = t("<label>"); e = n.MLookupFactory.get(n.Env.getCtx(), nt, 0, n.DisplayType.TableDir, "C_BPartner_ID", 0, !1, null); ht = new n.Controls.VTextBoxButton("C_BPartner_ID", !1, !1, !0, n.DisplayType.Search, e); et = ht.getControl().attr("placeholder", " ").attr("data-placeholder", "").attr("data-hasbtn", " "); et.attr("tabindex", "4"); vr.append(n.Msg.translate(n.Env.getCtx(), "C_BPartner_ID")); hi = t("<div class='VIS-AMTD-formData VIS-AMTD-InputBtns input-group vis-input-wrap'>"); i = t('<div class="vis-control-wrap">'); r = t('<div class="input-group-append">'); hi.css("width", "100%"); hi.append(i); hi.append(r); i.append(et).append(vr); r.append(ht.getBtn(0)); g.append(hi); wr = t("<label>"); o = n.MLookupFactory.get(n.Env.getCtx(), nt, 0, n.DisplayType.TableDir, "C_BPartner_ID", 0, !1, null); rt = new n.Controls.VTextBoxButton("C_BPartner_ID", !1, !1, !0, n.DisplayType.Search, o); lt = rt.getControl().attr("placeholder", " ").attr("data-placeholder", "").attr("data-hasbtn", " "); lt.attr("tabindex", "9"); wr.append(n.Msg.translate(n.Env.getCtx(), "C_BPartner_ID")); ci = t("<div class='VIS-AMTD-formData VIS-AMTD-InputBtns input-group vis-input-wrap'>"); u = t('<div class="vis-control-wrap">'); f = t('<div class="input-group-append">'); ci.css("width", "100%"); ci.append(u); ci.append(f); u.append(lt).append(wr); f.append(rt.getBtn(0)); d.append(ci) }, es = function () { var e, i, r, o, u, f; g.css({ width: "33.3%" }); d.css({ width: "33.3%" }); p.css("width", "33.3%"); to = t("<label>"); e = new n.MLocationLookup(n.Env.getCtx(), nt); ur = new n.Controls.VLocation("C_Location_ID", !1, !1, !0, n.DisplayType.Location, e); rr = ur.getControl().attr("placeholder", " ").attr("data-placeholder", "").attr("data-hasbtn", " "); rr.attr("tabindex", "4"); to.append(n.Msg.translate(n.Env.getCtx(), "C_Location_ID")); nu = t("<div class='VIS-AMTD-formData VIS-AMTD-InputBtns input-group vis-input-wrap'>"); i = t('<div class="vis-control-wrap">'); r = t('<div class="input-group-append">'); nu.css("width", "100%"); nu.append(i); nu.append(r); i.append(rr).append(to); r.append(ur.getBtn(1)); g.append(nu); uo = t("<label>"); o = new n.MLocationLookup(n.Env.getCtx(), nt); yi = new n.Controls.VLocation("C_Location_ID", !1, !1, !0, n.DisplayType.Location, o); or = yi.getControl().attr("placeholder", " ").attr("data-placeholder", "").attr("data-hasbtn", " "); or.attr("tabindex", "9"); uo.append(n.Msg.translate(n.Env.getCtx(), "C_Location_ID")); fu = t("<div class='VIS-AMTD-formData VIS-AMTD-InputBtns input-group vis-input-wrap'>"); u = t('<div class="vis-control-wrap">'); f = t('<div class="input-group-append">'); fu.css("width", "100%"); fu.append(u); fu.append(f); u.append(or).append(uo); f.append(yi.getBtn(1)); d.append(fu) }, th = function () { var e, i, r, o, u, f; g.css({ width: "33.3%" }); d.css({ width: "33.3%" }); p.css("width", "33.3%"); bf = t("<label>"); e = n.MLookupFactory.get(n.Env.getCtx(), nt, 0, n.DisplayType.TableDir, "C_Project_ID", 0, !1, null); fr = new n.Controls.VTextBoxButton("C_Project_ID", !1, !1, !0, n.DisplayType.Search, e); di = fr.getControl().attr("placeholder", " ").attr("data-placeholder", "").attr("data-hasbtn", " "); di.attr("tabindex", "4"); bf.append(n.Msg.translate(n.Env.getCtx(), "C_Project_ID")); iu = t("<div class='VIS-AMTD-formData VIS-AMTD-InputBtns input-group vis-input-wrap'>"); i = t('<div class="vis-control-wrap">'); r = t('<div class="input-group-append">'); iu.css("width", "100%"); iu.append(i); iu.append(r); i.append(di).append(bf); r.append(fr.getBtn(0)); g.append(iu); ae = t("<label>"); o = n.MLookupFactory.get(n.Env.getCtx(), nt, 0, n.DisplayType.TableDir, "C_Project_ID", 0, !1, null); pi = new n.Controls.VTextBoxButton("C_Project_ID", !1, !1, !0, n.DisplayType.Search, o); nr = pi.getControl().attr("placeholder", " ").attr("data-placeholder", "").attr("data-hasbtn", " "); nr.attr("tabindex", "9"); ae.append(n.Msg.translate(n.Env.getCtx(), "C_Project_ID")); ou = t("<div class='VIS-AMTD-formData VIS-AMTD-InputBtns input-group vis-input-wrap'>"); u = t('<div class="vis-control-wrap">'); f = t('<div class="input-group-append">'); ou.css("width", "100%"); ou.append(u); ou.append(f); u.append(nr).append(ae); f.append(pi.getBtn(0)); d.append(ou) }, ih = function () { var e, i, r, o, u, f; g.css({ width: "33.3%" }); d.css({ width: "33.3%" }); p.css("width", "33.3%"); kf = t("<label>"); e = n.MLookupFactory.get(n.Env.getCtx(), nt, 0, n.DisplayType.TableDir, "M_Product_ID", 0, !1, null); er = new n.Controls.VTextBoxButton("M_Product_ID", !1, !1, !0, n.DisplayType.Search, e); gi = er.getControl().attr("placeholder", " ").attr("data-placeholder", "").attr("data-hasbtn", " "); gi.attr("tabindex", "4"); kf.append(n.Msg.translate(n.Env.getCtx(), "M_Product_ID")); tu = t("<div class='VIS-AMTD-formData VIS-AMTD-InputBtns input-group vis-input-wrap'>"); i = t('<div class="vis-control-wrap">'); r = t('<div class="input-group-append">'); tu.css("width", "100%"); tu.append(i); tu.append(r); i.append(gi).append(kf); r.append(er.getBtn(0)); g.append(tu); ve = t("<label>"); o = n.MLookupFactory.get(n.Env.getCtx(), nt, 0, n.DisplayType.TableDir, "M_Product_ID", 0, !1, null); wi = new n.Controls.VTextBoxButton("M_Product_ID", !1, !1, !0, n.DisplayType.Search, o); tr = wi.getControl().attr("placeholder", " ").attr("data-placeholder", "").attr("data-hasbtn", " "); tr.attr("tabindex", "9"); ve.append(n.Msg.translate(n.Env.getCtx(), "M_Product_ID")); eu = t("<div class='VIS-AMTD-formData VIS-AMTD-InputBtns input-group vis-input-wrap'>"); u = t('<div class="vis-control-wrap">'); f = t('<div class="input-group-append">'); eu.css("width", "100%"); eu.append(u); eu.append(f); u.append(tr).append(ve); f.append(wi.getBtn(0)); d.append(eu) }, os = function () { var b, u, k, f, o, i, s, h, tt, c, it, l, a, r, v, w; if (ti = n.dataContext.getJSONData(n.Application.contextUrl + "AmountDivision/GetElementID", { accountingSchema: JSON.stringify(y) }, null), ti == 0) return co = !1, !1; g.css({ width: "66.6%" }); d.css({ width: "66.6%", "margin-right": "9px" }); p.css("width", "26.5%"); fi.css("width", "26.5%"); df = t("<label>"); gf = t("<label>"); df.append(n.Msg.translate(n.Env.getCtx(), "C_Element_ID")); gf.append(n.Msg.translate(n.Env.getCtx(), "C_ElementValue_ID")); i = n.MLookupFactory.get(n.Env.getCtx(), nt, 0, n.DisplayType.TableDir, "C_Element_ID", 0, !1, null); b = new n.Controls.VComboBox("C_Element_ID", !1, !1, !0, i, 50); ai = b.getControl().attr("placeholder", " ").attr("data-placeholder", "").attr("data-hasbtn", " "); ai.attr("tabindex", "4"); gr = t("<div class='VIS-AMTD-formData input-group vis-input-wrap'>"); u = t('<div class="vis-control-wrap">'); gr.css("width", "50%"); gr.append(u); u.append(ai).append(df); g.append(gr); gr.hide(); k = n.MLookupFactory.get(n.Env.getCtx(), nt, 0, n.DisplayType.TableDir, "C_ElementValue_ID", 0, !1, "C_Element_ID=" + ti); vi = new n.Controls.VTextBoxButton("C_ElementValue_ID", !1, !1, !0, n.DisplayType.Search, k); ot = vi.getControl().attr("placeholder", " ").attr("data-placeholder", "").attr("data-hasbtn", " "); ot.attr("tabindex", "4"); hr = t("<div class='VIS-AMTD-formData VIS-AMTD-InputBtns input-group vis-input-wrap'>"); f = t('<div class="vis-control-wrap">'); o = t('<div class="input-group-append">'); hr.css("width", "50%"); hr.append(f); hr.append(o); f.append(ot).append(gf); o.append(vi.getBtn(0)); g.append(hr); ai.on("change", function () { var t = n.MLookupFactory.get(n.Env.getCtx(), nt, 0, n.DisplayType.TableDir, "C_ElementValue_ID", 0, !1, "C_Element_ID=" + ai.val()); ot.lookup = t }); ot.focus(); vr = t("<label>"); i = n.MLookupFactory.get(n.Env.getCtx(), nt, 0, n.DisplayType.TableDir, "C_BPartner_ID", 0, !1, null); ht = new n.Controls.VTextBoxButton("C_BPartner_ID", !1, !1, !0, n.DisplayType.Search, i); et = ht.getControl().attr("placeholder", " ").attr("data-placeholder", "").attr("data-hasbtn", " "); et.attr("tabindex", "5"); vr.append(n.Msg.translate(n.Env.getCtx(), "C_BPartner_ID")); hi = t("<div class='VIS-AMTD-formData VIS-AMTD-InputBtns input-group vis-input-wrap'>"); s = t('<div class="vis-control-wrap">'); h = t('<div class="input-group-append">'); hi.css("width", "50%"); hi.append(s); hi.append(h); s.append(et).append(vr); h.append(ht.getBtn(0)); g.append(hi); e.val() == "AC" || e.val() == "U1" || e.val() == "U2" ? (ui.showColumn("C_BPartner"), hr.css("width", "49%"), hi.css("width", "49%").css("margin-left", "9px"), p.css("width", "26%"), fi.css("width", "26%")) : (hr.css("width", "51%"), hi.css("width", "49%").css("margin-left", ""), p.css("width", "26.5%"), fi.css("width", "26.5%")); ye = t("<label>"); pe = t("<label>"); ye.append(n.Msg.translate(n.Env.getCtx(), "C_Element_ID")); pe.append(n.Msg.translate(n.Env.getCtx(), "C_ElementValue_ID")); r = n.MLookupFactory.get(n.Env.getCtx(), nt, 0, n.DisplayType.TableDir, "C_Element_ID", 0, !1, null); tt = new n.Controls.VComboBox("C_Element_ID", !1, !1, !0, r, 50); ei = tt.getControl().attr("placeholder", " ").attr("data-placeholder", ""); ei.attr("tabindex", "9"); uu = t("<div class='VIS-AMTD-formData input-group vis-input-wrap'>"); c = t('<div class="vis-control-wrap">'); uu.css("width", "50%"); uu.append(c); c.append(ei).append(ye); d.append(uu); uu.hide(); it = n.MLookupFactory.get(n.Env.getCtx(), nt, 0, n.DisplayType.TableDir, "C_ElementValue_ID", 0, !1, "C_Element_ID=" + ti); oi = new n.Controls.VTextBoxButton("C_ElementValue_ID", !1, !1, !0, n.DisplayType.Search, it); bt = oi.getControl().attr("placeholder", " ").attr("data-placeholder", "").attr("data-hasbtn", " "); bt.attr("tabindex", "9"); lr = t("<div class='VIS-AMTD-formData VIS-AMTD-InputBtns input-group vis-input-wrap'>"); l = t('<div class="vis-control-wrap">'); a = t('<div class="input-group-append">'); lr.css("width", "50%"); lr.append(l); lr.append(a); l.append(bt).append(pe); a.append(oi.getBtn(0)); d.append(lr); ei.on("change", function () { var t = n.MLookupFactory.get(n.Env.getCtx(), nt, 0, n.DisplayType.TableDir, "C_ElementValue_ID", 0, !1, "C_Element_ID=" + ei.val()); bt.lookup = t }); bt.focus(); wr = t("<label>"); r = n.MLookupFactory.get(n.Env.getCtx(), nt, 0, n.DisplayType.TableDir, "C_BPartner_ID", 0, !1, null); rt = new n.Controls.VTextBoxButton("C_BPartner_ID", !1, !1, !0, n.DisplayType.Search, r); lt = rt.getControl().attr("placeholder", " ").attr("data-placeholder", "").attr("data-hasbtn", " "); lt.attr("tabindex", "10"); wr.append(n.Msg.translate(n.Env.getCtx(), "C_BPartner_ID")); ci = t("<div class='VIS-AMTD-formData VIS-AMTD-InputBtns input-group vis-input-wrap'>"); v = t('<div class="vis-control-wrap">'); w = t('<div class="input-group-append">'); ci.css("width", "49%"); ci.append(v); ci.append(w); e.val() == "AC" || e.val() == "U1" || e.val() == "U2" ? (lr.css("width", "49%"), ci.css("width", "48%").css("margin-left", "9px"), fi.css("width", "26%")) : (lr.css("width", "51%"), ci.css("width", "49%"), fi.css("width", "26.5%")); v.append(lt).append(wr); w.append(rt.getBtn(0)); d.append(ci) }; ki = function (i) { var r = []; r.push({ field: "DimensionType", caption: "Dimension Type", size: "30%", min: 217 }); r.push({ field: "DimensionName", caption: "Dimension Name", size: "30%", min: 217 }); r.push({ field: "C_BPartner", caption: "Business Partner", size: "30%", min: 217, hidden: !0 }); r.push({ field: "DimensionValueAmount", caption: "Dimension Value Amount", size: "30%", min: 216, render: function (t) { var i = n.Utility.Util.getValueOfDecimal(t.DimensionValueAmount); return i.toLocaleString() } }); r.push({ field: "Edit", caption: "", size: "5%", resizable: !1, render: function () { return '<a  tabindex="8"><div><img src="' + n.Application.contextUrl + 'Areas/VIS/Images/base/Edit_sub16.png" alt="Edit record" title="Edit record" style="opacity: 1;cursor:pointer"><\/div><\/a>' } }); r.push({ field: "Delete", caption: "", size: "5%", resizable: !1, render: function () { return '<a id="a1" tabindex="14"><div><img src="' + n.Application.contextUrl + 'Areas/VIS/Images/base/delete10.png" alt="Delete record" title="Delete record" style="opacity: 1;cursor:pointer"><\/div><\/a>' } }); r.push({ field: "lineAmountID", caption: "lineAmountID", hidden: !0, resizable: !1, min: 0, max: 0 }); r.push({ field: "CalculateDimValAmt", caption: "CalculateDimValAmt", hidden: !0, resizable: !1, min: 0, max: 0 }); r.push({ field: "C_BPartner_ID", caption: "C_BPartner", hidden: !0, resizable: !1, min: 0, max: 0 }); dr = "gridAmountDivision" + Math.random(); dr = dr.replace(".", ""); si = dr; w2utils.encodeTags([]); ui = t(ne).w2grid({ name: dr, recordHeight: 20, show: { toolbar: !1, columnHeaders: !0, lineNumbers: !1, selectColumn: !1, toolbarReload: !1, toolbarColumns: !0, toolbarSearch: !1, toolbarAdd: !1, toolbarDelete: !1, toolbarSave: !1, selectionBorder: !1, recordTitles: !1 }, columns: r, records: i, onClick: function (t) { if (t.column == 4 && ui.records.length > 0) { te = t.recid; var i = ui.get(t.recid).lineAmountID, r = []; i.search(",") == -1 ? r[0] = i : r = i.split(","); uh(r, ui.get(t.recid).CalculateDimValAmt, t.recid) } t.column == 5 && ui.records.length > 0 && (tt.html() == n.Msg.getMsg("Update") && te == t.recid ? n.ADialog.warn("PleaseFirstUpdateThisRecord") : rh(ui.get(t.recid).lineAmountID, ui.get(t.recid).CalculateDimValAmt, t.recid)) } }); (e.val() == "AC" || e.val() == "U1" || e.val() == "U2") && ui.showColumn("C_BPartner") }; this.show = function () { ss(); k.getRoot(); o("visible"); c.addVetoableChangeListener(this); a.addVetoableChangeListener(this); ws(r, function () { li(ct, !0, function (n) { ki(n); y[0] = s.val(); ef(); i == 0 || n.length == 0 ? (p.css("display", "none"), tt.css("display", "none"), k.getRoot().parent().css("height", "390px")) : (p.css("display", "block"), tt.css("display", "block"), ni.html() == "" ? k.getRoot().parent().css("height", "448px") : k.getRoot().parent().css("height", "469px")); o("hidden") }) }) }; vs(); ss = function () { k.setContent(kr); k.setWidth(750); k.setTitle(n.Msg.getMsg("AmountDimension")); k.setModal(!0); k.setEnableResize(!1); k.show(); k.hideButtons(); k.onClose = function () { ru.onClosing(i); ru.onClose && ru.onClose() } } } n.AmountDivision = i }(VIS, jQuery); VIS = window.VIS || {}, function (n, t) { n.UploadAmountDimension = function (i, r) { var b = null, u = [], h = [], c = 0, e = 0, l = Date.now().toString(), o = 1048576, a = 0, s = 0, y = [], f = null, g = i, rt = t(window).width(), ut = t(window).height(), l = Date.now().toString(), ft = r; savedFileName = ""; var k = t("<div id='progress_bar' class='vis-ui-progress-bar vis-ui-container' style='top:40%;width: 40%;left: 32%;position:absolute;z-index:99999;'>"), p = null, w = null; this.isWait = !1; self = this; var nt = function () { var n = null, t = 0; for (var i in u) t = parseInt(u[i].size / o), f.size % o > 0 && t++, a += t, n = {}, n.Name = u[i].name, n.Size = u[i].size, y.push(n); d() }, d = function () { var i; if (u == null || u.length == 0) { v(!1); return } if (!(e >= u.length)) { var t = new XMLHttpRequest, r = new FormData, f = u[e].name.substring(0, u[e].name.lastIndexOf(".")) + l + u[e].name.substring(u[e].name.lastIndexOf(".")); savedFileName = f; r.append("file", u[e].slice(s * o, s * o + Number(o))); t.open("POST", n.Application.contextUrl + "AmountDivision/SaveFileinTemp?fileName=" + f + "&folderKey=" + l + "&orgFileName=" + u[e].name, !1); t.send(r); b = t.responseText; c++; s++; i = parseInt(u[e].size / o); u[e].size % o > 0 && i++; s == i && (e++, s = 0); c <= a && it(parseInt(c / a * 80)); window.setTimeout(function () { d() }, 2) } }, tt = function (t) { for (var r, b, p, k, i = [], w = 0; w < t.files.length; w++) { if (f = t.files[w], f == undefined) return; if (f.size <= 0) return u = [], h = [], c = 0, e = 0, l = null, o = null, a = 0, s = 0, y = [], f = null, n.ADialog.info("VADMS_FileSizeShouldGreaterThan0KB"), v(!1), !1; if (f.name.indexOf("&") > -1 || f.name.indexOf("?") > -1 || f.name.indexOf("#") > -1 || f.name.indexOf("/") > -1 || f.name.indexOf("\\") > -1) { i.push(f.name); continue } for (r in u) if (f.name == u[r].name) { window.setTimeout(function () { v(!1); n.ADialog.info("fileAlreadyAttached") }, 20); return } if (h != null) for (r in h) if (f.name == h[r].Name && !h[r].IsDeleted) { window.setTimeout(function () { v(!1); n.ADialog.info("fileAlreadyAttached") }, 20); return } b = {}; b.Name = f.name; b.Size = f.size; u.push(f) } if (i.length > 0) { p = ""; for (k in i) p += i[k].toString() + "\n"; p += i.length == 1 ? "File has" : "Files have"; p += " invalid name. Please change the file name and try again."; v(!1); n.ADialog.info("", !0, p) } }, v = function (n) { if (t("body").find("#progressbar").remove(), n) { p = t("<div class='vis-ui-progress' style='width: 0%; display: block;position:absolute;height: 35px;'>"); w = t("<span class='vis-ui-label'  style='position:absolute;left: 60%;top: 4px;'>").append("0%"); p.append(w); k.append(p); var i = t("<div id='progressbar' style='z-index: 999999;' class='VIS-AMTD-Busy-Progress'><\/div>"); i.append(k); i.appendTo("<body>") } else t("body").find("progressbar").remove() }, it = function (n) { p.css("width", n + "%"); w.empty(); w.append(n + "%") }; return this.getFolderKey = l, this.getSavedFileName = savedFileName, this.GetUploadedExcelColumns = function () { var t, f, i; if (e >= u.length) return t = [], f = n.Application.contextUrl + "contextUrl/SaveAttachmentEntries", t.push({ Files: JSON.stringify(y) }), t.push({ FolderKey: l }), t.push({ FileName: savedFileName }), t.push({ Mapping: r }), i = n.ControllerRequestAjaxParameter1(f, t, !1), r.ExcelCol = i.ExcelCol, r.FileName = i.FileName, i }, v(!0), tt(i), nt(), b } }(VIS, jQuery), function (n, t) { function i(i, r, u, f, e, o, s, h) { function vi() { y.css("width", "100%"); y.css("height", "100%"); y.css("position", "relative"); wt = t("<div class='vis-info-l-s-wrap vis-leftsidebarouterwrap'>"); lt = t("<div>"); wt.append(lt); at = t("<div class='vis-info-datasec'>"); et = t("<div class='vis-info-btnsec'>"); ct.append(wt); ct.append(at); ct.append(et); vt = n.Msg.getMsg("Refresh"); vt.indexOf("&") > -1 && (vt = vt.replace("&", "")); ot = n.Msg.getMsg("Cancel"); ot.indexOf("&") > -1 && (ot = ot.replace("&", "")); st = n.Msg.getMsg("Ok"); st.indexOf("&") > -1 && (st = st.replace("&", "")); it = t("<div class='vis-info-btnswrap'>"); ht = t("<button class='VIS_Pref_btn-2'>").append(ot); rt = t("<button disabled='true' style='cursor:default;opacity:.5' class='VIS_Pref_btn-2'>").append(st); it.append(ht); it.append(rt); et.append(it); bt = t("<div class='vis-info-btnleft'>"); yt = t("<button class='VIS_Pref_btn-2' style='margin-top: 10px;'>").append(t("<i class='vis vis-refresh'><\/i>")); dt = t('<div class="vis-info-pagingwrp">'); gi(); dt.append(gt); it.append(ht); it.append(rt); bt.append(yt); et.append(bt); et.append(dt); et.append(it); a = t('<div class="vis-busyindicatorouterwrap"><div class="vis-busyindicatorinnerwrap"><i class="vis-busyindicatordiv"><\/i><\/div><\/div>'); a[0].style.visibility = "visible"; y.append(ct); y.append(a); o == !0 && k.selectedIDs != null && k.selectedIDs.length > 0 && (c = k.selectedIDs.split(",").map(Number), u = null) } function yi() { if (!n.Application.isMobile) y.on("keyup", function (t) { t.keyCode === 13 && (a[0].style.visibility = "visible", s != null && s.length > 0 && (s = n.Env.parseContext(n.Env.getCtx(), r, s, !1, !1)), ft(!0, l.val())) }); ht.on("click", function () { k.onClose != null && k.onClose(); kt() }); rt.on("click", function () { ui() }); yt.on("click", function () { a[0].style.visibility = "visible"; s != null && s != undefined && s.length > 0 && (s = n.Env.parseContext(n.Env.getCtx(), r, s, !1, !1)); ft(!0, l.val()) }) } function pi() { k.onClose != null && k.onClose(); kt() } function ki() { pt(!1) } function di(n) { var i, t; if (!o) { pt(!0); return } if (n.index) t = w2ui[n.target].records[n.index][keyCol], c.indexOf(t) > -1 && c.splice(c.indexOf(t), 1); else for (i = 0; i < w2ui[n.target].records.length; i++)t = w2ui[n.target].records[i][keyCol], c.indexOf(t) > -1 && c.splice(c.indexOf(t), 1); window.setTimeout(function () { c.length == 0 && w2ui[n.target].getSelection().length == 0 && pt(!0) }, 50) } function pt(n) { n ? rt.prop("disabled", "true").css({ cursor: "default", opacity: ".5" }) : rt.prop("disabled", "").css({ cursor: "pointer", opacity: "1" }) } function gi() { gt = t('<ul class="vis-statusbar-ul">'); ni = t('<li class="flex-fill"><section class="vis-ad-w-p-s-result"><span><\/span><\/section><\/li>'); d = t('<li style="opacity: 1;"><div><i class="vis vis-shiftleft" title="' + n.Msg.getMsg("FirstPage") + '" style="opacity: 0.6;"><\/i><\/div><\/li>'); g = t('<li style="opacity: 1;"><div><i class="vis vis-pageup" title="' + n.Msg.getMsg("PageUp") + '" style="opacity: 0.6;"><\/i><\/div><\/li>'); l = t("<select>"); ii = t("<li>").append(l); nt = t('<li style="opacity: 1;"><div><i class="vis vis-pagedown" title="' + n.Msg.getMsg("PageDown") + '" style="opacity: 0.6;"><\/i><\/div><\/li>'); tt = t('<li style="opacity: 1;"><div><i class="vis vis-shiftright" title="' + n.Msg.getMsg("LastPage") + '" style="opacity: 0.6;"><\/i><\/div><\/li>'); ri = ni.find(".vis-ad-w-p-s-result").find("span"); gt.append(ni).append(d).append(g).append(ii).append(nt).append(tt); nr() } function nr() { d.on("click", function () { t(this).css("opacity") == "1" && ft(!0, 1) }); g.on("click", function () { t(this).css("opacity") == "1" && ft(!0, parseInt(l.val()) - 1) }); nt.on("click", function () { t(this).css("opacity") == "1" && ft(!0, parseInt(l.val()) + 1) }); tt.on("click", function () { t(this).css("opacity") == "1" && ft(!0, parseInt(l.find("Option:last").val())) }); l.on("change", function () { ft(!0, l.val()) }) } function tr(n) { var i, o; if (l.empty(), n.TotalPage > 0) { for (i = 0; i < n.TotalPage; i++)l.append(t("<option value=" + (i + 1) + ">" + (i + 1) + "<\/option>")); l.val(n.CurrentPage); n.TotalPage > n.CurrentPage ? (nt.css("opacity", "1"), tt.css("opacity", "1")) : (nt.css("opacity", "0.6"), tt.css("opacity", "0.6")); n.CurrentPage > 1 ? (d.css("opacity", "1"), g.css("opacity", "1")) : (d.css("opacity", "0.6"), g.css("opacity", "0.6")); n.TotalPage == 1 && (d.css("opacity", "0.6"), g.css("opacity", "0.6"), nt.css("opacity", "0.6"), tt.css("opacity", "0.6")) } else d.css("opacity", "0.6"), g.css("opacity", "0.6"), nt.css("opacity", "0.6"), tt.css("opacity", "0.6"); var s = n.CurrentPage, e = n.PageSize, r = n.TotalRecords, u = (s - 1) * e, f = u + e; f > r && (f = r); r == 0 && (u -= 1); o = li + " " + (u + 1) + "-" + f + " " + ai + " " + r; ri.text(o) } var ui, fi, kt; this.onClose = null; this.selectedIDs = h; var y = t("<div class='vis-forms-container'>"), ei = !0, ct = t("<div class='vis-info-subroot'>"), oi = null, si = null, hi = null, wt = null, lt = null, at = null, et = null, vt = null, ot = null, st = null, it = null, ht = null, rt = null, bt = null, yt = null, a = null, p = null, w = [], b = null, ut = null, k = this; this.keyCol = ""; var c = [], ci = null, v = null, dt, gt, d, g, ii, nt, tt, l, ni, ri = null, li = n.Msg.getMsg("ShowingResult"), ai = n.Msg.getMsg("of"), ti = 0; vi(); yi(); ui = function () { var n = w2ui[v].getSelection(); for (item in n) c.indexOf(w2ui[v].get(n[item])[keyCol]) == -1 && c.push(w2ui[v].get(n[item])[keyCol]); k.onClose != null && c.length > 0 && k.onClose(); kt() }; this.show = function () { t.ajax({ url: n.Application.contextUrl + "InfoGeneral/GetSearchColumns", dataType: "json", data: { tableName: f, ad_Language: n.context.getAD_Language(), isBaseLangage: n.Env.isBaseLanguage(n.context) }, error: function () { n.ADialog.error("ERRORGettingSearchCols"); a[0].style.visibility = "hidden" }, success: function (t) { if (p = t.result, p == null) { n.ADialog.error("ERRORGettingSearchCols"); a[0].style.visibility = "hidden"; return } wi() } }) }; var wi = function () { var h, i, e, rt, c, v, k; if (ti = p[0].AD_Table_ID, b = n.dataContext.getJSONData(n.Application.contextUrl + "InfoGeneral/GetDispalyColumns", { AD_Table_ID: ti, AD_Language: n.context.getAD_Language(), IsBaseLangage: n.Env.isBaseLanguage(n.context), TableName: f }).result, b == null) { alert(n.Msg.getMsg("ERRORGettingDisplayCols")); a[0].style.visibility = "hidden"; return } var nt = null, o = null, d = t("<table>"); d.css("width", "100%"); h = null; for (i in p) { var tt = t("<td>"), it = t('<div class="input-group vis-input-wrap">'), g = t('<div class="vis-control-wrap">'); h = t("<tr>"); d.append(h); h.append(tt); tt.append(it); it.append(g); e = {}; o = new n.Controls.VTextBox(p[i].ColumnName, !1, !1, !0, 50, 100, null, null, !1); e.Ctrl = o; e.AD_Reference_ID = 10; e.ColumnName = p[i].ColumnName; e.IsTranslated = p[i].IsTranslated; p[i].IsIdentifier && o.setValue(u); rt = t("<td>"); g.append(o.getControl().attr("data-placeholder", "").attr("placeholder", " ")); nt = new n.Controls.VLabel(p[i].Name, p[i].ColumnName); g.append(nt.getControl()); w.push(e) } lt.append(d); c = n.Msg.getMsg("Refresh"); c.indexOf("&") > -1 && (c = c.replace("&", "")); v = n.Msg.getMsg("Cancel"); v.indexOf("&") > -1 && (v = v.replace("&", "")); k = n.Msg.getMsg("Ok"); k.indexOf("&") > -1 && (k = k.replace("&", "")); y.dialog({ width: 1020, height: 500, resizable: !1, title: p[0].TableDisplayName, modal: !0, close: pi, closeText: n.Msg.getMsg("close") }); s != null && s != undefined && s.length > 0 && (s = n.Env.parseContext(n.Env.getCtx(), r, s, !1, !1)); ft(!0, l.val()) }, ft = function (i, r) { var k, u, l, d, y, p; if (o && w2ui[v]) { k = w2ui[v].getSelection(); for (u in k) c.indexOf(w2ui[v].get(k[u])[keyCol]) == -1 && c.push(w2ui[v].get(k[u])[keyCol]) } fi(); for (u in b) b[u].IsKey && (keyCol = b[u].ColumnName.toUpperCase()); if (i == !0) { var e = null, g = !1; for (l = 0; l < w.length; l++) { if (e = w[l].Ctrl.getValue(), e == null || e.length == 0 || e == 0 || !e) { w[l].Value = null; continue } w[l].Value = e; g = !0 } } if (d = [], w && Object.keys(w).length > 0) for (y = 0; y < Object.keys(w).length; y++)p = {}, p.ColumnName = w[y].ColumnName, p.IsTranslated = w[y].IsTranslated, p.Value = w[y].Value, d.push(p); r || (r = 1); t.ajax({ url: n.Application.contextUrl + "InfoGeneral/GetData", dataType: "json", type: "POST", data: { TableName: f, AD_Table_ID: ti, PageNo: r, KeyCol: keyCol, SelectedIDs: h, Requery: i, SrchCtrl: JSON.stringify(d), ValidationCode: n.secureEngine.encrypt(s) }, error: function () { alert(n.Msg.getMsg("ErrorWhileGettingData")); a[0].style.visibility = "hidden"; return }, success: function (t) { var i = JSON.parse(t); if (i == null) { a[0].style.visibility = "hidden"; return } if (i.Error) { n.ADialog.error(i.Error); a[0].style.visibility = "hidden"; return } tr(i.pSetting); bi(i.data) } }) }, bi = function (i) { var r, e, s, u; if (i == null) { alert(n.Msg.getMsg("NoDataFound")); a[0].style.visibility = "hidden"; return } var h = [], l = [], f = null; for (u in i) (r = { resizable: !0 }, b[u]) && (f = b[u].AD_Reference_ID, r.caption = b[u].Name, r.field = b[u].ColumnName.toUpperCase(), r.columnName = b[u].ColumnName.toUpperCase(), r.sortable = !0, r.hidden = !b[u].IsDisplayed, r.size = "100px", n.DisplayType.IsNumeric(f) ? r.render = f == n.DisplayType.Integer ? "int" : f == n.DisplayType.Amount ? "number:2" : "number:1" : n.DisplayType.IsDate(f) ? r.render = function (n, t, i) { var r = n[h[i].field]; return r ? Globalize.format(new Date(r), "d") : "" } : f == n.DisplayType.Location || f == n.DisplayType.Locator ? r.render = "int" : f == n.DisplayType.Account ? r.render = "int" : f == n.DisplayType.PAttribute ? r.render = "int" : f == n.DisplayType.Button ? r.render = function () { return "<div>button<\/div>" } : f == n.DisplayType.Image ? r.render = function () { return "<div>Image<\/div>" } : n.DisplayType.IsLOB(f) && (r.render = function () { return "<div>[Lob-blob]<\/div>" }), h[u] = r); for (e = 0; e < i[0].RowCount; e++) { s = {}; for (u in i) s[i[u].ColumnName.toUpperCase()] = i[u].Values[e]; s.recid = e + 1; l[e] = s } if (v = "gridGenInfodata" + Math.random(), v = v.replace(".", ""), w2utils.encodeTags(l), ut = t(at).w2grid({ name: v, recordHeight: 40, show: { toolbar: !1, columnHeaders: !0, lineNumbers: !1, selectColumn: !0, toolbarReload: !1, toolbarColumns: !0, toolbarSearch: !1, toolbarAdd: !1, toolbarDelete: !1, toolbarSave: !1, selectionBorder: !1, recordTitles: !1 }, columns: h, records: l, multiSelect: o, onUnselect: di, onSelect: ki }), o) for (itm in c) for (u in w2ui[v].records) w2ui[v].records[u][keyCol] == c[itm] && (w2ui[v].select(parseInt(u) + 1), pt(!1)); else pt(!0); a[0].style.visibility = "hidden" }; fi = function () { ut != null && ut.destroy(); ut = null }; this.getSelectedValues = function () { return c }; kt = function () { y.off("keyup"); ht.off("click"); rt.off("click"); yt.off("click"); d.off("click"); g.off("click"); nt.off("click"); tt.off("click"); l.off("change"); at = null; lt = null; ut != null && ut.destroy(); ut = null; ei = null; ct = null; oi = null; si = null; hi = null; wt = null; lt = null; at = null; et = null; vt = null; ot = null; st = null; it = null; ht = null; rt = null; bt = null; yt = null; a = null; p = null; w = null; b = null; ut = null; k = null; keyCol = null; c = null; ci = null; d = g = nt = tt = l = null; y != null && (y.dialog("destroy"), y.remove()); y = null; this.btnOKClick = null; this.displaySearchCol = null; this.displayData = null; this.loadData = null; this.disposeComponent = null; this.disposeDataSec = null; this.getSelectedValues = null } } n.infoGeneral = i }(VIS, jQuery), function (n, t) { function i(i, r, u, f, e, o, s, h, c, l) { function ie() { var o, i; eu = []; eu.push({ field: "WareHouse", caption: n.Msg.getMsg("Warehouse"), size: "150px" }, { field: "Variant", caption: n.Msg.getMsg("Variant"), size: "150px" }, { field: "Quantity", caption: n.Msg.getMsg("Quantity"), size: "100px", editable: { type: "float" }, render: "number:1" }, { field: "Available", caption: n.Msg.getElement(n.Env.getCtx(), "QtyAvailable"), size: "100px" }, { field: "OnHand", caption: n.Msg.getElement(n.Env.getCtx(), "QtyOnHand"), size: "100px" }, { field: "Reserved", caption: n.Msg.getElement(n.Env.getCtx(), "QtyReserved"), size: "100px" }, { field: "Ordered", caption: n.Msg.getElement(n.Env.getCtx(), "QtyOrdered"), size: "100px" }, { field: "M_Warehouse_ID", caption: "WareHouse ID", size: "150px", hidden: !0 }, { field: "M_AttributeSetInstance_ID", caption: "M_AttributeSetInstance_ID", size: "150px", hidden: !0 }, { field: "M_Product_ID", caption: "M_Product_ID", size: "150px", hidden: !0 }, { field: "ParentRec_ID", caption: "Parent recid", size: "150px", hidden: !0 }); ut.css("width", "100%"); ut.css("height", "100%"); ut.css("position", "relative"); st.css("width", "100%"); pi = t("<div class='vis-info-l-s-wrap vis-pad-0 vis-leftsidebarouterwrap'>"); wi = t("<div class='vis-info-l-s-content'>"); pi.append(wi); fi = t("<div class='vis-info-datasec'>"); ei = t("<div class='vis-info-btnsec'>"); yi.append(pi); yi.append(fi); yi.append(ei); h == !0 && ot.selectedIDs != null && ot.selectedIDs.length > 0 && (v = ot.selectedIDs.split(",").map(Number), ctrlValue = null); tr = n.Msg.getMsg("Value"); tr.indexOf("&") > -1 && (tr = tr.replace("&", "")); ir = n.Msg.getMsg("Name"); ir.indexOf("&") > -1 && (ir = ir.replace("&", "")); rr = n.Msg.getMsg("UPC"); rr.indexOf("&") > -1 && (rr = rr.replace("&", "")); ur = n.Msg.getMsg("SKU"); ur.indexOf("&") > -1 && (ur = ur.replace("&", "")); fr = n.Msg.getMsg("Warehouse"); fr.indexOf("&") > -1 && (fr = fr.replace("&", "")); er = n.Msg.getMsg("PriceListVersion"); er.indexOf("&") > -1 && (er = er.replace("&", "")); bi = n.Msg.getMsg("Refresh"); bi.indexOf("&") > -1 && (bi = bi.replace("&", "")); yr = n.Msg.getMsg("AddCatalog"); yr.indexOf("&") > -1 && (yr = yr.replace("&", "")); pr = n.Msg.getMsg("ShowSaved"); pr.indexOf("&") > -1 && (pr = pr.replace("&", "")); br = n.Msg.getMsg("ShowCart"); br.indexOf("&") > -1 && (br = br.replace("&", "")); wr = n.Msg.getMsg("ShowScan"); wr.indexOf("&") > -1 && (wr = wr.replace("&", "")); oi = n.Msg.getMsg("Cancel"); oi.indexOf("&") > -1 && (oi = oi.replace("&", "")); si = n.Msg.getMsg("Ok"); si.indexOf("&") > -1 && (si = si.replace("&", "")); or = n.Msg.getElement(n.Env.getCtx(), "M_AttributeSet_ID"); or.indexOf("&") > -1 && (or = or.replace("&", "")); sr = n.Msg.getElement(n.Env.getCtx(), "M_AttributeSetInstance_ID"); sr.indexOf("&") > -1 && (sr = sr.replace("&", "")); hr = n.Msg.getMsg("AttrCode"); hr.indexOf("&") > -1 && (hr = hr.replace("&", "")); d = t("<tr>"); st.append(d); var u = t("<td>"), f = t('<div class="input-group vis-input-wrap">'), r = t('<div class="vis-control-wrap">'); tt = t("<label class='VIS_Pref_Label_Font'>").append(tr); d.append(u); u.append(f); f.append(r); i = {}; it = new n.Controls.VTextBox("Value", !1, !1, !0, 50, 100, null, null, !1); i.Ctrl = it; i.AD_Reference_ID = 10; i.ColumnName = "Value"; o = t("<td>"); r.append(it.getControl().attr("data-placeholder", "").attr("placeholder", " ")); r.append(tt); k.push(i); d = t("<tr>"); st.append(d); var u = t("<td>"), f = t('<div class="input-group vis-input-wrap">'), r = t('<div class="vis-control-wrap">'); tt = t("<label class='VIS_Pref_Label_Font'>").append(ir); d.append(u); u.append(f); f.append(r); i = {}; it = new n.Controls.VTextBox("Name", !1, !1, !0, 50, 100, null, null, !1); i.Ctrl = it; i.AD_Reference_ID = 10; i.ColumnName = "Name"; it.setValue(e); o = t("<td>"); r.append(it.getControl().attr("data-placeholder", "").attr("placeholder", " ")); r.append(tt); k.push(i); d = t("<tr>"); st.append(d); var u = t("<td>"), f = t('<div class="input-group vis-input-wrap">'), r = t('<div class="vis-control-wrap">'); tt = t("<label class='VIS_Pref_Label_Font'>").append(rr); d.append(u); u.append(f); f.append(r); i = {}; it = new n.Controls.VTextBox("UPC", !1, !1, !0, 50, 100, null, null, !1); i.Ctrl = it; i.AD_Reference_ID = 10; i.ColumnName = "UPC"; r.append(it.getControl().attr("data-placeholder", "").attr("placeholder", " ")); r.append(tt); k.push(i); d = t("<tr>"); st.append(d); var u = t("<td>"), f = t('<div class="input-group vis-input-wrap">'), r = t('<div class="vis-control-wrap">'); tt = t("<label class='VIS_Pref_Label_Font'>").append(ur); d.append(u); u.append(f); f.append(r); i = {}; it = new n.Controls.VTextBox("SKU", !1, !1, !0, 50, 100, null, null, !1); i.Ctrl = it; i.AD_Reference_ID = 10; i.ColumnName = "SKU"; o = t("<td>"); r.append(it.getControl().attr("data-placeholder", "").attr("placeholder", " ")); r.append(tt); k.push(i); d = t("<tr>"); st.append(d); var u = t("<td>"), f = t('<div class="input-group vis-input-wrap">'), r = t('<div class="vis-control-wrap">'); tt = t("<label class='VIS_Pref_Label_Font'>").append(fr); d.append(u); u.append(f); f.append(r); i = {}; ii = new n.Controls.VComboBox("M_Warehouse_ID", !1, !1, !0, null, 50); i.Ctrl = ii; i.AD_Reference_ID = n.DisplayType.tableDir; i.ColumnName = "M_Warehouse_ID"; o = t("<td>"); d.append(o); r.append(ii.getControl().attr("data-placeholder", "").attr("placeholder", " ")); r.append(tt); k.push(i); d = t("<tr>"); st.append(d); var u = t("<td>"), f = t('<div class="input-group vis-input-wrap">'), r = t('<div class="vis-control-wrap">'); tt = t("<label class='VIS_Pref_Label_Font'>").append(er); d.append(u); u.append(f); f.append(r); i = {}; hi = new n.Controls.VComboBox("M_PriceList_Version_ID", !1, !1, !0, null, 50); i.Ctrl = hi; i.AD_Reference_ID = n.DisplayType.tableDir; i.ColumnName = "M_PriceList_Version_ID"; o = t("<td>"); r.append(hi.getControl().attr("data-placeholder", "").attr("placeholder", " ")); r.append(tt); k.push(i); d = t("<tr>"); st.append(d); var u = t("<td>"), f = t('<div class="input-group vis-input-wrap">'), r = t('<div class="vis-control-wrap">'); tt = t("<label class='VIS_Pref_Label_Font'>").append(hr); d.append(u); u.append(f); f.append(r); i = {}; it = new n.Controls.VTextBox("AttributeCode", !1, !1, !0, 50, 100, null, null, !1); i.Ctrl = it; i.AD_Reference_ID = 10; i.ColumnName = "AttributeCode"; o = t("<td>"); r.append(it.getControl().attr("data-placeholder", "").attr("placeholder", " ")); r.append(tt); k.push(i); d = t("<tr>"); st.append(d); var u = t("<td>"), f = t('<div class="input-group vis-input-wrap">'), r = t('<div class="vis-control-wrap">'); tt = t("<label class='VIS_Pref_Label_Font'>").append(or); d.append(u); u.append(f); f.append(r); i = {}; ni = new n.Controls.VComboBox("M_AttributeSet_ID", !1, !1, !0, null, 50); i.Ctrl = ni; i.AD_Reference_ID = n.DisplayType.tableDir; i.ColumnName = "M_AttributeSet_ID"; o = t("<td>"); r.append(ni.getControl().attr("data-placeholder", "").attr("placeholder", " ")); r.append(tt); k.push(i); d = t("<tr>"); st.append(d); var u = t("<td>"), f = t('<div class="input-group vis-input-wrap">'), r = t('<div class="vis-control-wrap">'); d.append(u); u.append(f); f.append(r); i = {}; rf(); wi.append(st); bt = t("<div class='vis-info-btnswrap'>"); kr = t("<div class='vis-info-ls-btnswrap'>"); di = t("<button class='VIS_Pref_btn-2'>").append(oi); dt = t("<button disabled='true' style='cursor:default;opacity:.5' class='VIS_Pref_btn-2'>").append(si); rt = t("<button class='VIS_Pref_btn-2'>").append(t("<i class='fa fa-cart-plus'><\/i>")); kt = t("<button class='VIS_Pref_btn-2' disabled>").append(t("<i class='fa fa-list-ul'><\/i>")); dr = t("<button class='VIS_Pref_btn-2'>").append(t("<i class='vis vis-scanner'>")); ki = t("<button class='VIS_Pref_btn-2'>").append(t("<i class='fa fa-shopping-cart'><\/i>")); gr = t("<div class='vis-info-btnleft'>"); gi = t("<button class='VIS_Pref_btn-2' style='margin-top: 10px;'>").append(t("<i class='vis vis-refresh'><\/i>")); lu = t('<div class="vis-info-pagingwrp">'); ro(); lu.append(au); bt.append(di); bt.append(dt); bt.append(kt); bt.append(rt); kr.append(dr); kr.append(ki); pi.append(kr); gr.append(gi); ei.append(gr); ei.append(lu); ei.append(bt); p = t('<div class="vis-busyindicatorouterwrap"><div class="vis-busyindicatorinnerwrap"><i class="vis-busyindicatordiv"><\/i><\/div><\/div>'); p[0].style.visibility = "visible"; ut.append(yi); ut.append(p) } function rf() { var i = {}, o; d.empty(); o = " M_AttributeSetInstance_ID IN (SELECT  asi.M_AttributeSetInstance_ID as M_AttributeSetInstance_ID   FROM M_AttributeSetInstance asi   WHERE asi.IsActive='Y' AND asi.M_ATTRIBUTESET_ID=" + ni.ctrl.val() + ")"; fu = n.MLookupFactory.get(n.Env.getCtx(), r, 8472, n.DisplayType.Search, "M_AttributeSetInstance_ID", 0, !1, o); ti = new n.Controls.VTextBoxButton("M_AttributeSetInstance_ID", !1, !1, !0, n.DisplayType.Search, fu); ti.getControl(); i.Ctrl = ti; i.AD_Reference_ID = n.DisplayType.Search; i.ColumnName = "M_AttributeSetInstance_ID"; var s = t("<td>"), u = t('<div class="input-group vis-input-wrap">'), f = t('<div class="vis-control-wrap">'), e = t('<div class="input-group-append">'); tt = t("<label class='VIS_Pref_Label_Font'>").append(sr); s.append(u); u.append(f); u.append(e); f.append(ti.getControl().attr("data-placeholder", "").attr("placeholder", " ").attr("data-hasbtn", " ")); e.append(ti.getBtn(0)); e.append(ti.getBtn(1)); f.append(tt); k.push(i) } function re() { if (!n.Application.isMobile) ut.on("keyup", function (t) { if (t.keyCode === 13 && (p[0].style.visibility = "visible", c != null && c.length > 0 && (lr = n.Env.parseContext(n.Env.getCtx(), r, c, !1, !1)), lt(!0, g.val()), b.length > 0)) { for (var i = 0; i < b.length; i++)w2ui["subgrid-" + b[i]].destroy(); b = [] } }); dr.on("click", function () { ye() }); ki.on("click", function () { ve() }); rt.on("click", function () { pe() }); kt.on("click", function () { p[0].style.visibility = "visible"; pu() }); di.on("click", function () { ot.onClose != null && ot.onClose(); uu() }); dt.on("click", function () { hf() }); gi.on("click", function () { if (lr = null, h && !ht && rt.show(), y.length == 0 && kt.prop("disabled", !0), v = [], p[0].style.visibility = "visible", c != null && c != undefined && c.length > 0 && (lr = n.Env.parseContext(n.Env.getCtx(), r, c, !1, !1)), lt(!0, 1), b.length > 0) { for (var t = 0; t < b.length; t++)w2ui["subgrid-" + b[t]].destroy(); b = [] } }); ni.ctrl.change(function () { ti = null; fu = null; for (var n = 0; n < k.length; n++)k[n].Ctrl.colName == "M_AttributeSetInstance_ID" && k.splice(n); rf() }) } function ue(i, u) { cu = new n.MPAttributeLookup(n.context, r); gu = new n.Controls.VPAttribute("M_AttributeSetInstance_ID", !1, !1, !0, n.DisplayType.PAttribute, cu, r, !1, !1, !1, !0); ii.ctrl.append(t('<Option value="0"><\/option>')); hi.ctrl.append(t('<Option value="0"><\/option>')); ni.ctrl.append(t('<Option value="0"><\/option>')); bu = jQuery.parseJSON(bu); ku = jQuery.parseJSON(ku); u == 0 && (u = oe()); su = ae(n.Env.getCtx(), r, u); fe() } function fe() { try { var t = n.dataContext.getJSONData(n.Application.contextUrl + "InfoProduct/GetWarehouse", null, null); ee(t) } catch (i) { console.log(i); p[0].style.visibility = "hidden" } } function ee(t) { var i, e, r; if (t.length > 0) { for (r in t) i = n.Utility.Util.getValueOfInt(t[r].M_Warehouse_ID), e = n.Utility.Util.getValueOfString(t[r].Name), ii.getControl().append(" <option value=" + i + ">" + e + "<\/option>"), i == u && ii.ctrl.val(u); u == 0 && ii.ctrl.val(n.Utility.Util.getValueOfInt(t[0].M_Warehouse_ID)) } se(f) } function ui(n) { n ? dt.prop("disabled", "true").css({ cursor: "default", opacity: ".5" }) : dt.prop("disabled", "").css({ cursor: "pointer", opacity: "1" }) } function ff(t, i) { var f = !1, u, r; if (t.value_new = n.Utility.Util.getValueOfString(i), t.value_new.contains(".")) { for (f = !0, u = [], r = 0; r < t.value_new.length; r++)t.value_new[r] === "." && u.push(r); u.length > 1 && (t.value_new = yu(t.value_new, ".")) } if (t.value_new.contains(",")) if (f) t.value_new = yu(t.value_new, ","); else { for (u = [], r = 0; r < t.value_new.length; r++)t.value_new[r] === "," && u.push(r); t.value_new = u.length > 1 ? yu(t.value_new, ",") : t.value_new.replace(",", ".") } return t.value_new == "" && (t.value_new = "0"), t.value_new } function yu(n, t) { var i = n.split(t); return n = i.slice(0, -1).join("") + "." + i.slice(-1), n.indexOf(".") == n.length - 1 && (n = n.replace(".", "")), n } function oe() { var i = 0, t; try { t = n.dataContext.getJSONData(n.Application.contextUrl + "InfoProduct/GetDefaultPriceList", null, null); t != null && (i = t) } catch (r) { console.log(r); p[0].style.visibility = "hidden" } return i } function se(t) { try { var i = n.dataContext.getJSONData(n.Application.contextUrl + "InfoProduct/GetPriceList", { PriceList: t }, null); he(i) } catch (r) { console.log(r); p[0].style.visibility = "hidden" } } function he(t) { var i, u, r; if (t.length > 0) for (r in t) i = n.Utility.Util.getValueOfInt(t[r].M_PriceList_Version_ID), u = n.Utility.Util.getValueOfString(t[r].Name), hi.getControl().append(" <option value=" + i + ">" + u + "<\/option>"), i == su && hi.ctrl.val(su); ce() } function ce() { try { n.dataContext.getJSONData(n.Application.contextUrl + "InfoProduct/GetAttributeSet", null, le) } catch (t) { console.log(t); p[0].style.visibility = "hidden" } } function le(t) { var r, u, i; if (t.length > 0) for (i in t) r = n.Utility.Util.getValueOfInt(t[i].M_AttributeSet_ID), u = n.Utility.Util.getValueOfString(t[i].Name), ni.getControl().append(" <option value=" + r + ">" + u + "<\/option>") } function ae(t, i, u) { var e = null, s = 0, o = t.getContext(i, "DateOrdered"), c, f, h, l, a; o != null && o.Length > 0 ? e = System.Convert.ToDateTime(n.Env.parseContext(n.Env.getCtx(), r, "DateOrdered", !1, !1)) : (o = t.getContext(i, "DateInvoiced"), o != null && o.Length > 0 && (e = System.Convert.ToDateTime(n.Env.parseContext(n.Env.getCtx(), r, "DateInvoiced", !1, !1)))); e == null && (c = new Date, e = n.Utility.Util.getValueOfDate(c)); try { if (f = n.dataContext.getJSONData(n.Application.contextUrl + "InfoProduct/GetPriceListVersion", { PriceList: u }, null), f.length > 0) { for (h in f) l = n.Utility.Util.getValueOfInt(f[h].M_PriceList_Version_ID), a = n.Utility.Util.getValueOfString(f[h].ValidFrom), e > a && (s = l); s == 0 && (s = n.Utility.Util.getValueOfInt(f[0].M_PriceList_Version_ID)) } } catch (v) { console.log(v); p[0].style.visibility = "hidden" } return s } function ve() { ri = !1; ci = 0; var t = new n.InfoScanForm(r, !0); t.showDialog(); t.onClose = function (t, i, u) { p[0].style.visibility = "visible"; window.setTimeout(function () { var l, f, h, w, c, b; if (ri = i, ci = u, l = n.Env.getCtx().getContext("#AD_Session_ID"), t && t.length > 0) for (f in t) { var a = "", v = "", e = 0, o = 0, s = t[f].VAICNT_Quantity, p = t[f].M_Product_ID, k = t[f].Value; e = t[f].M_AttributeSetInstance_ID; h = t[f].Description; w = t[f].VAICNT_InventoryCountLine_ID; a = t[f].Name; v = t[f].UOM; o = t[f].C_UOM_ID; c = t[f].LineID; s > 0 && (y.length > 0 ? (b = y.map(function (n) { return n._prdID == p && n._Attribute == e && n._uom == o && n._refLineID == c }).indexOf(!0), b > -1 ? y[b]._prodQty += s : y.push({ _prodQty: s, _prdID: p, _prdName: a, _value: k, _uom: o, _uomName: v, _AD_Session_ID: l, _windowNo: r, _RefNo: "", _Attribute: e, _AttributeName: h, _Locator_ID: 0, _IsLotSerial: "N", _countID: w, _refLineID: c })) : y.push({ _prodQty: s, _prdID: p, _prdName: a, _value: k, _uom: o, _uomName: v, _AD_Session_ID: l, _windowNo: r, _RefNo: "", _Attribute: e, _AttributeName: h, _Locator_ID: 0, _IsLotSerial: "N", _countID: w, _refLineID: c }), nu[e] = h) } pu() }, 200) } } function be() { var f, i, u; for (nt != null && (nt.destroy(), nt = null), f = [], i = 0; i < w.length; i++)u = {}, u.Product = w[i].Product, u.Value = w[i].Value, u.QtyEntered = w[i].QtyEntered, u.UOM = w[i].UOM, u.Attribute = w[i].Attribute, u.ProdID = w[i].M_Product_ID1, u.recid = i + 1, f[i] = u; a = "gridsavedprd" + Math.random(); a = a.replace(".", ""); w2utils.encodeTags(f); nt = t(fi).w2grid({ name: a, recordHeight: 40, show: { toolbar: !1, columnHeaders: !0, lineNumbers: !1, selectColumn: !0, toolbarReload: !1, toolbarColumns: !0, toolbarSearch: !1, toolbarAdd: !1, toolbarDelete: !1, toolbarSave: !1, selectionBorder: !1, recordTitles: !1 }, columns: [{ field: "Value", caption: '<div style="text-align: center;" ><span>' + n.Msg.translate(n.Env.getCtx(), "Value") + "<\/span><\/div>", sortable: !1, size: "120px", min: 100, hidden: !1 }, { field: "Product", caption: '<div style="text-align: center;" ><span>' + n.Msg.translate(n.Env.getCtx(), "Product") + "<\/span><\/div>", sortable: !1, size: "20%", min: 150, hidden: !1 }, { field: "QtyEntered", caption: '<div style="text-align: center;" ><span>' + n.Msg.translate(n.Env.getCtx(), "QtyEntered") + "<\/span><\/div>", sortable: !1, size: "70px", min: 60, hidden: !1, editable: { type: "float" }, render: function (t) { var i = n.Utility.Util.getValueOfDecimal(t.QtyEntered); return i.toLocaleString() } }, { field: "UOM", caption: '<div style="text-align: center;" ><span>' + n.Msg.translate(n.Env.getCtx(), "UOM") + "<\/span><\/div>", sortable: !1, size: "70px", min: 60, hidden: !1 }, { field: "Attribute", caption: n.Msg.translate(n.Env.getCtx(), "Attribute"), sortable: !1, size: "20%", min: 150, hidden: !1, editable: { type: "custom", ctrl: gu, showAll: !0 }, render: function (n) { var r = cu, t = n.Attribute, i = nu[t]; return !i && t > 0 && (i = r.getDisplay(t, !0), nu[t] = i), i } }, { field: "Delete", caption: '<div style="text-align: center;" ><span>' + n.Msg.translate(n.Env.getCtx(), "DeleteActivity") + "<\/span><\/div>", sortable: !1, size: "60px", min: 40, hidden: !1, render: function () { return '<div class="vis-info-grid-icowrap"><i class="vis vis-delete title="Delete record" style="opacity: 1;"><\/i><\/div>' } }, { field: "Copy", caption: '<div style="text-align: center;" ><span>' + n.Msg.translate(n.Env.getCtx(), "Copy") + "<\/span><\/div>", sortable: !1, size: "60px", min: 40, hidden: !1, render: function () { return '<div class="vis-info-grid-icowrap"><i class="vis vis-new title="Copy record" style="opacity: 1;"><\/i><\/div>' } }, { field: "ProdID", caption: '<div style="text-align: center;" ><span>' + n.Msg.translate(n.Env.getCtx(), "ProdID") + "<\/span><\/div>", sortable: !1, size: "20%", min: 150, hidden: !0 }], records: f, onChange: function (n) { n.column == 2 ? (w2ui[a].records[n.index].QtyEntered = n.value_new, y[n.index]._prodQty = n.value_new, w[n.index].QtyEntered = n.value_new) : n.column == 4 && (w2ui[a].records[n.index].Attribute = n.value_new, y[n.index]._Attribute = n.value_new, w[n.index].Attribute = n.value_new) }, onClick: function (t) { t.column == 5 && nt.records.length > 0 ? (p[0].style.visibility = "visible", y.splice(t.recid - 1, 1), w.splice(t.recid - 1, 1), sf()) : t.column == 6 && nt.records.length > 0 ? (p[0].style.visibility = "visible", w.push({ SrNo: w.length, Product: w[t.recid - 1].Product, Value: w[t.recid - 1].Value, QtyEntered: w[t.recid - 1].QtyEntered, UOM_ID: w[t.recid - 1].UOM_ID, UOM: w[t.recid - 1].UOM, M_Product_ID1: w[t.recid - 1].M_Product_ID1, Attribute: "", AttributeName: "", RefNo: w[t.recid - 1].RefNo }), y[y.length] = { _prodQty: w[w.length - 1].QtyEntered, _prdID: w[w.length - 1].M_Product_ID1, _prdName: w[w.length - 1].Product, _value: w[w.length - 1].Value, _uom: w[w.length - 1].UOM_ID, _uomName: w[w.length - 1].UOM, _AD_Session_ID: n.Env.getCtx().getContext("#AD_Session_ID"), _windowNo: r, _RefNo: "", _Attribute: 0, _AttributeName: "", _Locator_ID: 0, _IsLotSerial: "N", _countID: 0 }, sf()) : t.column == 4 && nt.records.length > 0 && n.Env.getCtx().setContext(r, "M_Product_ID", n.Utility.Util.getValueOfInt(w[t.recid - 1].M_Product_ID1)) }, onSelect: ef, onUnselect: of }); p[0].style.visibility = "hidden" } function ef() { ui(!1) } function of(n) { if (!h) { ui(!0); return } window.setTimeout(function () { w2ui[n.target].getSelection().length == 0 && ui(!0) }, 50) } function sf() { var i, n, t; for (nt.clear(), i = [], n = 0; n < w.length; n++)t = {}, t.Product = w[n].Product, t.Value = w[n].Value, t.QtyEntered = w[n].QtyEntered, t.UOM = w[n].UOM, t.Attribute = w[n].Attribute, t.ProdID = w[n].M_Product_ID1, t.recid = n + 1, i[n] = t; i.length > 0 && (w2utils.encodeTags(i), nt.add(i)); p[0].style.visibility = "hidden" } function vi(t, i, r) { p[0].style.visibility = "hidden"; t && (hu = !0); ot.onClose != null && ot.onClose(); uu(); var u = n.Msg.getMsg("RecSaved"); t || (u = r > 0 ? r + " " + n.Msg.getMsg("RecordsNotSaved") : n.Msg.getMsg("ErrorInSaving")); i && i != "" && (u += ", " + i); n.ADialog.info("", !0, u) } function lf() { var b = 0, f = "", k = 0, nt = "", d = 0, c = 0, l = 0, u = 0, a = 0, g = 0, i; d = n.Utility.Util.getValueOfInt(n.context.getWindowContext(r, "M_Locator_ID", !0)); b = n.context.getContextAsInt(r, n.context.getWindowTabContext(r, 0, "KeyColumnName")); f = n.context.getWindowTabContext(r, 0, "KeyColumnName"); k = n.context.getContextAsInt(r, n.context.getWindowTabContext(r, 1, "KeyColumnName")); nt = n.context.getWindowTabContext(r, 1, "KeyColumnName"); a = n.Utility.Util.getValueOfInt(n.context.getWindowContext(r, "M_ProductContainer_ID", !0)); gt == 170 && (c = n.Utility.Util.getValueOfInt(n.context.getWindowContext(r, "M_LocatorTo_ID", !0)), g = n.Utility.Util.getValueOfInt(n.context.getWindowContext(r, "Ref_M_ProductContainerTo_ID", !0))); gt == 146 && (b = n.context.getContextAsInt(r, n.context.getWindowTabContext(r, 1, "KeyColumnName")), k = 0); l = n.Utility.Util.getValueOfInt(b); u = n.Utility.Util.getValueOfInt(k); var e = [], o = [], s = [], v = [], h = [], w = []; if (y.length > 0 && rt.css("display") == "none") { for (i in y) if (e.push(y[i]._prdID), o.push(y[i]._prodQty), v.push(y[i]._RefNo), h.push(y[i]._Attribute), s.push(y[i]._uom), w.push(y[i]._countID), u != 0) break; li = y.length } else { for (i in ct) if (e.push(ct[i]._prdID), o.push(ct[i]._prodQty), v.push(ct[i]._RefNo), h.push(ct[i]._Attribute), s.push(ct[i]._uom), w.push(ct[i]._countID), u != 0) break; li = ct.length } ru = li % ft == 0 ? li / ft : Math.ceil(li / ft); ru == 1 ? f == "SAP001_StockTransfer_ID" ? t.ajax({ type: "POST", url: n.Application.contextUrl + "InfoProduct/SaveStockTfr", dataType: "json", data: { id: l, keyColumn: f, AD_Table_ID: n.context.getWindowTabContext(r, 1, "AD_Table_ID"), prod: JSON.stringify(e), C_UOM_ID: JSON.stringify(s), listAst: JSON.stringify(h), qty: JSON.stringify(o), locatorTo: c, lineID: u, ContainerID: a }, success: function (n) { var t = n.result; t }, error: function (n, t) { p[0].style.visibility = "hidden"; console.log(t); returnValue } }) : t.ajax({ type: "POST", url: n.Application.contextUrl + "InfoProduct/Save", dataType: "json", data: { id: l, keyColumn: f, prod: JSON.stringify(e), C_UOM_ID: JSON.stringify(s), listAst: JSON.stringify(h), qty: JSON.stringify(o), locatorTo: c, lineID: u, InvCountID: JSON.stringify(w), ReferenceNo: JSON.stringify(v), Locator_ID: d, WindowID: gt, ContainerID: a, ContainerToID: g }, success: function (t) { var i = JSON.parse(t); if (i.count == 0) { if (ri) try { n.dataContext.getJSONData(n.Application.contextUrl + "InfoProduct/DeleteCart", { invCount_ID: ci }, null) } catch (r) { console.log(r); vi(!0, r.message) } vi(!0); return } wu(i); vi(!1, vf(), i.count); return }, error: function (n, t) { p[0].style.visibility = "hidden"; console.log(t) } }) : af(l, f, u, e, o, [], s, v, h, d, c, [], w, a, g) } function af(i, u, f, e, o, s, h, c, l, a, v, y, w, b, k) { var d = ut.find(".filestatuscounter"); d.text() != "" ? ru == ar ? d.text(li + " Records Inserted..Please Wait..!!") : d.text(ar * ft - vr + " Records Inserted..Please Wait..!!") : io(ar * ft); u == "SAP001_StockTransfer_ID" ? t.ajax({ type: "POST", url: n.Application.contextUrl + "InfoProduct/SaveStockTfr", dataType: "json", data: { id: i, keyColumn: u, AD_Table_ID: n.context.getWindowTabContext(r, 1, "AD_Table_ID"), prod: JSON.stringify(e.splice(0, ft)), C_UOM_ID: JSON.stringify(h.splice(0, ft)), listAst: JSON.stringify(l.splice(0, ft)), qty: JSON.stringify(o.splice(0, ft)), locatorTo: v, lineID: f, ContainerID: b }, success: function (n) { var t = n.result; t }, error: function (n, t) { p[0].style.visibility = "hidden"; console.log(t); returnValue } }) : t.ajax({ type: "POST", url: n.Application.contextUrl + "InfoProduct/Save", dataType: "json", data: { id: i, keyColumn: u, prod: JSON.stringify(e.splice(0, ft)), C_UOM_ID: JSON.stringify(h.splice(0, ft)), listAst: JSON.stringify(l.splice(0, ft)), qty: JSON.stringify(o.splice(0, ft)), locatorTo: v, lineID: f, InvCountID: JSON.stringify(w.splice(0, ft)), ReferenceNo: c, Locator_ID: a, WindowID: gt, ContainerID: b, ContainerToID: k }, success: function (t) { var r = JSON.parse(t); if (ar++, ru == ar) { if (vr == 0) { if (ri) try { n.dataContext.getJSONData(n.Application.contextUrl + "InfoProduct/DeleteCart", { invCount_ID: ci }, null) } catch (p) { console.log(p); vi(!0, p.message) } vi(!0); return } wu(r); vr += r.count; vi(!1, vf(), vr); return } r.count == 0 || (wu(r), vr += r.count); af(i, u, f, e, o, s, h, c, l, a, v, y, w, b, k) }, error: function (n, t) { p[0].style.visibility = "hidden"; console.log(t) } }) } function vf() { var t = "", n; if (wt.length > 0) for (n = 0; n < wt.length; n++)n != 0 && (t += " ::: "), t += wt[n] + " --> " + ai[n]; return wt = [], ai = [], t } function wu(n) { var t, i; if (n.errorKeys.length > 0) if (wt.length > 0) for (t = 0; t < n.errorKeys.length; t++)i = wt.indexOf(n.errorKeys[t]), i >= 0 ? ai[i] = ai[i] + ", " + n.errorProds[t] : (wt.push(n.errorKeys[t]), ai.push(n.errorProds[t])); else wt = n.errorKeys, ai = n.errorProds; else wt.push(n.error) } function ke() { ot.onClose != null && ot.onClose(); uu() } function io(n) { iu = t("<div class='filestatus'> <label class='filestatuscounter'>" + n + " Records Inserted..Please Wait..!!<\/lable><\/div>"); iu.css({ position: "absolute", width: "98%", height: "97%", "text-align": "center", "z-index": "999" }); iu[0].style.visibility = "visible"; ut.append(iu) } function ro() { au = t('<ul class="vis-statusbar-ul">'); vu = t('<li class="flex-fill"><section class="vis-ad-w-p-s-result"><span><\/span><\/section><\/li>'); at = t('<li style="opacity: 1;"><div><i class="vis vis-shiftleft" title="' + n.Msg.getMsg("FirstPage") + '"  style="opacity: 0.6;"><\/i><\/div><\/li>'); vt = t('<li style="opacity: 1;"><div><i class="vis vis-pageup" title="' + n.Msg.getMsg("PageUp") + '"  style="opacity: 0.6;"><\/i><\/div><\/li>'); g = t("<select>"); tu = t("<li>").append(g); yt = t('<li style="opacity: 1;"><div><i class="vis vis-pagedown" title="' + n.Msg.getMsg("PageDown") + '" style="opacity: 0.6;"><\/i><\/div><\/li>'); pt = t('<li style="opacity: 1;"><div><i class="vis vis-shiftright" title="' + n.Msg.getMsg("LastPage") + '" style="opacity: 0.6;"><\/i><\/div><\/li>'); nf = vu.find(".vis-ad-w-p-s-result").find("span"); au.append(vu).append(at).append(vt).append(tu).append(yt).append(pt); uo() } function uo() { at.on("click", function () { if (t(this).css("opacity") == "1" && (p[0].style.visibility = "visible", h && !ht && rt.show(), lt(!0, 1), b.length > 0)) { for (var n = 0; n < b.length; n++)w2ui["subgrid-" + b[n]].destroy(); b = [] } }); vt.on("click", function () { if (t(this).css("opacity") == "1" && (p[0].style.visibility = "visible", h && !ht && rt.show(), lt(!0, parseInt(g.val()) - 1), b.length > 0)) { for (var n = 0; n < b.length; n++)w2ui["subgrid-" + b[n]].destroy(); b = [] } }); yt.on("click", function () { if (t(this).css("opacity") == "1" && (p[0].style.visibility = "visible", h && !ht && rt.show(), lt(!0, parseInt(g.val()) + 1), b.length > 0)) { for (var n = 0; n < b.length; n++)w2ui["subgrid-" + b[n]].destroy(); b = [] } }); pt.on("click", function () { if (t(this).css("opacity") == "1" && (p[0].style.visibility = "visible", h && !ht && rt.show(), lt(!0, parseInt(g.find("Option:last").val())), b.length > 0)) { for (var n = 0; n < b.length; n++)w2ui["subgrid-" + b[n]].destroy(); b = [] } }); g.on("change", function () { if (p[0].style.visibility = "visible", h && !ht && rt.show(), lt(!0, g.val()), b.length > 0) { for (var n = 0; n < b.length; n++)w2ui["subgrid-" + b[n]].destroy(); b = [] } }) } function fo(n) { var i, o; g = null; tu.find("select").remove(); g = t("<select>"); tu.append(g); g.on("change", function () { p[0].style.visibility = "visible"; h && !ht && rt.show(); lt(!0, g.val()) }); if (n.TotalPage > 0) { for (i = 0; i < n.TotalPage; i++)g.append(t("<option value=" + (i + 1) + ">" + (i + 1) + "<\/option>")); g.val(n.CurrentPage); n.TotalPage > n.CurrentPage ? (yt.css("opacity", "1"), pt.css("opacity", "1")) : (yt.css("opacity", "0.6"), pt.css("opacity", "0.6")); n.CurrentPage > 1 ? (at.css("opacity", "1"), vt.css("opacity", "1")) : (at.css("opacity", "0.6"), vt.css("opacity", "0.6")); n.TotalPage == 1 && (at.css("opacity", "0.6"), vt.css("opacity", "0.6"), yt.css("opacity", "0.6"), pt.css("opacity", "0.6")) } else at.css("opacity", "0.6"), vt.css("opacity", "0.6"), yt.css("opacity", "0.6"), pt.css("opacity", "0.6"); var s = n.CurrentPage, e = n.PageSize, r = n.TotalRecords, u = (s - 1) * e, f = u + e; f > r && (f = r); r == 0 && (u -= 1); o = gf + " " + (u + 1) + "-" + f + " " + ne + " " + r; nf.text(o) } function eo(i) { var r; if (i != null) { var u = 0, f = n.Utility.Util.getValueOfInt(w2ui[a].records[i.recid - 1].M_PRODUCT_ID), e = n.Utility.Util.getValueOfInt(w2ui[a].records[i.recid - 1].M_WAREHOUSE_ID), o = ""; for (r = 0; r < k.length; r++)k[r].Ctrl.colName == "M_AttributeSetInstance_ID" && (u = n.Utility.Util.getValueOfInt(k[r].Ctrl.value)); for (r = 0; r < k.length; r++)k[r].Ctrl.colName == "AttributeCode" && (o = k[r].Ctrl.getValue()); f > 0 && e > 0 && t.ajax({ url: n.Application.contextUrl + "InfoProduct/GetVariants", dataType: "json", type: "POST", async: !1, data: { M_Product_ID: f, M_Warehouse_ID: e, ParentRec_ID: i.recid, M_AttributeSetInstance_ID: u, AttributeCode: o }, error: function () { alert(n.Msg.getMsg("ErrorWhileGettingData")); p[0].style.visibility = "hidden"; return }, success: function (n) { var t = JSON.parse(n); oo(t) } }) } } function oo(n) { n != null && (tf = n) } var uf, hf, cf; this.onClose = null; this.selectedIDs = l; var ut = t("<div>"), yf = !0, yi = t("<div class='vis-info-subroot'>"), pf = null, wf = null, bf = null, pi = null, wi = null, fi = null, ei = null, bi = null, yr = null, pr = null, wr = null, br = null, oi = null, si = null, bt = null, kr = null, dr = null, kt = null, ki = null, rt = null, di = null, dt = null, gr = null, gi = null, p = null, kf = null, k = [], et = null, nt = null, ot = this, nr = "", gt = 0, v = [], nu = [], df = null, a = null, tr = null, ir = null, rr = null, ur = null, fr = null, er = null, or = null, sr = null, hr = null, ni = null, ti = null, fu = null, eu = [], b = [], ou = n.DisplayType.GetNumberFormat(n.DisplayType.Amount), cr = n.Env.isDecimalPoint(), tt = null, it = null, ii = null, hi = null, st = t("<table>"), d = null, bu = null, ku = null, su = null, y = [], w = [], hu = !1, ht = !1, du = /ipad|iphone|ipod/i.test(navigator.userAgent.toLowerCase()), ri = !1, ci = 0, lr = null, gu = null, cu = null, lu, au, at, vt, tu, yt, pt, g, vu, nf = null, gf = n.Msg.getMsg("ShowingResult"), ne = n.Msg.getMsg("of"), iu, li = 0, ru = 0, ar = 0, vr = 0, ft = 500, wt = [], ai = [], tf = [], te = [], ct = []; ie(); ue(u, f); uf = n.context.getWindowTabContext(r, 0, "AD_Tab_ID"); gt = n.dataContext.getJSONRecord("InfoProduct/GetWindowID", uf.toString()); gt == 146 || n.context.getContextAsInt(r, n.context.getWindowTabContext(r, 1, "KeyColumnName")) != 0 && (ht = !0); (!h || ht) && (rt.hide(), kt.hide(), dr.hide(), ki.hide()); re(); var ye = function () { ri = !1; ci = 0; var t = new n.InfoScanForm(r, !1); t.showDialog(); t.onClose = function (t, i, u) { var l, f, e, c, k; if (p[0].style.visibility = "visible", ri = i, ci = u, l = n.Env.getCtx().getContext("#AD_Session_ID"), t && t.length > 0) for (f in t) { var a = "", v = "", o = 0, s = t[f].M_AttributeSetInstance_ID, w = t[f].Description, d = t[f].VAICNT_InventoryCountLine_ID, h = t[f].VAICNT_Quantity, b = t[f].M_Product_ID, g = t[f].Value; a = t[f].Name; v = t[f].UOM; o = t[f].C_UOM_ID; e = t[f].VAICNT_ReferenceNo; e == "" && (e = "null"); c = t[f].LineID; h > 0 && (y.length > 0 ? (k = y.map(function (n) { return n._prdID == b && n._Attribute == s && n._uom == o && n._refLineID == c }).indexOf(!0), k > -1 ? y[k]._prodQty += h : y.push({ _prodQty: h, _prdID: b, _prdName: a, _value: g, _uom: o, _uomName: v, _AD_Session_ID: l, _windowNo: r, _RefNo: e, _Attribute: s, _AttributeName: w, _Locator_ID: 0, _IsLotSerial: "N", _countID: d, _refLineID: c })) : y.push({ _prodQty: h, _prdID: b, _prdName: a, _value: g, _uom: o, _uomName: v, _AD_Session_ID: l, _windowNo: r, _RefNo: e, _Attribute: s, _AttributeName: w, _Locator_ID: 0, _IsLotSerial: "N", _countID: d, _refLineID: c }), nu[s] = w) } pu() } }, pe = function () { if (p[0].style.visibility = "visible", no(), lt(!0, g.val()), b.length > 0) { for (var n = 0; n < b.length; n++)w2ui["subgrid-" + b[n]].destroy(); b = [] } y.length > 0 ? kt.prop("disabled", !1) : kt.prop("disabled", !0); v = [] }, pu = function () { var i = [], r = [], u = [], f = [], e = [], o = [], s = [], h = [], c = [], t, n; w = []; rt.hide(); for (t in y) i.push(y[t]._prdID), f.push(y[t]._prdName), r.push(y[t]._value), u.push(y[t]._prodQty), c.push(y[t]._RefNo), s.push(y[t]._Attribute), h.push(y[t]._AttributeName), e.push(y[t]._uom), o.push(y[t]._uomName); if (i.length > 0) { for (n = 0; n < i.length; n++)w.push({ SrNo: n, Product: f[n], Value: r[n], QtyEntered: u[n], UOM_ID: e[n], UOM: o[n], M_Product_ID1: i[n], Attribute: s[n], AttributeName: h[n], RefNo: c[n] }); be() } p[0].style.visibility = "hidden" }; hf = function () { var n, r, i, f, e, u; if (p[0].style.visibility = "visible", h && y.length > 0 && rt.css("display") == "none") { if (v = [], n = w2ui[a].getSelection(), r = y, n.length > 0) { for (r = [], i = 0; i < n.length; i++)f = w2ui[a].records[n[i] - 1].ProdID, e = w2ui[a].records[n[i] - 1].Attribute, r.push(t.grep(y, function (n) { return n._prdID == f && n._Attribute == e })[0]); y = r } lf(y) } else if (h && w2ui[a].getSelection().length > 1 && rt.css("display") == "block") ct = cf(), lf(ct); else { v = []; u = w2ui[a].getSelection(); for (item in u) v.indexOf(w2ui[a].get(u[item])[nr]) == -1 && v.push(w2ui[a].get(u[item])[nr]); p[0].style.visibility = "hidden"; ot.onClose != null && ot.onClose(); uu() } }; cf = function () { var i = w2ui[a].getSelection(), u, t, e, o, f; if (i.length > 0) for (u = [], t = 0; t < i.length; t++)w2ui[a].records[i[t] - 1].QTYENTERED > 0 && (e = w2ui[a].records[i[t] - 1].M_PRODUCT_ID, o = w2ui[a].records[i[t] - 1].M_AttributeSetInstance_ID, u.length > 0 ? (f = u.map(function (n) { return n._prdID == e && n._Attribute == o }).indexOf(!0), f > -1 ? u[f]._prodQty += qty : u.push({ _prodQty: w2ui[a].records[i[t] - 1].QTYENTERED, _prdID: w2ui[a].records[i[t] - 1].M_PRODUCT_ID, _prdName: w2ui[a].records[i[t] - 1].NAME, _value: w2ui[a].records[i[t] - 1].NAME, _uom: w2ui[a].records[i[t] - 1].C_UOM_ID, _uomName: w2ui[a].records[i[t] - 1].UOM, _AD_Session_ID: n.Env.getCtx().getContext("#AD_Session_ID"), _windowNo: r, _RefNo: "", _Attribute: w2ui[a].records[i[t] - 1].M_AttributeSetInstance_ID, _AttributeName: "", _Locator_ID: 0, _IsLotSerial: "N", _countID: 0 })) : u.push({ _prodQty: w2ui[a].records[i[t] - 1].QTYENTERED, _prdID: w2ui[a].records[i[t] - 1].M_PRODUCT_ID, _prdName: w2ui[a].records[i[t] - 1].NAME, _value: w2ui[a].records[i[t] - 1].NAME, _uom: w2ui[a].records[i[t] - 1].C_UOM_ID, _uomName: w2ui[a].records[i[t] - 1].UOM, _AD_Session_ID: n.Env.getCtx().getContext("#AD_Session_ID"), _windowNo: r, _RefNo: "", _Attribute: w2ui[a].records[i[t] - 1].M_AttributeSetInstance_ID, _AttributeName: "", _Locator_ID: 0, _IsLotSerial: "N", _countID: 0 })); return u }; this.show = function () { t.ajax({ url: n.Application.contextUrl + "InfoProduct/GetInfoColumns", dataType: "json", error: function () { alert(n.Msg.getMsg("ERRORGettingSearchCols")); p[0].style.visibility = "hidden" }, success: function (t) { if (et = jQuery.parseJSON(t), et == null) { alert(n.Msg.getMsg("ERRORGettingSearchCols")); p[0].style.visibility = "hidden"; return } ut.dialog({ width: 1020, height: 500, title: n.Msg.translate(n.Env.getCtx(), "InfoProduct"), resizable: !1, modal: !0, closeText: n.Msg.getMsg("close"), close: ke }); c != null && c.length > 0 && (lr = n.Env.parseContext(n.Env.getCtx(), r, c, !1, !1)); lt(!0, g.val()) } }) }; var lt = function (i, r) { var l, y, e, u, w, s, c; if (h && w2ui[a]) { l = w2ui[a].getSelection(); for (e in l) v.indexOf(w2ui[a].get(l[e])[nr]) == -1 && (v.push(w2ui[a].get(l[e])), ui(!1)) } else ui(!0); i && ui(!0); ge(); y = 0; for (e in et) y = et[e].AD_Reference_ID, y == n.DisplayType.ID && et[e].ColumnName.toUpperCase() == "M_PRODUCT_ID" && (nr = et[e].ColumnName.toUpperCase()); if (i == !0) { var f = null; for (u = 0; u < k.length; u++) { if (f = k[u].Ctrl.getValue(), f == null || f.length == 0 || f == 0 || !f) { k[u].Value = ""; continue } k[u].Value = f; k[u].CtrlColumnName = k[u].Ctrl.colName; k[u].Ctrl.displayType == 10 && (f = n.DB.to_string(f)) } } if (r || (r = 1), w = [], k && Object.keys(k).length > 0) for (s = 0; s < Object.keys(k).length; s++)c = {}, c.CtrlColumnName = k[s].CtrlColumnName, c.ColumnName = k[s].ColumnName, c.Value = k[s].Value, w.push(c); t.ajax({ url: n.Application.contextUrl + "InfoProduct/GetData", dataType: "json", type: "POST", data: { tableName: o, pageNo: r, ForMobile: du, Requery: i, SrchCtrl: JSON.stringify(w), Validation: n.secureEngine.encrypt(lr), Window_ID: gt }, error: function () { alert(n.Msg.getMsg("ErrorWhileGettingData")); p[0].style.visibility = "hidden"; return }, success: function (t) { var i = JSON.parse(t); if (i == null) { p[0].style.visibility = "hidden"; return } if (i.Error) { n.ADialog.error(i.Error); p[0].style.visibility = "hidden"; return } fo(i.pSetting); de(i.data) } }) }, de = function (i) { var r, o, s, f; if (i == null) { alert(n.Msg.getMsg("NoDataFound")); p[0].style.visibility = "hidden"; return } var e = [], c = [], u = null; for (f in i) r = { resizable: !0 }, u = et[f].AD_Reference_ID, r.caption = et[f].Name, r.field = et[f].ColumnName.toUpperCase(), r.columnName = et[f].ColumnName.toUpperCase(), r.sortable = !0, r.hidden = !1, r.size = "100px", n.DisplayType.IsNumeric(u) ? (r.render = u == n.DisplayType.Integer ? "int" : function (t, i, r) { var u = n.Utility.Util.getValueOfDecimal(t[e[r].field]); return u.toLocaleString(undefined, { minimumFractionDigits: 2 }) }, et[f].ColumnName.toUpperCase() == "QTYENTERED" && h && !ht && (r.editable = { type: "number" }, r.render = function (n, t, i) { var r = n[e[i].field]; return r = ff(event, r), parseFloat(r).toLocaleString(undefined, { minimumFractionDigits: 2 }) })) : n.DisplayType.IsDate(u) ? r.render = function (n, t, i) { var r = n[e[i].field]; return r ? new Date(r).toLocaleDateString() : "" } : u == n.DisplayType.Location || u == n.DisplayType.Locator ? r.render = "int" : u == n.DisplayType.Account ? r.render = "int" : u == n.DisplayType.PAttribute ? r.render = "int" : u == n.DisplayType.Button ? r.render = function () { return "<div>button<\/div>" } : u == n.DisplayType.Image ? r.render = function () { return "<div>Image<\/div>" } : n.DisplayType.IsLOB(u) && (r.render = function () { return "<div>[Lob-blob]<\/div>" }), e[f] = r; for (e[e.length] = { field: "M_AttributeSetInstance_ID", caption: "M_AttributeSetInstance_ID", size: "150px", hidden: !0 }, o = 0; o < i[0].RowCount; o++) { s = {}; for (f in i) s[i[f].ColumnName.toUpperCase()] = i[f].Values[o]; s.M_AttributeSetInstance_ID = 0; s.recid = o + 1; c[o] = s } !h && (v.length > 0 || w2ui[a] && w2ui[a].getSelection().length > 0) && ui(!0); a = "gridPrdInfodata" + Math.random(); a = a.replace(".", ""); w2utils.encodeTags(c); nt = t(fi).w2grid({ name: a, recordHeight: 40, show: { toolbar: !1, columnHeaders: !0, lineNumbers: !1, selectColumn: !0, toolbarReload: !1, toolbarColumns: !0, toolbarSearch: !1, toolbarAdd: !1, toolbarDelete: !1, toolbarSave: !1, selectionBorder: !1, recordTitles: !1 }, columns: e, records: c, onExpand: function (n) { p[0].style.visibility = "visible"; eo(n); w2ui.hasOwnProperty("subgrid-" + n.recid) && w2ui["subgrid-" + n.recid].destroy(); b.indexOf(n.recid) == -1 && b.push(n.recid); t("#" + n.box_id).css({ margin: "0px", padding: "0px", width: "100%", height: "105px" }); setTimeout(function () { t("#" + n.box_id).w2grid({ name: "subgrid-" + n.recid, show: { columnHeaders: !0, selectColumn: !0 }, fixedBody: !0, columns: eu, records: tf, onChange: function (n) { var u = -1, f = w2ui[n.target].records[n.index].ParentRec_ID, i, r, t; if (v.length > 0) { for (i in v) if (v[i].M_PRODUCT_ID == w2ui[a].records[f - 1].M_PRODUCT_ID && v[i].M_AttributeSetInstance_ID == w2ui[n.target].records[n.index].M_AttributeSetInstance_ID) { u = i; break } u > -1 ? v[u].QTYENTERED = n.value_new : (r = w2ui[a].records[f - 1], t = JSON.parse(JSON.stringify(r)), t.M_AttributeSetInstance_ID = w2ui[n.target].records[n.index].M_AttributeSetInstance_ID, t.QTYENTERED = n.value_new, v.push(t)) } else r = w2ui[a].records[f - 1], t = JSON.parse(JSON.stringify(r)), t.M_AttributeSetInstance_ID = w2ui[n.target].records[n.index].M_AttributeSetInstance_ID, t.QTYENTERED = n.value_new, v.push(t) } }); w2ui["subgrid-" + n.recid].resize(); p[0].style.visibility = "hidden" }, 500) }, onEditField: function (n) { if (id = n.recid, n.column == 5) { w2ui[a].records[n.index].QTYENTERED = ff(n, w2ui[a].records[n.index].QTYENTERED); var i = ou.GetFormatAmount(w2ui[a].records[n.index].QTYENTERED, "init", cr); w2ui[a].records[n.index].QTYENTERED = ou.GetConvertedString(i, cr); t("#grid_" + nt.name + "_rec_" + id).keydown(function (n) { if (cr || n.keyCode != 190 && n.keyCode != 110) { if (cr && n.keyCode == 188) return !1 } else return !1; return n.target.value.contains(".") && (n.which == 110 || n.which == 190 || n.which == 188) ? n.target.value.indexOf(".") > -1 && (n.target.value = n.target.value.replace(".", "")) : n.target.value.contains(",") && (n.which == 110 || n.which == 190 || n.which == 188) && n.target.value.indexOf(",") > -1 && (n.target.value = n.target.value.replace(",", "")), n.keyCode != 8 && n.keyCode != 9 && (n.keyCode < 37 || n.keyCode > 40) && (n.keyCode < 48 || n.keyCode > 57) && (n.keyCode < 96 || n.keyCode > 105) && n.keyCode != 109 && n.keyCode != 189 && n.keyCode != 110 && n.keyCode != 144 && n.keyCode != 188 && n.keyCode != 190 ? !1 : void 0 }) } }, onChange: function (n) { var i = -1, r = ou.GetConvertedNumber(n.value_new, cr), t; if (w2ui[a].records[n.index].QTYENTERED = r.toFixed(2), v.length > 0) { for (t in v) if (v[t].M_PRODUCT_ID == w2ui[a].records[n.index].M_PRODUCT_ID && v[t].M_AttributeSetInstance_ID == 0) { i = t; break } i > -1 ? v[i].QTYENTERED = r.toFixed(2) : v.push(w2ui[a].records[n.index]) } else v.push(w2ui[a].records[n.index]) }, onSelect: ef, onUnselect: of }); w2ui[a].hideColumn("M_PRODUCT_ID"); w2ui[a].hideColumn("C_UOM_ID"); w2ui[a].hideColumn("UOM"); w2ui[a].hideColumn("M_WAREHOUSE_ID"); w2ui[a].hideColumn("M_PRICELIST_VERSION_ID"); (!h || ht) && w2ui[a].hideColumn("QTYENTERED"); p[0].style.visibility = "hidden" }, ge = function () { nt != null && nt.destroy(); nt = null }; this.getSelectedValues = function () { return v }; this.getRefreshStatus = function () { return hu }; var no = function () { if (h && (v.length > 0 || w2ui[a].getSelection().length > 0)) to(); else return }, to = function () { var i, c, u, o, s, l, e, t, h, f; if (w2ui[a].getSelection().length > 0) { i = w2ui[a].getSelection(); for (t in i) if (c = w2ui[a].get(i[t]).M_PRODUCT_ID, u = "subgrid-" + w2ui[a].get(i[t]).recid, w2ui[u] != undefined) if (w2ui[u].getSelection().length > 0) { o = w2ui[u].getSelection(); for (s in o) if (v.length > 0) if (f = v.map(function (n) { return n.M_PRODUCT_ID == c && n.M_AttributeSetInstance_ID == w2ui[u].records[o[s] - 1].M_AttributeSetInstance_ID }).indexOf(!0), f > -1) continue; else l = w2ui[a].get(i[t]), e = JSON.parse(JSON.stringify(l)), e.M_AttributeSetInstance_ID = w2ui[u].records[o[s] - 1].M_AttributeSetInstance_ID, e.QTYENTERED = w2ui[u].records[o[s] - 1].Quantity, v.push(e); else l = w2ui[a].get(i[t]), e = JSON.parse(JSON.stringify(l)), e.M_AttributeSetInstance_ID = w2ui[u].records[o[s] - 1].M_AttributeSetInstance_ID, e.QTYENTERED = w2ui[u].records[o[s] - 1].Quantity, v.push(e) } else if (v.length > 0) if (f = v.map(function (n) { return n.M_PRODUCT_ID == c && n.M_AttributeSetInstance_ID == 0 }).indexOf(!0), f > -1) continue; else v.push(w2ui[a].get(i[t])); else v.push(w2ui[a].get(i[t])); else if (v.length > 0) if (f = v.map(function (n) { return n.M_PRODUCT_ID == c && n.M_AttributeSetInstance_ID == 0 }).indexOf(!0), f > -1) continue; else v.push(w2ui[a].get(i[t])); else v.push(w2ui[a].get(i[t])) } if (v.length > 0) for (t in v) h = v[t].QTYENTERED, h > 0 && (y.length > 0 ? (f = y.map(function (n) { return n._prdID == v[t].M_PRODUCT_ID && n._Attribute == v[t].M_AttributeSetInstance_ID }).indexOf(!0), f > -1 ? y[f]._prodQty += h : y.push({ _prodQty: h, _prdID: v[t].M_PRODUCT_ID, _prdName: v[t].NAME, _value: v[t].VALUE, _uom: v[t].C_UOM_ID, _uomName: v[t].UOM, _AD_Session_ID: n.Env.getCtx().getContext("#AD_Session_ID"), _windowNo: r, _RefNo: "", _Attribute: v[t].M_AttributeSetInstance_ID, _AttributeName: "", _Locator_ID: 0, _IsLotSerial: "N", _countID: 0 })) : y.push({ _prodQty: h, _prdID: v[t].M_PRODUCT_ID, _prdName: v[t].NAME, _value: v[t].VALUE, _uom: v[t].C_UOM_ID, _uomName: v[t].UOM, _AD_Session_ID: n.Env.getCtx().getContext("#AD_Session_ID"), _windowNo: r, _RefNo: "", _Attribute: v[t].M_AttributeSetInstance_ID, _AttributeName: "", _Locator_ID: 0, _IsLotSerial: "N", _countID: 0 })) }, uu = function () { if (ut.off("keyup"), di.off("click"), dt.off("click"), gi.off("click"), at.off("click"), vt.off("click"), yt.off("click"), pt.off("click"), g.off("change"), at = vt = yt = pt = g = null, fi = null, wi = null, nt != null && nt.destroy(), nt = null, yf = null, yi = null, pf = null, wf = null, bf = null, pi = null, wi = null, fi = null, ei = null, bi = null, oi = null, si = null, bt = null, di = null, dt = null, gr = null, gi = null, ki = null, p = null, kf = null, k = null, et = null, nt = null, ot = null, nr = null, v = null, df = null, y = null, w = null, hu = !1, du = null, ri = null, ut != null && (ut.dialog("destroy"), ut.remove()), ut = null, this.btnOKClick = null, this.displaySearchCol = null, this.displayData = null, this.loadData = null, this.disposeComponent = null, this.disposeDataSec = null, this.getSelectedValues = null, this.refreshUI = null, b.length > 0) { for (var n = 0; n < b.length; n++)w2ui["subgrid-" + b[n]].destroy(); b = [] } } } n.infoProduct = i }(VIS, jQuery), function (n, t) { function i(i, r) { function ui() { var r, a; h.css("width", "100%"); h.css("height", "100%"); h.css("position", "relative"); ot.css("width", "100%"); it = t("<div class='vis-info-l-s-wrap vis-pad-0 vis-leftsidebarouterwrap'>"); yt = t("<div class='vis-info-l-s-content'>"); it.append(yt); pt = t("<div class='vis-info-datasec'>"); g = t("<div class='vis-info-btnsec vis-just-cont-end'>"); st.append(it); st.append(pt); st.append(g); lt = n.Msg.translate(n.Env.getCtx(), "Name"); lt.indexOf("&") > -1 && (lt = lt.replace("&", "")); wt = n.Msg.translate(n.Env.getCtx(), "ReferenceNo"); wt.indexOf("&") > -1 && (wt = lblUPCtxt.replace("&", "")); at = n.Msg.translate(n.Env.getCtx(), "FromDate"); at.indexOf("&") > -1 && (at = at.replace("&", "")); vt = n.Msg.translate(n.Env.getCtx(), "ToDate"); vt.indexOf("&") > -1 && (vt = vt.replace("&", "")); ut = n.Msg.getMsg("Cancel"); ut.indexOf("&") > -1 && (ut = ut.replace("&", "")); rt = n.Msg.getMsg("Search"); rt.indexOf("&") > -1 && (rt = rt.replace("&", "")); ft = n.Msg.getMsg("Ok"); ft.indexOf("&") > -1 && (ft = ft.replace("&", "")); v = t("<div class='vis-info-btnswrap'>"); ht = t("<div class='vis-info-ls-btnswrap'>"); l = t("<tr>"); ot.append(l); var f = t("<td>"), o = t('<div class="input-group vis-input-wrap">'), u = t('<div class="vis-control-wrap">'); nt = t("<label class='VIS_Pref_Label_Font'>").append(lt); l.append(f); f.append(o); o.append(u); r = {}; c = new n.Controls.VTextBox("Name", !1, !1, !0, 50, 100, null, null, !1); r.Ctrl = c; r.AD_Reference_ID = 10; r.ColumnName = "Name"; a = t("<td>"); u.append(c.getControl().attr("data-placeholder", "").attr("placeholder", " ")); u.append(nt); s.push(r); l = t("<tr>"); ot.append(l); var f = t("<td>"), o = t('<div class="input-group vis-input-wrap">'), u = t('<div class="vis-control-wrap">'); nt = t("<label class='VIS_Pref_Label_Font'>").append(wt); l.append(f); f.append(o); o.append(u); r = {}; c = new n.Controls.VTextBox("Reference", !1, !1, !0, 50, 100, null, null, !1); r.Ctrl = c; r.AD_Reference_ID = 10; r.ColumnName = "Reference"; a = t("<td>"); u.append(c.getControl().attr("data-placeholder", "").attr("placeholder", " ")); u.append(nt); s.push(r); l = t("<tr>"); ot.append(l); var f = t("<td>"), o = t('<div class="input-group vis-input-wrap">'), u = t('<div class="vis-control-wrap">'); nt = t("<label class='VIS_Pref_Label_Font'>").append(at); l.append(f); f.append(o); o.append(u); r = {}; c = new n.Controls.VDate("TrxFromDate", !1, !1, !0, n.DisplayType.Date, n.Msg.translate("FromDate")); r.Ctrl = c; r.AD_Reference_ID = 10; r.ColumnName = "TrxFromDate"; a = t("<td>"); u.append(c.getControl().attr("data-placeholder", "").attr("placeholder", " ")); u.append(nt); s.push(r); l = t("<tr>"); ot.append(l); var f = t("<td>"), o = t('<div class="input-group vis-input-wrap">'), u = t('<div class="vis-control-wrap">'); nt = t("<label class='VIS_Pref_Label_Font'>").append(vt); l.append(f); f.append(o); o.append(u); r = {}; c = new n.Controls.VDate("TrxToDate", !1, !1, !0, n.DisplayType.Date, n.Msg.translate("ToDate")); r.Ctrl = c; r.AD_Reference_ID = 10; r.ColumnName = "TrxToDate"; a = t("<td>"); u.append(c.getControl().attr("data-placeholder", "").attr("placeholder", " ")); u.append(nt); s.push(r); yt.append(ot); et = t("<button class='VIS_Pref_btn-2'>").append(ut); tt = t("<button class='VIS_Pref_btn-2'>").append(ft); ct = t("<button class='VIS_Pref_btn-2'>").append(rt); v.append(et); v.append(tt); v.append(t('<div><input type="checkbox" id="chkDelCart_' + i + '" ><span>' + n.Msg.getMsg("DeleteCart") + "<\/span>")); ht.append(ct); it.append(ht); g.append(v); dt = t('<div class="vis-info-pagingwrp">'); si(); dt.append(gt); v.append(et); v.append(tt); ht.append(ct); it.append(ht); g.append(ni); g.append(dt); g.append(v); e = t('<div class="vis-busyindicatorouterwrap"><div class="vis-busyindicatorinnerwrap"><i class="vis-busyindicatordiv"><\/i><\/div><\/div>'); e[0].style.visibility = "visible"; kt = g.find("#chkDelCart_" + i); h.append(st); h.append(e) } function fi() { if (!n.Application.isMobile) h.on("keyup", function (n) { n.keyCode === 13 && (e[0].style.visibility = "visible", o = [], u.selectNone(), d(!0, f.val())) }); et.on("click", function () { a.dispose() }); tt.on("click", function () { oi() }); ct.on("click", function () { e[0].style.visibility = "visible"; o = []; u.selectNone(); d(!0, 1) }) } function si() { gt = t('<ul class="vis-statusbar-ul">'); p = t('<li style="opacity: 1;"><div><i class="vis vis-shiftleft" title="First Page" style="opacity: 0.6;"><\/i><\/div><\/li>'); w = t('<li style="opacity: 1;"><div><i class="vis vis-pageup" title="Page Up" style="opacity: 0.6;"><\/i><\/div><\/li>'); f = t("<select>"); bt = t("<li>").append(f); b = t('<li style="opacity: 1;"><div><i class="vis vis-pagedown" title="Page Down" style="opacity: 0.6;"><\/i><\/div><\/li>'); k = t('<li style="opacity: 1;"><div><i class="vis vis-shiftright" title="Last Page" style="opacity: 0.6;"><\/i><\/div><\/li>'); gt.append(p).append(w).append(bt).append(b).append(k); hi() } function hi() { p.on("click", function () { t(this).css("opacity") == "1" && (e[0].style.visibility = "visible", d(!0, 1)) }); w.on("click", function () { t(this).css("opacity") == "1" && (e[0].style.visibility = "visible", d(!0, parseInt(f.val()) - 1)) }); b.on("click", function () { t(this).css("opacity") == "1" && (e[0].style.visibility = "visible", d(!0, parseInt(f.val()) + 1)) }); k.on("click", function () { t(this).css("opacity") == "1" && (e[0].style.visibility = "visible", d(!0, parseInt(f.find("Option:last").val()))) }); f.on("change", function () { e[0].style.visibility = "visible"; d(!0, f.val()) }) } function ci(n) { f = null; bt.find("select").remove(); f = t("<select>"); bt.append(f); f.on("change", function () { e[0].style.visibility = "visible"; d(!0, f.val()) }); if (n.TotalPage > 0) { for (var i = 0; i < n.TotalPage; i++)f.append(t("<option value=" + (i + 1) + ">" + (i + 1) + "<\/option>")); f.val(n.CurrentPage); n.TotalPage > n.CurrentPage ? (b.css("opacity", "1"), k.css("opacity", "1")) : (b.css("opacity", "0.6"), k.css("opacity", "0.6")); n.CurrentPage > 1 ? (p.css("opacity", "1"), w.css("opacity", "1")) : (p.css("opacity", "0.6"), w.css("opacity", "0.6")); n.TotalPage == 1 && (p.css("opacity", "0.6"), w.css("opacity", "0.6"), b.css("opacity", "0.6"), k.css("opacity", "0.6")) } else p.css("opacity", "0.6"), w.css("opacity", "0.6"), b.css("opacity", "0.6"), k.css("opacity", "0.6") } this.onClose = null; this.arrListColumns = []; var h = t("<div>"), ti = !0, st = t("<div class='vis-info-subroot'>"), it = null, yt = null, pt = null, g = null, rt = null, ut = null, ft = null, v = null, ht = null, et = null, tt = null, ct = null, kt = null, ni = null, e = null, u = null, a = this, y = 0, lt = null, wt = null, at = null, vt = null, nt = null, c = null, ot = t("<table>"), l = null, ii = !1, s = [], dt, gt, p, w, bt, b, k, f, o = [], li = /ipad|iphone|ipod/i.test(navigator.userAgent.toLowerCase()), ri = n.context.getWindowTabContext(i, 0, "AD_Tab_ID"); y = n.dataContext.getJSONRecord("InfoProduct/GetWindowID", ri.toString()); ui(); fi(); var d = function (f, h) { var v, l, c, k, a, w; if (u) { v = u.getSelection(); for (item in v) o.indexOf(u.get(v[item]).count_ID) == -1 && o.push(u.get(v[item]).count_ID) } var d = 0, g = 0, p = 0, nt = 0, b = 0; if (f == !0) { for (l = null, c = 0; c < s.length; c++) { if (l = s[c].Ctrl.getValue(), l == null || l.length == 0 || l == 0) { s[c].Value = ""; continue } s[c].Value = l; s[c].CtrlColumnName = s[c].Ctrl.colName } y == 184 ? b = n.Utility.Util.getValueOfInt(n.context.getWindowTabContext(i, 0, "C_BPartner_ID")) : y == 319 || y == 170 ? (d = n.Utility.Util.getValueOfInt(n.context.getWindowContext(i, "M_Locator_ID", !0)), g = n.Utility.Util.getValueOfInt(n.context.getWindowContext(i, "M_LocatorTo_ID", !0)), p = n.Utility.Util.getValueOfInt(n.context.getWindowContext(i, "DTD001_MWarehouseSource_ID", !0)), nt = n.Utility.Util.getValueOfInt(n.context.getWindowContext(i, "M_Warehouse_ID", !0))) : y == 168 ? p = n.Utility.Util.getValueOfInt(n.context.getWindowContext(i, "M_Warehouse_ID", !0)) : y == 169 ? b = n.context.getWindowTabContext(i, 0, "C_BPartner_ID") : y == 341 && (p = n.Utility.Util.getValueOfInt(n.context.getWindowContext(i, "M_Warehouse_ID", !0))) } if (h || (h = 1), k = [], s && Object.keys(s).length > 0) for (a = 0; a < Object.keys(s).length; a++)w = {}, w.CtrlColumnName = s[a].CtrlColumnName, w.Value = s[a].Value, k.push(w); t.ajax({ url: n.Application.contextUrl + "InfoProduct/GetCart", dataType: "json", data: { pageNo: h, isCart: r, windowID: y, WarehouseID: p, WarehouseToID: nt, LocatorID: d, LocatorToID: g, BPartnerID: b, srchCtrl: JSON.stringify(k), requery: f }, error: function () { alert(n.Msg.getMsg("ErrorWhileGettingData")); e[0].style.visibility = "hidden"; return }, success: function (t) { var i = JSON.parse(t); if (i == null) { e[0].style.visibility = "hidden"; return } if (i.Error) { n.ADialog.error(i.Error); e[0].style.visibility = "hidden"; return } ci(i.pSetting); ei(i.data) } }) }, ei = function (i) { if (i == null) { e[0].style.visibility = "hidden"; return } u != null && (u.destroy(), u = null); u = null; a.arrListColumns = []; a.arrListColumns.push({ field: "Name", caption: n.Msg.translate(n.Env.getCtx(), "Name"), sortable: !0, size: "16%", min: 150, hidden: !1 }); a.arrListColumns.push({ field: "Reference", caption: n.Msg.translate(n.Env.getCtx(), "ReferenceNo"), sortable: !0, size: "16%", min: 150, hidden: !1 }); a.arrListColumns.push({ field: "TrxDate", caption: n.Msg.translate(n.Env.getCtx(), "DateTrx"), sortable: !0, size: "16%", min: 150, hidden: !1, render: "date" }); a.arrListColumns.push({ field: "count_ID", caption: n.Msg.translate(n.Env.getCtx(), "ID"), sortable: !0, size: "16%", min: 150, hidden: !0 }); var r = "gridPrdInfodata" + Math.random(); r = r.replace(".", ""); w2utils.encodeTags(i); u = t(pt).w2grid({ name: r, recordHeight: 30, show: { columnHeaders: !0, lineNumbers: !0, selectColumn: !0 }, columns: a.arrListColumns, records: i, onClick: function () { u.records.length > 0 && tt.removeAttr("disabled") } }); u.selectNone(); for (itm in o) for (item in u.records) u.records[item].count_ID == o[itm] && u.select(parseInt(item) + 1); u.on("unselect", function (n) { if (n.all) n.onComplete = function () { for (item in u.records) { var n = u.records[item].count_ID; o.indexOf(n) > -1 && o.splice(o.indexOf(n), 1) } }; else { var t = u.records[n.index].count_ID; o.indexOf(t) > -1 && o.splice(o.indexOf(t), 1) } }); e[0].style.visibility = "hidden" }, oi = function () { var t = "", i, r, f; if (u != null) { if (i = u.getSelection(), i.length > 0) for (r in i) o.indexOf(u.get(i[r]).count_ID) == -1 && o.push(u.get(i[r]).count_ID); if (o.length > 0) { for (r in o) t += o[r] + ","; if (t = t.substr(0, t.length - 1), f = n.dataContext.getJSONData(n.Application.contextUrl + "InfoProduct/GetCartData", { invCount_ID: t, WindowID: y }, null), a.onClose) a.onClose(f, kt.prop("checked"), t); h.dialog("close") } else alert("Please Select a Record") } }; this.showDialog = function () { h.dialog({ modal: !0, title: n.Msg.translate(n.Env.getCtx(), "Info Scan"), width: 800, height: 450, resizable: !1, close: function () { a.dispose() } }); d(!1, f.val()) }; this.disposeComponent = function () { h.off("keyup"); et.off("click"); tt.off("click"); ct.off("click"); pt = null; yt = null; p.off("click"); w.off("click"); b.off("click"); k.off("click"); f.off("change"); p = w = b = k = f = null; u != null && u.destroy(); u = null; ti = null; st = null; it = null; g = null; rt = null; ut = null; ft = null; v = null; et = null; tt = null; kt = null; ni = null; e = null; s = null; a = null; ii = !1; h != null && (h.dialog("destroy"), h.remove()); h = null; this.displayData = null; this.disposeComponent = null } } i.prototype.dispose = function () { this.disposeComponent() }; n.InfoScanForm = i }(VIS, jQuery), function (n, t) { function i(i, r, u, f, e, o, s, h, c) { function oi() { g.empty(); g = null; dt.empty(); dt = null; nt.empty(); nt = null; l = null; y = null; p = null; w = null; b = null; st = null; ft = null; et = null; tt = null; it = null; rt = null; ut = null; v = null; st = null; k = null; progresBar = null; d = null; ot != null && (ot.dialog("destroy"), ot.remove()); ot = null } function vi() { ct.onClose && ct.onClose(); oi() } function si() { ei || (v[0].style.visibility = "visible", t.ajax({ url: n.Application.contextUrl + "Attachment/GetAttachment", dataType: "json", data: { AD_Table_ID: u, Record_ID: f }, error: function () { n.ADialog.info("ERRORGettingAttachment"); v[0].style.visibility = "hidden" }, success: function (i) { var u = i.result.FLocation, f = i.result.Attachment, e, a, y, st, fi, o, h, p, w, b, l, it, lt, rt, at, ut, vt, ft, wt, kt, gt, ni, et, ti, ii; if (u == null) { n.ADialog.info("ERRORGettingAttachment"); v[0].style.visibility = "hidden"; return } e = t("<div class='vis-latest-attachments'>"); c || tt.append(e); a = t("<div class='vis-attach-top'>"); e.append(a); var ri = t("<div class='vis-attach-file-location'>"), ui = t("<div class='input-group vis-input-wrap' style='margin-bottom: 0;'>"), ot = t("<div class='vis-control-wrap'>"); a.append(ri); ri.append(ui); ui.append(ot); yt = t('<select class="vis-custom-select">'); yt.attr("disabled", !0); for (y in u.values) st = t("<option value=" + u.values[y].Key + ">"), st.append(u.values[y].Name), yt.append(st), u.selectedvalue == u.values[y].Key && yt.val(u.selectedvalue); ot.append(yt); fi = t("<label>").append(n.Msg.getMsg("FileLocation")); ot.append(fi); o = t("<div class='vis-attach-top-btns'>"); a.append(o); h = t("<input type='file' multiple='true' style='display:none;'>"); o.append(h); h.change(function () { pi(this) }); h.click(function () { this.value = null }); p = t("<a title='" + n.Msg.getMsg("SelectFile") + "' class='vis-attach-ico'><i class='fa fa-paperclip' style='font-size: 35px; color: rgba(var(--v-c-primary),1)' aria-hidden='true'><\/i><\/a>"); o.append(p); p.on("click", function () { ht.endsWith("_ver") || h.trigger("click") }); s && p.hide(); w = t("<div class='vis-dropdown pull-left'>"); o.append(w); b = t("<a class='vis-btn vis-btn-arrange vis-dropdown-toggle' type='button' data-toggle='dropdown' style='color: #fff;display:none;'>"); b.append(n.Msg.getMsg("Arrange")); b.append(t("<span class='vis-caret'>")); w.append(b); l = t("<ul class='dropdown-menu' role='menu' aria-labelledby='dropdownMenu1' id='dropdownMenu' style='margin-left: -33px;'>"); w.append(l); it = t("<li role='presentation'>"); lt = t("<a role='menuitem' tabindex='-1' href='#'>"); lt.append(n.Msg.getMsg("Type")); it.append(lt); it.on("click", function () { }); l.append(it); rt = t("<li role='presentation'>"); at = t("<a role='menuitem' tabindex='-1' href='#'>"); at.append(n.Msg.getMsg("Size")); rt.append(at); rt.on("click", function () { }); l.append(rt); ut = t("<li role='presentation'>"); vt = t("<a role='menuitem' tabindex='-1' href='#'>"); vt.append(n.Msg.getMsg("Name")); ut.append(vt); ut.on("click", function () { }); l.append(ut); g = t("<div class='vis-attach-content-wrap' style='display:none;'>"); e.append(g); e.append(pt); ft = t("<div style='text-align:center;'>"); pt.append(ft); wt = t("<a title='" + n.Msg.getMsg("Upload") + "' href='javascript:void(0)' style='font-size: 35px; background: none;' class='vis-attach-ico'><i class='fa fa-upload' aria-hidden='true'><\/i><\/a>"); ft.append(wt); wt.on("click", function () { wi() }); kt = t("<a title='" + n.Msg.getMsg("Cancel") + "' href='javascript:void(0)' style='font-size: 35px; background: none;'  class='vis-attach-ico'><i class='fa fa-times-circle-o' aria-hidden='true'><\/i><\/a>"); ft.append(kt); kt.on("click", function () { g.empty(); bt = []; k = []; g.hide(); pt.hide(); nt.css("height", "353px") }); if (dt = t("<div class='vis-old-attachments'>"), tt.append(dt), nt = t("<div class='vis-attach-content-wrap' style='height: 353px;'>"), dt.append(nt), f != null && (r = f.AD_Attachment_ID), f != null && f._lines != null) { r = f.AD_Attachment_ID; for (gt in f._lines) hi(f._lines[gt], gt) } ni = t("<div class='vis-attach-footer'>"); tt.append(ni); et = t("<div class='vis-attach-btns pull-right' style='margin-top: 5px;'>"); ni.append(et); ti = t('<a  title="' + n.Msg.getMsg("DeleteAll") + '" class="vis-btn">').append(n.Msg.getMsg("DeleteAll")); c || et.append(ti); ti.on("click", function () { if (ht.endsWith("_ver")) { n.ADialog.info("AccessCannotDelete"); return } d.length == 0 || s || n.ADialog.confirm("DeleteRecord?", !0, "", "Confirm", function (i) { var r, u; if (i) { r = ""; for (u in d) r += d[u].Line_ID + ","; v[0].style.visibility = "visible"; t.ajax({ url: n.Application.contextUrl + "Attachment/DeleteAttachment", dataType: "json", data: { AttachmentLines: r }, error: function () { n.ADialog.info("ERRORDeletingFile"); v[0].style.visibility = "hidden" }, success: function (t) { t.result == -1 ? n.ADialog.info("ErrorDeletingFile") : (nt.empty(), d = []); v[0].style.visibility = "hidden" } }) } }) }); ii = t('<a title="' + n.Msg.getMsg("close") + '" class="vis-btn">').append(n.Msg.getMsg("close")); ii.on("click", function () { ct.onClose && ct.onClose(); oi() }); et.append(ii); ei = !0; v[0].style.visibility = "hidden" } })) } var ht = "", ei = !1, r, ct, ot, st, l, y, p, w, b, et, tt, it, rt, ut, ft, v, ti, gt, lt, ni, ii, a; this.isWindowAction = !1; var g = null, dt = null, nt = null, yt = null; this.windowNo = i; r = 0; o || (o = 0); h || (h = !1); s || (s = !1); this.onClose = null; ct = this; ot = null; ot = n.Application.isRTL ? t("<div style='overflow:hidden;width:100%;height:100%;'>") : t("<div style='overflow:hidden;width:100%;height:100%;'>"); st = t("<ul style='height:30px;display:none;list-style:none;width:97%;margin-left:-41px'>"); l = t("<li>"); l.css("float", "left"); l.css("margin", "1px"); l.css("padding", "5px"); l.css("display", "block"); l.css("position", "relative"); l.css("font-weight", "700"); l.css("border", "0px"); l.css("border-bottom", "none"); l.css("border-width", "1px"); l.css("color", "#999"); l.css("cursor", "default"); l.css("height", "35px"); l.css("margin-bottom", "-1px"); l.css("margin-right", "5px"); l.css("border-top-left-radius", "3px"); l.css("border-top-right-radius", "3px"); l.append(n.Msg.getMsg("FileAttachment")); st.append(l); y = t("<li>"); y.css("float", "left"); y.css("margin", "1px"); y.css("padding", "5px"); y.css("display", "block"); y.css("position", "relative"); y.css("font-weight", "700"); l.css("border", "0px"); y.css("border-bottom", "none"); y.css("border-width", "1px"); y.css("color", "#999"); y.css("cursor", "default"); y.css("height", "35px"); y.css("margin-bottom", "-1px"); y.css("margin-right", "5px"); y.css("border-top-left-radius", "3px"); y.css("border-top-right-radius", "3px"); y.append(n.Msg.getMsg("InboxMailAttachment")); st.append(y); p = t("<li>"); p.css("float", "left"); p.css("margin", "1px"); p.css("padding", "5px"); p.css("display", "block"); p.css("position", "relative"); p.css("font-weight", "700"); l.css("border", "0px"); p.css("border-bottom", "none"); p.css("border-width", "1px"); p.css("color", "#999"); p.css("cursor", "default"); p.css("height", "35px"); p.css("margin-bottom", "-1px"); p.css("margin-right", "5px"); p.css("border-top-left-radius", "3px"); p.css("border-top-right-radius", "3px"); p.append(n.Msg.getMsg("SentMailAttachment")); st.append(p); w = t("<li>"); w.css("float", "left"); w.css("margin", "1px"); w.css("padding", "5px"); w.css("display", "block"); w.css("position", "relative"); w.css("font-weight", "700"); l.css("border", "0px"); w.css("border-bottom", "none"); w.css("border-width", "1px"); w.css("color", "#999"); w.css("cursor", "default"); w.css("height", "35px"); w.css("margin-bottom", "-1px"); w.css("margin-right", "5px"); w.css("border-top-left-radius", "3px"); w.css("border-top-right-radius", "3px"); w.append(n.Msg.getMsg("Letter")); st.append(w); b = t("<li>"); b.css("float", "left"); b.css("margin", "1px"); b.css("padding", "5px"); b.css("display", "block"); b.css("position", "relative"); b.css("font-weight", "700"); l.css("border", "0px"); b.css("border-bottom", "none"); b.css("border-width", "1px"); b.css("color", "#999"); b.css("cursor", "default"); b.css("height", "35px"); b.css("margin-bottom", "-1px"); b.css("margin-right", "5px"); b.css("border-top-left-radius", "3px"); b.css("border-top-right-radius", "3px"); b.append(n.Msg.getMsg("Appointments")); st.append(b); ot.append(st); et = t("<div class='vis-pu-outerwrap'>"); tt = t("<div class='vis-pu-innerwrap'>"); et.append(tt); it = t("<div>"); it.append("Inbox Mail Att"); it.css("width", "100%"); it.css("height", "100%"); it.css("position", "absolute"); et.append(it); rt = t("<div>"); rt.append("SENT MAIL Att"); rt.css("width", "100%"); rt.css("height", "100%"); rt.css("position", "absolute"); et.append(rt); ut = t("<div>"); ut.append("Leter Att"); ut.css("width", "100%"); ut.css("height", "100%"); ut.css("position", "absolute"); et.append(ut); ft = t("<div>"); ft.append("Appointment Att"); ft.css("width", "100%"); ft.css("height", "100%"); ft.css("position", "absolute"); et.append(ft); v = t('<div class="vis-busyindicatorouterwrap"><div class="vis-busyindicatorinnerwrap"><i class="vis-busyindicatordiv"><\/i><\/div><\/div>'); et.append(v); ti = t("<div style='width: 100%;height: 100%;background:black;opacity: .1;display:none; position:absolute;top:0;left:0'>"); et.append(ti); gt = t("<div style='width: 100%;height: 100%;background:transparent;text-align: center;display:none ;vertical-align: middle;position:absolute;top:0;left:0'>"); et.append(gt); lt = null; lt = n.Application.isRTL ? t("<div id='progress_bar' class='vis-ui-progress-bar vis-ui-container' style='top:41%;width: 80%;right: 9%;'>") : t("<div id='progress_bar' class='vis-ui-progress-bar vis-ui-container' style='top:41%;width: 80%;left: 9%;'>"); ni = t("<div class='vis-ui-progress' style='width: 0%; display: block;position:absolute'>"); ii = t("<span class='vis-ui-label'  style='position:absolute'>").append("0%"); ni.append(ii); lt.append(ni); gt.append(lt); ot.append(et); tt[0].style.visibility = "visible"; it[0].style.visibility = "hidden"; rt[0].style.visibility = "hidden"; ut[0].style.visibility = "hidden"; ft[0].style.visibility = "hidden"; v[0].style.visibility = "hidden"; l.css("background", "#fff"); l.css("color", "#0088CC"); a = function (n, t) { t ? (n.css("background", "#fff"), n.css("color", "#0088CC")) : (n.css("background", "#eee"), n.css("color", "#999")) }; l.on("click", function () { tt[0].style.visibility = "visible"; it[0].style.visibility = "hidden"; rt[0].style.visibility = "hidden"; ut[0].style.visibility = "hidden"; ft[0].style.visibility = "hidden"; v[0].style.visibility = "hidden"; a(l, !0); a(y, !1); a(p, !1); a(w, !1); a(b, !1); si() }); y.on("click", function () { tt[0].style.visibility = "hidden"; it[0].style.visibility = "visible"; rt[0].style.visibility = "hidden"; ut[0].style.visibility = "hidden"; ft[0].style.visibility = "hidden"; v[0].style.visibility = "hidden"; a(l, !1); a(y, !0); a(p, !1); a(w, !1); a(b, !1) }); p.on("click", function () { tt[0].style.visibility = "hidden"; it[0].style.visibility = "hidden"; rt[0].style.visibility = "visible"; ut[0].style.visibility = "hidden"; ft[0].style.visibility = "hidden"; v[0].style.visibility = "hidden"; a(l, !1); a(y, !1); a(p, !0); a(w, !1); a(b, !1) }); w.on("click", function () { tt[0].style.visibility = "hidden"; it[0].style.visibility = "hidden"; rt[0].style.visibility = "hidden"; ut[0].style.visibility = "visible"; ft[0].style.visibility = "hidden"; v[0].style.visibility = "hidden"; a(l, !1); a(y, !1); a(p, !1); a(w, !0); a(b, !1) }); b.on("click", function () { tt[0].style.visibility = "hidden"; it[0].style.visibility = "hidden"; rt[0].style.visibility = "hidden"; ut[0].style.visibility = "hidden"; ft[0].style.visibility = "visible"; v[0].style.visibility = "hidden"; a(l, !1); a(y, !1); a(p, !1); a(w, !1); a(b, !0) }); this.show = function () { tt[0].style.visibility = "visible"; it[0].style.visibility = "hidden"; rt[0].style.visibility = "hidden"; ut[0].style.visibility = "hidden"; ft[0].style.visibility = "hidden"; v[0].style.visibility = "hidden"; a(l, !0); a(y, !1); a(p, !1); a(w, !1); a(b, !1); ht = n.dataContext.getJSONRecord("Attachment/GetTableName", u); ht != "" && (ht = ht.toLowerCase()); si(); ot.dialog({ width: 841, height: 502, title: n.Msg.getMsg("Attachment"), resizable: !1, modal: !0, close: vi }) }; var pt = t("<div class='vis-pu-uploadsbtnswrap'>"), k = []; var yi = function () { t.ajax({ url: n.Application.contextUrl + "Attachment/GetAttachment", dataType: "json", data: { AD_Table_ID: u, Record_ID: f }, error: function () { n.ADialog.info("ERRORGettingAttachment"); v[0].style.visibility = "hidden" }, success: function (n) { var t = n.result.Attachment, i; if (t != null && (r = t.AD_Attachment_ID), t != null && t._lines != null) { r = t.AD_Attachment_ID; for (i in t._lines) hi(t._lines[i], i) } v[0].style.visibility = "hidden" } }) }, pi = function (i) { for (var s, e, p, h, w, b, c, tt, ut, rt, a, o, v, r, f = [], u = [], y = 0; y < i.files.length; y++) { if (file = i.files[y], file == undefined) return; if (s = n.context.getContext("#ALLOWED_FILE_EXTENSION"), s && s.length > 0 && s.split(",").indexOf("." + file.name.split(".").pop()) == -1) { u.push(file.name); continue } if (file.name.indexOf("&") > -1 || file.name.indexOf("?") > -1 || file.name.indexOf("#") > -1 || file.name.indexOf("/") > -1 || file.name.indexOf("\\") > -1) { f.push(file.name); continue } for (e in k) if (file.name == k[e].name) { window.setTimeout(function () { n.ADialog.info("AlreadyExists") }, 20); return } if (d != null) for (e in d) if (file.name == d[e].Name && !d[e].IsDeleted) { window.setTimeout(function () { n.ADialog.info("AlreadyExists") }, 20); return } p = {}; h = t("<div class='vis-attach-file-wrapla' style='opacity: 0.5'>"); g.append(h); w = t("<div class='vis-attach-file-top'>"); b = t("<a class='vis-file-close-ico'><i class='fa fa-times' aria-hidden='true'><\/i><\/a>"); w.append(b); h.append(w); g.show(); pt.show(); b.on("click", function () { var n = t(t(this).parent()).parent(), r, i; n.css("display", "none"); r = n.html(); n.empty(); n = null; for (i in k) if (String(r).indexOf(k[i].name) > -1) { k.splice(i, 1); break } k.length > 4 ? (g.css("height", "135px"), nt.css("height", "135px")) : (g.css("height", "97px"), nt.css("height", "180px")); k.length == 0 && (g.hide(), pt.hide(), g.css("height", "0px"), nt.css("height", "353px")) }); c = t("<div class='vis-attach-file-content'>"); h.append(c); tt = t("<div class='vis-attach-file-icon'>"); ut = ai(file.name); tt.append(t("<img src='" + ut + "'>")); c.append(tt); var it = t("<div class='vis-attach-file-text' style='margin-bottom:10px'>"), ft = "", l = t("<p>"); file.name.length > 17 ? (ft = file.name.toString().substr(0, 17), l.append(ft), rt = t("<a href='#' class='VIS_Pref_tooltip'>").append("..."), a = t("<span style='width: inherit;'>"), a.append(t("<img class='VIS_Pref_callout'>").attr("src", n.Application.contextUrl + "Areas/VIS/Images/ccc.png").append("ToolTip Text")), a.append(t("<label class='VIS_Pref_Label_Font'>").append(file.name)), rt.append(a), l.append(rt)) : l.append(file.name); it.append(l); it.append(t("<p>").append((Number(file.size) / 1024).toFixed(2) + "KB")); c.append(it); p.Name = file.name; p.Size = file.size; k.push(file); k.length > 4 ? (g.css("height", "135px"), nt.css("height", "135px")) : (g.css("height", "97px"), nt.css("height", "180px")) } if (f.length > 0) { r = ""; for (v in f) r += f[v].toString() + "\n"; r += f.length == 1 ? "File has" : "Files have"; r += " invalid name. Please change the file name and try again."; n.ADialog.info(r) } if (u && u.length > 0) { o = ""; for (v in u) o.length > 0 && (o += ", "), o += u[v].toString(); r = ""; r += u.length == 1 ? "FileInvalidExtension" : "FilesInvalidExtension"; n.ADialog.warn(r, !0, o) } }, d = [], hi = function (i, r) { var l = t("<div class='vis-attach-file-wrap'>"), u, f, a, p, o, h, w, b; nt.append(l); u = {}; f = t("<div class='vis-attach-file-content'>"); l.append(f); a = t("<div class='vis-attach-file-icon'>"); a.append(t("<img src='" + ai(i.FileName) + "'>")); f.append(a); var y = t("<div class='vis-attach-file-text'>"), k = "", e = t("<p>"); i.FileName.length > 17 ? (k = i.FileName.toString().substr(0, 17), e.append(k), p = t("<a href='#' class='VIS_Pref_tooltip'>").append("..."), o = t("<span style='width: inherit;'>"), o.append(t("<img class='VIS_Pref_callout'>").attr("src", n.Application.contextUrl + "Areas/VIS/Images/ccc.png").append("ToolTip Text")), o.append(t("<label class='VIS_Pref_Label_Font'>").append(i.FileName)), p.append(o), e.append(p)) : e.append(i.FileName); y.append(e); y.append(t("<p>").append((Number(i.Size) / 1024).toFixed(2) + "KB")); f.append(y); h = t("<div class='vis-attach-BottomRight'>"); w = t("<a href='javascript:void(0)'  class='vis-attach-ico' data-id='" + r + "'><i class='fa fa-long-arrow-down' aria-hidden='true'><\/i><\/a>"); h.append(w); w.on("click", function () { var n = t(this).data("id"); d[n].HaveSource ? window.open(d[r].Source, "_blank") : bi(n, this) }); b = t("<a class='vis-attach-ico' data-id='" + r + "'><i class='vis vis-delete' aria-hidden='true'><\/i><\/a>"); c || h.append(b); b.on("click", function () { if (ht.endsWith("_ver")) { n.ADialog.info("AccessCannotDelete"); return } if (s) return !1; var i = t(this); n.ADialog.confirm("DeleteRecord?", !0, "", "Confirm", function (r) { if (r) { var u = i.data("id"); v[0].style.visibility = "visible"; t.ajax({ url: n.Application.contextUrl + "Attachment/DeleteAttachment", dataType: "json", data: { AttachmentLines: d[u].Line_ID }, error: function () { n.ADialog.info("ERRORDeletingFile"); v[0].style.visibility = "hidden" }, success: function (t) { if (t.result == -1) n.ADialog.info("ErrorDeletingFile"); else { var r = i.parent().parent(); r.css("display", "none"); r.empty(); r = null; d[u].IsDeleted = !0 } v[0].style.visibility = "hidden" } }) } }) }); l.append(h); u.Name = i.FileName; u.Size = i.Size; u.Line_ID = i.Line_ID; u.HaveSource = !1; u.Source = null; u.IsDeleted = !1; d.push(u) }, ri = 0, at = 0, ci = Date.now().toString(), vt = 1048576, ui = 0, wt = 0, bt = [], wi = function () { var n = null, t, r, i; kt(!0); t = 0; r = 0; for (i in k) t = parseInt(k[i].size / vt), file.size % vt > 0 && t++, ui += t, n = {}, n.Name = k[i].name, n.Size = k[i].size, bt.push(n); li() }, li = function () { if (k == null || k.length == 0) { kt(!1); n.ADialog.info("NothingToUpload"); return } if (at >= k.length) { t.ajax({ url: n.Application.contextUrl + "Attachment/SaveAttachmentEntries", dataType: "json", type: "POST", data: { files: JSON.stringify(bt), AD_Attachment_ID: r, folderKey: ci, AD_Table_ID: u, Record_ID: f, fileLocation: yt.val(), NewRecord_ID: o, IsDMSAttachment: h }, error: function () { kt(!1); bt = []; v[0].style.visibility = "hidden" }, success: function (i) { var f = i.result.Error, r, e, u; f == "" ? (h && (r = t(".vis-old-attachments").find(".vis-attach-file-wrap"), r.length > 1 && t(r[0]).remove()), fi(100), window.setTimeout(function () { kt(!1) }, 500), bt = [], e = "transfer", u = {}, u = { to: nt, className: "vis-Att-ui-effects-transfer" }, g.effect(e, u, 500, function () { window.setTimeout(function () { d = []; nt.empty(); yi(); k = []; g.empty(); g.hide(); pt.hide(); g.css("height", "0px"); nt.css("height", "353px"); ni.css("width", "O%") }, 500) })) : (bt = [], kt(!1), n.ADialog.info(f)); ri = 0; at = 0; ui = 0; wt = 0; v[0].style.visibility = "hidden" } }); return } var i = new XMLHttpRequest, e = new FormData; e.append("file", k[at].slice(wt * vt, wt * vt + Number(vt))); i.open("POST", n.Application.contextUrl + "Attachment/SaveFileinTemp/?filename=" + k[at].name + "&folderKey=" + ci, !1); i.onload = function () { var t, r, u; if (i.readyState === i.DONE && i.status === 200) { if (i.responseText && i.responseText.indexOf("ERROR") > -1) { t = i.responseText; t = t.replace("ERROR: ", ""); for (r in k) String(t).indexOf(k[r].name) > -1 && k.splice(r, 1); n.ADialog.warn("FilesInvalidExtension", !0, i.responseText); kt(!1); v[0].style.visibility = "hidden"; return } ri++; wt++; u = parseInt(k[at].size / vt); k[at].size % vt > 0 && u++; wt == u && (at++, wt = 0); ri <= ui && fi(parseInt(ri / ui * 80)); window.setTimeout(function () { li() }, 2) } }; i.send(e) }, kt = function (n) { n ? (ti.show(), lt.show(), gt.show()) : (ti.hide(), lt.hide(), gt.hide()) }, ki = function (t, i, r, u, f) { var o, c, e, s, h; for (progresBar.attr("value", 0), o = parseInt(t.size / r), t.size % r > 0 && o++, c = !1, e = 0; e < o; e++)e == o - 1 && t.size % r > 0 && (r = t.size % r), c = !0, s = new XMLHttpRequest, h = new FormData, h.append("file", t.slice(e * r, e * r + Number(r))), s.open("POST", n.Application.contextUrl + "Attachment/SaveFileinTemp/?filename=" + t.name + "&folderKey=" + i, !1), s.send(h), u++, fi(parseInt(u / f * 80)) }, bi = function (i) { var e = n.ProcessCtl.prototype.ORIGIN_WINDOW; ct.isWindowAction || (e = n.ProcessCtl.prototype.ORIGIN_FORM); v[0].style.visibility = "visible"; t.ajax({ url: n.Application.contextUrl + "Attachment/DownloadAttachment", dataType: "json", data: { fileName: d[i].Name, AD_Attachment_ID: r, AD_AttachmentLine_ID: d[i].Line_ID, actionOrigin: e, originName: n.context.getWindowContext(ct.windowNo, "WindowName"), AD_Table_ID: u, recordID: f }, error: function () { n.ADialog.info("ERRORGettingFile"); v[0].style.visibility = "hidden" }, success: function (t) { var u = new Date, f = t.result, r = n.Application.contextUrl + "TempDownload/" + f + "/" + d[i].Name + "?" + u.getTime(), e = d[i].Name; d[i].HaveSource = !0; v[0].style.visibility = "hidden"; window.open(r, "_blank"); d[i].Source = r } }) }, di = function () { iFrame != null && (iFrame.css("visibility", "visible"), viewer.css("visibility", "visible"), tt.css("visibility", "collapse")) }, fi = function (n) { ni.css("width", n + "%"); ii.empty(); ii.append(n + "%") }, gi = function (n) { return lt.each(function () { t(this).animate({ width: n + "%" }, { duration: 2e3, easing: "swing", step: function (n) { var i = t(".ui-label", this), r = t(".value", i); Math.ceil(n) < 20 && t(".ui-label", this).is(":visible") ? i.hide() : i.is(":hidden") && i.fadeIn(); Math.ceil(n) == 100 ? (i.text("Done"), setTimeout(function () { i.fadeOut() }, 1e3)) : r.text(Math.ceil(n) + "%") } }) }) }, ai = function (t) { var r, u, i; return t == null || t.length == 0 ? "" : (r = t.lastIndexOf("."), u = n.Application.contextUrl + "Areas/VIS/Images/", r < 1) ? u + "defult.png" : (i = t.substr(r, t.length - r), u + (i == ".xlsx" || i == ".xls" ? "excel.png" : i == ".html" || i == ".htm" ? "html.png" : i == ".pdf" ? "pdf.png" : i == ".ppt" ? "ppt.png" : i == ".txt" ? "text.png" : i == ".docx" || i == ".doc" ? "word.png" : i == ".xml" ? "xml.png" : i == ".jpg" || i == ".gif" || i == ".png" ? "image.png" : i == ".mp3" ? "audio.png" : i == ".zip" || i == ".rar" ? "compresed.png" : "defult.png")) } } i.prototype.setIsWindowAction = function (n) { this.isWindowAction = n }; n.attachmentForm = i }(VIS, jQuery), function (n, t) { function i(i) { function f() { var e, s, f, h, o; for (r = t("<div><\/div>"), e = "<!DOCTYPE html PUBLIC '-//W3C//DTD XHTML 1.0 Transitional//EN' 'http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd'>", e += n.Application.isRTL ? "<html dir='rtl' xmlns='http://www.w3.org/1999/xhtml'>" : "<html xmlns='http://www.w3.org/1999/xhtml'>", e += "<head><script type='text/javascript' language='javascript'> document.onkeydown = function(){ if((window.event && window.event .keyCode == 116)||(window.event && window.event .keyCode == 78)) { window.event.keyCode = 505; }if(window.event && window.event .keyCode == 505){ return false; } }<\/script> <meta http-equiv='Content-Type' content='text/html; charset=utf-8' /><title>Help &amp; Support " + i.vo.Name + "<\/title><style type='text/css'><!--body {margin-left: 0px;margin-top: 0px;margin-right: 0px;margin-bottom: 0px;font-family:verdana;font-size:12px;color:#000000;}.hed1{font-family:verdana;font-weight:bold;font-size:12px;color:#000000;}.border{border:1px solid #c6daf3;}.border-1{border:1px solid #aac7e7;background-color:#e9e8e8;}.border-2{border:1px solid #aac7e7;}.border-bottom{border-bottom:1px solid #c6daf3;}.border-top-none{border-bottom:1px solid #c6daf3;border-right:1px solid #c6daf3;border-left:1px solid #c6daf3;}.red{font-size:12px;color:#FF0000;font-weight:bold;}.white{font-size:16px;color:#FFffff;font-weight:bold;}.black{font-size:16px;color:#000000;font-weight:bold;}.blue{color:#5490fa;font-weight:bold;}.orange{color:#f2b227;font-weight:bold;}.pad{padding:5px;}a{color:#5490fa;\t}a:hover{color:#000000;\ttext-decoration:none;}--><\/style><\/head><body oncontextmenu='return false;'>", e = e + "<table width='100%' border='0' align='center' cellpadding='0' cellspacing='0' class='border'><tr><td><table width='100%' border='0' align='center' cellpadding='0' cellspacing='0' bgcolor='#c6daf3' class='border-bottom'><tr><td width='100%' class='hed1' height='29'>Vienna Solutions<\/td><\/tr><\/table><\/td><\/tr><tr><td>&nbsp;<\/td>", e = e + "<\/tr><tr><td><table width='98%' border='0' align='center' cellpadding='0' cellspacing='0' class='border'><tr><td><table width='99%' border='0' align='center' cellpadding='0' cellspacing='0'><tr><td class='red'>&nbsp;<\/td><\/tr><tr><td class='red'>Window: " + i.vo.Name + "<\/td><\/tr><tr><td>&nbsp;<\/td><\/tr><tr><td>" + i.vo.Description + "<\/td><\/tr><tr><td>&nbsp;<\/td><\/tr><tr><td>" + i.vo.Help + "<\/td><\/tr><tr><td>&nbsp;<\/td><\/tr><tr><td>", s = "", f = 0; f < i.tabs.length; f++)s == "" ? s = "<a href='#" + i.tabs[f].vo.Name + "" + f + "'>" + i.tabs[f].vo.Name + "<\/a>" : s += " -&gt; <a href='#" + i.tabs[f].vo.Name + "" + f + "'>" + i.tabs[f].vo.Name + "<\/a> "; for (e = e + s, e = e + "<\/td><\/tr><tr><td>&nbsp;<\/td><\/tr><\/table><\/td><\/tr><\/table><\/td><\/tr><tr><td>&nbsp;<\/td><\/tr>", e = e + "<tr><td><table width='98%' border='0' align='center' cellpadding='0' cellspacing='0' class='border'>", f = 0; f < i.tabs.length; f++) { for (e = e + "<tr><td><table width='99%' border='0' align='center' cellpadding='0' cellspacing='0'><tr><td class='black' style='padding-top:5px;' ><table width='100%' border='0' align='center' cellpadding='0' cellspacing='0'><tr><td width='340' height='5' bgcolor='#f9b31c'><\/td><td width='4'><\/td><td width='624' bgcolor='#f9b31c'><\/td><\/tr><tr><td height='35' bgcolor='#FFFFFF' class='border-top-none' style='padding-left:10px;'>Tab:" + i.tabs[f].vo.Name + "<a name='" + i.tabs[f].vo.Name + "" + f + "'><\/a> <\/td><td ><\/td><td bgcolor='#FFFFFF' class='border-top-none' style='padding-left:10px;'>" + i.tabs[f].vo.Description, "NaN<\/tr><\/table><\/td><\/tr><tr><td >&nbsp;<\/td><\/tr><tr><td><table width='100%' border='0' align='center' cellpadding='0' cellspacing='0' class='border-2'><tr><td style='padding:10px; text-align:justify'><span class='red'>" + i.tabs[f].vo.Help, "NaN<br />", h = "", o = 0; o < i.tabs[f].gTab._gridTable.m_fields.length; o++)h == "" && (i.tabs[f].gTab._gridTable.m_fields[o]._vo.IsDisplayedMR || i.tabs[f].gTab._gridTable.m_fields[o]._vo.IsDisplayedf) ? h = "<a href='#" + i.tabs[f].vo.Name + "" + f + "" + i.tabs[f].gTab._gridTable.m_fields[o]._vo.Header + "" + o + "'>" + i.tabs[f].gTab._gridTable.m_fields[o]._vo.Header + "<\/a>" : (i.tabs[f].gTab._gridTable.m_fields[o]._vo.IsDisplayedMR || i.tabs[f].gTab._gridTable.m_fields[o]._vo.IsDisplayedf) && (h += " | <a href='#" + i.tabs[f].vo.Name + "" + f + "" + i.tabs[f].gTab._gridTable.m_fields[o]._vo.Header + "" + o + "'>" + i.tabs[f].gTab._gridTable.m_fields[o]._vo.Header + "<\/a>"); for (e = e + h, e = e + " <\/tr><\/table><\/td><\/tr><tr><td>&nbsp;<\/td><\/tr>", o = 0; o < i.tabs[f].gTab._gridTable.m_fields.length; o++)i.tabs[f].gTab._gridTable.m_fields[o]._vo.Header != "" && (i.tabs[f].gTab._gridTable.m_fields[o]._vo.IsDisplayedMR || i.tabs[f].gTab._gridTable.m_fields[o]._vo.IsDisplayedf) && (e = e + "<tr><td><table width='100%' border='0' align='center' cellpadding='0' cellspacing='0' class='border-1'><tr><td style='padding:10px; text-align:justify'><span class='blue'>Field: " + i.tabs[f].gTab._gridTable.m_fields[o]._vo.Header + "<\/span><a name='" + i.tabs[f].vo.Name + "" + f + "" + i.tabs[f].gTab._gridTable.m_fields[o]._vo.Header + "" + o + "'><\/a><br /><br />" + i.tabs[f].gTab._gridTable.m_fields[o]._vo.Description + "<br /><br />" + i.tabs[f].gTab._gridTable.m_fields[o]._vo.Help + " <\/td><\/tr><\/table><\/td><\/tr><tr><td>&nbsp;<\/td><\/tr>"); e = e + "<\/table><\/td><\/tr>" } e = e + "<\/table><\/td><\/tr><\/table><\/body><\/html>"; r.append(jQuery.parseHTML(e)); u = e } function e() { var n = window.open(); n.document.open(); n.document.write(u) } var r, u = ""; f(); e() } n.Apps.help = i }(VIS, jQuery), function (n, t) { function i(i, r, u, f, e) { function si(i) { var r, u, f, s; i || (yt = t('<div class="wfactivity-homepage-parentdiv"><\/div>'), r = t(' <div class="frm-data-col-wrap frm-data-col-2" style="padding-right: 10px;"> <div class="frm-data-search-wrap"><input class="frm-data-col-searchinput" id="homeSearchWorkflow" type="text" placeholder="' + n.Msg.getMsg("Search") + '"><button id="btnWorkflowSearch" class="vis-wfSearch-btn"><i class="fa fa-search" aria-hidden="true"><\/i><\/button><\/div><\/div>'), ut = r.find("#homeSearchWorkflow"), ii = r.find("#btnWorkflowSearch"), u = t(' <div class="frm-data-col-wrap frm-data-col-2" style="padding-left: 7px"> <div class="frm-data-search-wrap"><select class="vis-custom-select"><\/select><\/div><\/div>'), y = u.find("select"), f = t('<div style="display:none;padding-left: 7px" class="frm-data-col-wrap frm-data-col-2"> <label>' + n.Msg.getMsg("FromDate") + '<\/label><input type="date" placeholder="date"><\/div>'), b = f.find("input"), s = t('<div  style="display:none;padding-right:10px" class="frm-data-col-wrap frm-data-col-2"><label>' + n.Msg.getMsg("ToDate") + '<\/label><input type="date" placeholder="date"><\/div>'), a = s.find("input"), yt.append(u).append(r).append(f).append(s), nt = t('<div class="frm-select-all-check"  style="display:none"><\/div>'), c = t('<input type="checkbox">'), nt.append("<label>" + n.Msg.getMsg("SelectAll") + "<\/label>"), nt.append(c), e.addClass("vis-eye-plus"), e.removeClass("vis-eye-minus"), e.attr("title", n.Msg.getMsg("ShowSearch"))); dt(); o = t('<div class="wfactivity-homepage-activites" style="padding-right:0px"><\/div>') } function dt(i) { t.ajax({ url: n.Application.contextUrl + "WFActivity/GetWorkflowWindows", dataType: "json", type: "POST", error: function () { return }, success: function (t) { var u, r; if (t) if (t = JSON.parse(t), y.empty(), y.append('<option value="0_0">' + n.Msg.getMsg("SelectWindow") + "<\/option>"), t && t.length > 0) { for (u = !1, r = 0; r < t.length; r++)y.append('<option value="' + t[r].AD_Window_ID + "_" + t[r].AD_Node_ID + '">' + t[r].WindowName + "<\/option>"), t[r].AD_Window_ID + "_" + t[r].AD_Node_ID == et && (u = !0); et && u ? y.val(et) : (et = "0_0", y.val("0_0")) } else et = "0_0", y.val("0_0"); i && vt() } }) } function hi(i) { y.off("change"); y.on("change", li); o.on("scroll", ai); if (!i) { ii.on("click", function () { k && (k = !1, vt()) }); ut.on("keydown", function (n) { n.keyCode == 13 && k && (k = !1, vt()) }); b.on("focusout", function () { b.val() != "" && a.val() != "" && b.val() > a.val() && a.val("") }); a.on("focusout", function () { b.val() != "" && a.val() != "" && b.val() > a.val() && (a.val(""), n.ADialog.info("ToDateMustGreater")) }); e.on("click", function () { a.is(":visible") ? (t(b.parent()).css("display", "none"), t(a.parent()).css("display", "none"), b.val(""), a.val(""), e.attr("title", n.Msg.getMsg("ShowSearch")), e.addClass("vis-eye-plus"), e.removeClass("vis-eye-minus"), c.is(":visible") ? o.css("top", "65px") : o.css("top", "47px")) : (t(b.parent()).css("display", "block"), t(a.parent()).css("display", "block"), e.attr("title", n.Msg.getMsg("HideSearch")), e.removeClass("vis-eye-plus"), e.addClass("vis-eye-minus"), c.is(":visible") ? o.css("top", "118px") : o.css("top", "98px")) }); c.on("click", ci) } } function ci() { var i = o.find(".wfActivity-selectchk"), n; for (c.prop("checked") == !1 && (bt = !0), c.prop("checked") == !0 && (at = !0), n = 0; n < i.length; n++)c.prop("checked") == !0 ? t(i[n]).prop("checked") == !1 && t(i[n]).trigger("click") : t(i[n]).prop("checked") == !0 && t(i[n]).trigger("click"); bt = !1; c.prop("checked") == !1 && t(o.find(".vis-activityContainer")[0]).trigger("click") } function li() { st.hide(); r.empty(); y.val() == "0_0" ? (nt.hide(), c.prop("checked") == !0 && c.trigger("click"), a.is(":visible") ? o.css("top", "98px") : o.css("top", "47px")) : (nt.hide(), a.is(":visible") ? o.css("top", "118px") : o.css("top", "67px")); et = y.val(); vt() } function vt() { ft = 1; ct = 10; st.hide(); r.empty(); o.empty(); s = []; s.length = 0; ti.AppendRecord(ft, ct, !0) } function ai() { t(this).scrollTop() + t(this).innerHeight() >= this.scrollHeight * .75 && ht && (ht = !1, pt = parseInt(d.html()), wt = ft * ct, wt <= pt ? (ft += 1, ti.AppendRecord(ft, ct)) : ht = !0) } function ni() { var n = o.find('input[class="wfActivity-selectchk"]:checked').length, t = o.find(".wfActivity-selectchk").length; t == n && c.prop("checked", !0) } var l = null, h = [], rt = [], ti = this, yt = null, nt = null, ut = null, ii = null, b = null, a = null, o = null, y = null, c = null, ft = 1, ct = 10, pt = 0, wt = 0, p = 0, et = "0_0", lt = 0, k = !0, at = !1, bt = !1, s = [], w = t("#divTabMenuDataLoder"), ot = t("#hAlrtTxtTypeCount"), d = t("#divfActivity"), st = t("#workflowActivity"), kt = null, v = null, tt = null, ri = t('<div class="vis-busyindicatorouterwrap"><div class="vis-busyindicatorinnerwrap"><i class="vis-busyindicatordiv"><\/i><\/div><\/div>'), it = function (n) { ri.css("display", n ? "block" : "none") }, ht, gt, ui; it(!1); this.Load = function (r) { c && c.prop("checked") == !1 && st.hide(); i.children().last().remove(); w.show(); ft = 1; ct = 10; pt = 0; wt = 0; si(r); s = []; r ? (i.find(".wfactivity-homepage-activites").remove(), i.append(o)) : i.append(yt).append(nt).append(o); hi(r); p = y.val(); p && p != "0_0" ? (lt = p.split("_")[1], p = p.split("_")[0], a.is(":visible") ? i.find(".wfactivity-homepage-activites").css("top", "118px") : i.find(".wfactivity-homepage-activites").css("top", "68px")) : (lt = 0, p = 0, a.is(":visible") ? i.find(".wfactivity-homepage-activites").css("top", "98px") : i.find(".wfactivity-homepage-activites").css("top", "47px")); t.ajax({ url: n.Application.contextUrl + "WFActivity/GetActivities", data: { pageNo: 1, pageSize: 10, refresh: !0, searchText: ut.val(), AD_Window_ID: p, dateFrom: b.val(), dateTo: a.val(), AD_Node_ID: lt }, dataType: "json", type: "POST", error: function () { w.hide(); n.HomeMgr.BindMenuClick(); return }, success: function (t) { var u = JSON.parse(t.result); ut.val(""); window.setTimeout(function () { n.HomeMgr.BindMenuClick(); var t = n.HomeMgr.getActiveTab(); if (t.activeTabType == 3) { if (u == null || u.LstInfo == null) { w.hide(); d.empty(); d.append(0); d.show(); ot.empty(); ot.append(0); str = "<p  id='pnorecFound' style=' margin-top:200px;text-align: center'>" + n.Msg.getMsg("NoRecordFound") + "<\/p>"; i.find("#pnorecFound").remove(); o.empty(); i.append(str); return } l = u.LstInfo; o.empty(); r == !0 && (rt = [], h = []); d.empty(); d.append(u.count); d.show(); ot.empty(); ot.append(u.count); gt(0); n.HomeMgr.adjustDivSize() } else return }, 100) } }) }; ht = !0; this.AppendRecord = function (r, u, f) { f || (f = !1); w.show(); p = y.val(); lt = p.split("_")[1]; p = p.split("_")[0]; t.ajax({ url: n.Application.contextUrl + "WFActivity/GetActivities", data: { pageNo: r, pageSize: u, refresh: f, searchText: ut.val(), AD_Window_ID: p, dateFrom: b.val(), dateTo: a.val(), AD_Node_ID: lt }, dataType: "json", type: "POST", error: function () { w.hide(); n.HomeMgr.BindMenuClick(); k = !0; ht = !0 }, success: function (t) { var u = JSON.parse(t.result), e, s; ut.val(""); n.HomeMgr.BindMenuClick(); e = n.HomeMgr.getActiveTab(); e.activeTabType == 3 ? (l = u ? u.LstInfo : null, f == !0 && (rt = [], h = [], d.empty(), o.empty(), u ? (i.find("#pnorecFound").remove(), d.append(u.count)) : (ot.empty(), ot.append(0), s = "<p id='pnorecFound' style=' margin-top:200px;text-align: center'>" + n.Msg.getMsg("NoRecordFound") + "<\/p>", i.find("#pnorecFound").remove(), i.append(s), d.append(0))), gt(r - 1), n.HomeMgr.adjustDivSize()) : k = !0; ht = !0 } }) }; gt = function (i) { var u = null, r, f, p, e, ft, g; if (l == null || l.length == 0) { w.hide(); nt.hide(); c.prop("checked", !1); k = !0; return } y.val() != "0_0" ? (a.is(":visible") ? o.css("top", "118px") : o.css("top", "67px"), nt.show()) : (a.is(":visible") ? o.css("top", "98px") : o.css("top", "47px"), nt.hide(), c.prop("checked", !1)); for (r in l) { h.push(l[r]); f = {}; u = t("<div class='vis-activityContainer' data-id='" + (Number(10 * i) + Number(r)) + "'>"); u.on("click", function (n) { var u, i, r, f; if (t(".vis-activityContainer").removeClass("vis-activeFeed"), t(this).addClass("vis-activeFeed"), u = t(n.target).data("viswfazoom"), u == "wfZoom") { t(this).addClass("vis-activeFeed"); i = t(n.target).data("index"); oi(i); k = !0; return } (i = t(this).data("id"), r = !0, s.length <= 1 && c.prop("checked") == !0 && (r = !1), f = t(this).find(".wfActivity-selectchk").data("ids"), s.length != 1 || f == s[0]) && (vi(rt[i].wfActivityID, i, this, r), k = !0) }); var v = t("<div class='vis-feedTitleBar'>"), b = t('<input class="wfActivity-selectchk" type="checkbox" style="float:left;margin-right:5px" data-ids="' + l[r].AD_Window_ID + "_" + l[r].AD_Node_ID + "_" + l[r].AD_WF_Activity_ID + '" ><\/input>'), d = t("<h3>"); d.css("font-weight", "normal"); d.append(n.Utility.encodeText(l[r].NodeName)); y && y.val() != "0_0" && v.append(b); v.append(d); var tt = t("<div class='vis-feedTitleBar-buttons'>"), it = t("<ul>"), ut = t("<li>"), et = t("<a href='javascript:void(0)'  data-index='" + (Number(10 * i) + Number(r)) + "' data-viswfazoom='wfZoom' >").append('<i class="vis vis-find" data-index="' + (Number(10 * i) + Number(r)) + '" data-viswfazoom="wfZoom"><\/i>'); ut.append(et); it.append(ut); tt.append(it); v.append(tt); u.append(v); p = t("<div class='vis-feedDetails'>"); e = t("<pre>"); l[r].DocumentNameValue == undefined || l[r].DocumentNameValue == "" ? e.append(n.Utility.encodeText(l[r].Summary)) : e.append(n.Utility.encodeText(l[r].DocumentNameValue + " - " + l[r].Summary)); ft = t("<br>"); e.append(ft); e.append(n.Utility.encodeText(n.Msg.getMsg("Priority") + " " + l[r].Priority)); p.append(e); b.on("click", function (n) { var i = t(n.target); ui(i, n) }); g = t("<div class='vis-feedDateTime'>"); g.append(t("<br>")).append(Globalize.format(new Date(l[r].Created), "F", Globalize.cultureSelector)); p.append(g); u.append(p); o.append(u); f.ctrl = u; f.index = r; f.recordID = l[r].Record_ID; f.wfActivityID = l[r].AD_WF_Activity_ID; rt.push(f); c.prop("checked") == !0 && (b.trigger("click"), h.length == 1) } k = !0; w.hide() }; ui = function (n, i) { var f = n.data("ids"), e, h, u, r; if (n.prop("checked") == !1 && (c.prop("checked", !1), at = !1), n.prop("checked") == !0) if (s.length == 0) s.push(n.data("ids")), at = !1, ni(); else if (e = s[0].split("_"), h = f.split("_"), e[0] + "-" + e[1] == h[0] + "-" + h[1]) s.push(f), c.prop("checked") != !0 || at || i.stopPropagation(), at = !1, ni(); else return ni(), i.preventDefault(), !1; else { if (s = jQuery.grep(s, function (n) { return n != f }), s.length == 1 && !bt) for (u = o.find(".wfActivity-selectchk"), r = 0; r < u.length; r++)if (t(u[r]).prop("checked") == !0) { t(u[r]).parent().trigger("click"); i.stopPropagation(); return } if (s.length >= 0 || c.prop("checked") == !0) return i.stopPropagation(), !1 } n.prop("checked") == !0 }; var fi = function () { var i = t(window).width(), r = t(".row.scrollerHorizontal > div").length, u, n, f; r = r - 1; t(".scrollerHorizontal").width(i); u = i / r - 20; n = parseInt(u); i >= 1366 && (st.css("display") == "none" ? (t("#fllupsScreen").css("left", n + 20), t("#favLinks").css("left", n * 2 + 40), t("#welcomeScreen,#fllupsScreen,#favLinks").width(n)) : st.css("display") == "block" && (f = i + n + 20, t(".scrollerHorizontal").width(f), t("#workflowActivity").css("left", n + 20), t("#fllupsScreen").css("left", n * 2 + 40), t("#favLinks").css("left", n * 3 + 60), t("#welcomeScreen,#fllupsScreen,#favLinks,#workflowActivity").width(n))) }, g = [], vi = function (i, u, f, e) { w.show(); t.ajax({ url: n.Application.contextUrl + "WFActivity/GetActivityInfo", dataType: "json", type: "POST", async: e, data: { activityID: i, nodeID: h[u].AD_Node_ID, wfProcessID: h[u].AD_WF_Process_ID }, error: function () { w.hide(); return }, success: function (e) { if (s.length <= 1 || c.prop("checked") == !0) { st.show(); n.HomeMgr.adjustDivSize(); var h = "transfer", o = {}; o = { to: r, className: "wsp-ui-effects-transfer" }; window.setTimeout(function () { ei(i, u, e.result); t(f).effect(h, o, 500, function () { }) }, 400) } else s.length <= 2 && ei(i, u, e.result), w.hide() } }) }, ei = function (i, u, f) { function er(i) { var r, u; if (i.data("clicked") != "Y") if (i.data("clicked", "Y"), window.VA055 && window.VADMS && f.ColName == "VADMS_SignStatus") { if (r = { documentNo: rt[rt.length - 1], defaultReasonKey: t('[name="VADMS_SignStatus"]').children("option:selected").val(), defaultReason: t('[name="VADMS_SignStatus"]').children("option:selected").text() }, r.defaultReasonKey == undefined || r.defaultReasonKey == "" || r.defaultReason == undefined || r.defaultReason == "") { i.data("clicked", "N"); n.ADialog.info("VA055_ChooseStatus"); return } it(!0); t.post(n.Application.contextUrl + "VADMS/Document/SignatureUsingWorkflow", r, function (r) { it(!1); r && r != "null" && r.result == "success" ? (t("#divfeedbsy")[0].style.visibility = "hidden", o.empty(), fi(), g = [], s = [], w.show(), window.setTimeout(function () { dt(!0) }, 5e3)) : (i.data("clicked", "N"), n.ADialog.error(r.result)) }, "json").fail(function (t, r) { it(!1); i.data("clicked", "N"); n.ADialog.error(r) }) } else u = t(i).data("id"), yi(u, i) } var e = {}, rt, ut, ui, ir, ei, rr, pt, at, vt, ur, si, st, yt, c, hi, ci, li, ai, wt, vi, bt, ht, y, b, l, bi, gt, ki, ni, fr, et, p, ft, di, a, ti, gi, nr, ot, tr, k, ii, d, ct, nt, lt; if (g = [], e.Index = u, r.empty(), ut = t("<div class='vis-workflowActivityDetails-Heading'>"), r.append(ut), ui = t("<h3>"), ui.append(n.Msg.getMsg("Detail")), ut.append(ui), s.length <= 1) if (kt = t("<a href='javascript:void(0)' class='vis-btn-zoom mr-1' style='padding-left: 10px;padding-right: 10px;padding-top: 2px;padding-bottom: 2px;' data-id='" + u + "'>" + n.Msg.getMsg("CheckList") + "<\/a>"), f.IsSurveyResponseRequired && ut.append(kt), f.ColName == "VADMS_SignStatus") { rt = h[u].DocumentNameValue.split("_"); ir = { DocumentNo: parseInt(rt[rt.length - 1]) }; ei = ""; t.post(n.Application.contextUrl + "VADMS/Document/GetFolderID", ir, function (t) { !t || t.result == "" || t.result.contains("ERR-") || t.result.contains("F") ? n.ADialog.error(n.Msg.getMsg("VA055_FolderNotFound")) : ei = parseInt(t.result) }, "json").fail(function (t, i) { n.ADialog.error(i) }); rr = { FromName: "VADMS_DMSWeb" }; pt = ""; t.post(n.Application.contextUrl + "VADMS/Document/GetFormID", rr, function (t) { t && t.result != "" ? pt = t.result : n.ADialog.error(n.Msg.getMsg("VA055_FormNotFound")) }, "json").fail(function (t, i) { n.ADialog.error(i) }); at = t("<a href='javascript:void(0)' class='vis-btn-zoom' style='margin-left:10px;' data-id='" + rt[rt.length - 1] + "'>"); at.append(t("<span class='vis-btn-ico vis-btn-zoom-bg vis-btn-zoom-border'>")); at.append(n.Msg.getMsg("Zoom")); ut.append(at); at.on(n.Events.onTouchStartOrClick, function () { var i = t(this).data("id"), r = { DocNo: i, DocFolderID: ei }; pt > 0 && n.viewManager.startForm(pt, r) }) } else { vt = t("<a href='javascript:void(0)' class='vis-btn-zoom' data-id='" + u + "'>"); vt.append(t("<span class='vis-btn-ico vis vis-find vis-btn-zoom-border'>")); vt.append(n.Msg.getMsg("Zoom")); ut.append(vt); vt.on(n.Events.onTouchStartOrClick, function () { var n = t(this).data("id"); oi(n) }) } if (ut.append(t("<div class='clearfix'>")), ur = t("#workflowActivityData").height() - 50 + "px", v = t("<div class='divWorkflowActivity' style='height:" + ur + "'>"), tt = t("<div class='divWorkflowChecklist' style='display:none'><\/div>"), r.append(v), r.append(tt), v.append(ri), si = t("<ul class='vis-IIColumnContent'>"), v.append(si), st = t("<li>"), st.css("width", "100%"), yt = t("<p>"), yt.append(n.Msg.getMsg("Node")), yt.append(t("<br>")), yt.append(n.Utility.encodeText(h[u].NodeName)), st.append(yt), si.append(st), f.AttachmentCount > 0 && st.append("<pre style='margin-top: 10px; margin-bottom: 0px; font-size: 14px; font-family: NoirPro-Regular; color: inherit;'>" + n.Msg.getMsg("Attachment") + " : " + n.Msg.getMsg("Yes") + "<\/pre>"), s.length <= 1 && (c = t("<pre class='mb-2'>"), c.css("margin-top", "10px"), c.css("margin-bottom", "0px"), c.css("font-size", "14px"), c.css("font-family", "NoirPro-Regular"), c.css("color", "inherit"), c.append(n.Msg.getMsg("Summary")), c.append(t("<br>")), c.append(n.Utility.encodeText(h[u].Summary)), st.append(c)), v.append(t("<div class='clearfix'>")), hi = t("<p class='mb-0'>"), hi.append(n.Msg.getMsg("Description")), v.append(hi), ci = t("<p>"), ci.append(n.Utility.encodeText(h[u].Description)), v.append(ci), v.append(t("<div class='clearfix'>")), li = t("<p class='mb-0'>"), li.append(n.Msg.getMsg("Help")), v.append(li), ai = t("<p>"), ai.append(n.Utility.encodeText(h[u].Help)), v.append(ai), v.append(t("<h3>").append(n.Msg.getMsg("Action"))), v.append(t("<div class='clearfix'>")), wt = t("<ul class='vis-IIColumnContent vis-home-wf-ul'>"), vi = t("<li>"), wt.append(vi), bt = t('<div class="vis-home-wf-answerWrap">'), vi.append(bt), ht = t('<div class="input-group vis-home-wf-answerInput vis-input-wrap">'), bt.append(ht), f.NodeAction == "C") y = pi(f, i), e.AnswerCtrl = y, y != null && (y.getBtnCount() > 0 ? (p = t("<div class='vis-wforwardwrap vis-control-wrap'>"), p.append(y.getControl()), ft = t("<div class='input-group-append'>"), ft.append(y.getBtn(0)), p.append(t("<label style='margin-bottom: 0'>").append(n.Msg.getMsg("Answer"))), ht.append(p).append(ft)) : ht.append(y.getControl()), e.AnswerCtrl = y), e.Action = "C"; else if (f.NodeAction == "W") { b = t('<button style="margin-bottom:10px;margin-top: 0px;width: 100%;" class="VIS_Pref_pass-btn" data-id="' + u + '" data-window="' + f.AD_Window_ID + '" data-col="' + f.KeyCol + '">').append(f.NodeName); e.AnswerCtrl = b; ht.append(b); b.on("click", function () { wi(t(this).data("id"), t(this).data("window"), t(this).data("col")) }); e.Action = "W" } else if (f.NodeAction == "X") { b = t('<button style="margin-bottom:10px;margin-top: 0px;width: 100%;" class="VIS_Pref_pass-btn" data-id="' + u + '" data-form="' + f.AD_Form_ID + '" data-col="' + f.KeyCol + '">').append(f.NodeName); e.AnswerCtrl = b; ht.append(b); b.on("click", function () { n.viewManager.startForm(t(this).data("form")) }); e.Action = "X" } l = t("<a href='javascript:void(0)'  style='display:none' id='vis-home-wf-ansOK' class='vis-btn vis-btn-done vis-icon-doneButton vis-workflowActivityIcons' data-clicked='N' data-id='" + u + "'>"); l.append(t("<span class='vis-btn-ico vis-btn-done-bg vis-btn-done-border'>")); l.append(n.Msg.getMsg("Done")); bt.append(t('<div class="vis-home-wf-answerBtn">').append(l)); bi = t("<li>"); wt.append(bi); gt = t('<div class="vis-home-wf-forwardWrap">'); bi.append(gt); ki = t('<div class="input-group mb-0 vis-home-wf-forwardInput vis-input-wrap">'); gt.append(ki); ni = t('<div class="d-flex">'); gt.append(ni); fr = n.MLookupFactory.get(n.context, 0, 0, n.DisplayType.Search, "AD_User_ID", 0, !1, null); et = new n.Controls.VTextBoxButton("AD_User_ID", !1, !1, !0, n.DisplayType.Search, fr); e.FwdCtrl = et; et.getBtn(); et.getBtnCount() == 2 && (p = t("<div class='vis-wforwardwrap vis-control-wrap'>"), p.append(et.getControl()), ft = t("<div class='input-group-append'>"), ft.append(et.getBtn(0)), ft.append(et.getBtn(1)), p.append(t("<label style='margin-bottom: 0'>").append(n.Msg.getMsg("Forward"))), ki.append(p).append(ft)); di = t('<div class="input-group vis-home-wf-forwardInput vis-input-wrap">'); ni.append(di); a = t("<a href='javascript:void(0)' style='display:none' id='vis-home-wf-forOK' class='vis-btn vis-btn-done vis-icon-doneButton vis-workflowActivityIcons' data-clicked='N' data-id='" + u + "'>"); a.append(t("<span class='vis-btn-ico vis-btn-done-bg vis-btn-done-border'>")); a.append(n.Msg.getMsg("Done")); ni.append(t('<div class="vis-home-wf-forwardBtn">').append(a)); v.append(wt); v.append(t("<div class='clearfix'>")); v.append(t("<p style='margin-bottom: 0'>").append(n.Msg.getMsg("Message"))); v.append(t("<div class='clearfix'>")); ti = t("<div class='vis-control-wrap'>"); gi = t("<textarea style='width:100%;resize:none;' placeholder='" + n.Msg.getMsg("TypeMessage") + "....'>"); e.MsgCtrl = gi; ti.append(gi); ti.append(t("<div class='clearfix'>")); di.append(ti); a.on(n.Events.onTouchStartOrClick, function () { er(a) }); l.on(n.Events.onTouchStartOrClick, function () { er(l) }); if (e.FwdCtrl.fireValueChanged = function () { e.FwdCtrl.getValue() > 0 ? (e.AnswerCtrl.getControl().prop("disabled", !0), e.AnswerCtrl.getBtn(0).prop("disabled", !0), a.css("display", ""), l.css("display", "none")) : (e.AnswerCtrl.getControl().prop("disabled", ""), e.AnswerCtrl.getBtn(0).prop("disabled", ""), a.css("display", "none"), l.css("display", "none")) }, e.AnswerCtrl.fireValueChanged = function () { e.AnswerCtrl.getValue() == "" || e.AnswerCtrl.getValue() == null ? (e.FwdCtrl.getControl().prop("disabled", ""), e.FwdCtrl.getBtn(0).prop("disabled", ""), e.FwdCtrl.getBtn(1).prop("disabled", ""), a.css("display", "none"), l.css("display", "none")) : (e.FwdCtrl.getControl().prop("disabled", !0), e.FwdCtrl.getBtn(0).prop("disabled", !0), e.FwdCtrl.getBtn(1).prop("disabled", !0), a.css("display", "none"), l.css("display", "")) }, g.push(e), s.length <= 1 && (v.append(t("<h3>").append(n.Msg.getMsg("History"))), v.append(t("<div class='clearfix'>")), nr = t("<div class='vis-history-wrap'>"), v.append(nr), f.Node != null)) { ot = t("<div style='margin-top:15px;margin-bottom:15px'>"); for (node in f.Node) if (f.Node[node].History != null) { for (hNode in f.Node[node].History) f.Node[node].History[hNode].State == "CC" && node < f.Node.length - 1 ? (ot.append(t("<div class='vis-vertical-img'>").append(t("<img src='" + n.Application.contextUrl + "Areas/VIS/Images/home/4.jpg'>"))), k = t("<div class='vis-approved_wrap'>"), tr = "", tr = f.Node[node].Name, d = t("<div class='vis-left-part'>"), f.Node[node].History[hNode].TextMsg.length > 0 && (ct = t("<a href='javascript:void(0)' class='VIS_Pref_tooltip' style='margin-right:5px'>").append(t("<img class='VIS_Pref_img-i'>").attr("src", n.Application.contextUrl + "Areas/VIS/Images/i.png")), nt = t("<span>"), nt.append(t("<img class='VIS_Pref_callout'>").attr("src", n.Application.contextUrl + "Areas/VIS/Images/ccc.png").append("ToolTip Text")), nt.append(t("<label class='VIS_Pref_Label_Font'>").append(n.Utility.encodeText(f.Node[node].History[hNode].TextMsg))), ct.append(nt), d.append(ct)), d.append(tr), k.append(d), lt = t("<div class='vis-right-part'>"), lt.append(n.Msg.getMsg("CompletedBy")).append(t("<span class='vis-app_by'>").append(f.Node[node].History[hNode].ApprovedBy)), k.append(lt), ot.append(k)) : node < f.Node.length - 1 || f.Node.length == 1 ? (k = t("<div class='vis-pending_wrap' style='margin-top:-2px'>"), k.append(t("<div class='vis-left-part'>").append(f.Node[node].Name)), k.append(t("<div class='vis-right-part'>").append(n.Msg.getMsg("Pending"))), ot.append(k)) : (ot.append(t("<div class='vis-vertical-img'>").append(t("<img src='" + n.Application.contextUrl + "Areas/VIS/Images/home/4.jpg'>"))), ii = t("<div class='vis-start_wrap' style='margin-bottom:-8px'>"), d = t("<div class='vis-left-part'>"), f.Node[node].History[hNode].TextMsg.length > 0 && (ct = t("<a href='javascript:void(0)' class='VIS_Pref_tooltip' style='margin-right:5px'>").append(t("<img class='VIS_Pref_img-i'>").attr("src", n.Application.contextUrl + "Areas/VIS/Images/i.png")), nt = t("<span >"), nt.append(t("<img class='VIS_Pref_callout'>").attr("src", n.Application.contextUrl + "Areas/VIS/Images/ccc.png").append("ToolTip Text")), nt.append(t("<label class='VIS_Pref_Label_Font'>").append(n.Utility.encodeText(f.Node[node].History[hNode].TextMsg))), ct.append(nt), d.append(ct)), d.append(f.Node[node].Name), ii.append(d), lt = t("<div class='vis-right-part'>"), lt.append(n.Msg.getMsg("CompletedBy")).append(t("<span class='vis-app_by'>").append(f.Node[node].History[hNode].ApprovedBy)), ii.append(lt), ot.append(ii)); nr.append(ot) } } w.hide(); kt.off().click(function () { var i, f; tt.html(""); t(this).text() != "Back" ? (t(this).text(n.Msg.getMsg("Back")), r.find(".vis-workflowActivityDetails-Heading h3").text(n.Msg.getMsg("CheckList")), i = new n.SurveyPanel, i.init(), f = i.getRoot(), tt.html(""), i.panelDetails(h[u].AD_Window_ID, 0, h[u].AD_Table_ID, h[u].Record_ID, f, h[u].AD_WF_Activity_ID), tt.append(f)) : (r.find(".vis-workflowActivityDetails-Heading h3").text(n.Msg.getMsg("Detail")), t(this).text(n.Msg.getMsg("CheckList"))); v.toggle(700); tt.is(":hidden") ? tt.show() : tt.hide() }) }, oi = function (t) { n.AEnv.wfzoom(h[t].AD_Table_ID, h[t].Record_ID, h[t].AD_WF_Activity_ID) }, yi = function (i, r) { var r = r; t("#divfeedbsy")[0].style.visibility = "visible"; window.setTimeout(function () { var u, c, f, e; for (u in g) try { if (i === g[u].Index) { var l = g[u].FwdCtrl.getValue(), a = n.Utility.encodeText(g[u].MsgCtrl.val()), c = null; if (g[u].Action == "C" && (c = g[u].AnswerCtrl.getValue()), f = "", s && s.length > 0) for (e = 0; e < s.length; e++)f.length > 0 && (f += ","), f += s[e].split("_")[2]; else f = h[i].AD_WF_Activity_ID; p = h[i].AD_Window_ID; it(!0); n.dataContext.getJSONData(n.Application.contextUrl + "WFActivity/ApproveIt", { activityID: f, nodeID: h[i].AD_Node_ID, txtMsg: a, fwd: l, answer: c, AD_Window_ID: p }, function (i) { it(!1); i.result == "" ? (t("#divfeedbsy")[0].style.visibility = "hidden", r.data("clicked", "N"), o.empty(), fi(), g = [], s = [], w.show(), dt(!0)) : (n.ADialog.error(i.result), r.data("clicked", "N"), t("#divfeedbsy")[0].style.visibility = "hidden") }); break } } catch (y) { it(!1); n.ADialog.error("FillMandatory", !0, ""); r.data("clicked", "N"); t("#divfeedbsy")[0].style.visibility = "hidden" } r.data("clicked", "N") }, 2) }, pi = function (i, r) { var f, e, u; return i.ColID == 0 ? null : i.ColReference == n.DisplayType.YesNo ? (u = n.MLookupFactory.get(n.context, 0, 0, n.DisplayType.List, i.ColName, 319, !1, null), new n.Controls.VComboBox(i.ColName, !1, !1, !0, u, 50)) : i.ColReference == n.DisplayType.List ? (u = n.MLookupFactory.get(n.context, 0, 0, n.DisplayType.List, i.ColName, i.ColReferenceValue, !1, null), new n.Controls.VComboBox(i.ColName, !1, !1, !0, u, 50)) : i.ColName.toUpperCase() == "C_GENATTRIBUTESETINSTANCE_ID" ? (f = null, e = new n.MGAttributeLookup(n.context, 0), t.ajax({ url: n.Application.contextUrl + "WFActivity/GetRelativeData", async: !1, data: { activityID: r }, dataType: "json", success: function (t) { t.result && (f = new n.Controls.VPAttribute("C_GenAttributeSetInstance", !0, !1, !0, n.DisplayType.PAttribute, e, 0, !0, !1, !1, !1), f.SetC_GenAttributeSet_ID(t.result.GenAttributeSetID)) } }), f) : i.ColReference == n.DisplayType.TableDir ? (u = n.MLookupFactory.get(n.context, 0, 0, n.DisplayType.TableDir, i.ColName, i.ColReferenceValue, !1, null), new n.Controls.VComboBox(i.ColName, !1, !1, !0, u, 50)) : i.ColReference == n.DisplayType.Search ? (u = n.MLookupFactory.get(n.context, 0, 0, n.DisplayType.Search, i.ColName, i.ColReferenceValue, !1, null), new n.Controls.VTextBoxButton(i.ColName, !1, !1, !0, n.DisplayType.Search, u)) : new n.Controls.VTextBox(i.ColName, !1, !1, !0, 50, 100, null, null, !1) }, wi = function (t, i, r) { var u = new n.Query; u.addRestriction(r, n.Query.prototype.EQUAL, h[t].Record_ID); n.viewManager.startWindow(i, u) }; this.clear = function () { for (var n in rt) rt[n] = null } } n.wfActivity = i }(VIS, jQuery), function (n, t) { function i(i, r, u) { function rt() { st(); ht(); ut(); ft(u) } function ut() { var u = [], f = [], e = [], i, o, t; try { if (i = n.dataContext.getJSONData(n.Application.contextUrl + "DocAction/GetReference", { RefQry: "VIS" }, null), i != null) for (t in i) { var c = i[t].Value, l = i[t].Name, r = i[t].Description; (r == null || r == "undefined") && (r = ""); u.push(c); f.push(l); e.push(r) } } catch (v) { console.log(v) } for (o = u.length, s = [], h = [], a = [], t = 0; t < o; t++)s.push(u[t]), h.push(f[t]), a.push(e[t]) } function ft(u) { var e, f, o, c; v = r.getValue("DocStatus"); e = r.getValue("DocAction"); f = r.getValue("Processing"); f = f != "N" && f ? !0 : !1; o = k.getWindowContext(i, "OrderType"); c = k.isSOTrx(i); t.ajax({ url: n.Application.contextUrl + "DocAction/GetDocActions", type: "POST", dataType: "Json", data: { AD_Table_ID: d, Record_ID: u, docStatus: v, processing: f, orderType: o, isSOTrx: c, docAction: e, tableName: r.getTableName(), values: JSON.stringify(s), names: JSON.stringify(h), C_DocType_ID: r.getValue("C_DocType_ID"), C_DocTypeTarget_ID: r.getValue("C_DocTypeTarget_ID") }, success: function (n) { var t = JSON.parse(n); et(t); ot(t) } }) } function et(t) { if (b(!1), v = t.DocStatus, t.Error != null && t.Error != "" && t.Error != "undefined") { n.ADialog.error(t.Error); return } if (t.DocStatus == null) { y.text("*** ERROR ***"); return } } function ot(t) { for (var u, r, i = 0; i < t.Index; i++)for (u = !1, r = 0; r < s.length && !u; r++)t.Options[i] && t.Options[i].equals(s[r]) && (o.append("<option >" + h[r] + "<\/option>"), u = !0); if (t.DefaultV != null && t.DefaultV != "" && t.DefaultV != "undefined" && o.val(t.DefaultV).change(), c.prop("disable", !1), e.getNumberOfOptions() == 0) { n.ADialog.info("InfoDocActionNoOptions", ""); e.log.info("DocAction - No Options"); f.close(); return } } function st() { var u = t("<tr>"), e = t("<tr>"), s = t("<tr>"), h = t("<td>"), v = t("<td>"), a = t("<div class='input-group vis-input-wrap'><\/div>"), i = t("<div class='vis-control-wrap'><\/div>"), r; h.append(a); a.append(i); i.append(o); i.append("<label >" + n.Msg.getMsg("DocAction") + "<\/label>"); u.append(h); r = t("<td>"); r.append(y); e.append(r); $td31 = t("<td>"); $td32 = t('<td style="text-align:right">'); s.append($td31).append($td32); l.append(u).append(e).append(s); c.append(l); b(!0); c.append(p).append(w); f = new n.ChildDialog } function ht() { o.on("change", function () { var n = g(); n != -1 && a.length > 0 && y.text(a[n]) }); f.onOkClick = function () { ct() && (e.isOKPressed = !0, e.onClose && e.onClose()) }; f.onCancelClick = function () { e.onClose && e.onClose() } } function b(n) { n ? (p.show(), w.show(), c.find("button").prop("disabled", !0)) : (p.hide(), w.hide(), c.find("button").prop("disabled", !1)) } function g() { var t = -1, i, n; if (o.val() == null) return t; for (i = o.val(), n = 0; n < h.length && t == -1; n++)if (i.equals(h[n])) { t = n; break } return t } function ct() { var h, e, c, i, o; if (b(!0), h = g(), h == -1) return b(!1), !1; var l = r.getAD_Window_ID(), a = r.getAD_Tab_ID(), f = s[h]; if (r.getHasPanel()) { for (e = r.getTabPanels(), c = !1, i = 0; i < e.length; i++)e[i].getClassName() == "VIS.SurveyPanel" && (c = !0, i = e.length); return c ? (o = !1, t.ajax({ type: "POST", url: n.Application.contextUrl + "VIS/SurveyPanel/CheckDocActionCheckListResponse", dataType: "json", async: !1, contentType: "application/json; charset=utf-8", data: JSON.stringify({ AD_Window_ID: l, AD_Tab_ID: a, Record_ID: u, DocAction: f, AD_Table_ID: r.getAD_Table_ID() }), success: function (t) { t == "false" ? (n.ADialog.error("CheckListRequired"), o = !1) : (r.setValue("DocAction", f), o = !0) }, error: function () { } }), o) : (r.setValue("DocAction", f), !0) } return r.setValue("DocAction", f), !0 } var k = n.Env.getCtx(), d = r.getAD_Table_ID(), s = [], h = [], a = [], v = null, nt = 0, tt = "", l, f, p, w; this.log = n.Logging.VLogger.getVLogger("VDocAction"); var it, o = t('<select class="vis-select-docAction"><\/select>'), y = t('<p style="font-size:12px;margin-bottom:-5px"><\/p>'), c = t('<div style="margin-bottom:-5px"><\/div>'), e = this; this.batch = !1; this.isOKPressed = !1; l = t('<table style="width:360px;margin-bottom:9px">'); f = null; this.onClose = null; p = t('<div class="vis-busyindicatorouterwrap"><div class="vis-busyindicatorinnerwrap"><i class="vis-busyindicatordiv"><\/i><\/div><\/div>'); w = t("<label>" + n.Msg.getMsg("Loading") + "<\/label>"); n.Application.isRTL; rt(); this.getNumberOfOptions = function () { return o.children("option").length }; this.isStartProcess = function () { return this.isOKPressed }; this.isBatch = function () { return this.batch }; this.show = function () { f.setContent(c); f.setTitle(n.Msg.getMsg("DocAction")); f.setModal(!0); f.show() }; f.onClose = function () { e.dispose() }; this.dispose = function () { f.close(); f = null; d = null; s = null; h = null; a = null; v = null; nt = 0; tt = null; it = null; o = null; y = null; c = null; e = null; l && l.empty(); l = null } } function r() { this.ACTION_COMPLETE = "CO"; this.ACTION_WAITCOMPLETE = "WC"; this.ACTION_APPROVE = "AP"; this.ACTION_REJECT = "RJ"; this.ACTION_POST = "PO"; this.ACTION_VOID = "VO"; this.ACTION_CLOSE = "CL"; this.ACTION_REVERSE_CORRECT = "RC"; this.ACTION_REVERSE_ACCRUAL = "RA"; this.ACTION_REACTIVATE = "RE"; this.ACTION_NONE = "--"; this.ACTION_PREPARE = "PR"; this.ACTION_UNLOCK = "XL"; this.ACTION_INVALIDATE = "IN"; this.ACTION_REOPEN = "OP"; this.STATUS_DRAFTED = "DR"; this.STATUS_COMPLETED = "CO"; this.STATUS_APPROVED = "AP"; this.STATUS_INVALID = "IN"; this.STATUS_NOTAPPROVED = "NA"; this.STATUS_VOIDED = "VO"; this.STATUS_REVERSED = "RE"; this.STATUS_CLOSED = "CL"; this.STATUS_UNKNOWN = "??"; this.STATUS_INPROGRESS = "IP"; this.STATUS_WAITINGPAYMENT = "WP"; this.STATUS_WAITINGCONFIRMATION = "WC" } n.VDocAction = i; n.DocumentEngine = r }(VIS, jQuery), function (n, t) { function i() { function n(n, i, r, u, f, e) { if (window.WSP) { var o = t("<div id='divAptBusy' class='wsp-busy-indicater'><\/div>"); t("body").append(o); f == !1 ? (o.show(), WSP.AppointmentsForm.init(n, i, r, u, o, e)) : (o.show(), WSP.TaskForm.init(n, i, r, u, o, e)) } else alert("please download WSP !!!") } return { init: n } } n.AppointmentsForm = i() }(VIS, jQuery), function (n, t) { function i(i, r, u) { function uu() { var ii = t('<div class="input-group vis-input-wrap"><\/div>'), e = t('<div class="vis-control-wrap"><\/div>'), ri = null, u, a, v, y, b, ft, vt, yt, dt, gt; ri = t('<label class="vis-payment-spanPayment"> ' + n.Msg.translate(f, "PaymentMethod") + " <\/label>"); ii.append(e); p = t('<select class="vis-payment-cmbPayment"><\/select>'); p.appendTo(e); ri.appendTo(e); ii.appendTo(k); lt = t('<table class="vis-payment-table"><\/table>'); u = t("<tr><\/tr>"); lt.append(u); gi = t('<label class="vis-payment-span"> ' + n.Msg.translate(f, "CreditCardType") + "<\/label>"); nr = t('<label class="vis-payment-span">' + n.Msg.translate(f, "CreditCardNumber") + "<\/label>"); tr = t('<label class="vis-payment-span">' + n.Msg.translate(f, "Expires") + "<\/label>"); rr = t('<label class="vis-payment-span">' + n.Msg.translate(f, "VoiceAuthCode") + "<\/label>"); pt = t('<label class="vis-payment-span">' + n.Msg.translate(f, "Online") + "<\/label>"); pi = t('<label class="vis-payment-span"><\/label>'); s = t('<table class="vis-payment-table"><\/table>'); a = t("<tr><\/tr>"); s.append(a); ut = t('<table class="vis-payment-table"><\/table>'); a.append(ut); u.append(s); g = t('<select  class="vis-payment-cmb"><\/select>'); var hi = t("<tr><\/tr>"), ci = t('<td class="vis-payment-td2"><\/td>'), r = t('<div class="input-group vis-input-wrap">'), i = t('<div class="vis-control-wrap">'); i.append(g); i.append(gi); hi.append(ci); ci.append(r); r.append(i); ut.append(hi); d = t('<input class="vis-payment-inputs" type="text" placeholder=" " data-placeholder="" >'); var li = t("<tr><\/tr>"), ai = t('<td class="vis-payment-td2"><\/td>'), r = t('<div class="input-group vis-input-wrap">'), i = t('<div class="vis-control-wrap">'); i.append(d); i.append(nr); li.append(ai); ai.append(r); r.append(i); ut.append(li); wt = t('<input class="vis-payment-inputs"  type="text" placeholder=" " data-placeholder="" >'); var vi = t("<tr><\/tr>"), yi = t('<td class="vis-payment-td2"><\/td>'), r = t('<div class="input-group vis-input-wrap">'), i = t('<div class="vis-control-wrap">'); i.append(wt); i.append(tr); vi.append(yi); yi.append(r); r.append(i); ut.append(vi); bt = t('<input class="vis-payment-inputs"  type="text" placeholder=" " data-placeholder="" >'); var lr = t("<tr><\/tr>"), ar = t('<td class="vis-payment-td2"><\/td>'), r = t('<div class="input-group vis-input-wrap">'), i = t('<div class="vis-control-wrap">'); i.append(bt); i.append(rr); lr.append(ar); ar.append(r); r.append(i); ut.append(lr); pt = t('<button class="vis-payment-inputs-buttons"  type="button">' + n.Msg.translate(f, "Online") + "<\/button>"); v = t("<tr><\/tr>"); y = t("<td><\/td>"); y.append(pt); v.append(y); ut.append(v); ir = t('<label class="vis-payment-span"> ' + n.Msg.translate(f, "C_BP_BankAccount_ID") + "<\/label>"); wi = t('<p class="vis-payment-span"> <\/p>'); h = t('<table class="vis-payment-table"><\/table>'); b = t("<tr><\/tr>"); si = t('<table class="vis-payment-table"><\/table>'); h.append(b); b.append(si); u.append(h); et = t('<select class="vis-payment-cmb"><\/select>'); var vr = t("<tr><\/tr>"), yr = t('<td class="vis-payment-td2"><\/td>'), r = t('<div class="input-group vis-input-wrap">'), i = t('<div class="vis-control-wrap">'); i.append(et); i.append(ir); vr.append(yr); yr.append(r); r.append(i); si.append(vr); hr = t('<label class="vis-payment-span"> ' + n.Msg.translate(f, "C_BankAccount_ID") + "<\/label>"); di = t('<label class="vis-payment-span"> ' + n.Msg.translate(f, "Amount") + "<\/label>"); ti = t('<label class="vis-payment-span vis-payment-AmountField"> <\/label>'); fr = t('<label class="vis-payment-span"> ' + n.Msg.translate(f, "RoutingNo") + "<\/label>"); ur = t('<label class="vis-payment-span"> ' + n.Msg.translate(f, "AccountNo") + "<\/label>"); sr = t('<label class="vis-payment-span"> ' + n.Msg.translate(f, "CheckNo") + "<\/label>"); ui = t('<label class="vis-payment-span"> ' + n.Msg.translate(f, "C_Currency_ID") + "<\/label>"); bi = t('<p class="vis-payment-span"> <\/p>'); ei = t('<button class="vis-payment-inputs-buttons"  type="button">' + n.Msg.translate(f, "Online") + "<\/button>"); c = t('<table class="vis-payment-table"><\/table>'); ft = t("<tr><\/tr>"); w = t('<table class="vis-payment-table"><\/table>'); ft.append(w); c.append(ft); u.append(c); nt = t('<select class="vis-payment-cmb"><\/select>'); var pr = t("<tr><\/tr>"), wr = t('<td class="vis-payment-td2"><\/td>'), r = t('<div class="input-group vis-input-wrap">'), i = t('<div class="vis-control-wrap">'); i.append(nt); i.append(hr); pr.append(wr); wr.append(r); r.append(i); w.append(pr); ti = t('<input type="text" readonly class="vis-payment-span vis-payment-AmountField">'); var br = t("<tr><\/tr>"), kr = t('<td class="vis-payment-td2"><\/td>'), r = t('<div class="input-group vis-input-wrap">'), i = t('<div class="vis-control-wrap">'); i.append(ti); i.append(di); br.append(kr); kr.append(r); r.append(i); w.append(br); it = t('<input class="vis-payment-inputs" type="text" placeholder=" " data-placeholder="" >'); var dr = t("<tr><\/tr>"), gr = t('<td class="vis-payment-td2"><\/td>'), r = t('<div class="input-group vis-input-wrap">'), i = t('<div class="vis-control-wrap">'); i.append(it); i.append(fr); dr.append(gr); gr.append(r); r.append(i); w.append(dr); tt = t('<input class="vis-payment-inputs" type="text" placeholder=" " data-placeholder="" >'); var nu = t("<tr><\/tr>"), tu = t('<td class="vis-payment-td2"><\/td>'), r = t('<div class="input-group vis-input-wrap">'), i = t('<div class="vis-control-wrap">'); i.append(tt); i.append(ur); nu.append(tu); tu.append(r); r.append(i); w.append(nu); rt = t('<input class="vis-payment-inputs"  type="text" placeholder=" " data-placeholder="" >'); var iu = t("<tr><\/tr>"), ru = t('<td class="vis-payment-td2"><\/td>'), r = t('<div class="input-group vis-input-wrap">'), i = t('<div class="vis-control-wrap">'); i.append(rt); i.append(sr); iu.append(ru); ru.append(r); r.append(i); w.append(iu); ot = t('<select class="vis-payment-cmb"><\/select>'); var uu = t("<tr><\/tr>"), fu = t('<td class="vis-payment-td2"><\/td>'), r = t('<div class="input-group vis-input-wrap">'), i = t('<div class="vis-control-wrap">'); i.append(ot); i.append(ui); uu.append(fu); fu.append(r); r.append(i); w.append(uu); ei = t('<button class="vis-payment-inputs-buttons"  type="button">' + n.Msg.translate(f, "Online") + "<\/button>"); vt = t("<tr><\/tr>"); yt = t('<td colspan="2"><\/td>'); yt.append(ei); vt.append(yt); w.append(vt); er = t('<label class="vis-payment-span"> ' + n.Msg.translate(f, "C_PaymentTerm_ID") + "<\/label>"); l = t('<table  class="vis-payment-table"><\/table>'); dt = t("<tr><\/tr>"); oi = t('<table  class="vis-payment-table"><\/table>'); dt.append(oi); l.append(dt); u.append(l); ht = t('<select class="vis-payment-cmb"><\/select>'); var eu = t("<tr><\/tr>"), ou = t('<td class="vis-payment-td2"><\/td>'), r = t('<div class="input-group vis-input-wrap">'), i = t('<div class="vis-control-wrap">'); i.append(ht); i.append(er); eu.append(ou); ou.append(r); r.append(i); oi.append(eu); cr = t('<label class="vis-payment-span"> ' + n.Msg.translate(f, "C_CashBook_ID") + "<\/label>"); fi = t('<label class="vis-payment-span"> ' + n.Msg.translate(f, "C_Currency_ID") + "<\/label>"); ki = t('<label class="vis-payment-span"> ' + n.Msg.translate(f, "Amount") + "<\/label>"); ni = t('<label class="vis-payment-span vis-payment-AmountField"> <\/label>'); or = t('<label class="vis-payment-span"> ' + n.Msg.translate(f, "DateAcct") + "<\/label>"); o = t('<table class="vis-payment-table"><\/table>'); gt = t("<tr><\/tr>"); at = t('<table class="vis-payment-table"><\/table>'); gt.append(at); o.append(gt); u.append(o); st = t('<select class="vis-payment-cmb"><\/select>'); var su = t("<tr><\/tr>"), hu = t('<td class="vis-payment-td2"><\/td>'), r = t('<div class="input-group vis-input-wrap">'), i = t('<div class="vis-control-wrap">'); i.append(st); i.append(fi); su.append(hu); hu.append(r); r.append(i); at.append(su); ct = t('<select class="vis-payment-cmb"><\/select>'); var cu = t("<tr><\/tr>"), lu = t('<td class="vis-payment-td2"><\/td>'), r = t('<div class="input-group vis-input-wrap">'), i = t('<div class="vis-control-wrap">'); i.append(ct); i.append(cr); cu.append(lu); lu.append(r); r.append(i); at.append(cu); kt = t('<input class="vis-payment-inputs vis-payment-date" type="date" placeholder=" " data-placeholder="" >'); var au = t("<tr><\/tr>"), vu = t('<td class="vis-payment-td2"><\/td>'), r = t('<div class="input-group vis-input-wrap">'), i = t('<div class="vis-control-wrap">'); i.append(kt); i.append(or); au.append(vu); vu.append(r); r.append(i); at.append(au); ni = t('<input type="text" readonly class="vis-payment-span vis-payment-AmountField"> '); var yu = t("<tr><\/tr>"), pu = t('<td class="vis-payment-td2"><\/td>'), r = t('<div class="input-group vis-input-wrap">'), i = t('<div class="vis-control-wrap">'); i.append(ni); i.append(ki); yu.append(pu); pu.append(r); r.append(i); at.append(yu); k.append(lt) } function fu(i) { var f = !1; return (y = r.getValue("DocStatus"), r.getValue("C_BPartner_ID") == null) ? (n.ADialog.error("0", !0, n.Msg.getMsg("SaveErrorRowNotFound")), f = !1) : (y = r.getValue("DocStatus"), y == null && (y = ""), y.equals("RE") || y.equals("VO") || y.equals("CL")) ? f = !1 : (b = y.equals("CO") || y.equals("WP") ? !1 : !0, b || ii || r.getValue("M_Warehouse_ID") == null || (b = !0), b ? lt.hide() : lt.show(), _Amount = r.getValue("GrandTotal"), !b && _Amount == 0) ? (n.ADialog.error("", !0, n.Msg.getMsg("PaymentZero")), f = !1) : (vr = parseInt(r.getValue("AD_Client_ID")), yr = parseInt(r.getValue("AD_Org_ID")), pr = parseInt(r.getValue("C_BPartner_ID")), a = r.getValue("PaymentRule"), ri = parseInt(r.getValue("C_Currency_ID")), yt = r.getValue("DateAcct"), (r.getValue("C_PaymentTerm_ID") != null || r.getValue("C_PaymentTerm_ID") != {}) && (ft = parseInt(r.getValue("C_PaymentTerm_ID"))), r.getValue("C_Payment_ID") != null && r.getValue("C_Payment_ID") != {} && (li = parseInt(r.getValue("C_Payment_ID"))), r.getValue("C_CashLine_ID") != null && r.getValue("C_CashLine_ID") != {} && (ai = parseInt(r.getValue("C_CashLine_ID"))), e = { _DocStatus: y, _isSOTrx: ii, _AD_Client_ID: vr, _AD_Org_ID: yr, _C_BPartner_ID: pr, _PaymentRule: a, _C_Currency_ID: ri, _DateAcct: yt, _C_PaymentTerm_ID: ft, _C_Payment_ID: li, _C_CashLine_ID: ai, values: JSON.stringify(i), _Amount: _Amount }, t.ajax({ url: n.Application.contextUrl + "PaymentRule/LoadPaymentMethodDetails", type: "POST", async: !1, dataType: "Json", data: e, success: function (n) { var i, v, e, r; lr(!1); i = JSON.parse(n); ar = i.CCType; b ? lt.hide() : lt.show(); ni.val(_Amount); ti.val(_Amount); d.val(i.strKNumber); wt.val(i.strKExp); bt.val(i.strKApproval); pi.val(i.strKStatus); i.canChange && (g.attr("disable", !1), d.attr("disable", !1), wt.attr("disable", !1), bt.attr("disable", !1), pt.attr("disable", !1)); it.val(i.StrSRouting); tt.val(i.StrSNumber); rt.val(i.StrSCheck); bi.text(i.StrSStatus); wi.text(i.StrTStatus); yt != null && (kt.Value = yt); v = ri; i._Currencies != null && i._Currencies != undefined && i._Currencies[ri] ? (t.each(i._Currencies, function (n, i) { ot.append(t("<option><\/option>").attr("value", i.Key).text(i.Name)) }), t.each(i._Currencies, function (n, i) { st.append(t("<option><\/option>").attr("value", i.Key).text(i.Name)) })) : (fi.hide(), st.hide(), ui.hide(), ot.hide()); a == null && (a = ""); for (e in u.values) { if (r = e, dt.equals(r) && !ii) continue; else if (gt.equals(r) && ii) continue; p.append(t('<option value="' + r + '">' + u.values[e] + "<\/option>")); r.equals(a) && p.val(r) } return i.loadPaymentTerms != null && i.loadPaymentTerms != undefined && (t.each(i.loadPaymentTerms, function (n, i) { ht.append(t("<option><\/option>").attr("value", i.Key).text(i.Name)) }), ft != null && ft != undefined && ht.val(ft)), i.loadAccounts != null && i.loadAccounts != undefined && (t.each(i.loadAccounts, function (n, i) { et.append(t("<option><\/option>").attr("value", i.Key).text(i.Name)) }), i.kp != null && et.val(i.kp)), i.ccs != null && i.ccs != undefined && (t.each(i.ccs, function (n, i) { g.append(t("<option><\/option>").attr("value", i.Key).text(i.Name)) }), i.CCType != null && g.val(i.CCType)), i.loadBankAccounts != null && i.loadBankAccounts != undefined && (t.each(i.loadBankAccounts, function (n, i) { nt.append(t("<option><\/option>").attr("value", i.Key).text(i.Name)) }), i.kp != null && nt.val(i.kp)), i.Checkbook_ID != null && nt.val(i.Checkbook_ID), i.loadCashBooks != null && i.loadCashBooks != undefined && t.each(i.loadCashBooks, function (n, i) { ct.append(t("<option><\/option>").attr("value", i.Key).text(i.Name)) }), i.Checkbook_ID != null && (ct.val(i.Checkbook_ID), vi == 0 && (vi = i.Checkbook_ID)), a == "B" ? (s.hide(), l.hide(), o.show(), h.hide(), c.hide()) : a == "K" ? (s.show(), l.hide(), o.hide(), h.hide(), c.hide()) : a == "D" ? (s.hide(), l.hide(), o.hide(), h.show(), c.hide()) : a == "P" ? (s.hide(), l.show(), o.hide(), h.hide(), c.hide()) : a == "S" && (s.hide(), l.hide(), o.hide(), h.hide(), c.show()), f = !0 } }), f) } function eu(n) { if (n != undefined && !n) { v.close(); return } p.on("change", ou); ot.on("change", su); st.on("change", hu); pt.on("click", cu); v.onOkClick = function () { lr(!0); var n = lu(); n && (vt.isOKPressed = !0, vt.onClose && vt.onClose()) }; v.onCancelClick = function () { vt.onClose && vt.onClose() }; v.onClose = function () { vt.dispose() } } function ou() { var n = p.val(), t; n != null && (t = n.toLower(), (dt == t.toLower() || dt == t.toUpper()) && (t = gt.toLower()), t += "Panel", n.equals("K") ? (s.show(), l.hide(), o.hide(), h.hide(), c.hide()) : n.equals("B") ? (s.hide(), l.hide(), o.show(), h.hide(), c.hide()) : n.equals("D") ? (s.hide(), l.hide(), o.hide(), h.show(), c.hide()) : n.equals("P") ? (s.hide(), l.show(), o.hide(), h.hide(), c.hide()) : n.equals("S") ? (s.hide(), l.hide(), o.hide(), h.hide(), c.show()) : n.equals("T") && (s.hide(), l.hide(), o.hide(), h.hide(), c.hide())) } function su() { } function hu() { } function cu() { } function lu() { var o = !0, s = au(), u; return s ? (u = p.val(), u == null) ? void 0 : b && u ? (u.equals(a) || r.setValue("PaymentRule", u), o = !0) : (e.cmbPayment = p.val(), u.equals(wr) ? (e.cmbBCurrency = st.val(), e.cmbBCashBook = ct.val(), e.bDateField = kt.val()) : u.equals(br) ? (e.cmbKType = g.val(), e.txtKNumber = d.val(), e.txtKExp = wt.val(), e.txtKApproval = bt.val()) : u.equals(gt) ? e.cmbTAccount = et.val() : u.equals(kr) ? e.cmbPTerm = ht.val() : u.equals(yi) && (e.cmbSBankAccount = nt.val(), e.txtSRouting = it.val(), e.txtSNumber = tt.val(), e.txtSCheck = rt.val(), e.cmbSCurrency = ot.val()), e.C_Order_ID = f.getContextAsInt(i, "C_Order_ID"), e.C_Invoice_ID = f.getContextAsInt(i, "C_Invoice_ID"), t.ajax({ url: n.Application.contextUrl + "PaymentRule/SaveChanges", type: "POST", async: !1, dataType: "Json", data: e, success: function (n) { var t = JSON.parse(n); return t.ErrorMsg != null && t.ErrorMsg != "" && t.ErrorMsg != undefined && alert(t.ErrorMsg), t.SucessMsg != null && t.SucessMsg != "" && t.SucessMsg != undefined && alert(t.SucessMsg), t.newPaymentRule == null || t.newPaymentRule == undefined || t.newPaymentRule.equals(a) || r.setValue("PaymentRule", t.newPaymentRule), t.newDateAcct == null || t.newDateAcct == undefined || t.newDateAcct.equals(yt) || r.setValue("DateAcct", t.newDateAcct), t.newC_PaymentTerm_ID != ft && t.newC_PaymentTerm_ID > 0 && r.setValue("C_PaymentTerm_ID", t.newC_PaymentTerm_ID), t._C_Payment_ID != li && (t._C_Payment_ID == 0 ? r.setValue("C_Payment_ID", null) : r.setValue("C_Payment_ID", t._C_Payment_ID)), t._C_CashLine_ID != ai && (t._C_CashLine_ID == 0 ? r.setValue("C_CashLine_ID", null) : r.setValue("C_CashLine_ID", t._C_CashLine_ID)), o = !0 }, error: function () { return o = !1 } }), o) : o = !1 } function au() { var i = !0, u, t, s, r, f; try { if (u = p.val(), u == null || u == undefined) return !1; if (t = u, b) return !0; var h = yt, o = ft, c = vi, l = ar, e = 0; if (t.equals(wr)) c = ct.val(), h = kt.val(); else if (t.equals(br)) l = g.val(), (d.val() == null || d.val() == "" || d.val() == undefined) && (n.ADialog.error("", !0, n.Msg.getMsg("CreditCardNumberError")), i = !1); else if (t.equals(gt) || t.equals(dt)) s = et.val(), s == null && (n.ADialog.error("", !0, n.Msg.getMsg("PaymentBPBankNotFound")), i = !1); else if (t.equals(kr)) o = ht.val(), r != null && (o = r); else if (t.equals(yi)) r = nt.val(), r != null && (e = r), (it.val() == null || it.val() == "" || it.val() == undefined) && (n.ADialog.error("", !0, n.Msg.getMsg("PaymentBankRoutingNotValid")), i = !1), (tt.val() == null || tt.val() == "" || tt.val() == undefined) && (n.ADialog.error("", !0, n.Msg.getMsg("PaymentBankAccountNotValid")), i = !1), (rt.val() == null || rt.val() == "" || rt.val() == undefined) && (n.ADialog.error("", !0, n.Msg.getMsg("PaymentBankCheckNotValid")), i = !1); else return !1; "KTSD".indexOf(t) != -1 && e == 0 && (f = gr, t.equals(gt) ? f = dr : t.equals(dt) ? f = nu : t.equals(yi) && (f = tu), e == 0 && "S".equals(t) && (n.ADialog.error("", !0, n.Msg.getMsg("PaymentNoProcessor")), i = !1)) } catch (a) { log.Severe(a.ToString()) } return i } function lr(n) { n ? (hi.show(), k.find("button").prop("disabled", !0)) : (hi.hide(), k.find("button").prop("disabled", !1)) } var vt = this, f = n.Env.getCtx(), ci = !1, ii = n.context.isSOTrx(i), y = null, a = "", ri = 0, yt = null, ft = 0, li = 0, ai = 0, vi = 0, ar = "", pi, wi, bi, ki, ni, di, ti, iu, gi, nr, tr, ir, rr, ur, fr, ui, fi, er, or, sr, hr, cr, p, g, et, ot, st, ht, nt, ct, pt, ei, d, wt, bt, tt, it, rt, kt, lt, at, oi, ru, ut, si, w, hi; this.log = n.Logging.VLogger.getVLogger("vPayment"); var vr = 0, yr = 0, pr = 0, e = {}, wr = "B", dt = "D", br = "K", kr = "P", yi = "S", gt = "T", dr = "A", gr = "C", nu = "D", tu = "K", b = !1, k, v = null, o, s, h, c, l; this.onClose = null; hi = t('<div class="vis-busyindicatorouterwrap"><div class="vis-busyindicatorinnerwrap"><i class="vis-busyindicatordiv"><\/i><label>' + n.Msg.getMsg("Loading") + "<\/label><\/div><\/div>"); this.init = function () { uu(); ci = fu(u.values); eu(ci) }; this.isInitOK = function () { return ci }; this.show = function () { v = new n.ChildDialog; k = t('<div class="vis-formouterwrpdiv"><\/div>'); k.append(hi); lr(!0); v.setContent(k); v.setWidth(360); v.setTitle(n.Msg.getMsg("Payment")); v.setModal(!0); v.show() }; this.onClose = null; this.dispose = function () { k != null && (k = null); v = null; o = null; s = null; h = null; c = null; l = null; this.onClose = null; pi = null; wi = null; bi = null; ki = null; ni = null; di = null; ti = null; iu = null; gi = null; nr = null; tr = null; ir = null; rr = null; ur = null; fr = null; ui = null; fi = null; er = null; or = null; sr = null; hr = null; cr = null; p = null; g = null; et = null; ot = null; st = null; ht = null; nt = null; ct = null; pt = null; ei = null; d = null; wt = null; bt = null; tt = null; it = null; rt = null; kt = null; at = null; oi = null; ru = null; ut = null; si = null; w = null } } n.VPayment = i }(VIS, jQuery), function (n, t) { function rt(rt) { function et(n) { w[0].style.visibility = n ? "visible" : "hidden" } function gt() { b.on(n.Events.onClick, function () { d.text(" "); ti() }); k.on(n.Events.onClick, function () { dt(); ii() }); h.fireValueChanged = function (n) { ft(h); h.setValue(n.newValue) }; s.fireValueChanged = function (n) { ft(s); s.setValue(n.newValue) }; r.fireValueChanged = function (n) { ft(r); r.setValue(n.newValue) }; c.fireValueChanged = function (n) { c.setValue(n.newValue) }; u.fireValueChanged = function (n) { ft(u); u.setValue(n.newValue) }; f.fireValueChanged = function (n) { ft(f); f.setValue(n.newValue) }; e.fireValueChanged = function (n) { ft(e); e.setValue(n.newValue) }; l.fireValueChanged = function (n) { l.setValue(n.newValue) }; a.fireValueChanged = function (n) { a.setValue(n.newValue) }; v.fireValueChanged = function (n) { v.setValue(n.newValue) }; y.fireValueChanged = function (n) { y.setValue(n.newValue) }; p.fireValueChanged = function (n) { p.setValue(n.newValue) } } function ft(n) { n.getValue() != null && n.getValue() != "" ? n.getControl().removeClass("vis-ev-col-mandatory") : n.getControl().addClass("vis-ev-col-mandatory") } function ni(i) { o = new n.ChildDialog; o.setContent(i); var r = t(window).width(); r >= 1366 ? o.setWidth(870) : o.setWidth(670); o.setTitle(n.Msg.getMsg("AddProduct")); o.setEnableResize(!0); o.setModal(!0); o.show(); o.hideButtons(); o.getRoot().dialog({ position: [200, 130] }) } function ti() { var i = !1, o = n.Msg.getMsg("FillMandatory") + " ", w; if (h.getValue().trim().length == 0 && (o += n.Msg.getMsg("EnterSearchKey") + ", ", i = !0), s.getValue().trim().length == 0 && (o += n.Msg.getMsg("Name") + ", ", i = !0), (r.getValue() == 0 || r.getValue() == null) && (o += n.Msg.getMsg("UomName") + ", ", i = !0), (u.getValue() == 0 || u.getValue() == null) && (o += n.Msg.getMsg("VIS_Product_Type") + ", ", i = !0), (f.getValue() == 0 || f.getValue() == null) && (o += n.Msg.getMsg("VIS_Product_Category") + ", ", i = !0), (e.getValue() == 0 || e.getValue() == null) && (o += n.Msg.getMsg("VIS_Tax_Category") + ", ", i = !0), i) return n.ADialog.error("", "", o.slice(0, -2)), !1; w = { searchKey: h.getValue(), name: s.getValue(), uom: r.getValue(), upc: c.getValue(), proType: u.getValue(), proCategory: f.getValue(), taxCategory: e.getValue(), attribute: l.getValue(), purchased: a.getValue(), sold: v.getValue(), stocked: y.getValue(), description: p.getValue() }; et(!0); t.ajax({ url: n.Application.contextUrl + "AddProduct/AddNewProduct", type: "POST", data: w, success: function (t) { t == "OK" ? (d.text(n.Msg.getMsg("VIS_Product_Save")), dt()) : (et(!1), d.text(t)) }, error: function (t) { et(!1); var r = (new DOMParser).parseFromString(t.responseText, "text/html"), i = r.querySelector("title").textContent; i.length <= 0 && i == null && (i = n.Msg.getMsg("VIS_SomethingWentWrong")); n.ADialog.error(i) } }) } function dt() { et(!1); h.setValue(""); s.setValue(""); r.setValue(""); c.setValue(""); u.setValue(""); f.setValue(""); e.setValue(""); l.setValue(""); p.setValue(""); a.setValue(!1); v.setValue(!1); y.setValue(!1); h.getControl().addClass("vis-ev-col-mandatory"); s.getControl().addClass("vis-ev-col-mandatory"); r.getControl().addClass("vis-ev-col-mandatory"); u.getControl().addClass("vis-ev-col-mandatory"); f.getControl().addClass("vis-ev-col-mandatory"); e.getControl().addClass("vis-ev-col-mandatory") } function ii() { o.close(); ut != null && ut.remove(); ut = null; b && b.off(n.Events.onClick); b = null; k && k.off(n.Events.onClick); k = null; s = null; h = null; r = null; g = null; c = null; u = null; nt = null; f = null; lookupProductCategory = null; e = null; tt = null; l = null; it = null; a = null; v = null; y = null; p = null } var ut = t("<div>"); w = t("<div class='vis-apanel-busy'>"); w.css({ position: "absolute", width: "98%", height: "97%", "text-align": "center", "z-index": "999" }); ut.append(w); ut.append('<div class="VIS_Pref_show vis-formouterwrpdiv"><div class= "VIS_Pref_dd"><div class="input-group vis-input-wrap" id="Value_' + i.windowNo + '"><\/div><\/div><div class= "VIS_Pref_dd"><div class="input-group vis-input-wrap" id="Name_' + i.windowNo + '"><\/div><\/div><\/div>'); ut.append('<div class="VIS_Pref_show vis-formouterwrpdiv"><div class= "VIS_Pref_dd"><div class="input-group vis-input-wrap" id="C_UOM_ID_' + i.windowNo + '"><\/div><\/div><div class= "VIS_Pref_dd"><div class="input-group vis-input-wrap" id="UPC_' + i.windowNo + '"><\/div><\/div><\/div>'); ut.append('<div class="VIS_Pref_show vis-formouterwrpdiv"><div class= "VIS_Pref_dd"><div class="input-group vis-input-wrap" id="ProductType_' + i.windowNo + '"><\/div><\/div><div class= "VIS_Pref_dd"><div class="input-group vis-input-wrap" id="M_Product_Category_ID_' + i.windowNo + '"><\/div><\/div><\/div>'); ut.append('<div class="VIS_Pref_show vis-formouterwrpdiv"><div class= "VIS_Pref_dd"><div class="input-group vis-input-wrap" id="C_TaxCategory_ID_' + i.windowNo + '"><\/div><\/div><div class= "VIS_Pref_dd"><div class="input-group vis-input-wrap" id="M_AttributeSet_ID_' + i.windowNo + '"><\/div><\/div><\/div>'); ut.append('<div class="VIS_Pref_show vis-formouterwrpdiv"><div class= "VIS_Pref_dd"><div class="input-group vis-input-wrap" id="IsPurchased_' + i.windowNo + '"><\/div><\/div><div class= "VIS_Pref_dd"><div class="input-group vis-input-wrap" id="IsSold_' + i.windowNo + '"><\/div><\/div><div class= "VIS_Pref_dd"><div class="input-group vis-input-wrap" id="IsStocked_' + i.windowNo + '"><\/div><\/div><\/div>'); ut.append('<div class="VIS_Pref_show vis-formouterwrpdiv"><div class= "VIS_Pref_dd p-0"><div class="input-group vis-input-wrap vis-ev-full-h" id="Description_' + i.windowNo + '"><\/div><\/div><\/div>'); ut.append('<div class="vis-ctrfrm-btnwrp"><input id="closeBtn' + i.windowNo + '" class= "VIS_Pref_btn-2" type = "button" value = "' + n.Msg.getMsg("close") + '"><input id="okBtn_' + i.windowNo + '" class="VIS_Pref_btn-2" type="button" value="' + n.Msg.getMsg("OK") + '"><div class="vis-ad-w-p-s-main pull-left"><div class="vis-ad-w-p-s-infoline"><\/div><div class="vis-ad-w-p-s-msg" style="align-items:flex-end;" id="lblBottomMsg_' + i.windowNo + '"><\/div><\/div><\/div>'); srcCtrl = ut.find("#Value_" + i.windowNo); nameCtrl = ut.find("#Name_" + i.windowNo); uomCtrl = ut.find("#C_UOM_ID_" + i.windowNo); upcCtrl = ut.find("#UPC_" + i.windowNo); pTypeCtrl = ut.find("#ProductType_" + i.windowNo); pCatCtrl = ut.find("#M_Product_Category_ID_" + i.windowNo); taxCtrl = ut.find("#C_TaxCategory_ID_" + i.windowNo); attCtrl = ut.find("#M_AttributeSet_ID_" + i.windowNo); purCtrl = ut.find("#IsPurchased_" + i.windowNo); soldCtrl = ut.find("#IsSold_" + i.windowNo); stockCtrl = ut.find("#IsStocked_" + i.windowNo); desCtrl = ut.find("#Description_" + i.windowNo); k = ut.find("#closeBtn" + i.windowNo); b = ut.find("#okBtn_" + i.windowNo); d = ut.find("#lblBottomMsg_" + i.windowNo); var ot = t('<div class="vis-control-wrap">'), st = t('<div class="vis-control-wrap">'), ht = t('<div class="vis-control-wrap">'), ct = t('<div class="vis-control-wrap">'), lt = t('<div class="vis-control-wrap">'), at = t('<div class="vis-control-wrap">'), vt = t('<div class="vis-control-wrap">'), yt = t('<div class="vis-control-wrap">'), pt = t('<div class="vis-control-wrap">'), wt = t('<div class="vis-control-wrap">'), bt = t('<div class="vis-control-wrap">'), kt = t('<div class="vis-control-wrap">'); h = new n.Controls.VTextBox("Value", !0, !1, !0); srcCtrl.append(ot); ot.append(h.getControl().attr("placeholder", " ").attr("data-placeholder", "").attr("autocomplete", "off")).append("<label>" + n.Msg.getMsg("EnterSearchKey") + "<\/label>"); s = new n.Controls.VTextBox("Name", !0, !1, !0); nameCtrl.append(st); st.append(s.getControl().attr("placeholder", " ").attr("data-placeholder", "").attr("autocomplete", "off")).append("<label>" + n.Msg.getMsg("Name") + "<\/label>"); g = n.MLookupFactory.get(n.Env.getCtx(), rt, 0, n.DisplayType.TableDir, "C_UOM_ID", 0, !0, "IsActive='Y'"); r = new n.Controls.VComboBox("C_UOM_ID", !0, !1, !0, g); uomCtrl.append(ht); ht.append(r.getControl()).append("<label>" + n.Msg.getMsg("UomName") + "<\/label>"); c = new n.Controls.VTextBox("UPC", !1, !1, !0); upcCtrl.append(ct); ct.append(c.getControl().attr("placeholder", " ").attr("data-placeholder", "").attr("autocomplete", "off")).append("<label>" + n.Msg.getMsg("VIS_UPC_EAN") + "<\/label>"); nt = n.MLookupFactory.get(n.Env.getCtx(), rt, 0, n.DisplayType.List, "ProductType", 270, !0, "IsActive='Y'"); u = new n.Controls.VComboBox("ProductType", !0, !1, !0, nt); pTypeCtrl.append(lt); lt.append(u.getControl()).append("<label>" + n.Msg.getMsg("VIS_Product_Type") + "<\/label>"); lookupProductCategory = n.MLookupFactory.get(n.Env.getCtx(), rt, 0, n.DisplayType.TableDir, "M_Product_Category_ID", 0, !0, "IsActive='Y'"); f = new n.Controls.VComboBox("M_Product_Category_ID", !0, !1, !0, lookupProductCategory); pCatCtrl.append(at); at.append(f.getControl()).append("<label>" + n.Msg.getMsg("VIS_Product_Category") + "<\/label>"); tt = n.MLookupFactory.get(n.Env.getCtx(), rt, 0, n.DisplayType.TableDir, "C_TaxCategory_ID", 0, !0, "IsActive='Y'"); e = new n.Controls.VComboBox("C_TaxCategory_ID", !0, !1, !0, tt); taxCtrl.append(vt); vt.append(e.getControl()).append("<label>" + n.Msg.getMsg("VIS_Tax_Category") + "<\/label>"); it = n.MLookupFactory.get(n.Env.getCtx(), rt, 0, n.DisplayType.TableDir, "M_AttributeSet_ID", 0, !0, "IsActive='Y'"); l = new n.Controls.VComboBox("M_AttributeSet_ID", !1, !1, !0, it); attCtrl.append(yt); yt.append(l.getControl()).append("<label>" + n.Msg.getMsg("VIS_Attribute_Set") + "<\/label>"); a = new n.Controls.VCheckBox("IsPurchased", !1, !1, !0, n.Msg.getMsg("VIS_Is_Purchased"), null, !1); purCtrl.append(pt); pt.append(a.getControl().addClass("vis-ec-col-lblchkbox")); v = new n.Controls.VCheckBox("IsSold", !1, !1, !0, n.Msg.getMsg("VIS_Is_Sold"), null, !1); soldCtrl.append(wt); wt.append(v.getControl().addClass("vis-ec-col-lblchkbox")); y = new n.Controls.VCheckBox("IsStocked", !1, !1, !0, n.Msg.getMsg("VIS_Is_Stocked"), null, !1); stockCtrl.append(bt); bt.append(y.getControl().addClass("vis-ec-col-lblchkbox")); p = new n.Controls.VTextArea("Description", !1, !1, !0); desCtrl.append(kt); kt.append(p.getControl().attr("placeholder", " ").attr("data-placeholder", "")).append("<label>" + n.Msg.getMsg("Description") + "<\/label>"); gt(); ni(ut); et(!1) } var i = this, s = null, h = null, r = null, g = null, c = null, u, nt = null, f = null, e = null, tt = null, l = null, it = null, a = null, v = null, y = null, p = null, d = t("<label><\/label>"), w = null, o = null, b, k; n.AddUpdateMProduct = rt }(VIS, jQuery), function (n, t) { function i(i, u, f) { function yt() { var r = '<div class="vis-BatchUpdateContentArea" > <div class="vis-advanedSearch-InputsWrap vis-advs-inputwraps ">  <div class="vis-form-group vis-advancedSearchInput vis-advancedSearchInput-v">    <label id="lblSetColumn_' + i + '"  for="Column">' + n.Msg.getMsg("Column") + '<\/label>  <select id="drpSetColumn_' + i + '"><\/select><\/div><div class="vis-form-group vis-advancedSearchInput vis-advancedSearchInput-op"><label id="lblSetOperator_' + i + '" for="Oprator">' + n.Msg.getMsg("Operator") + '<\/label><input id="drpSetOperator_' + i + '"value="=" disabled><\/div> <div class="vis-form-group vis-advancedSearchInput vis-advancedSearchInput-v" id="divSetValue1_' + i + '">   <label  id="lblSetQryValue_' + i + '" for="QueryValue">' + n.Msg.getMsg("QueryValue") + '<\/label> <input class="vis-batchUpdate-font" id="txtSetQryValue_' + i + '" type="text" name="QueryValue"><\/div><div class="vis-advancedSearch-calender-Icon "><ul><li class=""><button id="btnSetSave_' + i + '" disabled class="vis-ads-icon"><i class="vis vis-plus" aria-hidden="true"><\/i><\/button><\/li><\/ul><\/div><\/div><div class="vis-advanedSearch-InputsWrap vis-advs-inputwraps vis-batchUpdate-inputwrap"><table id="tblSetValue_' + i + '" rules="rows" class="vis-advancedSearchTable"><thead><tr class="vis-advancedSearchTableHeadBatch"><th>' + n.Msg.translate(n.Env.getCtx(), "AD_Column_ID") + "<\/th><th>" + n.Msg.translate(n.Env.getCtx(), "QueryValue") + '<\/th><th class="vis-batchUpdate-deletewrap">' + n.Msg.translate(n.Env.getCtx(), "Action") + "<\/th><\/tr><\/thead><div><tbody><\/tbody><\/div><\/table><\/div><\/div>"; r += '<div class="vis-advcedfooterBtn vis-batchUpdate-footerbtn"><div class="vis-ctrfrm-btnwrp"><button id="btnCancel_' + i + '" class="ui-button ui-widget vis-pull-right ml-2 mr-2" style="border-radius: 0.1rem">' + n.Msg.getMsg("close") + '<\/button><button id="btnOk_' + i + '" class="ui-button ui-widget vis-pull-right ml-2" style="border-radius: 0.1rem">' + n.Msg.getMsg("Apply") + '<\/button><div class="vis-ad-w-p-s-main pull-left"><div class="vis-ad-w-p-s-infoline"><\/div><div class="vis-ad-w-p-s-msg" style="align-items:flex-end;" id="divMessage_' + i + '"><\/div><\/div><\/div><\/div>'; nt = t("<div class='vis-apanel-busy'>"); nt.css({ position: "absolute", width: "98%", height: "97%", "text-align": "center", "z-index": "999" }); e.append(nt); e.append(r); pt(); wt() } function rt(n) { nt[0].style.visibility = n ? "visible" : "hidden" } function pt() { var o, u, c, t, l, r, f; for (h = e.find("#drpSetColumn_" + i), p = e.find("#divSetValue1_" + i), w = e.find("#lblSetQryValue_" + i), v = e.find("#tblSetValue_" + i), s = e.find("#drpColumn_" + i), a = e.find("#drpOperator_" + i), b = e.find("#btnSave_" + i), it = e.find("#btnSetSave_" + i), k = e.find("#btnOk_" + i), d = e.find("#btnCancel_" + i), g = e.find("#divMessage_" + i), o = '<option value="-1"> <\/option>', u = [], c = 0; c < y.length; c++)(t = y[c], l = t.getColumnName(), t.getDisplayType() != n.DisplayType.Image && t.getDisplayType() != n.DisplayType.Button) && (r = t.getHeader(), r != null && r.length != 0 || (r = n.Msg.getElement(n.context, l), r != null && r.Length != 0)) && t.vo.IsUpdateable && (t.getIsKey() || t.getIsReadOnly() || !t.getIsDisplayed() || t.getIsEncrypted() || t.getCallout() != "" || u.push({ value: l, text: r })); for (u.sort(function (n, t) { var i = n.text.toUpperCase(), r = t.text.toUpperCase(); return i > r ? 1 : i < r ? -1 : 0 }), f = 0; f < u.length; f++)o += '<option value="' + u[f].value + '">' + u[f].text + "<\/option>"; h.html(o); s.html(o) } function wt() { h.on("change", function () { var t = h.val(), i, r; ut(!0); t && t != "-1" && (i = u.getField(t), e.find(".vis-advancedSearchContentArea-down").css("height", "calc(100% - 150px)"), l.getIsUserColumn(t) && e.find(".vis-advancedSearchContentArea-down").css("height", "calc(100% - 195px)"), i.getDisplayType() == n.DisplayType.YesNo ? w.hide() : w.show(), r = ft(t), et(!0, r, p), st(it, !0)); lt(!0, p) }); s.on("change", function () { var t = s.val(), i, r, f; ut(!0); t && t != "-1" && (i = null, i = t.endsWith("_ID") || t.endsWith("_Acct") || t.endsWith("_ID_1") || t.endsWith("_ID_2") || t.endsWith("_ID_3") ? l.getOperatorsQuery(n.Query.prototype.OPERATORS_ID) : t.startsWith("Is") ? l.getOperatorsQuery(n.Query.prototype.OPERATORS_YN) : l.getOperatorsQuery(n.Query.prototype.OPERATORS), r = u.getField(t), e.find(".vis-advancedSearchContentArea-down").css("height", "calc(100% - 150px)"), l.getIsUserColumn(t) && e.find(".vis-advancedSearchContentArea-down").css("height", "calc(100% - 195px)"), r.getDisplayType() == n.DisplayType.YesNo ? ot.hide() : ot.show(), a.html(i), a[0].SelectedIndex = 0, f = ft(t), et(!0, f, tt), st(b, !0), a.prop("disabled", !1)); lt(!0, tt) }); a.on("change", function () { var t = a.val(), i, r; t || (t = ""); i = s.val(); r = ft(i); t && t != "0" ? n.Query.prototype.BETWEEN.equals(t) ? et(!1, r, tt) : (i = s.val(), r = ft(i)) : (st(b, !1), ut(!0)) }); it.on("click", dt); b.on("click", kt); k.on("click", function () { gt(); u.dataRefreshAll() }); d.on("click", function () { vt() }) } function ut() { var n = null; n = c; n != null && n.setValue(null) } function lt(n, i) { var u = i.children()[1], r = null; i.children().length > 2 && (r = i.children()[2]); r ? t(r).prop("disabled", !n).prop("readonly", !n) : u != null && t(u).prop("disabled", !n).prop("readonly", !n) } function ft(n) { var t, i; if (n == null || n.length == 0) return null; for (t = 0; t < y.length; t++)if (i = y[t], n.equals(i.getColumnName())) return i; return null } function st(n, t) { n.prop("disabled", !t) } function et(i, r, u) { var e, s, f, o; c = null; e = null; s = null; i && (e = u.children()[1], u.children().length > 2 && (s = u.children()[2])); e != null && (t(e).remove(), s != null && t(s).remove(), e = null); f = null; f = r != null ? r.getIsKey() ? new n.Controls.VNumTextBox(r.getColumnName(), !1, !1, !0, r.getDisplayLength(), r.getFieldLength(), r.getColumnName()) : n.VControlFactory.getControl(null, r, !0, !1, !1) : new n.Controls.VTextBox("columnName", !1, !0, !1, 20, 20, "format", "GetObscureType", !1); f != null && r != null ? (f.setReadOnly(!1), r.getDisplayType() == n.DisplayType.AmtDimension && (f.hideButton(!1), f.setReadOnlyTextbox(!1)), n.DisplayType.Text == r.getDisplayType() || n.DisplayType.TextLong == r.getDisplayType() ? (f.getControl().attr("rows", "1"), f.getControl().css("width", "100%")) : n.DisplayType.YesNo == r.getDisplayType() ? f.getControl().css("clear", "both") : n.DisplayType.IsDate(r.getDisplayType()) && f.getControl().css("line-height", "1"), o = null, f.getBtnCount() > 0 && !(f instanceof n.Controls.VComboBox) && (o = f.getBtn(0)), i && (u.append(f.getControl()), c = f, o && (u.append(o), f.getControl().css("width", "calc(100% - 30px)"), o.css("max-width", "30px"))), r.getDisplayType() == n.DisplayType.AmtDimension && f.getControl().css("width", "100%")) : (u.append(f.getControl()), w.show()) } function bt(t) { var i = null; return (t && (i = c), i != null) ? i.getDisplayType() == n.DisplayType.YesNo ? i.getValue().toString().toLowerCase() == "true" ? "Y" : "N" : i.displayType == n.DisplayType.AmtDimension ? i.getText() : i.getValue() : "" } function at() { var n = null; return (n = c, n != null) ? n.getDisplayType() : 0 } function kt() { var n = s.val(), t, i; if (!n || n == "-1" || (t = s.find("option:selected").text(), i = "", t == null || t.trim().length == 0)) return !1; i = n.toString(); v.find('tbody [data-cVal="' + n + '"]').length > 0 } function dt() { var t = h.val(), r, u, i, f; if (!t || t == "-1" || (r = h.find("option:selected").text(), u = "", r == null || r.trim().length == 0)) return !1; if (u = t.toString(), v.find('tbody [data-cVal="' + t + '"]').length > 0) { n.ADialog.info("AlreadyAdded"); return } i = bt(!0); at() == n.DisplayType.Date && (i = i.replace("Z", "")); f = '<tr class="vis-advancedSearchTableRowBatch"><td data-cVal="' + t + '">' + r + '<\/td><td data-settype="' + at() + '" data-setVal="' + i + '">' + i + '<\/td><td class="vis-batchUpdate-deletewrap"><i style="cursor:pointer;" class="vis vis-delete" onclick="$(this).closest(\'tr\').remove()"><\/i><\/td><\/tr>'; v.find("tbody").append(f); et(!0, null, p); h.val(-1); ut(!0) } function gt() { var e = [], o = [], i, s; if (v.find("tbody tr").each(function () { e.push({ column: t(this).find("td:eq(0)").data("cval"), setValue: t(this).find("td:eq(1)").data("setval"), setType: t(this).find("td:eq(1)").data("settype") }) }), e.length == 0) return g.text(n.Msg.getMsg("VIS_AddAction")); for (i = 0; i < f.length; i++)o.push(f[i][(ct + "_ID").toLower()]); s = { AD_Table_ID: ht, setValue: e, recordIds: o }; n.ADialog.confirm("UpdateRecord", !0, "", "Confirm", function (n) { if (n) rt(!0), t.ajax({ url: r + "BatchUpdate/ExcuteBatchUpdate", type: "POST", datatype: "json", contentType: "application/json; charset=utf-8", async: !1, data: JSON.stringify(s), success: function (n) { n == "OK" ? (u.dataRefreshAll(), vt()) : (g.text(n), rt(!1)) }, error: function (n) { g.text(n) } }); else return }) } function vt() { o.close(); e && e.remove(); e = null; k && k.off(n.Events.onClick); k = null; d && d.off(n.Events.onClick); d = null; ht = null; ct = null; y = null; c = null; o = null; h = null; p = null; w = null; s = null; a = null; tt = null; ot = null; b = null; it = null; v = null; g = null; rt(!1) } var ht = u.getAD_Table_ID(), ct = u.getTableName(), y = u.getFields(); this.btnfields = []; var c, e = t("<div class='vis-forms-container'>"), l = this, o = null; this.onClose = null; var h = null, p = null, w = null, s = null, a = null, tt = null, ot = null, b = null, it = null, v = null, k, d, g = null, nt = null; yt(); this.show = function () { o = new n.ChildDialog; var i = t(window).width(); i >= 1366 ? (o.setHeight(550), o.setWidth(870)) : (o.setHeight(450), o.setWidth(670)); o.setTitle(n.Msg.getMsg("BatchUpdate")); o.setEnableResize(!0); o.setModal(!0); o.onClose = function () { l.onClose(); l.dispose() }; o.show(); o.setContent(e); o.hideButtons(); rt(!1) }; this.disposeComponent = function () { e && e.remove(); e = null } } var r = n.Application.contextUrl; i.prototype.getOperatorsQuery = function (t, i) { var u = "", r = ""; for (var f in t) r = t[f], i && (r = n.Msg.getMsg(r)), u += '<option value="' + f + '">' + r + "<\/option>"; return u }; i.prototype.getIsUserColumn = function (n) { return n.endsWith("atedBy") || n.equals("AD_User_ID") ? !0 : n.equals("SalesRep_ID") ? !0 : !1 }; i.prototype.getIsCreated = function () { return this.created }; i.prototype.dispose = function () { this.disposeComponent() }; n.BatchUpdate = i }(VIS, jQuery), function (n, t) { function i() { function c() { var t = '<div style="width: 400px;margin: 20px auto;vertical-align: middle;"><div style="width: 400px;float: left;"><div style="width: 100px;float: left;   margin-top: 8px;"><span>' + n.Msg.getMsg("VISPRO_SelectTable") + '<\/span><\/div><div style="width: 300px;float: left;"><select style="width: 100%;float: left;" class="VIS_Pref_pass" id="cmbAllTable_@windowNo"><\/select><\/div><\/div><div style="float: left;margin-left: 5px;margin-top: 7px; display: none;"><input id="chkAllTable_@windowNo" type="checkbox" /><span>' + n.Msg.getMsg("VISPRO_AllTable") + '<\/span><\/div><div style="width: 400px;float: left; display: none;"><div style="width: 100px;float: left;"><span>' + n.Msg.getMsg("VISPRO_Path") + '<\/span><\/div><div style="width: 300px;float: left;"><input style="width: 81%;float: left;" class="VIS_Pref_pass" type="text" id="txtpath_@windowNo" /><input type="file" multiple="" webkitdirectory="" style="height: -1px; width:30px "><\/div><\/div><div style="width: 400px;float: left; display: none;"><div style="width: 100px;float: left;"><span>' + n.Msg.getMsg("VISPRO_EntityType") + '<\/span><\/div><div style="width: 300px;float: left;"><input id="chkClassType_@windowNo" type="checkbox" /><span>' + n.Msg.getMsg("VISPRO_ClassType") + '<\/span><\/div><\/div><div class="VIS-locator-DivStyle" style="text-align: right"><input type="button" id="btnCancel_@windowNo" style="margin-bottom:0px;margin-top:0px; float:right " value="' + n.Msg.getMsg("Cancel") + '" class="VIS_Pref_btn-2" /><input type="button" id="btnOk_@windowNo" style="margin-bottom:0px;margin-top:0px; float:right; margin-right:10px" class="VIS_Pref_btn-2" value="' + n.Msg.getMsg("VIS_Genrate") + '" /><a href="javascript:void(0)" class="VIS_Pref_pass-btn" style="display: none; margin-bottom: 0px; margin-top: 0px;float: right; margin-right: 10px;" id="btnOkA_@windowNo" >' + n.Msg.getMsg("VIS_Download") + "<\/a><\/div><\/div>"; t = t.replaceAll("@windowNo", i.windowNo); r.html(t); r.append(s); u = r.find("#btnOk_" + i.windowNo); e = r.find("#btnCancel_" + i.windowNo); f = r.find("#btnOkA_" + i.windowNo); h = r.find("#cmbAllTable_" + i.windowNo); chkAllTable = r.find("#chkAllTable_" + i.windowNo); txtpath = r.find("#txtpath_" + i.windowNo); chkClassType = r.find("#chkClassType_" + i.windowNo) } function l() { y() } function a() { if (u != null) u.on(n.Events.onTouchStartOrClick, function () { o(!0); v(); o(!1) }); if (f != null) f.on(n.Events.onTouchStartOrClick, function () { f.css("display", "none"); u.css("display", "block") }); if (e != null) e.on(n.Events.onTouchStartOrClick, function () { i.dispose() }) } function v() { var e = i, r = h.find("option:selected").val(); t.ajax({ url: n.Application.contextUrl + "Form/GenerateXClasses", dataType: "json", data: { directory: "", chkStatus: !1, tableId: r, classType: "" }, success: function (t) { if (t.contant != null) { var i = "data:text/csv;charset=utf-8," + encodeURIComponent(t.contant); f.attr("download", t.fileName).attr("href", i).attr("target", "_blank"); n.ADialog.info(t.msg); f.css("display", "block"); u.css("display", "none") } o(!1) } }) } function y() { t.ajax({ url: n.Application.contextUrl + "GenerateXModel/GenXModelGetTable", type: "POST", async: !1, success: function (t) { var r = t.result, i; if (r) for (i = 0; i < r.length; i++)h.append("<option value='" + r[i].AD_Table_ID + "'>" + n.Utility.encodeText(r[i].Name) + "<\/option>") }, error: function (n) { i.log.info(n) } }) } function k(n, i, r) { var u = null; return t.ajax({ url: w, type: "POST", datatype: "json", contentType: "application/json; charset=utf-8", async: i, data: JSON.stringify(n) }).done(function (n) { u = n; r && r(n) }), u } function o(n) { s.css("display", n ? "block" : "none") } this.frame; this.windowNo; this.log = n.Logging.VLogger.getVLogger("GenerateXModel"); var i = this, r = t("<div style='width: 100%; height: 100%; background-color: white;'>"), s = t('<div class="vis-busyindicatorouterwrap"><div class="vis-busyindicatorinnerwrap"><i class="vis-busyindicatordiv"><\/i><\/div><\/div>'), u = null, f = null, e = null, h = null; varchkAllTable = null; vartxtpath = null; varchkClassType = null; var p = n.Application.contextUrl, w = p + "JsonData/JDataSet", b = function (t, i, r) { var e = r ? !0 : !1, f = { sql: t, page: 1, pageSize: 0 }, u; return i && (f.param = i), u = null, k(f, e, function (t) { u = (new n.DB.DataReader).toJson(t); r && r(u) }), u }; this.Initialize = function () { c(); l(); a(); o(!1) }; this.getRoot = function () { return r }; this.disposeComponent = function () { u && u.off(n.Events.onTouchStartOrClick); e && e.off(n.Events.onTouchStartOrClick); i = null; this.windowNo = null; r = null; s = null; this.getRoot = null; this.disposeComponent = null } } n.AForms = n.AForms || {}; i.prototype.init = function (n, t) { this.frame = t; this.windowNo = n; try { this.Initialize() } catch (i) { } this.frame.getContentGrid().append(this.getRoot()) }; i.prototype.dispose = function () { this.disposeComponent(); this.frame && this.frame.dispose(); this.frame = null }; n.AForms.GenerateXModel = i }(VIS, jQuery), function (n, t) { function r(r, u, f) { function dr() { var i = "", t = '<div class="vis-advancedSearch-contentWrap"> <div class="vis-advancedSearchContentArea vis-pull-left" style="' + i + '"> <div class="vis-advancedSearchContentArea-up"> <div class="vis-advanedSearch-InputsWrap"><div class="vis-as-topfieldswrap"><div style="display:none" class="vis-form-group vis-advancedSearchInput vis-adsearchgroup1"><input readonly id="txtQryName_' + r + '" type="text" name="QueryName" maxlength="60"><label id="lblQryName_' + r + '" for="QueryName">' + n.Msg.getMsg("AddNameToSaveSearch") + '<\/label><\/div> <div  class="vis-form-group vis-advancedSearchInput vis-adsearchgroup2"><label id="lblSavedQry_' + r + '" for="GetSavedQuery">' + n.Msg.getMsg("GetSavedSearch") + '<\/label><select id="drpSavedQry_' + r + '"><\/select><\/div> <div class="vis-advancedSearch-Icons vis-pull-left vis-adsearchgroup2">   <ul>   <li class="vis-pull-left"><button disabled id="btnDelete_' + r + '" class="vis-advancedSearchActionIcon vis-advancedSearch-delIcon"><i class="vis vis-delete" aria-hidden="true"><\/i><\/button><\/li><\/ul><\/div><\/div><div class="vis-advanedSearch-AddFilterWrap vis-pull-left"><a href="javascript:;" id="spnAddFilter_' + r + '" class="vis-advancedSearch-AddFilter">' + n.Msg.getMsg("AddFilter") + '<\/a><\/div>  <div class="vis-as-backbtn"><button id="btnArowBack_' + r + '" class="vis-ads-icon"><i class="fa fa-arrow-left" aria-hidden="true"><\/i><\/button><\/div> <\/div><div class="vis-advanedSearch-InputsWrap vis-advs-inputwraps vis-pull-left" data-show="N" style="display:none">  <div class="vis-form-group vis-advancedSearchInput vis-advancedSearchInput-v">    <label id="lblColumn_' + r + '"  for="Column">' + n.Msg.getMsg("Column") + '<\/label>  <select id="drpColumn_' + r + '"><\/select><\/div><div class="vis-form-group vis-advancedSearchInput vis-advancedSearchInput-op"><label id="lblOperator_' + r + '" for="Oprator">' + n.Msg.getMsg("Operator") + '<\/label><select id="drpOperator_' + r + '"><\/select><\/div> <div class="vis-form-group vis-advancedSearchInput vis-advancedSearchInput-v" id="divValue1_' + r + '">   <label  id="lblQryValue_' + r + '" for="QueryValue">' + n.Msg.getMsg("QueryValue") + '<\/label> <input  id="txtQryValue_' + r + '" type="text" name="QueryValue"><\/div><div class="vis-form-group vis-advancedSearchInput vis-advancedSearchInput-v" id="divValue2_' + r + '"><label for="QueryName"  id="lblToQryValue_' + r + '">' + n.Msg.getMsg("ToQueryValue") + '<\/label><input  id="txtToQryValue_' + r + '" type="text" name="QueryName"><\/div><div class="vis-form-group vis-advancedSearchInput vis-advancedSearchInput-v" style="display:none;" id="divFullDay_' + r + '"><input style="width: auto;float: left;" id="checkFullDay_' + r + '" type="checkbox" name="QueryName"><label for="QueryName"  id="lblToQryValue_' + r + '">' + n.Msg.getMsg("FullDay") + '<\/label><\/div><div class="vis-advancedSearch-calender-Icon vis-pull-left"><ul><li class="vis-pull-left"><button id="btnSave_' + r + '" disabled class="vis-ads-icon"><i class="vis vis-plus" aria-hidden="true"><\/i><\/button><\/li><\/ul><\/div><\/div><div id="divDynamic_' + r + '"><div class="vis-advanedSearch-InputsWrap vis-advancedSearchMrgin"><div class="vis-form-group vis-advancedSearchInput1"><input type="checkbox"  id="chkDynamic_' + r + '"  name="IsDynamic" class="vis-pull-left"><label for="IsDynamic" >' + n.Msg.getMsg("IsDynamic") + '<\/label><\/div><div class="vis-form-group vis-advancedSearchInput"><select id="drpDynamicOp_' + r + '" disabled><option>' + n.Msg.getMsg("Today") + "<\/option><option>" + n.Msg.getMsg("lastxDays") + "<\/option><option>" + n.Msg.getMsg("lastxMonth") + "<\/option><option>" + n.Msg.getMsg("lastxYears") + '<\/option><\/select><\/div><div class="vis-form-group vis-advancedSearchHorigontal vis-pull-left" id="divYear_' + r + '"><input id="txtYear_' + r + '" type="number" min="1" max="99" /><label for="Year">' + n.Msg.getMsg("Year") + '<\/label><\/div><div class="vis-form-group vis-advancedSearchHorigontal vis-pull-left" id="divMonth_' + r + '"><input id="txtMonth_' + r + '" type="number" min="0" max="12" /><label for="Month">' + n.Msg.getMsg("Month") + '<\/label><\/div><div class="vis-form-group vis-advancedSearchHorigontal vis-pull-left" id="divDay_' + r + '"><input id="txtDay_' + r + '" type="number" min="0" max="31" /> <label for="Day">' + n.Msg.getMsg("Day") + '<\/label><\/div><\/div><\/div><\/div><div class="vis-advancedSearchContentArea-down"><div class="vis-advancedSearchTableWrap vis-table-responsive vis-pull-left"><table id="tblQry_' + r + '" class="vis-advancedSearchTable"><thead><tr class="vis-advancedSearchTableHead"><th>' + n.Msg.translate(n.Env.getCtx(), "AD_Column_ID") + '<\/th><th style="display:none">' + n.Msg.translate(n.Env.getCtx(), "KEYVALUE") + "<\/th><th>" + n.Msg.translate(n.Env.getCtx(), "OperatorName") + "<\/th><th>" + n.Msg.translate(n.Env.getCtx(), "QueryValue") + '<\/th><th style="display:none">' + n.Msg.translate(n.Env.getCtx(), "VALUE1VALUE") + "<\/th><th>" + n.Msg.translate(n.Env.getCtx(), "QueryValue2") + "<\/th><th>" + n.Msg.getMsg("FullDay") + '<\/th><th style="display:none">' + n.Msg.translate(n.Env.getCtx(), "VALUE2VALUE") + '<\/th><th style="display:none">' + n.Msg.translate(n.Env.getCtx(), "AD_USERQUERYLINE_ID") + '<\/th><th style="display:none">' + n.Msg.translate(n.Env.getCtx(), "Operator") + "<\/th><th>" + n.Msg.translate(n.Env.getCtx(), "Action") + '<\/th><\/tr><\/thead><tbody class="vis-advancedSearchTableBody"><\/tbody><\/table><\/div><\/div><div class="vis-advancedSearchContentArea-button"><div class="vis-advcedfooterBtn">'; i = "float:left"; t += '<button id="btnRefresh_' + r + '" class="ui-button ui-corner-all ui-widget">' + n.Msg.getMsg("Refresh") + '<\/button><div class="vis-pull-right"><button id="btnOk_' + r + '" class="ui-button ui-corner-all ui-widget" >' + n.Msg.getMsg("Apply") + '<\/button>  <button id="btnCancel_' + r + '" class="ui-button ui-corner-all ui-widget"  style="margin: 0 10px;">' + n.Msg.getMsg("Close") + '<\/button><\/div><\/div><\/div><\/div><div class="vis-advancedSearch-RecentRecords">  <div class="vis-RecentRecords-Heading">'; t += "<h4>" + n.Msg.getMsg("VHistory") + '<\/h4><\/div><div class="vis-RecentRecords-listWrap"> <ul id="ulQry_' + r + '" ><li data-value="0" title="' + n.Msg.getMsg("All") + '" >' + n.Msg.getMsg("All") + '<\/li><li data-value="365" title="' + n.Msg.getMsg("YearAll") + '">' + n.Msg.getMsg("YearAll") + '<\/li><li data-value="365 | C" title="' + n.Msg.getMsg("YearCreated") + '">' + n.Msg.getMsg("YearCreated") + '<\/li><li data-value="31" title="' + n.Msg.getMsg("MonthAll") + '">' + n.Msg.getMsg("MonthAll") + '<\/li><li data-value="31 | C" title="' + n.Msg.getMsg("MonthCreated") + '">' + n.Msg.getMsg("MonthCreated") + '<\/li><li data-value="7" title="' + n.Msg.getMsg("WeekAll") + '">' + n.Msg.getMsg("WeekAll") + '<\/li><li data-value="7 | C" title="' + n.Msg.getMsg("WeekCreated") + '">' + n.Msg.getMsg("WeekCreated") + '<\/li><li data-value="1" title="' + n.Msg.getMsg("DayAll") + '">' + n.Msg.getMsg("DayAll") + '<\/li><li data-value="1 | C" title="' + n.Msg.getMsg("DayCreated") + '">' + n.Msg.getMsg("DayCreated") + '<\/li><\/ul><\/div><div class="vis-advancedSearchFooter vis-pull-right"> <p id="pstatus_' + r + '" >16 / 16<\/p><\/div><\/div><\/div><div class="vis-apanel-busy vis-advancedSearchbusy" id="divBusy_' + r + '" ><p style="text-align:center"> ' + n.Msg.getMsg("Loading") + "<\/p><\/div>"; e.append(t); gr(); nu(); tu() } function gr() { ot = e.find("#ulQry_" + r); a = e.find("#drpSavedQry_" + r); k = e.find("#drpColumn_" + r); v = e.find("#drpOperator_" + r); ut = e.find("#divValue1_" + r); nr = e.find("#lblQryValue_" + r); it = e.find("#divValue2_" + r); sr = e.find("#divFullDay_" + r); s = e.find("#txtQryName_" + r); ct = e.find("#btnOk_" + r); lt = e.find("#btnCancel_" + r); pt = e.find("#btnSave_" + r); yt = e.find("#btnDelete_" + r); gt = e.find("#btnRefresh_" + r); at = e.find("#divDynamic_" + r); p = e.find("#chkDynamic_" + r); y = e.find("#drpDynamicOp_" + r); ni = e.find("#txtYear_" + r); et = e.find("#txtMonth_" + r); d = e.find("#txtDay_" + r); tt = e.find("#divYear_" + r); st = e.find("#divMonth_" + r); rt = e.find("#divDay_" + r); wt = e.find("#checkFullDay_" + r); fi = e.find("#spnAddFilter_" + r); ti = e.find("#btnArowBack_" + r); g = t(e.find(".vis-advs-inputwraps")[0]); tt.hide(); st.hide(); rt.hide(); at.hide(); ei = e.find("#tblQry_" + r); ii = ei.find("tbody"); or = e.find("#pstatus_" + r); er = e.find("#divBusy_" + r) } function nu() { var l, c, f, o, t, s, u, e; for (h = yi(null, !1), l = i.getData(n.context, di, gi, "Code"), pr(h), hi = ot.html(), ar(l), c = '<option value="-1"> <\/option>', f = [], o = 0; o < ui.length; o++)(t = ui[o], t.getIsEncrypted()) || (s = t.getColumnName(), t.getDisplayType() == n.DisplayType.Button && (t.getAD_Reference_Value_ID() == 0 ? t.setDisplayType(n.DisplayType.String) : s.endsWith("_ID") ? t.setDisplayType(n.DisplayType.Table) : (t.setDisplayType(n.DisplayType.List), t.lookup = new n.MLookupFactory.getMLookUp(n.context, r, t.getAD_Column_ID(), n.DisplayType.List))), u = t.getHeader(), u != null && u.length != 0 || (u = n.Msg.getElement(n.context, s), u != null && u.Length != 0)) && (t.getIsKey() && (u += " (ID)"), f.push({ value: s, text: u })); for (f.sort(function (n, t) { var i = n.text.toUpperCase(), r = t.text.toUpperCase(); return i > r ? 1 : i < r ? -1 : 0 }), e = 0; e < f.length; e++)c += '<option value="' + f[e].value + '">' + f[e].text + "<\/option>"; k.html(c); b(!1) } function tu() { lt.on("click", function () { nt || (o.okBtnPressed = !1, l.close()) }); p.on("change", function () { var n = p.prop("checked"); y.prop("disabled", !n); v.prop("disabled", n); vr(!n); li(!n); eu(n); n ? ci(o.getIsUserColumn(k.val())) : (tt.hide(), st.hide(), rt.hide()) }); y.on("change", function () { ci() }); k.on("change", function () { var t, i, r, s, f; nt || (p.prop("disabled", !0), p.prop("checked", !1), p.trigger("change"), at.hide(), t = k.val(), i = u.getField(t), bi(!0), t && t != "-1" ? (r = null, s = null, (t.endsWith("_ID") || t.endsWith("_Acct") || t.endsWith("_ID_1") || t.endsWith("_ID_2") || t.endsWith("_ID_3")) && (r = o.getOperatorsQuery(n.Query.prototype.OPERATORS_ID)), r = t.startsWith("Is") ? o.getOperatorsQuery(n.Query.prototype.OPERATORS_YN) : i.getDisplayType() == n.DisplayType.YesNo ? o.getOperatorsQuery(n.Query.prototype.OPERATORS_YN) : o.getOperatorsQuery(n.Query.prototype.OPERATORS), e.find(".vis-advancedSearchContentArea-down").css("height", "calc(100% - 150px)"), i != null && n.DisplayType.IsDate(i.getDisplayType()) ? (y.html(o.getOperatorsQuery(n.Query.prototype.OPERATORS_DATE_DYNAMIC, !0)), at.show(), p.prop("disabled", !1), ci(), e.find(".vis-advancedSearchContentArea-down").css("height", "calc(100% - 195px)"), (i.getDisplayType() == n.DisplayType.DateTime || i.getDisplayType() == n.DisplayType.Date) && (ht(!0), dt(!0))) : o.getIsUserColumn(t) && (y.html(o.getOperatorsQuery(n.Query.prototype.OPERATORS_DYNAMIC_ID, !0)), at.show(), e.find(".vis-advancedSearchContentArea-down").css("height", "calc(100% - 195px)"), p.prop("disabled", !1), ci(!0)), i.getDisplayType() != n.DisplayType.DateTime && i.getDisplayType() != n.DisplayType.Date && (ht(!1), dt(!1)), i.getDisplayType() == n.DisplayType.YesNo ? nr.hide() : nr.show(), v.html(r), v[0].SelectedIndex = 0, f = pi(t), yr(!0, f), ai(pt, !0), v.prop("disabled", !1)) : (dt(!1), ht(!0)), vr(!0), ht(!1)) }); v.on("change", function () { var t, i, r; nt || (t = v.val(), t || (t = ""), i = k.val(), r = pi(i), t && t != "0" ? n.Query.prototype.BETWEEN.equals(t) ? (yr(!1, r), ht(!0), li(!0)) : (i = k.val(), r = pi(i), r.getDisplayType() == n.DisplayType.DateTime && n.Query.prototype.EQUAL.equals(t) ? (ht(!1), dt(!0)) : (ht(!1), dt(!1), li(!1))) : (ai(pt, !1), li(!1), bi(!0))) }); a.on("change", function () { if (!nt) { var t = a.val(); tr && ii.find(".vis-advancedSearchTableRow").length > 0 ? n.ADialog.confirm("SaveSearch?", !0, "", "Confirm", function (n) { n ? a.val(o.saveQueryID) : lr(t) }) : lr(t) } }); ei.on("click", function (n) { if (!nt && t(n.target).hasClass("vis-delete")) { var r = t(n.target).data("index"); c.splice(r, 1); i.deleteLines(t(n.target).data("userquery")); vi(c); ir--; ir == 0 && (s.prop("readonly", !0), s.val("")) } }); ot.on("click", "LI", function () { var i, r; nt || (i = t(this).data("value"), i != null ? (b(!0), r = t(this).index(), setTimeout(function () { var u, f, t; r < 9 ? (u = i.toString().split("|"), f = u.length, o.created = f == 1 ? !1 : !0, o.days = parseInt(u[0]), i = "") : o.days = 0; w = new n.Query(ft); w.addRestriction(i); t = 0; t = yi(w, !0); w.setRecordCount(t); b(!1); t != 0 && (o.okBtnPressed = !0, l.close()) }, 10)) : (o.okBtnPressed = !1, l.close())) }); pt.on("click", rr); yt.on("click", function () { if (!nt) { var t = a.val(); t == null || t.toString() == "" || parseInt(t) < 1 || n.ADialog.confirm("DeleteConfirm", !0, "", "Confirm", function (r) { if (r) { b(!0); window.setTimeout(function () { var e = n.dataContext.getJSONData(n.Application.contextUrl + "ASearch/GetQueryDefault", { UserQuery_ID: t }, null), r, f; if (e > 0) { n.ADialog.warn("QueryDefaultForOther"); b(!1); return } u.userQueryID == t && (o.needRefreshWindow = !0); r = a.find("option:selected").text(); i.deleteUserQuery(t) ? (f = i.getData(n.context, di, gi, "Code"), ot.empty(), ot.html(hi), ar(f), a[0].selectedIndex = 0, n.ADialog.info("Deleted", !0, r, ""), s.val(""), s.prop("readony", !0), b(!1), a.trigger("change")) : n.ADialog.info("DeleteError", !0, r, ""); b(!1) }, 10) } else b(!1) }) } }); ct.on("click", function () { nt || (o.okPressed = !0, o.okBtnPressed = !0, ou()) }); gt.on("click", function () { if (!nt) { rr(); var t = kr(), n = 0; n = yi(t, !0); pr(n) } }); fi.on("click", function () { g && g.data("show") == "N" && (g.data("show", "Y"), t(this).hide(), g.show(), ti.show(), t(".vis-adsearchgroup2").hide(), t(".vis-adsearchgroup1").show(), t(".vis-advancedSearchContentArea-down").css("height", "calc(100% - 150px)")) }); ti.on("click", function () { g.data("show", "N"); g.hide(); fi.show(); ti.hide(); cr(); t(".vis-adsearchgroup1").hide(); t(".vis-adsearchgroup2").show(); a[0].selectedIndex = 0; ii.empty(); c = []; s.val("") }); s.on("input", function () { s.length > 0 ? ct.text(n.Msg.getMsg("SaveAndApply")) : ct.text(n.Msg.getMsg("Apply")) }) } function cr() { k[0].selectedIndex = 0; v[0].selectedIndex = 0; bi(); bi(!0); dt(!1); ht(!0); p.prop("checked", !1); wt.prop("checked", !1); at.hide(); e.find(".vis-advancedSearchContentArea-down").css("height", "calc(100% - 100px)") } function iu() { lt && (lt.off("click"), p.off("change"), y.off("change"), k.off("change"), v.off("change"), a.off("change"), ei.off("click"), ot.off("click"), pt.off("click"), yt.off("click"), ct.off("click"), gt.off("click")) } function lr(n) { if (o.saveQueryID = n, tr = !1, n && n != "-1") c = i.getQueryLines(n), vi(c), s.val(a.find("option:selected").text()), s.prop("readonly", !1), ai(yt, !0); else ai(yt, !1), s.val(""), s.prop("readonly", !0), c = null, vi(null) } function ar(t) { var u = "", e = "", r, i, f; if (t != null) for (r in t) i = n.Utility.encodeText(t[r].Name), f = i, i.length > 25 && (i = i.substr(0, 25) + "..."), u += '<li data-value="' + t[r].Code + '" title="' + f + '">' + i + "<\/li>", e += '<option value="' + t[r].AD_UserQuery_ID + '" title="' + f + '">' + i + "<\/option>"; u.length > 0 && ot.append(u); a.html("<option value='-1' > <\/option>" + e) } function ci(n) { var t = y[0].selectedIndex; if (n) { tt.hide(); st.hide(); rt.hide(); return } tt.show(); st.show(); p.is(":checked") ? rt.show() : rt.hide(); d.prop("readonly", !1); et.prop("min", 1); t == 3 || t == 6 ? (et.prop("min", 0), d.val(0), et.val(0), ni.val(1)) : t == 2 || t == 5 ? (tt.hide(), ni.val(""), et.val(1), d.val(0)) : t == 1 || t == 4 ? (tt.hide(), st.hide(), d.val(0)) : t == 0 && (d.prop("readonly", !0), tt.hide(), st.hide(), d.val(0)) } function ru() { return rt.is(":visible") || tt.is(":visible") || rt.is(":visible") } function uu(n) { var t = "", i; return n == 3 || n == 6 ? (i = Math.round(ri(n) / 365, 1), t = "Last " + i.toString() + " Years") : n == 2 || n == 5 ? (i = Math.round(ri(n) / 31, 1), t = "Last " + i.toString() + " Month") : t = ri() != 0 ? "Last " + ri() + " Days" : "This Day", t } function fu(n) { return " adddays(sysdate, - " + ri(n) + ") " } function ri(n) { var u = 0, i, t; if (n == 3 || n == 6) { var r = ni.val(), i = et.val(), t = d.val(); r = r && r != "" ? parseInt(r) : 0; i = i && i != "" ? parseInt(i) : 0; t = t && t != "" ? parseInt(t) : 0; u = r * 365 + i * 31 + t } else n == 2 || n == 5 ? (i = et.val(), t = d.val(), i = i && i != "" ? parseInt(i) : 0, t = t && t != "" ? parseInt(t) : 0, u = i * 31 + t) : (t = t = d.val(), t = t && t != "" ? parseInt(t) : 0, u = t); return u } function vr(n) { var r = ut.children()[1], i = null; ut.children().length > 2 && (i = ut.children()[2]); i ? t(i).prop("disabled", !n).prop("readonly", !n) : r != null && t(r).prop("disabled", !n).prop("readonly", !n) } function li(n) { var r = it.children()[1], i = null; it.children().length > 2 && (i = it.children()[2]); i ? t(i).prop("disabled", !n).prop("readonly", !n) : r != null && t(r).prop("disabled", !n).prop("readonly", !n) } function ht(n) { it.css("display", n ? "block" : "none") } function dt(n) { sr.css("display", n ? "flex" : "none") } function eu(n) { n ? wt.prop("disabled", !0) : wt.prop("disabled", !1) } function ai(n, t) { n.prop("disabled", !t) } function yr(i, r) { var e, o, u, f; i && (bt = null); kt = null; e = null; o = null; i ? (e = ut.children()[1], ut.children().length > 2 && (o = ut.children()[2])) : (e = it.children()[1], it.children().length > 2 && (o = it.children()[2])); e != null && (t(e).remove(), o != null && t(o).remove(), e = null); u = null; u = r != null ? r.getIsKey() ? new n.Controls.VNumTextBox(r.getColumnName(), !1, !1, !0, r.getDisplayLength(), r.getFieldLength(), r.getColumnName()) : n.VControlFactory.getControl(null, r, !0, !0, !1) : new n.Controls.VTextBox("columnName", !1, !0, !1, 20, 20, "format", "GetObscureType", !1); u != null && (u.setReadOnly(!1), r.getDisplayType() == n.DisplayType.AmtDimension && (u.hideButton(!1), u.setReadOnlyTextbox(!1)), n.DisplayType.Text == r.getDisplayType() || n.DisplayType.TextLong == r.getDisplayType() ? (u.getControl().attr("rows", "1"), u.getControl().css("width", "100%")) : n.DisplayType.YesNo == r.getDisplayType() ? u.getControl().css("clear", "both") : n.DisplayType.IsDate(r.getDisplayType()) && u.getControl().css("line-height", "1"), f = null, u.getBtnCount() > 0 && !(u instanceof n.Controls.VComboBox) && (f = u.getBtn(0)), i ? (ut.append(u.getControl()), bt = u, f && (ut.append(f), u.getControl().css("width", "calc(100% - 30px)"), f.css("max-width", "30px"))) : (it.append(u.getControl()), kt = u, f && (it.append(f), u.getControl().css("width", "calc(100% - 30px)"), f.css("max-width", "30px"))), r.getDisplayType() == n.DisplayType.AmtDimension && u.getControl().css("width", "100%")) } function vi(n) { var i, f; ii.empty(); var u = "", r = "", t = null; if (n) for (i = 0, f = n.length; i < f; i++)r = '<tr class="vis-advancedSearchTableRow">', t = n[i], r += "<td>" + t.KEYNAME + '<\/td><td style="display:none">' + t.KEYVALUE + "<\/td><td>" + t.OPERATORNAME + "<\/td><td>" + t.VALUE1NAME + '<\/td><td style="display:none">' + t.VALUE1VALUE + "<\/td><td>" + t.VALUE2NAME + '<\/td><td style="display:none">' + t.VALUE2VALUE + "<\/td><td>" + t.FULLDAY + '<\/td><td style="display:none">' + t.AD_USERQUERYLINE_ID + '<\/td><td style="display:none">' + t.OPERATOR + '<\/td><td><i style="cursor:pointer" data-userQuery="' + t.AD_USERQUERYLINE_ID + '" data-index = "' + i + '" class="vis vis-delete"><\/i><\/td>', r += "<\/tr>", u += r; ii.html(u) } function yi(t, i) { var u = ft, s = !1, f, c, e; vt != null && vt.length > 0 && (u += vt.indexOf("@") == -1 ? " WHERE " + vt : " WHERE " + n.Env.parseContext(n.context, r, vt, !1), s = !0); t != null && t.getIsActive() && (u += s ? " AND " : " WHERE ", u += n.Env.parseContext(n.context, r, t.getWhereClause(!0), !1)); f = n.MRole.getDefault().addAccessSQL("SELECT COUNT(*) FROM " + u.toString(), ft, n.MRole.SQL_NOTQUALIFIED, n.MRole.SQL_RO); h = 999999; try { c = n.secureEngine.encrypt(f); h = n.dataContext.getJSONData(n.Application.contextUrl + "ASearch/GetNoOfRecrds", { RecQuery: c }, null) } catch (l) { si.Log(n.Level.SEVERE, f, l) } return e = n.MRole.getDefault(), o.okPressed = !1, h == 0 || h == null ? (h = 0, i && n.ADialog.info("FindZeroRecords", !0, "")) : t != null && e.getIsQueryMax(h) ? n.ADialog.error("FindOverMax", !0, h + " > " + e.getMaxQueryRecords()) : o.okPressed = !0, t != null, h } function pr(n) { var t = " " + n + " / " + h + " "; if (or.text(t), h < f) { hr = !0; return } } function pi(n) { var t, i; if (n == null || n.length == 0) return null; for (t = 0; t < ui.length; t++)if (i = ui[t], n.equals(i.getColumnName())) return i; return null } function rr() { var r = k.val(), n, i, f, u, l; if (!r || r == "-1") return i = -1, !1; if (n = k.find("option:selected").text(), i = "", n == null || n.trim().length == 0) return !1; if (i = r.toString(), tr = !0, f = p.prop("checked"), f) if (ru()) { var e = ">=", o = " >= ", h = uu(y[0].selectedIndex), c = fu(y[0].selectedIndex); wi(n, i, o, e, h, c, null, null, ur()) } else { var e = "=", o = " = ", h = y.find("option:selected").text(), c = y.val(); wi(n, i, o, e, h, c, null, null, ur()) } else u = v.val(), v[0].selectedIndex > -1 && (u = y.find("option:selected").text()), l = v.val(), wi(n, i, u, l, br(!0), wr(!0), br(!1), wr(!1), ur()); return s.prop("readonly", !1), cr(), ir++, g && g.data("show") == "Y" && (g.data("show", "N"), g.hide(), fi.show(), ti.hide(), t(".vis-adsearchgroup2").hide(), t(".vis-adsearchgroup1").show()), !0 } function wr(t) { var i = null; return (i = t ? bt : kt, i != null) ? i.getDisplayType() == n.DisplayType.YesNo ? i.getValue().toString().toLowerCase() == "true" ? "Y" : "N" : i.displayType == n.DisplayType.AmtDimension ? i.getText() : i.getValue() : "" } function br(t) { var i = null; return (i = t ? bt : kt, i != null) ? i.displayType == n.DisplayType.AmtDimension ? i.getText() : i.getDisplay() : "" } function ur() { if (wt) return wt.is(":checked") ? "Y" : "N" } function wi(t, i, r, u, f, e, o, s, h) { c == null && (c = []); var l = {}; l.KEYNAME = t; l.KEYVALUE = i; l.OPERATORNAME = u; l.VALUE1NAME = n.Utility.encodeText(f); l.FULLDAY = h; l.VALUE1VALUE = f == "" ? "" : e == null ? "NULL" : n.Utility.encodeText(n.Utility.Util.getValueOfString(e)); l.VALUE2NAME = n.Utility.encodeText(o); l.VALUE2VALUE = s == null ? "NULL" : n.Utility.encodeText(n.Utility.Util.getValueOfString(s)); l.AD_USERQUERYLINE_ID = 0; l.OPERATOR = r; c.push(l); vi(c) } function bi(n) { var t = null; t = n ? kt : bt; t != null && t.setValue(null) } function kr() { var l = new n.Query(ft), w, p, tt, h, s, g, d, i; if (c) for (w = 0; w < c.length; w++) { var o = c[w], nt = o.KEYNAME.toString(), a = o.KEYVALUE.toString(), f = pi(a), y = f.getColumnSQL(), u = o.OPERATORNAME.toString(), e = o.VALUE1VALUE, t = null; if (e != null && e.toString().trim().startsWith("adddays") || e.toString().trim().startsWith("@") || (t = fr(f, e)), p = null, e == null || e.toString().length < 1) { if (n.Query.prototype.BETWEEN.equals(u)) continue; t = n.Env.NULLString; p = "NULL" } else p = o.VALUE1NAME.toString(); if (tt = o.FULLDAY.toString(), f.getIsVirtualColumn()) if (y = f.vo.ColumnSQL, a = f.vo.ColumnSQL, n.Query.prototype.BETWEEN.equals(u)) { if (h = o.VALUE2VALUE.toString(), h == null || h.toString().trim().length < 1) continue; if (s = fr(f, h), g = o.VALUE2NAME.toString(), s == null) continue; i = ki(t, s, a, u, !0, !0); where = n.Env.parseContext(n.context, r, i, !1); l.addRestriction(i) } else i = ki(t, s, a, u, !0, !0), where = n.Env.parseContext(n.context, r, i, !1), l.addRestriction(i); else { var b = "C_DimAmt", it = "IsActive", rt = "Amount", ut = "S", v = "E", et = "L", ot = "ECT", st = "F", k = "R", ht = "OM", ct = "WH"; if (f.getDisplayType() == n.DisplayType.DateTime && n.Query.prototype.EQUAL.equals(u) && t && tt == "Y") { var lt = t.getFullYear(), at = t.getMonth(), vt = t.getDate(); s = new Date(lt, at, vt, 24, 00, 00); t = new Date(lt, at, vt, 00, 00, 00); o.VALUE2VALUE = s.toUTCString(); u = n.Query.prototype.BETWEEN } if (n.Query.prototype.BETWEEN.equals(u)) { if (h = o.VALUE2VALUE.toString(), h == null || h.toString().trim().length < 1) continue; if (f.getDisplayType() == n.DisplayType.AmtDimension && (d = ut + v + et + ot + " " + b + "_ID " + st + k + ht + " " + b + " " + ct + v + k + v + " " + it + "='Y' AND " + rt + " " + u + e + " AND " + h, t = n.MRole.getDefault().addAccessSQL(d.toString(), "C_DimAmt", n.MRole.SQL_NOTQUALIFIED, n.MRole.SQL_RO), u = n.Query.prototype.IN), f.getDisplayType() == n.DisplayType.AmtDimension) i = ki(t, s, y, u, !1, !1), where = n.Env.parseContext(n.context, r, i, !1), l.addRestriction(i); else { if (s = fr(f, h), g = o.VALUE2NAME.toString(), s == null) continue; l.addRangeRestriction(y, t, s, nt, p, g) } } else f.getDisplayType() == n.DisplayType.AmtDimension && (d = ut + v + et + ot + " " + b + "_ID " + st + k + ht + " " + b + " " + ct + v + k + v + " " + it + "='Y' AND " + rt + " " + u + e, t = n.MRole.getDefault().addAccessSQL(d.toString(), "C_DimAmt", n.MRole.SQL_NOTQUALIFIED, n.MRole.SQL_RO), u = n.Query.prototype.IN), t == null && e != null && (e.toString().trim().startsWith("adddays") || e.toString().trim().startsWith("@")) ? (i = ft + "." + a + u + e, f.getDisplayType() == n.DisplayType.AmtDimension && (i = a + n.Query.prototype.IN + "(" + t + ")"), where = n.Env.parseContext(n.context, r, i, !1), l.addRestriction(i)) : f.getDisplayType() == n.DisplayType.AmtDimension ? (i = ki(t, s, y, u, !1, !1), where = n.Env.parseContext(n.context, r, i, !1), l.addRestriction(i)) : l.addRestriction(y, u, t, nt, p) } } return l } function ki(t, i, r, u, f, e) { var o = "", s = /(\d{4})-(\d{2})-(\d{2})T(\d{2})\:(\d{2})\:(\d{2})/; return typeof t == "string" && (o += " UPPER( "), e || (o += ft + "."), o += r, typeof t == "string" && (o += " ) "), t == null || "NULL".equals(t.toString().toUpper()) || "NullValue".toUpper().equals(t.toString().toUpper()) ? o += u.equals(n.Query.prototype.EQUAL) ? " IS NULL " : " IS NOT NULL " : (o += u, (n.Query.prototype.IN.equals(u) || n.Query.prototype.NOT_IN.equals(u)) && (o += "("), t instanceof Date || t && s.test(t.toString()) ? o += n.DB.to_date(tcode, !1) : "string" == typeof t ? f ? (o += " UPPER( ", o += n.DB.to_string(t.toString()), o += " ) ") : o += t.toString() : o += t, n.Query.prototype.BETWEEN.equals(u) ? (o += " AND ", i instanceof Date || i && s.test(i.toString()) ? o += n.DB.to_date(i, !1) : typeof i == "string" ? (o += " UPPER( ", o += n.DB.to_string(i.toString()), o += " ) ") : o += i) : (n.Query.prototype.IN.equals(u) || n.Query.prototype.NOT_IN.equals(u)) && (o += ")")), o } function fr(t, i) { var u, r, e, f, o; if (i == null || (u = t.getDisplayType(), r = i.toString(), r == null || r.equals(n.Env.NULLString) || r == "" || r.toUpper() == "NULL")) return null; try { if (u == n.DisplayType.Integer || n.DisplayType.IsID(u) && t.getColumnName().endsWith("_ID")) return parseInt(r); if (n.DisplayType.IsNumeric(u)) return parseFloat(r); if (n.DisplayType.IsDate(u)) { e = ""; try { return new Date(r) } catch (h) { e = "" } try { return Date.Parse(e) } catch (c) { return null } } } catch (s) { return f = s.message, (f == null || f.length == 0) && (f = s.toString()), o = "", o += t.getColumnName() + " = " + r + " - " + f, n.ADialog.error("ValidationError", !0, o.toString()), null } return r } function ou() { var f, r; if (b(!0), rr(), w = kr(), w.getRestrictionCount() == 0) { b(!1); l.close(); return } f = w.getWhereClause(!0); r = n.Utility.encodeText(s.val()); r != null && r.trim().length == 0 ? r = null : o.needRefreshWindow = !0; var t = a.val(), u = ""; t = t != null && t.toString() != "-1" && parseInt(t) > 0 ? t : 0; window.setTimeout(function () { if (t != 0 || r != null) if (i.insertOrUpdate(t, r, f, di, gi, c, o.getID)) oi = !1, u = t > 0 ? "Updated" : "Saved", o.saveQueryID = i.id; else { if (i.alreadyExist) { n.ADialog.error("SearchExist"); b(!1); oi = !0; return } oi = !0; u = t > 0 ? "UpdatedError" : "SaveError" } var e = !1; yi(w, !0) != 0 && (e = !0); b(!1); u != "" && n.ADialog.info("", !0, n.Msg.getMsg(u) + " " + r, null); e && l.close() }, 10) } function b(n) { nt = n; er.css("visibility", nt ? "visible" : "hidden"); ct.prop("disabled", n); lt.prop("disabled", n); gt.prop("disabled", n) } var su = u.getName(), di = u.getAD_Tab_ID(), gi = u.getAD_Table_ID(), ft = u.getTableName(), vt = u.getWhereClause(), ui = u.getFields(), bt, kt, hi; this.btnfields = []; var e = t("<div  class='vis-forms-container' style='height:100%'>"), er = null, o = this, l = null, ct, lt, yt, pt, gt, s, a, k, v, y, p, ni, et, d, or, wt, fi, ti, ot, at, tt, st, rt, ut, it, ei, ii, sr, g, nr, h = 0, hr = !1, oi = !1, nt = !1, c = null, si = n.Logging.VLogger.getVLogger("Find"); this.onClose = null; this.created = !1; this.days = 0; this.okPressed = !1; this.okBtnPressed = !1; this.needRefreshWindow = !1; hi = ""; this.saveQueryID = -1; var tr = !1, ir = 0, w = new n.Query(ft); w.addRestriction(vt); dr(); wi; this.getID = function (n) { this.saveQueryID = n }; this.getSavedID = function () { return this.saveQueryID }; this.show = function () { l = new n.ChildDialog; l.setHeight(550); l.setWidth(860); l.setTitle(n.Msg.getMsg("Find")); l.setModal(!0); l.onClose = function () { o.onClose && o.onClose(); o.dispose() }; l.show(); l.setContent(e); l.hideButtons(); b(!1); lt.focus() }; this.getSavedQueryName = function () { return s.val() ? n.Utility.encodeText(s.val()) : "" }; this.getQuery = function () { var t = n.MRole.getDefault(); return t.getIsQueryMax(h) ? (w = n.Query.prototype.getNoRecordQuery(ft, !1), h = 0, si.warning("Query - over max")) : si.info("Query=" + w), w }; this.disposeComponent = function () { iu(); ct = lt = yt = pt = gt = null; s = a = k = v = y = p = ni = et = d = null; ot = at = tt = st = rt = null; e && e.remove(); e = null; h = hr = oi = null; c = null; si = null; this.created = this.days = 0; this.okPressed = this.okBtnPressed = null; bt = kt = hi = null; w = null } } var u = n.Application.contextUrl, f = u + "JsonData/ExecuteNonQuer", e = function (n, i, r) { var e = r ? !0 : !1, u = null, o = { sql: n, param: i }; return t.ajax({ url: f + "yWithCode", type: "POST", datatype: "json", contentType: "application/json; charset=utf-8", async: e, data: JSON.stringify(o) }).done(function (n) { u = n; r && r(n) }), u }, i = { alreadyExist: !1, id: 0, getData: function (t, i, r, u) { var o = t.getAD_Client_ID(), f = null; try { f = n.dataContext.getJSONData(n.Application.contextUrl + "ASearch/GetData", { ColumnName: u, Tab_ID: i, Table_ID: r }, null) } catch (e) { console.log(e) } return f }, getQueryLines: function (t) { var i = null, o = [], f, e, u, r; try { if (i = n.dataContext.getJSONData(n.Application.contextUrl + "ASearch/GetQueryLines", { UserQuery_ID: t }, null), f = "", e = "", i != null) for (u in i) r = {}, r.KEYNAME = i[u].KEYNAME, r.KEYVALUE = i[u].KEYVALUE, r.OPERATORNAME = i[u].OPERATORNAME, r.VALUE1NAME = i[u].VALUE1NAME, r.VALUE1VALUE = i[u].VALUE1VALUE, r.VALUE2NAME = i[u].VALUE2NAME, r.VALUE2VALUE = i[u].VALUE2VALUE, r.AD_USERQUERYLINE_ID = i[u].AD_USERQUERYLINE_ID, r.FULLDAY = i[u].FULLDAY, f = i[u].OPERATORNAME, e = n.Query.prototype.OPERATORS[f], r.OPERATOR = e, o.push(r) } catch (s) { } return o }, deleteLines: function (t) { var i = [], r; return i[0] = new n.DB.SqlParam("@AD_UserQuery_ID", t), r = e("VIS_147", i, null), r >= 0 }, deleteUserQuery: function (i) { var r = -1; return t.ajax({ url: n.Application.contextUrl + "ASearch/DeleteQuery", type: "POST", datatype: "json", async: !1, data: { id: i } }).done(function (n) { r = parseInt(n) }), r >= 0 }, insertOrUpdate: function (r, u, f, e, o, s) { var h = -1; return f && (f = n.secureEngine.encrypt(f)), t.ajax({ url: n.Application.contextUrl + "ASearch/InsertOrUpdateQuery", type: "POST", datatype: "json", contentType: "application/json; charset=utf-8", async: !1, data: JSON.stringify({ id: r, name: u, where: f, tabid: e, tid: o, qLines: s }) }).done(function (n) { h = parseInt(n); h == -5 && (i.alreadyExist = !0) }), h > 0 && (i.id = h), h >= 0 } }; r.prototype.getOperatorsQuery = function (t, i) { var u = "", r = ""; for (var f in t) r = t[f], i && (r = n.Msg.getMsg(r)), u += '<option value="' + f + '">' + r + "<\/option>"; return u }; r.prototype.getIsUserColumn = function (n) { return n.endsWith("atedBy") || n.equals("AD_User_ID") ? !0 : n.equals("SalesRep_ID") ? !0 : !1 }; r.prototype.getCurrentDays = function () { return this.days }; r.prototype.getIsCreated = function () { return this.created }; r.prototype.getIsOKPressed = function () { return this.okPressed && this.okBtnPressed }; r.prototype.needRefresh = function () { return this.needRefreshWindow }; r.prototype.dispose = function () { this.disposeComponent() }; n.Find = r }(VIS, jQuery), function (n, t) { function i(n, i, r) { var f = null; return t.ajax({ url: u, type: "POST", datatype: "json", contentType: "application/json; charset=utf-8", async: i, data: JSON.stringify(n) }).done(function (n) { f = n; r && r(n) }), f } function f(i, r, u, f, e, o, s, h) { this.init = function () { l() }; var c = [], l = function () { var i = null, l, w, b, v, k, y, p, e, a; if (t.ajax({ type: "Get", async: !1, url: n.Application.contextUrl + "Form/GetZoomTargets", data: { tableName: r }, success: function (n) { i = JSON.parse(n) } }), i != null && i.length > 0) for (l = 0; l < i.length; l++)if (w = i[l], t.ajax({ type: "Get", async: !1, url: n.Application.contextUrl + "Form/GetZoomTarget", data: { targetTableName: w, curWindow_ID: f, targetWhereClause: u.getWhereClause() }, success: function (n) { zoomList = JSON.parse(n) } }), zoomList != null) for (e in zoomList) { b = zoomList[e]; v = !0; for (k in c) if (c[k].Key == zoomList[e].Key) { v = !1; break } v && c.push(b) } if (i = null, c.length == 0) n.ADialog.info("NoZoomTarget"); else { y = t("<div>"); p = t("<ul class=vis-apanel-rb-ul>"); y.append(p); for (e in c) { a = t("<li data-id='" + c[e].Key + "'>"); a.append(c[e].Name); a.on("click", function (i) { var f, r, u; i.stopImmediatePropagation(); f = t(this).data("id"); r = new n.Query; r.addRestriction(s, n.Query.prototype.EQUAL, h); n.viewManager.startWindow(f, r); u = t("#w2ui-overlay-main"); u.hide(); u = null }); p.append(a) } o.w2overlay(y.clone(!0), { css: { height: "200px" } }) } }, a = function (n, t) { var i; if (t != null && t.Length != 0 && (i = t, !(i.indexOf(" EXISTS ") > 0) && !(i.indexOf(" IN ") > 0) && !(i.indexOf("(") > 0) && !(i.indexOf(")") > 0))) while (i.indexOf("=") != -1) { var f = i.indexOf("="), u = i.lastIndexOf(" ", f), e = f - (u + 1), r = i.substr(u + 1, e); r.indexOf(".") != -1 && (u = r.indexOf(".") + 1, e = f - u, r = r.substr(u, e)); n.indexOf(r) < 0 && n.push(r); i = i.substr(f + 1) } }, v = function (t, i) { var r, o, s; if (i == null || i.Length == 0) return !0; if (r = i, o = !0, r.indexOf(" EXISTS ") > 0 || r.indexOf(" IN ") > 0 || r.indexOf("(") > 0 || r.indexOf(")") > 0) return !1; while (r.indexOf("=") != -1) { var u = r.indexOf("="), f = r.lastIndexOf(" ", u), e = r.substr(f + 1, u - (f + 1)), h = "", c = ""; e.indexOf(".") != -1 && (f = e.indexOf("."), e = e.substr(f, u)); for (s in t) if (e == t[s].columnName) { h = "'" + t[s].columnValue + "'"; break } if (r = r.substr(u + 1), f = 0, u = r.indexOf(" "), c = u == -1 ? r.substr(f) : r.substr(f, u), !n.Evaluator.evaluateLogicTuple(h, "=", c)) { o = !1; break } } return o } } var r = n.Application.contextUrl, u = r + "JsonData/JDataSetWithCode", e = function (t, r, u) { var o = u ? !0 : !1, e = { sql: t, page: 1, pageSize: 0 }, f; return r && (e.param = r), f = null, i(e, o, function (t) { f = (new n.DB.DataReader).toJson(t); u && u(f) }), f }, o = function (t, r, u) { var o = u ? !0 : !1, e = { sql: t, page: 1, pageSize: 0 }, f; return r && (e.param = r), f = null, i(e, o, function (t) { f = (new n.DB.DataSet).toJson(t); u && u(f) }), f }; n.AZoomAcross = f }(VIS, jQuery), function (n, t) { function i(i, r, u, f) { function ui() { w = f; w || (at = i.gridTable.AD_Table_ID, o = r.getSelectedRows(), l = i.getRecords()[i.getCurrentRow()]); v = t('<ul class="vis-sms-ul" ><\/ul>'); y = t("<div>"); y.css("position", "absolute"); y.css("bottom", "0"); y.css("background", "url('" + n.Application.contextUrl + "Areas/VIS/Images/LoadingCircle.gif') no-repeat"); y.css("background-position", "center center"); y.css("width", "100%"); y.css("height", "100%"); y.css("text-align", "center"); y.css("opacity", ".1"); y[0].style.visibility = "hidden" } function fi() { var i = '         <div class="contentArea" style="width: 100%; float: left;">', r; i += ' <div class="vis-sms-leftDiv"><\/div>'; i += '   <div class="vis-sms-ContentWrap"><div class="vis-sms-ContentArea"><div class="vis-sms-leftWrap"><div class="vacom-form-horizontal">'; i += '   <div class="vis-sms-inputWrap"><div class="vis-sms-form-data-sub">'; i += '         <input type="text"  id="' + s.windowNo + '_emailMoblie"  placeholder="' + n.Msg.getMsg("EnterMobileNumber") + '">'; i += "<\/div>"; i += "  <\/div>"; i += '  <\/div><div class="vis-sms-textarea-div" style="width: 100%; float: left;">'; i += ' <textarea  ondrop="return false;" id="' + s.windowNo + '_vis-sms-textarea" style="width: 100%; height:100%;resize:none" placeholder="' + n.Msg.getMsg("WriteMsgHere") + '"><\/textarea><\/div>'; i += ' <div class="vis-sms-leftFooter">'; i += '<div ><p class="vis-sms-counter" id=' + s.windowNo + '_acCount><\/p> <p  class="vis-sms-counter"   id=' + s.windowNo + '_oper><\/p> <p  class="vis-sms-counter"   id=' + s.windowNo + "_maxCount >160<\/p> <\/div>"; i += ' <input id="' + s.windowNo + '_dyndis" type="checkbox"><label  id="' + s.windowNo + '_dyndislbl"  for="' + s.windowNo + '_dyndis" >' + n.Msg.getMsg("DynamicSms") + "<\/label><\/div><\/div>"; i += '  <div class="vis-sms-divider"><\/div>'; i += ' <div class="vis-sms-rytWrap"><div class="vis-sms-rytContent">'; i += ' <div class="vis-sms-rytBcc"><div class="vis-email-rytBcc-header"><h4>' + n.Msg.getMsg("Mobile") + "<\/h4>"; i += ' <i id="' + s.windowNo + '_SmsRefresh" title="' + n.Msg.getMsg("Refresh") + '" class="vis vis-refresh"><\/i>'; i += '   <\/div><div class="vis-sms-BccList">'; i += " <\/div><\/div><\/div><\/div>  <\/div><\/div>"; e.append(t(i)); r = 0; k = e.find("#" + s.windowNo + "_dyndis"); e.find(".contentArea").css("height", e.height() - 42); e.find(".vis-sms-leftDiv").height(e.height() - 42); a = e.find(".vis-sms-leftDiv"); et = e.find(".vis-sms-BccList"); c = e.find("#" + s.windowNo + "_emailMoblie"); pt = e.find("#" + s.windowNo + "_SmsRefresh"); c.css("margin-top", "10px"); h = e.find("#" + s.windowNo + "_vis-sms-textarea"); $leftfootArea = e.find(".vis-sms-leftFooter"); rt = e.find("#" + s.windowNo + "_acCount"); ut = e.find("#" + s.windowNo + "_oper"); ot = e.find("#" + s.windowNo + "_maxCount"); e.find(".vis-sms-textarea-div").css("margin-top", "10px"); e.find(".vis-sms-rytBcc").height(e.find(".vis-sms-rytContent").height() - 10); w ? (e.find(".vis-sms-leftDiv").hide(), e.find(".vis-sms-rytWrap").hide(), e.find(".vis-sms-textarea-div").height(e.height() - 150), e.find(".vis-sms-leftWrap").css("width", "100%"), e.find("#" + s.windowNo + "_dyndislbl").hide(), r = e.width() - 40, k.prop("checked", !1), k.hide()) : (e.find(".vis-sms-textarea-div").height(e.height() - 150), r = e.width() - 240, e.find(".vis-sms-leftWrap").width(r - 345)); b = e.find(".vis-sms-ContentWrap"); b.css("width", r); yt = !0; e.find(".vis-sms-BccList").height(e.find(".vis-sms-rytContent").height() - 70) } function ei() { var s, u, h, f, e, r; for (nt = t('<i class="fa fa-bars"><\/i>'), s = t('<div class="vis-apanel-lb-toggle" style="overflow-x:hidden;overflow-y:hidden"><\/div>'), s.append(nt), a.append(s), p = t('<ul class="vis-apanel-lb-ul"><\/ul>'), p.css({ height: "calc(100% - 54px)", overflow: "auto", "white-space": "nowrap", width: "100%" }), u = 0; u < i.gridTable.getFields().length; u++)if (h = i.gridTable.getFields(0)[u].getColumnName().toUpper() == i.getKeyColumnName().toUpper(), i.gridTable.getFields(0)[u].getIsDisplayed() || h) { if (h || p.append(t("<li>" + i.gridTable.getFields(0)[u].getHeader() + "<\/li>")), f = [], e = [], i.gridTable.getFields(0)[u].getColumnName().toUpper().equals(g)) for (r = 0; r < o.length; r++)n.DisplayType.IsLookup(i.getField(g).getDisplayType()) ? o[r][g.toLower()] != null && (f.push(o[r][g.toLower()]), e.push(o[r][i.getKeyColumnName().toLower()])) : o[r][g.toLower()] != null && (f.push(o[r][g.toLower()]), e.push(o[r][i.getKeyColumnName().toLower()])); si(f, e) } a.append(p) } function wt(n) { var t, u; if (n && (v.empty(), o = r.getSelectedRows(), l = i.getRecords()[i.getCurrentRow()]), r.singleRow) bt(); else if (o.length > 0) for (t = 0; t < o.length; t++)o[t].mobile != null && (u = o[t][i.getKeyColumnName().toLower()], v.append('<li class="vis-sms-list-li-bcc"  data-mobile="' + o[t].mobile + '"><input id="' + s.windowNo + "_" + o[t].mobile + '_CheckBoxList1" type="checkbox" value="' + o[t].mobile + '" checked/><label class="vis-sms-chcklist-label"  for="' + s.windowNo + "_" + o[t].mobile + '_CheckBoxList1">' + o[t].mobile + "(" + u + ")<\/label><\/li>")); else bt(); n || et.append(v); v.children().length > 1 && k.prop("checked") == !0 && (c.val(""), c.prop("disabled", !0)) } function bt() { if (l.mobile != null) { var n = l[i.getKeyColumnName().toLower()]; v.append('<li class="vis-sms-list-li-bcc" data-mobile="' + l.mobile + '"><input id="' + s.windowNo + "_" + l.mobile + '_CheckBoxList1" type="checkbox" value="' + l.mobile + '" checked /><label class="vis-sms-chcklist-label"  for="' + s.windowNo + "_" + l.mobile + '_CheckBoxList1">' + l.mobile + "(" + n + ")<\/label><\/li>") } } function oi() { it = t('<i class="vis-email-sendbtn vis vis-paper-plane vis-Sms-sendButton" title="' + n.Msg.getMsg("SendSms").replace("&", "") + '" ><\/i>'); ht.append(it); w || (tt = t('<i class="vis-email-btns vis vis-viewdocument vis-sms-preview-btn" title="' + n.Msg.getMsg("Preview").replace("&", "") + '"><\/i>'), ht.append(tt)) } function si(i, r) { for (var u, o, f, e = 0; e < i.length; e++)if (u = n.dataContext.getJSONData(n.Application.contextUrl + "Sms/GetUser", { BPartner_ID: i[e] }, null), o = !1, u != null) for (f in u) if (u[f].ISSMS != null && u[f].ISSMS.toString().equals("Y")) { if (u[f].MOBILE == null || u[f].MOBILE == "") continue; if (t(v.children("li").data(u[f].MOBILE + r[e])).length > 0) continue; v.append('<li  class="vis-sms-list-li-bcc"><input id="' + s.windowNo + "_" + u[f].MOBILE + '_CheckBoxList1" type="checkbox"  value="' + u[f].MOBILE + r[e] + '" checked/><label class="vis-sms-chcklist-label" for="' + s.windowNo + "_" + u[f].MOBILE + '_CheckBoxList1">' + u[f].MOBILE + "(" + r[e] + ")<\/label><\/li>") } } function hi() { it.on("click", bi); h.on("keyup", kt); if (!w) { nt.on("click", ci); k.on("click", li); p.children("li").on("click", ai); tt.on("click", vi); nt.trigger("click"); pt.on("click", yi) } } function ci() { k.prop("checked") == !0 ? a.width() == 40 ? (a.css("width", "200px"), a.find("ul").show(), b.width(b.width() - 160), e.find(".vis-sms-leftWrap").width(e.find(".vis-sms-leftWrap").width() - 160)) : ct() : a.width() != 40 && ct() } function ct() { a.css({ width: "40px" }); a.find("ul").hide(); b.width(b.width() + 160); e.find(".vis-sms-leftWrap").width(e.find(".vis-sms-leftWrap").width() + 160) } function li() { this.checked ? (a.width() != 40 && a.find("ul").show(), r.singleRow == !1 && o.length > 1 && (c.val(""), c.prop("disabled", !0))) : (a.width() != 40 && ct(), c.prop("disabled", !1)) } function ai() { var i = h[0], f = "@@" + t(this).text() + "@@", s = i.scrollTop, n = 0, u = i.selectionStart || i.selectionStart == "0" ? "ff" : document.selection ? "ie" : !1, e, o, r; u == "ie" ? (h.focus(), r = document.selection.createRange(), r.moveStart("character", -h.val().length), n = r.text.length) : u == "ff" && (n = i.selectionStart); e = h.val().substring(0, n); o = h.val().substring(n, h.val().length); h.val(e + f + o); n = n + f.length; u == "ie" ? (h.focus(), r = document.selection.createRange(), r.moveStart("character", -h.val().length), r.moveStart("character", n), r.moveEnd("character", 0), r.select()) : u == "ff" && (i.selectionStart = n, i.selectionEnd = n, h.focus()); i.scrollTop = s; i = null; kt() } function vi() { var f = h.val(), e = "", u, i; e = r.singleRow == !1 && o.length > 0 ? dt(f, 0) : gt(f); u = t("<div><\/div>"); u.append(n.Utility.encodeText(e)); i = new n.ChildDialog; i.setHeight(420); i.setWidth(850); i.setTitle(n.Msg.getMsg("Preview")); i.setModal(!0); i.setContent(u); i.show(); i.hidebuttons() } function yi() { wt(!0) } function kt() { rt.text(h.val().length); parseInt(rt.text()) > parseInt(ot.text()) ? (ut.text(">"), lt("#ED0000")) : parseInt(rt.text()) == parseInt(ot.text()) ? (ut.text("="), lt("#000000")) : (ut.text("<"), lt("#000000")) } function lt(n) { ut.css("color", n); rt.css("color", n); ot.css("color", n) } function pi(t, u) { for (var l = t, h = {}, f = t; f.indexOf("@@") > -1;) { f = f.substring(f.indexOf("@@") + 2); var c = f.substring(0, f.indexOf("@@")), s = null, e = Object.keys(r.getColumnNames()).filter(function (n) { return r.getColumnNames()[n] === c })[0]; n.DisplayType.IsLookup(i.getField(e).getDisplayType()) || n.DisplayType.Location == i.getField(e).getDisplayType() ? o[u][e.toLower()] != null && o[u][e.toLower()] != undefined && (s = i.getField(e.toLower()).lookup.getDisplay(o[u][e.toLower()])) : n.DisplayType.IsDate(i.getField(e).getDisplayType()) ? (s = i.getField(e).value, s = new Date(s)) : s = o[u][e.toLower()]; f = f.substring(f.indexOf("@@") + 2); h["@@" + c + "@@"] = s } return h } function wi(t) { for (var u = t, o = {}; u.indexOf("@@") > -1;) { u = u.substring(u.indexOf("@@") + 2); var s = u.substring(0, u.indexOf("@@")), e = null, f = Object.keys(r.getColumnNames()).filter(function (n) { return r.getColumnNames()[n] === s })[0]; n.DisplayType.IsLookup(i.getField(f).getDisplayType()) || n.DisplayType.Location == i.getField(f).getDisplayType() ? l[f.toLower()] != null && l[f.toLower()] != undefined && (e = i.getField(f.toLower()).lookup.getDisplay(l[f.toLower()])) : n.DisplayType.IsDate(i.getField(f).getDisplayType()) ? (e = i.getField(f).value, e = new Date(e)) : e = l[f.toLower()]; u = u.substring(u.indexOf("@@") + 2); o["@@" + s + "@@"] = e } return o } function dt(t, u) { for (var h = t, f = t; f.indexOf("@@") > -1;) { f = f.substring(f.indexOf("@@") + 2); var c = f.substring(0, f.indexOf("@@")), s = null, e = Object.keys(r.getColumnNames()).filter(function (n) { return r.getColumnNames()[n] === c })[0]; n.DisplayType.IsLookup(i.getField(e).getDisplayType()) || n.DisplayType.Location == i.getField(e).getDisplayType() ? o[u][e.toLower()] != null && o[u][e.toLower()] != undefined && (s = i.getField(e.toLower()).lookup.getDisplay(o[u][e.toLower()])) : n.DisplayType.IsDate(i.getField(e).getDisplayType()) ? (s = i.getField(e).value, s = new Date(s)) : s = o[u][e.toLower()]; f = f.substring(f.indexOf("@@") + 2); h = h.replace("@@" + c + "@@", s) } return h } function gt(t) { for (var f = t; f.indexOf("@@") > -1;) { f = f.substring(f.indexOf("@@") + 2); var o = f.substring(0, f.indexOf("@@")), e = null, u = Object.keys(r.getColumnNames()).filter(function (n) { return r.getColumnNames()[n] === o })[0]; n.DisplayType.IsLookup(i.getField(u).getDisplayType()) || n.DisplayType.Location == i.getField(u).getDisplayType() ? l[u.toLower()] != null && l[u.toLower()] != undefined && (e = i.getField(u.toLower()).lookup.getDisplay(l[u.toLower()])) : n.DisplayType.IsDate(i.getField(u).getDisplayType()) ? (e = i.getField(u).value, e = new Date(e)) : e = r.singleRow == !0 ? i.getField(u).value : l[u.toLower()]; f = f.substring(f.indexOf("@@") + 2); t = t.replace("@@" + o + "@@", e) } return t } function bi(t) { var i = h.val(), r = !0; (i == null || i == "" || i.trim().length == 0) && (r = !1, n.ADialog.confirm("SendWithoutBody", !0, "", "Confirm", function (n) { n && ni(t, i) })); r && ni(t, i) } function ni() { var s, p, i, f, u, a, w, b, d, g; if (ft = [], s = "", p = [], k.prop("checked") == !1) { if (i = {}, i.MobileNumbers = [], c.val().contains(";")) for (f = c.val().split(";"), u = 0; u < f.length; u++)f[u] != null && f[u] != "" && (ii(f[u]) ? i.MobileNumbers.push(f[u]) : s += f[u] + ","); else c.val() != null && c.val() != "" && (ii(c.val()) ? i.MobileNumbers.push(c.val()) : s += c.val() + ","); if (v != null && v != undefined) if (selectedValues = [], e.find("[id*=CheckBoxList1]:checked").each(function () { selectedValues.push(t(this).val()) }), selectedValues.length > 0) for (a = 0; a < selectedValues.length; a++)selectedValues[a] ? i.MobileNumbers.push(selectedValues[a]) : s += selectedValues[a] + ","; else if (c.val().trim().length == 0) { window.setTimeout(function () { n.ADialog.info("NoNumberFound") }, 2); return } if (s != "") { window.setTimeout(function () { n.ADialog.info("InvalidMobileNumbers", " ", n.Msg.getMsg("MobileNo") + s) }, 2); return } if (i.Body = {}, i.MobileNumbers.length > 0) for (w = 0; w < i.MobileNumbers.length; w++)ft.push({ num: i.MobileNumbers[w], info: '"' + i.MobileNumbers[w] + '","' + h.val() + '","' + new Date + '","@@response@@"' }); p.push(i) } else if (selectedValues = [], t("[id*=CheckBoxList1]:checked").each(function () { selectedValues.push(t(this).val()) }), r.singleRow == !0 && o.length > 0) p.push(ti(l, 0)); else for (b = 0; b < o.length; b++)p.push(ti(o[b], b)); d = JSON.stringify(p); y[0].style.visibility = "visible"; g = { sms: d, format: h.val() }; t.ajax({ url: n.Application.contextUrl + "Sms/SendSms", data: g, datatype: "json", type: "post", cache: !1, success: function (i) { var r = JSON.parse(i), e, o, u, s, h, c, f; if (y[0].style.visibility = "hidden", r.ResultMessage == "SmsConfigurationNotFound") { window.setTimeout(function () { n.ADialog.info("SmsConfigurationNotFound") }, 2); return } for (e = t('<div style="max-height: 300px;overflow:auto"><\/div>'), o = t("<table><\/table>"), u = 0; u < r.Response.length; u++)s = t("<tr><\/tr>"), h = t("<td><\/td>"), h.append(r.Response[u].mobileNumber + " - " + r.Response[u].response), s.append(h), o.append(s); e.append(o); c = t('<a style="float:right" href="javascript:void(0)" ><i title="' + n.Msg.getMsg("SaveSmsLog") + '" class="vis vis-save"><\/i><\/a>'); e.append(c); f = new n.ChildDialog; f.setTitle(n.Msg.getMsg("Information")); f.setContent(e); f.show(); f.hidebuttons(); c.on("click", function () { for (var u, f, e, i = "", n = 0; n < r.Response.length; n++)u = t.grep(ft, function (t) { return t.num == r.Response[n].mobileNumber }), i += u[0].info.replace("@@response@@", r.Response[n].response) + "\n"; f = (new Date).toISOString().slice(0, 19).replace(/-/g, ""); e = "data:text/csv;base64," + window.btoa(i); t(this).attr("href", e).attr("download", "file-" + f + ".csv") }) }, error: function (t) { console.log(t); n.ADialog.error("MessageSendingFailed"); y[0].style.visibility = "hidden" } }) } function ti(n, t) { var i = {}, u, t, e, f; if (i.MobileNumbers = [], c.val().contains(";")) for (u = c.val().split(";"), t = 0; t < u.length; t++)u[t] != null && u[t] != "" && i.MobileNumbers.push(u[t]); else c.val() != null && c.val() != "" && i.MobileNumbers.push(c.val()); if (v != null && v != undefined && Object.keys(n).indexOf("mobile") > -1 && selectedValues.indexOf(n.mobile) > -1 && i.MobileNumbers.push(n.mobile), e = "", r.singleRow == !1 ? (i.Body = pi(h.val(), t), e = dt(h.val(), t)) : (i.Body = wi(h.val()), e = gt(h.val())), i.MobileNumbers.length > 0) for (f = 0; f < i.MobileNumbers.length; f++)ft.push({ num: i.MobileNumbers[f], info: '"' + i.MobileNumbers[f] + '","' + e + '","' + new Date + '","@@response@@"' }); return i } function ii(n) { var i = !0, t, r; if (n.indexOf("(") > -1 && (n = n.substring(0, n.toString().indexOf("("))), n.length < 10 || n.length > 17) i = !1; else { for (r = n.length, t = 0; t < r; t++)isNaN(n[t]) && (/\s+$/.test(n[t]) || n[t] != "(" && n[t] != ")" && (i = !1)); n.indexOf("(") > -1 && !n.indexOf(")") > -1 && (i = !1) } return i } function ki() { e.height(vt); e.width(st); var n = 0; e.find(".contentArea").css("height", e.height() - 42); e.find(".vis-sms-leftDiv").height(e.height() - 42); e.find(".vis-sms-textarea-div").css("margin-top", "10px"); e.find(".vis-sms-rytBcc").height(e.find(".vis-sms-rytContent").height() - 10); w ? (e.find(".vis-sms-leftDiv").hide(), e.find(".vis-sms-rytWrap").hide(), e.find(".vis-sms-textarea-div").height(e.height() - 150), e.find(".vis-sms-leftWrap").css("width", "100%"), n = e.width() - 40, k.prop("checked", !1), k.hide()) : (e.find(".vis-sms-textarea-div").height(e.height() - 150), n = st - (e.find(".vis-sms-leftDiv").width() + 30), e.find(".vis-sms-leftWrap").width(n - 345)); b = e.find(".vis-sms-ContentWrap"); b.css("width", n) } this.frame = null; this.windowNo = n.Env.getWindowNo(); var ri = n.Env.getCtx(), d = null, w = !1, g = "C_BPARTNER_ID", o = null, l = null, at = 0, ft = [], s = this, vt = 0, st = 0, p = null, e = t('<div class="vis-sms-rootDiv vis-forms-container"><\/div>'), ht = t('<div class="vis-awindow-header vis-menuTitle">'), a = null, b = null, et = null, nt = null, h = null, v = null, c = null, p = null, rt, ut, ot, it, tt, yt = !1, y, pt = null, k = null; ui(); this.initializeComponent = function () { var i = t('<a href="javascript:void(0)"  class="vis-icon-menuclose"><i class="vis vis-cross"><\/i><\/a>'), u = ""; u = w ? t("<p>" + n.Msg.getMsg("Sms") + " (" + n.Msg.getMsg("Contacts") + ") <\/p>") : t("<p>" + n.Msg.getMsg("Sms") + " (" + r.aPanel.$parentWindow.getName() + ") <\/p>"); e.append(ht.append(i).append(u)); e.append(y); i.click(function (n) { s.dispose(); s = null; n.stopPropagation() }); fi(); oi(); w || (ei(), wt(!1)); hi() }; this.disposeComponent = function () { it.off("click"); w || (nt.off("click"), p.children("li").off("click"), p.remove(), nt.remove()); k.off("click"); tt != undefined && (tt.off("click"), tt.remove()); h.off("keyup"); e.find(".vis-sms-CcBcc").off("click"); ri = null; d = null; w = !1; g = ""; o = null; l = null; at = 0; p = null; e.remove(); e = null; a.remove(); a = null; b.remove(); b = null; et.remove(); et = null; nt = null; v.remove(); v = null; c.remove(); c = null; p != null && p.remove(); p = null; it.remove(); it = null; tt = null; s = null }; this.show = function () { d = new n.ChildDialog; d.setHeight(800); d.setWidth(1600); d.setTitle(n.Msg.getMsg("Sms")); d.setModal(!0); d.show(); e = t('<div class="vis-sms-rootDiv"><\/div>'); d.setContent(e); initializeComponent() }; this.getRoot = function () { return e }; this.sizeChanged = function (n, t) { vt = n; st = t; yt == !0 && ki() } } i.prototype.init = function (n, t) { this.frame = t; this.windowNo = n; t.hideHeader(!0); this.initializeComponent(); this.frame.getContentGrid().append(this.getRoot()) }; i.prototype.dispose = function () { this.disposeComponent(); this.frame && this.frame.dispose(); this.frame = null }; n.Sms = i }(VIS, jQuery), function (n, t) { function f(n, i, u) { var f = null; return t.ajax({ url: r, type: "POST", datatype: "json", contentType: "application/json; charset=utf-8", async: i, data: JSON.stringify(n) }).done(function (n) { f = n; u && u(n) }), f } function e(i, r, f, e, o, s) { var a = 232, c = "", l = null, h = null; this.getRequests = function () { for (var e = u("VIS_72", null), h, l, a, o, i; e.read();)if (parseInt(e.getString(0)) == 0) { n.ADialog.error("VIS_NotSupported"); return } for (c = "(AD_Table_ID=" + r + " AND Record_ID=" + f + ")", r == 114 ? c += " OR AD_User_ID=" + f + " OR SalesRep_ID=" + f : r == 291 ? c += " OR C_BPartner_ID=" + f : r == 259 ? c += " OR C_Order_ID=" + f : r == 318 ? c += " OR C_Invoice_ID=" + f : r == 335 ? c += " OR C_Payment_ID=" + f : r == 208 ? c += " OR M_Product_ID=" + f : r == 203 ? c += " OR C_Project_ID=" + f : r == 539 && (c += " OR A_Asset_ID=" + f), e = null, t.ajax({ type: "Get", async: !1, url: n.Application.contextUrl + "Form/GetProcessedRequest", data: { AD_Table_ID: r, Record_ID: f }, success: function (t) { e = (new n.DB.DataReader).toJson(t) } }), h = 0, l = 0; e.read();)"Y" == e.getString(0) ? h = e.getString(1) : l += e.getString(1); a = t("<div>"); o = t("<ul class=vis-apanel-rb-ul>"); a.append(o); i = t("<li data-id='RequestCreate'>"); i.append(n.Msg.getMsg("RequestNew")); i.on("click", function (n) { v(n) }); if (o.append(i), l > 0) { i = t("<li data-id='RequestActive'>"); i.append(n.Msg.getMsg("RequestActive")); i.on("click", function (n) { y(n) }); o.append(i) } if (h > 0) { i = t("<li data-id='RequestActive'>"); i.append(n.Msg.getMsg("RequestAll")); i.on("click", function (n) { p(n) }); o.append(i) } s.w2overlay(a.clone(!0), { css: { height: "200px" } }) }; var v = function (i) { i.stopImmediatePropagation(); l = n.viewManager.startWindow(a, null); l.onLoad = function () { var n = l.cPanel.curGC; n.onRowInserting = function () { l.cPanel.cmd_new(!1) }; n.onRowInserted = function () { h = l.cPanel.curTab; h.setValue("AD_Table_ID", r); h.setValue("Record_ID", f); e != null && e > 0 && h.setValue("C_BPartner_ID", e); r == 291 ? h.setValue("C_BPartner_ID", f) : r == 114 ? h.setValue("AD_User_ID", f) : r == 203 ? h.setValue("C_Project_ID", f) : r == 539 ? h.setValue("A_Asset_ID", f) : r == 259 ? h.setValue("C_Order_ID", f) : r == 318 ? h.setValue("C_Invoice_ID", f) : r == 208 ? h.setValue("M_Product_ID", f) : r == 335 ? h.setValue("C_Payment_ID", f) : r == 319 && h.setValue("M_InOut_ID", f) } }; var u = t("#w2ui-overlay"); u.hide(); u = null }, y = function (i) { var r, u; i.stopImmediatePropagation(); r = new n.Query; r.addRestriction("(" + c + ") AND Processed='N'"); n.viewManager.startWindow(a, r); u = t("#w2ui-overlay"); u.hide(); u = null }, p = function (i) { var r, u; i.stopImmediatePropagation(); r = new n.Query; r.addRestriction(c); n.viewManager.startWindow(a, r); u = t("#w2ui-overlay"); u.hide(); u = null } } var i = n.Application.contextUrl, r = i + "JsonData/JDataSetWithCode", u = function (t, i, r) { var o = r ? !0 : !1, e = { sql: t, page: 1, pageSize: 0 }, u; return i && (e.param = i), u = null, f(e, o, function (t) { u = (new n.DB.DataReader).toJson(t); r && r(u) }), u }; n.ARequest = e }(VIS, jQuery), function (n, t) { function i() { var c = n.Application.contextFullUrl; if (c || (c = n.Application.contextUrl), c && c.toString().toLowerCase().indexOf("softwareonthecloud.com") > -1) { n.ADialog.info("VIS_GotoControlPanel", !0, "", ""); return } var l = t("<div class='vis-forms-container' style='height:100%'>"), et = t("<div class='vis-its-main-wrap vis-pull-left'>"), ut = t("<div style='height:100%'>"); l.append(ut); ut.append(et); var ot = t("<div class='vis-its-ryt-panel vis-pull-right' >"), r = t("<div class='vis-its-ryt-panel-inner vis-pull-left' >"), a = t('<a href="javascript:void(o)"  style="display:none;" class="vis-initial-btn vis-initial-btn-blue">').append(t("<i class='vis vis-save'><\/i>")); ut.append(ot); ot.append(r).append(a); r.append(t("<h3>").append(n.Msg.getMsg("Result"))); var i = t('<div class="vis-busyindicatorouterwrap"><div class="vis-busyindicatorinnerwrap"><i class="vis-busyindicatordiv"><\/i><\/div><\/div>'), wt = n.Env.getWindowNo(), v = null, y = null, p = null, w = null, o = null, u = null, b = null, f = null, k = null, d = null, g = null, nt = null, tt = null, s = null, ct = null, it = null, rt = null, ft = null, e = null, h = null, st = null; this.load = function () { var ri = t("<div class='vis-graywrap'>"), r, ui, a, fi, ut, ei, ft, oi, ot, si, ct, hi, pt, ci, wt, li, bt, ai, e, kt, dt, gt, ni, ti, c, ii; et.append(ri); r = t("<div class='initial-client-form'>"); ri.append(r); r.append(t("<h3 class='VIS_Pref_change-pass'>").append(t("<label class='VIS_Pref_Label_Font'>").append(n.Msg.getMsg("TenantHeaderComment")))); ui = t("<div class='input-group vis-input-wrap vis-intial-form-data'>"); a = t("<div class='vis-control-wrap'><\/div>"); v = t('<input type="text" name="tenant" placeholder="' + n.Msg.getMsg("Tenant") + '">'); ui.append(a); a.append(v); a.append(t("<label>").append(n.Msg.translate(n.context, "AD_Client_ID"))); r.append(ui); fi = t("<div class='input-group vis-input-wrap vis-intial-form-data'>"); ut = t("<div class='vis-control-wrap'><\/div>"); y = t('<input type="text" name="tenant" placeholder="' + n.Msg.getMsg("Org") + '">'); fi.append(ut); ut.append(y); ut.append(t("<label>").append(n.Msg.translate(n.context, "AD_Org_ID"))); r.append(fi); ei = t("<div class='input-group vis-input-wrap vis-intial-form-data'>"); ft = t("<div class='vis-control-wrap'><\/div>"); p = t('<input type="text" name="tenant" placeholder="' + n.Msg.getMsg("TenantAdmin") + '">'); ei.append(ft); ft.append(p); ft.append(t("<label>").append(n.Msg.parseTranslation(n.context, "@AD_User_ID@ @AD_Client_ID@"))); r.append(ei); oi = t("<div class='input-group vis-input-wrap vis-intial-form-data'>"); ot = t("<div class='vis-control-wrap'><\/div>"); w = t('<input type="text" name="tenant" placeholder="' + n.Msg.getMsg("TenantUser") + '">'); oi.append(ot); ot.append(w); ot.append(t("<label>").append(n.Msg.parseTranslation(n.context, "@AD_User_ID@ @AD_Org_ID@"))); r.append(oi); si = t("<div class='input-group vis-input-wrap vis-intial-form-dataCombo'>"); ct = t("<div class='vis-control-wrap'><\/div>"); o = t('<select placeholder="Currency">'); si.append(ct); ct.append(o); ct.append(t("<label>").append(n.Msg.translate(n.context, "C_Currency_ID"))); r.append(si); hi = t("<div class='input-group vis-input-wrap vis-intial-form-dataCombo'>"); pt = t("<div class='vis-control-wrap'><\/div>"); u = t('<select placeholder="Country">'); hi.append(pt); pt.append(u); pt.append(t("<label>").append(n.Msg.translate(n.context, "C_Country_ID"))); r.append(hi); ci = t("<div class='input-group vis-input-wrap vis-intial-form-dataCombo'>"); wt = t("<div class='vis-control-wrap'><\/div>"); b = t('<input type="text" placeholder="' + n.Msg.getMsg("City") + '" style="width:100%;">'); ci.append(wt); wt.append(b); wt.append(t("<label>").append(n.Msg.translate(n.context, "City"))); r.append(ci); li = t("<div class='input-group vis-input-wrap vis-intial-form-dataCombo' >"); bt = t("<div class='vis-control-wrap'><\/div>"); f = t('<select placeholder="Region">'); bt.append(f); bt.append(t("<label>").append(n.Msg.translate(n.context, "C_Region_ID"))); li.append(bt); r.append(li); r.append(t('<div style="width:100%;float:left;">').append(t("<label  class='vis-cs-op-lbl' class='vis-pull-left'>").append(n.Msg.getMsg("Optional")))); ai = t('<div class="vis-fieldset-wrap">'); e = t("<div class='vis-intial-form-data vis-fieldset-inn'>"); ai.append(e); r.append(ai); kt = t('<div class="vis-initial-form-checkbox" >'); k = t('<input type="checkbox">'); kt.append(k); kt.append(t("<label>").append(n.Msg.translate(n.context, "C_Project_ID"))); e.append(kt); dt = t('<div class="vis-initial-form-checkbox">'); d = t('<input type="checkbox">'); dt.append(d); dt.append(t("<label>").append(n.Msg.translate(n.context, "C_SalesRegion_ID"))); e.append(dt); gt = t('<div class="vis-initial-form-checkbox">'); g = t('<input type="checkbox" checked disabled>'); gt.append(g); gt.append(t("<label>").append(n.Msg.translate(n.context, "M_Product_ID"))); e.append(gt); ni = t('<div class="vis-initial-form-checkbox">'); nt = t('<input type="checkbox">'); ni.append(nt); ni.append(t("<label>").append(n.Msg.translate(n.context, "C_Campaign_ID"))); e.append(ni); ti = t('<div class="vis-initial-form-checkbox">'); tt = t('<input type="checkbox" checked disabled>'); ti.append(tt); ti.append(t("<label>").append(n.Msg.translate(n.context, "C_BPartner_ID"))); e.append(ti); c = t("<div class='vis-initial-btn-left vis-pull-right'>"); ri.append(c); ii = t('<div style="display: inline;">'); c.append(ii); h = t('<input type="checkbox" style="margin-right: 5px;margin-left: 10px;margin-top: 5px;display:none">'); h.prop("checked", !0); h.on("click", function () { h.prop("checked") ? s.css("display", "none") : s.css("display", "initial") }); ii.append(h); st = t("<label style='margin-right: 10px;font-size: 14px;color: #666;font-weight: normal;display:none'>").append(n.Msg.getMsg("UseDefault")); ii.append(st); s = t("<a class='vis-initial-btn vis-initial-btn-blue' style='margin-right:10px;display:none;'>").append(n.Msg.getMsg("LoadAccountingValues")); s.on("click", function () { rt.trigger("click") }); c.append(s); rt = t("<input type='file' style='display:none;' accept='.csv*'>"); rt.change(function () { vt(this) }); c.append(rt); it = t("<a href='javascript:;' class='vis-initial-btn' style='margin-right: 15px;'>").append(n.Msg.getMsg("Done")); it.on("click", function () { yt() }); c.append(it); l.append(i); u.change(function () { u.val() > 0 && t.ajax({ url: n.Application.contextUrl + "VSetup/GetRegion", dataType: "json", data: { countryID: u.val() }, error: function () { n.ADialog.error(n.Msg.getMsg("ERRORGettingInitialData")); i[0].style.visibility = "hidden" }, success: function (t) { var r = t.result; if (r == null) { n.ADialog.error(n.Msg.getMsg("ERRORGettingInitialData")); i[0].style.visibility = "hidden"; return } f.empty(); ht(r); i[0].style.visibility = "hidden" } }) }); i[0].style.visibility = "visible"; t.ajax({ url: n.Application.contextUrl + "VSetup/GetInitialData", dataType: "json", error: function () { n.ADialog.error(n.Msg.getMsg("ERRORGettingInitialData")); i[0].style.visibility = "hidden" }, success: function (t) { var r = t.result; if (r == null) { n.ADialog.error(n.Msg.getMsg("ERRORGettingInitialData")); i[0].style.visibility = "hidden"; return } lt(r.currency); at(r.country); ht(r.region); i[0].style.visibility = "hidden" } }) }; var lt = function (n) { if (n != null) for (var i in n) o.append(t('<option value="' + n[i].ID + '">').append(n[i].Name + " (" + n[i].ISO_Code + ")")) }, at = function (n) { if (n != null) for (var i in n) u.append(t('<option value="' + n[i].ID + '">').append(n[i].Name)) }, ht = function (n) { if (n != null) for (var i in n) f.append(t('<option value="' + n[i].ID + '">').append(n[i].Name)) }, vt = function (t) { e = t.files[0].name; i[0].style.visibility = "visible"; window.setTimeout(function () { ft = Date.now().toString(); var r = new XMLHttpRequest, u = new FormData; u.append("file", t.files[0]); r.open("POST", n.Application.contextUrl + "Attachment/SaveFileinTemp/?filename=" + e + "&folderKey=" + ft, !1); r.send(u); i[0].style.visibility = "hidden" }, 2) }, yt = function () { var l, it, s, c, rt, st, ut, ht, et, ct, ot; if (r.empty(), a.hide(), l = v.val(), l == null || l.length == 0 || l.trim().length == 0) { n.ADialog.error("FillTenantName"); return } if (it = y.val(), it == null || it.length == 0 || it.trim().length == 0) { n.ADialog.error("FillOrgName"); return } if (s = p.val(), s == null || s.length == 0 || s.trim().length == 0) { n.ADialog.error("FillUserClient"); return } if (c = w.val(), c == null || c.length == 0 || c.trim().length == 0) { n.ADialog.error("FillUserOrg"); return } if (rt = b.val(), rt == null || rt.length == 0 || rt.trim().length == 0) { n.ADialog.error("FillCity"); return } if (st = o.val(), ut = o.find("option:selected").text(), ut == null || ut.length == 0 || ut.trim().length == 0) { n.ADialog.error("FillCurrency"); return } if (ht = u.val(), et = u.find("option:selected").text(), et == null || et.length == 0 || et.trim().length == 0) { n.ADialog.error("FillCountry"); return } if (ct = f.val(), ot = f.find("option:selected").text(), ot == null || ot.length == 0 || ot.trim().length == 0) { n.ADialog.error("FillRegion"); return } if (h.prop("checked")) e = null; else if (e == null || e.length == 0 || e.trim().length == 0) { n.ADialog.error("SelectFile"); return } if (s == c) { n.ADialog.error("UsernameMustBeDifferent"); return } var lt = g.prop("checked"), at = tt.prop("checked"), vt = k.prop("checked"), yt = nt.prop("checked"), wt = d.prop("checked"); i[0].style.visibility = "visible"; t.ajax({ url: n.Application.contextUrl + "VSetup/InitailizeClientSetup", type: "POST", dataType: "json", data: { clientName: l, orgName: it, userClient: s, userOrg: c, city: rt, currencyID: st, currencyName: ut, countryID: ht, countryName: et, regionID: ct, regionName: ot, cfProduct: lt, cfBPartner: at, cfProject: vt, cfMCampaign: yt, cfSRegion: wt, fileName: e, folderKey: ft }, error: function () { n.ADialog.error("ErrorCreatingTenant"); i[0].style.visibility = "hidden" }, success: function (n) { var t = n.result; i[0].style.visibility = "hidden"; pt(t) } }) }, pt = function (i) { i.Log != null && i.Log.trim().length > 0 && (r.append(t('<div style="margin-bottom:10px">').append(" Error - " + i.Log)), r.append(t('<div style="margin-bottom:10px">').append(n.Msg.getMsg("VIS_TenantErrorMsg")))); r.append(t('<div style="margin-bottom:10px">').append(" Tenant Name - " + i.TenantName)); r.append(t('<div style="margin-bottom:10px">').append(" Organization Name - " + i.OrgName)); r.append(t('<div style="margin-bottom:10px">').append(" Admin Role - " + i.AdminRole)); r.append(t('<div style="margin-bottom:10px">').append(" User Role - " + i.UserRole)); r.append(t('<div style="margin-bottom:10px">').append(" Admin Username - " + i.AdminUser)); r.append(t('<div style="margin-bottom:10px">').append(" Admin User Password - " + i.AdminUserPwd)); r.append(t('<div style="margin-bottom:10px">').append(" Org Username - " + i.OrgUser)); r.append(t('<div style="margin-bottom:10px">').append(" Org User Password - " + i.OrgUserPwd)); a.on("click", function () { var n = "", r, u; n += " Tenant Name - " + i.TenantName + "\t\n"; n += " Organization Name - " + i.OrgName + "\t\n"; n += " Admin Role - " + i.AdminRole + "\t\n"; n += " User Role - " + i.UserRole + "\t\n"; n += " Admin Username - " + i.AdminUser + "\t\n"; n += " Admin User Password - " + i.AdminUserPwd + "\t\n"; n += " Org Username - " + i.OrgUser + "\t\n"; n += " Org User Password - " + i.OrgUserPwd + "\t\n"; r = (new Date).toISOString().slice(0, 19).replace(/-/g, ""); u = "data:text/csv;base64," + window.btoa(n); t(this).attr("href", u).attr("download", "file-" + r + ".txt") }); a.show() }; this.disposeComponent = function () { v = null; y = null; p = null; w = null; o = null; u = null; b = null; f = null; k = null; d = null; g = null; nt = null; tt = null; s = null; ct = null; it = null; i = null; l = null }; this.getRoot = function () { return l } } n.Apps = n.Apps || {}; n.Apps.AForms = n.Apps.AForms || {}; i.prototype.sizeChanged = function () { }; i.prototype.init = function (n, t) { this.frame = t; this.windowNo = n; this.load(); this.frame.getContentGrid().append(this.getRoot()) }; i.prototype.dispose = function () { this.disposeComponent(); this.frame && this.frame.dispose(); this.frame = null }; n.Apps.AForms.VSetup = i }(VIS, jQuery), function (n, t) { function i() { function s(o) { e = o; u = e.find("#vis_favScroll"); h(); f = t("#userFav-Tab"); i = t('<ul class="vis-userFavourites-ListMenu">'); i.on("click", function (u) { var f = t(u.target), e; f.data("btn") == "action" ? n.viewManager.startAction(f.data("action"), f.data("id")) : f.data("btn") == "zoom" ? n.viewManager.startActionInNewTab(f.data("action"), f.data("id")) : f.data("btn") == "remove" && (a(f.data("id")), e = t(f).parent().parent(), e.empty(), e.remove(), r(i.find("li").length)) }) } function h() { t.ajax({ url: n.Application.contextUrl + "Home/GetFavouriteNode", dataType: "json", error: function () { alert(n.Msg.getMsg("ERRORGetFavouriteNode")) }, success: function (n) { if (u.empty(), n.result) for (var t = 0, f = n.result.length; t < f; t++)o(n.result[t]); r(i.find("li").length); u.append(i) } }) } function c(n) { o(n); r(i.find("li").length) } function o(r) { var e, u, l, f, c, s; if (i != null) { e = t('<li data-nodeid="' + r.NodeID + '" >'); u = 0; r.Action == "W" ? u = r.WindowID : r.Action == "X" ? u = r.FormID : r.Action == "P" ? u = r.ProcessID : r.Action == "R" && (u = r.ProcessID); var o = t('<a href="#" data-id="' + u + '" data-action="' + r.Action + '" data-nodeid="' + r.NodeID + '" data-btn="action" style="overflow: auto;" >'), h = t('<div class="vis-favboxtopico">'), a = t("<a href='javascript:void(0)' data-id='" + r.NodeID + "'  data-btn='remove' class='vis vis-removefav'>"); h.append(a); l = t("<a href='javascript:void(0)' data-id='" + u + "' data-action='" + r.Action + "' data-btn='zoom' class='vis vis-new-tab'>"); h.append(l); e.append(h); e.append(o); f = r.Name; f.length > 27 ? (f = f.substr(0, 27), o.append(f), c = t("<a href='#' class='VIS_Pref_tooltip' style='display: inline-block;'>").append("..."), s = t("<span style='width: inherit;'>"), s.append(t("<img class='VIS_Pref_callout'>").attr("src", n.Application.contextUrl + "Areas/VIS/Images/ccc.png").append("ToolTip Text")), s.append(t("<label class='VIS_Pref_Label_Font'>").append(r.Name)), c.append(s), o.append(c)) : o.append(r.Name); i.append(e) } } function l(n) { var f, u, e, o; if (i != null) { for (f = i.find("li"), u = null, e = 0, o = f.length; e < o; e++)u = t(f[e]), u.data("nodeid") === n && u.remove(); f = u = null; r(i.find("li").length) } } function a(i) { n.FavouriteHelper.removeFavourite(i); t.ajax({ url: n.Application.contextUrl + "Home/RemoveNodeFavourite/?nodeID=" + i, dataType: "json" }) } function r(t) { f.empty(); f.html("<span><i class='vis vis-favourite'><\/i><\/span><span class='favouriteTabLabel-Large'>" + n.Msg.getMsg("Favourites") + " - <\/span><strong>" + t + "<\/strong>") } var e, u, i, f; return { init: s, addFavourite: c, removeFavourite: l } } n.favMgr = i() }(VIS, jQuery), function (n, t) { function h(i, r) { var u = null, f = ""; url = n.Application.contextUrl + "WSP/Contacts/GetBPLocation?WinNo=" + r.windowNo + "&bpartnerID=" + i; t.ajax({ type: "GET", async: !1, url: url, dataType: "json", success: function (n) { u = JSON.parse(n); for (var t = 0; t < u.lstBPLocation.length; t++)f += "<option value='" + u.lstBPLocation[t].ID + "'>" + u.lstBPLocation[t].Name + "<\/option>"; o.empty(); o.append(f) } }) } function c(t, i, r, f, e, o) { u = new n.ChildDialog; u.setContent(t); i == "Customer" ? u.setTitle(n.Msg.getMsg("Customer")) : i == "Employee" ? u.setTitle(n.Msg.getMsg("Employee")) : i == "Vendor" ? u.setTitle(n.Msg.getMsg("Vendor")) : i == "Prospect" && u.setTitle(n.Msg.getMsg("Prospect")); u.setEnableResize(!1); u.setModal(!0); u.show(); l(e, i, o); r.on("change", function () { h(r.val(), f) }) } function l(e, o, s) { u.onOkClick = function () { var l = t("#divBPartner_" + i.windowNo).find("img"), rt = t(window).height() * (50 / 100), ut = t(window).width() * (50 / 100), u; e.css("margin-top", rt); e.css("margin-left", ut); s.show(); l.css("visibility", "visible"); var h = t("#txtName_" + i.windowNo).val(), c = t("#txtSearchKey_" + i.windowNo).val(), a = t("#ddlGreeting1_" + i.windowNo).val(), ft = t("#txtName2_" + i.windowNo).val(), v = t("#ddlBPGroup_" + i.windowNo).val(), y = t("#ddlBPRelation_" + i.windowNo).val(), p = t("#ddlBPLoaction_" + i.windowNo).val(), w = t("#txtContact_" + i.windowNo).val(), b = t("#ddlGreeting_" + i.windowNo).val(), k = t("#txtTitle_" + i.windowNo).val(), d = t("#txtEmail_" + i.windowNo).val(), g = r.getValue(), nt = t("#txtPhone_" + i.windowNo).val(), tt = t("#txtPhone2_" + i.windowNo).val(), it = t("#txtFax_" + i.windowNo).val(); if (h.trim() == "" || c.trim() == "") { n.ADialog.info("NameMandatory"); s.hide(); l.css("visibility", "collapse"); return } u = null; o == "Customer" ? u = n.Msg.getMsg("Customer") : o == "Employee" ? u = n.Msg.getMsg("Employee") : o == "Vendor" ? u = n.Msg.getMsg("Vendor") : o == "Prospect" && (u = n.Msg.getMsg("Prospect")); url = n.Application.contextUrl + "WSP/Contacts/AddBPartnerInfo"; v == "0" && (v = undefined); y == "0" && (y = undefined); p == "0" && (p = undefined); b == "0" && (b = undefined); a == "0" && (a = undefined); g == null && (g = undefined); nt == "" && (nt = undefined); tt == "" && (tt = undefined); w == "" && (w = undefined); h == null && (h = undefined); it == "" && (it = undefined); c == "" && (c = undefined); k == "" && (k = undefined); d == "" && (d = undefined); u == "" && (u = undefined); t.ajax({ type: "Post", async: !1, url: url, dataType: "json", data: { searchKey: c, name: h, name2: ft, greeting: b, bpGroup: v, bpRelation: y, bpLocation: p, contact: w, greeting1: a, title: k, email: d, address: g, phoneNo: nt, phoneNo2: tt, fax: it, windowNo: i.windowNo, BPtype: u }, success: function (n) { s.hide(); l.css("visibility", "collapse"); alert(n); f.empty() } }) } } function a(i, u, o, s, h, l, a) { var y = null, p = "", w = "", b = "", k = "", g = new n.MLocationLookup(n.context.ctx, i.windowNo), nt, d; r = new n.Controls.VLocation("C_Location_ID", !0, !1, !0, n.DisplayType.Location, g); nt = r.getBtnCount(); f = t("<div id='divBPartner_" + i.windowNo + "' style='width:auto;height:auto;margin-right:5px'> <img src='/ViennaAdvantageWeb1/Areas/VIS/Images/busy.gif' style=' margin-top: 120px; margin-left: 327px; z-index:9999;position:absolute;visibility:collapse'>"); d = n.Application.contextUrl + "WSP/Contacts/AddBusinessPartner?WinNo=" + i.windowNo + "&UserID=" + u; t.ajax({ type: "GET", async: !1, url: d, dataType: "json", success: function (n) { for (var i = JSON.parse(n), t = 0; t < i.lstGreeting.length; t++)p += "<option value='" + i.lstGreeting[t].ID + "'>" + i.lstGreeting[t].Name + "<\/option>"; for (t = 0; t < i.lstBPGroup.length; t++)w += "<option value='" + i.lstBPGroup[t].ID + "'>" + i.lstBPGroup[t].Name + "<\/option>"; for (t = 0; t < i.lstBPRelation.length; t++)b += "<option value='" + i.lstBPRelation[t].ID + "'>" + i.lstBPRelation[t].Name + "<\/option>"; for (t = 0; t < i.lstBPLocation.length; t++)k += "<option value='" + i.lstBPLocation[t].ID + "'>" + i.lstBPLocation[t].Name + "<\/option>"; y = v(p, w, k, b, o, s) } }); f.append(y); f.load(); c(f, h, e, i, l, a) } function v(u, f, c, l, a, v) { var y = t("<table id='tableBPartner_" + i.windowNo + "'><tr><td><div style='margin-top: 0px; float: right' class='wsp-BPartner'>" + n.Msg.getMsg("SearchKey") + " <\/div><\/td><td style='width:300px'><div style='margin-top: 0px;width:100%' class='wsp-BPartner'><input id='txtSearchKey_" + i.windowNo + "' style='height: 25px;width:100%' type='text'><\/div><\/td><td style='width:50px'><\/td> <td style='margin-left:10px'><div style='margin-top: 0px; float: right;margin-right: 5px' class='wsp-BPartner'>" + n.Msg.getMsg("Greeting") + "  <\/div><\/td><td style='width:300px'><div style='margin-top: 0px;margin-right:5px' class='wsp-BPartner'><select id='ddlGreeting1_" + i.windowNo + "' style='width:100%'>" + u + "<\/select><\/div><\/td><\/tr><tr><td><div style='float: right' class='wsp-BPartner'>" + n.Msg.getMsg("Name") + "  <\/div><\/td><td style='width:300px'><div style='width:100%' class='wsp-BPartner'><input id='txtName_" + i.windowNo + "' style='height: 25px;width:100%' type='text'><\/div><\/td><\/tr><tr><td><div style='float: right' class='wsp-BPartner'>" + n.Msg.getMsg("Name2") + "  <\/div><\/td><td style='width:300px'><div style='width:100%' class='wsp-BPartner'><input id='txtName2_" + i.windowNo + "' style='height: 25px;width:100%' type='text'><\/div><\/td><td style='width:50px'> <\/td> <td style='margin-left:10px'><div style='float: right' class='wsp-BPartner'>" + n.Msg.getMsg("BPGroup") + "  <\/div><\/td><td style='width:300px'><div style='margin-right: 5px' class='wsp-BPartner'><select id='ddlBPGroup_" + i.windowNo + "' style='width: 100%'>" + f + "<\/select><\/div><\/td><\/tr><tr><td><div style='float: right' class='wsp-BPartner'>" + n.Msg.getMsg("BPRelation") + "  <\/div><\/td><td style='width:300px'><div style='width:100%' class='wsp-BPartner'><select style='width:100%' id='ddlBPRelation_" + i.windowNo + "' >" + l + "<\/select><\/div><\/td> <td style='width:50px'><\/td><td style='margin-left:10px'><div style='float: right' class='wsp-BPartner'>" + n.Msg.getMsg("BPLoaction") + "  <\/div><\/td><td style='width:300px'><div  class='wsp-BPartner' style='margin-right: 5px'><select id='ddlBPLoaction_" + i.windowNo + "' style='width:100%'><\/select><\/div><\/td><\/tr><tr><td><div style='float: right' class='wsp-BPartner'>" + n.Msg.getMsg("Contact") + "  <\/div><\/td><td style='width:300px'><div style='width:100%' class='wsp-BPartner'><input id='txtContact_" + i.windowNo + "' style='height: 25px;width:100%' type='text'><\/div><\/td> <td style='width:50px'><\/td><td style='margin-left:10px'><div style='float: right' class='wsp-BPartner'>" + n.Msg.getMsg("Greeting") + "  <\/div><\/td><td style='width:300px'><div  class='wsp-BPartner' style='margin-right: 5px'><select id='ddlGreeting_" + i.windowNo + "' style='width: 100%'>" + u + "<\/select><\/div><\/td><\/tr><tr><td><div style='float: right' class='wsp-BPartner'>" + n.Msg.getMsg("Title") + "  <\/div><\/td><td style='width:300px'><div style='width:100%' class='wsp-BPartner'><input id='txtTitle_" + i.windowNo + "' style='height: 25px;width:100%' type='text'><\/div><\/td> <td style='width:50px'><\/td><td style='margin-left:10px'><div style='float: right' class='wsp-BPartner'>" + n.Msg.getMsg("EmailAddress") + "  <\/div><\/td><td style='width:300px'><div  class='wsp-BPartner' style='margin-right: 5px'><input id='txtEmail_" + i.windowNo + "' style='height: 25px;width:100%' type='text'><\/div><\/td><\/tr><tr><td><div style='float: right' class='wsp-BPartner'>" + n.Msg.getMsg("Address") + "  <\/div><\/td><td style='width:300px'><div style='width:100%' id='divAddress_" + i.windowNo + "' class='wsp-BPartner' ><\/div> <\/td> <td style='width:50px'><\/td><td style='margin-left:10px'><div style='float: right' class='wsp-BPartner'>" + n.Msg.getMsg("Phone") + "  <\/div><\/td><td style='width:300px'><div  class='wsp-BPartner' style='margin-right: 5px'><input id='txtPhone_" + i.windowNo + "' style='height: 25px;width:100%' type='text'><\/div><\/td><\/tr><tr><td><div style='float: right' class='wsp-BPartner'>" + n.Msg.getMsg("2ndPhone") + "  <\/div><\/td><td style='width:300px'><div class='wsp-BPartner' style='width:100%;'><input id='txtPhone2_" + i.windowNo + "' style='height: 25px;width:100%' type='text'><\/div><\/td> <td style='width:50px'><\/td><td style='margin-left:10px'><div style='float: right' class='wsp-BPartner'>" + n.Msg.getMsg("Fax") + "  <\/div><\/td><td style='width:300px' ><div style='margin-bottom:7px;margin-right: 5px' class='wsp-BPartner' ><input id='txtFax_" + i.windowNo + "' style='height: 25px;width:100%;' type='text'><\/div><\/td><\/tr><\/table>"), p = y.find("#divAddress_" + i.windowNo); return y.find("#ddlBPRelation_" + i.windowNo).val(a), e = y.find("#ddlBPRelation_" + i.windowNo), o = y.find("#ddlBPLoaction_" + i.windowNo), s = y.find("#ddlBPGroup_" + i.windowNo).val(v), h(a, i), r.getBtn(0).css("width", "10%"), r.getBtn(0).css("height", "10%"), r.getBtn(0).css("padding", "0px"), r.getBtn(1).css("width", "10%"), r.getBtn(1).css("height", "10%"), r.getBtn(1).css("padding", "0px"), p.append(r.getControl().css("width", "80%")).append(r.getBtn(0)).append(r.getBtn(1)), y } var u = null, f = null, i = null, r = null, e = null, o = null, s = null; n.BPartner = function (n, t, r, u, e, o, s) { f != null && f.empty(); i = n; a(i, t, r, u, e, o, s) }; n.AddUpdateBPartner = function (i, h, c, l, a, v) { function ti(n, t, i) { ii(n, t, i) } function ii(i, e, o) { var s = null, h = "", c = "", a = "", v = "", p = new n.MLocationLookup(n.context.ctx, i), w, l; r = new n.Controls.VLocation("C_Location_ID", !0, !1, !0, n.DisplayType.Location, p); w = r.getBtnCount(); f = t("<div id='divBPartner_" + i + "' style='width:auto;height:auto;margin-right:5px'> <img src='/ViennaAdvantageWeb1/Areas/VIS/Images/busy.gif' style=' margin-top: 120px; margin-left: 327px; z-index:9999;position:absolute;visibility:collapse'>"); ei(f, i, e, o); l = n.Application.contextUrl + "BPartner/InitBP?WinNo=" + i + "&bPartnerID=" + e + "&bpType=" + o; t.ajax({ type: "GET", async: !1, url: l, dataType: "json", success: function (t) { for (var u = JSON.parse(t), r = 0; r < u.lstGreeting.length; r++)h += "<option value='" + u.lstGreeting[r].ID + "'>" + n.Utility.encodeText(u.lstGreeting[r].Name) + "<\/option>"; for (r = 0; r < u.lstBPGroup.length; r++)c += "<option value='" + u.lstBPGroup[r].ID + "'>" + n.Utility.encodeText(u.lstBPGroup[r].Name) + "<\/option>"; s = ri(i, e, o, u, h, c, v, a) } }); window.setTimeout(function () { u != null && (f.append(s), f.load(), t(".vis-apanel-busy").css("visibility", "hidden"), t(".vis-apanel-busy").css("height", "460px"), t(".vis-apanel-busy").css("z-index", "99"), y != null && y.hide()) }, 500) } function ri(i, u, f, h, c, l) { var a = t("<DIV class='vis-MainDivBPartnerPopUp'><DIV class='vis-DivBPartnerLeft' ><DIV class='vis-FirstDivBPartnerPopUp' > <\/DIV>" + kt("50%", "Phone Number", 5) + kt("50%", "Internet", 100) + "<DIV class='vis-SecondDivBPartnerPopUp'> <\/DIV>" + kt("100%", "Address", 5) + "<DIV class='vis-ThirdDivBPartnerPopUp'> <\/DIV> <\/DIV><DIV class='vis-FourthDivBPartnerPopUp'> <\/DIV> <\/DIV>"), v; a.find(".vis-FirstDivBPartnerPopUp").append("<DIV class='vis-FirstDivCotrol' ><\/DIV>"); a.find(".vis-FirstDivBPartnerPopUp").append("<DIV class='vis-DivBPartnerRight' > <\/DIV>"); a.find(".vis-SecondDivBPartnerPopUp").append("<DIV class='vis-SecondDivCotrol' ><\/DIV> "); a.find(".vis-SecondDivBPartnerPopUp").append("<DIV class='vis-SecondDivImgCotrol'><\/DIV> "); a.find(".vis-ThirdDivBPartnerPopUp").append("<DIV class='vis-ThirdDivCotrol' ><\/DIV>"); a.find(".vis-FourthDivBPartnerPopUp").append("<DIV class='vis-FourthDivHeader' > " + n.Msg.getMsg("BPType") + " <\/DIV> <DIV class='vis-FourthDivControl'><\/DIV>"); a.find(".vis-DivBPartnerRight").append("<div class='image-upload' style='float: right; position: absolute; z-index: 999; top:40px;overflow:hidden;right:20px'><label for='file-input' class='vis-file-label-bp'><span style='margin-right:8px' class='vis-change-picture-ico vis vis-pencil'><\/span><\/label><input type='file' id='VISFileDialog_" + i + "' accept='image/*' class='wsp-file-input' value='Add Pic' style='opacity: 0; width: 100%; margin-top: 0px; float: right; z-index: 999; position: absolute; right: 0px; cursor: pointer;'><\/div>"); a.find(".vis-DivBPartnerRight").append("<DIV class='vis-FirstDivImgCotrol'><\/DIV>"); a.find(".vis-FirstDivCotrol").append("<DIV class='vis-FirstDivCotrolChild'> <div class='vis-all-lable'>" + n.Msg.getMsg("SearchKeyValue") + "  <\/div> <div class='vis-all-control'><input class='vis-gc-vpanel-table-mandatory'  id='txtSearchKey_" + i + "' style='height: 25px;width:100%' type='text'><\/div><\/DIV>"); a.find(".vis-FirstDivCotrol").append("<DIV class='vis-FirstDivCotrolChild'> <div class='vis-all-lable'>" + n.Msg.getMsg("Greeting") + "  <\/div> <div class='vis-all-control'><select id='ddlGreeting_" + i + "' style='width: 100%'>" + c + "<\/select><\/div><\/DIV>"); a.find(".vis-FirstDivCotrol").append("<DIV class='vis-FirstDivCotrolChild'> <div class='vis-all-lable'>" + n.Msg.getMsg("ContactName") + "  <\/div> <div class='vis-all-control'><input class='vis-gc-vpanel-table-mandatory' id='txtContact_" + i + "' style='height: 25px;width:100%' type='text'> <\/div><\/DIV>"); a.find(".vis-FirstDivCotrol").append("<DIV class='vis-FirstDivCotrolChild'> <div class='vis-all-lable'>" + n.Msg.getMsg("CompanyName") + "  <\/div> <div class='vis-all-control'><input class='vis-gc-vpanel-table-mandatory' id='txtName_" + i + "' style='height: 25px;width:100%' type='text'> <\/div><\/DIV>"); a.find(".vis-FirstDivCotrol").append("<DIV class='vis-FirstDivCotrolChild'> <div class='vis-all-lable'>" + n.Msg.getMsg("BusinessPartnerGroup") + "  <\/div> <div class='vis-all-control'><select class='vis-gc-vpanel-table-mandatory' id='ddlBPGroup_" + i + "' style='width: 100%;float:left'>" + l + "<\/select> <\/div><\/DIV>"); a.find(".vis-FirstDivImgCotrol").append("<DIV class='vis-FirstDivCotrolChild' >  <div style='float: left;width:100%;height:242px;line-height:236px;background: none repeat scroll 0% 0% #EEE;padding:0px;text-align:center;margin-top:20px' ><img id='imgBPartner_" + i + "' /><\/div> "); a.find(".vis-SecondDivCotrol").append("<DIV class='vis-SecondDivCotrolChild'> <div class='vis-all-lable'>" + n.Msg.getMsg("Phone") + "  <\/div> <div class='vis-all-control'><input id='txtPhone_" + i + "' style='height: 25px;width:100%' type='text'><\/div><\/DIV>"); a.find(".vis-SecondDivCotrol").append("<DIV class='vis-SecondDivCotrolChild'> <div class='vis-all-lable'>" + n.Msg.getMsg("Mobile") + "  <\/div> <div class='vis-all-control'><input id='txtMobile_" + i + "' style='height: 25px;width:100%' type='text'><\/div><\/DIV>"); a.find(".vis-SecondDivCotrol").append("<DIV class='vis-SecondDivCotrolChild'> <div class='vis-all-lable'>" + n.Msg.getMsg("Fax") + "  <\/div> <div class='vis-all-control'><input id='txtFax_" + i + "' style='height: 25px;width:100%;' type='text'> <\/div><\/DIV>"); a.find(".vis-SecondDivImgCotrol").append("<DIV class='vis-SecondDivCotrolChild' > <div class='vis-all-lable'>" + n.Msg.getMsg("EmailAddress") + "  <\/div> <div class='vis-all-control'><input id='txtEmail_" + i + "' style='height: 25px;width:100%' type='text'> <\/div><\/DIV>"); a.find(".vis-SecondDivImgCotrol").append("<DIV class='vis-SecondDivCotrolChild' > <div class='vis-all-lable'>" + n.Msg.getMsg("WebUrl") + "  <\/div> <div class='vis-all-control'><input id='txtWebUrl_" + i + "' style='height: 25px;width:100%' type='text'> <\/div><\/DIV>"); a.find(".vis-ThirdDivCotrol").append("<DIV class='vis-ThirdDivCotrolChild'> <div class='vis-all-lable'>" + n.Msg.getMsg("Address") + "  <\/div> <div id='divAddress_" + i + "' class='vis-all-control'><\/div><\/DIV>"); a.find(".vis-FourthDivControl").append("<DIV style='float: left;width:25%'> <div style='float: left;width:100%' class='wsp-BPartner'><input id='chkCustomer_" + i + "' type='checkbox'> " + n.Msg.getMsg("Customer") + "<\/div><\/DIV>"); a.find(".vis-FourthDivControl").append("<DIV style='float: left;width:25%'> <div style='float: left;width:100%' class='wsp-BPartner'><input id='chkVendor_" + i + "' type='checkbox'>  " + n.Msg.getMsg("Vendor") + " <\/div><\/DIV>"); a.find(".vis-FourthDivControl").append("<DIV style='float: left;width:25%'> <div style='float: left;width:100%' class='wsp-BPartner'><input id='chkProspect_" + i + "' type='checkbox'> " + n.Msg.getMsg("Prospect") + "<\/div><\/DIV>"); a.find(".vis-FourthDivControl").append("<DIV style='float: left;width:25%'> <div style='float: left;width:100%' class='wsp-BPartner'><input id='chkEmployee_" + i + "' type='checkbox'> " + n.Msg.getMsg("Employee") + "<\/div><\/DIV>"); v = a.find("#divAddress_" + i); e = a.find("#ddlBPRelation_" + i); o = a.find("#ddlBPLoaction_" + i); s = a.find("#ddlBPGroup_" + i); p = a.find("#txtName_" + i); w = a.find("#txtSearchKey_" + i); d = a.find("#ddlGreeting1_" + i); st = a.find("#txtName2_" + i); b = a.find("#txtContact_" + i); k = a.find("#ddlGreeting_" + i); nt = a.find("#txtTitle_" + i); tt = a.find("#txtEmail_" + i); g = a.find("#txtPhone_" + i); ht = a.find("#txtPhone2_" + i); it = a.find("#txtFax_" + i); ft = a.find("#chkCustomer_" + i); et = a.find("#chkVendor_" + i); vt = a.find("#chkProspect_" + i); ot = a.find("#chkEmployee_" + i); r.setValue(h.location); yt = a.find("#VISFileDialog_" + i); pt = a.find("#imgBPartner_" + i); wt = a.find("#txtMobile_" + i); bt = a.find("#txtWebUrl_" + i); ui(); u > 0 ? (e.val(h.bpRelationID), s.val(h.bpGroupID), o.val(h.bpLocationID), p.val(n.Utility.decodeText(h.name)), w.val(n.Utility.decodeText(h.searchKey)), d.val(), st.val(n.Utility.decodeText(h.name2)), pt.removeAttr("src").attr("src", h.userImage), b.val(n.Utility.decodeText(h.contact)), k.val(), nt.val(n.Utility.decodeText(h.title)), tt.val(n.Utility.decodeText(h.email)), g.val(n.Utility.decodeText(h.phoneNo)), ht.val(n.Utility.decodeText(h.phoneNo2)), it.val(n.Utility.decodeText(h.fax)), k.val(h.greeting), d.val(h.greeting1), r.setValue(h.location), wt.val(h.mobile), bt.val(h.WebUrl), h.isCustomer && ft.attr("checked", "checked"), h.isVendor && et.attr("checked", "checked"), h.isEmployee && ot.attr("checked", "checked"), dt(n.Utility.Util.getValueOfInt(e.val()), i, h.bpLocationID)) : lt > 0 && at > 0 && (a.find("#ddlBPRelation_" + i).val(lt), a.find("#ddlBPGroup_" + i).val(at), dt(n.Utility.Util.getValueOfInt(e.val()), i, h.bpLocationID)); r.getBtn(0).css("width", "10%"); r.getBtn(0).css("height", "30px"); r.getBtn(0).css("padding", "0px"); r.getBtn(1).css("width", "10%"); r.getBtn(1).css("height", "30px"); r.getBtn(1).css("padding", "0px"); v.append(r.getControl().css("width", "80%")).append(r.getBtn(0)).append(r.getBtn(1)); rt = a.find("#divAddress_" + i).find("Input"); ct = a.find("#divAddress_" + i).find("Button").eq(1); oi(i, f, u); e.on("change", function () { dt(n.Utility.Util.getValueOfInt(e.val()), i) }); w.on("focusout", function () { w.val() == "" ? t("#divSearchKey").css("visibility", "visible") : t("#divSearchKey").css("visibility", "collapse ") }); p.on("focusout", function () { p.val() == "" ? t("#divName").css("visibility", "visible") : t("#divName").css("visibility", "collapse") }); s.on("focusout", function () { s.val() == "0" || s.val() == "" ? t("#divBPGroup").css("visibility", "visible") : t("#divBPGroup").css("visibility", "collapse ") }); rt.on("focusout", function () { r.getValue() <= 0 ? t("#divAddressValidate_" + i).css("visibility", "visible") : t("#divAddressValidate_" + i).css("visibility", "collapse ") }); ct.on("focusout", function () { r.getValue() <= 0 ? t("#divAddressValidate_" + i).css("visibility", "visible") : t("#divAddressValidate_" + i).css("visibility", "collapse ") }); b.on("focusout", function () { b.val() == "" ? t("#divContact_" + i).css("visibility", "visible") : t("#divContact_" + i).css("visibility", "collapse") }); return a } function kt(n, t, i) { return "<DIV class='vis-BPsplitter' style='width:" + n + "'><span style='background-color: white; position: relative;top: -0.8em;margin-left: " + i + "px;'> " + t + " <\/span><\/DIV>" } function ui() { yt.on("change", function () { ni = Date.now().toString(); var t = new XMLHttpRequest, i = new FormData; i.append("file", yt[0].files[0]); i.append("fileKey", ni); t.open("POST", n.Application.contextUrl + "BPartner/SaveImageAsByte", !0); t.setRequestHeader("Cache-Control", "no-cache"); t.setRequestHeader("Pragma", "no-cache"); t.send(i); t.addEventListener("load", function (n) { var i = n.target.response, r = JSON.parse(i), t = JSON.parse(r); pt.removeAttr("src").attr("src", "data:image/jpg;base64," + t[0]); gt = t[1] }, !1) }) } function fi() { w.off("focusout"); p.off("focusout"); s.off("focusout"); rt.off("focusout"); ct.off("focusout"); b.off("focusout"); r.dispose(); r = null; p = null; st = null; rt = null; b = null; tt = null; it = null; k = null; d = null; g = null; ht = null; w = null; nt = null; c = null; f.remove(); f.empty() } function ei(i) { u = new n.ChildDialog; u.setContent(i); u.onClose = function () { fi() }; var r = t(window).width(); r >= 1366 ? (u.setHeight(620), u.setWidth(870)) : (u.setHeight(520), u.setWidth(670)); u.setTitle(n.Msg.getMsg("BusinessPartner")); u.setEnableResize(!1); u.setModal(!0); u.show(); u.getRoot().dialog({ position: [200, 130] }) } function oi(i, f, h) { u.onOkClick = function () { var l, a, u; if (y != null ? (y.show(), l = t(window).height() * (50 / 100), a = t(window).width() * (50 / 100)) : t(".vis-apanel-busy").css("visibility", "visible"), ut = r.getValue(), w.val().trim() == "") return n.ADialog.info("SearchKeyMandatory"), y != null && y.hide(), t(".vis-apanel-busy").css("visibility", "hidden"), !1; if (p.val().trim() == "") return n.ADialog.info("NameMandatory"), y != null && y.hide(), t(".vis-apanel-busy").css("visibility", "hidden"), !1; if (s.val().trim() == "0") return n.ADialog.info("BPGroupMandatory"), y != null && y.hide(), t(".vis-apanel-busy").css("visibility", "hidden"), !1; if (b.val().trim() == "") return n.ADialog.info("ContactMandatory"), y != null && y.hide(), t(".vis-apanel-busy").css("visibility", "hidden"), !1; if (ut <= 0 || ut == null) return n.ADialog.info("AddressMandatory"), y != null && y.hide(), t(".vis-apanel-busy").css("visibility", "hidden"), !1; if (ft.is(":checked") == !1 && et.is(":checked") == !1 && vt.is(":checked") == !1 && ot.is(":checked") == !1) return alert(n.Msg.getMsg("PleaseSelectBusinessType")), y != null && y.hide(), t(".vis-apanel-busy").css("visibility", "hidden"), !1; u = null; u = f; url = n.Application.contextUrl + "BPartner/AddBPartnerInfo"; var v = w.val(), rt = p.val(), st = p.val(), c = k.val(), ht = s.val(), ct = e.val(), lt = o.val(), at = b.val(), oi = d.val(), yt = nt.val(), pt = tt.val(), kt = g.val(), dt = g.val(), ni = it.val(), ti = ft.is(":checked"), ii = et.is(":checked"), ri = vt.is(":checked"), ui = ot.is(":checked"), fi = wt.val(), ei = bt.val(); window.setTimeout(function () { t.ajax({ type: "Post", async: !1, url: url, dataType: "json", data: { C_BPartner_ID: h, searchKey: v, name: rt, name2: st, greeting: c, bpGroup: ht, bpRelation: ct, bpLocation: lt, contact: at, greeting1: c, title: yt, email: pt, address: ut, phoneNo: kt, phoneNo2: dt, fax: ni, windowNo: i, BPtype: u, isCustomer: ti, isVendor: ii, isProspect: ri, fileName: gt, mobile: fi, webUrl: ei, isEmployee: ui }, success: function (i) { n.ADialog.info("", "", JSON.parse(i)); y != null && y.hide(); t(".vis-apanel-busy").css("visibility", "hidden") } }) }, 2) } } function dt(i, r, u) { var f = null, e = ""; url = n.Application.contextUrl + "BPartner/GetBPLocation?WinNo=" + r + "&bpartnerID=" + i; t.ajax({ type: "GET", async: !1, url: url, dataType: "json", success: function (t) { f = JSON.parse(t); for (var i = 0; i < f.lstBPLocation.length; i++)e += "<option value='" + f.lstBPLocation[i].ID + "'>" + n.Utility.encodeText(f.lstBPLocation[i].Name) + "<\/option>"; o.empty(); o.append(e); o.val(u) } }) } var p = null, w = null, k = null, st = null, b = null, d = null, nt = null, tt = null, g = null, ht = null, it = null, nt = null, rt = null, ct = null, y = null, lt = 0, at = 0, ut = null, ft = null, et = null, vt = null, ot = null, yt = null, gt = null, ni = "", pt = null, wt = null, bt = null; l == null && (t(".vis-apanel-busy").css("visibility", "visible"), t(".vis-apanel-busy").css("z-index", "9999999")); y = l; f != null && f.empty(); lt = a; at = v; ti(i, h, c) } }(VIS, jQuery), function (n, t) { function v() { r = null; f = null; o = null; $mainUserInfo = null; a = 800; c = 1048576; l = 10; r = t(" <div id='mainUserInfoDiv_" + i + "'><div class='vis-view_left_part'><input type='hidden' value='0' id='userID_" + i + "'><\/input> <p id='hduserName_" + i + "' style='display: none;'><\/p>  <p id='userName_" + i + "' class='vis-view_profile_name'><\/p> <a id='dotImg_" + i + "' href='javascript:void(0)' style='display: none;'><\/a><div id='popUpDiv_" + i + "' style='display: none;'><\/div><input type='hidden' value='0' id='BPID_" + i + "'><\/input><input type='hidden' value='0' id='BPGroupID_" + i + "'><\/input><input type='hidden' value='' id='userTableID_" + i + "'><p id='companyName_" + i + "' class='vis-view_profile_possession'><\/p><p class='vis-view_profile_possession' style='border-bottom: 1px solid rgba(var(--v-c-secondary), 1); padding-bottom: 10px;' id='pContactTypeCategory_" + i + "'><\/p><div class='vis-profile_big_img_mobile'><span id='editMobileImage_" + i + "' class='mobilespan' style='width:24px;float:right;'><input type='file' id='vis-fileinput_" + i + "' class='vis-file-input' value='Add Pic' style='opacity: 0; width: 7%; margin-top: -6px; float: left; z-index: 999; position: absolute; cursor: pointer;'><img src='" + n.Application.contextUrl + "Areas/WSP/Images/Edit-icon.png' style='z-index: 100; position: absolute;'><\/span><img id='mobileImg_" + i + "' width='100%' alt='Image is not available' src='Areas/VIS/Images/home/User.png'><\/div><div id='divTeam_" + i + "' class='vis-view_team'><\/div><div id='divContactDetails_" + i + "' class='vis-view_team'><\/div><div id='divcompanyDetails_" + i + "' class='vis-view_team'><\/div><div id='divRole_" + i + "' class='vis-view_team'><\/div><\/div><div class='vis-view_right_part'  style='float:left;width: 55%;' id='WSP_view_right_part_" + i + "'><div id='userBigImg_" + i + "' class='vis-profile_big_img' style='width: 322px;'><div class='vis-image-upload'> <label for='file-input' class='vis-fileupload-label'><i class='vis vis-pencil'><\/i><\/label><input type='file' id='vis-file-input_" + i + "' class='vis-file-input' value='Add Pic' style='opacity: 0; width: 30%; margin-top: 0px; float: right; z-index: 999; position: absolute; right: 0px; cursor: pointer;'><\/div><div class='vis-bigimg'> <i id='bigUserImage_" + i + "' class='vis vis-user'><\/i><\/div><\/div><div class='vis-actionswrp'><table id='actionTable_" + i + "' class='vis-tableRightContent'><tbody><tr style='height:30px'> <td class='vis-tdactionlist'><a id='edit_" + i + "' class='vis-tableaction' href='javascript:void(0)'><span class='vis-left_icon'> <i class='vis vis-edit'><\/i><\/span> <p>Edit <\/p> <\/a> <\/td> <td class='vis-tdactionlist'> <a id='sendSMS_" + i + "' class='vis-tableaction' href='javascript:void(0)'><span class='vis-left_icon'> <i class='vis vis-sms'><\/i><\/span> <p> Send Sms <\/p> <\/a> <\/td> <\/tr>  <tr style='height:30px'>       <td class='vis-tdactionlist'><a id='email_" + i + "' class='vis-tableaction' href='javascript:void(0)'><span class='vis-left_icon email_icon'>           <i class='vis vis-email'><\/i><\/span>           <p>Email <\/p>       <\/a>       <\/td>       <td class='vis-tdactionlist'><a id='appointment_" + i + "' class='vis-tableaction' href='javascript:void(0)'><span class='vis-left_icon'>           <i class='vis vis-appointment'><\/i><\/span>           <p>Appointment <\/p>       <\/a>       <\/td>   <\/tr>   <tr style='height:30px'>       <td class='vis-tdactionlist'><a id='activity_" + i + "' class='vis-tableaction' href='javascript:void(0)'><span class='vis-left_icon'>            <i class='vis vis-cog'><\/i><\/span>           <p>Activity<\/p>       <\/a>       <\/td>        <td class='vis-tdactionlist'><a id='createOrder_" + i + "' href='javascript:void(0)' class='vis-tableaction'><span class='vis-left_icon'>           <i class='vis vis-createdocument'><\/i><\/span>           <p>Create Order<\/p>       <\/a>        <\/td>    <\/tr>   <tr style='height:30px'>       <td class='vis-tdactionlist'><a id='BPInfo_" + i + "' class='vis-tableaction' href='javascript:void(0)'><span class='vis-left_icon'>           <i class='vis vis-info'><\/i><\/span>           <p>BP Info<\/p>       <\/a>        <\/td>        <td class='vis-tdactionlist'><a id='addBPartner_" + i + "' href='javascript:void(0)' class='vis-tableaction'><span class='vis-left_icon'>           <i class='vis vis-addbp'><\/i><\/span>           <p style=''>Add BPartner <\/p>       <\/a>       <\/td>   <\/tr> <tr style='height:30px'><td class='vis-tdactionlist'><a id='History_" + i + "' class='vis-tableaction' href='javascript:void(0)'><span class='vis-left_icon'><i class='vis vis-history'><\/i><\/span><p>" + n.Msg.getMsg("History") + "<\/p><\/a><\/td><\/tr>   <tr>   <\/tr><\/tbody><\/table><\/div><div id='divBirthday_" + i + "' class='vis-birthday_container' style='display: none;'><\/div><\/div><\/div>") } var i = 0, s = t(document).width(), y = t(document).height(), r = null, h = 0, e = null, f = null, o = null, a = null, c = null, l = null, u = null, s = t(document).width(), y = t(document).height(); n.ContactInfo = function (y, p) { if (n.Application.isBasicDB) { n.ADialog.error("VIS_NotSupported"); self.dispose(); return } h = y; i = p; t(".vis-apanel-busy").css("visibility", "visible"); e = n.Application.contextUrl + "WSP/Contacts/UserContactInfo?WinNo=" + i + "&userID=" + h + "&isPartialViewLoad=true"; v(h, e); this.show = function () { if (!window.WSP) { alert("please download WSP !!!"); t(".vis-apanel-busy").css("visibility", "hidden"); return } window.setTimeout(function () { u = new n.ChildDialog; u.setContent(r); u.setWidth(610); u.setTitle(n.Msg.getMsg("ContactInfo")); u.setEnableResize(!1); u.setModal(!0); u.show(); u.getRoot().dialog({ position: [400, 0] }); u.onClose = function () { dispose() }; t.ajax({ type: "GET", async: !1, url: e, dataType: "json", success: function (h) { function ri(i, r, f) { f.stopPropagation(); t.ajax({ type: "GET", async: !1, url: i, dataType: "json", success: function (t) { var i = JSON.parse(t), f = new n.Query; r ? (f.addRestriction("C_BPartner_ID", n.Query.prototype.EQUAL, i[1]), n.viewManager.startWindow(i[0], f), k.find("p").removeAttr("style"), u.close()) : (f.addRestriction("C_Order_ID", n.Query.prototype.EQUAL, i[1]), win = n.viewManager.startWindow(i[0], f), win.onLoad = function () { var n = win.cPanel.curGC; n.onRowInserting = function () { win.cPanel.cmd_new(!1) }; n.onRowInserted = function () { tab = win.cPanel.curTab; tab.setValue("C_BPartner_ID", et.text()) } }, st.find("p").removeAttr("style"), u.close()) } }) } var v = JSON.parse(h), p = "", y, wt, nt, d; v[0].Customer != "" && (p += v[0].Customer); v[0].Vendor != "" && (v[0].Customer != "" && (p += ","), p += v[0].Vendor); v[0].Employee != "" && ((v[0].Customer != "" || v[0].Vendor != "") && (p += ","), p += v[0].Employee); v[0].Prospect != "" && ((v[0].Customer != "" || v[0].Vendor != "" || v[0].Employee != "") && (p += ","), p += v[0].Prospect); var ht = r.find("#divRole_" + i), ct = r.find("#divTeam_" + i), b = r.find("#divContactDetails_" + i), it = r.find("#dotImg_" + i), w = r.find("#userID_" + i), lt = r.find("#userTableID_" + i), rt = r.find("#hduserName_" + i), ft = r.find("#userName_" + i), et = r.find("#BPID_" + i), bt = r.find("#BPGroupID_" + i), ui = r.find("#companyName_" + i), fi = r.find("#pContactTypeCategory_" + i), ai = r.find("#mobileImg_" + i), ur = r.find("#team_" + i), fr = r.find("#teamNotFound_" + i), vi = r.find("#address_" + i), yi = r.find("#country_" + i), pi = r.find("#postal_" + i), wi = r.find("#phone_" + i), bi = r.find("#userEmail_" + i), er = r.find("#emailNotFound_" + i), kt = r.find("#divcompanyDetails_" + i), ei = r.find("#companyNotFound" + i), or = r.find("#role_" + i), ki = r.find("#roleNotFound_" + i), at = r.find("#bigUserImage_" + i), ot = r.find("#divBirthday_" + i), sr = r.find("#userBigImg_" + i), k = r.find("#edit_" + i); o = r.find("#WSP_dots_" + i); var dt = r.find("#sendSMS_" + i), gt = r.find("#email_" + i), g = r.find("#BPInfo_" + i), st = r.find("#createOrder_" + i), vt = r.find("#addBPartner_" + i), di = r.find("#History_" + i), yt = r.find("#appointment_" + i), pt = r.find("#activity_" + i), gi = r.find("#ImportContacts_" + i), tt = r.find("#wsp-file-input_" + i), oi = r.find("#wsp-fileinput_" + i), hr = r.find(".WSP_profile_big_img"), nr = r.find(".WSP_profile_big_img_mobile"), si = null, tr = r.find("#mainUserInfoDiv_" + i), ni = !1, ut = !1, ti = !1, v = JSON.parse(h), hi = "", ii = ""; for (w.empty(), w.append(v[0].UserID), rt.empty(), rt.append(v[0].FirstName), rt.hide(), ft.empty(), it.empty(), p == "" || p == null ? (k.removeAttr("href"), k.css("cursor", "auto"), k.find("p").css("color", "black"), g.removeAttr("href"), g.css("cursor", "auto"), g.find("p").css("color", "black")) : (k.attr("href", "javascript:void(0)"), k.css("cursor", "pointer"), k.removeAttr("style"), g.attr("href", "javascript:void(0)"), g.css("cursor", "pointer"), g.removeAttr("style")), s >= 1e3 && s <= 1024 ? v[0].FirstName.length > 15 ? (it.show(), ft.append(v[0].FirstName.substring(0, 15)).append(it.append("..."))) : ft.append(v[0].FirstName) : v[0].FirstName.length > 20 ? (it.show(), ft.append(v[0].FirstName.substring(0, 20)).append(it.append("..."))) : ft.append(v[0].FirstName), et.empty(), et.append(v[0].BPartnerID), lt.append(v[0].TableID), bt.empty(), bt.append(v[0].BPGroupID), ui.empty(), ui.append(v[0].CompanyName), fi.empty(), fi.append(p), ai.removeAttr("src").attr("src", v[0].Image), ct.empty(), ct.append("<p>" + n.Msg.getMsg("Teams") + "<\/p>"), y = 0; y < v.length; y++)v[y].Team != "" && v[y].Team != null && (ni = !0, ii += y == 0 || ii == "" ? v[y].Team : ", " + v[y].Team); for (ni || ct.append(" <p  id='teamNotFound_" + i + "' style='word-break: break-all; font-style: italic;'>" + n.Msg.getMsg("NotFound") + "<\/p>"), ni && ct.append(" <p id='team_" + i + "' >" + ii + "<\/p>"), vi.empty(), b.empty(), b.append("<p style='word-break: break-all;'> " + n.Msg.getMsg("ContactDetails") + " <a href='javascript:void(0)'> <i id='showAddressOnGoogleMap_" + i + "' class='vis vis-location'><\/i> <\/a><\/p> "), y = 0; y < v.length; y++)v[y].FirstName == "" && v[y].Address != "" && v[y].Address != null && (ut = !0, b.append("<p id='address_" + i + "' style='word-break: break-all'>" + v[y].Address + "<\/p>")); for (yi.empty(), v[0].CountryName != "" && v[0].CountryName != null && (ut = !0, b.append("<p id='country_" + i + "' style='word-break: break-all'>" + v[0].City + "(" + v[0].CountryName + ")<\/p> ")), pi.empty(), v[0].Postal != "" && v[0].Postal != null && (ut = !0, b.append("<p id='postal_" + i + "' style='word-break: break-all'>" + n.Msg.getMsg("ZipCode") + ": " + v[0].Postal + "<\/p>")), wi.empty(), y = 0; y < v.length; y++)v[y].FirstName == "" && v[y].PhoneNo != "" && v[y].PhoneNo != null && (ut = !0, s <= 1024 ? b.append("<a href='tel:" + v[y].PhoneNo + "'><p id='phone_" + i + "' style='word-break: break-all'><span class='vis-caller'><i class='fa fa-phone'><\/i><\/span>" + v[y].PhoneNo + "<\/p><\/a>") : b.append("<p id='phone_" + i + "' style='word-break: break-all'><span class='vis-caller'><i class='fa fa-phone'><\/i><\/span>" + v[y].PhoneNo + "<\/p>")); for (bi.empty(), v[0].Email != "" && v[0].Email != null && (ut = !0, b.append("<p id='userEmail_" + i + "' style='word-break: break-all;display: inline-flex;margin-top: 0;'> <span class='vis-caller'><i class='vis vis-email'><\/i><\/span>" + v[0].Email + "<\/p>")), !ut, kt.empty(), kt.append("<p>" + n.Msg.getMsg("Company") + "<\/p>"), kt.append("<p id='companyDetails_" + i + "' style='word-break: break-all'>" + v[0].CompanyName + "<\/p>"), ei.empty(), v[0].CompanyName != "" && v[0].CompanyName != null && ei.append(n.Msg.getMsg("NotFound")), ht.empty(), ht.append("<p>" + n.Msg.getMsg("RoleAssign") + "<\/p>"), y = 0; y < v.length; y++)v[y].Role != "" && v[y].Role != null && (ti = !0, hi += y == 0 ? v[y].Role : ", " + v[y].Role); ti && ht.append("<p id='role_" + i + "'>" + hi + "<\/p>"); ki.empty(); ti || ht.append("<p id='roleNotFound_" + i + "' style='word-break: break-all; font-style: italic;'>" + n.Msg.getMsg("NotFound") + "<\/p>"); v[0].Image.indexOf("User") > 0 ? at.removeAttr("src").attr("src", n.Application.contextUrl + "Areas/VIS/Images/home/User.png") : at.removeAttr("src").attr("src", v[0].Image); ot.empty(); var ci = new Date, li = new Date(v[0].Birthday), ir = ci.getMonth() + 1 + "/" + ci.getDate(), rr = li.getMonth() + 1 + "/" + li.getDate(); v[0].Birthday != "" ? (ot.show(), ot.css("border", "1px solid #1886BF"), wt = t("<div class='vis-birthdat_text'>"), rr == ir && wt.append("<p> " + n.Msg.getMsg("Today") + " " + n.Msg.getMsg("is") + " <span class='vis-birthday_text_highlight'>" + v[0].FirstName + "<\/span> " + n.Msg.getMsg("Birthday") + "<\/p>"), wt.append("<p>" + v[0].FirstName + " " + n.Msg.getMsg("Birthday") + " " + n.Msg.getMsg("on") + "  <span class='vis-birthday_text_highlight'>" + v[0].Birthday + "<\/span><\/p> <\/div>"), ot.append(wt)) : ot.hide(); it.on("click", function (n) { $popUp.show(); var t = r.find("<div class='arrow_box'> <p style='margin-left:5px;margin-top:5px;margin-right:5px'>" + rt.text() + "<\/p><\/div>"); $popUp.append(t); $popUp.delay(2e3).fadeOut(); n.stopPropagation() }); if (o != null) o.on("click", function (n) { tr.animate({ right: "-1000px" }, a); n.stopPropagation() }); t(".ui-dialog-content").on("click", function (n) { t("#w2ui-overlay").hide(); n.stopPropagation() }); nt = t("<ul id='ulEditOption' class='vis-apanel-rb-ul'>"); d = t("<ul id='ulCreateOrder' class='vis-apanel-rb-ul'>"); k.on("click", function (r) { var u, h, e; if (p == "" || p == null) return r.preventDefault(), !1; k.find("p").css("background-color", "#e0e0e0"); r.stopPropagation(); var o = w.text(), s = p.split(","); if (s.length > 1) { for (t("#w2ui-overlay").show(), nt != null && nt.empty(), u = t("<div/>"), u.css("width", "auto"), u.css("height", "100%"), nt.css("width", "auto"), nt.css("height", "100%"), h = "", e = 0; e < s.length; e++)h += "<li style='margin-top:15px;margin-left:10px;margin-right:13px;font-size: 15px' id='" + s[e].trim() + "_" + i + "'>" + n.Msg.getMsg(s[e].trim()) + "<\/li>"; nt.append(h); u.append(nt); k.w2overlay(u.clone(!0), { css: { height: "300px" } }); u.css("top", "395px"); nt.load() } else p == n.Msg.getMsg("Employee") && (f = n.Application.contextUrl + "WSP/Contacts/GetWindowID?windowName=Employee Master&userID=" + o), p == n.Msg.getMsg("Customer") && (f = n.Application.contextUrl + "WSP/Contacts/GetWindowID?windowName=Customer Master&userID=" + o), p == n.Msg.getMsg("Vendor") && (f = n.Application.contextUrl + "WSP/Contacts/GetWindowID?windowName=Vendor Master&userID=" + o), p == n.Msg.getMsg("Prospect") && (f = n.Application.contextUrl + "WSP/Contacts/GetWindowID?windowName=Prospects&userID=" + o), ri(f, !0, r) }); nt.on("click", "LI", function (i) { t("#w2ui-overlay").hide(); var r = t(this).text(); r == n.Msg.getMsg("Employee") && (f = n.Application.contextUrl + "WSP/Contacts/GetWindowID?windowName=Employee Master&userID=" + w.text()); r == n.Msg.getMsg("Customer") && (f = n.Application.contextUrl + "WSP/Contacts/GetWindowID?windowName=Customer Master&userID=" + w.text()); r == n.Msg.getMsg("Vendor") && (f = n.Application.contextUrl + "WSP/Contacts/GetWindowID?windowName=Vendor Master&userID=" + w.text()); r == n.Msg.getMsg("Prospect") && (f = n.Application.contextUrl + "WSP/Contacts/GetWindowID?windowName=Prospects&userID=" + w.text()); ri(f, !0, i); i.stopPropagation() }); dt.on("click", function (i) { dt.find("p").css("background-color", "#e0e0e0"); t(".vis-apanel-busy").css("visibility", "visible"); t(".vis-apanel-busy").css("z-index", "999999999999"); i.stopPropagation(); window.setTimeout(function () { var r = new n.Sms(null, null, 0, !0), i = new n.CFrame; i.setName(n.Msg.getMsg("Sms")); i.setTitle(n.Msg.getMsg("Sms")); i.hideHeader(!0); i.setContent(r); i.show(); r.initializeComponent(); t(".vis-apanel-busy").css("visibility", "hidden"); u.close() }, 2) }); gt.on("click", function (r) { gt.find("p").css("background-color", "#e0e0e0"); t(".vis-apanel-busy").css("visibility", "visible"); t(".vis-apanel-busy").css("z-index", "999999999999"); r.stopPropagation(); window.setTimeout(function () { var f = new n.Email(t("#userEmail_" + i).text(), null, null, w.text(), !0, !0, lt.text()), r = new n.CFrame; r.setName(n.Msg.getMsg("EMail")); r.setTitle(n.Msg.getMsg("EMail")); r.hideHeader(!0); r.setContent(f); r.show(); f.initializeComponent(); t(".vis-apanel-busy").css("visibility", "hidden"); u.close() }, 2) }); g.on("click", function (i) { if (p == "" || p == null) return i.preventDefault(), !1; g.find("p").css("background-color", "#e0e0e0"); window.setTimeout(function () { var r = w.text(), i = ""; i = n.Application.contextUrl + "WSP/Contacts/GetWindowID?windowName=Business Partner Info&userID=" + r; t.ajax({ type: "GET", async: !1, url: i, dataType: "json", success: function (t) { var i = JSON.parse(t), r = new n.Query; r.addRestriction("C_BPartner_ID", n.Query.prototype.EQUAL, i[1]); n.viewManager.startWindow(i[0], r); g.find("p").removeAttr("style"); u.close() } }) }, 500) }); st.on("click", function (r) { var u, f; st.find("p").css("background-color", "#e0e0e0"); t("#w2ui-overlay").show(); t("#w2ui-overlay").find("div").empty(); d != null && d.empty(); u = t("<div/>"); u.css("width", "auto"); u.css("height", "100%"); d.css("width", "auto"); d.css("height", "100%"); f = t("<li style='margin-top:15px;margin-left:10px;margin-right:13px;font-size: 15px' id='SaleOrder_" + i + "'>" + n.Msg.getMsg("Sales Order") + "<\/li> <li  style='margin-top:10px;margin-left:10px;margin-right:13px;font-size: 15px' id='PurchaseOrder_" + i + "' >" + n.Msg.getMsg("PurchaseOrder") + "<\/li>"); d.append(f); u.append(d); st.w2overlay(u.clone(!0), { css: { height: "300px" } }); u.css("top", "395px"); r.stopPropagation(); d.load() }); d.on("click", "LI", function (i) { t("#w2ui-overlay").hide(); var r = t(this).text(); e = n.Application.contextUrl + "WSP/Contacts/GetWindowAndOrderID?windowName=" + r + "&userID=" + w.text(); ri(e, !1, i); i.stopPropagation() }); vt.on("click", function (t) { vt.find("p").css("background-color", "#e0e0e0"); t.stopPropagation(); $saleOrder = null; $purchaseOrder = null; n.AddUpdateBPartner(i, 0, p, null, et.text(), bt.text()); vt.find("p").removeAttr("style") }); di.on("click", function () { var t = new n.AttachmentHistory(lt.text(), w.text(), et.text(), 0, "AD_User_ID"); t.show() }); yt.on("click", function (r) { r.stopPropagation(); yt.find("p").css("background-color", "#e0e0e0"); t(".vis-apanel-busy").css("visibility", "visible"); t(".vis-apanel-busy").css("z-index", "999999999999"); window.setTimeout(function () { n.AppointmentsForm.init(lt.text(), t("#userID_" + i).text(), n.context.getAD_User_ID(), rt.text(), !1); yt.find("p").removeAttr("style"); t(".vis-apanel-busy").css("visibility", "hidden"); u.close() }, 500) }); gi.on("click", function (n) { n.stopPropagation(); t(".vis-apanel-busy").css("visibility", "visible"); t(".vis-apanel-busy").css("z-index", "999999999999"); window.setTimeout(function () { WSP.importcontacts(self); t(".vis-apanel-busy").css("visibility", "hidden") }, 50) }); pt.on("click", function (r) { r.stopPropagation(); pt.find("p").css("background-color", "#e0e0e0"); t(".vis-apanel-busy").css("visibility", "visible"); t(".vis-apanel-busy").css("z-index", "999999999999"); window.setTimeout(function () { n.AppointmentsForm.init(0, t("#userID_" + i).text(), n.context.getAD_User_ID(), rt.text(), !0); pt.find("p").removeAttr("style"); t(".vis-apanel-busy").css("visibility", "hidden") }, 500) }); tt.on("change", function () { t(".vis-apanel-busy").css("visibility", "visible"); t(".vis-apanel-busy").css("z-index", "999999999999"); var f = w.text(), i = new XMLHttpRequest, r = new FormData, u = tt; if (r.append("file", u[0].files[0]), r.append("userID", f), u[0].files[0].size / c > l) { alert(n.Msg.getMsg("UploadedFileSizeLimit")); tt.replaceWith(tt.val("").clone(!0)); return } i.open("POST", n.Application.contextUrl + "WSP/Contacts/SaveImageAsByte", !0); i.setRequestHeader("Cache-Control", "no-cache"); i.setRequestHeader("Pragma", "no-cache"); i.send(r); i.addEventListener("load", function (n) { var i = n.target.response, r = JSON.parse(i); image = JSON.parse(r); at.removeAttr("src").attr("src", "data:image/jpg;base64," + image[1]); t(".vis-apanel-busy").css("visibility", "hidden") }, !1); tt.val("") }); oi.on("change", function () { t(".vis-apanel-busy").css("visibility", "visible"); t(".vis-apanel-busy").css("z-index", "999999999999"); var f = w.text(), i = new XMLHttpRequest, r = new FormData, u = tt; if (r.append("file", u[0].files[0]), r.append("userID", f), u[0].files[0].size / c > l) { alert(n.Msg.getMsg("UploadedFileSizeLimit")); return } i.open("POST", n.Application.contextUrl + "WSP/Contacts/SaveImageAsByte", !0); i.setRequestHeader("Cache-Control", "no-cache"); i.setRequestHeader("Pragma", "no-cache"); i.send(r); i.addEventListener("load", function (n) { var i = n.target.response, r = JSON.parse(i); image = JSON.parse(r); at.removeAttr("src").attr("src", "data:image/jpg;base64," + image[1]); nr.removeAttr("src").attr("src", "data:image/jpg;base64," + image[1]); t(".vis-apanel-busy").css("visibility", "hidden") }, !1) }); si = b.find("#showAddressOnGoogleMap_" + i); si.on("click", function () { var n = b.find("#address_" + i).text() + b.find("#country_" + i).text(), t = "http://local.google.com/maps?q=" + n; window.open(t) }); t(".vis-apanel-busy").css("visibility", "hidden") } }) }, 2) } } }(VIS, jQuery), function (n, t) { function i() { function b() { h = t('<div style="width:100%;height:100%">'); u = t("<ul class='vis-apanel-rb-ul' style='width:100%;height:100%'>"); e = t("<li data-isfav='no' data-id='favaction'>").append(n.Msg.getMsg("AddFav")); o = t("<li data-isfav='yes' data-id='favaction'>").append(n.Msg.getMsg("RemoveFav")); l = t("<li data-isfav='" + i.data("isfav") + "' data-id='favaction'>").append(n.Msg.getMsg("OpenNewTab")); u.append(e); u.append(o); u.append(l); h.append(u); d() } function k(n) { i = n; f = i.data("value"); a = i.data("action"); s = i.data("actionid"); y = i.data("name"); v = i.attr("data-isfav"); p || (b(), p = !0); v == "yes" ? (e.css("display", "none"), o.css("display", "block")) : (e.css("display", "block"), o.css("display", "none")); i.w2overlay(h.clone(!0), { css: { height: "300px" } }) } function d() { e.on("click", w); o.on("click", w); l.on("click", g) } function w() { var u; v == "yes" ? (i.find("span").remove(), u = t("#vis_divTree").find('[data-value="' + i.data("value") + '"]'), u && u.length > 0 && (t(u[1]).find("span.fa.fa-star").length > 0 && (t(u[1]).attr("data-isfav", "no"), t(u[1]).find("span.fa.fa-star").remove()), n.Application.isMobile || n.Application.isIOS ? t(u[5]) && (t(u[5]).attr("data-isfav", "no"), t(u[5]).find("span.fa.fa-star").remove()) : t(u[3]) && (t(u[3]).attr("data-isfav", "no"), t(u[3]).find("span.fa.fa-star").remove())), i.attr("data-isfav", "no"), tt(f), n.favMgr.removeFavourite(f)) : (r = {}, r.Action = a, r.WindowID = s, r.FormID = s, r.ProcessID = s, r.NodeID = f, r.Name = y, i.attr("data-isfav", "yes"), i.prepend('<span class="fa fa-star"><\/span>'), u = t("#vis_divTree").find('[data-value="' + i.data("value") + '"]'), u && u.length > 2 && (t(u[1]).find("span.fa.fa-star").length == 0 ? (t(u[1]).prepend('<span class="fa fa-star"><\/span>'), t(u[1]).attr("data-isfav", "yes")) : n.Application.isMobile || n.Application.isIOS ? (t(u[5]).prepend('<span class="fa fa-star"><\/span>'), t(u[5]).attr("data-isfav", "yes")) : (t(u[3]).prepend('<span class="fa fa-star"><\/span>'), t(u[3]).attr("data-isfav", "yes"))), nt(f), n.favMgr.addFavourite(r)) } function g() { n.viewManager.startActionInNewTab(a, s) } function nt(i) { t.ajax({ url: n.Application.contextUrl + "Home/SetNodeFavourite/?nodeID=" + i, dataType: "json" }) } function tt(i) { t.ajax({ url: n.Application.contextUrl + "Home/RemoveNodeFavourite/?nodeID=" + i, dataType: "json" }) } function it(n) { c || (c = t("#vis_divTree")); var r = c.children(0).find("[data-value='" + n + "']"), i = t(r.children()[1]); i.removeClass("vis-favitmchecked"); i.addClass("vis-favitmunchecked"); i.data("isfav", "no") } var h = null, u = null, f = null, i = null, r = null, c = null, e = null, o = null, l = null, a, s, y, v, p = !1; return { removeFavourite: it, showOverlay: k } } n.FavouriteHelper = i() }(VIS, jQuery), function (n, t) { function i(i, r, u, f, e, o, s, h, c, l) { function gf() { d = o; d ? s != null && s != undefined && (yi = s) : (yi = r.gridTable.AD_Table_ID, v = u.getSelectedRows(), b = r.getRecords()[r.getCurrentRow()]); ot = t('<ul class="vis-email-ul" ><\/ul>'); ft = t("<div>"); ft.css("position", "absolute"); ft.css("bottom", "0"); ft.css("background", "url('" + n.Application.contextUrl + "Areas/VIS/Images/LoadingCircle.gif') no-repeat"); ft.css("background-position", "center center"); ft.css("width", "98%"); ft.css("height", "98%"); ft.css("text-align", "center"); ft.css("opacity", ".1"); ft[0].style.visibility = "hidden" } function ne() { e ? (gt = t('<i class="vis-email-sendbtn vis vis-paper-plane"  title="' + n.Msg.getMsg("SendMail").replace("&", "") + '"><\/i>'), ui.append(gt)) : (gt = t('<i class="vis-email-saveAttachbtn vis vis-save-attach"  title="' + n.Msg.getMsg("SaveAttachment").replace("&", "") + '" ><\/i>'), ui.append(gt)); d || (wi = t('<i class="vis-email-btns vis vis-viewdocument"  title="' + n.Msg.getMsg("Preview").replace("&", "") + '" ><\/i>'), ui.append(wi), ki = t('<i class="vis-email-btns vis vis-save-as" title="' + n.Msg.getMsg("SaveAs").replace("&", "") + '" ><\/i>'), ui.append(ki), lt = t('<i class="vis-email-btns vis vis-save" title="' + n.Msg.getMsg("Save").replace("&", "") + '"><\/i>'), ui.append(lt), bi = t('<i class="vis-email-btns vis vis-open-file" title="' + n.Msg.getMsg("Open").replace("&", "") + '" ><\/i>'), ui.append(bi)); e || (su = t('<i class="vis-email-btns vis vis-save-pdf" title="' + n.Msg.getMsg("SavePdf").replace("&", "") + '"><\/i>'), hu = t('<i class="vis-email-btns vis vis-new" title="' + n.Msg.getMsg("NewLetter").replace("&", "") + '" ><\/i>'), ui.append(su).append(hu)) } function te() { var i = { windowNo: p.windowNo, language: n.Env.getAD_Language(n.Env.getCtx()) }; t.ajax({ type: "Get", async: !1, url: n.Application.contextUrl + "Email/Init", data: i, success: function (n) { ie(n) } }) } function ie(n) { var r, u; a.append(t(n)); r = 0; ct = a.find("#" + p.windowNo + "_dyndis"); ht = a.find("#" + p.windowNo + "_dynPF"); ii = a.find("#" + p.windowNo + "_dynPFType"); a.find(".vis-email-attachmentContainer").hide(); g = a.find(".vis-email-leftDiv"); nr = a.find(".vis-Email-BccList"); nt = a.find("#" + p.windowNo + "_emailSubject"); lr = a.find(".vis-DMSAttachDocList"); ur = a.find(".vis-dmsdocumentheader"); window.VADMS || (lr.css("display", "none"), ur.css("display", "none")); c != undefined && c != null && nt.val(c); vr = a.find("#" + p.windowNo + "_vis-email-attacImg"); pi = a.find("#" + p.windowNo + "_vis-Email-textarea"); yr = a.find(".vis-Email-leftFooter"); a.find(".contentArea").css("height", a.height() - 44); a.find(".vis-Email-textarea-div").css({ "margin-top": "10px" }); u = /ipad|iphone|ipod/i.test(navigator.userAgent.toLowerCase()); u == !0 && a.find(".vis-Email-textarea-div").css({ overflow: "auto" }); a.find(".vis-email-leftDiv").height(a.find(".contentArea").height()); d ? (a.find(".vis-form-data-sub").css("margin-top", "0px"), a.find(".vis-email-leftDiv").hide(), a.find(".vis-Email-rytWrap").hide(), st = a.find("#" + p.windowNo + "_emailToTop"), k = a.find("#" + p.windowNo + "_emailBccTop"), ut = a.find("#" + p.windowNo + "_eamilCcTop"), fr != undefined && fr != null && fr != "" ? ut.val(fr) : ut.hide(), er != undefined && er != null && er != "" ? k.val(er) : k.hide(), a.find(".vis-Email-textarea-div").height(a.height() - 180), a.find(".vis-Email-leftWrap").css("width", "100%"), a.find(".vis-Email-leftFooter").hide(), r = a.width() - 40, ct.prop("checked", !1), a.find(".vis-Email-topinputWrap").css("overflow", "auto"), ct.hide(), ht.prop("checked", !1), ht.parent().hide(), ii.prop("checked", !1), ii.parent().hide(), i != undefined && i != null && st.val(i), a.find(".vis-form-data-sub").width(a.width() - 85)) : e ? (a.find(".vis-Email-topinputWrap").hide(), st = a.find("#" + p.windowNo + "_emailTo"), k = a.find("#" + p.windowNo + "_emailBcc"), ut = a.find("#" + p.windowNo + "_eamilCc"), a.find(".vis-Email-textarea-div").height(a.height() - 145), ar = a.find("#" + p.windowNo + "_emailRefresh"), r = a.width() - 90, a.find(".vis-Email-leftWrap").width(r - 350), a.find(".vis-form-data-sub").width(a.find(".vis-Email-leftWrap").width() - 60)) : (a.find(".vis-Email-rytWrap").hide(), a.find(".vis-Email-topinputWrap").hide(), vr.hide(), a.find(".vis-Email-textarea-div").height(a.height() - 142), a.find(".vis-Email-leftWrap").css("margin-right", "20px"), r = a.width() - 240, a.find(".vis-Email-leftWrap").width(r - 25), a.find(".vis-form-data-sub").width(a.find(".vis-Email-leftWrap").width() - 60)); window.VADMS ? a.find(".vis-Email-BccList").height(a.find(".vis-Email-rytContent").height() - (a.find(".vis-Email-rytForm").height() + 70) - 520) : a.find(".vis-Email-BccList").height(a.find(".vis-Email-rytContent").height() - (a.find(".vis-Email-rytForm").height() + 70) - 280); vt = a.find(".vis-Email-ContentWrap"); vt.css("width", r); y != null && y != undefined && (y.body.style.width = r - 370 + "px"); gu = !0; e == !0 ? (ht.show(), ht.next().show()) : (ht.hide(), ht.next().hide()) } function re() { try { pi.kendoEditor({ tools: ["bold", "italic", "underline", "strikethrough", "justifyLeft", "justifyCenter", "justifyRight", "justifyFull", "insertUnorderedList", "insertOrderedList", "indent", "outdent", "createLink", "unlink", "insertImage", "insertFile", "subscript", "superscript", "createTable", "addRowAbove", "addRowBelow", "addColumnLeft", "addColumnRight", "deleteRow", "deleteColumn", "viewHtml", "formatting", "cleanFormatting", "fontName", { name: "fontSize", items: [].concat([{ text: "8px", value: "8px" }], [{ text: "12px", value: "12px" }], [{ text: "16px", value: "16px" }], [{ text: "20px", value: "20px" }], [{ text: "24px", value: "24px" }]) }, "foreColor", "backColor"], keyup: tf, encoded: !1 }); y = pi.data("kendoEditor"); y.value(""); h != undefined && h != null && y.value(h) } catch (t) { return console.log(t), n.ADialog.error("PleaseInstallKendoUIModule"), p.dispose(), p = null, !1 } return !0 } function tf() { (y.value() != "" || nt.val() != "") && (at = 1) } function rf(n) { var i, t, f; if (n == !0 && (v = u.getSelectedRows(), b = r.getRecords()[r.getCurrentRow()]), u.singleRow && v.length == 0) uf(); else if (v.length > 0) { for (i = "", t = 0; t < v.length; t++)e && v[t].email != null && (e = !0, f = v[t][r.getKeyColumnName().toLower()], i += '<li class="vis-list-li-bcc"  data-email="' + v[t].email + '"><input data-currentrec="Y" data-recID="' + f + '" id="' + p.windowNo + "_" + v[t].email + '_CheckBoxList1" type="checkbox" value="' + v[t].email + '" checked/><label class="vis-chcklist-label"  for="' + p.windowNo + "_" + v[t].email + '_CheckBoxList1">' + v[t].email + "(" + f + ")<\/label><\/li>"); ot.append(i); i = null } else uf(); n || nr.append(ot) } function uf() { if (e && b.email != null) { e = !0; var n = b[r.getKeyColumnName().toLower()]; ot.append('<li class="vis-list-li-bcc" data-email="' + b.email + '"><input id="' + p.windowNo + "_" + b.email + '_CheckBoxList1" type="checkbox" value="' + b.email + '" checked /><label class="vis-chcklist-label" for="' + p.windowNo + "_" + b.email + '_CheckBoxList1">' + b.email + "(" + n + ")<\/label><\/li>") } } function ff(i) { var h, f, e, o, s, u; for (i ? rt.empty() : (tr = t('<div class="vis-apanel-lb-toggle">'), dt = t('<i class="fa fa-bars"><\/i>'), ni = t('<div class="vis-apanel-lb-toggle" style="border:none;height:100%;overflow-x:hidden;overflow-y: hidden;"><\/div>'), oi = t("<div class='vis-apanel-lb-oflow' style='border-top:0;display:none' >"), oi.html("<a data-dir='u' href='javascript:void(0)'><i class='vis vis-arrow-up' data-dir='u'><\/i><\/a><a data-dir='d' href='javascript:void(0)' ><i class='vis vis-arrow-down' data-dir='d'><\/i><\/a>"), ir = t('<div class="vis-apanel-lb-toggle" style="padding: 5px 10px;overflow-x:hidden;overflow-y: hidden;"><\/div>'), ir.append(oi), tr.append(dt), g.append(tr), g.append(ni), g.append(ir), rt = t('<ul class="vis-apanel-lb-ul"><\/ul>'), rt.css({ overflow: "auto", "overflow-x": "hidden", "white-space": "nowrap", width: "100%" })), h = "", f = 0; f < r.gridTable.getFields().length; f++)if (e = r.gridTable.getFields(0)[f].getColumnName().toUpper() == r.getKeyColumnName().toUpper(), r.gridTable.getFields(0)[f].getIsDisplayed() || e) { if (e || (h += "<li>" + r.gridTable.getFields(0)[f].getHeader() + "<\/li>"), o = [], s = [], r.gridTable.getFields(0)[f].getColumnName().toUpper().equals(si)) for (u = 0; u < v.length; u++)n.DisplayType.IsLookup(r.getField(si).getDisplayType()) ? v[u][si.toLower()] != null && (o.push(v[u][si.toLower()]), s.push(v[u][r.getKeyColumnName().toLower()])) : v[u][si.toLower()] != null && (o.push(v[u][si.toLower()]), s.push(v[u][r.getKeyColumnName().toLower()])); ue(o, s) } e || rt.append(h); i || ni.append(rt); rt.children("li").on("click", ve) } function ef() { if (!d) if (rt.height() > t(rt.parent()).height()) { ni.css("border-bottom", "1px solid rgba(var(--v-c-secondary), 1)"); oi.css("display", "block"); var n = ir.height() + tr.height() + 37; ni.height(g.height() - n); g.css("overflow", "hidden"); ni.css({ "overflow-x": "hidden", width: "100%", "overflow-y": "visible" }) } else ni.css("border-bottom", "none"), oi.css("display", "none") } function ue(i, r) { for (var f, e = 0; e < i.length; e++) { var u = n.dataContext.getJSONData(n.Application.contextUrl + "Email/GetUser", { BPartner_ID: i[e] }, null), o = ""; if (u != null) for (f in u) if (u[f].Email != null) { if (u[f].Email == null || u[f].Email == "") continue; if (t(ot.children("li").data(u[f].Email + r[e])).length > 0) continue; o += '<li  class="vis-list-li-bcc"><input data-currentrec="N" data-recid="' + r[e] + '" id="' + p.windowNo + "_" + u[f].Email + '_CheckBoxList1" type="checkbox"  value="' + u[f].Email + '" checked/><label class="vis-chcklist-label"  for="' + p.windowNo + "_" + u[f].Email + '_CheckBoxList1">' + u[f].Email + "(" + r[e] + ")<\/label><\/li>" } ot.append(o); o = null } } function fe() { nt.on("change", tf); if (!d) oi.on("click", function (n) { var r, e; if (n.stopPropagation(), r = t(n.target).data("dir"), r) { var o = rt.parent().height(), s = rt.height(), u = rt.parent().scrollTop(), f = Math.ceil(o / 2), i = 0; if (r == "d") { if (u + f >= s - f) return; e = s - o; i = u + f; rt.parent().animate({ scrollTop: i > e ? e : i }, 1e3) } else if (r == "u") { if (u == 0) return; i = u - f; rt.parent().animate({ scrollTop: i < 0 ? 0 : i }, 1e3) } } }); vr.on("click", function () { ee() }); ei.on("click", "li", function (i) { var u, r; if (i.stopPropagation(), u = t(this).attr("value"), parseInt(u) == 0) se(i); else if (parseInt(u) == 1) { if (t("#w2ui-overlay").hide(), wt != null && wt.GetDmsCloseOrNot()) { n.ADialog.info("DMSAlreadyOpen"); return } r = new n.CFrame; wt = new VADMS.DocumentManagementSystem; r.setName(n.Msg.getMsg("VADMS_Document")); r.setTitle(n.Msg.getMsg("VADMS_Document")); r.hideHeader(!0); wt.setWindowNo(p.windowNo); wt.OpenFromEmail(!0); r.setContent(wt); wt.initialize(); r.show() } }); if (e) { gt.on("click", pe); if (ar != null && ar != undefined) ar.on("click", ge) } else gt.on("click", we); if (!e) { su.on("click", be); hu.on("click", ke) } if (d) a.find(".vis-Email-CcBcc").on("click", no); else { dt.on("click", oe); ct.on("click", ce); wi.on("click", ye); bi.on("click", vf); ki.on("click", yf); lt.on("click", bu); dt.trigger("click"); ht.on("click", le) } wf(); e || nt.keyup(function () { at = nt.val() != "" ? y.value() != "" ? 1 : 0 : 0 }) } function ee() { var i, r; ei != null && ei.empty(); i = t("<div/>"); i.css("width", "auto"); i.css("height", "100%"); ei.css("width", "auto"); ei.css("height", "100%"); r = "<li class='vis-filesystem' value='0'>" + n.Msg.getMsg("FileSystem") + "<\/li> "; window.VADMS && (r += "<li class='vis-dms' value='1'>" + n.Msg.getMsg("DMS") + "<\/li>"); ei.append(r); i.append(ei); vr.w2overlay(i.clone(!0), { css: { height: "300px" } }); i.css("top", "395px"); ei.load() } function oe(n) { ct.prop("checked") == !0 ? g.width() == 40 ? (e ? (middleDivWidth = fi - (a.find(".vis-email-leftDiv").width() + 200), a.find(".vis-Email-leftWrap").width(middleDivWidth - 355), a.find(".vis-form-data-sub").width(a.find(".vis-Email-leftWrap").width() - 45), vt.width(middleDivWidth)) : (middleDivWidth = fi - (a.find(".vis-email-leftDiv").width() + 200), a.find(".vis-Email-leftWrap").width(middleDivWidth - 15), a.find(".vis-form-data-sub").width(middleDivWidth - 40), vt.width(middleDivWidth)), g.css("width", "200px"), g.find("ul").show(), ef(), y != null && y != undefined && (y.body.style.width = y.body.style.width - 160)) : (pu(), ni.css("border-bottom", "none"), d || oi.css("display", "none")) : g.width() != 40 && pu(); n.stopPropagation() } function pu() { g.css({ width: "40px" }); g.find("ul").hide(); e ? (middleDivWidth = fi - (a.find(".vis-email-leftDiv").width() + 40), a.find(".vis-Email-leftWrap").width(middleDivWidth - 355), a.find(".vis-form-data-sub").width(a.find(".vis-Email-leftWrap").width() - 45), vt.width(middleDivWidth)) : (middleDivWidth = fi - (a.find(".vis-email-leftDiv").width() + 40), a.find(".vis-Email-leftWrap").width(middleDivWidth - 15), a.find(".vis-form-data-sub").width(middleDivWidth - 40), vt.width(middleDivWidth)); y != null && y != undefined && (y.body.style.width = y.body.style.width + 160) } function se() { var n; if (uu == !1) { if (a.find(".vis-email-attachmentContainer").is(":visible")) a.find(".vis-email-attachmentContainer").hide(), a.find(".vis-Email-textarea-div").height(a.find(".vis-Email-textarea-div").height() + (a.find(".vis-email-attachmentContainer").height() + 13)); else if (n = a.find(".vis-Email-ContentArea").height(), a.find(".vis-email-attachmentContainer").show(), a.find(".vis-Email-textarea-div").height(a.find(".vis-Email-textarea-div").height() - (a.find(".vis-email-attachmentContainer").height() + 13)), et == null || et == undefined) { of(); et = a.find("<input type='file' multiple='true' style='display:none;'>"); fu.append(et); pr.on("click", function () { et.trigger("click") }); et.change(function () { sf(this) }) } } else a.find(".vis-email-attachmentContainer").is(":visible") || (n = a.find(".vis-Email-ContentArea").height(), (et == null || et == undefined) && (of(), et = t("<input type='file' multiple='true' style='display:none;'>"), et.change(function () { this.files.length < 1 || (a.find(".vis-email-attachmentContainer").show(), sf(this), d ? a.find(".vis-Email-textarea-div").height(a.find(".vis-Email-ContentArea").height() - (a.find(".vis-form-horizontal").height() + 30)) : a.find(".vis-Email-textarea-div").height(a.find(".vis-Email-ContentArea").height() - (a.find(".vis-form-horizontal").height() + 50)), w && w.length > 0 && lf()) }))), et.trigger("click") } function of() { fu = t("<div><\/div>"); var n = t("<div><\/div>"); if (a.find(".vis-email-attachmentContainer").append(n), uu == !1 && (pr = t('<a class="vis-attach-ico browse-ico" style="margin-right:8px;float:right;height:30px;width:30px;margin-top:6px;"><\/a>'), fu.append(pr), n.append(pr)), eu = t("<div><\/div>"), n.append(eu), ci = t("<div class='vis-attach-content-wrap' style='height:83px;border-bottom:2px solid rgba(var(--v-c-secondary), 1);padding-bottom:0px'>"), ci.append(t('<div style="height:auto;overflow:auto" ><\/div>')), eu.append(ci), a.find(".vis-email-attachmentContainer").append(wr), uu == !1) { ou = t("<div><\/div>"); n.append(ou); cu = t('<a href="javascript:void(0)" class="vis-attach-ico uploadall-ico" style="height:30px;width:30px;margin-right: 7px;float:right"><\/a>'); ou.append(cu); cu.on("click", function () { lf() }) } } function hf() { return ci.children(0).height() < 75 ? !1 : !0 } function ce() { this.checked ? (g.width() != 40 && g.find("ul").show(), e == !0 && u.singleRow == !1 && v.length > 1 && (st.val(""), st.prop("disabled", !0), ut.val(""), ut.prop("disabled", !0), k.val(""), k.prop("disabled", !0)), au = !0) : (g.width() != 40 && pu(), e == !0 && u.singleRow == !1 && v.length > 1 && ht.prop("checked") == !1 && (st.prop("disabled", !1), ut.prop("disabled", !1), k.prop("disabled", !1)), au = !1, ni.css("border-bottom", "none"), d || oi.css("display", "none")) } function le() { this.checked ? (ii.parent().show(), e == !0 && u.singleRow == !1 && v.length > 1 && (st.val(""), st.prop("disabled", !0), ut.val(""), ut.prop("disabled", !0), k.val(""), k.prop("disabled", !0))) : (ii.parent().hide(), e == !0 && u.singleRow == !1 && v.length > 1 && ct.prop("checked") == !1 && (st.prop("disabled", !1), ut.prop("disabled", !1), k.prop("disabled", !1))) } function ae() { t.ajax({ url: n.Application.contextUrl + "JsonData/GetReportFileTypes", datatype: "json", type: "post", cache: !1, data: { AD_Process_ID: r.getAD_Process_ID() }, success: function (n) { var i, r; if (n != null && (i = jQuery.parseJSON(n), i.length != 0)) for (r = 0; r < i.length; r++)ii.append(t("<option value=" + i[r].Key + ">" + i[r].Name + "<\/option>")) } }) } function ve() { y.paste("@@" + t(this).text() + "@@") } function ye() { var f = y.value(), e = "", r, i; e = u.singleRow == !1 || v.length > 0 ? to(f, 0) : io(f); r = t("<div><\/div>"); r.append(e); t(r.find("table")).css({ width: "100%", border: "1px solid Black" }); t(r.find("td")).css({ border: "1px solid Black" }); i = new n.ChildDialog; i.setHeight(420); i.setWidth(850); i.setTitle(n.Msg.getMsg("Preview")); i.setModal(!0); i.setContent(r); i.show(); i.hidebuttons() } function pe(t) { var i = nt.val(), r = y.value(), u = !0; if ((i == null || i == "" || i.trim().length == 0) && (r == null || r == "" || r.trim().length == 0)) { u = !1; n.ADialog.confirm("SendWithoutSubjectandBody", !0, "", "Confirm", function (n) { n && gr(t, i, r) }); return } if (i == null || i == "" || i.trim().length == 0) { u = !1; n.ADialog.confirm("SendWithoutSubject", !0, "", "Confirm", function (n) { n && gr(t, i, r) }); return } if (r == null || r == "" || r.trim().length == 0) { u = !1; n.ADialog.confirm("SendWithoutBody", !0, "", "Confirm", function (n) { n && gr(t, i, r) }); return } u && gr(t, i, r) } function gr(i, e) { var d, rt, l, s, o, et, lt, at, a, tt, h, c; pt = !1; var g = st.val(), w = k.val(), nt = ut.val(); if (g.trim().length > 0) if (g.contains(";")) { for (s = g.split(";"), o = 0; o < s.length; o++)if (s[o] != null && s[o] != "") if (kt(s[o].trim())) pt = !0; else { window.setTimeout(function () { n.ADialog.info("NotValidEmail", !0, ":" + s[o]) }, 2); return } } else if (kt(g.trim())) pt = !0; else { window.setTimeout(function () { n.ADialog.info("NotValidEmail", !0, ":" + g) }, 2); return } if (nt.trim().length > 0) if (nt.contains(";")) { for (s = nt.split(";"), o = 0; o < s.length; o++)if (s[o] != null && s[o] != "") if (kt(s[o].trim())) pt = !0; else { window.setTimeout(function () { n.ADialog.info("NotValidEmail", !0, ":" + s[o]) }, 2); return } } else if (kt(nt.trim())) pt = !0; else { window.setTimeout(function () { n.ADialog.info("NotValidEmail", !0, ":" + nt) }, 2); return } if (w.trim().length > 0) if (w.contains(";")) { for (s = w.split(";"), o = 0; o < s.length; o++)if (s[o] != null && s[o] != "") if (kt(s[o].trim())) pt = !0; else { window.setTimeout(function () { n.ADialog.info("NotValidEmail", !0, ":" + s[o]) }, 2); return } } else if (kt(w.trim())) pt = !0; else { window.setTimeout(function () { n.ADialog.info("NotValidEmail", !0, ":" + w) }, 2); return } if (d = [], ct.prop("checked") == !1 && ht.prop("checked") == !1) { if (rt = !1, l = {}, l.To = g, l.Cc = nt, l.Bcc = [], w.contains(";")) for (s = w.split(";"), o = 0; o < s.length; o++)s[o] != null && s[o] != "" && l.Bcc.push(s[o]); else w != null && w != "" && l.Bcc.push(w); if (ot != null && ot != undefined && (it = [], t("[id*=CheckBoxList1]:checked").each(function () { it.push(t(this).val()) }), it.length > 0)) for (a = 0; a < it.length; a++) { if (!kt(it[a])) { window.setTimeout(function () { n.ADialog.info("NotValidEmail", !0, ":" + it[a]) }, 2); return } rt = !0; l.Bcc.push(it[a]) } if (l.Subject = e, l.TableID = yi, l.Recordids = "", b != null) if (u.singleRow == !1 || v.length > 0) { for (et = "", h = 0; h < v.length; h++)et += v[h][r.keyColumnName.toLower()] + ","; l.Recordids = et } else l.Recordids = f > 0 ? f : u.singleRow == !0 ? r.getField(r.keyColumnName.toLower()).value : b[r.keyColumnName.toLower()]; else f > 0 && (l.Recordids = f); if (l.AttachmentFolder = kr, !rt && !pt) { window.setTimeout(function () { n.ADialog.info("NoEmailAddressFound") }, 2); return } d.push(l) } else if (it = [], lt = [], at = [], t("[id*=CheckBoxList1]:checked").each(function () { it.push(t(this).val()); lt.push(t(this).data("recid")); at.push(t(this).data("currentrec")) }), it.length > 0) { for (a = 0; a < it.length; a++)if (!kt(it[a])) { window.setTimeout(function () { n.ADialog.info("NotValidEmail", !0, ":" + it[a]) }, 2); return } for (tt = 0; tt < it.length; tt++)if (u.singleRow == !0 && v.length == 0) { if (c = hr(b, 0), c == null || c == undefined) return; d.push(c) } else for (h = 0; h < v.length; h++)if (lt[tt] == v[h][r.getKeyColumnName().toLower()]) { if (c = null, c = at[tt] == "N" ? hr(v[h], h, it[tt]) : hr(v[h], h), c == null || c == undefined) continue; d.push(c) } } else if (pt) if (u.singleRow == !0 && v.length == 0) { if (c = hr(b, 0), c == null || c == undefined) return; d.push(c) } else for (h = 0; h < v.length; h++)(c = hr(v[h], h), c != null && c != undefined) && d.push(c); if (d.length == 0) { window.setTimeout(function () { n.ADialog.info("NoEmailAddressFound") }, 2); return } var dt = JSON.stringify(d), vt = !1, bt = "X"; ht.prop("checked") && (bt = ii.val()); n.ADialog.confirm("WantAlertMessage", !0, "", "Confirm", function (i) { i && (vt = !0); ft[0].style.visibility = "visible"; var u = { mails: n.Utility.encodeText(dt), AD_User_ID: yt.getAD_User_ID(), AD_Client_ID: yt.getAD_Client_ID(), AD_Org_ID: yt.getAD_Org_ID(), attachment_ID: ru, fileNamesFornNewAttach: JSON.stringify(gi), fileNamesForopenFormat: JSON.stringify(li), mailFormat: n.Utility.encodeText(y.value()), notify: vt, strDocAttach: n.context.getContext("DocumentAttachViaEmail_" + p.windowNo), AD_Process_ID: r != null ? r.getAD_Process_ID() : 0, printformatfileType: bt }; t.ajax({ url: n.Application.contextUrl + "Email/SendMail", data: u, datatype: "json", type: "post", cache: !1, async: !0, success: function (t) { ft[0].style.visibility = "hidden"; var i = JSON.parse(t); i == "" ? (p.dispose(), p = null, wt != null && wt.dispose(), wt = null) : window.setTimeout(function () { n.ADialog.info(i); i.contains("MailSent") && n.context.setContext("DocumentAttachViaEmail_" + p.windowNo, "") }, 2) } }) }) } function kt(n) { return /^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(n) } function we() { var e, i, h, o, s; if (e = nt.val(), e == null || e == "" || e.trim().length == 0) { n.ADialog.info("PleaseAddSubject"); return } if (i = y.value(), i != null && i != "" && i != undefined && !(i.trim().length < 1)) { if (h = "", o = {}, v = u.getSelectedRows(), b = r.getRecords()[r.getCurrentRow()], u.singleRow == !1 || v.length > 0) for (s = 0; s < v.length; s++)o[v[s][r.keyColumnName.toLower()]] = ku(i, s); else f > 0 ? o[f] = tu(i) : o[b[r.keyColumnName.toLower()]] = tu(i); ft[0].style.visibility = "visible"; t.ajax({ url: n.Application.contextUrl + "Email/SaveAttachment", datatype: "json", type: "post", cache: !1, data: { subject: e, AD_Table_ID: yi, html: n.Utility.encodeText(i), values: JSON.stringify(o) }, success: function () { ft[0].style.visibility = "hidden"; n.ADialog.info("Saved") }, error: function (n) { console.log(n) } }) } } function be() { var i = y.value(), o, f, e; if (i != null && i != "" && i != undefined && !(i.trim().length < 1)) { if (o = "", f = [], v = u.getSelectedRows(), b = r.getRecords()[r.getCurrentRow()], u.singleRow == !1 || v.length > 0) for (e = 0; e < v.length; e++)f.push(ku(i, e)); else f.push(tu(i)); ft[0].style.visibility = "visible"; t.ajax({ url: n.Application.contextUrl + "Email/InsertAttachmentText", datatype: "json", type: "post", cache: !1, data: { html: n.Utility.encodeText(i), values: JSON.stringify(f) }, success: function (t) { var i, r; ft[0].style.visibility = "hidden"; i = JSON.parse(t); nf = i; r = nf; window.open(n.Application.contextUrl + r); return } }) } } function ke(t) { sr = !1; or = 0; at == 1 ? (y.value() != "" || nt.val() != "") && n.ADialog.confirm("DoYouWantToSave", !0, "", "Confirm", function (n) { n ? (bu(t), at = 0, or = 1) : (nt.val(""), y.value(""), hi = 0, lt.css("opacity", "1"), at = 0) }) : (nt.val(""), y.value(""), hi = 0, lt.css("opacity", "1"), at = 0) } function vf(t) { var r = 0, i; wu = 0; i = new n.Openmailformat(u.gTab.getAD_Window_ID(), e); de = i; e || (or = 0, y.value() != "" && nt.val() != "" && at == 1 && (n.ADialog.confirm("DoYouWantToSave", !0, "", "Confirm", function (n) { n ? (bu(t), wu = 1, sr = !0) : (hi = 0, lt.css("opacity", "1"), at = 0, i.show()) }), r = 1)); r == 0 && i.show(); i.onClose = function () { at = 0; var n = i.getSelectedRow(); n != null && n != undefined && (hi = n.AD_TEXTTEMPLATE_ID, nu = n.AD_CLIENT_ID, nt.val(n.SUBJECT), nu != yt.getAD_Client_ID() ? lt.css("opacity", "0.4") : lt.css("opacity", "1"), n.ISDYNAMICCONTENT == "Y" ? ct.prop("checked", !1).trigger("click") : ct.prop("checked", !0).trigger("click"), cr = n.AD_Window_ID != null && n.AD_Window_ID != undefined && n.AD_Window_ID > 0 ? !1 : !0, iu = n.NAME, y.value(n.MAILTEXT)); sr = !1 } } function yf() { var i = y.value(), t; i != null && i.trim() != "" && i != undefined && (t = new n.Newmailformat(e), t.show(), t.onClose = function () { iu = t.getName(); cr = t.saveForAll(); pf(0) }) } function bu() { if (nu == yt.getAD_Client_ID()) { var n = y.value(); n != null && n != "" && n != undefined && (hi > 0 ? pf(hi) : yf()) } } function ge() { ot.empty(); rf(!0); ff(!0) } function pf(i) { var u = { id: i, AD_Client_ID: yt.getAD_Client_ID(), AD_Org_ID: yt.getAD_Org_ID(), name: n.Utility.encodeText(iu), isDynamic: ct.prop("checked"), subject: n.Utility.encodeText(nt.val()), text: n.Utility.encodeText(y.value()), saveforAll: cr, AD_Window_ID: r.getAD_Window_ID(), folderName: kr, attachmentID: ru }; t.ajax({ type: "POST", url: n.Application.contextUrl + "Email/SaveFormats", data: u, success: function (n) { hi = parseInt(n); nu = yt.getAD_Client_ID(); lt.css("opacity", "1"); at = 0; e || (or == 1 && (nt.val(""), y.value("")), sr == !0 && window.setTimeout(function () { wu == 1 && (vf(), sr = !1) }, 200)) } }) } function no() { k.is(":visible") ? (k.hide(), ut.hide(), a.find(".vis-email-attachmentContainer").is(":visible") ? a.find(".vis-Email-textarea-div").height(a.height() - 365) : a.find(".vis-Email-textarea-div").height(a.height() - 180)) : (k.show(), ut.show(), a.find(".vis-email-attachmentContainer").is(":visible") ? a.find(".vis-Email-textarea-div").height(a.height() - 440) : a.find(".vis-Email-textarea-div").height(a.height() - 255)) } function hr(t, i, e) { var c = !1, o = {}, s, i, h; if (o.To = st.val(), o.Cc = ut.val(), o.Bcc = [], k.val().contains(";")) for (s = k.val().split(";"), i = 0; i < s.length; i++)s[i] != null && s[i] != "" && o.Bcc.push(s[i]); else k.val() != null && k.val() != "" && o.Bcc.push(k.val()); if (e) kt(e) || window.setTimeout(function () { n.ADialog.info("NotValidEmail", !0, ":" + e); return }, 2), o.Bcc.push(e), c = !0; else if (ot != null && ot != undefined) if (Object.keys(t).indexOf("email") > -1 && it.indexOf(t.email) > -1) kt(t.email) || window.setTimeout(function () { n.ADialog.info("NotValidEmail", !0, ":" + t.email); return }, 2), o.Bcc.push(t.email), c = !0; else if ((!u.singleRow != !1 || v.length != 1) && (!u.singleRow == !1 || v.length > 1)) return; if (h = nt.val(), h.trim().length == 0 && (h = "  "), o.Subject = h, o.TableID = yi, o.Recordids = u.singleRow == !0 && v.length == 0 ? f : t[r.keyColumnName.toLower()], o.Body = u.singleRow == !1 ? ku(y.value(), i) : tu(y.value()), o.AttachmentFolder = kr, u.singleRow != !0 && v.length != 1 || c || pt) return o } function ku(t, i) { for (var e = t, h = {}, s; e.indexOf("@@") > -1;) { e = e.substring(e.indexOf("@@") + 2); var c = e.substring(0, e.indexOf("@@")), o = null, f = Object.keys(u.getColumnNames()).filter(function (n) { return u.getColumnNames()[n] === c })[0]; f != undefined && f != null && (n.DisplayType.IsLookup(r.getField(f).getDisplayType()) || n.DisplayType.Location == r.getField(f).getDisplayType() ? v[i][f.toLower()] != null && v[i][f.toLower()] != undefined && (o = r.getField(f.toLower()).lookup.getDisplay(v[i][f.toLower()])) : n.DisplayType.IsDate(r.getField(f).getDisplayType()) ? (s = r.getField(f).getDisplayType(), o = r.getField(f).value, o = n.DisplayType.Date == s ? new Date(o).toLocaleDateString() : n.DisplayType.Time == s ? new Date(o).toLocaleTimeString() : new Date(o).toLocaleString()) : o = v[i][f.toLower()]); e = e.substring(e.indexOf("@@") + 2); h["@@" + c + "@@"] = o } return h } function tu(t) { for (var f = t, s = {}, o; f.indexOf("@@") > -1;) { f = f.substring(f.indexOf("@@") + 2); var h = f.substring(0, f.indexOf("@@")), e = null, i = Object.keys(u.getColumnNames()).filter(function (n) { return u.getColumnNames()[n] === h })[0]; i != undefined && i != null && (n.DisplayType.IsLookup(r.getField(i).getDisplayType()) || n.DisplayType.Location == r.getField(i).getDisplayType() ? v.length > 0 && v[0][i.toLower()] != null && v[0][i.toLower()] != undefined ? e = r.getField(i.toLower()).lookup.getDisplay(v[0][i.toLower()]) : b[i.toLower()] != null && b[i.toLower()] != undefined && (e = r.getField(i.toLower()).lookup.getDisplay(b[i.toLower()])) : n.DisplayType.IsDate(r.getField(i).getDisplayType()) ? (o = r.getField(i).getDisplayType(), e = r.getField(i).value, e = n.DisplayType.Date == o ? new Date(e).toLocaleDateString() : n.DisplayType.Time == o ? new Date(e).toLocaleTimeString() : new Date(e).toLocaleString()) : e = u.singleRow == !0 && v.length == 0 ? r.getField(i).value : v && v.length > 0 ? v[0][i.toLower()] : b[i.toLower()]); f = f.substring(f.indexOf("@@") + 2); s["@@" + h + "@@"] = e } return s } function to(t, i) { for (var s = t, o = t, c; o.indexOf("@@") > -1;) { o = o.substring(o.indexOf("@@") + 2); var h = o.substring(0, o.indexOf("@@")), e = null, f = Object.keys(u.getColumnNames()).filter(function (n) { return u.getColumnNames()[n] === h })[0]; f != undefined && f != null && (n.DisplayType.IsLookup(r.getField(f).getDisplayType()) || n.DisplayType.Location == r.getField(f).getDisplayType() ? v[i][f.toLower()] != null && v[i][f.toLower()] != undefined && (e = r.getField(f.toLower()).lookup.getDisplay(v[i][f.toLower()])) : n.DisplayType.IsDate(r.getField(f).getDisplayType()) ? (c = r.getField(f).getDisplayType(), e = r.getField(f).value, e = n.DisplayType.Date == c ? new Date(e).toLocaleDateString() : n.DisplayType.Time == c ? new Date(e).toLocaleTimeString() : new Date(e).toLocaleString()) : e = v[i][f.toLower()]); o = o.substring(o.indexOf("@@") + 2); s = e != null && e != undefined ? s.replace("@@" + h + "@@", e) : s.replace("@@" + h + "@@", "") } return s } function io(t) { for (var e = t, o; e.indexOf("@@") > -1;) { e = e.substring(e.indexOf("@@") + 2); var s = e.substring(0, e.indexOf("@@")), f = null, i = Object.keys(u.getColumnNames()).filter(function (n) { return u.getColumnNames()[n] === s })[0]; i != undefined && i != null && (n.DisplayType.IsLookup(r.getField(i).getDisplayType()) || n.DisplayType.Location == r.getField(i).getDisplayType() ? f = b[i.toLower()] != null && b[i.toLower()] != undefined ? r.getField(i.toLower()).lookup.getDisplay(b[i.toLower()]) : "" : n.DisplayType.IsDate(r.getField(i).getDisplayType()) ? (o = r.getField(i).getDisplayType(), f = r.getField(i).value, f = n.DisplayType.Date == o ? new Date(f).toLocaleDateString() : n.DisplayType.Time == o ? new Date(f).toLocaleTimeString() : new Date(f).toLocaleString()) : u.singleRow == !0 && v.length == 0 ? (f = r.getField(i).value, f == null && (f = "")) : f = b[i.toLower()]); e = e.substring(e.indexOf("@@") + 2); t = t.replace("@@" + s + "@@", f) } return t } function wf() { var n = 0; a.height(du); a.width(fi); a.find(".contentArea").css("height", a.height() - 42); a.find(".vis-Email-BccList").height(1); a.find(".vis-email-leftDiv").height(a.find(".contentArea").height()); d ? (a.find(".vis-email-attachmentContainer").is(":visible") ? a.find(".vis-Email-textarea-div").height(a.height() - 345) : a.find(".vis-Email-textarea-div").height(a.height() - 180), a.find(".vis-form-data-sub").width(a.find(".vis-Email-leftWrap").width() - 85), n = a.width() - 40) : e ? (a.find(".vis-email-attachmentContainer").is(":visible") ? a.find(".vis-Email-textarea-div").height(a.height() - (a.find(".vis-email-attachmentContainer").height() + 150)) : a.find(".vis-Email-textarea-div").height(a.height() - (a.find(".vis-email-attachmentContainer").height() + 70)), n = fi - (a.find(".vis-email-leftDiv").width() + 30), a.find(".vis-Email-leftWrap").width(n - 355), a.find(".vis-form-data-sub").width(a.find(".vis-Email-leftWrap").width() - 45)) : (a.find(".vis-Email-textarea-div").height(a.height() - 155), y != null && y != undefined, n = fi - (a.find(".vis-email-leftDiv").width() + 30), a.find(".vis-Email-leftWrap").width(n - 15), a.find(".vis-form-data-sub").width(n - 40)); vt != null && vt.css("width", n - 10); y != null && y != undefined && (y.body.style.width = n - 370 + "px"); d || (window.VADMS ? a.find(".vis-Email-BccList").height(a.find(".vis-Email-rytContent").height() - (a.find(".vis-Email-rytForm").height() + 310)) : a.find(".vis-Email-BccList").height(a.find(".vis-Email-rytContent").height() - (a.find(".vis-Email-rytForm").height() + 70))) } var vu, br, or; this.frame = null; this.windowNo = n.Env.getWindowNo(); var yt = n.Env.getCtx(), ri = null, si = "C_BPARTNER_ID", v = null, b = null, hi = 0, iu, cr, w = [], bf = [], ci = null, ru = 0; l && (ru = l); var uu = !0, pt = !1, yi = 0, it = [], d = !1, li = [], gi = [], rt = null, a = null, g = null, vt = null, nr = null, lr = null, dt = null, ot = null, ct = null, st = null, k = null, ut = null, ar = null, vr = null, nt = null, pi = null, y = null, yr = null, wi = null, gt = null, bi = null, ki = null, lt = null, kf = null, ft, ui = t('<div class="vis-awindow-header vis-menuTitle">'), p = this, fu, pr, eu, ou, su, hu, cu, du = 0, fi = 0, ro = p.windowNo; a = t('<div class="vis-email-rootDiv vis-forms-container"><\/div>'); var lu = t('<div class="vis-email-rootDivBusy"><\/div>'), ei = t("<ul id='ulAttachmentOption' class='vis-apanel-rb-ul'>"), wt = null, gu = !1, tr, ni, ir, au = !1, wr = t("<div style='width: 100%;height: 100%;background:black;opacity: .1;display:none'>"), di = null; di = n.Application.isRTL ? t("<div id='progress_bar' class='vis-ui-progress-bar ui-container' style='top:41%;width: 80%;right: 10%;'>") : t("<div id='progress_bar' class='vis-ui-progress-bar ui-container' style='top:41%;width: 80%;left: 9%;'>"); wr.append(di); vu = t("<div class='vis-ui-progress' style='width: 0%; display: block;position:absolute;margin-top:2px'>"); di.append(vu); br = t("<span class='ui-label' >").append("0%"); di.append(br); var yu = 0, ai = 0, kr = Date.now().toString(), bt = 1048576, ti = 0, rr = 0, df = [], nf = "", et = null, tt, ur = null, oi, at = 0, ht = null, ii = null, fr = "", er = ""; gf(); this.initializeComponent = function () { var i = null, r; (e == !0 ? (i = t('<a href="javascript:void(0)"  class="vis-icon-menuclose"><i class="vis vis-cross"><\/i><\/a>'), r = d ? t("<p>" + n.Msg.getMsg("EMail") + " (" + n.Msg.getMsg("Contacts") + ") <\/p>") : t("<p>" + n.Msg.getMsg("EMail") + " (" + u.aPanel.$parentWindow.getName() + ") <\/p>")) : (i = t('<a href="javascript:void(0)"  class="vis-icon-menuclose"><i class="vis vis-cross"><\/i><\/a>'), r = d ? t("<p>" + n.Msg.getMsg("Letter") + " (" + n.Msg.getMsg("Contacts") + ") <\/p>") : t("<p>" + n.Msg.getMsg("Letter") + " (" + u.aPanel.$parentWindow.getName() + ") <\/p>")), a.append(ui.append(i).append(r)), i.click(function (n) { p.dispose(); p = null; n.stopPropagation() }), te(), re() != !1) && (a.append(ft), ne(), d || e && rf(!1), d || (ff(!1), ae()), fe()) }; this.getRoot = function () { return a }; this.leftULsize = function () { if (!d) { var n = ir.height() + tr.height() + 53; t(rt.parent()).height(g.height() - n); au == !0 && ef() } }; var dr = function (n) { n ? (wr.show(), di.show()) : (wr.hide(), di.hide()) }, vi = [], sf = function (i) { var r, u, e, f, l, o, v, y, s, p, it, k, c, g, ut, nt; for (vi = [], r = 0; r < i.files.length; r++) { if (tt = i.files[r], tt == undefined) return; if (tt.size != 0) { if (u = n.context.getContext("#ALLOWED_FILE_EXTENSION"), u && u.length > 0 && u.split(",").indexOf("." + tt.name.split(".").pop()) == -1) { vi.push(tt.name); continue } for (f in w) if (tt.name == w[f].name) { window.setTimeout(function () { n.ADialog.info("fileAlreadyAttached") }, 2); return } if (li != null) for (e = 0; e < li.length; e++)if (tt.name == li[e]) { window.setTimeout(function () { n.ADialog.info("fileAlreadyAttached") }, 2); return } ti = 0; for (f in w) ti += w[f].size; if (ti + tt.size > bt * 24) { window.setTimeout(function () { n.ADialog.info("MaxFileSize25MB") }, 2); return } if (tt.size > bt * 24) { window.setTimeout(function () { n.ADialog.info("MaxFileSize25MB") }, 2); return } l = {}; o = t("<div style='margin-bottom:3px' class='vis-attach-file-wrapla'>"); ci.children(0).append(o); v = t("<div class='vis-attach-file-top'>"); y = t("<a class='vis-file-close-ico'><i class='vis vis-mark'><\/i><\/a>"); v.append(y); o.append(v); ci.show(); y.on("click", function () { var i = t(t(this).parent()).parent(), r = i.html(), n; i.remove(); i = null; for (n in w) if (String(r).indexOf(w[n].name) > -1) { ti = ti - n.size; w.splice(n, 1); break } gi.splice(0, gi.length); for (n in w) gi.push(w[n].name); hf() || (a.find(".vis-attach-content-wrap").height(83), a.find(".vis-email-attachmentContainer").height(90), d ? a.find(".vis-Email-textarea-div").height(t(".vis-Email-ContentArea").height() - (t(".vis-form-horizontal").height() + 30)) : a.find(".vis-Email-textarea-div").height(t(".vis-Email-ContentArea").height() - (t(".vis-form-horizontal").height() + 50))); w.length == 0 && (a.find(".vis-email-attachmentContainer").hide(), a.find(".vis-email-attachmentContainer").height(90), a.find(".vis-attach-content-wrap").height(83), d ? a.find(".vis-Email-textarea-div").height(t(".vis-Email-ContentArea").height() - (t(".vis-form-horizontal").height() + 30)) : a.find(".vis-Email-textarea-div").height(t(".vis-Email-ContentArea").height() - (t(".vis-form-horizontal").height() + 50))); ai-- }); s = t("<div class='vis-attach-file-content'>"); o.append(s); p = t("<div class='vis-attach-file-icon'>"); it = cf(tt.name); p.append(t("<img src='" + it + "'>")); s.append(p); var b = t("<div class='vis-attach-file-text' style='margin-bottom:10px'>"), rt = "", h = t("<p>"); tt.name.length > 17 ? (rt = tt.name.toString().substr(0, 17), h.append(rt), k = t("<a href='javascript:void(0)' class='VIS_Pref_tooltip'>").append("..."), c = t("<span style='width: inherit;'>"), c.append(t("<img class='VIS_Pref_callout'>").attr("src", n.Application.contextUrl + "Areas/VIS/Images/email-ccc.png").append("ToolTip Text")), c.append(t("<label class='VIS_Pref_Label_Font'>").append(tt.name)), k.append(c), h.append(k)) : h.append(tt.name); b.append(h); b.append(t("<p>").append((Number(tt.size) / 1024).toFixed(2) + "KB")); s.append(b); l.Name = tt.name; l.Size = tt.size; w.push(tt); hf() && a.find(".vis-email-attachmentContainer").height() == 90 && (a.find(".vis-email-attachmentContainer").height(155), a.find(".vis-attach-content-wrap").height(145)) } } if (vi && vi.length > 0) { g = ""; for (ut in vi) g += vi[ut].toString() + ", "; nt = ""; nt += vi.length == 1 ? "FileInvalidExtension" : "FilesInvalidExtension"; n.ADialog.warn(nt, !0, g) } }; var cf = function (t) { var r, u, i; return t == null || t.length == 0 ? "" : (r = t.lastIndexOf("."), u = n.Application.contextUrl + "Areas/VIS/Images/", r < 1) ? u + "defult.png" : (i = t.substr(r, t.length - r), u + (i == ".xlsx" || i == ".xls" ? "excel.png" : i == ".html" || i == ".htm" ? "html.png" : i == ".pdf" ? "pdf.png" : i == ".ppt" ? "ppt.png" : i == ".txt" ? "text.png" : i == ".docx" || i == ".doc" ? "word.png" : i == ".xml" ? "xml.png" : "defult.png")) }, uo = function (i, r) { var s = t("<div class='vis-attach-file-wrapla'>"), h, c, u, f, l, v, o; ci.append(s); h = t("<div class='vis-attach-file-top'>"); c = t("<a class='vis-file-close-ico'>"); h.append(c); s.append(h); c.on("click", function () { var n = t(t(this).parent()).parent(), r, i; n.css("display", "none"); r = n.html(); n.empty(); n = null; for (i in li) if (String(r).indexOf(li[i]) > -1) { li.splice(i, 1); break } }); u = {}; f = t("<div class='vis-attach-file-content'>"); s.append(f); l = t("<div class='vis-attach-file-icon'>"); l.append(t("<img src='" + cf(i) + "'>")); f.append(l); var a = t("<div class='vis-attach-file-text'  style='margin-bottom:10px'>"), y = "", e = t("<p>"); i.length > 17 ? (y = i.toString().substr(0, 17), e.append(y), v = t("<a href='javascript:void(0)' class='VIS_Pref_tooltip'>").append("..."), o = t("<span style='width: inherit;'>"), o.append(t("<img class='VIS_Pref_callout'>").attr("src", n.Application.contextUrl + "Areas/VIS/Images/email-ccc.png").append("ToolTip Text")), o.append(t("<label class='VIS_Pref_Label_Font'>").append(i)), v.append(o), e.append(v)) : e.append(i); a.append(e); a.append(t("<p>").append((Number(r) / 1024).toFixed(2) + "KB")); f.append(a); u.Name = i; u.Line_ID = 0; u.HaveSource = !1; u.Source = null; u.IsDeleted = !1; bf.push(u) }, lf = function () { var t = null, i = 0, r = 0, n; ti = 0; for (n in w) i = parseInt(w[n].size / bt), tt.size % bt > 0 && i++, ti += i, r += w[n].size, t = {}, gi.push(w[n].name), t.Name = w[n].name, t.Size = w[n].size, df.push(t); r > bt * 24 || (dr(!0), af()) }, af = function () { if ((w == null || w.length == 0) && (dr(!1), a.find(".vis-email-attachmentContainer").hide(), a.find(".vis-Email-textarea-div").height(a.find(".vis-Email-textarea-div").height() + (a.find(".vis-email-attachmentContainer").height() + 13)), window.setTimeout(function () { n.ADialog.info("NothingToUpload"); return }, 2)), ai >= w.length) { dr(!1); return } var t = new XMLHttpRequest, i = new FormData; i.append("file", w[ai].slice(rr * bt, rr * bt + Number(bt))); t.open("POST", n.Application.contextUrl + "Email/SaveAttachmentinTemp?filename=" + w[ai].name + "&folderKey=" + kr, !1); t.onload = function () { var r, i, u; if (t.readyState === t.DONE && t.status === 200) { if (t.responseText && t.responseText.indexOf("ERROR") > -1) { i = t.responseText; i = i.replace("ERROR: ", ""); for (r in w) String(i).indexOf(w[r].name) > -1 && w.splice(r, 1); n.ADialog.warn("FilesInvalidExtension", !0, t.responseText); dr(!1); IsBusy(!1); return } i = t.responseText; i = i.replace("ERROR: ", ""); yu++; rr++; u = parseInt(w[ai].size / bt); w[ai].size % bt > 0 && u++; rr == u && (ai++, rr = 0); yu <= ti && he(parseInt(yu / ti * 100)); window.setTimeout(function () { af() }, 2) } }; t.send(i) }, he = function (n) { vu.css("width", n + "%"); br.empty(); br.append(n + "%") }; or = 0; var nu = yt.getAD_Client_ID(), sr = !1, de = null, wu = 0; this.showCcBccMails = function (n, t) { n != undefined && n != null && n != "" && (fr = n); t != undefined && t != null && t != "" && (er = t) }; this.show = function () { ri = new n.ChildDialog; ri.setHeight(800); ri.setWidth(1600); ri.setTitle(n.Msg.getMsg("EMail")); ri.setModal(!0); ri.show(); ri.setContent(a); initializeComponent() }; this.disposeComponent = function () { yt = null; ri = null; si = ""; yi = 0; it = null; d || (bi != null && bi.off("click"), wi != null && wi.off("click"), lt != null && lt.off("click"), ki != null && ki.off("click"), dt != null && dt.off("click"), rt != null && rt.remove(), dt != null && dt.remove(), ot != null && ot.remove(), ct != null && ct.remove(), pi != null && pi.remove()); gt != null && gt.off("click"); et != null && et != undefined && (et.off("change"), et.off("click")); rt = null; a != null && a.remove(); a = null; g != null && g.remove(); g = null; vt != null && vt.remove(); vt = null; nr != null && nr.remove(); nr = null; dt = null; ot = null; ct = null; e && (st != null && st.remove(), st = null, k != null && k.remove(), k = null, ut != null && ut.remove(), ut = null); nt != null && nt.remove(); nt = null; pi = null; y != null && y != undefined && y.destroy(); y = null; yr != null && yr.remove(); yr = null; wi = null; gt = null; kf = null; bi = null; lt = null; ki = null; ht != null && (ht.off("click"), ht = null); ii != null && (ii = null) }; this.sizeChanged = function (n, t) { du = n; fi = t; gu == !0 && (wf(), this.leftULsize()) }; this.ShowDMSDocumentAttchment = function () { var r = null, f = null, u, i; if (lr.children().remove(), u = t("<ul><\/ul>"), n.context.getContext("DocumentAttachViaEmail_" + p.windowNo) != "") { for (ur.empty(), ur.append(n.Msg.getMsg("Documents")), r = n.context.getContext("DocumentAttachViaEmail_" + p.windowNo).split(","), i = 0; i < r.length; i++)r[i].trim() != "" && (f = r[i].split("-"), u.append("<Li><input type='checkbox' checked value='" + f[0] + "'> " + f[1] + "<\/Li>")); lr.append(u) } else ur.empty(); u.on("click", "input", function () { var r = "", e = t(this).attr("value"), o, u, i, f; if (t(this).is(":checked")) t(this).is(":checked") && (f = e + "-" + t(this).text(), r = n.context.getContext("DocumentAttachViaEmail_" + p.windowNo) + (r != "" ? "," + f : f)); else for (o = n.context.getContext("DocumentAttachViaEmail_" + p.windowNo).split(","), u = jQuery.grep(o, function (n) { if (!n.trim().contains(e.toString().trim())) return n }), i = 0; i < u.length; i++)r += i == 0 ? u[i].trim() : "," + u[i].trim(); n.context.setContext("DocumentAttachViaEmail_" + p.windowNo, r) }) }; this.IsBusy = function (n) { n ? lu.css("display", "block") : lu.css("display", "none"); lu.appendTo(a) } } i.prototype.init = function (n, t) { this.frame = t; this.windowNo = n; t.hideHeader(!0); this.initializeComponent(); this.frame.getContentGrid().append(this.getRoot()) }; i.prototype.refresh = function () { window.VADMS && this.ShowDMSDocumentAttchment(); this.leftULsize() }; i.prototype.dispose = function () { this.disposeComponent(); this.frame && this.frame.dispose(); this.frame = null }; n.Email = i }(VIS, jQuery), function (n, t) { n.Newmailformat = function (i) { function s() { var r; f = t('<div class="vis-forms-container" ><\/div>'); var i = t('<div class="vis-emailsavewrap"><\/div>'), o = t('<div class="input-group vis-input-wrap"><\/div>'), s = t('<div class="vis-control-wrap"><\/div>'), h = t("<label>" + n.Msg.getMsg("Name") + "<\/label>"); u = t('<input type="text" data-placeholder="" placeholder=" ">'); s.append(u).append(h); labelshow = t('<label class="vis-ec-col-lblchkbox"><input type="checkbox">' + n.Msg.getMsg("ForAllWindows") + "<\/label>"); e = t(labelshow.find("input")[0]); r = t('<div style="display: flex"><\/div>'); e; n.Application.isRTL; r.append(labelshow); i.append(o); o.append(s); i.append(r); f.append(i) } function h() { return u.val() == null || u.val() == "" ? (n.ADialog.info("FileNameMendatory"), !1) : (o.onClose(), !0) } function c() { f.remove(); f = null; u.remove(); u = null; e.remove(); e = null; r = null } var f, u, e, r, o = this; s(); this.show = function () { r = new n.ChildDialog; i ? r.setTitle(n.Msg.getMsg("EmailFormats")) : r.setTitle(n.Msg.getMsg("LetterFormats")); r.setModal(!0); r.setContent(f); r.show(); r.onOkClick = h; r.onClose = c }; this.getName = function () { return u.val() }; this.saveForAll = function () { return e.prop("checked") } } }(VIS, jQuery), function (n, t) { n.Openmailformat = function (i, r) { function l() { u = n.dataContext.getJSONData(n.Application.contextUrl + "Email/GetMailFormat", { Window_ID: i }, null) } function a() { var n = w2ui.openformatgrid.getSelection(); return o = w2ui.openformatgrid.get(n), h.onClose(), !0 } function v() { u = null; s = null; f = null; w2ui.openformatgrid != undefined && w2ui.openformatgrid.destroy(); e.remove() } var s, u = null, o = {}, h = this, c = [], e, f; this.onClose = null; l(); this.show = function () { var o, l, i, s, c, h; if (e = t('<div class="vis-forms-container" style="height:304px"><\/div>'), f = new n.ChildDialog, n.Application.isRTL ? f.setHeight(435) : f.setHeight(430), f.setWidth(850), r ? f.setTitle(n.Msg.getMsg("EmailFormats")) : f.setTitle(n.Msg.getMsg("LetterFormat")), f.setModal(!0), f.setContent(e), f.show(), f.onOkClick = a, f.onClose = v, o = [], l = [], u != null) { for (i in u) u[i].name == "NAME" ? o.push({ field: u[i].name, caption: n.Msg.getMsg("Name"), size: "20%", hidden: !1 }) : u[i].name == "SUBJECT" ? o.push({ field: u[i].name, caption: n.Msg.getMsg("Subject"), size: "20%", hidden: !1 }) : u[i].name == "MAILTEXT" ? o.push({ field: u[i].name, caption: n.Msg.getMsg("Mailtext"), size: "20%", hidden: !1 }) : u[i].name == "CREATED" ? o.push({ field: u[i].name, caption: n.Msg.getMsg("Created"), size: "20%", hidden: !1 }) : u[i].name == "ISDYNAMICCONTENT" ? o.push({ field: u[i].name, caption: n.Msg.getMsg("IsDynamicContent"), size: "20%", hidden: !1 }) : o.push({ field: u[i].name, caption: n.Msg.getMsg(u[i].name), size: "100px", hidden: !0 }); for (s = 0; s < u[0].RowCount; s++) { c = {}; c.recid = s; for (h in u) c[u[h].name] = u[h].name == "MAILTEXT" ? u[h].value[s] : n.Utility.encodeText(u[h].value[s]); l.push(c) } } e.w2grid({ name: "openformatgrid", recordHeight: 30, show: { selectColumn: !0 }, multiSelect: !1, columns: o, records: l }) }; this.getSelectedRow = function () { return o }; this.getAttachments = function () { return c } } }(VIS, jQuery), function (n, t) { function e(n, i, r) { var u = null; return t.ajax({ url: o, type: "POST", datatype: "json", contentType: "application/json; charset=utf-8", async: i, data: JSON.stringify(n) }).done(function (n) { u = n; r && r(n) }), u } function c(i, r, u, f, e, o, s, h) { var a = null, y = o, p = s, w = e.getAD_Window_ID(), i = i, c = new n.ReportViewer(f, e), v, l; s > 0 && c.setNodeID(s); o > 0 && c.setTreeID(o); h || c.showSummary(h); i && c.setAD_Table_ID(i); v = function (i) { var f, e, r; a = n.context.getAD_Client_ID(); r = null; f = null; e = []; try { for (r = null, t.ajax({ type: "Get", async: !1, url: n.Application.contextUrl + "Form/GetPrintFormats", data: { AD_Table_ID: i, AD_Tab_ID: u }, success: function (t) { r = (new n.DB.DataReader).toJson(t) } }); r.read();)n.Utility.Util.getValueOfInt(r.get(2).toString()) == a && (f = {}, f.Key = n.Utility.Util.getValueOfInt(r.get(0)), f.Name = r.getString(1), e.push(f)); r.close(); e.length == 0 ? f == null ? l(null, i, i) : l(f, 0, i) : l(e[0], 0, i) } catch (o) { r.close() } }; l = function (i, f, e) { var o = [], s, l; o.push(r.getTableName()); r.reportWhere && r.reportWhere != "" ? o.push(r.reportWhere) : o.push(r.getWhereClause(!0)); u && o.push(u.toString()); s = null; s = i != null ? i.Key : f; l = c.getGenerateReportPara(o, r.getCode(0), f > 0 && u > 0, p, y, h, 0, 1, "", s, w); t.ajax({ url: n.Application.contextUrl + "JsonData/GenerateReport/", dataType: "json", data: l, type: "POST", success: function (t) { t == null && alert(n.Msg.getMsg("ERRORGettingRepData")); var f = jQuery.parseJSON(t), u = f.repInfo; if (u.IsError) { n.ADialog.error(u.ErrorText); c.close(); return } u.HTML && u.HTML.length > 0 && (c.show(u.HTML, u.AD_PrintFormat_ID, i, e, o, r.getCode(0), f.pSetting), c.setReportBytes(u.Report), c.setIteration(f.pSetting.TotalPage), (n.context.ctx.$AutoArchive == "1" || n.context.ctx.$AutoArchive == "2") && c.archiveDocument(o, e, u.Report)) } }) }; v(i) } function l(i, r, u) { function ui(n) { var i = t("#reportcreate").find(".progress-bar").width() * 100 / t("#reportcreate").width(); isNaN(i) && (i = 0); i <= n && t("#reportcreate").removeClass("hide").find(".progress-bar").attr("aria-valuenow", n).css({ width: n + "%" }).text(n.toFixed(0) + "%") } function bi() { t("#reportcreateresult").removeClass().text("") } function ki(n) { bi(); t("#reportcreateresult").addClass("alert alert-success").text(n); t("#forreportdownload").removeClass("hide") } function fr() { var n = window.open(), i; n.document.write("<html ><head>"); n.document.write("<\/head><body >"); i = t(vi); t(i.children()).css({ overflow: "hidden" }); n.document.write(i.html()); n.document.write("<\/body><\/html>"); n.print(); n.close() } function er() { hi = t('<ul class="vis-statusbar-ul vis-toppaging">'); v = t('<li style="opacity: 1;"><div><i class="vis vis-shiftleft" aria-hidden="true" title="' + n.Msg.getMsg("FirstPage") + '"><\/i ><\/div ><\/li > '); y = t('<li style="opacity: 1;"><div><i class="vis vis-arrow-left" aria-hidden="true" title="' + n.Msg.getMsg("PageUp") + '"><\/i><\/div><\/li>'); e = t("<select>"); wi = t("<li>").append(e); p = t('<li style="opacity: 1;"><div><i class="vis vis-arrow-right" aria-hidden="true" title="' + n.Msg.getMsg("PageDown") + '"><\/i><\/div><\/li>'); w = t('<li style="opacity: 1;"><div><i class="vis vis-shiftright" aria-hidden="true" title="' + n.Msg.getMsg("LastPage") + '"><\/i><\/div><\/li>'); hi.append(v).append(y).append(wi).append(p).append(w); or() } function or() { v.on("click", function () { t(this).css("opacity") == "1" && ut(1) }); y.on("click", function () { t(this).css("opacity") == "1" && ut(parseInt(e.val()) - 1) }); p.on("click", function () { t(this).css("opacity") == "1" && ut(parseInt(e.val()) + 1) }); w.on("click", function () { t(this).css("opacity") == "1" && ut(parseInt(e.find("Option:last").val())) }); e.on("change", function () { ut(e.val()) }) } function li(n) { if (e.empty(), n.TotalPage > 0) { for (var i = 0; i < n.TotalPage; i++)e.append(t("<option value=" + (i + 1) + ">" + (i + 1) + "<\/option>")); e.val(n.CurrentPage); it.setIteration(n.TotalPage); n.TotalPage > n.CurrentPage ? (p.css("opacity", "1"), w.css("opacity", "1")) : (p.css("opacity", "0.6"), w.css("opacity", "0.6")); n.CurrentPage > 1 ? (v.css("opacity", "1"), y.css("opacity", "1")) : (v.css("opacity", "0.6"), y.css("opacity", "0.6")); n.TotalPage == 1 && (v.css("opacity", "0.6"), y.css("opacity", "0.6"), p.css("opacity", "0.6"), w.css("opacity", "0.6")) } else v.css("opacity", "0.6"), y.css("opacity", "0.6"), p.css("opacity", "0.6"), w.css("opacity", "0.6") } var g = t("<div class='vis-reportrootdiv'>"), d = null, wt = null, bt = null, s = null, kt = null, dt = null, gt = null, ni = null, ti = null, ht = null, ct = null, ft = null, et = null, l = null, vi = null, nt = null, ir = null, a = null, tt = null, lt = null, rr = n.Env.getScreenHeight() - 50, ei = t(window).width(), it = this, st, ur, rt, b, ci, di, gi, fi, k, ai; l = new n.CFrame; l.setName(n.Msg.getMsg("Report")); l.setTitle(n.Msg.getMsg("Report")); var oi = null, yi = t("<div>"), ot = t("<ul class='vis-apanel-rb-ul'>"); yi.append(ot); var pi = !1, c = [], ii = null, at = 0, vt = 0, si, hi, v, y, wi, p, w, e, yt = !0, h = null, ri = r.getAD_Window_ID(); this.getGenerateReportPara = function (t, r, u, f, e, o, s, c, l, v, y) { h || (h = new n.ProcessInfo("", 0, a, 0), h.setAD_User_ID(n.context.getAD_User_ID()), h.setAD_Client_ID(n.context.getAD_Client_ID())); h.setTable_ID(a); h.setAD_PInstance_ID(s); h.setPageNo(c); h.setFileType(l); h.set_AD_PrintFormat_ID(v); h.setAD_Window_ID(y); y > 0 ? h.setActionOrigin(n.ProcessCtl.prototype.ORIGIN_WINDOW) : h.setActionOrigin(n.ProcessCtl.prototype.ORIGIN_FORM); h.setOriginName(n.context.getWindowContext(i, "WindowName")); return { processInfo: h.toJson(), queryInfo: JSON.stringify(t), code: r, isCreateNew: u, treeID: e, node_ID: f, IsSummary: o } }; this.setNodeID = function (n) { at = n }; this.setTreeID = function (n) { vt = n }; this.setAD_Table_ID = function (n) { a = n }; this.showSummary = function (n) { yt = n }; this.setAD_Window_ID = function (n) { n = n }; this.setReportBytes = function (n) { ii = n }; st = 0; this.setIteration = function (n) { st = n }; this.archiveDocument = function (i, r, u) { o(!0); t.ajax({ url: n.Application.contextUrl + "JsonData/ArchiveDoc/", dataType: "json", type: "post", data: { AD_Process_ID: 0, Name: i[0], AD_Table_ID: r, Record_ID: 0, C_BPartner_ID: 0, isReport: !0, binaryData: u }, success: function () { n.ADialog.info("Archived", !0, "", ""); o(!1) } }) }; ur = function () { for (var i, r, u, n = 0; n < arguments.length; n++)i = t('<iframe style="visibility: collapse;"><\/iframe>'), t("body").append(i), r = i[0].contentDocument, u = '<form action="' + arguments[n] + '" method="GET"><\/form>', r.write(u), t("form", r).submit(), setTimeout(function (n) { return function () { n.remove() } }(i), 2e3) }; rt = ""; b = 0; this.getRoot = function () { return g }; this.dispose = function () { }; this.show = function (t, i, r, f, e, o, s) { ir = r; a = f; tt = e; nt = i; lt = o; pi = n.MRole.getDefault().getIsCanExport(a); u != !0 && (pi ? (ct.css("display", "inline-flex"), ht.css("display", "inline-flex"), n.context.ctx["#BULK_REPORT_DOWNLOAD"] == "Y" ? (et.css("display", "inline-flex"), ft.css("display", "inline-flex")) : (et.css("display", "none"), ft.css("display", "none"))) : (ct.css("display", "none"), ht.css("display", "none"), et.css("display", "none"), ft.css("display", "none"))); pt(t); s && li(s) }; ci = function () { if (u) { var n = g.children()[1]; n = null } v.off("click"); y.off("click"); p.off("click"); w.off("click"); e.off("change"); g.empty(); g.remove(); s && s.empty(); d.empty(); d.remove(); l && (l.dispose(), l = null); v = y = p = w = e = null; g = null; d = null; wt = null; bt = null; s = null; kt = null; dt = null; gt = null; ni = null; ti = null }; this.close = function () { ci() }; di = function () { d = t("<div class='vis-report-header' style='padding: 0;'>").append(t('<h3 class="vis-report-tittle">').append(n.Msg.getMsg("Report"))); wt = t('<a href="javascript:void(0)" class="vis-icon-menuclose vis vis-cross">'); bt = t('<div class="vis-report-top-icons">'); s = t('<ul class="vis-reporticonsul">'); bt.append(s); oi = t("<li><a  title='" + n.Utility.Util.cleanMnemonic(n.Msg.getMsg("ReportFormat")) + "'  class='vis vis-format'><\/a><\/li>"); s.append(oi); ct = t("<li><a  title='" + n.Utility.Util.cleanMnemonic(n.Msg.getMsg("SaveCSV")) + "' class='vis vis-save-csv'><\/a><\/li>"); s.append(ct); et = t("<li style='display:none'><a  title='" + n.Utility.Util.cleanMnemonic(n.Msg.getMsg("SaveAllRecordCsv")) + "' class='vis vis-csv-all'><\/a><\/li>"); s.append(et); ht = t("<li><a title='" + n.Utility.Util.cleanMnemonic(n.Msg.getMsg("SavePdf")) + "' class='vis vis-save-pdf'><\/a><\/li>"); s.append(ht); ft = t("<li style='display:none'><a title='" + n.Utility.Util.cleanMnemonic(n.Msg.getMsg("SaveAllPagePdf")) + "' class='vis vis-pdf-all'><\/a><\/li>"); s.append(ft); kt = t("<li><a title='" + n.Utility.Util.cleanMnemonic(n.Msg.getMsg("Archive")) + "' class='vis vis-archive'><\/a><\/li>"); s.append(kt); dt = t("<li><a title='" + n.Utility.Util.cleanMnemonic(n.Msg.getMsg("Requery")) + "' class='vis vis-refresh'><\/a><\/li>"); s.append(dt); gt = t("<li><a title='" + n.Utility.Util.cleanMnemonic(n.Msg.getMsg("Search")) + "' class='vis vis-find'><\/a><\/li>"); s.append(gt); ni = t("<li><a title='" + n.Utility.Util.cleanMnemonic(n.Msg.getMsg("PrintCustomize")) + "' class='vis vis-customize'><\/a><\/li>"); s.append(ni); ti = t('<li><a title="' + n.Utility.Util.cleanMnemonic(n.Msg.getMsg("Print")) + '" class="vis vis-print"><\/a><\/li>'); s.append(ti); si = t("<div class='vis-report-top-icons'>"); er(); si.append(hi); d.append(si); d.append(bt); d.append(wt); g.append(d); gi() }; gi = function () { wt.on("click", function () { ci() }); ti.on("click", function () { fr() }); ni.on("click", function () { var t = new n.Query; t.addRestriction("AD_PrintFormat_ID", n.Query.prototype.EQUAL, nt); n.viewManager.startWindow(240, t) }); dt.on("click", function () { k.empty(); k.css("width", "0px"); ut(e.val()) }); ht.on("click", function () { nr(e.val(), 0); null }); ct.on("click", function () { tr(e.val(), 0, null) }); ft.on("click", function () { var r, t; for (b = 0, rt = "", r = new n.BulkDownload(i, "PDF"), r.show(), t = 1; t <= st; t++)nr(t, st, r) }); et.on("click", function () { var r, t; for (b = 0, rt = "", r = new n.BulkDownload(i, "CSV"), r.show(), t = 1; t <= st; t++)tr(t, st, r) }); oi.on("click", function () { var i, r, u; for (ot.empty(), i = 0; i < c.length; i++)c[i].ID && (r = c[i].IsDefault == "Y" ? "vis-favitmchecked" : "vis-favitmunchecked", u = t('<li data-isdefbtn="no" data-id="' + c[i].ID + '"><a data-isdefbtn="no" data-id="' + c[i].ID + '">' + c[i].Name + '<\/a><a data-isdefbtn="yes" data-id="' + c[i].ID + '" style="min-height: 16px;display: inline-block;margin-left: 5px;min-width: 16px;margin-top: 0px" class="vis-menufavitm ' + r + '" > <\/a><\/li>'), ot.append(u)); ot.append(t('<li data-isdefbtn="no" data-id="-1"><a data-id="-1">' + n.Msg.getMsg("NewReport") + "<\/a>")); t(this).w2overlay(yi.clone(!0), { css: { height: "300px" } }) }); ot.on("click", "LI", function (i) { var y = t(i.target), u = y.data("id"), l, s, h, v, p; if (u) { if (y.data("isdefbtn") == "yes") { for (l = "VIS_102", s = [], s[0] = new n.DB.SqlParam("@Ad_Table_ID", a), s[1] = new n.DB.SqlParam("@AD_Tab_ID", r.getAD_Tab_ID()), f(l, s), l = "VIS_103", s = [], s[0] = new n.DB.SqlParam("@id", u), f(l, s), h = 0; h < c.length; h++)c[h].IsDefault = c[h].ID == u ? "Y" : "N"; return } nt = u; k.empty(); k.css("width", "0px"); o(!0); v = !1; u == -1 && (u = a, v = !0); p = it.getGenerateReportPara(tt, lt, v, at, vt, yt, 0, e.val(), "", u, ri); t.ajax({ url: n.Application.contextUrl + "JsonData/GenerateReport/", dataType: "json", data: p, type: "POST", success: function (t) { t == null && alert(n.Msg.getMsg("ERRORGettingRepData")); var r = jQuery.parseJSON(t), i = r.repInfo; if (i.ErrorText) { n.ADialog.error(i.ErrorText); o(!1); return } pt(i.HTML); ii = i.Report; li(r.pSetting); nt = i.AD_PrintFormat_ID; o(!1) } }) } }); gt.on("click", function () { var t = new n.Find(i, r, 0); t.onClose = function () { if (t.getIsOKPressed()) { var n = t.getQuery(), i = t.getCurrentDays(), r = t.getIsCreated(); t.dispose(); t = null; tt[1] = n.getWhereClause(!0); ut(1) } }; t.show() }); kt.on("click", function () { it.archiveDocument(tt, a, ii) }) }; var ut = function (i) { o(!0); var r = it.getGenerateReportPara(tt, lt, !1, at, vt, yt, 0, i, "", nt, ri); t.ajax({ url: n.Application.contextUrl + "JsonData/GenerateReport/", dataType: "json", data: r, type: "POST", success: function (t) { t == null && alert(n.Msg.getMsg("ERRORGettingRepData")); var r = jQuery.parseJSON(t), i = r.repInfo; if (i.ErrorText) { n.ADialog.error(i.ErrorText); o(!1); return } pt(i.HTML); ii = i.Report; li(r.pSetting); o(!1) } }) }, nr = function (i, r, u) { o(!0); var f = it.getGenerateReportPara(tt, lt, !1, at, vt, yt, 0, i, n.ProcessCtl.prototype.REPORT_TYPE_PDF, nt, ri); t.ajax({ url: n.Application.contextUrl + "JsonData/GenerateReport/", dataType: "json", data: f, type: "POST", success: function (f) { f == null && alert(n.Msg.getMsg("ERRORGettingRepData")); var s = jQuery.parseJSON(f), e = s.repInfo; if (e.ErrorText) { n.ADialog.error(e.ErrorText); o(!1); return } e.HTML && e.HTML.length > 0 ? pt(e.HTML) : r == 0 ? window.open(n.Application.contextUrl + e.ReportFilePath) : (u.setBulkBusy(!1), t("#forreportdownload").addClass("hide"), rt += '<input type="checkbox" data-num="' + i + '"  data-url="' + n.Application.contextUrl + e.ReportFilePath + '" checked />', b += 1, ui(b / r * 100), b == r && setTimeout(function () { ui(100); ki(n.Msg.getMsg("Generated")); t("<form>", { id: "download_form", html: rt, action: "#", Class: "hide" }).appendTo(document.body).submit() }, 1e3)); o(!1) } }) }, tr = function (i, r, u) { o(!0); var f = it.getGenerateReportPara(tt, lt, !1, at, vt, yt, 0, i, n.ProcessCtl.prototype.REPORT_TYPE_CSV, nt, ri); t.ajax({ url: n.Application.contextUrl + "JsonData/GenerateReport/", dataType: "json", data: f, type: "POST", success: function (f) { f == null && alert(n.Msg.getMsg("ERRORGettingRepData")); var s = jQuery.parseJSON(f), e = s.repInfo; if (e.ErrorText) { n.ADialog.error(e.ErrorText); o(!1); return } e.HTML && e.HTML.length > 0 ? pt(e.HTML) : r == 0 ? window.open(n.Application.contextUrl + e.ReportFilePath) : (u.setBulkBusy(!1), t("#forreportdownload").addClass("hide"), rt += '<input type="checkbox" data-num="' + i + '" data-url="' + n.Application.contextUrl + e.ReportFilePath + '" checked />', b += 1, ui(b / r * 100), b == r && setTimeout(function () { ui(100); ki(n.Msg.getMsg("Generated")); t("<form>", { id: "download_form", html: rt, action: "#", Class: "hide" }).appendTo(document.body).submit() }, 1e3)); o(!1) } }) }, pt = function (i) { var e, s, h, b; if (u != !0) { ot.empty(); var f = null, p = [], l = -1; try { for (t.ajax({ type: "Get", async: !1, url: n.Application.contextUrl + "Form/GetShowReportDetails", data: { AD_Table_ID: a, AD_Tab_ID: r.getAD_Tab_ID() }, success: function (t) { f = (new n.DB.DataReader).toJson(t) } }), c = []; f.read();)l = parseInt(l) + 1, e = f.getString(1), p.indexOf(e) > -1 && (e = e + "_" + (parseInt(l) + 1)), s = {}, s.ID = n.Utility.Util.getValueOfInt(f.get(0)), s.Name = e, s.IsDefault = f.getString(3), p.push(f.getString(1)), c.push(s); f.close() } catch (d) { console.log(d) } f = null; k.html(i); k.css("min-width", ei + "px"); vi = i; var w = document.getElementsByClassName("vis-reptabledetect"), v = 0, y = 0; for (h = 0, b = w.length; h < b; h++)y = t(w[h]).width(), y > v && (v = y); k.css("width", v + 50) } o(!1) }, o = function (n) { ai.css("display", n ? "block" : "none") }; di(); fi = t("<div Style='width:" + ei + "px; max-height: " + (rr - 50) + "px;' class='vis-report-a-r-container'>"); k = t("<div Style='width:" + ei + "px;'>"); fi.append(k); ai = t('<div class="vis-busyindicatorouterwrap"><div class="vis-busyindicatorinnerwrap"><i class="vis-busyindicatordiv"><\/i><\/div><\/div>'); o(!0); fi.append(ai); u || g.append(fi); l.hideHeader(!0); l.setContent(it); l.show() } function a(u, f, e, o, s, c) { function v(f) { t.ajax({ url: n.Application.contextUrl + "JsonData/GetReportFileTypes/", dataType: "json", data: { AD_Process_ID: u }, success: function (n) { var e, u, o; if (n != null && (e = jQuery.parseJSON(n), e.length != 0)) { for (u = 0; u < e.length; u++)o = "", o = u == 0 ? t("<li tabindex=" + u + " data-val=" + e[u].Key + " class='vis-selected-li-print'>" + e[u].Name + "<\/li>") : t("<li tabindex=" + u + " data-val=" + e[u].Key + ">" + e[u].Name + "<\/li>"), r.append(o), o = null; document.activeElement === document.body ? f.w2overlay(i.clone(!0), { css: { height: "300px" } }) : t(document.activeElement).w2overlay(i.clone(!0), { align: "right", css: { height: "300px" } }) } } }) } function l(i, r, h) { var c = n.ProcessCtl.prototype.ORIGIN_FORM; a > 0 && (c = n.ProcessCtl.prototype.ORIGIN_WINDOW); s && s.length != 0 ? t.ajax({ url: n.Application.contextUrl + "JsonData/GenerateMultiPrint/", dataType: "json", data: { AD_Process_ID: u, Name: "Print", AD_Table_ID: f, RecIDs: s, WindowNo: o, filetype: h, actionOrigin: c, originName: n.context.getWindowContext(o, "WindowName") }, success: function (t) { t == null && alert(n.Msg.getMsg("ERRORGettingRepData")); var i = jQuery.parseJSON(t); if (r && r(), i.IsError) { n.ADialog.error(i.ErrorText); return } i.ReportFilePath && window.open(n.Application.contextUrl + i.ReportFilePath) } }) : t.ajax({ url: n.Application.contextUrl + "JsonData/GeneratePrint/", dataType: "json", data: { AD_Process_ID: u, Name: "Print", AD_Table_ID: f, Record_ID: e, WindowNo: o, filetype: h, actionOrigin: c, originName: n.context.getWindowContext(o, "WindowName") }, success: function (t) { var i, u, e; if (t == null && alert(n.Msg.getMsg("ERRORGettingRepData")), i = jQuery.parseJSON(t), r && r(), i.IsError) { n.ADialog.error("", "", i.Message, null); return } i.ReportFilePath ? window.open(n.Application.contextUrl + i.ReportFilePath) : i.IsTelerikReport ? window.KJS && (u = new KJS.TelerikContainer(i.AD_PInstance_ID, f), u.show(), this.unlock()) : n.context.getIsUseCrystalReportViewer() && (e = new n.ReportViewerContainer(i), e.show()) } }) } var a = c == null ? 0 : c.getAD_Window_ID(); r.off("click"); r.on("click", "LI", function (n) { var i = t(n.target).data("val"); l(!1, null, i) }); this.start = function (f) { function s() { var i = t(t(t(document).find(".w2ui-overlay").find("li"))[0]), n = i.eq(0); t("#w2ui-overlay-main").attr("tabindex", 1); t("#w2ui-overlay-main").focus(); t("#w2ui-overlay-main").keydown(function (r) { if (r.which === 40) n ? (n.hasClass("vis-selected-li-print") && n.removeClass("vis-selected-li-print"), next = n.next(), n = next.length > 0 ? next.addClass("vis-selected-li-print") : i.eq(0).addClass("vis-selected-li-print")) : n = i.eq(0).addClass("vis-selected-li-print"); else if (r.which === 38) n ? (n.hasClass("vis-selected-li-print") && n.removeClass("vis-selected-li-print"), next = n.prev(), n = next.length > 0 ? next.addClass("vis-selected-li-print") : i.last().addClass("vis-selected-li-print")) : n = i.last().addClass("vis-selected-li-print"); else if (r.which === 13) { if (n) { var u = n.data("val"); l(!1, null, u); t("#w2ui-overlay-main").off("keydown"); t("#w2ui-overlay-main").remove() } } else t("#w2ui-overlay-main").off("keydown"), t("#w2ui-overlay-main").remove(); return r.stopPropagation(), !1 }) } var e = [], o; if (e[0] = new n.DB.SqlParam("@AD_Process_ID", u), o = h("VIS_149", e), o == "Y" && n.context.getIsUseCrystalReportViewer()) { l(!1, null, n.ProcessCtl.prototype.REPORT_TYPE_PDF); return } r.find("LI").length > 0 ? (document.activeElement === document.body ? f.w2overlay(i.clone(!0), { css: { height: "300px" } }) : t(document.activeElement).w2overlay(i.clone(!0), { css: { height: "300px" }, align: "right" }), window.setTimeout(function () { s() }, 100)) : (v(f), window.setTimeout(function () { s() }, 100)) }; this.startPdf = function (t) { l(!1, t, n.ProcessCtl.prototype.REPORT_TYPE_PDF) }; this.startCsv = function (t) { l(!0, t, n.ProcessCtl.prototype.REPORT_TYPE_CSV) } } function v(i) { var r = t('<div class="vis-reportrootdiv"> '), u = t('<div class="vis-busyindicatorouterwrap bsyCrsyVwr"><div class="vis-busyindicatorinnerwrap"><i class="vis-busyindicatordiv"><\/i><\/div><\/div>'), f; this.getRoot = function () { return r }; this.addReport = function () { r.append(u); f(!0); var e = t("<iframe style = 'width:100%;height:99.4%;' pluginspage='http://www.adobe.com/products/acrobat/readstep2.html'>"); i.pi && i.pi.getAD_PInstance_ID() ? e.attr("src", n.Application.contextUrl + "Areas/VIS/WebPages/CrystalReprotViewer.aspx?title=rpt&aid=" + i.pi.getAD_PInstance_ID() + "&pid=" + i.pi.getAD_Process_ID() + "&tid=" + i.pi.getTable_ID() + "&rid=" + i.pi.getRecord_ID()) : e.attr("src", n.Application.contextUrl + "Areas/VIS/WebPages/CrystalReprotViewer.aspx?title=rpt&aid=" + i.AD_PInstance_ID + "&pid=" + i.AD_Process_ID + "&tid=" + i.AD_Table_ID + "&rid=" + i.RecordID); r.append(e) }; this.dispose = function () { r.remove(); r = null }; f = function (n) { u.css("display", n ? "block" : "none") }; this.show = function () { var t = new n.CFrame; t.setName(n.Msg.getMsg("Report")); t.setTitle(n.Msg.getMsg("Report")); t.setContent(this); this.addReport(); t.show() } } var i = t('<div class="vis-reportrootdiv">'), r = t("<ul class='vis-apanel-rb-ul'  style='width:100%;height:100%'>"); i.append(r); var u = n.Application.contextUrl, o = u + "JsonData/JDataSetWithCode", s = u + "JsonData/ExecuteNonQuer", y = function (t, i, r) { var o = r ? !0 : !1, f = { sql: t, page: 1, pageSize: 0 }, u; return i && (f.param = i), u = null, e(f, o, function (t) { u = (new n.DB.DataReader).toJson(t); r && r(u) }), u }, f = function (n, i, r) { var f = r ? !0 : !1, u = null, e = { sql: n, param: i }; return t.ajax({ url: s + "yWithCode", type: "POST", datatype: "json", contentType: "application/json; charset=utf-8", async: f, data: JSON.stringify(e) }).done(function (n) { u = n; r && r(n) }), u }, h = function (t, i, r) { var f = r ? !0 : !1, o = { sql: t, page: 1, pageSize: 0 }, u; return i && (o.param = i), u = null, e(o, f, function (t) { i = (new n.DB.DataSet).toJson(t); var i = (new n.DB.DataSet).toJson(t); u = i.getTable(0).getRows().length > 0 ? i.getTable(0).getRow(0).getCell(0) : null; i.dispose(); i = null; f && r(u) }), u }; n.ReportViewer = l; n.AReport = c; n.APrint = a; n.ReportViewerContainer = v }(VIS, jQuery), function (n, t) { n.AttachmentHistory = function (i, r, u, f, e) { function ye() { o = t('<div class="vis-busyindicatorouterwrap"><div class="vis-busyindicatorinnerwrap"><i class="vis-busyindicatordiv"><\/i><\/div><\/div>'); o[0].style.visibility = "hidden"; kr.append(o) } function pe() { kr = t('<div class="vis-forms-container" style="height:100%">'); d = t('<div class="vis-history-inboxDiv">'); yt = t('<div style="display:none" class="vis-history-mainRelatedDiv">'); gi = t('<div style="display:none" class="vis-history-mainRelatedDiv">'); dr = t('<div class="vis-attachhistory-content-wrap">'); yu = t('<div class="vis-attachhistory-left-wrap">'); gr = t('<div class="vis-attachhistory-table-top">'); nr = t('<div class="vis-attachhistory-search-wrap">'); du = t('<div class="vis-attachhistory-search">').append(' <input placeholder="' + n.Msg.getMsg("Search") + '" type="text">').append('<span class="vis-attachhistory-search-icon vis vis-search"><\/span>'); nr.append('<i class="prthistory vis vis-print" title="' + n.Msg.getMsg("Print") + '"><\/i>').append(du); v = t('<div class="vis-attachhistory-right-wrap">'); k = t('<div class="vis-attachhistory-right-wrap">').hide(); bu == !0 ? k.append('<label class="vis-attachhistory-noRecFoundforIP" > ' + n.Msg.getMsg("NoRecordFound") + " <\/label>") : k.append('<label class="vis-attachhistory-noRecFound" > ' + n.Msg.getMsg("NoRecordFound") + " <\/label>"); pu = t('<div class="vis-attachhistory-apanel-tabcontrol">'); tr = t('<ul class="vis-attachhistory-appsaction-ul vis-attachhistory-apanel-tabcontrol-ul">'); tr.append('<li data-type="History" class="vis-attachhistory-apanel-tab-selected" style="opacity: 1;">' + n.Msg.getMsg("History") + '<\/li><li  data-type="RelatedHistory"  style="opacity: 1;">' + n.Msg.getMsg("RelatedHistory") + "<\/li>"); u > 0 && tr.append('<li  data-type="UserHistory"  style="opacity: 1;">' + n.Msg.getMsg("UserHistory") + "<\/li>"); gr.append(pu.append(tr)); wu = t('<div class="vis-attachhistory-table-wrap">').append(d).append(yt).append(gi).append(ou); kr.append(dr.append(yu.append(gr).append(wu))); dr.append(nr).append(v).append(k); ht = nr.find("input"); ve = du.find(".prthistory"); ni = t('<ul class="vis-his-attachs">'); oi = t('<ul class="vis-his-attachs">'); ku = t("<ul class='vis-apanel-rb-ul'>"); ku.append('<li style="display:none" data-type="R"><a><span class="vis-attachhistory-email-icon vis-attachhistory-reply-icon"><\/span>' + n.Msg.getMsg("Reply") + '<\/a><\/li> <li data-type="F"><a><span class="vis-attachhistory-email-icon vis-attachhistory-forword-icon vis vis-undo2"><\/span>' + n.Msg.getMsg("Forward") + "<\/a><\/li>") } function we() { ou = t('<ul style="margin-top:10px" class="vis-statusbar-ul pull-right">'); et = t('<li style="opacity: 1;"><div><i class="vis vis-shiftleft" style="opacity: 0.6;"><\/i><\/div><\/li>'); ot = t('<li style="opacity: 1;"><div><i class="vis vis-pageup" style="opacity: 0.6;"><\/i><\/div><\/li>'); gt = t('<li><select class="vis-statusbar-combo"><\/select><\/li>'); lt = t('<li style="opacity: 1;"><div><i class="vis vis-pagedown" style="opacity: 0.6;"><\/i><\/div><\/li>'); ct = t('<li style="opacity: 1;"><div><i class="vis vis-shiftright" style="opacity: 0.6;"><\/i><\/div><\/li>'); ou.append(et).append(ot).append(gt).append(lt).append(ct) } function re(u) { var e, f; for (o[0].style.visibility = "visible", t.ajax({ url: n.Application.contextUrl + "AttachmentHistory/LoadRecordDataCount", datatype: "json", async: !1, type: "get", cache: !1, data: { searchText: u, _AD_Table_ID: i, _Record_ID: r }, success: function (n) { uf = JSON.parse(n) } }), e = parseInt(uf / li), ui = e + (uf % li > 0 ? 1 : 0), it = 1, s = gt.find("select"), s.empty(), f = 1; f <= ui; f++)s.append("<option>" + f + "<\/option>"); et.css("opacity", "0.6"); ot.css("opacity", "0.6") } function sr(u) { t.ajax({ url: n.Application.contextUrl + "AttachmentHistory/LoadRecordData", datatype: "json", type: "get", async: !1, cache: !1, data: { searchText: u, _AD_Table_ID: i, _Record_ID: r, historyPageNo: it, pageSize: li }, success: function (n) { n = JSON.parse(n); de(n) }, error: function () { } }) } function hr(i) { (i == undefined || i == null) && (i = ""); t.ajax({ url: n.Application.contextUrl + "AttachmentHistory/RelatedHistory", datatype: "json", type: "get", cache: !1, data: { keyColumnID: r, pageSize: li, pageNo: nt, searchText: n.Utility.encodeText(i), keyColName: e }, success: function (n) { var i = JSON.parse(n), r, t; if (ke(i), fu == undefined || fu == 0 || di == !0) { for (fu = i.TotalRecords, r = parseInt(fu / li), nt = 1, fi = r + (fu % li > 0 ? 1 : 0), s = gt.find("select"), s.empty(), t = 1; t <= fi; t++)s.append("<option>" + t + "<\/option>"); et.css("opacity", "0.6"); ot.css("opacity", "0.6"); no() } else to(); o[0].style.visibility = "hidden"; di = !1 }, error: function (n) { console.log(n); o[0].style.visibility = "hidden"; di = !1 } }) } function cr(i) { (i == undefined || i == null) && (i = ""); t.ajax({ url: n.Application.contextUrl + "AttachmentHistory/UserHistory", datatype: "json", type: "get", cache: !1, data: { C_BPartner_ID: u, pageSize: li, pageNo: tt, searchText: n.Utility.encodeText(i) }, success: function (n) { var i = JSON.parse(n), r, t; if (i.RHistory != null && be(i), eu == undefined || eu == 0 || di == !0) { for (eu = i.TotalRecords, r = parseInt(eu / li), tt = 1, ei = r + (eu % li > 0 ? 1 : 0), s = gt.find("select"), s.empty(), t = 1; t <= ei; t++)s.append("<option>" + t + "<\/option>"); et.css("opacity", "0.6"); ot.css("opacity", "0.6"); ge() } else io(); o[0].style.visibility = "hidden"; di = !1 }, error: function (n) { console.log(n); o[0].style.visibility = "hidden"; di = !1 } }) } function be(i) { var u, f, e, r; for (bt = [], vi = [], u = i.RHistory, bt.push({ field: "ID", caption: n.Msg.getMsg("id"), size: "150px", hidden: !0 }), bt.push({ field: "Record_ID", caption: n.Msg.getMsg("record_id"), size: "150px", hidden: !0 }), bt.push({ field: "Created", caption: n.Msg.getMsg("Date"), size: "150px", hidden: !1 }), bt.push({ field: "Type", caption: n.Msg.getMsg("Type"), size: "150px", hidden: !1 }), n.Application.isRTL ? bt.push({ field: "TableName", caption: n.Msg.getMsg("Table"), size: "150px", hidden: !1, resizable: !0, style: "text-align: right", render: function (n) { var i = t('<i class="findImg vis vis-find" data-ids="' + n.Record_ID + "-" + n.AD_Table_ID + '" ><\/i>'), r = t("<div >").append(i).append(n.TableName); return r.html() } }) : bt.push({ field: "TableName", caption: n.Msg.getMsg("Table"), size: "150px", hidden: !1, resizable: !0, style: "text-align: left", render: function (n) { var i = t('<i class="findImg vis vis-find" data-ids="' + n.Record_ID + "-" + n.AD_Table_ID + '" ><\/i>'), r = t("<div >").append(i).append(n.TableName); return r.html() } }), bt.push({ field: "Subject", caption: n.Msg.getMsg("Subject"), size: "150px", hidden: !1 }), bt.push({ field: "UserName", caption: n.Msg.getMsg("UserName"), size: "150px", hidden: !1 }), u.length > 0 && (y = Object.keys(u[0])), r = 0; r < y.length; r++)if (y[r] == "ID" || y[r] == "Record_ID" || y[r] == "Created" || y[r] == "Type" || y[r] == "TableName" || y[r] == "Subject" || y[r] == "UserName") continue; else bt.push({ field: y[r], caption: n.Msg.getMsg(y[r]), size: "100px", hidden: !0 }); for (f = 0; f < u.length; f++) { for (e = {}, e.recid = f, r = 0; r < y.length; r++)y[r] == "Created" ? e[y[r]] = new Date(u[f][y[r]]).toLocaleString() : y[r] == "Type" ? u[f][y[r]] == "A" ? e[y[r]] = n.Msg.getMsg("Appointment") : u[f][y[r]] == "T" ? e[y[r]] = n.Msg.getMsg("Task") : u[f][y[r]] == "L" ? e[y[r]] = n.Msg.getMsg("Letter") : u[f][y[r]] == "M" ? e[y[r]] = n.Msg.getMsg("SentMail") : (u[f][y[r]] == "Z" || u[f][y[r]] == "I") && (e[y[r]] = n.Msg.getMsg("InboxMail")) : e[y[r]] = n.Utility.encodeText(u[f][y[r]]); vi.push(e) } } function ke(i) { var u, f, e, r; for (dt = [], ai = [], u = i.RHistory, dt.push({ field: "ID", caption: n.Msg.getMsg("id"), size: "150px", hidden: !0 }), dt.push({ field: "Record_ID", caption: n.Msg.getMsg("record_id"), size: "150px", hidden: !0 }), dt.push({ field: "Created", caption: n.Msg.getMsg("Date"), size: "150px", hidden: !1 }), dt.push({ field: "Type", caption: n.Msg.getMsg("Type"), size: "150px", hidden: !1 }), n.Application.isRTL ? dt.push({ field: "TableName", caption: n.Msg.getMsg("Table"), size: "150px", hidden: !1, resizable: !0, style: "text-align: right", render: function (n) { var i = t('<i class="findImg vis vis-find" data-ids="' + n.Record_ID + "-" + n.AD_Table_ID + '"><\/i>'), r = t("<div >").append(i).append(n.TableName); return r.html() } }) : dt.push({ field: "TableName", caption: n.Msg.getMsg("Table"), size: "150px", hidden: !1, resizable: !0, style: "text-align: left", render: function (n) { var i = t('<i class="findImg vis vis-find" data-ids="' + n.Record_ID + "-" + n.AD_Table_ID + '"><\/i>'), r = t("<div >").append(i).append(n.TableName); return r.html() } }), dt.push({ field: "Subject", caption: n.Msg.getMsg("Subject"), size: "150px", hidden: !1 }), u.length > 0 && (h = Object.keys(u[0])), r = 0; r < h.length; r++)if (h[r] == "ID" || h[r] == "Record_ID" || h[r] == "Created" || h[r] == "Type" || h[r] == "TableName" || h[r] == "Subject") continue; else dt.push({ field: h[r], caption: n.Msg.getMsg(h[r]), size: "100px", hidden: !0 }); for (f = 0; f < u.length; f++) { for (e = {}, e.recid = f, r = 0; r < h.length; r++)h[r] == "Created" ? e[h[r]] = new Date(u[f][h[r]]).toLocaleString() : h[r] == "Type" ? u[f][h[r]] == "A" ? e[h[r]] = n.Msg.getMsg("Appointment") : u[f][h[r]] == "T" ? e[h[r]] = n.Msg.getMsg("Task") : u[f][h[r]] == "L" ? e[h[r]] = n.Msg.getMsg("Letter") : u[f][h[r]] == "M" ? e[h[r]] = n.Msg.getMsg("SentMail") : u[f][h[r]] == "I" && (e[h[r]] = n.Msg.getMsg("InboxMail")) : e[h[r]] = n.Utility.encodeText(u[f][h[r]]); ai.push(e) } } function de(t) { var i, u, r, f; for (wt = [], si = [], wt.push({ field: "id", caption: n.Msg.getMsg("id"), size: "150px", hidden: !0 }), wt.push({ field: "record_id", caption: n.Msg.getMsg("record_id"), size: "150px", hidden: !0 }), wt.push({ field: "created", caption: n.Msg.getMsg("Date"), size: "150px", hidden: !1 }), wt.push({ field: "type", caption: n.Msg.getMsg("Type"), size: "150px", hidden: !1 }), wt.push({ field: "name", caption: n.Msg.getMsg("CreatedBy"), size: "150px", hidden: !1 }), bu == !0 ? wt.push({ field: "subject", caption: n.Msg.getMsg("Subject"), size: "150px", hidden: !1 }) : wt.push({ field: "subject", caption: n.Msg.getMsg("Subject"), size: "230px", hidden: !1 }), t.length > 0 && (h = Object.keys(t[0])), i = 0; i < t.length; i++) { for (u = {}, u.recid = i, r = 0; r < h.length; r++)f = h[r], u[f] = h[r] == "created" ? new Date(t[i][f]).toLocaleString() : n.Utility.encodeText(t[i][f]); si.push(u) } } function ge() { b != undefined && b != null && (b.destroy(), b = null); b = gi.w2grid({ name: "userhistorygrid", recordHeight: 30, show: { toolbar: !0 }, multiSelect: !1, columns: bt, records: vi }); b.on("select", br); b.on("search", wr); vi.length > 0 ? (b.select(0), k.hide(), v.show()) : (k.show(), v.hide()); t(".findImg").on("click", function (i) { var r = t(i.target).data("ids").split("-"); n.AEnv.zoom(r[1], r[0]) }) } function no() { p != undefined && p != null && (p.destroy(), p = null); p = yt.w2grid({ name: "realtedhistorygrid", recordHeight: 30, show: { toolbar: !0 }, multiSelect: !1, columns: dt, records: ai }); p.on("select", br); p.on("search", wr); ai.length > 0 ? (p.select(0), k.hide(), v.show()) : (k.show(), v.hide()); t(".findImg").on("click", function (i) { var r = t(i.target).data("ids").split("-"); n.AEnv.zoom(r[1], r[0]) }) } function yr() { ut.destroy(); ut = null; ut = d.w2grid({ name: "historyinboxgrid", recordHeight: 30, show: { toolbar: !0 }, multiSelect: !1, columns: wt, records: si }); ut.on("select", br); ut.on("search", wr); si.length > 0 ? (ut.select(0), k.hide(), v.show()) : (k.show(), v.hide()); o[0].style.visibility = "hidden"; o[0].style.visibility = "hidden" } function to() { p.destroy(); p = null; p = yt.w2grid({ name: "realtedhistorygrid", recordHeight: 30, show: { toolbar: !0 }, multiSelect: !1, columns: dt, records: ai }); p.on("select", br); p.on("search", wr); ai.length > 0 ? (p.select(0), k.hide(), v.show()) : (k.show(), v.hide()); o[0].style.visibility = "hidden"; t(".findImg").off("click"); t(".findImg").on("click", function (i) { var r = t(i.target).data("ids").split("-"); n.AEnv.zoom(r[1], r[0]) }) } function io() { b.destroy(); b = null; b = gi.w2grid({ name: "userhistorygrid", recordHeight: 30, show: { toolbar: !0 }, multiSelect: !1, columns: bt, records: vi }); b.on("select", br); b.on("search", wr); vi.length > 0 ? (b.select(0), k.hide(), v.show()) : (k.show(), v.hide()); o[0].style.visibility = "hidden"; t(".findImg").off("click"); t(".findImg").on("click", function (i) { var r = t(i.target).data("ids").split("-"); n.AEnv.zoom(r[1], r[0]) }) } function ro() { tr.on("click", lo); nr.find("input").on("keydown", fe); nr.find("i").on("click", fo); ni.on("click", po); oi.on("click", wo); v.on("keydown", ce); v.on("click", ce); lt.on("click", eo); ot.on("click", oo); gt.on("change", so); et.on("click", ho); ct.on("click", co); ku.on(n.Events.onTouchStartOrClick, "LI", function (n) { var i = t(this).data("type"); uo(i, n) }) } function uo(t) { var f = null, u; t == "R" || t == "F" && (f = new n.Email("", null, null, r, !0, !0, i, hi.html(), ar.text(), pf)); u = new n.CFrame; u.setName(n.Msg.getMsg("EMail")); u.setTitle(n.Msg.getMsg("EMail")); u.hideHeader(!0); u.setContent(f); u.show(); f.initializeComponent(); kt.close() } function fo() { g != undefined && g.is(":visible") == !0 ? (t(".vis-attachhistory-right-row > ul > li").css("float", "left"), t(".vis-attachhistory-right-row > ul").css("height", "auto"), ue(g.html()), t(".vis-attachhistory-right-row > ul > li").css("float", "none"), t(".vis-attachhistory-right-row > ul").css("height", "45px")) : l != undefined && l.is(":visible") == !0 && (t(".vis-attachhistory-right-row > ul > li").css("float", "left"), t(".vis-attachhistory-right-row > ul").css("height", "auto"), t(t(".vis-attachhistory-to").find("p")).text(t(t(".vis-attachhistory-to").find("p")).text().replace(/;/g, "; ")), t(t(".vis-attachhistory-bcc").find("p")).text(t(t(".vis-attachhistory-bcc").find("p")).text().replace(/;/g, "; ")), t(t(".vis-attachhistory-cc").find("p")).text(t(t(".vis-attachhistory-cc").find("p")).text().replace(/;/g, "; ")), ue(l.html()), t(".vis-attachhistory-right-row > ul > li").css("float", "none"), t(".vis-attachhistory-right-row > ul").css("height", "45px"), t(t(".vis-attachhistory-to").find("p")).text(t(t(".vis-attachhistory-to").find("p")).text().replace(/; /g, ";")), t(t(".vis-attachhistory-bcc").find("p")).text(t(t(".vis-attachhistory-bcc").find("p")).text().replace(/; /g, ";")), t(t(".vis-attachhistory-cc").find("p")).text(t(t(".vis-attachhistory-cc").find("p")).text().replace(/; /g, ";"))) } function ue(t) { var i = window.open(), r = '<link rel="stylesheet" href="' + n.Application.contextUrl + 'Areas/VIS/Content/VIS.all.min.css" />'; i.document.write(r + t); setTimeout(function () { i.print(); i.close() }, 300) } function fe(n) { (n.keyCode == undefined || n.keyCode == 13) && ht != undefined && ht != null && (di = !0, d.is(":visible") ? (o[0].style.visibility = "visible", re(ht.val()), sr(ht.val()), ne = ht.val(), yr()) : yt.is(":visible") ? (o[0].style.visibility = "visible", hr(ht.val()), te = ht.val()) : (o[0].style.visibility = "visible", cr(ht.val()), ie = ht.val())) } function eo() { d.is(":visible") ? (it < ui && (o[0].style.visibility = "visible", it++, s.val(it), sr(), yr()), pr()) : yt.is(":visible") ? nt < fi && (o[0].style.visibility = "visible", nt++, s.val(nt), hr(), lu()) : tt < ei && (o[0].style.visibility = "visible", tt++, s.val(tt), cr(), au()) } function oo() { d.is(":visible") ? (it > 1 && (o[0].style.visibility = "visible", it--, s.val(it), sr(), yr()), pr()) : yt.is(":visible") ? (nt > 1 && (o[0].style.visibility = "visible", nt--, s.val(nt), hr()), lu()) : (tt > 1 && (o[0].style.visibility = "visible", tt--, s.val(tt), cr()), au()) } function so() { d.is(":visible") ? (o[0].style.visibility = "visible", it = s.val(), sr(), yr(), pr()) : yt.is(":visible") ? (o[0].style.visibility = "visible", nt = s.val(), hr(), lu()) : (o[0].style.visibility = "visible", tt = s.val(), cr(), au()) } function ho() { d.is(":visible") ? (o[0].style.visibility = "visible", it = 1, s.val(it), sr(), yr(), pr()) : yt.is(":visible") ? (o[0].style.visibility = "visible", nt = 1, s.val(nt), hr(), lu()) : (o[0].style.visibility = "visible", tt = 1, s.val(tt), cr(), au()) } function co() { d.is(":visible") ? (o[0].style.visibility = "visible", it = ui, s.val(it), sr(), yr(), pr()) : yt.is(":visible") ? (o[0].style.visibility = "visible", nt = fi, s.val(nt), hr(), lu()) : (o[0].style.visibility = "visible", tt = ei, s.val(tt), cr(), au()) } function pr() { it == 1 && it < ui ? (et.css("opacity", "0.6"), ot.css("opacity", "0.6"), lt.css("opacity", "1"), ct.css("opacity", "1")) : it > 1 && it < ui ? (et.css("opacity", "1"), ot.css("opacity", "1"), lt.css("opacity", "1"), ct.css("opacity", "1")) : it == ui && ui == 1 ? (et.css("opacity", "0.6"), ot.css("opacity", "0.6"), lt.css("opacity", "0.6"), ct.css("opacity", "0.6")) : it == ui && (et.css("opacity", "1"), ot.css("opacity", "1"), lt.css("opacity", "0.6"), ct.css("opacity", "0.6")) } function lu() { nt == 1 && nt < fi ? (et.css("opacity", "0.6"), ot.css("opacity", "0.6"), lt.css("opacity", "1"), ct.css("opacity", "1")) : nt > 1 && nt < fi ? (et.css("opacity", "1"), ot.css("opacity", "1"), lt.css("opacity", "1"), ct.css("opacity", "1")) : nt == fi && fi == 1 ? (et.css("opacity", "0.6"), ot.css("opacity", "0.6"), lt.css("opacity", "0.6"), ct.css("opacity", "0.6")) : nt == fi && (et.css("opacity", "1"), ot.css("opacity", "1"), lt.css("opacity", "0.6"), ct.css("opacity", "0.6")) } function au() { tt == 1 && tt < ei ? (et.css("opacity", "0.6"), ot.css("opacity", "0.6"), lt.css("opacity", "1"), ct.css("opacity", "1")) : tt > 1 && tt < ei ? (et.css("opacity", "1"), ot.css("opacity", "1"), lt.css("opacity", "1"), ct.css("opacity", "1")) : tt == ei && ei == 1 ? (et.css("opacity", "0.6"), ot.css("opacity", "0.6"), lt.css("opacity", "0.6"), ct.css("opacity", "0.6")) : tt == ei && (et.css("opacity", "1"), ot.css("opacity", "1"), lt.css("opacity", "0.6"), ct.css("opacity", "0.6")) } function lo(i) { var f = t(i.target).data("type"), r; if (f == "History") { for ((ht != "undefined" || ht != null) && ht.val(ne), s = gt.find("select"), s.empty(), r = 1; r <= ui; r++)s.append("<option>" + r + "<\/option>"); pr(); d.show(); gi.hide(); yt.hide(); s.val(it); si.length > 0 ? (ut.select(0), ut.refresh(), k.hide(), v.show()) : (k.show(), v.hide()) } else if (f == "RelatedHistory") { for ((ht != "undefined" || ht != null) && ht.val(te), s = gt.find("select"), s.empty(), r = 1; r <= fi; r++)s.append("<option>" + r + "<\/option>"); p == undefined || p == null ? (o[0].style.visibility = "visible", hr(), s.val(nt)) : (v.find("*").show(), ai.length > 0 && (p.select(0), p.refresh(), s.val(nt))); t(".findImg").on("click", function (i) { var r = t(i.target).data("ids").split("-"); n.AEnv.zoom(r[1], r[0]) }); ai.length > 0 ? (p.select(0), k.hide(), v.show()) : (k.show(), v.hide()); d.hide(); gi.hide(); yt.show() } else if (f == "UserHistory") { if ((ht != "undefined" || ht != null) && ht.val(ie), u == null || u == 0) { n.ADialog.info("BPartnerNotFound"); return } for (s = gt.find("select"), s.empty(), r = 1; r <= ei; r++)s.append("<option>" + r + "<\/option>"); b == undefined || b == null ? (o[0].style.visibility = "visible", cr(), s.val(tt)) : (v.find("*").show(), vi.length > 0 && (b.select(0), b.refresh(), s.val(tt))); t(".findImg").on("click", function (i) { var r = t(i.target).data("ids").split("-"); n.AEnv.zoom(r[1], r[0]) }); vi.length > 0 ? (b.select(0), k.hide(), v.show()) : (k.show(), v.hide()); d.hide(); yt.hide(); gi.show() } t(i.target).addClass("vis-attachhistory-apanel-tab-selected"); t(i.target).siblings("li").removeClass("vis-attachhistory-apanel-tab-selected") } function wr(n) { n.onComplete = function () { d.is(":visible") ? ut.last.searchIds.length > 0 && ut.select(ut.last.searchIds[0]) : p.last.searchIds.length > 0 && p.select(p.last.searchIds[0]) } } function br(i) { var r; if (o[0].style.visibility = "visible", r = i.target == "historyinboxgrid" ? ut.get(i.recid) : i.target == "realtedhistorygrid" ? p.get(i.recid) : b.get(i.recid), t(".vis-attachhistory-view-comments").text(n.Msg.getMsg("ViewMoreComments")), r.type == n.Msg.getMsg("Appointment") || r.Type == "Appointment" || r.type == n.Msg.getMsg("Task") || r.Type == "Task" ? g != undefined && g.is(":visible") == !1 && (t(st[0].children[0]).hide(), g.show()) : r.type == n.Msg.getMsg("VA048_CallType") || r.Type == "Call" ? rt != undefined && rt.is(":visible") == !1 && (t(at[0].children[0]).hide(), rt.show()) : l != undefined && l.is(":visible") == !1 && (t(ft[0].children[0]).hide(), l.show()), r.type != undefined) switch (r.type) { case n.Msg.getMsg("Appointment"): lr(r.id); window.setTimeout(function () { w = r.id; c = !0; a = !1; pt(w, c, a) }, 200); break; case n.Msg.getMsg("Task"): lr(r.id); window.setTimeout(function () { w = r.id; c = !0; a = !1; pt(w, c, a) }, 200); break; case n.Msg.getMsg("SentMail"): ee(r.id); window.setTimeout(function () { w = r.id; c = !1; a = !1; pt(w, c, a) }, 200); break; case n.Msg.getMsg("InboxMail"): oe(r.id); window.setTimeout(function () { w = r.id; c = !1; a = !1; pt(w, c, a) }, 200); break; case n.Msg.getMsg("Letter"): se(r.id); window.setTimeout(function () { w = r.id; c = !1; a = !1; pt(w, c, a) }, 200); break; case n.Msg.getMsg("VA048_CallType"): he(r.id); window.setTimeout(function () { w = r.id; c = !1; a = !0; pt(w, c, a) }, 200) } else switch (r.Type) { case n.Msg.getMsg("Appointment"): lr(r.ID); window.setTimeout(function () { w = r.ID; c = !0; a = !1; pt(w, c, a) }, 200); break; case n.Msg.getMsg("Task"): lr(r.ID); window.setTimeout(function () { w = r.ID; c = !0; a = !1; pt(w, c, a) }, 200); break; case n.Msg.getMsg("SentMail"): ee(r.ID); window.setTimeout(function () { lr(r.ID); w = r.ID; c = !1; a = !1; pt(w, c, a) }, 200); break; case n.Msg.getMsg("InboxMail"): oe(r.ID); window.setTimeout(function () { lr(r.ID); w = r.ID; c = !1; a = !1; pt(w, c, a) }, 200); break; case n.Msg.getMsg("Letter"): se(r.ID); window.setTimeout(function () { lr(r.ID); w = r.ID; c = !1; a = !1; pt(w, c, a) }, 200); break; case n.Msg.getMsg("VA048_CallType"): he(r.ID); window.setTimeout(function () { w = r.ID; c = !1; a = !0; pt(w, c, a) }, 200) } } function lr(t) { var i = n.dataContext.getJSONData(n.Application.contextUrl + "AttachmentHistory/GetAppointmentData", { AppQry: t }, null), f, r, u; if (i != null) { if (f = 0, f = d.is(":visible") ? 0 : i.AD_Table_ID + "-" + i.Record_ID, strApp = "", r = i.AttendeeInfo, r != null && r != "" && (names = n.dataContext.getJSONData(n.Application.contextUrl + "AttachmentHistory/GetUser", { UserQry: r }, null), names != null && names.length > 0)) { for (strApp = "", u = 0; u < names.length; u++)strApp += names[u] + ", "; strApp = strApp.substring(0, strApp.length - 2) } yo(t, i.Location, i.Description, i.label, i.StartDate, i.EndDate, i.Allday, "", i.comments, f, i.Subject, i.caname, "", i.AppointmentsInfo_ID, strApp) } else o[0].style.visibility = "hidden" } function ee(i) { t.ajax({ url: n.Application.contextUrl + "AttachmentHistory/LoadSentMails", datatype: "json", type: "get", cache: !1, data: { ID: i }, success: function (n) { var t = JSON.parse(n), r = 0; r = d.is(":visible") ? 0 : t.AD_Table_ID + "-" + t.Record_ID; wf(i, t.Title, t.To, t.From, t.Date, t.Detail, t.Bcc, t.Cc, t.Comments, t.IsMail, t.IsLetter, t.Attach, r, t.ID) } }) } function oe(i) { t.ajax({ url: n.Application.contextUrl + "AttachmentHistory/LoadInboxMails", datatype: "json", type: "get", cache: !1, data: { ID: i }, success: function (n) { var t = JSON.parse(n), r = 0; r = d.is(":visible") ? 0 : t.AD_Table_ID + "-" + t.Record_ID; wf(i, t.Title, t.To, t.From, t.Date, t.Detail, t.Bcc, t.Cc, t.Comments, t.IsMail, t.IsLetter, t.Attach, r, t.ID) } }) } function se(i) { t.ajax({ url: n.Application.contextUrl + "AttachmentHistory/LoadLetters", datatype: "json", type: "get", cache: !1, data: { ID: i }, success: function (n) { var t = JSON.parse(n), r = 0; r = d.is(":visible") ? 0 : t.AD_Table_ID + "-" + t.Record_ID; wf(i, t.Title, "", "", t.Date, t.Detail, "", "", t.Comments, !1, !0, t.Attach, r, t.ID) } }) } function he(i) { t.ajax({ url: n.Application.contextUrl + "AttachmentHistory/LoadCall", datatype: "json", type: "get", cache: !1, data: { ID: i }, success: function (t) { var r = JSON.parse(t), u = 0; u = d.is(":visible") ? 0 : r.AD_Table_ID + "-" + r.Record_ID; ao(i, r.VA048_IsConference, r.VA048_From, r.VA048_To, r.VA048_Duration, r.VA048_Price, r.VA048_Price_Unit, r.VA048_Status, r.VA048_CallNotes, r.Created, r.AD_Table_ID, r.Record_ID, u, n.Msg.getMsg("VA048_CallType"), "", r.VA048_FullName, r.Attach) } }) } function ao(i, r, u, f, e, s, h, c, l, a, y, p, w, b, k, d, g) { var e, tt, it, ut, et, ot, nt; if (ft != undefined && ft.hide(), st != undefined && st.hide(), e = e >= 60 ? vo(e) : e + " " + n.Msg.getMsg("VA048_Seconds"), ki == undefined || ki == null || ki == "") { if (ki = t("<p>" + n.Utility.encodeText(u) + "<\/p>"), ti = t("<p>" + n.Utility.encodeText(f) + "<\/p>"), ff = t("<p>" + n.Utility.encodeText(e) + "<\/p>"), ef = t("<p>" + n.Utility.encodeText(c) + "<\/p>"), of = t("<p>" + n.Utility.encodeText(s) + "<\/p>"), sf = t("<p>" + n.Utility.encodeText(h) + "<\/p>"), hf = t(" <p>" + n.Utility.encodeText(new Date(a).toLocaleString()) + "<\/p>"), or = t("<p>" + n.Utility.encodeText(b) + "<\/p>"), cf = t('<p style="max-height:120px;overflow-y: scroll;">' + n.Utility.encodeText(l) + "<\/p>"), af = t("<p>" + n.Utility.encodeText(d) + "<\/p>"), lf = t("<p>" + (r == "Y" ? n.Msg.getMsg("VA048_Conference") : n.Msg.getMsg("VA048_CallType")) + "<\/p>"), vt = t('<i class=" vis vis-find" data-ids="' + w + '">'), w == 0 ? vt.hide() : vt.show(), at = t('<div class="vis-attachhistory-right-content">'), rt = t('<div class="vis-attachhistory-grid-data" >'), tt = t('<div style="float:left;width:100%;margin-bottom:10px"><\/div>').append(t('<div class="vis-attachhistory-right-row2">').append(t("<h6>" + n.Msg.getMsg("Title") + ' <i class="fa fa-phone"><\/i><\/h6>').append(vt)).append(lf)).append(t('<div class="vis-attachhistory-right-row3" style="margin-right: 4px;" >').append("<h6>" + n.Msg.getMsg("User") + "<\/h6> ").append(af)), rt.append(tt), it = t('<div style="float:left;width:100%;margin-bottom:10px" ><\/div>').append(t('<div class="vis-attachhistory-right-row2">').append(t("<h6>" + n.Msg.getMsg("VA048_From") + "<\/h6>")).append(ki)).append(t('<div class="vis-attachhistory-right-row3" style="margin-right: 4px;" >').append("<h6>" + n.Msg.getMsg("VA048_To") + "<\/h6> ").append(ti)), rt.append(it), ut = t('<div style="float:left;width:100%;margin-bottom:10px" ><\/div>').append(t('<div class="vis-attachhistory-right-row2"> ').append("<h6>" + n.Msg.getMsg("VA048_Duration") + "<\/h6> ").append(ff)).append(t('<div class="vis-attachhistory-right-row3" style="margin-right: 4px;" >').append("<h6>" + n.Msg.getMsg("VA048_Status") + "<\/h6>").append(ef)), rt.append(ut), et = t('<div style="float:left;width:100%;margin-bottom:10px" ><\/div>').append(t('<div class="vis-attachhistory-right-row2">').append("<h6>" + n.Msg.getMsg("VA048_Price") + "<\/h6>").append(of)).append(t('<div class="vis-attachhistory-right-row3" style="margin-right: 4px;" >').append("<h6>" + n.Msg.getMsg("VA048_PriceUnit") + "<\/h6> ").append(sf)), rt.append(et), ot = t('<div style="float:left;width:100%;margin-bottom:10px" ><\/div>').append(t('<div class="vis-attachhistory-right-row2">').append("<h6>" + n.Msg.getMsg("Created") + "<\/h6>").append(hf)).append(t('<div class="vis-attachhistory-right-row3" style="margin-right: 4px;" >').append("<h6>" + n.Msg.getMsg("Category") + "<\/h6> ").append(or)), rt.append(ot), rt.append(t('<div class="vis-attachhistory-right-row" style="margin-bottom:20px;margin-right: 4px;">').append("<h6>" + n.Msg.getMsg("VA048_Notes") + "<\/h6> ").append(cf)), rt.append(t('<div class="vis-attachhistory-right-row">').append("<h6>" + n.Msg.getMsg("Attachments") + "<\/h6>")), g != undefined && g.length > 0) for (nt = 0; nt < g.length; nt++)oi.append('<li><span class="vis-attachhistory-attach-download"><i class="fa fa-long-arrow-down"><\/i><\/span><a data-attid="' + g[nt].AttID + '" data-id="' + g[nt].ID + '">' + n.Utility.encodeText(g[nt].Name) + "<\/a><\/li>"); else rt.find(".vis-attachhistory-right-row").last().hide(); rt.find(".vis-attachhistory-right-row").last().append(oi); (bi == undefined || bi == null) && (bi = t('<input type="text" placeholder="' + n.Msg.getMsg("TypeComment") + '"><\/input>')); yf = t('<div class="vis-attachhistory-bottom"><\/div>'); vf = t('<div class="vis-attachhistory-comments vis-feedMessage"><\/div>'); vf.append(bi).append('<span class="vis-attachhistory-comment-icon vis vis-sms"><\/span>'); yf.append(t('<div class="vis-attachhistory-right-row" style="margin-top:0px">').append(vf).append('<p class="vis-attachhistory-view-comments">' + n.Msg.getMsg("ViewMoreComments") + "<\/p>")); at.append('<div style="display:none" class="vis-attachhistory-grid-data">').append(rt).append(yf); cu = t('<div class="vis-attachhistory-right-row" >'); rt.append(cu); v.append(at); vt.on("click", function (i) { var r = t(i.target).data("ids").split("-"); n.AEnv.zoom(r[0], r[1]) }) } else { if (at.show(), ki.text(n.Utility.encodeText(u)), ti.text(n.Utility.encodeText(f)), ff.text(n.Utility.encodeText(e)), ef.text(n.Utility.encodeText(c)), of.text(n.Utility.encodeText(s)), sf.text(n.Utility.encodeText(h)), hf.text(n.Utility.encodeText(new Date(a).toLocaleString())), or.text(n.Utility.encodeText(b)), cf.text(n.Utility.encodeText(l)), af.text(n.Utility.encodeText(d)), lf.text(n.Utility.encodeText(r == "Y" ? n.Msg.getMsg("VA048_Conference") : n.Msg.getMsg("VA048_CallType"))), g != undefined && g.length > 0) { for (oi.empty(), nt = 0; nt < g.length; nt++)oi.append('<li><span class="vis-attachhistory-attach-download"><i class="fa fa-long-arrow-down"><\/i><\/span><a data-attid="' + g[nt].AttID + '" data-id="' + g[nt].ID + '">' + n.Utility.encodeText(g[nt].Name) + "<\/a><\/li>"); t(oi.parent()).show() } else t(oi.parent()).hide(); vt.data("ids", w); w == 0 ? vt.hide() : vt.show(); t(at[0].children[0]).hide() } t(".vis-attachhistory-view-comments").off("click"); t(".vis-attachhistory-view-comments").on("click", function () { bf(i, !1, !0, this) }); k != undefined ? bi.val(n.Utility.encodeText(k)) : bi.val(""); t(".vis-attachhistory-comment-icon").data("ID", i); o[0].style.visibility = "hidden" } function vo(t) { var f = ~~(t / 3600), r = ~~(t % 3600 / 60), u = t % 60, i = ""; return f > 0 && (i += "" + hrs + ":" + (r < 10 ? "0" : "")), i += "" + r + ":" + (u < 10 ? "0" : ""), i += "" + u, i + " " + n.Msg.getMsg("VA048_Minutes") } function wf(i, r, u, f, e, s, h, y, p, w, b, k, d, g) { var nt; if (st != undefined && st.hide(), at != undefined && at.hide(), c = !1, a = !1, rr == undefined || rr == null) { if (ar = t("<p>" + n.Utility.encodeText(r) + "<\/p>"), ti = t("<p>" + n.Utility.encodeText(u) + "<\/p>"), ur = t("<p>" + n.Utility.encodeText(h) + "<\/p>"), fr = t("<p>" + n.Utility.encodeText(y) + "<\/p>"), ir = t(" <p>" + n.Utility.encodeText(f) + "<\/p>"), rr = t("<p>" + n.Utility.encodeText(e) + "<\/p>"), ci = t('<a class="vis-attachhistory-email-dropdown fa fa-ellipsis-v" tabindex=""><\/a>'), (hi == undefined || hi == null) && (hi = t('<p class="vis-attachhistory-detail"><\/p>')), hi.html(s), (ii == undefined || ii == null) && (ii = t('<input type="text" placeholder="' + n.Msg.getMsg("TypeComment") + '"><\/input>')), yi = t('<i class="vis vis-email"><\/i>'), pi = t('<i class="vis vis-find pull-right" data-ids="' + d + '" ><\/i>'), ft = t('<div class="vis-attachhistory-right-content">'), l = t('<div class="vis-attachhistory-grid-data">'), l.append(t('<div class="vis-attachhistory-right-row2">').append(t("<h6>" + n.Msg.getMsg("Title") + "<\/h6>").append(yi)).append(ar)), l.append(t('<div class="vis-attachhistory-right-row3"><\/div>').append(ci).append(pi)), b == !0 && l.find(".vis-attachhistory-right-row").last().hide(), b == !0 && l.append(t('<div class="vis-attachhistory-right-row3">').append(rr)), d == 0 ? pi.hide() : pi.show(), w == !0 ? yi.removeClass("vis vis-letter").addClass("vis vis-email") : b == !0 && yi.removeClass("vis vis-email").addClass("vis vis-letter"), l.append(t('<div class="vis-attachhistory-right-row vis-attachhistory-to">').append("<h6>" + n.Msg.getMsg("To") + "<\/h6> ").append(ti)), (u == "undefined" || u == null || u == "" || b == !0) && l.find(".vis-attachhistory-right-row").last().hide(), l.append(t('<div value="bccDiv" class="vis-attachhistory-right-row  vis-attachhistory-bcc">').append("<h6>" + n.Msg.getMsg("Bcc") + "<\/h6> ").append(ur)), (h == "undefined" || h == null || h == "" || b == !0) && l.find(".vis-attachhistory-right-row").last().hide(), l.append(t('<div  value="ccDiv"  class="vis-attachhistory-right-row vis-attachhistory-cc">').append("<h6>" + n.Msg.getMsg("Cc") + "<\/h6> ").append(fr)), (y == "undefined" || y == null || y == "" || b == !0) && l.find(".vis-attachhistory-right-row").last().hide(), l.append(t('<div class="vis-attachhistory-right-row">').append("<h6>" + n.Msg.getMsg("From") + "<\/h6>").append(ir)), l.append(t('<div class="vis-attachhistory-right-row">').append("<h6>" + n.Msg.getMsg("Attachments") + "<\/h6>")), k != undefined && k.length > 0) for (nt = 0; nt < k.length; nt++)ni.append('<li><span class="vis-attachhistory-attach-download"><i class="fa fa-long-arrow-down"><\/i><\/span><a data-IDs="' + k[nt].ID + '">' + n.Utility.encodeText(k[nt].Name) + "<\/a><\/li>"); else l.find(".vis-attachhistory-right-row").last().hide(); l.find(".vis-attachhistory-right-row").last().append(ni); su = t('<div class="vis-attachhistory-right-row">'); l.append(t('<div class="vis-attachhistory-right-row">').append("<h6>" + n.Msg.getMsg("Details") + "<\/h6>").append(hi)).append(su); nu = t('<div class="vis-attachhistory-bottom"><\/div>'); gu = t('<div class="vis-attachhistory-comments vis-feedMessage"><\/div>'); gu.append(ii).append('<span class="vis-attachhistory-comment-icon vis vis-sms"><\/span>'); nu.append(t('<div class="vis-attachhistory-right-row" style="margin-top:0px">').append(gu).append('<p class="vis-attachhistory-view-comments" style="float:right;width:auto">' + n.Msg.getMsg("ViewMoreComments") + "<\/p>")); ft.append('<div style="display:none" class="vis-attachhistory-grid-data">').append(l).append(nu); nr.parent() != undefined ? v.append(ft) : v.append(ft); pi.on("click", function (i) { var r = t(i.target).data("ids").split("-"); n.AEnv.zoom(r[0], r[1]) }) } else { if (ft.show(), t(ft[0].children[0]).hide(), (ci == undefined || ci == null) && (ci = t('<a class="vis-attachhistory-email-dropdown fa fa-ellipsis-v" tabindex=""><\/a>')), w == !0 ? (yi.removeClass("vis vis-letter").addClass("vis vis-email"), ci.show()) : b == !0 && (yi.removeClass("vis vis-email").addClass("vis vis-letter"), ci.hide()), ar.text(n.Utility.encodeText(r)), u == "undefined" || u == null && u == "" || b == !0 ? t(ti.parent()).hide() : (ti.text(n.Utility.encodeText(u)), t(ti.parent()).show()), h == "undefined" || h == null || h == "" || b == !0 ? t(ur.parent()).hide() : (ur.text(n.Utility.encodeText(h)), t(ur.parent()).show()), y == "undefined" || y == null || y == "" || b == !0 ? t(fr.parent()).hide() : (fr.text(n.Utility.encodeText(y)), t(fr.parent()).show()), b == !0 ? t(ir.parent()).hide() : (ir.text(n.Utility.encodeText(f)), t(ir.parent()).show()), pi.data("ids", d), d == 0 ? pi.hide() : pi.show(), rr.text(n.Utility.encodeText(e)), k != undefined && k.length > 0) { for (ni.empty(), nt = 0; nt < k.length; nt++)ni.append('<li><span class="vis-attachhistory-attach-download"><i class="fa fa-long-arrow-down"><\/i><\/span><a  data-IDs="' + k[nt].ID + '">' + n.Utility.encodeText(k[nt].Name) + "<\/a><\/li>"); t(ni.parent()).show() } else t(ni.parent()).hide(); hi.html(s) } t(".vis-attachhistory-view-comments").off("click"); t(".vis-attachhistory-view-comments").on("click", function () { bf(g, !1, !1, this) }); if (w) { pf = g; ci.show(); t(".vis-attachhistory-email-dropdown").off("click"); t(".vis-attachhistory-email-dropdown").on("click", function () { t(this).w2overlay(ku.clone(!0), { css: { height: "300px" } }) }) } else ci.hide(); t(".vis-attachhistory-comment-icon").data("ID", i); p != undefined ? ii.val(n.Utility.encodeText(p)) : ii.val(""); o[0].style.visibility = "hidden" } function yo(i, r, u, f, e, s, h, l, y, p, w, b, k, d, nt) { var tt, it, rt; if (ft != undefined && ft.hide(), at != undefined && at.hide(), c = !0, a = !1, wi == undefined || wi == null) { ru = t("<p>" + n.Utility.encodeText(r) + "<\/p>"); iu = t("<p>" + n.Utility.encodeText(w) + "<\/p>"); er = t("<p>" + n.Utility.encodeText(u) + "<\/p>"); or = t("<p>" + n.Utility.encodeText(b) + "<\/p>"); tf = t("<p>" + n.Utility.encodeText(nt) + "<\/p>"); rf = t("<p>" + n.Utility.encodeText(f) + "<\/p>"); wi = e.indexOf("Z") > 0 ? t("<p>" + n.Utility.encodeText(new Date(e).toLocaleString()) + "<\/p>") : t("<p>" + n.Utility.encodeText(new Date(e + "Z").toLocaleString()) + "<\/p>"); vr = s.indexOf("Z") > 0 ? t(" <p>" + n.Utility.encodeText(new Date(s).toLocaleString()) + "<\/p>") : t(" <p>" + n.Utility.encodeText(new Date(s + "Z").toLocaleString()) + "<\/p>"); uu = t("<p>" + n.Utility.encodeText(h) + "<\/p>"); (ri == undefined || ri == null) && (ri = t('<input type="text" placeholder="' + n.Msg.getMsg("TypeComment") + '"><\/input>')); vt = t('<i class=" vis vis-find" data-ids="' + p + '" >'); st = t('<div class="vis-attachhistory-right-content">'); g = t('<div class="vis-attachhistory-grid-data" >'); tt = t('<div style="float:left;width:100%" ><\/div>'); tt.append(t('<div class="vis-attachhistory-right-row2">').append(t("<h6>" + n.Msg.getMsg("Title") + ' <i class="vis vis-appointment"><\/i><\/h6>').append(vt)).append(iu)); p == 0 ? vt.hide() : vt.show(); tt.append(t('<div class="vis-attachhistory-right-row3"  style="margin-bottom:11px" >').append("<h6>" + n.Msg.getMsg("Location") + "<\/h6> ").append(ru)); (r == "undefined" || r == null && r == "") && g.find(".vis-attachhistory-right-row").last().hide(); g.append(tt); it = t('<div style="float:left;width:100%" ><\/div>'); it.append(t('<div  class="vis-attachhistory-right-row2"> ').append("<h6>" + n.Msg.getMsg("StartDate") + "<\/h6> ").append(wi)); it.append(t('<div class="vis-attachhistory-right-row3"  style="margin-bottom:11px" >').append("<h6>" + n.Msg.getMsg("EndDate") + "<\/h6>").append(vr)); g.append(it); rt = t('<div style="float:left;width:100%" ><\/div>'); rt.append(t('<div class="vis-attachhistory-right-row2">').append("<h6>" + n.Msg.getMsg("AllDay") + "<\/h6>").append(uu)); rt.append(t('<div class="vis-attachhistory-right-row3"  style="margin-bottom:11px" >').append("<h6>" + n.Msg.getMsg("Category") + "<\/h6> ").append(or)); g.append(rt); g.append(t('<div class="vis-attachhistory-right-row">').append("<h6>" + n.Msg.getMsg("Contacts") + "<\/h6> ").append(tf)); hu = t('<div class="vis-attachhistory-right-row" >'); g.append(t('<div class="vis-attachhistory-right-row">').append("<h6>" + n.Msg.getMsg("Description") + "<\/h6> ").append(er)).append(hu); (u == "undefined" || u == null && u == "") && g.find(".vis-attachhistory-right-row").last().hide(); tu = t('<div class="vis-attachhistory-bottom"><\/div>'); nf = t('<div class="vis-attachhistory-comments vis-feedMessage"><\/div>'); nf.append(ri).append('<span class="vis-attachhistory-comment-icon vis vis-sms"><\/span>'); tu.append(t('<div class="vis-attachhistory-right-row" style="margin-top:0px">').append(nf).append('<p class="vis-attachhistory-view-comments">' + n.Msg.getMsg("ViewMoreComments") + "<\/p>")); st.append('<div style="display:none" class="vis-attachhistory-grid-data">').append(g).append(tu); v.append(st); vt.on("click", function (i) { var r = t(i.target).data("ids").split("-"); n.AEnv.zoom(r[0], r[1]) }) } else st.show(), iu.text(n.Utility.encodeText(w)), ru.text(n.Utility.encodeText(r)), u == "undefined" || u == null || u == "" ? t(er.parent()).hide() : (er.text(n.Utility.encodeText(u)), t(er.parent()).show()), tf.text(n.Utility.encodeText(nt)), b == "undefined" || b == null || b == "" ? or.text(n.Utility.encodeText("")) : or.text(n.Utility.encodeText(b)), vt.data("ids", p), p == 0 ? vt.hide() : vt.show(), wi.text(n.Utility.encodeText(new Date(e).toLocaleString())), vr.text(n.Utility.encodeText(new Date(s).toLocaleString())), uu.text(n.Utility.encodeText(h)), t(st[0].children[0]).hide(); t(".vis-attachhistory-view-comments").off("click"); t(".vis-attachhistory-view-comments").on("click", function () { bf(d, !0, !1, this) }); y != undefined ? ri.val(n.Utility.encodeText(y)) : ri.val(""); t(".vis-attachhistory-comment-icon").data("ID", i); o[0].style.visibility = "hidden" } function bf(i, r, u, f) { r == !0 ? g.is(":visible") ? (t.ajax({ url: n.Application.contextUrl + "AttachmentHistory/ViewChatonHistory", datatype: "json", type: "POST", cache: !1, data: { record_ID: i, isAppointment: r, isCall: u }, success: function (n) { var t = JSON.parse(n); kf(t, r, u) }, error: function () { n.ADialog.error("RecordNotSaved") } }), t(f).text(n.Msg.getMsg("HideComments"))) : (g.show(), t(st[0].children[0]).hide(), t(f).text(n.Msg.getMsg("ViewMoreComments"))) : u == !0 ? rt.is(":visible") ? (t.ajax({ url: n.Application.contextUrl + "AttachmentHistory/ViewChatonHistory", datatype: "json", type: "POST", cache: !1, data: { record_ID: i, isAppointment: r, isCall: u }, success: function (n) { var t = JSON.parse(n); kf(t, r, u) }, error: function () { n.ADialog.error("RecordNotSaved") } }), t(f).text(n.Msg.getMsg("HideComments"))) : (rt.show(), t(at[0].children[0]).hide(), t(f).text(n.Msg.getMsg("ViewMoreComments"))) : l.is(":visible") ? (t.ajax({ url: n.Application.contextUrl + "AttachmentHistory/ViewChatonHistory", datatype: "json", type: "POST", cache: !1, data: { record_ID: i, isAppointment: r, isCall: u }, success: function (n) { var t = JSON.parse(n); kf(t, r, u) }, error: function () { n.ADialog.error("RecordNotSaved") } }), t(f).text(n.Msg.getMsg("HideComments"))) : (l.show(), t(ft[0].children[0]).hide(), t(f).text(n.Msg.getMsg("ViewMoreComments"))) } function vu(t, i) { return t += '   <div class="vis-attachhistory-comment-data"><div class="vis-attachhistory-comment-detail vis-feedDetails-cmnt">', t += i.UserImage != "NoRecordFound" && i.UserImage != "FileDoesn'tExist" && i.UserImage != null ? '<img  class="userAvatar-Feeds"  src="' + i.UserImage + "?" + new Date + '">' : '<i class="fa fa-user userAvatar-Feeds"><\/i>', t += '<div class="vis-attachhistory-comment-text">', t += i.CreatedBy == n.Env.getCtx().getAD_User_ID() ? "<h6>" + n.Msg.getMsg("Me") + " <\/h6>" : "<h6>" + i.UserName + "<\/h6>", t + (" <p>" + i.CharacterData + '<\/p><\/div><div class="vis-attachhistory-comment-dateTime"><p>' + new Date(i.Created).toLocaleString() + "<\/p><\/div><\/div><\/div>") } function kf(n, i, r) { var u, f; if (n.length > 0) { for (u = ' <div class="vis-attachhistory-comments-container">', f = 0; f < n.length; f++)u = vu(u, n[f]); u += "<\/div>" } r == !0 ? rt.is(":visible") ? (t(at[0].children[0]).show(), t(at[0].children[0]).empty(), t(at[0].children[0]).append(u), rt.hide()) : (rt.show(), t(at[0].children[0]).hide()) : i == !0 ? g.is(":visible") ? (t(st[0].children[0]).show(), t(st[0].children[0]).empty(), t(st[0].children[0]).append(u), g.hide()) : (g.show(), t(st[0].children[0]).hide()) : l.is(":visible") ? (t(ft[0].children[0]).show(), t(ft[0].children[0]).empty(), t(ft[0].children[0]).append(u), l.hide()) : (l.show(), t(ft[0].children[0]).hide()) } function po(i) { var r = i.target, f = "", u = ""; (t(r).is("a") ? (f = t(r).text(), u = t(r).data("ids")) : t(r).is("i") ? (f = t(t(r).parent()).siblings().text(), u = t(t(r).parent()).siblings().data("ids")) : t(r).is("span") && (f = t(r).siblings().text(), u = t(r).siblings().data("ids")), u != null && u != 0) && (o[0].style.visibility = "hidden", t.ajax({ url: n.Application.contextUrl + "AttachmentHistory/DownloadAttachment", datatype: "json", type: "get", cache: !1, data: { ID: u, Name: f }, success: function (t) { var i = JSON.parse(t), r = n.Application.contextUrl + "TempDownload/" + i; window.open(r); o[0].style.visibility = "hidden" } })) } function wo(i) { var r = i.target, f = "", u = "", e = ""; (t(r).is("a") ? (f = t(r).text(), e = t(r).data("attid"), u = t(r).data("id")) : t(r).is("img") ? (f = t(t(r).parent()).siblings().text(), e = t(t(r).parent()).siblings().data("attid"), u = t(t(r).parent()).siblings().data("id")) : t(r).is("span") && (f = t(r).siblings().text(), e = t(r).siblings().data("attid"), u = t(t(r).parent()).siblings().data("id")), u != null && u != 0) && (o[0].style.visibility = "hidden", t.ajax({ url: n.Application.contextUrl + "AttachmentHistory/DownloadAttachmentCall", datatype: "json", type: "get", cache: !1, data: { AttID: e, ID: u, Name: f }, success: function (t) { var i = JSON.parse(t), r; i != null && i != "" ? (r = n.Application.contextUrl + "TempDownload/" + i, window.open(r)) : n.ADialog.error("AttachmentNotFound"); o[0].style.visibility = "hidden" } })) } function ce(i) { var f = i.target, r, u; (i.keyCode == undefined || i.keyCode == 13) && (i.keyCode != undefined || t(f).hasClass("vis-attachhistory-comment-icon")) && (r = 0, r = t(".vis-attachhistory-comment-icon").data("ID"), r != 0) && (u = "", u = c == !0 ? ri.val() : a == !0 ? bi.val() : ii.val(), u.length != 0) && t.ajax({ url: n.Application.contextUrl + "AttachmentHistory/SaveComment", datatype: "json", type: "POST", cache: !1, data: { ID: r, Text: u, isAppointment: c, isCall: a }, success: function (n) { var f = JSON.parse(n), r = !0, i, u; if (a == !0 ? (bi.val(""), rt.is(":visible") && (r = !1)) : c == !0 ? (ri.val(""), g.is(":visible") && (r = !1)) : (ii.val(""), l.is(":visible") && (r = !1)), r == !0) { if (f.length > 0) { for (i = ' <div class="vis-attachhistory-comments-container">', u = 0; u < f.length; u++)i = vu(i, f[u]); i += "<\/div>" } c == !0 ? (t(st[0].children[0]).empty(), t(st[0].children[0]).append(i)) : a == !0 ? (t(at[0].children[0]).empty(), t(at[0].children[0]).append(i)) : (t(ft[0].children[0]).empty(), t(ft[0].children[0]).append(i)) } else pt(w, c, a) }, error: function () { n.ADialog.error("RecordNotSaved") } }) } function pt(i, r, u) { t.ajax({ url: n.Application.contextUrl + "AttachmentHistory/ViewChatonLastHistory", datatype: "json", type: "POST", cache: !1, data: { record_ID: i, isAppointment: r, isCall: u }, success: function (n) { var f = JSON.parse(n), t, i; if (f.length > 0) if (r) for (t = '<div style="height:88px"><\/div>', hu.empty(), i = 0; i < f.length; i++)t = vu(t, f[i]), hu.append(t); else if (u) for (t = "<div><\/div>", cu.empty(), i = 0; i < f.length; i++)t = vu(t, f[i]), cu.append(t); else for (t = '<div style="height:120px"><\/div>', su.empty(), i = 0; i < f.length; i++)t = vu(t, f[i]), su.append(t); else u ? cu.empty() : r ? hu.empty() : su.empty() } }) } var le = n.Env.getWindowNo(), ae = n.Env.getCtx(), wt = [], si = [], h = [], dt = [], ai = [], c, bt = [], vi = [], y = [], kt, kr, d, ut, yt, p, b, gi, df = this, dr, yu, du, nr, gr, pu, tr, wu, v, ft, st, g, nu, tu, k, gu, nf, l, ni, ar, ti, ir, gf, hi, rr, ii, ur, fr, yi, ri, pi, vt, ci, iu, ru, er, or, tf, rf, wi, vr, uu, o, li = 50, it, nt, uf, fu, eu, ui, fi, ei, tt, ou, et, ct, lt, ot, gt, s, ht, ve, bu, ne, te, ie, ku, su, hu, at, rt, bi, ff, ef, of, sf, hf, cf, lf, af, vf, yf, a, oi, cu, ki, di, w, pf; this.initializeComponent = function () { bu = /ipad|iphone|ipod/i.test(navigator.userAgent.toLowerCase()); it = 1; nt = 1; tt = 1; we(); pe(); ye(); re(); sr(); ro() }; this.displayInboxDiv = function () { ut = d.w2grid({ name: "historyinboxgrid", recordHeight: 30, show: { toolbar: !0 }, multiSelect: !1, columns: wt, records: si }); ut.on("select", br); ut.on("search", wr); si.length > 0 ? (ut.select(0), k.hide(), v.show()) : (k.show(), v.hide()); o[0].style.visibility = "hidden"; t(".vis-attachhistory-search-icon").on("click", fe) }; di = !1; w = 0; pf = 0; this.getRoot = function () { return kr }; this.show = function () { kt = new n.ChildDialog; this.initializeComponent(); kt.setContent(kr); bu == !0 ? (kt.setHeight(650), kt.setWidth(800)) : (kt.setHeight(650), kt.setWidth(1e3)); kt.setTitle(n.Msg.getMsg("History")); kt.setModal(!0); kt.show(); kt.hideButtons(); this.displayInboxDiv(); kt.onClose = function () { df.dispose() } }; this.dispose = function () { le = 0; ae = null; wt = []; wt = null; si = []; si = null; h = []; h = null; dr != null && dr.remove(); yu != null && yu.remove(); gr != null && gr.remove(); pu != null && pu.remove(); tr != null && tr.remove(); wu != null && wu.remove(); v != null && v.remove(); ft != null && ft.remove(); st != null && st.remove(); g != null && g.remove(); nu != null && nu.remove(); tu != null && tu.remove(); k != null && k.remove(); l != null && l.remove(); ni != null && ni.remove(); oi != null && oi.remove(); ar != null && ar.remove(); ti != null && ti.remove(); ir != null && ir.remove(); ki != null && ki.remove(); gf != null && gf.remove(); hi != null && hi.remove(); rr != null && rr.remove(); ii != null && ii.remove(); ur != null && ur.remove(); fr != null && fr.remove(); yi != null && yi.remove(); ri != null && ri.remove(); ru != null && ru.remove(); iu != null && iu.remove(); er != null && er.remove(); rf != null && rf.remove(); wi != null && wi.remove(); vr != null && vr.remove(); uu != null && uu.remove(); o != null && o.remove(); ou != null && ou.remove(); et != null && et.remove(); ct != null && ct.remove(); lt != null && lt.remove(); ot != null && ot.remove(); gt != null && gt.remove(); s != null && s.remove(); d != null && d != undefined && d.remove(); d = null; ut != null && ut != undefined && ut.destroy(); ut = null; w2ui.historyinboxgrid != undefined && w2ui.historyinboxgrid.destroy(); p != null && p != undefined && p.destroy(); p = null; w2ui.realtedhistorygrid != undefined && w2ui.realtedhistorygrid.destroy(); b != null && b != undefined && b.destroy(); b = null; w2ui.userhistorygrid != undefined && w2ui.userhistorygrid.destroy(); df = null } } }(VIS, jQuery), function (n, t) { function r() { var k = null, d = null, p = null, ft = null, g = null, w = null, et = null, ot = null, wt = null, bt = null, st = null, kt = null, o = null, s = null, ht = null, h = null, ii = null, ct = null, c = null, ri = null, lt = null, l = null, ui = null, at = null, a = null, fi = null, vt = null, nt = null, tt = null, ei = null, yt = null, it = null, rt = null, e = null, f = null, li = null, ai = null, pt = null, v = null, oi = null, y = null, r = null, u = -1, b = !1; this.Load = function (i, r) { k = i; d = r; et = t("<div class='vis-rad-recordData'>"); e = t("<button  class='vis-rad-navBtn' disabled='disabled'>").append(t("<i class='fa fa-caret-down'><\/i>")); f = t("<button  class='vis-rad-navBtn' disabled='disabled'>").append(t("<i class='fa fa-caret-up'><\/i>")); vt = t("<div class='vis-rad-actionIcons' >"); nt = t("<button  class='vis-rad-actionBtn'>").append(t("<i class='vis vis-plus'><\/i>")); yt = t("<div class='vis-rad-btnWrap' >"); rt = t("<a href = 'javascript:void(0)'  class='vis-rad-buttons VIS_Pref_btn-2'>").append(n.Msg.getMsg("Cancel")); ei = t("<span class='vis-rad-paging'>").append(y); h = t("<input type='checkbox' checked >"); ii = t("<label>").append(n.Msg.translate(n.Env.getCtx(), "IsActive")); c = t("<input type='checkbox' checked >"); ri = t("<label>").append(n.Msg.translate(n.Env.getCtx(), "IsExclude")); l = t("<input type='checkbox'>"); ui = t("<label>").append(n.Msg.translate(n.Env.getCtx(), "IsReadOnly")); a = t("<input type='checkbox'>"); fi = t("<label>").append(n.Msg.translate(n.Env.getCtx(), "IsDependentEntities")); v = t("<input type='checkbox'>"); oi = t("<label>").append(n.Msg.translate(n.Env.getCtx(), "IncludeNull")); p = t("<div class='vis-forms-container'>"); ft = t("<div class='vis-forms-container vis-rad-contantWrap'>"); g = t("<div class='vis-rad-contantTop'>"); wt = t("<div class='vis-rad-roleCombo'>"); bt = t("<div class='input-group vis-input-wrap'>"); st = t("<div class='vis-control-wrap'>"); kt = t("<label>").append(n.Msg.translate(n.Env.getCtx(), "AD_Role_ID")); o = t("<select class='vis-custom-select'>"); wt.append(bt); bt.append(st); st.append(o); st.append(kt); s = t("<div class='vis-rad-recordOp'>"); ht = t("<div class='vis-rad-check'>"); ht.append(h); ht.append(ii); s.append(ht); ct = t("<div class='vis-rad-check'>"); ct.append(c); ct.append(ri); s.append(ct); lt = t("<div class='vis-rad-check'>"); lt.append(l); lt.append(ui); s.append(lt); at = t("<div class='vis-rad-check'>"); at.append(a); at.append(fi); s.append(at); pt = t("<div class='vis-rad-check'>"); pt.append(v); pt.append(oi); s.append(pt); et.append(wt); et.append(s); g.append(et); ot = t("<div class='vis-rad-navIcons'>"); ot.append(e); ot.append(f); g.append(ot); w = t("<div class='vis-rad-contantBottom'>"); tt = t("<button  class='vis-rad-actionBtn'>").append(t("<i class='vis vis-delete'><\/i>")); vt.append(nt); vt.append(tt); w.append(vt); y = t("<lable>"); w.append(ei); it = t("<a href = 'javascript:void(0)'  class='vis-rad-buttons VIS_Pref_btn-2'>").append(n.Msg.getMsg("Ok")); yt.append(rt); yt.append(it); w.append(yt); ft.append(g); ft.append(w); p.append(ft); si(); dt(); gt(); p.dialog({ width: 600, height: 232, resizable: !1, title: "Record", modal: !0 }) }; var dt = function () { var t = n.dataContext.getJSONData(n.Application.contextUrl + "RecordAccess/GetRoles", null, null), r = '<option Value="-1"><\/option>'; if (t != null) for (i in t) r += '<option value="' + t[i].AD_Role_ID + '">' + t[i].Name + "<\/option>"; o.append(r); r = null; t = null }, gt = function () { var t, i, f; if (r == null && (r = []), t = n.dataContext.getJSONData(n.Application.contextUrl + "RecordAccess/GetRecordAccess", { Table_ID: k, Record_ID: d }, null), i = null, t != null) for (f in t) i = {}, i.AD_ROLE_ID = t[f].AD_ROLE_ID, i.ISACTIVE = t[f].ISACTIVE, i.ISDEPENDENTENTITIES = t[f].ISDEPENDENTENTITIES, i.ISEXCLUDE = t[f].ISEXCLUDE, i.ISREADONLY = t[f].ISREADONLY, i.ISINCLUDENULL = t[f].ISINCLUDENULL, r.push(i); i = null; t = null; r.length > 0 ? (u = 0, ut()) : b = !0 }, ni = function () { var r = o.val(), i; r != -1 && (i = !1, b || (i = !0), t.ajax({ url: n.Application.contextUrl + "RecordAccess/SaveAccess/", dataType: "json", data: { AD_Role_ID: r, AD_Table_ID: k, Record_ID: d, isActive: h.prop("checked"), isExclude: c.prop("checked"), isReadOnly: l.prop("checked"), isDependentEntities: a.prop("checked"), isIncludeNull: v.prop("checked"), isUpdate: i }, success: function (n) { var t = n.result; t == !0 && ti() } })) }, si = function () { e.on("click", function () { u += 1; ut() }); f.on("click", function () { b ? b = !1 : u -= 1; ut() }); nt.on("click", function () { hi() }); tt.on("click", function () { ci() }); it.on("click", function () { ni() }); rt.on("click", function () { ti() }) }, hi = function () { b = !0; u = r.length - 1; ut(); o.val(-1); h.attr("checked", !0); c.attr("checked", !0); l.attr("checked", !1); v.attr("checked", !1); a.attr("checked", !1); y.empty(); y.append("+" + (r.length + 1) + "/" + (r.length + 1)); r.length > 0 && (f.attr("disabled", !1), f.css("opacity", "1")) }, ut = function () { o.val(r[u].AD_ROLE_ID); h.attr("checked", r[u].ISACTIVE == "Y" ? !0 : !1); c.attr("checked", r[u].ISEXCLUDE == "Y" ? !0 : !1); l.attr("checked", r[u].ISREADONLY == "Y" ? !0 : !1); v.attr("checked", r[u].ISINCLUDENULL == "Y" ? !0 : !1); a.attr("checked", r[u].ISDEPENDENTENTITIES == "Y" ? !0 : !1); y.empty(); y.append(u + 1 + "/" + r.length); r.length > u + 1 ? (e.attr("disabled", !1), e.css("opacity", "1")) : (e.attr("disabled", !0), e.css("opacity", ".5")); u == 0 ? (f.attr("disabled", !0), f.css("opacity", ".5")) : (f.attr("disabled", !1), f.css("opacity", "1")) }, ci = function () { var i = o.val(); i == -1 || b || t.ajax({ url: n.Application.contextUrl + "RecordAccess/DeleteRecord/", dataType: "json", data: { AD_Role_ID: i, AD_Table_ID: k, Record_ID: d, isActive: h.prop("checked"), isExclude: c.prop("checked"), isReadOnly: l.prop("checked"), isIncludeNull: v.prop("checked"), isDependentEntities: a.prop("checked") }, success: function (n) { var t = n.result; t == !0 && ti() } }) }, ti = function () { e.off("click"); f.off("click"); nt.off("click"); tt.off("click"); it.off("click"); rt.off("click"); dt = null; gt = null; ni = null; si = null; hi = null; ut = null; ci = null; k = null; d = null; g = null; w = null; li = null; ai = null; e = null; f = null; nt = null; tt = null; it = null; rt = null; kt = null; o = null; h = null; c = null; l = null; v = null; a = null; y = null; r = null; dt = null; gt = null; ni = null; p.dialog("destroy"); p.remove(); p = null } } n.RecordAccessDialog = r }(VIS, jQuery), function (n, t) { function i() { function vi() { e.append('<div class="vis-group-colwrap"><div class="vis-group-content-wrap"><\/div><\/div><div class="vis-group-colwrap"><div class="vis-group-content-wrap"><\/div><\/div><div class="vis-group-colwrap last-child"><div class="vis-group-content-wrap"><\/div><\/div>'); var n = e.find(".vis-group-content-wrap"); v = t(n[0]); o = t(n[1]); s = t(n[2]); n = null; yi(); bi(); ki(); di() } function yi() { i = t('<div class="vis-busyindicatorouterwrap"><div class="vis-busyindicatorinnerwrap"><i class="vis-busyindicatordiv"><\/i><\/div><\/div>'); i[0].style.visibility = "hidden"; e.append(i) } function pi() { k.on("click", rr); tt.on("click", pt); y.on("keydown", or); rt.on("click", ui); ot.on("click", kt); ft.on("click", bt); b.on("keydown", sr); ut.on("click", wt); w.on("keydown", hr); et.on("click", fr); it.on("click", ur); p.on("scroll", er); e.on("click", wi) } function wi(i) { var u = t(i.target); return !u.hasClass("vis-group-roless") && u.parents(".vis-group-roless").length == 0 && !u.hasClass("vis-group-save-btn") && a.length > 0 ? (n.ADialog.confirm("VIS_SaveRole", !0, "", "Confirm", function (n) { n ? ui() : a = [] }), i.stopPropagation(), !1) : !u.hasClass("vis-group-groupss") && u.parents(".vis-group-groupss").length == 0 && !u.hasClass("vis-group-save-btn") && r.length > 0 ? (n.ADialog.confirm("VIS_SaveRole", !0, "", "Confirm", function (n) { n ? kt() : r = [] }), i.stopPropagation(), !1) : void 0 } function bi() { i[0].style.visibility = "visible"; v.append('<div class="vis-group-content-head"><h4 class="vis-group-content-tittle">' + n.Msg.getMsg("VIS_CreateInviteUser") + '<\/h4><span class=" vis-group-pointer vis-group-head-right">' + n.Msg.getMsg("SortBy") + '<\/span><button class="vis-group-add-btn vis-groupbtn"><i class="vis vis-addbp"><\/i><\/button><\/div>'); lt = v.find(".vis-group-head-right"); v.append('<div class="vis-group-searchwrp"><div class="vis-group-content-headDown"><input class="vis-group-SearchText" value="" placeholder="' + n.Msg.getMsg("Search") + '" type="text"><button class="vis-groupbtn vis-group-search-icon"><i class="vis vis-search"><\/i><\/button><\/div><\/div>'); y = v.find(".vis-group-SearchText"); tt = v.find(".vis-group-search-icon"); k = v.find(".vis-group-add-btn"); p = t('<div class="vis-group-users-container">'); h = t('<div class="vis-group-DataContainer">'); p.height(t(e.parent()).height() - 95); v.append(p); p.append(h); nr() } function ki() { o.append(' <div class="vis-group-content-head"><h4 class="vis-group-content-tittle vis-group-role">' + n.Msg.getMsg("Role") + '<\/h4><h7 class="vis-group-SaveMessage">' + n.Msg.getMsg("VIS_RoleSaved") + '<\/h7><div class="vis-group-top-right"><button class="vis-groupbtn vis-group-add-btn"><i class="vis vis-new" title="' + n.Msg.getMsg("AddNew") + '" ><\/i><\/button><button class="vis-groupbtn vis-group-save-btn"><i class="vis vis-save" title="' + n.Msg.getMsg("Save") + '"><\/i><\/button><\/div><\/div><div class="vis-group-searchwrp"><div class="vis-group-content-headDown"><input class="vis-group-SearchText" value="" placeholder="' + n.Msg.getMsg("Search") + '" type="text"><button class="vis-groupbtn vis-group-search-icon"><i class="vis vis-search"><\/i><\/button><\/div><\/div>'); rt = o.find(".vis-group-save-btn"); it = o.find(".vis-group-add-btn"); w = o.find(".vis-group-SearchText"); ut = o.find(".vis-group-search-icon"); g = t('<div class="vis-group-role-container">'); c = t('<div class="vis-group-DataContainer">'); o.append(g); g.append(c); g.height(t(e.parent()).height() - 95); oi() } function di() { s.append('<div class="vis-group-content-head"><h4 class="vis-group-content-tittle vis-group-rights">' + n.Msg.getMsg("VIS_Groups") + '<\/h4><h7 class="vis-group-SaveMessage">' + n.Msg.getMsg("VIS_GroupSaved") + '<\/h7><div class="vis-group-top-right"><div class="vis-group-top-right"><button class="vis-groupbtn vis-group-add-btn"><i class="vis vis-new" title="' + n.Msg.getMsg("AddNew") + '"><\/i><\/button><button class="vis-groupbtn vis-group-save-btn"><i class="vis vis-save" title="' + n.Msg.getMsg("Save") + '"><\/i><\/button><\/div><\/div><\/div><div class="vis-group-searchwrp"><div class="vis-group-content-headDown"><input class="vis-group-SearchText"  value="" placeholder="' + n.Msg.getMsg("Search") + '" type="text"><button class="vis-groupbtn vis-group-search-icon"><i class="vis vis-search"><\/i><\/button><\/div><\/div>'); b = s.find(".vis-group-SearchText"); ft = s.find(".vis-group-search-icon"); et = s.find(".vis-group-add-btn"); ot = s.find(".vis-group-save-btn"); nt = t('<div class="vis-group-role-container">'); l = t('<div class="vis-group-DataContainer">'); s.append(nt); nt.append(l); nt.height(t(e.parent()).height() - 95); ir() } function gi() { d.append("<li value=1>" + n.Msg.getMsg("Name") + "<\/li>"); d.append("<li value=2>" + n.Msg.getMsg("SearchKey") + "<\/li>"); d.append("<li value=3>" + n.Msg.getMsg("EMail") + "<\/li>"); lt.on("click", function () { t(this).w2overlay(d.clone(!0)) }); d.on(n.Events.onTouchStartOrClick, "LI", function () { ri = t(this).val(); pt() }) } function nr() { tr(); pt() } function tr() { var i = ' <script type="text/x-handlebars-template">{{#each this}}<div class="vis-group-user-wrap"  data-UID="{{AD_UserID}}"><input type="radio" class="vis-GroupUserRadio"><div class="vis-group-user-profile vis-group-pro-width"><div class="vis-group-user-img vis-chatimgwrap">{{#if UserImage}}<img src="' + n.Application.contextUrl + '{{UserImage}}" alt="user-img">{{else}}<i class="fa fa-user"><\/i>{{/if}}<\/div><div class="vis-group-user-text">{{#if IsActive }}<p style="font-weight: bold">{{Username}}<\/p>{{else}}<p>{{Username}}<\/p>{{/if}}<span>{{Email}}<\/span><p>{{Country}}<\/p><\/div><\/div><div class="vis-group-user-right"><ul class="vis-flex-directionCol"><li><span class="vis-group-user-ico vis-group-edit vis vis-edit" style="padding-bottom: 15px;" title="' + n.Msg.getMsg("Edit") + '" data-UID="{{AD_UserID}}-{{UserTableID}}-{{UserWindowID}}"><\/span><\/li>{{#if IsActive }}{{#if IsUpdate}}<li><span class="vis-group-user-ico vis-group-activeUser fa fa-check-circle" title="' + n.Msg.getMsg("Active") + '" data-UID="{{AD_UserID}}"><\/span><\/li>{{else}}<li><span disabled class="vis-group-user-ico vis-group-activeUser fa fa-check-circle" title="' + n.Msg.getMsg("Active") + '" data-UID="{{AD_UserID}}"><\/span><\/li>{{/if}}{{else}}{{#if IsUpdate}}<li><span class="vis-group-user-ico vis-group-inactiveUser fa fa-check-circle" title="' + n.Msg.getMsg("InActive") + '"  data-UID="{{AD_UserID}}"><\/span><\/li>{{else}}<li><span disabled class="vis-group-user-ico vis-group-inactiveUser fa fa-check-circle" title="' + n.Msg.getMsg("InActive") + '" data-UID="{{AD_UserID}}"><\/span><\/li>{{/if}}{{/if}}<\/ul><\/div><\/div>{{/each}}​<\/script>'; dt = t(i).html(); at = Handlebars.compile(dt) } function oi() { var i = ' <script type="text/x-handlebars-template">{{#each this}}<div class="vis-group-user-wrap vis-group-roless vis-group-role-pad"  data-UID="{{AD_Role_ID}}"><div class="vis-group-user-profile">{{#if IsAssignedToUser}}{{#if IsUpdate}}<input type="checkbox" data-UID="{{AD_Role_ID}}" checked="">{{else}}<input disabled type="checkbox" data-UID="{{AD_Role_ID}}" checked="">{{/if}}<label style="color: rgba(var(--v-c-on-secondary), 1);font-weight: bold;">{{Name}}<\/label>{{else}}{{#if IsUpdate}}<input type="checkbox" data-UID="{{AD_Role_ID}}" >{{else}}<input disabled type="checkbox" data-UID="{{AD_Role_ID}}" >{{/if}}<label>{{Name}}<\/label>{{/if}}<\/div><div class="vis-group-user-right"><ul><li><span class="vis-group-user-ico vis-group-edit vis vis-edit" title="' + n.Msg.getMsg("Edit") + '" data-UID="{{AD_Role_ID}}-{{roleWindowID}}"><\/span><\/li><\/ul><\/div><\/div>{{/each}}​<\/script>'; gt = t(i).html(); ni = Handlebars.compile(gt) } function ir() { var i = ' <script type="text/x-handlebars-template">{{#each this}}<div class="vis-group-user-wrap vis-group-groupss vis-group-role-pad" data-UID="{{AD_Group_ID}}"><div class="vis-group-user-profile">{{#if IsAssignedToUser}}<input type="checkbox" data-UID="{{AD_Group_ID}}" checked=""><label style="color: rgba(var(--v-c-on-secondary), 1);font-weight: bold;">{{Name}}<\/label>{{else}}<input type="checkbox" data-UID="{{AD_Group_ID}}" ><label>{{Name}}<\/label>{{/if}}<\/div><div class="vis-group-user-right"><ul><li><span class="vis-group-user-ico vis-group-edit vis vis-edit" style="margin-right: 10px" title="' + n.Msg.getMsg("Edit") + '" data-UID="{{AD_Group_ID}}-{{GroupWindowID}}"><\/span><\/li><li><span class="vis-group-user-ico vis-group-info vis vis-info"   data-UID="{{AD_Group_ID}}-{{GroupWindowID}}"><\/span><\/li><\/ul>                           <\/div><\/div>{{/each}}​<\/script>'; ti = t(i).html(); ii = Handlebars.compile(ti) } function rr() { var t = new n.createUser; t.intialize(); t.show() } function ur() { var t = new n.createrole; t.intialize(); t.show() } function fr() { i[0].style.visibility = "visible"; yt == 0 && t.ajax({ url: n.Application.contextUrl + "Group/GetWindowIds", async: !1, success: function (n) { var t = JSON.parse(n); t != null && t != undefined && (yt = t.GroupWindowID, hi = t.RoleWindowID, ci = t.UserWindowID) }, error: function () { n.Msg.getMsg("VIS_GroupWindowNotFound") } }); var r = new n.Query; r.addRestriction("AD_GroupInfo_ID", n.Query.prototype.EQUAL, 0); n.viewManager.startWindow(yt, r); i[0].style.visibility = "hidden" } function pt() { ct = 1; t.ajax({ url: n.Application.contextUrl + "Group/GetUserInfo", type: "GET", datatype: "json", contentType: "application/json; charset=utf-8", async: !0, data: { searchText: y.val(), sortBy: ri, pageNo: ct, pageSize: ei }, success: function (n) { var i = JSON.parse(n); h.find(".vis-group-user-wrap").remove(); h.append(at(i)); h.off("click"); h.on("click", cr); t(h.children(".vis-group-user-wrap")).length > 0 && t(h.children(".vis-group-user-wrap")[0]).trigger("click"); ct++ }, error: function () { n.ADialog.error("VIS_ErrorLoadingContacts"); i[0].style.visibility = "hidden" } }) } function er() { t(this).scrollTop() + t(this).innerHeight() >= this.scrollHeight && t.ajax({ url: n.Application.contextUrl + "Group/GetUserInfo", type: "GET", datatype: "json", contentType: "application/json; charset=utf-8", async: !0, data: { searchText: y.val(), sortBy: ri, pageNo: ct, pageSize: ei }, success: function (n) { ct++; var t = JSON.parse(n); h.append(at(t)); i[0].style.visibility = "hidden" }, error: function () { n.ADialog.error("VIS_ErrorLoadingContacts"); i[0].style.visibility = "hidden" } }) } function or(n) { (n.keyCode == undefined || n.keyCode == 13) && y != undefined && y != null && pt() } function sr(n) { (n.keyCode == undefined || n.keyCode == 13) && b != undefined && b != null && bt() } function hr(n) { (n.keyCode == undefined || n.keyCode == 13) && w != undefined && w != null && wt() } function cr(i) { var r, u, f; if (!(a.length > 0)) { if (r = t(i.target), t(t(h.children(".vis-group-selected-op"))[0]).removeClass("vis-group-selected-op vis-group-selected-opbackground"), t(h).find(".vis-GroupUserRadio").prop("checked", !1), r.hasClass("vis-group-user-wrap")) r.addClass("vis-group-selected-op vis-group-selected-opbackground"), vt = r.data("uid"), t(t(r).find(".vis-GroupUserRadio")[0]).prop("checked", !0); else if (t(r.parents(".vis-group-user-wrap")).length > 0) t(r.parents(".vis-group-user-wrap")).addClass("vis-group-selected-op vis-group-selected-opbackground"), vt = t(r.parents().find(".vis-group-selected-op")).data("uid"), t(t(t(r).parents(".vis-group-user-wrap")[0]).find(".vis-GroupUserRadio")[0]).prop("checked", !0); else return; r.hasClass("vis-group-user-ico vis-group-edit") ? (u = r.data("uid").split("-"), f = new n.Query, f.addRestriction("AD_User_ID", n.Query.prototype.EQUAL, u[0]), n.viewManager.startWindow(u[2], f)) : r.hasClass("vis-group-user-ico vis-group-activeUser") && r.attr("disabled") != "disabled" ? si(r, !1) : r.hasClass("vis-group-user-ico vis-group-inactiveUser") && r.attr("disabled") != "disabled" && si(r, !0); wt(r) } } function wt() { i[0].style.visibility = "visible"; var r = w.val(); t.ajax({ url: n.Application.contextUrl + "Group/GetRoleInfo", data: { AD_User_ID: vt, name: r }, success: function (n) { var u = JSON.parse(n), r; c.find(".vis-group-user-wrap").remove(); c.append(ni(u)); c.off("click"); c.on("click", lr); for (t(c.children(".vis-group-user-wrap")).length > 0 && t(t(c).children(".vis-group-user-wrap")[0]).trigger("click"), st = [], r = 0; r < u.length; r++)st.push({ AD_Role_ID: u[r].AD_Role_ID, IsAssignedToUser: u[r].IsAssignedToUser }); t(c.find("input")).off("click"); t(c.find("input")).on("click", yr); i[0].style.visibility = "hidden" }, error: function () { n.ADialog.error("VIS_ErrorLoadingRoles"); i[0].style.visibility = "hidden" } }) } function bt() { i[0].style.visibility = "visible"; var r = b.val(); t.ajax({ url: n.Application.contextUrl + "Group/GetGroupInfo", data: { AD_Role_ID: u, name: r }, success: function (n) { var u = JSON.parse(n), r; l.find(".vis-group-user-wrap").remove(); l.append(ii(u)); l.off("click"); l.on("click", ar); for (t(l.children(".vis-group-user-wrap")).length > 0 && t(t(l).children(".vis-group-user-wrap")[0]).trigger("click"), ht = [], i[0].style.visibility = "hidden", r = 0; r < u.length; r++)r == 0 && (yt = u[r].GroupWindowID), ht.push({ AD_Group_ID: u[r].AD_Group_ID, IsAssignedToUser: u[r].IsAssignedToUser }); t(l.find("input")).off("click"); t(l.find("input")).on("click", pr) }, error: function () { n.ADialog.error("VIS_ErrorLoadingGroups"); i[0].style.visibility = "hidden" } }) } function lr(i) { var f, e; if (li = !0, r.length > 0) { n.ADialog.confirm("VIS_SaveGroup", !0, "", "Confirm", function (n) { n ? kt() : r = [] }); return } f = t(i.target); t(t(c.children(".vis-group-selected-op"))[0]).removeClass("vis-group-selected-op vis-group-selected-opbackground"); f.hasClass("vis-group-user-wrap") ? (f.addClass("vis-group-selected-op vis-group-selected-opbackground"), u = f.data("uid")) : u = t(f.parents(".vis-group-user-wrap")).addClass("vis-group-selected-op vis-group-selected-opbackground").data("uid"); f.hasClass("vis-group-user-ico vis-group-edit") && (u = f.data("uid"), u = u.split("-"), e = new n.Query, e.addRestriction("AD_Role_ID", n.Query.prototype.EQUAL, u[0]), n.viewManager.startWindow(u[1], e), u = u[0]); u != undefined && bt(f); i.originalEvent === undefined && i.stopPropagation() } function ar(i) { var r, u; ai = !0; r = t(i.target); t(t(l.children(".vis-group-selected-op"))[0]).removeClass("vis-group-selected-op"); r.hasClass("vis-group-user-wrap") ? (r.addClass("vis-group-selected-op"), f = r.data("uid")) : (t(r.parents(".vis-group-user-wrap")).addClass("vis-group-selected-op"), f = t(r.parents().find(".vis-group-selected-op")).data("uid")); r.hasClass("vis-group-user-ico vis-group-edit") ? (f = r.data("uid"), f = f.split("-"), u = new n.Query, u.addRestriction("AD_GroupInfo_ID", n.Query.prototype.EQUAL, f[0]), n.viewManager.startWindow(f[1], u)) : r.hasClass("vis-group-user-ico vis-group-info") && (f = r.data("uid"), f = f.split("-"), vr(f[0])); i.originalEvent === undefined && i.stopPropagation() } function vr(t) { var i = new n.groupInfo(t); i.intialize(); i.show() } function yr(i) { if (r.length > 0) { n.ADialog.confirm("VIS_SaveGroup", !0, "", "Confirm", function (n) { n ? kt() : r = [] }); return } var f = t(i.target), u = t.grep(st, function (n) { return n.AD_Role_ID == f.data("uid") }); u != null && u.length > 0 && (u[0].IsAssignedToUser = f.prop("checked")); u = t.grep(a, function (n) { return n == f.data("uid") }); u == null || u.length == 0 ? a.push(f.data("uid")) : a.splice(a.indexOf(f.data("uid")), 1); i.stopPropagation() } function pr(i) { if (a.length > 0) { n.ADialog.confirm("VIS_SaveRole", !0, "", "Confirm", function (n) { n ? ui() : a = [] }); return } var f = t(i.target), u = t.grep(ht, function (n) { return n.AD_Group_ID == f.data("uid") }); u != null && u.length > 0 && (u[0].IsAssignedToUser = f.prop("checked")); u = t.grep(r, function (n) { return n == f.data("uid") }); u == null || u.length == 0 ? r.push(f.data("uid")) : r.splice(r.indexOf(f.data("uid")), 1); i.stopPropagation() } function ui() { i[0].style.visibility = "visible"; a = []; t.ajax({ url: n.Application.contextUrl + "Group/UpdateUserRoles", type: "Post", data: { AD_User_ID: vt, roles: JSON.stringify(st) }, success: function () { t(t(o.find("h7"))[0]).show(); t(t(o.find("h7"))[0]).fadeOut(1600, "linear"); wt() }, error: function () { n.ADialog.error(n.Msg.getMsg("VIS_ErrorSavingRole")); i[0].style.visibility = "hidden" } }) } function kt() { i[0].style.visibility = "visible"; r = []; t.ajax({ url: n.Application.contextUrl + "Group/UpdateUserGroups", type: "Post", data: { AD_Role_ID: u, AD_Group_ID: f, groups: JSON.stringify(ht) }, success: function () { t(t(s.find("h7"))[0]).show(); t(t(s.find("h7"))[0]).fadeOut(1600, "linear"); bt() }, error: function () { n.ADialog.error(n.Msg.getMsg("VIS_ErrorSavingGroups")); i[0].style.visibility = "hidden" } }) } function si(r, u) { i[0].style.visibility = "visible"; var f = ""; u ? (r.removeClass("vis-group-user-ico vis-group-inactiveUser"), r.addClass("vis-group-user-ico vis-group-activeUser"), f = n.Application.contextUrl + "Group/ActiveUser") : (r.removeClass("vis-group-user-ico vis-group-activeUser"), r.addClass("vis-group-user-ico vis-group-inactiveUser"), f = n.Application.contextUrl + "Group/InActiveUser"); t.ajax({ url: f, data: { AD_User_ID: r.data("uid") }, success: function (t) { var f = JSON.parse(t); f < 1 && n.ADialog.error("VIS_UserNotUpdated"); u ? r.prop("title", n.Msg.getMsg("Active")) : r.prop("title", n.Msg.getMsg("InActive")); i[0].style.visibility = "hidden" }, error: function () { n.ADialog.error("VIS_UserNotUpdated"); i[0].style.visibility = "hidden" } }) } this.frame = null; this.windowNo = null; var fi = this, e = t('<div class="vis-group-assign-content">'), d = t('<ul class="vis-apanel-rb-ul"><\/ul>'), v = null, o = null, s = null, p = null, y = null, tt = null, k = null, lt = null, it = null, rt = null, g = null, h = null, c = null, l = null, i = null, w = null, ut = null, b = null, ft = null, et = null, ot = null, nt = null, dt, at, gt, ni, ti, ii, ri = -1, vt = 0, st = [], ht = [], a = [], r = [], u = 0, f = 0, yt = 0, hi = 0, ci = 0, ct = 0, ei = 20, li = !1, ai = !1; this.initializeComponent = function () { vi(); pi(); gi() }; this.disposeComponent = function () { k != null && k != undefined && k.off("click"); tt.off("click"); y.off("keydown"); rt.off("click"); ot.off("click"); ft.off("click"); b.off("keydown"); ut.off("click"); w.off("keydown"); et.off("click"); it.off("click"); p.off("scroll"); e.off("click"); this.frame = null; this.windowNo = null; v.remove(); v = null; o.remove(); o = null; s.remove(); s = null; p.remove(); p = null; y.remove(); y = null; tt.remove(); tt = null; k.remove(); k = null; lt.remove(); lt = null; it.remove(); it = null; rt.remove(); rt = null; g.remove(); g = null; i.remove(); i = null; b.remove(); b = null; ft.remove(); ft = null; w.remove(); w = null; ut.remove(); ut = null; et.remove(); et = null; ot.remove(); ot = null; nt.remove(); nt = null; dt.remove(); at.remove(); gt.remove(); ni.remove(); ti.remove(); ii.remove(); st = null; ht = null; a = null; r = null; e.remove(); e = null; d = null; fi = null }; this.getRoot = function () { return e } } i.prototype.init = function (n, t) { this.frame = t; this.windowNo = n; t.setTitle("VIS_Group"); this.frame.getContentGrid().append(this.getRoot()); this.initializeComponent() }; i.prototype.dispose = function () { this.disposeComponent(); this.frame && this.frame.dispose(); this.frame = null }; n.GroupForm = i }(VIS, jQuery), function (n, t) { function i() { function ft() { i = t('<div class="vis-busyindicatorouterwrap"><div class="vis-busyindicatorinnerwrap"><i class="vis-busyindicatordiv"><\/i><\/div><\/div>'); i[0].style.visibility = "hidden"; r.append(i) } function et() { r = t("<div>"); var i = '  <div style="overflow:hidden" class="vis-group-assinRole-content"><div class="vis-group-assinRole-data" style=" margin-top: 5px; margin-bottom: 0; "><div class="input-group vis-input-wrap"><div class="vis-control-wrap"><input  tabindex="1" class="vis-group-email" type="text" name="Name" data-placeholder="" placeholder=" "><label>' + n.Msg.getMsg("EMail") + '<\/label><\/div><\/div><\/div><div class="vis-group-assinRole-data vis-creategroup-btnwrap"> <a tabindex="2" class="vis-group-btn vis-group-pointer vis-group-create vis-group-grayBtn" style="float: left;">' + n.Msg.getMsg("Create") + '<\/a><a tabindex="3" class="vis-group-btn vis-group-pointer vis-group-invite vis-group-blueBtn" style="float: right;">' + n.Msg.getMsg("VIS_Invite") + "<\/a><\/div><\/div>"; s = t('<div class="vis-group-assignContainer" style="visibility:hidden"><div class="vis-group-assinRole-data"><div class="input-group vis-input-wrap"><div class="vis-control-wrap"><input  tabindex="4" type="text" maxlength="60" data-placeholder="" placeholder=" " class="vis-group-name vis-group-mandatory"  name="Name"><label>' + n.Msg.getMsg("Name") + '<\/label><\/div><\/div><\/div><div class="vis-group-assinRole-data"><div class="input-group vis-input-wrap"><div class="vis-control-wrap"><input tabindex="5" type="text" maxlength="80" data-placeholder="" placeholder=" " class="vis-group-uid"  name="Name"><label>' + n.Msg.getMsg("VIS_UserID") + '<\/label><\/div><\/div><\/div><div class="vis-group-assinRole-data"><div class="input-group vis-input-wrap"><div class="vis-control-wrap"><input tabindex="6" type="password" maxlength="250" data-placeholder="" placeholder=" " class="vis-group-pwd"  name="Name"><label>' + n.Msg.getMsg("Password") + '<\/label><\/div><\/div><\/div><div class="vis-group-assinRole-data"><div class="input-group vis-input-wrap"><div class="vis-control-wrap"><input tabindex="7" type="text"  maxlength="50" data-placeholder="" placeholder=" " class="vis-group-mobile"  name="Name"><label>' + n.Msg.getMsg("Mobile") + '<\/label><\/div><\/div><\/div><a tabindex="8" class="vis-group-btn vis-group-Save vis-group-pointer vis-group-grayBtn" style="float: right;">' + n.Msg.getMsg("Save") + "<\/a><\/div>"); o = t('<div class="vis-group-roleContainer" ><div> <label >' + n.Msg.getMsg("SelectRole") + "<\/label> <\/div><\/div>"); r.append(i); f = r.find(".vis-group-assinRole-content"); f.height("100px"); c = r.find(".vis-group-create"); l = r.find(".vis-group-invite"); a = s.find(".vis-group-Save"); e = s.find(".vis-group-name"); p = s.find(".vis-group-uid"); b = s.find(".vis-group-mobile"); w = s.find(".vis-group-pwd"); v = r.find(".vis-group-email") } function ot() { e.on("change", lt); c.on("click", tt); c.on("keydown", st); l.on("click", it); l.on("keydown", ct); a.on("click", rt); a.on("keydown", ht) } function st(n) { (n.keyCode == undefined || n.keyCode == 13) && tt() } function ht(n) { (n.keyCode == undefined || n.keyCode == 13) && rt() } function ct(n) { (n.keyCode == undefined || n.keyCode == 13) && it() } function lt() { e.val().length > 0 ? e.removeClass("vis-group-mandatory") : e.addClass("vis-group-mandatory") } function at() { g = t(' <script type="text/x-handlebars-template">{{#each this}}<div class="vis-group-user-wrap vis-group-role-pad"  data-UID="{{AD_Role_ID}}"><div class="vis-group-user-profile"><input tabindex="7"  type="checkbox" data-UID="{{AD_Role_ID}}" ><label>{{Name}}<\/label><\/div><\/div>{{/each}}​<\/script>').html(); nt = Handlebars.compile(g) } function vt() { i[0].style.visibility = "visible"; t.ajax({ url: n.Application.contextUrl + "Group/GetRoleInfo", data: { AD_User_ID: 0 }, success: function (r) { var f = JSON.parse(r), e = t('<div style="height:212px;overflow:auto;margin-bottom:10px">'), u; e.append(nt(f)); o.append(e); k = t('<a tabindex="400" class="vis-group-btn vis-group-pointer vis-group-finish vis-group-grayBtn" style="float: right;">' + n.Msg.getMsg("VIS_Finish") + "<\/a>"); o.append(k); k.on("click", ut); k.on("keydown", yt); for (t(o.children(".vis-group-user-wrap")).length > 0 && t(t(o).children(".vis-group-user-wrap")[0]).trigger("click"), u = 0; u < f.length; u++)d.push({ AD_Role_ID: f[u].AD_Role_ID, IsAssignedToUser: !1 }); t(o.find("input")).off("click"); t(o.find("input")).on("click", pt); i[0].style.visibility = "hidden" }, error: function () { n.ADialog.error("VIS_ErrorLoadingRoles"); i[0].style.visibility = "hidden" } }) } function yt(n) { (n.keyCode == undefined || n.keyCode == 13) && ut() } function pt(n) { var r = t(n.target), i = t.grep(d, function (n) { return n.AD_Role_ID == r.data("uid") }); i != null && i.length > 0 && (i[0].IsAssignedToUser = r.prop("checked")); n.stopPropagation() } function tt() { f.find(".vis-group-roleContainer").css("display", "none"); f.find(".vis-group-assignContainer").css("display", "inherit"); f.append(s); r.find(".vis-group-assignContainer").css({ visibility: "visible" }); f.height("400px") } function it() { f.find(".vis-group-assignContainer").css("display", "none"); f.find(".vis-group-roleContainer").css("display", "inherit"); f.append(o); f.height("403px") } function rt() { var f, o; if (t(r.find(".vis-group-assignContainer")[0]).css("visibility") == "visible") { if (f = e.val(), f == null || f == undefined || f == "") { n.ADialog.info("VIS_PleaseName"); return } i[0].style.visibility = "visible"; (y == null || y == undefined) && (y = null); o = n.secureEngine.encrypt(w.val()); t.ajax({ url: n.Application.contextUrl + "Group/SaveNewUser", type: "GET", datatype: "json", contentType: "application/json; charset=utf-8", async: !0, data: { Name: f, Email: v.val(), Value: p.val(), password: o, mobile: b.val(), OrgID: JSON.stringify(y) }, success: function (t) { var r = JSON.parse(t); i[0].style.visibility = "hidden"; r.length > 0 ? n.ADialog.error(r) : (n.ADialog.info("Record saved successfully"), u.close()) }, error: function () { i[0].style.visibility = "hidden"; n.ADialog.error("VIS_ErrorSavingUser") } }) } } function ut() { var r = v.val(), h, s, f, o, e; if (r == null || r == undefined || r == "") { n.ADialog.error("NotValidEmail"); return } if (h = new RegExp(/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?$/i), r.indexOf(";") == -1) { if (o = h.test(r), !o) { n.ADialog.error("NotValidEmail", !0, ":" + r); return } } else for (s = r.split(";"), f = 0; f < s.length; f++)if (o = h.test(s[f]), !o) { n.ADialog.error("NotValidEmail", !0, ":" + s[f]); return } if (e = t.grep(d, function (n) { return n.IsAssignedToUser == !0 }), e == null || e == undefined || e.length == 0) { n.ADialog.info("VIS_SelectRole"); return } r != null && r != undefined && r != "" && r.length > 0 && (i[0].style.visibility = "visible", t.ajax({ url: n.Application.contextUrl + "Group/InviteUsers", type: "POST", datatype: "json", async: !0, data: { email: r, roles: JSON.stringify(e) }, success: function (t) { var r = JSON.parse(t); n.ADialog.info(r); i[0].style.visibility = "hidden"; u.close() }, error: function () { n.ADialog.error("VIS_ErrorInvitingUsers"); i[0].style.visibility = "hidden" } })) } var r = null, f = null, c = null, l = null, a = null, v = null, e = null, p = null, w = null, b = null, u = null, h = this, y = null, i = null, g, nt = null, o = null, d = [], s = null, k = null; this.intialize = function () { et(); ot(); ft(); at(); vt() }; this.setSelectedOrg = function (n) { y = n }; this.show = function () { u = new n.ChildDialog; u.setContent(r); u.setPosition({ my: "center bottom-3" }); u.setWidth(550); u.setTitle(n.Msg.getMsg("VIS_CreateUser")); u.setModal(!0); u.onClose = function () { h.onClose && h.onClose(); h.dispose() }; u.show(); u.hideButtons() }; this.dispose = function () { this.prop = null; $div = null; u = null; h = null; r.remove(); r = null; c.remove(); c = null; l.remove(); l = null; a.remove(); a = null; v.remove(); v = null; e.remove(); e = null; p.remove(); p = null; w.remove(); w = null; b.remove(); b = null; u = null; h = null } } n.createUser = i }(VIS, jQuery), function (n, t) { function i(i) { function h() { u = t("<div>"); t.ajax({ url: n.Application.contextUrl + "Group/GetOrgAccess", success: function (n) { var i = JSON.parse(n); u.append(s(i)); t(u.find("input")).on("click", a) }, error: function () { n.ADialog.error("VIS_ErrorLoadingOrg") } }) } function c() { o = t(' <script type="text/x-handlebars-template">{{#each this}}<div style="border-bottom:1px solid rgba(var(--v-c-on-secondary), .2); margin-bottom: 10px" class="vis-group-assinRole-check"><div style="width:100%" class="vis-group-user-profile"><input type="Checkbox" data-uid="{{OrgID}}"> <p style="margin-bottom:2px">{{OrgName}}<\/p><span class="vis-orgaccess-description">{{Description}}<\/span><\/div><\/div>{{/each}}​<\/script>').html(); s = Handlebars.compile(o) } function l() { r.onOkClick = function () { i(f); e.dispose() }; r.onCancelClick = function () { e.dispose() } } function a(n) { var i = t(n.target); i.prop("checked") ? t.inArray(i.data("uid")) == -1 && f.push(i.data("uid")) : f.splice(f.indexOf(i.data("uid")), 1) } var u = null, o, s = null, r = null, f = [], e = this; this.intialize = function () { c(); h() }; this.show = function () { r = new n.ChildDialog; r.setContent(u); r.setWidth(450); r.setHeight(350); r.setTitle(n.Msg.getMsg("VIS_OrgAccess")); r.setModal(!0); r.onClose = function () { e.dispose() }; r.show(); l() }; this.dispose = function () { this.prop = null; $div = null; u.remove(); u = null; o = null; s = null; r = null; e = null; f = null } } n.orgAccess = i }(VIS, jQuery), function (n, t) { function i(i) { function f() { u = t('<div  class="vis-forms-container">'); e() } function e() { t.ajax({ url: n.Application.contextUrl + "Group/GetGroupChildInfo", data: { groupID: i }, success: function (t) { var i = JSON.parse(t), r = '<div class="vis-group-gi-content"><label>' + i.GroupName + "<\/label>"; i.Description != null && i.Description != undefined && i.Description != "" && (r += "<p>" + i.Description + "<\/p>"); i.WindowName != null && i.WindowName != undefined && i.WindowName != "" && (r += '<div class="vis-group-gi-data"><label>' + n.Msg.getMsg("Windows") + ":<\/label><p>" + i.WindowName + "<\/p>", "<\/div>"); i.FormName != null && i.FormName != undefined && i.FormName != "" && (r += '<div class="vis-group-gi-data"><label>' + n.Msg.getMsg("VIS_Forms") + ":<\/label><p>" + i.FormName + "<\/p>", "<\/div>"); i.ProcessName != null && i.ProcessName != undefined && i.ProcessName != "" && (r += '<div class="vis-group-gi-data"><label>' + n.Msg.getMsg("VIS_Processes") + ":<\/label><p>" + i.ProcessName + "<\/p>", "<\/div>"); i.WorkflowName != null && i.WorkflowName != undefined && i.WorkflowName != "" && (r += '<div class="vis-group-gi-data"><label>' + n.Msg.getMsg("VIS_Workflows") + ":<\/label><p>" + i.WorkflowName + "<\/p>", "<\/div>"); r += "<\/div>"; u.append(r) }, error: function () { n.ADialog.error("VIS_ErrorGettingGroupInfo") } }) } var u = null, r = null; this.intialize = function () { f() }; this.show = function () { r = new n.ChildDialog; r.setContent(u); r.setHeight(500); r.setWidth(550); r.setTitle(n.Msg.getMsg("VIS_Groupinfo")); r.setModal(!0); r.onClose = function () { self.onClose && self.onClose(); self.dispose() }; r.show(); r.hideButtons() }; this.dispose = function () { self = null; u.remove(); u = null; r = null } } n.groupInfo = i }(VIS, jQuery), function (n, t) { function i() { function v() { var i = '<div class="vis-group-assinRole-content"><div class="vis-group-assinRole-data"><div class="input-group vis-input-wrap"><div class="vis-control-wrap"><input tabindex="1" maxlength="60" data-placeholder="" placeholder=" " class="vis-group-role-text vis-ev-col-mandatory" type="text"><label>' + n.Msg.getMsg("Role") + '<\/label><\/div><\/div><\/div><div class="vis-group-assinRole-data"><div class="input-group vis-input-wrap"><div class="vis-control-wrap"><select  tabindex="2"  class="vis-group-role-select" ><\/select><label>' + n.Msg.getMsg("VIS_UserLevel") + '<\/label><\/div><\/div><\/div><div class="vis-group-assinRole-data vis-group-asignrole-btnwrap"><a style="float:left"  tabindex="3"  class="vis-group-btn vis-group-orgAccess vis-group-pointer vis-group-grayBtn">' + n.Msg.getMsg("VIS_OrgAccess") + '<\/a><a  tabindex="4"  class="vis-group-btn vis-group-Save vis-group-pointer vis-group-grayBtn" style="float: right;">' + n.Msg.getMsg("Save") + "<\/a><\/div><\/div>"; r.append(i); u = r.find(".vis-group-role-text"); o = r.find(".vis-group-role-select"); s = r.find(".vis-group-orgAccess"); h = r.find(".vis-group-Save"); y(); f[0].style.visibility = "visible"; t.ajax({ url: n.Application.contextUrl + "Group/GetUserLevel", success: function (n) { var t = JSON.parse(n), i; if (t != null && t.length > 0) for (i = 0; i < t.length; i++)o.append('<option value="' + t[i].ID + '">' + t[i].Name + "<\/option>"); f[0].style.visibility = "hidden" } }) } function y() { f = t('<div class="vis-busyindicatorouterwrap"><div class="vis-busyindicatorinnerwrap"><i class="vis-busyindicatordiv"><\/i><\/div><\/div>'); f[0].style.visibility = "hidden"; r.append(f) } function p() { s.on("click", l); s.on("keydown", w); h.on("click", a); h.on("keydown", b); u.on("change", k) } function w(n) { (n.keyCode == undefined || n.keyCode == 13) && l() } function b(n) { (n.keyCode == undefined || n.keyCode == 13) && a() } function k() { u.val().length > 0 ? u.removeClass("vis-group-mandatory") : u.addClass("vis-group-mandatory") } function l() { var t = new n.orgAccess(c.setSelectedOrg); window.setTimeout(function () { t.intialize(); t.show() }, 20) } function a() { var s = u.val(), r = o.val(); if (s == null || s == undefined || s == "") { n.ADialog.info("VIS_PleaseName"); return } if (e == undefined || e == null || e == "" || e.length == 0) { n.ADialog.info("VIS_SelectOrgAccess"); return } if (r == null || r == undefined || r == "" || r == -1) { n.ADialog.info("VIS_SelectUserLevel"); return } f[0].style.visibility = "visible"; t.ajax({ url: n.Application.contextUrl + "Group/AddNewRole", data: { name: s, userLevel: r, orgID: JSON.stringify(e) }, success: function (t) { var r = JSON.parse(t); r.length > 0 ? n.ADialog.error(r) : (n.ADialog.info("Record saved successfully"), i.close()); f[0].style.visibility = "hidden" }, error: function () { n.ADialog.error("VIS_ErrorSavingRole"); f[0].style.visibility = "hidden" } }) } var r = t("<div>"), i = null, u = null, o = null, s = null, h = null, e = null, c = this, f = null; this.intialize = function () { v(); p() }; this.setSelectedOrg = function (n) { e = n }; this.show = function () { i = new n.ChildDialog; i.setContent(r); i.setWidth(550); i.setTitle(n.Msg.getMsg("VIS_CreateRole")); i.setModal(!0); i.onClose = function () { c.dispose(); c = null }; i.show(); i.hideButtons() }; this.dispose = function () { u.remove(); u = null; o.remove(); o = null; s.remove(); s = null; h.remove(); h = null; r.remove(); r = null; i = null } } n.createrole = i }(VIS, jQuery), function (n, t) { function i() { var b, k, d, g, p; this.onClose = null; var nt = this, r = null, u = null, e = null, a = null, o = null, s = null, h = null, i = null, c = [], w = null, v = null, tt = null, y = [], f = [], l = null, it = function () { r = t("<div>"); u = t('<div class="vis-busyindicatorouterwrap"><div class="vis-busyindicatorinnerwrap"><i class="vis-busyindicatordiv"><\/i><\/div><\/div>'); u[0].style.visibility = "visible"; r.append(u); e = t("<div>"); a = t("<div class='vis-markmodulemainwrap'>"); e.append(a); h = t("<div>"); e.append(h); var i = n.Msg.getMsg("Cancel"), f = n.Msg.getMsg("Ok"); s = t("<button class='VIS_Pref_btn-2' style='margin-top: 5px;margin-bottom: -10px;'>").append(i); o = t("<button class='VIS_Pref_btn-2' style='margin-top: 5px;margin-bottom: -10px;margin-right:5px'>").append(f); h.append(s); h.append(o); r.append(e); l = t("<table>") }; it(); b = function () { s.on("click", function () { p() }); o.on("click", function () { d() }) }; b(); k = function () { var w, d, e, r, p, h; if (i = [], w = null, e = n.dataContext.getJSONData(n.Application.contextUrl + "MarkModule/LoadModules", null, null), e != null) for (r in e) w = {}, w.AD_ModuleInfo_ID = e[r].AD_ModuleInfo_ID, w.Name = e[r].Name, w.Prefix = e[r].Prefix, i.push(w); if (c.length == 1 && (d = { RecordID: c[0], TableID: v }, e = n.dataContext.getJSONData(n.Application.contextUrl + "MarkModule/GetExportData", d, null), e != null)) for (r in e) y.push(e[r]); var b = null, k = null, o = null, s = null; if (y.length == 0) for (r = 0; r < i.length; r++)b = t("<tr>"), k = t("<td>"), o = t('<label class="vis-gc-vpanel-table-label-checkbox" style="display: inline-block; opacity: 1;">'), s = t("<input type='checkbox'>"), i[r].Prefix == "VA093_" && s.prop("disabled", !0), o.append(s), o.append(i[r].Name), k.append(o), b.append(k), l.append(b), h = {}, h.Ctrl = s, h.AD_ModuleInfo_ID = i[r].AD_ModuleInfo_ID, f.push(h); else for (p = 0; p < i.length; p++)b = t("<tr>"), k = t("<td>"), o = t('<label class="vis-gc-vpanel-table-label-checkbox" style="display: inline-block; opacity: 1;">'), s = y.indexOf(i[p].AD_ModuleInfo_ID) > -1 ? t("<input type='checkbox' checked>") : t("<input type='checkbox'>"), i[p].Prefix == "VA093_" && s.prop("disabled", !0), o.append(s), o.append(i[p].Name), k.append(o), b.append(k), l.append(b), h = {}, h.Ctrl = s, h.AD_ModuleInfo_ID = i[p].AD_ModuleInfo_ID, f.push(h); a.append(l); u[0].style.visibility = "hidden" }; d = function () { var i, t, e, o, r; for (u[0].style.visibility = "visible", i = [], t = 0; t < f.length; t++)e = f[t].Ctrl, e.prop("checked") && i.push(f[t].AD_ModuleInfo_ID); o = { moduleId: i, _recordID: c, _tableID: v, _strRecordID: w }; r = n.dataContext.getJSONData(n.Application.contextUrl + "MarkModule/SaveExportData", o); r.result != "OK" && alert(r.result); u[0].style.visibility = "hidden"; p() }; this.show = function () { r.dialog({ title: n.Msg.getMsg("VIS_MarkModule"), width: 400, height: 500, resizable: !1, modal: !0, close: g }); k() }; this.init = function (n, t, i) { c = n.toString().split(","); w = n; v = t; tt = i }; g = function () { p() }; p = function () { nt.onClose && nt.onClose(); e = null; a = null; s.off("click"); o.off("click"); o = null; s = null; h = null; k = null; d = null; it = null; b = null; g = null; u = null; i = null; c = null; w = null; v = null; tt = null; y = null; f = null; l = null; r != null && (r.dialog("destroy"), r.remove()); r = null } } n.MarkModule = i }(VIS, jQuery), function (n, t) { function r(r, f) { function de() { h = t('<div style="height:100%"><div class="vis-apanel-busy vis-cardviewmainbusy" style="display:block"><\/div><\/div>'); ur = t("<div class='vis-apanel-busy vis-cardviewmainbusy'><\/div> "); var i = n.Application.contextUrl + "CardView/GetTemplateDesign", r = { ad_Window_ID: v.getAD_Window_ID(), ad_Tab_ID: v.getAD_Tab_ID() }; t.ajax({ type: "POST", url: i, dataType: "json", contentType: "application/json; charset=utf-8", data: JSON.stringify(r), success: function (n) { var t = JSON.parse(n); us(t) }, error: function (n) { alert(n.statusText) }, complete: function () { } }) } function g(n) { n && ur != null && ur.css({ display: "block" }); n || ur == null || ur.css({ display: "none" }) } function rs() { ar.click(function () { rr = !1; a.hide(); tr = 1; y.show(); DivCardFieldSec.hide(); li.hide(); ht.show(); y.find('.mainTemplate[templateid="' + et + '"]').parent().click(); e.hide(); ht.find(".vis-two-sec-two").hide(); fu(); d || pr.click() }); yr.click(function (t) { rr = !0; oi = []; n.context.setContext("CardDialogLaststepSelected_" + s, 1); he(t) }); tf.click(function () { k == "undefined" ? btnBack.click() : (tr++, y.hide(), DivCardFieldSec.show(), ht.find(".vis-two-sec-two").show(), e.show()) }); btnNewCard.click(function () { lt = !1; d = !0; uo(); se(!0); wu = ut.find(".crd-active").attr("idx"); ut.find(".crd-active").removeClass("crd-active"); yr.removeClass("vis-disable-event"); nr.removeClass("vis-disable-event"); wr.removeClass("vis-disable-event"); vr.removeClass("vis-disable-event"); et = 0; wf = 0; k = "undefined"; pi.val(""); y.find('[issystemtemplate="Y"]').removeClass("displayNone"); tf.text(n.Msg.getMsg("Back")); pr.text(n.Msg.getMsg("NextLayout")); fe || ve(); ar.click() }); ef.click(function (n) { rr = !1; g(!0); he(n) }); su.click(function () { bi = new u; bi.show(); bi.btnCopySave.click(function () { var n = bi.getName(); n && n.length > 0 && (g(!0), ih(n)) }); bi.btnCopyCancle.click(function () { bi.close() }) }); kr.click(function () { d = !1; lt = !0; se(!1); ut.find('[idx="' + wu + '"]').click() }); pr.click(function () { var n, t; ru.val(""); b.find(".fieldLbl:not(:first)").show(); co(); tr++; of(); y.hide(); DivCardFieldSec.show(); ht.find(".vis-two-sec-two").show(); e.show(); et == 0 && o.find(".rowBox").length == 1 && (o.find(".addGridCol").click(), o.find(".addGridRow").click()); et != 0 || er || c.find(".vis-viewBlock").css("backgroundColor", "#fff"); er && setTimeout(function () { nr.click() }, 2e3); n = DivCardFieldSec.find(".vis-templatePreview"); t = y.find(".vis-active-template .mainTemplate").clone(!0); n.html(t); var f = n.height(), s = n.width(), h = t.height(), l = t.width(), i = 1, r = f / h, u = s / l; i = r > u ? u : r; n.find(".mainTemplate").css("zoom", i); wi = !1; at = []; ue = !0; ot = 0; it(); yi.attr("disabled", "disabled") }); vr.click(function () { tf.text(n.Msg.getMsg("Cancle")); pr.text(n.Msg.getMsg("Ok")); a.hide(); tr--; y.show(); DivCardFieldSec.hide(); e.hide(); ht.find(".vis-two-sec-two").hide(); fe ? fu() : ve(); te = !0; pi.val(""); y.find('[issystemtemplate="Y"]').removeClass("displayNone") }); nr.click(function (t) { rf = !1; rr = !0; oi = []; n.context.setContext("CardDialogLaststepSelected_" + s, 2); yo(t) }); wr.click(function (t) { rf = !0; yo(t); var f = new Date, e = "", i = f.getHours(), r = f.getMinutes(), u = f.getSeconds(), o = i >= 12 ? "PM" : "AM"; i %= 12; i = i || 12; i < 10 && (i = "0" + i); r < 10 && (r = "0" + r); u < 10 && (u = "0" + u); e = i + ":" + r + ":" + u + " " + o; df.text(n.Msg.getMsg("LastSaved") + " " + e); y.find('.mainTemplate[templateid="' + et + '"]').parent().attr("lastupdated", e) }); btnBack.click(function () { uo(); li.show(); ht.hide(); kr.click() }); gt.click(function () { n.ADialog.confirm("SureWantToDelete", !0, "", n.Msg.getMsg("Confirm"), function (n) { n && cs() }) }); btnCardAsc.on("click", function () { ct.val() != -1 && ct.val() != null && (btnCardAsc.css("color", "rgba(var(--v-c-primary), 1)"), btnCardDesc.css("color", "rgba(var(--v-c-on-secondary), 1)"), ou = "ASC") }); btnCardDesc.on("click", function () { ct.val() != -1 && ct.val() != null && (btnCardAsc.css("color", "rgba(var(--v-c-on-secondary), 1)"), btnCardDesc.css("color", "rgba(var(--v-c-primary), 1)"), ou = "DESC") }); no(); ft.find(".grpChk").click(function () { t(this).hasClass("fa-check-square-o") ? t(this).removeClass("fa-check-square-o").addClass("fa-square-o") : t(this).removeClass("fa-square-o").addClass("fa-check-square-o") }); pf.click(function () { t(this).is(":checked") ? (ir.show(), hu.hide()) : (ir.hide(), hu.show()) }); cu.on("input", function () { sr() }); lu.on("input", function () { sr() }); au.on("input", function () { sr() }); vu.on("input", function () { sr() }); yu.on("change", function () { sr() }); t("body").mouseup(function () { hi = !1 }); ye.click(function () { var i, r, u; if (yt.find(":selected").val() != -1) { if (ii.isMandatory && (hf(!0) == null || hf(!0) == "")) { n.ADialog.error("FillMandatory", !0, ii.colName); return } i = {}; dt = {}; r = ""; r = pf.is(":checked") ? ir.find(".grd-preview").css("background") : Modernizr.inputtypes.color ? hu.val() : ctrColor.spectrum("get"); u = t.map(p, function (n, t) { if (n.Color == r) return t }); u.length <= 0 ? (dt.Color = r.toString(), dt.Condition = [], i.ColHeader = yt.find(":selected").text(), i.ColName = yt.find(":selected").val(), i.Operator = pt.val(), i.OperatorText = pt.find(":selected").text(), i.QueryValue = hf(!0), i.QueryText = eo(!0), dt.Condition.push(i), p.push(dt)) : (i.ColHeader = yt.find(":selected").text(), i.ColName = yt.find(":selected").val(), i.Operator = pt.val(), i.OperatorText = pt.find(":selected").text(), i.QueryValue = hf(!0), i.QueryText = eo(!0), p[u[0]].Condition.push(i)); uu(p); yt.val("-1"); pt[0].SelectedIndex = -1; vs(!0); ys(!0); cu.val("#000"); lu.val("#000"); au.val(0); vu.val(0); yu.val("to bottom"); ir.find(".grd-preview").css("background", "#000") } }); pe.on("click", function () { var t = ct.val(), i; if (t != -1) if (btnCardAsc.css("color", "rgba(var(--v-c-on-secondary), 1)"), btnCardDesc.css("color", "rgba(var(--v-c-on-secondary), 1)"), sortOrderArray && sortOrderArray.length < 3) { if (i = ct.find(":selected").text(), sortOrderArray.indexOf(t + " ASC") > -1 || sortOrderArray.indexOf(t + " DESC") > -1) { n.ADialog.warn("CardSortColAdded"); return } ho(i, t, ou); sortOrderArray.push(t + " " + ou); ct.val(-1) } else n.ADialog.warn("MaxSortColumn") }); eu.on("click", function (n) { if (lt || d) { var i = t(n.target); if (i.hasClass("fa-close") && (i = i.parent()), i.hasClass("vis-sortListItemClose")) { const n = sortOrderArray.indexOf(i.data("text")); sortOrderArray.splice(n, 1); i.closest(".vis-sortListItem").remove() } } }); if (yt != null) yt.on("change", function (t) { var i, r, f, e, u; t.stopPropagation(); i = yt.val(); oo(!0); i && i != "-1" && (r = null, f = null, r = i.endsWith("_ID") || i.endsWith("_Acct") || i.endsWith("_ID_1") || i.endsWith("_ID_2") || i.endsWith("_ID_3") ? hr.getOperatorsQuery(n.Query.prototype.CVOPERATORS_ID) : i.startsWith("Is") ? hr.getOperatorsQuery(n.Query.prototype.OPERATORS_YN) : hr.getOperatorsQuery(n.Query.prototype.CVOPERATORS), e = v.getField(i), pt.html(r), pt[0].SelectedIndex = 0, u = fo(i), so(!0, u), pt.prop("disabled", !1)); ps(!0) }); if (pt != null) pt.on("change", function () { var t = pt.val(), i, r; t || (t = ""); i = ""; r = ""; t && t != "0" ? n.Query.prototype.BETWEEN.equals(t) && (i = yt.val(), r = fo(i), so(!1, r)) : (ws(btnSave, !1), oo(!0)) }); if (wt != null) wt.on("change", function () { ti = parseInt(t(this).find(":selected").val()); io(ti) }); if (ri != null) ri.on("click", "tr .td_Action i", function () { var n; if (lt || d) { var r = t(this).parent().parent().index(), u = t(this).parent().parent().children().eq(0).attr("value"), f = t(this).parent().parent().children().eq(1).attr("value"); for (ri.find("tr").eq(r).remove(), n = t.map(p, function (n, t) { if (n.Color == u) return t }), i = 0; i < p[n].Condition.length; i++)if (f == p[n].Condition[i].ColName && p[n].Condition.splice(i, 1), p[n].Condition.length <= 0) { p.splice(n, 1); break } } p.length == 0 && uu("") }); bf.change(function () { var n = c.find(".vis-active-block"); n.attr("style", t(this).val()) }); nf.change(function () { var i = c.find(".vis-active-block"), r; t(this).val() == null || t(this).val() == "" ? (i.find("sql").remove(), i.attr("query", "")) : (r = n.secureEngine.encrypt(t(this).val()), i.attr("query", r), i.find("sql").length == 0 && i.append("<sql>SQL<\/sql>")) }); we.on("input", function () { c.find(".canvas").css("zoom", t(this).val()) }); c.find(".vis-viewBlock")[0].addEventListener("dragstart", function (n) { fi = t(n.target); fi.hasClass("grdDiv") || !n.ctrlKey ? n.preventDefault() : (a.hide(), hi = !1) }, !1); c.find(".vis-viewBlock")[0].addEventListener("dragover", function (n) { n.preventDefault() }); c.find(".vis-viewBlock")[0].addEventListener("drop", function (n) { n.preventDefault(); c.find(".vis-active-block").removeClass("vis-active-block"); var r = null, i = t(n.target); i.hasClass("grdDiv") && (fi.hasClass(".fieldLbl") || (r = fi.find(".fieldLbl")), r.length > 0 ? i.append(fi) : (i.addClass("vis-active-block"), po(fi)), it()) }); yi.click(function () { ot > 0 ? (wi = !0, ue = !1, canv_data = JSON.parse(at[ot - 1]), c.find(".vis-viewBlock").html(canv_data), ot--, or.removeAttr("disabled"), of(), wi = !1, ot <= 0 && yi.attr("disabled", "disabled")) : yi.attr("disabled", "disabled"); ge() }); or.click(function () { at[ot + 1] ? (wi = !0, ue = !1, canv_data = JSON.parse(at[ot + 1]), c.find(".vis-viewBlock").html(canv_data), ot++, yi.removeAttr("disabled"), of(), wi = !1, ot >= at.length - 1 && or.attr("disabled", "disabled")) : or.attr("disabled", "disabled"); ge() }); ru.keyup(function () { var n = t(this).val(); n == "" ? b.find(".fieldLbl:not(:first)").show() : (b.find(".fieldLbl").hide(), b.find(".fieldLbl:contains(" + n + ")").show()) }); be.click(function () { ru.val(""); ru.focus(); b.find(".fieldLbl:not(:first)").show() }); pi.change(function () { t(this).val() != "" ? (y.find('[issystemtemplate="Y"]').not(".blankTemp").addClass("displayNone"), y.find('[issystemtemplate="Y"][category="' + t(this).val() + '"]').removeClass("displayNone")) : y.find('[issystemtemplate="Y"]').removeClass("displayNone"); y.find(".vis-cardSingleViewTemplate:not(:hidden)").length == 1 ? y.find(".vis-noTemplateIcon").show() : y.find(".vis-noTemplateIcon").hide() }); jQuery.expr[":"].contains = function (n, t, i) { return jQuery(n).text().toUpperCase().indexOf(i[3].toUpperCase()) >= 0 }; c.find(".vis-viewBlock").on("DOMSubtreeModified", function () { var n = c.height(), t = c.find(".canvas").height(); n && t && t > n ? c.find(".canvas").addClass("canvasOverFlow") : c.find(".canvas").removeClass("canvasOverFlow") }); ke.click(function () { ve() }) } function ge() { b.find(".linked").removeClass("linked vis-succes-clr"); b.find(".fieldLbl:not(:first)").prop("draggable", !0); c.find(".vis-viewBlock").find(".fieldLbl").each(function () { var n = b.find('[fieldid="' + t(this).attr("fieldid") + '"]'); n.find(".fa-circle").addClass("linked vis-succes-clr"); n.prop("draggable", !1) }); b.find('[draggable="true"]:not(:first)').sort(ee).appendTo(b); c.find(".grdDiv").unbind("mouseover"); c.find(".grdDiv").mouseover(function () { hi && !t(this).hasClass("vis-split-cell") && le(t(this)) }) } function ee(n, i) { return t(i).attr("title").toUpperCase() < t(n).attr("title").toUpperCase() ? 1 : -1 } function no() { ut.find("div").unbind("click"); ut.find("div").click(function () { ut.find(".crd-active").removeClass("crd-active"); t(this).addClass("crd-active"); ct.val(-1); sortOrderArray = []; lastSortOrderArray = []; LastCVCondition = []; var n = t(this).attr("idx"); wu = n; l && l.length != 0 && (ro(n), vt.val(l[n].CardViewName), k = l[n].CardViewID, cardViewUserID = l[n].CreatedBy, gi.prop("checked", l[n].DefaultID ? !0 : !1), lr.prop("checked", l[n].UserID == 0 ? !1 : !0), et = l[n].AD_HeaderLayout_ID, l && l[n].OrderByClause && l[n].OrderByClause.length ? ce(l[n].OrderByClause) : cf(), k > 0 ? sf(!0, !1) : sf(!1, !1), to()) }) } function us(i) { h.load(n.Application.contextUrl + "CardViewWizard/Index/?windowno=" + s, function () { h.append(ur); g(!0); li = h.find("#DivCardStep1_" + s); li.hide(); ar = h.find("#btnCardCustomization_" + s); yr = h.find("#btnSaveCloseStep1_" + s); ef = h.find("#btnApplyStep1_" + s); pr = h.find("#BtnLayoutSetting_" + s); vr = h.find("#BtnChangeTemplate_" + s); tf = h.find("#BtnTemplateBack_" + s); btnBack = h.find("#BtnBack_" + s); nr = h.find("#BtnFinesh_" + s); wr = h.find("#btnOnlySave_" + s); ut = h.find("#DivCardList_" + s); vt = h.find("#txtCardName_" + s); wt = h.find("#cmbGroupField_" + s); ft = h.find("#GroupSequenceFeilds_" + s); ri = h.find("#conditionTable_" + s); yt = h.find("#cmbColumn_" + s); pt = h.find("#ddlOperator_" + s); kt = h.find("#valcontainer_" + s); ct = h.find("#cmbOrderClause_" + s); eu = h.find("#sortList_" + s); gi = h.find("#chkDefault_" + s); lr = h.find("#chkPublic_" + s); btnNewCard = h.find("#btnNewCard_" + s); su = h.find("#btnCopy_" + s); gt = h.find("#btnDelete_" + s); kr = h.find("#btnCancle_" + s); pf = h.find("#chkGradient_" + s); hu = h.find("#txtBgColor_" + s); ir = h.find("#DivGrdntBlock_" + s); cu = h.find("#txtGrdntColor1_" + s); lu = h.find("#txtGrdntColor2_" + s); au = h.find("#txtGrdntPrcnt_" + s); vu = h.find("#txtGrdntPrcnt2_" + s); yu = h.find("#cmbGrdntDirection_" + s); ye = h.find("#btnAddCondition_" + s); btnCardAsc = h.find("#btnCardAsc_" + s); btnCardDesc = h.find("#btnCardDesc_" + s); pe = h.find("#btnAddOrder_" + s); df = h.find("#spnLastSaved_" + s); ru = h.find("#txtFilterField_" + s); be = h.find("#btnClearFilter_" + s); ht = h.find("#DivCardStep2_" + s); c = h.find("#DivViewBlock_" + s); e = h.find("#DivStyleSec1_" + s); dr = h.find("#chkAllBorderRadius_" + s); bu = h.find("#chkAllPadding_" + s); ku = h.find("#chkAllMargin_" + s); du = h.find("#chkAllBorder_" + s); o = h.find("#DivGridSec_" + s); y = h.find("#DivTemplate_" + s); b = h.find("#DivCardField_" + s); DivCardFieldSec = h.find("#DivCardFieldSec_" + s); bf = h.find("#txtCustomStyle_" + s); nf = h.find("#txtSQLQuery_" + s); we = h.find("#txtZoomInOut_" + s); kf = h.find("#Btn_BlockCancel_" + s); yi = h.find("#btnUndo_" + s); or = h.find("#btnRedo_" + s); a = ht.find(".vis-topNavigator"); nu = o.find(".rowGap"); tu = o.find(".colGap"); ie = h.find("#btnVaddrow_" + s); re = h.find("#btnVaddCol_" + s); uf = h.find("#btnVdelrow_" + s); ff = h.find("#btnVdelCol_" + s); pi = h.find("#CmbTemplateCategory_" + s); ke = h.find("#BtnRefreshTemplate_" + s); tt = c.find(".section1"); lt = !0; d = !1; fs(); for (var r = 0; r < i.length; r++)y.find(".vis-cardTemplateContainer").append(t(i[r].template)); setTimeout(function () { var r, i; for (fu(), y.find(".vis-cardSingleViewTemplate:not(:hidden)").length == 1 ? y.find(".vis-noTemplateIcon").show() : y.find(".vis-noTemplateIcon").hide(), y.find(".vis-cardSingleViewTemplate").click(function () { y.find(".vis-cardSingleViewTemplate").removeClass("vis-active-template"); t(this).addClass("vis-active-template") }), li.show(), oe(), es(), sf(!0, !1), to(), ss(), rs(), ks(), sr(), si.sort(function (t, i) { var u = t.getHeader().toUpperCase(), r; return ((u == null || u.length == 0) && (u = n.Msg.getElement(n.context, t.getColumnName())), r = i.getHeader().toUpperCase(), (r == null || r.length == 0) && (r = n.Msg.getElement(n.context, i.getColumnName())), u > r) ? 1 : u < r ? -1 : 0 }), se(!1), ct.find("option").remove(), ct.append('<option value="-1"><\/option>)'), r = 0; r < si.length; r++)(i = si[r].getHeader(), i != null && i.length != 0 || (i = n.Msg.getElement(n.context, si[r].getColumnName()), i != null && i.Length != 0)) && ct.append('<option value="' + si[r].getColumnName() + '">' + i + "<\/option>"); l && l.length == 0 ? (pu = !0, btnNewCard.click(), gt.addClass("vis-disable-event"), kr.addClass("vis-disable-event"), su.addClass("vis-disable-event")) : n.context.getContext("CardDialogLaststepSelected_" + s) == 2 && ar.click(); g(!1) }, 1e3) }) } function es() { pi.find("option").remove(); pi.append('<option value="">All<\/option>'); t.ajax({ type: "POST", url: n.Application.contextUrl + "CardView/GetTemplateCategory", dataType: "json", contentType: "application/json; charset=utf-8", data: {}, success: function (n) { var i = JSON.parse(n), t; if (i) for (t = 0; t < i.length; t++)pi.append('<option value="' + i[t].TemplateCategoryID + '">' + i[t].Name + "<\/option>"); g(!1) }, error: function (n) { alert(n.statusText); g(!1) } }) } function hs(n) { var f = {}, e, r; dt = {}; var u = "", o = "", t = null, i = null, s = null, h = null, c = null, l = null, a = null, v = null; for (e = 0; e < n.length; e++) { for (dt = {}, dt.Color = n[e].Color, dt.Condition = [], u = n[e].ConditionValue.split("&"), o = n[e].ConditionText.split("&"), r = 0; r < u.length; r++)f = {}, u[r].contains("!") ? (t = u[r].trim().split("!"), i = o[r].trim().split("!"), a = "!", v = "!=", s = i[0].trim().substring(1, i[0].lastIndexOf("@")), h = t[0].trim().substring(1, t[0].lastIndexOf("@")), l = i[1], c = t[1]) : u[r].contains("=") ? (t = u[r].split("="), i = o[r].split("="), a = "=", v = "=", s = i[0].trim().substring(1, i[0].lastIndexOf("@")), h = t[0].trim().substring(1, t[0].lastIndexOf("@")), l = i[1], c = t[1]) : u[r].contains("<") ? (t = u[r].split("<"), i = o[r].split("<"), a = "<", v = "<", s = i[0].trim().substring(1, i[0].lastIndexOf("@")), h = t[0].trim().substring(1, t[0].lastIndexOf("@")), l = i[1], c = t[1]) : u[r].contains(">") && (t = u[r].split(">"), i = o[r].split(">"), a = ">", v = ">", s = i[0].trim().substring(1, i[0].lastIndexOf("@")), h = t[0].trim().substring(1, t[0].lastIndexOf("@")), l = i[1], c = t[1]), f.ColHeader = s, f.ColName = h, f.Operator = a, f.OperatorText = v, f.QueryValue = c, f.QueryText = l, dt.Condition.push(f); p.push(dt) } uu(p) } function he(t) { g(!0); window.setTimeout(function () { var r = "", u = "", f; for (strConditionArray = [], f = "", i = 0; i < p.length; i++) { for (r = "", u = "", j = 0; j < p[i].Condition.length; j++)j == 0 ? (r += "@" + p[i].Condition[j].ColName + "@" + p[i].Condition[j].Operator + p[i].Condition[j].QueryValue, u += "@" + p[i].Condition[j].ColHeader + "@" + p[i].Condition[j].Operator + p[i].Condition[j].QueryText) : (r += " & @" + p[i].Condition[j].ColName + "@" + p[i].Condition[j].Operator + p[i].Condition[j].QueryValue, u += " & @" + p[i].Condition[j].ColHeader + "@" + p[i].Condition[j].Operator + p[i].Condition[j].QueryText); strConditionArray.push({ Color: p[i].Color.toString(), ConditionValue: r, ConditionText: u }) } if (d) { if (vt.val() == "") return n.ADialog.error("FillMandatory", !0, "Name"), g(!1), !1 } else if (!d && k < 1 && n.MRole.isAdministrator) return n.ADialog.error("ClickNew", !0, ""), g(!1), !1; ls(); t.stopPropagation(); t.preventDefault() }, 50) } function fo(n) { var t, i; if (n == null || n.length == 0) return null; for (t = 0; t < v.getFields().length; t++)if (i = v.getFields()[t], n.equals(i.getColumnName())) return i; return null } function hf(t) { var i = null, r; return (t && (i = ii), i != null) ? i.getDisplayType() == n.DisplayType.YesNo ? i.getValue().toString().toLowerCase() == "true" ? "Y" : "N" : n.DisplayType.IsDate(i.getDisplayType()) ? (r = i.getValue(), r && r.endsWith(".000Z") && (r = r.replace(".000Z", "Z")), r) : (n.DisplayType.IsNumeric(i.getDisplayType()), i.getValue() == "") ? null : i.getValue() : "" } function vs(t) { var i = null; if (t && (i = ii), i != null) { if (i.getDisplayType() == n.DisplayType.YesNo) return i.getValue().toString().toLowerCase() == "true" ? "Y" : "N"; i.setValue(null) } } function eo(n) { var t = null; return (n && (t = ii), t != null) ? t.getDisplay() : "" } function ys(n) { var t = null; return (n && (t = ii), t != null) ? t.getDisplayType("") : "" } function oo(n) { var t = null; n && (t = ii); t != null && t.setValue(null) } function ps(n) { var r = kt.children()[1], i = null; kt.children().length > 2 && (i = kt.children()[2]); i ? t(i).prop("disabled", !n).prop("readonly", !n) : r != null && t(r).prop("disabled", !n).prop("readonly", !n) } function ws(n, t) { n.prop("disabled", !t) } function so(i, r) { var f, o, u, e; i && (ii = null); ko = null; f = null; o = null; i && (f = kt.children()[0], kt.children().length > 1 && (o = kt.children()[1])); f != null && (t(f).remove(), o != null && t(o).remove(), f = null); u = null; u = r != null ? r.getIsKey() ? new n.Controls.VNumTextBox(r.getColumnName(), !1, !1, !0, r.getDisplayLength(), r.getFieldLength(), r.getColumnName()) : n.VControlFactory.getControl(null, r, !0, !0, !1) : new n.Controls.VTextBox("columnName", !1, !0, !1, 20, 20, "format", "GetObscureType", !1); u != null && (u.setReadOnly(!1), n.DisplayType.Text == r.getDisplayType() || n.DisplayType.TextLong == r.getDisplayType() ? (u.getControl().attr("rows", "1"), u.getControl().css("width", "100%")) : n.DisplayType.YesNo == r.getDisplayType() ? u.getControl().css("clear", "both") : n.DisplayType.IsDate(r.getDisplayType()) && u.getControl().css("line-height", "1"), e = null, u.getBtnCount() > 0 && !(u instanceof n.Controls.VComboBox) && (e = u.getBtn(0)), i && (kt.find("label").remove(), kt.append(u.getControl().css("width", "95%")), ii = u, e && (kt.append(e), e.css("max-width", "35px")), n.DisplayType.YesNo != r.getDisplayType() && kt.append('<label for="txtQueryValue">' + n.Msg.getMsg("QueryValue") + "<\/label>"))) } function ce(n) { var t, i, r; if (cf(), n && n.length > 0) for (sortOrderArray = n.split(","), t = 0; t < sortOrderArray.length; t++)i = sortOrderArray[t].split(" "), r = v.getField(i[0]), ho(r.getHeader(), i[0], i[1]) } function cf() { eu.empty(); sortOrderArray = []; lastSortOrderArray = [] } function ho(n, t, i) { var r = '<div class="vis-sortListItem"><p>' + n + '<\/p><div class="vis-sortListIcons"><span class="vis-sortAsc">'; r += i == "ASC" ? '<i class="fa fa-sort-amount-asc"><\/i>' : '<i class="fa fa-sort-amount-asc" style="transform: rotate(180deg);padding-top:1px"><\/i>'; r += '<\/span><span class="vis-sortIcon vis-sortListItemClose" data-text="' + t + " " + i + '"><i class="fa fa-close"><\/i><\/span><\/div><\/div>'; eu.append(r) } function co() { var i = y.find(".vis-active-template").clone(!0); i.attr("lastupdated") && df.text(n.Msg.getMsg("LastSaved") + " " + i.attr("lastupdated")); i.find(".grdDiv").html(""); i.find(".mainTemplate").css("zoom", 1); ts = i.attr("createdBy"); gf = i.attr("isSystemTemplate"); et = i.find(".mainTemplate").attr("templateid"); wf = Number(et); iu = i.find(".mainTemplate").attr("name"); et == "0" && i.find(".mainTemplate").html(t('<div name="Section 1" sectionCount="1" class="section1 vis-wizard-section" style="padding:5px;"><\/div>')); (i.html() != "" || i.html() != null) && (i.find(".vis-wizard-section").each(function () { for (var u = t(this).attr("row"), i = t(this).attr("col"), n = [], r = 0; r < u * i; r++)n.push('<div class="grdDiv" style="display:none"><\/div>'); t(this).find(".grdDiv").each(function () { var r = t(this).css("grid-area").split("/"), u = i * (t.trim(r[0]) - 1) + (t.trim(r[1]) - 1); (t.trim(r[0]) != t.trim(r[2]) - 1 || t.trim(r[1]) != t.trim(r[3]) - 1) && -t(this).addClass("vis-split-cell"); n[u] = t(this)[0].outerHTML }); t(this).html(n.join(" ")) }), c.find(".grdDiv").unbind("mouseover"), c.find(".vis-viewBlock").attr("style", i.find(".mainTemplate").attr("style") || ""), c.find(".vis-viewBlock").html(i.find(".mainTemplate").html()), c.find(".grdDiv").mouseover(function () { hi && !t(this).hasClass("vis-split-cell") && le(t(this)) }), c.find(".vis-viewBlock")[0].addEventListener("dragstart", function (n) { fi = t(n.target); fi.hasClass("grdDiv") ? n.preventDefault() : (a.hide(), hi = !1) }, !1)) } function ni(n, i) { var s, c, f, u, v, p; n || (n = 0); i || (i = 0); var y = o.find(".section-active").attr("sectionCount"), w = o.find(".section-active .vis-grey-disp-ttl").text(), r = {}, h = ""; o.find(".rowBox:not(:first)").each(function (n) { n == 0 && t(this).find(".grdRowDel").hide(); h += t(this).find("select :selected").val() == "auto" ? t(this).find("select :selected").val() + " " : t(this).find("input").val() + "" + t(this).find("select :selected").val() + " "; r["row_" + n] = { val: t(this).find("input").val(), msr: t(this).find("select :selected").val() } }); s = ""; o.find(".colBox:not(:first)").each(function (n) { n == 0 && t(this).find(".grdColDel").hide(); s += t(this).find("select :selected").val() == "auto" ? t(this).find("select :selected").val() + " " : t(this).find("input").val() + "" + t(this).find("select :selected").val() + " "; r["col_" + n] = { val: t(this).find("input").val(), msr: t(this).find("select :selected").val() } }); c = o.find(".rowBox:not(:first)").length; f = o.find(".colBox:not(:first)").length; r.sectionNo = y; r.sectionName = w; r.rowGap = nu.val(); r.colGap = tu.val(); r.totalRow = c; r.totalCol = f; rt["section" + y] = r; u = tt; u.attr("row", c); u.attr("col", f); u.css({ "grid-template-columns": s, "grid-template-rows": h, gap: nu.val() + "px " + tu.val() + "px" }); var e = !1, l = ci, a = ai; n == -1 && l--; i == -1 && a--; v = 0; p = vi; u.find(".grdDiv").each(function (r) { var c = t(this).css("grid-area").split("/"), o = Number(t.trim(c[0])), s = Number(t.trim(c[2])), y = Number(t.trim(c[1])), w = Number(t.trim(c[3])), k = Math.floor(r / f) + 1, d, nt, h, g, b; if (ci != null) { if (ci > o - 1 && ci < s - 1 && (t(this).css("grid-area", o + "/" + y + "/" + (s + n) + "/" + w), e = !0), e && n > 0) { for (h = Number(o); h <= Number(s); h++) { for (d = y; d < w; d++)nt = f * h + d, u.find(".grdDiv").eq(nt - 1).css("display", "none"); if (ci == h) break } e = !1; ci = null } } else if (ai != null && (ai > y - 1 && ai < w - 1 && (t(this).css("grid-area", o + "/" + y + "/" + s + "/" + (w + i)), e = !0, u.find(".grdDiv").eq(p[v]).css("display", "none")), v++, e && i > 0)) { for (h = 0; h < vi.length; h++)g = Math.floor(vi[h] / f) + 1, g > o - 1 && g < s && u.find(".grdDiv").eq(vi[h]).css("display", "none"); e = !1; vi = [] } c = t(this).css("grid-area").split("/"); o = Number(t.trim(c[0])); s = Number(t.trim(c[2])); y = Number(t.trim(c[1])); w = Number(t.trim(c[3])); b = r % f + 1; t(this).hasClass("vis-split-cell") ? i != 0 ? i > 0 ? b > a && t(this).css("grid-area", o + "/" + (y + i) + "/" + s + "/" + (w + i)) : b > a && t(this).css("grid-area", o + "/" + (y - 1) + "/" + s + "/" + (w - 1)) : n != 0 && (n > 0 ? k > l && t(this).css("grid-area", o + n + "/" + y + "/" + (s + n) + "/" + w) : k > l && t(this).css("grid-area", o - 1 + "/" + y + "/" + (s - 1) + "/" + w)) : t(this).css("grid-area", k + "/" + b + "/" + (k + 1) + "/" + (b + 1)) }); ai = null } function lo() { var l = o.find(".rowBox"), a = o.find(".colBox"), e = l.length - 1, r = a.length - 1, n = tt, s, u, i, h, c, f; if (r > 0 && e > 0) { if (s = n.attr("row"), u = n.attr("col"), u == r || ne) for (c = e * r - n.find(".grdDiv").length, f = 0; f < c; f++)n.append("<div class='grdDiv' style='padding:5px;display: flex; flex-direction: row;'><\/div>"); else for (i = 1; i <= s; i++)h = i * u + (i - 1), n.find(".grdDiv").eq(h - 1).after("<div class='grdDiv' style='padding:5px;display: flex; flex-direction: row;'><\/div>"); n.find(".grdDiv").unbind("mouseover"); n.find(".grdDiv").mouseover(function (n) { n.preventDefault(); hi && !t(this).hasClass("vis-split-cell") && le(t(this)) }); ne = !1 } ni() } function ds() { var n, r; o.find(".rowBox:not(:first)").remove(); var u = o.find(".section-active").attr("sectionCount"), t = rt["section" + u], i = o.find(".rowBox:first").clone(!0); if (i.show(), o.find(".colBox:not(:first)").remove(), n = o.find(".colBox:first").clone(!0), n.show(), t) { for (let u in t) r = t[u], u.indexOf("row_") != -1 ? (i.find("input").val(r.val), i.find("select").val(r.msr), o.find(".DivRowBox").append(i), i = o.find(".rowBox:last").clone(!0)) : u.indexOf("col_") != -1 && (n.find("input").val(r.val), n.find("select").val(r.msr), o.find(".DivColBox").append(n), n = o.find(".colBox:last").clone(!0)); nu.val(t.rowGap); tu.val(t.colGap); o.find(".rowBox .grdRowDel").eq(1).hide(); o.find(".colBox .grdColDel").eq(1).hide() } } function le(n) { var r = o.find(".colBox").length - 1, u = tt.find(n).index(), t, i; if (!(u < 0)) { var y = Math.ceil((u + 1) / r) - 1, f = u - r * y, e = y, s, h, l, v; for (e < gr ? (s = e, h = gr) : (s = gr, h = e), f < gu ? (l = f, v = gu) : (l = gu, v = f), c.find(".vis-active-block").removeClass("vis-active-block"), t = s; t <= h; t++)for (i = l; i <= v; i++)tt.find(".grdDiv").eq(r * t + i).addClass("vis-active-block"); c.find(".vis-active-block").length > 1 ? a.find('[command="Merge"]').parent().show() : a.find('[command="Merge"]').parent().hide() } } function ao() { var i = 0, e = 0, r = 0, u = 1, n = 0, s = 1, l = tt.find(".vis-active-block").length, h = 1, f = 0, a = o.find(".colBox").length - 1, c; tt.find(".grdDiv").each(function (o) { n++; var c = Math.ceil((o + 1) / a); c != h && (n = 1); h = c; t(this).hasClass("vis-active-block") && (f == 0 && (f = c), i == 0 && r == 0 && (i = c, r = n, u = n), f == c && u++, s == l && (e = c + 1), s++, t(this)[0].style.removeProperty("grid-area"), t(this)[0].style.removeProperty("display")) }); c = t('<span class="vis-split-cell"><\/span>'); tt.find(".vis-active-block:not(:first)").hide().removeClass("vis-active-block"); tt.find(".vis-active-block:first").css("grid-area", i + "/" + r + "/" + e + "/" + u).addClass("vis-split-cell"); c.click(function () { vo(t(this).parent()); t(this).remove() }) } function vo(n) { for (var r, f, i = n.css("grid-area").split("/"), s = o.find(".colBox").length - 1, e = tt.find(".grdDiv"), u = Number(t.trim(i[0])); u < Number(t.trim(i[2])); u++)for (r = Number(t.trim(i[1])); r < Number(t.trim(i[3])); r++)f = s * (u - 1) + (r - 1), e.eq(f)[0].style.removeProperty("grid-area"), e.eq(f)[0].style.removeProperty("display"); ni() } function ae(n, i, r) { var f = r.attr("style"), u = !1; return f && f.split(";").forEach(function (r) { var f = r.split(":"); i && t.trim(f[0]) === n && t.trim(f[1]) === i ? u = !0 : i || t.trim(f[0]) !== n || (u = !0) }), u } function ki(n, i) { var r = c.find(".vis-active-block"), u; if (nt[n].proprty == "flex-direction" && (r[0].style.removeProperty("display"), r.find(".fieldGroup").removeAttr("style")), n == "maxTextmultiline" && (i == "" || i == null ? (r[0].style.removeProperty("overflow"), r[0].style.removeProperty("display"), r[0].style.removeProperty("-webkit-box-orient")) : r.css({ overflow: "hidden", display: "-webkit-box", "-webkit-box-orient": "vertical" })), n != "gradient" && (i == "" || i == null)) { r[0].style.removeProperty(nt[n].proprty); return } if (n == "gradient") { var f = e.find("." + n + "1").val(), o = e.find("." + n + "2").val(), s = e.find(".percent1").val(), h = e.find(".percent2").val(), l = e.find(".grdDirection option:selected").val(); i = "linear-gradient(" + l + "," + f + " " + s + "%,  " + o + " " + h + "%)"; e.find('[data-command="gradientInput"]').val("(" + l + "," + f + " " + s + "%,  " + o + " " + h + "%)") } if (n == "gradientInput" && (i = "linear-gradient" + i), n == "boxShadow") { var a = e.find(".boxX").val(), v = e.find(".boxY").val(), y = e.find(".boxB").val(), p = e.find(".boxC").val(); i = a + " " + v + " " + y + " " + p } (nt[n].proprty == "justify-content" || nt[n].proprty == "align-items" || nt[n].proprty == "flex-direction") && (r.css("display", "flex"), nt[n].proprty == "flex-direction" && r.find(".fieldGroup").css({ display: "flex", "flex-direction": t.trim(i) })); i == "column" || i == "column-reverse" ? e.find('[data-command1="flexJustifyStart"]').closest(".vis-horz-align-d").addClass("vis-disable-event") : e.find('[data-command1="flexJustifyStart"]').closest(".vis-horz-align-d").removeClass("vis-disable-event"); r.css(nt[n].proprty, t.trim(i)); (n == "width" || n == "height") && (u = r.attr("style"), u = u.replace(nt[n].proprty + ": " + t.trim(i), nt[n].proprty + ":" + t.trim(i) + "!important"), r.attr("style", u)); it() } function gs() { var r = n.Application.contextUrl + "CardView/getTemplateDesign", i; y.find('.vis-cardSingleViewTemplate[issystemtemplate="N"]').remove(); i = { ad_Window_ID: v.getAD_Window_ID(), ad_Tab_ID: v.getAD_Tab_ID() }; t.ajax({ type: "POST", url: r, dataType: "json", contentType: "application/json; charset=utf-8", data: JSON.stringify(i), success: function (n) { for (var r = JSON.parse(n), i = 0; i < r.length; i++)y.find(".vis-cardTemplateContainer").append(t(r[i].template)); g(!1) }, error: function (n) { alert(n.statusText); g(!1) }, complete: function () { y.find(".vis-cardSingleViewTemplate").click(function () { y.find(".vis-cardSingleViewTemplate").removeClass("vis-active-template"); t(this).addClass("vis-active-template") }) } }) } function ve() { var i, r; g(!0); i = n.Application.contextUrl + "CardView/GetSystemTemplateDesign"; y.find('.vis-cardSingleViewTemplate[issystemtemplate="Y"]:not(:first)').remove(); r = {}; t.ajax({ type: "POST", url: i, dataType: "json", contentType: "application/json; charset=utf-8", data: JSON.stringify(r), success: function (n) { var r, i; for (fe = !0, r = JSON.parse(n), i = 0; i < r.length; i++)y.find(".vis-cardTemplateContainer").append(t(r[i].template)); y.find(".vis-deleteTemplate").remove(); fu(); setTimeout(function () { fu(); g(!1); y.find(".vis-cardSingleViewTemplate:not(:hidden)").length == 1 ? y.find(".vis-noTemplateIcon").show() : y.find(".vis-noTemplateIcon").hide() }, 1e3) }, error: function (n) { alert(n.statusText); g(!1) }, complete: function () { y.find(".vis-cardSingleViewTemplate").click(function () { y.find(".vis-cardSingleViewTemplate").removeClass("vis-active-template"); t(this).addClass("vis-active-template") }) } }) } function yo(i) { var u, o, r, h, a; if (d && vt.val() == "") return n.ADialog.error("FillMandatory", !0, "Name"), g(!1), !1; if (d && l != null) for (u = 0; u < l.length; u++)if (l[u].CardViewName.trim() == vt.val().trim()) return n.ADialog.error("cardAlreadyExist", !0, ""), g(!1), !1; g(!0); var f = [], e = 10, s = []; if (oi = [], o = !1, c.find(".grdDiv:not(:hidden)").each(function () { var n = t(this).css("grid-area").split("/"), r = t(this).closest(".vis-wizard-section").attr("sectioncount"), u, s, c, l, h, i; rt["section" + r].style = t(this).closest(".vis-wizard-section").attr("style"); rt["section" + r].sectionID = t(this).closest(".vis-wizard-section").attr("sectionid") || 0; u = (t(this).closest(".vis-wizard-section").index() + 1) * 10; rt["section" + r].sectionSeq = u; rt["section" + r].sectionName = t(this).closest(".vis-wizard-section").attr("name"); s = null; t(this).find("sql").length > 0 && (s = t(this).attr("query") || null); t(this).find(".fieldGroup:not(:hidden)").length > 0 ? t(this).find(".fieldGroup:not(:hidden)").each(function () { var i, l, h, c, r; o = !0; i = ""; t(this).find(".imgField").length > 0 ? (l = t(this).find("br").length, t(this).find(".imgField").next(".fieldValue").length > 0 ? (i = "@img::" + t(this).find(".imgField").attr("style") || "", l > 0 && (i += "|<br>"), i += " |@value::" + t(this).find(".fieldValue").attr("style") || "display:none") : (i = "@value::" + t(this).find(".fieldValue").attr("style") || "display:none", l > 0 && (i += "|<br>"), i += " |@img::" + t(this).find(".imgField").attr("style") || "")) : i = t(this).find(".fieldValue").attr("style") || ""; h = !0; t(this).find(".fa-star").length == 0 && (h = !0); t(this).find(".fieldLbl").attr("showfieldicon") && (h = t(this).find(".fieldLbl").attr("showfieldicon") == "true" ? !0 : !1); c = { cardFieldID: t(this).attr("cardfieldid"), sectionNo: u, rowStart: t.trim(n[0]), rowEnd: t.trim(n[2]), colStart: t.trim(n[1]), colEnd: t.trim(n[3]), seq: e, style: t(this).closest(".grdDiv").attr("style"), fieldID: t(this).find(".fieldLbl").attr("fieldid"), valueStyle: i, fieldStyle: t(this).find(".fieldLbl").attr("style") || "", hideFieldIcon: h, hideFieldText: t(this).find(".fieldLbl").attr("showfieldtext") == "true" ? !0 : !1, columnSQL: s, contentFieldValue: null, contentFieldLabel: null }; r = {}; r.AD_Field_ID = c.fieldID; r.CardViewID = k; r.SeqNo = c.seq; oi.push(r); f.push(c) }) : (c = !1, t(this).attr("showfieldtext") && (c = t(this).attr("showfieldtext") == "Y" ? !0 : !1), l = !1, t(this).attr("showfieldicon") && (l = t(this).attr("showfieldicon") == "Y" ? !0 : !1), h = { cardFieldID: null, sectionNo: u, rowStart: t.trim(n[0]), rowEnd: t.trim(n[2]), colStart: t.trim(n[1]), colEnd: t.trim(n[3]), seq: e, style: t(this).attr("style"), fieldID: null, valueStyle: t(this).attr("fieldValuestyle"), fieldStyle: t(this).attr("fieldValueLabel"), hideFieldIcon: l, hideFieldText: c, columnSQL: s, contentFieldValue: null, contentFieldLabel: null }, i = {}, i.AD_Field_ID = h.fieldID, i.CardViewID = k, i.SeqNo = h.seq, oi.push(i), f.push(h)); e += 10 }), !o) return n.ADialog.error("FillMandatory", !0, "Link atleast one field"), g(!1), !1; Object.keys(rt).forEach(function (n) { var t = { sectionName: rt[n].sectionName, sectionID: rt[n].sectionID, sectionNo: rt[n].sectionSeq, style: rt[n].style, totalRow: rt[n].totalRow, totalCol: rt[n].totalCol, rowGap: rt[n].rowGap, colGap: rt[n].colGap }; s.push(t) }); gf == "Y" && (iu = (iu || vt.val()) + "_" + Math.floor(Math.random() * 1e4), et = 0); er && (iu = vt.val() + "_" + Math.floor(Math.random() * 1e4), et = 0, k = "undefined", d = !0); r = k; r == "undefined" && (r = 0); d && (r = 0); h = { CardViewID: r, templateID: et || 0, templateName: iu, templateCategory: 0, style: c.find(".vis-viewBlock").attr("style"), cardSection: s, cardTempField: f, isSystemTemplate: "N", refTempID: wf || 0 }; a = n.Application.contextUrl + "CardView/SaveCardTemplate"; t.ajax({ type: "POST", async: !1, url: a, dataType: "json", contentType: "application/json; charset=utf-8", data: JSON.stringify(h), success: function (n) { var t = JSON.parse(n); if (isNaN(t)) { toastr.error(t, "", { timeOut: 3e3, positionClass: "toast-top-center", closeButton: !0 }); g(!1); return } et = t; gf = "N"; d || (lt = !0); g(!1); he(i) }, error: function (n) { alert(n.statusText); g(!1) } }) } function nh(i) { e.find('[data-command1="flexJustifyStart"]').closest(".vis-horz-align-d").removeClass("vis-disable-event"); e.find("#master001_" + s + " input").val(""); e.find("#master001_" + s + " select").val(""); e.find(".vis-back-color03").css("background-color", "teal"); e.find(".gradient2").val("#000"); e.find(".percent1").val("0"); e.find(".percent2").val("100"); e.find(".grdDirection").val("to bottom"); dr.prop("checked", !0); e.find(".allBorderRadius").removeClass("displayNone"); e.find(".singleBorderRadius").addClass("displayNone"); e.find("[data-command1]").parent().removeClass("vis-hr-elm-inn-active"); var r = i.attr("style"); i.find("sql").length > 0 && i.attr("query") ? nf.val(n.secureEngine.decrypt(i.attr("query"))) : nf.val(""); bf.val(r); r && r.split(";").forEach(function (n) { var f = n.split(":"), u, r, o; for (const n in nt) if ((t.trim(f[0]) == "border-left" || t.trim(f[0]) == "border-right" || t.trim(f[0]) == "border-top" || t.trim(f[0]) == "border-bottom") && (f[0] = f[0] + "-width"), t.trim(f[0]) == t.trim(nt[n].proprty)) if (u = t.trim(f[1]), nt[n].value == "") { (n == "width" || n == "height") && (u = u.replaceAll("!important", "")); n == "fontFamily" && (u = u.replaceAll('"', "")); n == "padding" && t.trim(u).split(" ").length > 1 ? (bu.prop("checked", !1), e.find(".allPadding").addClass("displayNone"), e.find(".singlePadding").removeClass("displayNone"), e.find("[data-command='paddingLeft']").val(i.css("padding-left")), e.find("[data-command='paddingTop']").val(i.css("padding-top")), e.find("[data-command='paddingRight']").val(i.css("padding-right")), e.find("[data-command='paddingBottom']").val(i.css("padding-bottom"))) : n == "padding" ? (bu.prop("checked", !0), e.find(".allPadding").removeClass("displayNone"), e.find(".singlePadding").addClass("displayNone"), e.find("[data-command='" + n + "']").val(u)) : n == "margin" && t.trim(u).split(" ").length > 1 ? (ku.prop("checked", !1), e.find(".allMargin").addClass("displayNone"), e.find(".singleMargin").removeClass("displayNone"), e.find("[data-command='marginLeft']").val(i.css("margin-left")), e.find("[data-command='marginTop']").val(i.css("margin-top")), e.find("[data-command='marginRight']").val(i.css("margin-right")), e.find("[data-command='marginBottom']").val(i.css("margin-bottom"))) : n == "margin" ? (ku.prop("checked", !0), e.find(".allMargin").removeClass("displayNone"), e.find(".singleMargin").addClass("displayNone"), e.find("[data-command='" + n + "']").val(u)) : n == "borderRadius" && t.trim(u).split(" ").length > 1 ? (dr.prop("checked", !1), e.find(".allBorderRadius").addClass("displayNone"), e.find(".singleBorderRadius").removeClass("displayNone"), e.find("[data-command='borderTopLeftRadius']").val(i.css("border-top-left-radius")), e.find("[data-command='borderTopRightRadius']").val(i.css("border-top-right-radius")), e.find("[data-command='borderBottomRightRadius']").val(i.css("border-bottom-right-radius")), e.find("[data-command='borderBottomLeftRadius']").val(i.css("border-bottom-left-radius"))) : n == "borderRadius" ? (dr.prop("checked", !0), e.find(".allBorderRadius").removeClass("displayNone"), e.find(".singleBorderRadius").addClass("displayNone"), e.find("[data-command='" + n + "']").val(u)) : e.find("[data-command='" + n + "']").val(u); n == "backgroundColor" ? (e.find(".vis-zero-BTopLeftBLeft:first").css("background-color", u), e.find("[data-command='" + n + "'][type='color']").val(di(u))) : n == "color" ? (e.find(".vis-zero-BTopLeftBLeft:last").css("background-color", u), e.find("[data-command='" + n + "'][type='color']").val(di(u))) : n.indexOf("border") != -1 && n.indexOf("radius") == -1 && (r = i[0].style, r.border == "" ? (r.borderLeftWidth != "" && (e.find("[data-command='borderLeft']").val(r.borderLeftWidth), e.find("[data-command='borderLeftStyle']").val(r.borderLeftStyle), e.find("[data-command='borderLeftColor']").val(di(r.borderLeftColor)), e.find("[data-command='borderLeftColor']").parent().css("background-color", r.borderLeftColor)), r.borderRightWidth != "" && (e.find("[data-command='borderRight']").val(r.borderRightWidth), e.find("[data-command='borderRightStyle']").val(r.borderRightStyle), e.find("[data-command='borderRightColor']").val(di(r.borderRightColor)), e.find("[data-command='borderRightColor']").parent().css("background-color", r.borderRightColor)), r.borderTopWidth != "" && (e.find("[data-command='borderTop']").val(r.borderTopWidth), e.find("[data-command='borderTopStyle']").val(r.borderTopStyle), e.find("[data-command='borderTopColor']").val(di(r.borderTopColor)), e.find("[data-command='borderTopColor']").parent().css("background-color", r.borderTopColor)), r.borderBottomWidth != "" && (e.find("[data-command='borderBottom']").val(r.borderBottomWidth), e.find("[data-command='borderBottomStyle']").val(r.borderBottomStyle), e.find("[data-command='borderBottomColor']").val(di(r.borderBottomColor)), e.find("[data-command='borderBottomColor']").parent().css("background-color", r.borderBottomColor))) : (o = u.split("rgb"), o.length > 1 && (u = u.replace("rgb" + o[1], di("rgb" + o[1]))), e.find("[data-command='" + n + "']").val(u)), r.border == "" && (r.borderTopWidth != "" || r.borderRightWidth != "" || r.borderTopWidth != "" || r.borderBottomWidth != "") ? (du.prop("checked", !1), e.find(".allBorder").addClass("displayNone"), e.find(".singleBorder").removeClass("displayNone")) : (du.prop("checked", !0), e.find(".allBorder").removeClass("displayNone"), e.find(".singleBorder").addClass("displayNone"))); break } else if (nt[n].value == u) { e.find("[data-command1='" + n + "']").parent().addClass("vis-hr-elm-inn-active"); break } }); (e.find("[data-command='flexDirection'] option:selected").val() == "column" || e.find("[data-command='flexDirection'] option:selected").val() == "column-reverse") && e.find('[data-command1="flexJustifyStart"]').closest(".vis-horz-align-d").addClass("vis-disable-event") } function di(n) { try { if (/^#[0-9A-F]{6}$/i.test(n)) return n; n = n.match(/^rgb\((\d+),\s*(\d+),\s*(\d+)\)$/); function t(n) { return ("0" + parseInt(n).toString(16)).slice(-2) } return "#" + t(n[1]) + t(n[2]) + t(n[3]) } catch (t) { return n } } function lf(n, t) { t.closest(".fieldGroup").remove(); var i = b.find('[fieldid="' + t.attr("fieldid") + '"]'); i.find(".linked").removeClass("linked vis-succes-clr"); i.removeAttr("seqNo"); i.prop("draggable", !0); b.find('[draggable="true"]:not(:first)').sort(ee).appendTo(b); t.remove(); a.hide() } function po(i) { var e, u, o, s; if (i && (e = c.find(".vis-active-block"), e.hasClass("grdDiv"))) { var r = t('<div class="fieldGroup" draggable="true"><\/div>'), h = i.attr("fieldid"), f = i.clone(!0); f.attr("showfieldicon", !0); i.find(".vis-grey-icon").remove(); i.attr("draggable", !1); v.getFieldById(Number(h)).getShowIcon() && r.append(t('<i class="fa fa-star">&nbsp;<\/i>')); e.append(r); r.append(i); u = v.getFieldById(Number(h)).getDisplayType(); o = "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' width='50' height='50'%3E%3Cdefs%3E%3Cpath d='M23 31l-3.97-2.9L19 28l-.24-.09.19.13L13 33v2h24v-2l-3-9-5-3-6 10zm-2-12c0-1.66-1.34-3-3-3s-3 1.34-3 3 1.34 3 3 3 3-1.34 3-3zm-11-8c-.55 0-1 .45-1 1v26c0 .55.45 1 1 1h30c.55 0 1-.45 1-1V12c0-.55-.45-1-1-1H10zm28 26H12c-.55 0-1-.45-1-1V14c0-.55.45-1 1-1h26c.55 0 1 .45 1 1v22c-.3.67-.63 1-1 1z' id='a'/%3E%3C/defs%3E%3Cuse xlink:href='%23a' fill='%23fff'/%3E%3Cuse xlink:href='%23a' fill-opacity='0' stroke='%23000' stroke-opacity='0'/%3E%3C/svg%3E"; u == n.DisplayType.Image ? r.append(t('<img class="vis-colorInvert imgField" style="width:100px;height:100px" src="' + o + '"/>')) : u == n.DisplayType.TableDir || u == n.DisplayType.Table || u == n.DisplayType.List || u == n.DisplayType.Search ? (o = "data:image/svg+xml,%3Csvg width='30' height='30' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'%3E%3Cdefs%3E%3Cpath id='a' d='m23,31l-3.97,-2.9l-0.03,-0.1l-0.24,-0.09l0.19,0.13l-5.95,4.96l0,2l24,0l0,-2l-3,-9l-5,-3l-6,10zm-2,-12c0,-1.66 -1.34,-3 -3,-3s-3,1.34 -3,3s1.34,3 3,3s3,-1.34 3,-3zm-11,-8c-0.55,0 -1,0.45 -1,1l0,26c0,0.55 0.45,1 1,1l30,0c0.55,0 1,-0.45 1,-1l0,-26c0,-0.55 -0.45,-1 -1,-1l-30,0zm28,26l-26,0c-0.55,0 -1,-0.45 -1,-1l0,-22c0,-0.55 0.45,-1 1,-1l26,0c0.55,0 1,0.45 1,1l0,22c-0.3,0.67 -0.63,1 -1,1z'/%3E%3C/defs%3E%3Cg%3E%3Cuse transform='matrix(0.567292 0 0 0.499809 0.901418 2.3385)' x='0' y='0' stroke='null' id='svg_1' fill='%23fff' xlink:href='%23a'/%3E%3C/g%3E%3C/svg%3E", r.append(t('<img class="vis-colorInvert imgField" style="width:30px;height:30px" style="display:none" src="' + o + '"/>')), r.append(t('<span class="fieldValue">:Value<\/span>'))) : r.append(t('<span class="fieldValue">:Value<\/span>')); s = b.find(".linked").length; f.find(".fa-circle").addClass("linked vis-succes-clr"); f.prop("draggable", !1); f.attr("seqNo", r.attr("seqNo") || s * 10); b.find(".fieldLbl").eq(s).after(f); th(e) } } function th(n) { var u = "", r = "", y = "", p = !1, f = 0, t = n.attr("fieldValuestyle"), e, i, o, l, s, v; if (t && t.indexOf("|") > -1) { if (e = t.split("<br>"), t = t.split("|"), t && t.length > 0) { for (t[0].indexOf("@img::") > -1 && (p = !0), i = 0; i < t.length; i++)t[i].indexOf("@img::") > -1 ? r = t[i].replace("@img::", "") : t[i].indexOf("@value::") > -1 ? u = t[i].replace("@value::", "") : t[i].indexOf("@span::") > -1 && (y = t[i].replace("@span::", "")); e != null && e.length > 1 && (f = t[0].indexOf("@img::") > -1 ? 1 : 2) } } else t && t.indexOf("@img::") > -1 ? r = t.replace("@img::", "") : u = t && t.indexOf("@value::") > -1 ? t.replace("@value::", "") : t; o = ""; n.attr("showfieldicon") && (l = n.attr("showfieldicon") == "Y" ? !0 : !1, n.find(".fieldLbl").attr("showfieldtext", l)); n.attr("showfieldtext") && (s = n.attr("showfieldtext") == "Y" ? !0 : !1, o = s ? "displayNone" : "", n.find(".fieldLbl").attr("showfieldtext", s)); n.find(".fieldValue").attr("style", u); n.find(".fieldLbl").attr("style", n.attr("fieldValueLabel")); n.find(".fieldLbl").addClass(o); r != "" && r != undefined && n.find(".imgField").attr("style", r); f == 1 ? n.find(".fieldValue").prepend("<br>") : f == 2 && n.find(".fieldValue").append("<br>"); var h = n.attr("style"), c = h.indexOf("flex-direction"), a = ""; c > -1 && (v = h.indexOf(";", c + 14), a = "display:flex; " + h.substring(c, v), n.find(".fieldGroup").attr("style", a)); n.attr("fieldValuestyle") && n.attr("fieldValuestyle").indexOf("@img::") == -1 && n.find(".fieldGroup .fieldValue").length > 0 && n.find(".fieldGroup .imgField").length > 0 && n.find(".fieldGroup .imgField").css("display", "none") } function ih(t) { if (t == null || t == "") return n.ADialog.info("FileNameMendatory"), !1; for (var i = 0; i < l.length; i++)if (l[i].CardViewName.trim() == t.trim()) return n.ADialog.error("cardAlreadyExist", !0, ""), g(!1), !1; vt.val(t); er = !0; ar.click(); bi.close() } function fu() { y.find(".vis-cardSingleViewTemplate").each(function () { var f = t(this).height(), e = t(this).width(), n = t(this).find(".mainTemplate"), o = n.height(), s = n.width(), i = 1, r = f / o, u = e / s; i = r > u ? u : r; n.css("zoom", i) }) } function bo() { return st.close(), !0 } function it() { var t = c.find(".vis-viewBlock").html(), n; ot < at.length - 1 && (at = at.slice(0, ot + 1), ot++); n = JSON.stringify(t); (n != at[ot] || is == 1) && (at.push(n), at.length > 11 && at.shift(), ot = at.length - 1); ht.find(".vis-v-rowcol").hide(); or.attr("disabled", "disabled"); yi.removeAttr("disabled") } function rh(n) { ht.find(".vis-v-rowcol").show(); var r = t(n.target).index(), i = uh(r); i.rowNo == 1 && uf.hide(); i.colNo == 1 && ff.hide(); ie.css({ left: t(n.target).closest(".vis-viewBlock")[0].offsetLeft - 38, top: t(n.target).height() + t(n.target)[0].offsetTop }); uf.css({ left: t(n.target).closest(".vis-viewBlock")[0].offsetLeft - 20, top: t(n.target).height() + t(n.target)[0].offsetTop }); re.css({ top: t(n.target).closest(".vis-viewBlock")[0].offsetTop - 20, left: t(n.target).width() - 8 + t(n.target)[0].offsetLeft }); ff.css({ top: t(n.target).closest(".vis-viewBlock")[0].offsetTop - 20, left: t(n.target).width() - 5 + t(n.target)[0].offsetLeft + 15 }) } function uh(n) { var t = o.find(".colBox").length - 1, i = Math.floor(n / t) + 1, r = n % t + 1; return { rowNo: i, colNo: r } } var hr = this, ei = r.curGC, v = ei.getMTab(), s = v.getWindowNo(), bt = ei.vCardView, af = v.getAD_Window_ID(), vf = v.getAD_Tab_ID(), k = bt.getAD_CardView_ID(), ti = bt.getField_Group_ID(), w = v.getFields(), yf = v.getFields().slice(), ii = null, ko = null, kt = null, go = [], cr = [], oi = [], si = [], ns = [], ri = null, p = [], dt = null, gi = null, lr = null, h, st, ar = null, vr = null, yr = null, li = null, ht = null, pr = null, nr = null, wr = null, tr = 1, br = null, ui = null, l = [], ut = null, vt = null, yt = null, pt = null, wt = null, ft = null, ct = null, eu = null, ou = "ASC", su = null, gt = null, kr = null, pf = null, hu = null, ir = null, cu = null, lu = null, au = null, vu = null, yu = null, ye = null, lt = !1, d = !1, rr = !0, pe = null, ur = null, pu = !0, wu = null, hi = !1, c = null, e = null, dr = null, bu = null, ku = null, du = null, y = null, o = null, gr = null, gu = null, nu = null, tu = null, b = null, tt = null, fr = 2, et = 0, wf = 0, iu = null, bf = null, nf = null, ts = null, we = null, a = null, kf = null, tf = null, df = null, rf = !1, gf = "Y", er = !1, fi = null, ci = null, ai = null, vi = [], ne = !1, te = !1, ie = null, re = null, uf = null, ff = null, ru = null, be = null, rt = {}, yi = null, or = null, ef = null, pi = null, wi = !1, at = [], ue = !0, ot = 0, is = 0, bi = null, fe = !1, ke = null, sr = function () { var n = cu.val(), t = lu.val(), i = au.val(), r = vu.val(), u = yu.find("option:selected").val(), f = "linear-gradient(" + u + "," + n + " " + i + "%,  " + t + " " + r + "%)"; ir.find(".grd-preview").css("background", f) }, fs = function () { for (var n = 0; n < v.getFields().length; n++)si.push(v.getFields()[n]); for (n = 0; n < bt.fields.length; n++)ns.push(bt.fields[n].getAD_Field_ID()) }, oe = function (i) { var r = n.Application.contextUrl + "CardView/GetCardView"; ut.html(""); t.ajax({ type: "GET", async: !1, url: r, dataType: "json", contentType: "application/json; charset=utf-8", data: { ad_Window_ID: af, ad_Tab_ID: vf }, success: function (n) { var e, r, f, u; if (ui = JSON.parse(n), l = ui[0].lstCardViewData, br = ui[0].lstCardViewConditonData, l != null && l.length > 0) { for (gt.removeClass("vis-disable-event"), e = !1, r = 0; r < l.length; r++)f = "", !i && k ? f = l[r].CardViewID == k ? '<div idx="' + r + '" class="vis-lft-sgl p-2 d-flex flex-column mb-2 crd-active">' : '<div idx="' + r + '" class="vis-lft-sgl p-2 d-flex flex-column mb-2">' : l[r].DefaultID && !i ? (e = !0, f = '<div idx="' + r + '" class="vis-lft-sgl p-2 d-flex flex-column mb-2 crd-active">') : f = i && l[r].CardViewID == k ? '<div idx="' + r + '" class="vis-lft-sgl p-2 d-flex flex-column mb-2 crd-active">' : '<div idx="' + r + '" class="vis-lft-sgl p-2 d-flex flex-column mb-2">', f += '<span class="vis-lft-sgl-title">' + w2utils.encodeTags(l[r].CardViewName) + '<\/span>    <span class="vis-lft-sgl-sub-title">Created By: ' + l[r].CreatedName + '<\/span>    <span class="vis-lft-sgl-sub-title">Last Modified: ' + new Date(l[r].Updated).toLocaleDateString() + "<\/span><\/div>", ut.append(t(f)); e || i || k || (ut.find("div:first").addClass("crd-active"), i = !0); u = ut.find(".crd-active").attr("idx"); wu = u; k = l[u].CardViewID; vt.val(l[u].CardViewName); et = l[u].AD_HeaderLayout_ID; ro(u); lr.attr("checked", l[u].UserID > 0 ? !0 : !1); gi.attr("checked", l[u].DefaultID ? !0 : !1); u && l[u].OrderByClause && l[u].OrderByClause.length > 0 ? ce(l[u].OrderByClause) : cf() } else gt.addClass("vis-disable-event"), l = []; no(); ut.scrollTop(ut.find(".crd-active").offset().top - ut.find(".crd-active").height() - 100) }, error: function (n) { alert(n.statusText) } }) }, of = function () { rt = {}; var i = o.find(".grid-Section:first").clone(!0); if (i.removeClass("displayNone"), o.find(".grid-Section:not(:first)").remove(), c.find(".vis-wizard-section").each(function (n) { var f = t(this).attr("sectionCount"), h, n, c, u, l; if (n == 0 && (i.addClass("section-active"), t(this).addClass("vis-active-block")), i.attr("sectionCount", f), h = t(this).attr("name"), i.find(".vis-grey-disp-ttl").text(h), o.find(".vis-sectionAdd").append(i), i = o.find(".grid-Section:first").clone(!0), i.removeClass("displayNone"), !rt["section" + f]) { var a = t(this).attr("row"), v = t(this).attr("col"), e = t(this)[0].style.gridTemplateColumns.split(" "), s = t(this)[0].style.gridTemplateRows.split(" "), r = {}; for (n = 0; n < a; n++)s.length > 0 && s[n] && s[n] != "auto" ? (c = s[n].replace(/\'/g, "").split(/(\d+)/).filter(Boolean), r["row_" + n] = { val: c[0], msr: c[1] }) : r["row_" + n] = { val: 1, msr: "auto" }; for (u = 0; u < v; u++)e.length > 0 && e[u] && e[u] != "auto" ? (l = e[u].replace(/\'/g, "").split(/(\d+)/).filter(Boolean), r["col_" + u] = { val: l[0], msr: l[1] }) : r["col_" + u] = { val: 1, msr: "auto" }; r.sectionNo = f; r.sectionName = h; r.rowGap = 0; r.colGap = 0; r.totalRow = a; r.totalCol = v; rt["section" + f] = r } }), o.find(".vis-sectionAdd").sortable({ disabled: !1, update: function (n, t) { var i = t.item.attr("sectioncount"), f = t.item.index(), r = t.item.next().attr("sectioncount"), u; r ? c.find('[sectioncount="' + r + '"]').before(c.find('[sectioncount="' + i + '"]')) : (u = t.item.prev().attr("sectioncount"), c.find('[sectioncount="' + u + '"]').after(c.find('[sectioncount="' + i + '"]'))) } }), o.find(".section-active .vis-grey-disp-el").click(), o.find(".vis-grey-disp-el-xross").eq(1).hide(), d || te) { if (te = !1, wi) return; b.find(".fieldLbl[seqNo]").each(function () { if (t(this).attr("title") && t(this).attr("title").length > 0) { t(this).find(".linked").removeClass("linked vis-succes-clr"); t(this).removeAttr("seqNo"); var n = t(this).attr("title"); t(this).prop("draggable", !0) } }); b.find('[draggable="true"]:not(:first)').sort(ee).appendTo(b) } else b.find(".fieldLbl[seqNo]").each(function () { var o = t(this).attr("fieldid"), f, r, k, u, ft, h, it, l; if (c.find('[fieldid="' + o + '"]').length == 0) { if (f = t(this).text(), r = c.find('[seqNo="' + t(this).attr("seqNo") + '"]'), r.length == 0) t(this).find(".linked").removeClass("linked vis-succes-clr"); else { t(this).find(".fa-circle").addClass("linked vis-succes-clr"); t(this).prop("draggable", !1); var s = "", b = "", et = "", rt = !1, y = 0, i = r.attr("fieldValuestyle"); if (i && i.indexOf("|") > -1) { if (k = i.split("<br>"), i = i.split("|"), i && i.length > 0) { for (i[0].indexOf("@img::") > -1 && (rt = !0), u = 0; u < i.length; u++)i[u].indexOf("@img::") > -1 ? b = i[u].replace("@img::", "") : i[u].indexOf("@value::") > -1 ? s = i[u].replace("@value::", "") : i[u].indexOf("@span::") > -1 && (et = i[u].replace("@span::", "")); k != null && k.length > 1 && (y = i[0].indexOf("@img::") > -1 ? 1 : 2) } } else s = i } if (r.length > 0) { var d = r.attr("style"), g = d.indexOf("flex-direction"), ut = ""; g > -1 && (ft = d.indexOf(";", g + 14), ut = "display:flex; " + d.substring(g, ft)); var e = t('<div class="fieldGroup" style="' + ut + '" draggable="true"><\/div>'), p = r.attr("showfieldicon") == "Y" ? !0 : !1, w = r.attr("showfieldtext") == "Y" ? !0 : !1; v.getFieldById(Number(o)).getShowIcon() && (p ? e.append(t('<i class="">&nbsp;<\/i>')) : e.append(t('<i class="fa fa-star">&nbsp;<\/i>'))); var nt = w ? "displayNone" : "", tt = "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' width='50' height='50'%3E%3Cdefs%3E%3Cpath d='M23 31l-3.97-2.9L19 28l-.24-.09.19.13L13 33v2h24v-2l-3-9-5-3-6 10zm-2-12c0-1.66-1.34-3-3-3s-3 1.34-3 3 1.34 3 3 3 3-1.34 3-3zm-11-8c-.55 0-1 .45-1 1v26c0 .55.45 1 1 1h30c.55 0 1-.45 1-1V12c0-.55-.45-1-1-1H10zm28 26H12c-.55 0-1-.45-1-1V14c0-.55.45-1 1-1h26c.55 0 1 .45 1 1v22c-.3.67-.63 1-1 1z' id='a'/%3E%3C/defs%3E%3Cuse xlink:href='%23a' fill='%23fff'/%3E%3Cuse xlink:href='%23a' fill-opacity='0' stroke='%23000' stroke-opacity='0'/%3E%3C/svg%3E", a = v.getFieldById(Number(o)).getDisplayType(); a == n.DisplayType.Image ? e.append(t('<span style="' + r.attr("fieldValueLabel") + '" class="fieldLbl ' + nt + '" draggable="false" showFieldText="' + w + '" showFieldIcon="' + p + '"  title="' + f + '" fieldid="' + o + '" id="' + t(this).attr("id") + '" >' + f + '<\/span><img class="vis-colorInvert imgField" style="' + b + '" src="' + tt + '"/>')) : a == n.DisplayType.TableDir || a == n.DisplayType.Table || a == n.DisplayType.List || a == n.DisplayType.Search ? (h = '<span style="' + r.attr("fieldValueLabel") + '" class="fieldLbl ' + nt + '" draggable="false" showFieldText="' + w + '" showFieldIcon="' + p + '" ondragstart="drag(event)" title="' + f + '" fieldid="' + o + '" id="' + t(this).attr("id") + '" >' + f + "<\/span>", tt = "data:image/svg+xml,%3Csvg width='30' height='30' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'%3E%3Cdefs%3E%3Cpath id='a' d='m23,31l-3.97,-2.9l-0.03,-0.1l-0.24,-0.09l0.19,0.13l-5.95,4.96l0,2l24,0l0,-2l-3,-9l-5,-3l-6,10zm-2,-12c0,-1.66 -1.34,-3 -3,-3s-3,1.34 -3,3s1.34,3 3,3s3,-1.34 3,-3zm-11,-8c-0.55,0 -1,0.45 -1,1l0,26c0,0.55 0.45,1 1,1l30,0c0.55,0 1,-0.45 1,-1l0,-26c0,-0.55 -0.45,-1 -1,-1l-30,0zm28,26l-26,0c-0.55,0 -1,-0.45 -1,-1l0,-22c0,-0.55 0.45,-1 1,-1l26,0c0.55,0 1,0.45 1,1l0,22c-0.3,0.67 -0.63,1 -1,1z'/%3E%3C/defs%3E%3Cg%3E%3Cuse transform='matrix(0.567292 0 0 0.499809 0.901418 2.3385)' x='0' y='0' stroke='null' id='svg_1' fill='%23fff' xlink:href='%23a'/%3E%3C/g%3E%3C/svg%3E", it = '<img class="vis-colorInvert imgField" style="' + b + '" src="' + tt + '"/>', l = "", y == 0 ? l = '<span class="fieldValue" style="' + s + '">Value<\/span>' : y == 1 ? l = '<span class="fieldValue" style="' + s + '"><br>Value<\/span>' : y == 2 && (l = '<span class="fieldValue" style="' + s + '">Value<br><\/span>'), rt ? (h += it, h += l) : (h += l, h += it), e.append(t(h))) : e.append(t('<span style="' + r.attr("fieldValueLabel") + '" class="fieldLbl ' + nt + '" draggable="false" showFieldText="' + w + '" showFieldIcon="' + p + '" ondragstart="drag(event)" title="' + f + '" fieldid="' + o + '" id="' + t(this).attr("id") + '" >' + f + '<\/span><span class="fieldValue" style="' + s + '">:Value<\/span>')); r.attr("query") != null && r.attr("query") != "" && e.append("<sql>SQL<\/sql>"); r.append(e) } } }), c.find(".canvas [query]").each(function () { t(this).attr("query") != "" && t(this).attr("query") != null && t(this).attr("query") != undefined && t(this).append("<sql>SQL<\/sql>") }) }, sf = function (t, i) { var u, r, f, e; if (fields = null, ui = null, w = v.getFields(), w.sort(function (n, t) { var i = n.getHeader().toLower(), r = t.getHeader().toLower(); return i == r ? 0 : i > r ? 1 : -1 }), os(t), v != null && v.getFields().length > 0) for (u = b.find(".fieldLbl:first").clone(!0), u.removeClass("displayNone"), r = 0; r < w.length; r++)(f = w[r].getColumnName().toLower(), f != "created" && f != "createdby" && f != "updated" && f != "updatedby") && (n.DisplayType.IsLOB(w[r].getDisplayType()) || !i && (e = jQuery.grep(cr, function (n) { return n == w[r].getAD_Field_ID() }), e.length > 0) || (u.prepend(w[r].getHeader()).attr("title", w[r].getHeader()), w[r].getShowIcon() && u.attr("showfieldicon", !1), u.attr("fieldid", w[r].getAD_Field_ID()), u.attr("id", s + "_" + w[r].getAD_Field_ID()), b.append(u), u = b.find(".fieldLbl:first").clone(!0), u.removeClass("displayNone"))) }, os = function (i) { var r = b.find(".fieldLbl:first").clone(!0), o, e, u, f; if (b.find(".fieldLbl:not(:first)").remove(), r.removeClass("displayNone"), oi = [], go = [], cr = [], i && (k > 0 || typeof k == "undefined")) typeof k == "undefined" && (k = 0), o = n.Application.contextUrl + "CardView/GetCardViewColumns", t.ajax({ type: "GET", async: !1, url: o, dataType: "json", contentType: "application/json; charset=utf-8", data: { ad_CardView_ID: k }, success: function (n) { var i, u, f; if (ui = JSON.parse(n), i = ui[0].lstCardViewData, br = ui[0].lstCardViewConditonData, i != null && i.length > 0) { for (ti = i[0].AD_GroupField_ID, cardViewUserID = i[0].CreatedBy, u = 0; u < i.length; u++)i[u].AD_Field_ID != 0 && (f = jQuery.grep(si, function (n) { return n.getAD_Field_ID() == i[u].AD_Field_ID }), f.length > 0 && cr.push(f[0].getAD_Field_ID()), r.prepend(i[u].FieldName).attr("title", i[u].FieldName), v.getFieldById(i[u].AD_Field_ID).getShowIcon() && r.attr("showfieldicon", !1), r.attr("fieldid", i[u].AD_Field_ID).attr("seqNo", i[u].SeqNo), r.attr("id", s + "_" + i[u].AD_Field_ID), b.append(r), r = b.find(".fieldLbl:first").clone(!0), r.removeClass("displayNone")); b[0].addEventListener("dragstart", function (n) { fi = t(n.target) }) } br != null && br.length > 0 ? (p = [], hs(br)) : (p = [], uu(p)); ce(i[0].OrderByClause) }, error: function (n) { alert(n.statusText) } }); else if (bt.hasIncludedCols && (e = null, cr = [], u = bt.fields, u != null && u.length > 0)) for (f = 0; f < u.length; f++)e = jQuery.grep(si, function (n) { return n.getAD_Field_ID() == u[f].getAD_Field_ID() }), e.length > 0 && cr.push(e[0].getAD_Field_ID()), oi.push({ AD_Field_ID: u[f].getAD_Field_ID(), CardViewID: k, SeqNo: 0, FieldName: u[f].getHeader() }), r.prepend(u[f].getHeader()).attr("title", u[f].getHeader()), v.getFieldById(u[f].getAD_Field_ID()).getShowIcon() && r.attr("showfieldicon", !1), r.attr("fieldid", u[f].getAD_Field_ID()).attr("seqNo", u[f].SeqNo), r.attr("id", s + "_" + u[f].getAD_Field_ID()), b.append(r), r = b.find(".fieldLbl:first").clone(!0), r.removeClass("displayNone") }, to = function () { var r, u, t, i, f; if (wt != null && wt.children().remove(), r = null, u = null, lovcardList = {}, v != null && v.getFields().length > 0) for (wt.append("<Option value=-1><\/Option>"), w = v.getFields(), t = 0; t < w.length; t++)(i = w[t].getColumnName().toLower(), i != "created" && i != "createdby" && i != "updated" && i != "updatedby") && (n.DisplayType.IsLookup(w[t].getDisplayType()) && w[t].getLookup() && w[t].getLookup().getIsValidated() && w[t].getIsDisplayed() || w[t].getDisplayType() == n.DisplayType.YesNo) && (wt.append("<Option value=" + w[t].getAD_Field_ID() + "> " + n.Utility.Util.getIdentifierDisplayVal(w[t].getHeader()) + "<\/Option>"), (w[t].getDisplayType() == n.DisplayType.List || w[t].getDisplayType() == n.DisplayType.TableDir || w[t].getDisplayType() == n.DisplayType.Table || w[t].getDisplayType() == n.DisplayType.Search) && w[t].lookup && w[t].lookup.getData() && (lovcardList[w[t].getAD_Field_ID()] = w[t].lookup.getData())); ti != null && ti > 0 && (f = jQuery.grep(w, function (n) { return n.getAD_Field_ID() == ti }), wt.find("[value='" + ti + "']").attr("selected", "selected")); io(ti) }, io = function (i) { var u, r, f, o, h, a, v; if (ft.find(".onlyLOV").remove(), u = ft.find(".vis-sec-2-sub-itm:hidden").clone(!0), u.removeClass("displayNone"), ft.find(".vis-sec-2-sub-itm:not(:hidden)").remove(), lovcardList[i]) { for (r = 0, f = lovcardList[i]; r < f.length; r++)f[r].Key.toString().length > 0 && f[r].Name.toString().length > 0 && (u.attr("key", f[r].Key), u.find(".vis-sub-itm-title").text(n.Utility.Util.getIdentifierDisplayVal(f[r].Name)), ft.append(u), u = ft.find(".vis-sec-2-sub-itm:last").clone(!0)); var c = ut.find(".crd-active").attr("idx"), e = l[c].groupSequence, s = l[c].excludedGroup; if (e) for (e = e.split(","), s = s.split(","), o = 0; o < e.length; o++)h = ft.find("[key='" + e[o] + "']"), s.lastIndexOf(e[o]) != -1 && h.find(".fa-check-square-o").removeClass("fa-check-square-o").addClass("fa-square-o"), a = ft.find(".vis-sec-2-sub-itm").eq(o), h.insertBefore(a); ft.closest(".vis-sec-2-wrapper").css("height", "100%"); v = t(window).height() - 248; ft.css("height", v + "px"); ft.sortable({ disabled: !1 }) } else ft.closest(".vis-sec-2-wrapper").css("height", "100%"), ft.append('<div class="onlyLOV"  key=""><span>' + n.Msg.getMsg("OnlyForLOV") + "<\/span><\/div>"), ft.sortable({ disabled: !0 }) }, ss = function () { for (var t, r, i, f = '<option value="-1"> <\/option>', u = 0; u < yf.length; u++)if ((t = yf[u], t.getDisplayType() != n.DisplayType.Image) && !t.getIsEncrypted()) { if (r = t.getColumnName(), t.getDisplayType() == n.DisplayType.Button) { if (t.getAD_Reference_Value_ID() == 0) continue; r.endsWith("_ID") ? t.setDisplayType(n.DisplayType.Table) : t.setDisplayType(n.DisplayType.List) } (i = t.getHeader(), i != null && i.length != 0 || (i = n.Msg.getElement(n.context, r), i != null && i.Length != 0)) && (t.getIsKey() && (i += " (ID)"), f += '<option value="' + r + '">' + i + "<\/option>") } yt.html(f) }, uu = function (t) { var u = ri.find("tr:first").clone(!0), i, r; if (u.removeAttr("style"), ri.find("tr:not(:first)").remove(), t.length > 0) for (i = 0; i < t.length; i++)for (r = 0; r < t[i].Condition.length; r++)u.find(".td_bgColor i").css({ background: t[i].Color, color: "transparent" }), u.find(".td_bgColor").attr("value", t[i].Color), u.find(".td_column").text(t[i].Condition[r].ColHeader).attr("value", t[i].Condition[r].ColName), u.find(".td_operator").text(t[i].Condition[r].Operator).attr("value", t[i].Condition[r].OperatorText), u.find(".td_queryValue").text(t[i].Condition[r].QueryValue).attr("value", t[i].Condition[r].QueryText), ri.append(u), u = ri.find("tr:last").clone(!0); else ri.append("<tr style='height:100%'><td colspan='5' style='background-color: #f1f1f173;'><div class='align-items-center d-flex justify-content-center'><i class='fa fa-database mr-1 fa-2x' aria-hidden='true'><\/i>" + n.Msg.getMsg("NoResult") + "<\/div><\/td><\/tr>") }, cs = function () { var i = n.Application.contextUrl + "CardView/DeleteCardViewRecord"; t.ajax({ type: "POST", async: !1, url: i, dataType: "json", contentType: "application/json; charset=utf-8", data: JSON.stringify({ ad_CardView_ID: k }), success: function (n) { var t = JSON.parse(n); isDefaultcard = !1; k = 0; oe(!1) }, error: function (n) { alert(n.statusText) } }) }, ro = function (t) { t && l && l[t] && l[t].CreatedBy == n.context.getAD_User_ID() && l[t].IsEditable ? (pu = !0, gt.removeClass("vis-disable-event"), yr.removeClass("vis-disable-event"), ef.removeClass("vis-disable-event"), nr.removeClass("vis-disable-event"), wr.removeClass("vis-disable-event"), vr.removeClass("vis-disable-event")) : (pu = !1, gt.addClass("vis-disable-event"), yr.addClass("vis-disable-event"), ef.addClass("vis-disable-event"), nr.addClass("vis-disable-event"), wr.addClass("vis-disable-event"), vr.addClass("vis-disable-event")) }, se = function () { (d || lt) && (d ? gt.addClass("vis-disable-event") : gt.removeClass("vis-disable-event"), lt && !pu && gt.addClass("vis-disable-event")) }, ls = function () { var i = ut.find(".crd-active").attr("idx"), t; if (cardViewUserID = i && l != null && l.length > 0 ? parseInt(l[i].CreatedBy) : n.context.getAD_User_ID(), AD_User_ID = n.context.getAD_User_ID(), er && (d = !0, er = !1), d && l != null) for (t = 0; t < l.length; t++)if (l[t].CardViewName.trim() == vt.val().trim()) return n.ADialog.error("cardAlreadyExist", !0, ""), g(!1), !1; cardViewName = vt.val().trim(); lt || d ? as() : (g(!1), rr ? (st.close(), lt = !1, d = !1, ei.isCardRow && !f && bt.getCardViewData(v, k)) : (lt = !0, d = !1, rf || (li.show(), ht.hide()))) }, as = function () { var r = "", u = "", i, e, o, s; t.each(ft.find(".vis-sec-2-sub-itm"), function () { r += t(this).attr("key") + ","; t(this).find(".grpChk").hasClass("fa-check-square-o") || (u += t(this).attr("key") + ",") }); i = ut.find(".crd-active").attr("idx"); r = r.replace(/,\s*$/, ""); u = u.replace(/,\s*$/, ""); e = sortOrderArray.join(","); cardViewArray = []; o = k; d && (o = 0); cardViewArray.push({ AD_Window_ID: af, AD_Tab_ID: vf, UserID: AD_User_ID, AD_GroupField_ID: wt.find(":selected").val(), isNewRecord: d, CardViewName: cardViewName, CardViewID: o, IsDefault: gi.is(":checked"), AD_HeaderLayout_ID: et, isPublic: lr.is(":checked") == !0 ? !1 : !0, groupSequence: r }); s = n.Application.contextUrl + "CardView/SaveCardViewColumns"; t.ajax({ type: "POST", async: !1, url: s, dataType: "json", contentType: "application/json; charset=utf-8", data: JSON.stringify({ lstCardView: cardViewArray, lstCardViewColumns: oi, lstCardViewCondition: strConditionArray, excludeGrp: u, orderByClause: e }), success: function (t) { var o = JSON.parse(t); k = o; toastr.success(n.Msg.getMsg("SavedSuccessfully"), "", { timeOut: 3e3, positionClass: "toast-top-center", closeButton: !0 }); rr ? (d = !1, lt = !1, ei.isCardRow && !f && bt.getCardViewData(v, k), st.close()) : (d ? oe(!0) : (l[i].groupSequence = r, l[i].excludedGroup = u, l[i].AD_GroupField_ID = wt.find(":selected").attr("fieldid"), l[i].CardViewName = cardViewName, l[i].UserID = AD_User_ID, l[i].OrderByClause = e, l[i].Updated = (new Date).toLocaleDateString(), ut.find(".crd-active .vis-lft-sgl-title").text(cardViewName)), gs(), lt = !0, d = !1, rf || (li.show(), ht.hide(), sf(!0, !1))); g(!1); su.removeClass("vis-disable-event") }, error: function (n) { alert(n.statusText); g(!1) } }) }, uo = function () { vt.val(""); wt.val("-1"); wt.change(); ct.val("-1"); sortOrderArray = []; lastSortOrderArray = []; LastCVCondition = []; p = []; uu(p); cf(); gt.addClass("vis-disable-event"); kr.addClass("vis-disable-event"); gi.prop("checked", !1); lr.prop("checked", !1); gi.parent().show() }, bs = ["px", "%", "cm", "mm", "in", "pc", "pt", "ch", "em", "rem", "vh", "vw", "vmin", "vmax"], nt = { width: { proprty: "width", value: "", measurment: !0 }, minWidth: { proprty: "min-width", value: "", measurment: !0 }, height: { proprty: "height", value: "", measurment: !0 }, minHeight: { proprty: "min-height", value: "", measurment: !0 }, fontSize: { proprty: "font-size", value: "", measurment: !0 }, fontFamily: { proprty: "font-family", value: "", measurment: !1 }, color: { proprty: "color", value: "", measurment: !1 }, border: { proprty: "border", value: "", measurment: !0 }, borderType: { proprty: "border-style", value: "", measurment: !1 }, borderColor: { proprty: "border-color", value: "", measurment: !1 }, borderLeft: { proprty: "border-left-width", value: "", measurment: !0 }, borderLeftStyle: { proprty: "border-left-style", value: "", measurment: !1 }, borderLeftColor: { proprty: "border-left-color", value: "", measurment: !1 }, borderTop: { proprty: "border-top-width", value: "", measurment: !0 }, borderTopStyle: { proprty: "border-top-style", value: "", measurment: !1 }, borderTopColor: { proprty: "border-top-color", value: "", measurment: !1 }, borderRight: { proprty: "border-right-width", value: "", measurment: !0 }, borderRightStyle: { proprty: "border-right-style", value: "", measurment: !1 }, borderRightColor: { proprty: "border-right-color", value: "", measurment: !1 }, borderBottom: { proprty: "border-bottom-width", value: "", measurment: !0 }, borderBottomStyle: { proprty: "border-bottom-style", value: "", measurment: !1 }, borderBottomColor: { proprty: "border-bottom-color", value: "", measurment: !1 }, borderRadius: { proprty: "border-radius", value: "", measurment: !0 }, borderTopLeftRadius: { proprty: "border-top-left-radius", value: "", measurment: !0 }, borderTopRightRadius: { proprty: "border-top-right-radius", value: "", measurment: !0 }, borderBottomRightRadius: { proprty: "border-bottom-right-radius", value: "", measurment: !0 }, borderBottomLeftRadius: { proprty: "border-bottom-left-radius", value: "", measurment: !0 }, padding: { proprty: "padding", value: "", measurment: !0 }, paddingLeft: { proprty: "padding-left", value: "", measurment: !0 }, paddingTop: { proprty: "padding-top", value: "", measurment: !0 }, paddingRight: { proprty: "padding-right", value: "", measurment: !0 }, paddingBottom: { proprty: "padding-bottom", value: "", measurment: !0 }, margin: { proprty: "margin", value: "", measurment: !0 }, marginLeft: { proprty: "margin-left", value: "", measurment: !0 }, marginTop: { proprty: "margin-top", value: "", measurment: !0 }, marginRight: { proprty: "margin-right", value: "", measurment: !0 }, marginBottom: { proprty: "margin-bottom", value: "", measurment: !0 }, opacity: { proprty: "opacity", value: "", measurment: !1 }, backgroundColor: { proprty: "background-color", value: "", measurment: !1 }, gradientInput: { proprty: "background", value: "", measurment: !1 }, gradient: { proprty: "background", value: "", measurment: !1 }, boxShadow: { proprty: "box-shadow", value: "", measurment: !0 }, flexDirection: { proprty: "flex-direction", value: "", measurment: !1 }, bold: { proprty: "font-weight", value: "bold", measurment: !1 }, italic: { proprty: "font-style", value: "italic", measurment: !1 }, underline: { proprty: "text-decoration", value: "underline", measurment: !1 }, textLeft: { proprty: "text-align", value: "left", measurment: !1 }, textCenter: { proprty: "text-align", value: "center", measurment: !1 }, textJustify: { proprty: "text-align", value: "justify", measurment: !1 }, textRight: { proprty: "text-align", value: "right", measurment: !1 }, upperCase: { proprty: "text-transform", value: "uppercase", measurment: !1 }, capitalize: { proprty: "text-transform", value: "capitalize", measurment: !1 }, lowerCase: { proprty: "text-transform", value: "lowercase", measurment: !1 }, flexJustifyCenter: { proprty: "justify-content", value: "center", measurment: !1 }, flexJustifyStart: { proprty: "justify-content", value: "flex-start", measurment: !1 }, flexJustifyEnd: { proprty: "justify-content", value: "flex-end", measurment: !1 }, flexJustifySpaceBetween: { proprty: "justify-content", value: "space-between", measurment: !1 }, flexJustifySpaceAround: { proprty: "justify-content", value: "space-around", measurment: !1 }, flexAlignCenter: { proprty: "align-items", value: "center", measurment: !1 }, flexAlignEnd: { proprty: "align-items", value: "flex-end", measurment: !1 }, flexAlignStart: { proprty: "align-items", value: "flex-start", measurment: !1 }, maxTextmultiline: { proprty: "-webkit-line-clamp", value: "", measurment: !1 }, objectFit: { proprty: "object-fit", value: "", measurment: !1 } }, ks = function () { dr.change(function () { t(this).is(":checked") ? (e.find(".allBorderRadius").removeClass("displayNone"), e.find(".singleBorderRadius").addClass("displayNone")) : (e.find(".allBorderRadius").addClass("displayNone"), e.find(".singleBorderRadius").removeClass("displayNone")) }); bu.change(function () { t(this).is(":checked") ? (e.find(".allPadding").removeClass("displayNone"), e.find(".singlePadding").addClass("displayNone")) : (e.find(".allPadding").addClass("displayNone"), e.find(".singlePadding").removeClass("displayNone")) }); ku.change(function () { t(this).is(":checked") ? (e.find(".allMargin").removeClass("displayNone"), e.find(".singleMargin").addClass("displayNone")) : (e.find(".allMargin").addClass("displayNone"), e.find(".singleMargin").removeClass("displayNone")) }); du.change(function () { t(this).is(":checked") ? (e.find(".allBorder").removeClass("displayNone"), e.find(".singleBorder").addClass("displayNone")) : (e.find(".allBorder").addClass("displayNone"), e.find(".singleBorder").removeClass("displayNone")) }); a.find("i").click(function () { var n = c.find(".vis-active-block"), i = t(this).attr("command"), u = n.closest(".fieldGroup").find(".fieldLbl"), r; i == "Show" ? (n.prop("tagName") != "I" || n.hasClass("imgField") ? (u.attr("showFieldText", !1), u.removeClass("displayNone")) : (n.attr("class", "fa fa-star"), n.next().attr("showFieldIcon", !1)), a.find('[command="Hide"]').parent().show(), a.find('[command="Show"]').parent().hide(), a.hide(), it()) : i == "Hide" ? (n.prop("tagName") != "I" || n.hasClass("imgField") ? n.hasClass("imgField") ? (n.css("display", "none"), it()) : (n.hasClass("fieldValue") ? n.css("display", "none") : (n.attr("showFieldText", !0), n.addClass("displayNone")), it()) : (n.attr("class", ""), n.next().attr("showFieldIcon", !0), it()), a.find('[command="Hide"]').parent().hide(), a.find('[command="Show"]').parent().show(), a.hide()) : i == "SelectParent" ? n.parent().hasClass("fieldGroup") ? n.parent().parent().mousedown().mouseup() : n.parent().mousedown().mouseup() : i == "Separate" ? (vo(n), n.removeClass("vis-split-cell"), t(this).parent().hide(), it()) : i == "Merge" ? (ao(), a.find('[command="Merge"]').parent().hide(), it()) : i == "Unlink" ? (a.hide(), r = n.closest(".fieldGroup").find(".fieldLbl"), lf(r.attr("title"), r), it()) : i == "ShowImg" ? (n.closest(".fieldGroup").find(".imgField").css("display", "unset"), a.find('[command="ShowImg"]').parent().hide(), it()) : i == "ShowValue" && (n.closest(".fieldGroup").find(".fieldValue").css("display", "unset"), a.find('[command="ShowValue"]').parent().hide(), it()) }); var i = c.find(".canvas *"); i.mousedown(function (i) { setTimeout(function () { var h, y, p, s, u, f, r, l; i.target.tagName == "SQL" || t(i.target).hasClass("fieldGroup") || i.ctrlKey || (ht.find(".vis-v-rowcol").hide(), t(i.target).hasClass("grdDiv") && (i.preventDefault(), rh(i)), a.find('[command="Merge"]').parent().hide(), a.find('[command="ShowImg"]').parent().hide(), a.find('[command="ShowValue"]').parent().hide(), e.find(".imgTextCont").addClass("vis-disable-event"), c.find(".vis-active-block").removeClass("vis-active-block"), tr == 1 ? c.find(".vis-viewBlock").addClass("vis-active-block") : (h = t(i.target).closest(".vis-wizard-section").attr("sectionCount"), o.find("[sectionCount='" + h + "']").hasClass("section-active") || o.find("[sectionCount='" + h + "'] .vis-grey-disp-el").click(), t(i.target).addClass("vis-active-block"), y = i.target.offsetTop - a.outerHeight(), p = i.target.offsetLeft, a.css({ top: y, left: p }), a.show(), t(i.target).closest(".fieldGroup").length > 0 ? a.find('[command="Unlink"]').parent().show() : a.find('[command="Unlink"]').parent().hide(), a.find('[command="fieldName"]').text("").hide(), t(i.target).hasClass("fieldLbl") ? (a.find('[command="fieldName"]').text(t(i.target).closest(".fieldGroup").find(".fieldLbl").attr("title")).show(), r = t(i.target).attr("showFieldText") == "true" ? !0 : !1, i.target.hasAttribute("showFieldText") && r ? (a.find('[command="Hide"]').parent().hide(), a.find('[command="Show"]').parent().show()) : (a.find('[command="Show"]').parent().hide(), a.find('[command="Hide"]').parent().show())) : i.target.tagName == "I" && t(i.target).closest(".fieldGroup").find(".imgField").length == 0 ? (r = t(i.target).next().attr("showFieldIcon") == "true" ? !0 : !1, t(i.target).next().attr("showFieldIcon") && r ? (a.find('[command="Hide"]').parent().hide(), a.find('[command="Show"]').parent().show()) : (a.find('[command="Show"]').parent().hide(), a.find('[command="Hide"]').parent().show())) : (a.find('[command="Show"]').parent().hide(), a.find('[command="Hide"]').parent().hide(), t(i.target).closest(".fieldGroup").length > 0 && (s = t(i.target).closest(".fieldGroup").find(".fieldLbl"), u = v.getFieldById(Number(s.attr("fieldid"))).getDisplayType(), (u == n.DisplayType.TableDir || u == n.DisplayType.Table || u == n.DisplayType.List || u == n.DisplayType.Search) && (f = t(i.target).closest(".fieldGroup"), f.find(".imgField:hidden").length > 0 ? (a.find('[command="ShowImg"]').parent().show(), a.find('[command="Hide"]').parent().hide()) : f.find(".fieldValue:hidden").length > 0 ? (a.find('[command="Hide"]').parent().hide(), a.find('[command="ShowValue"]').parent().show()) : f.find(".imgField").length == 1 && f.find(".fieldValue").length == 1 ? (a.find('[command="Hide"]').parent().show(), e.find(".imgTextCont").removeClass("vis-disable-event")) : e.find(".imgTextCont").addClass("vis-disable-event")), r = s.attr("showFieldText") == "true" ? !0 : !1, a.find('[command="fieldName"]').text(s.attr("title")).show()), r && a.find('[command="Show"]').parent().show()), t(i.target).hasClass("vis-split-cell") ? a.find('[command="Separate"]').parent().show() : (a.find('[command="Separate"]').parent().hide(), t(i.target).hasClass("grdDiv") && (hi = !0), l = o.find(".colBox").length - 1, tt.find(".grdDiv").each(function (n) { var i = Math.ceil((n + 1) / l); t(this).hasClass("vis-active-block") && (gr = i - 1, gu = n - l * gr) }))), t(i.target).hasClass("vis-wizard-section") && a.find('[command="fieldName"]').text("Section " + t(i.target).attr("sectioncount")).show(), t(i.target).hasClass("vis-viewBlock") && a.find('[command="fieldName"]').text("Main container").show()) }, 30) }).mouseup(function (n) { setTimeout(function () { hi = !1; nh(t(n.target)) }, 30) }); e.find("[data-command]").on("change", function () { var f, r, o; t(this).removeClass("vis-editor-validate"); var n = t(this).data("command"), i = t(this).val(), u = !1; if (n.indexOf("margin") != -1 && i.indexOf("-") != -1 && (u = !0), f = i.replace(/\d+/g, "").replace(".", ""), r = i.replace(i.replace(/\d+/g, ""), ""), nt[n] && nt[n].measurment && i != "" && t(this).attr("type") != "color") if (bs.indexOf(f) < 0) { if (isNaN(Number(r))) { t(this).addClass("vis-editor-validate"); return } u ? t(this).val("-" + r + "px") : t(this).val(r + "px") } else if (isNaN(Number(r))) { t(this).addClass("vis-editor-validate"); return } n == "backgroundColor" ? (e.find(".vis-zero-BTopLeftBLeft:first").css("background-color", i), e.find('[data-command="backgroundColor"]').val(i)) : n == "color" ? (e.find(".vis-zero-BTopLeftBLeft:last").css("background-color", i), e.find('[data-command="color"]').val(i)) : (n == "borderColor" || n == "borderLeftColor" || n == "borderRightColor" || n == "borderTopColor" || n == "borderBottomColor") && (o = e.find("[data-command='" + n + "']").closest(".vis-prop-pan-cont"), o.find(".vis-back-color03").css("background-color", i)); ki(n, t(this).val()) }); e.find("[data-command2]").on("click", function () { a.hide(); var n = tt.find(".vis-active-block").closest(".fieldGroup"), i = t(this).data("command2"), r = n.find(".fieldValue").attr("style"), u = n.find(".fieldValue").attr("class"); n.find(".fieldValue br").remove(); i == "SwapImgTxt" ? n.find(".imgField").before(n.find(".fieldValue")) : i == "SwapTxtImg" ? n.find(".fieldValue").before(n.find(".imgField")) : i == "SwapTxtImgBr" ? (n.find(".fieldValue").before(n.find(".imgField")), n.find(".fieldValue").prepend("<br>")) : i == "SwapImgTxtBr" && (n.find(".imgField").before(n.find(".fieldValue")), n.find(".fieldValue").append("<br>")) }); e.find("[data-command1]").on("click", function () { var n = t(this).data("command1"), i = c.find(".vis-active-block"), u = !1, r; u = nt[n].measurment ? ae(nt[n].proprty, nt[n].value, i) : ae(nt[n].proprty, !1, i); r = t(this).closest(".vis-horz-align-d").find(".vis-hr-elm-inn-active"); r.removeClass("vis-hr-elm-inn-active"); (nt[n].proprty == "justify-content" || nt[n].proprty == "align-items") && ae("display", "flex", i) ? (i[0].style.removeProperty("display"), ki(n, ""), r.find("[data-command1]").attr("data-command1") != n && (t(this).parent().addClass("vis-hr-elm-inn-active"), ki(n, nt[n].value))) : nt[n].proprty == "text-align" || nt[n].proprty == "text-transform" ? (ki(n, ""), r.find("[data-command1]").attr("data-command1") != n && (t(this).parent().addClass("vis-hr-elm-inn-active"), ki(n, nt[n].value))) : u ? (t(this).parent().removeClass("vis-hr-elm-inn-active"), ki(n, "")) : (t(this).parent().addClass("vis-hr-elm-inn-active"), ki(n, nt[n].value)); (i.attr("style").indexOf("justify-content") != -1 || i.attr("style").indexOf("align-items") != -1 || i.attr("style").indexOf("flex-direction") != -1) && i.css("display", "flex") }); o.find(".addGridRow").click(function () { var n = o.find(".rowBox:first").clone(!0); n.show(); o.find(".DivRowBox").append(n); lo(); it() }); o.find(".addGridCol").click(function () { var n = o.find(".colBox:first").clone(!0); n.show(); o.find(".DivColBox").append(n); lo(); it() }); o.find(".addGridSection").click(function () { ne = !0; o.find(".section-active").removeClass("section-active"); var n = o.find(".grid-Section:first").clone(!0); n.removeClass("displayNone"); n.addClass("section-active"); fr = o.find(".grid-Section").length; n.attr("sectionCount", fr); n.find(".vis-grey-disp-ttl").text("Section " + fr); o.find(".vis-sectionAdd").append(n); tt = t('<div name="Section ' + fr + '" sectionCount="' + fr + '"  class="section' + fr + ' vis-wizard-section" style="padding:5px"><\/div>'); c.find(".vis-viewBlock").append(tt); o.find(".rowBox:not(:first)").remove(); o.find(".colBox:not(:first)").remove(); o.find(".addGridRow").click(); o.find(".addGridCol").click(); o.find(".vis-sectionAdd").sortable({ disabled: !1, update: function (n, t) { var i = t.item.attr("sectioncount"), f = t.item.index(), r = t.item.next().attr("sectioncount"), u; r ? c.find('[sectioncount="' + r + '"]').before(c.find('[sectioncount="' + i + '"]')) : (u = t.item.prev().attr("sectioncount"), c.find('[sectioncount="' + u + '"]').after(c.find('[sectioncount="' + i + '"]'))) } }) }); o.find(".grid-Section .vis-grey-disp-el-xross").click(function () { var n = t(this).closest(".grid-Section").attr("sectionCount"), i; t(this).closest(".grid-Section").hasClass("section-active") && (o.find(".grid-Section").eq(1).addClass("section-active"), o.find(".grid-Section").eq(1).find(".vis-grey-disp-el").click()); t(this).closest(".grid-Section").remove(); i = c.find(".vis-viewBlock .section" + n); i.find(".fieldLbl").each(function () { t(this).attr("title") && t(this).attr("title").length > 0 && lf(t(this).attr("title"), t(this)) }); i.remove(); delete rt["section" + n]; n = o.find(".section-active").attr("sectionCount"); tt = c.find(".vis-viewBlock .section" + n); it() }); o.find(".grid-Section .vis-grey-disp-el").click(function () { o.find(".section-active").removeClass("section-active"); t(this).parent().addClass("section-active"); var n = o.find(".section-active").attr("sectionCount"); tt = c.find(".vis-viewBlock .section" + n); c.find(".vis-active-block").removeClass("vis-active-block"); tt.addClass("vis-active-block"); ds(); wi || it() }); ie.click(function () { var n = c.find(".vis-active-block").css("grid-area").split("/"); o.find(".grdRowAdd").eq(Number(n[2]) - 1).click() }); uf.click(function () { var n = c.find(".vis-active-block").css("grid-area").split("/"); o.find(".grdRowDel").eq(Number(n[2]) - 1).click() }); re.click(function () { var n = c.find(".vis-active-block").css("grid-area").split("/"); o.find(".grdColAdd").eq(Number(n[3]) - 1).click() }); ff.click(function () { var n = c.find(".vis-active-block").css("grid-area").split("/"); o.find(".grdColDel").eq(Number(n[3]) - 1).click() }); o.find(".grdRowDel").click(function () { var u = t(this).closest(".rowBox").index(), i, n; ci = u; var e = o.find(".rowBox").length - 1, r = o.find(".colBox").length - 1, f = u * r + 1 - r; for (i = f; i < f + r; i++)tt.find(".grdDiv").eq(i - 1).addClass("del"), n = tt.find(".grdDiv").eq(i - 1).find(".fieldLbl"), n && n.attr("title") && n.attr("title").length > 0 && lf(n.attr("title"), n); tt.find(".del").remove(); t(this).closest(".rowBox").remove(); ni(-1, 0); it() }); o.find(".grdRowAdd").click(function () { var i = t(this).closest(".rowBox").index() - 1, r = o.find(".rowBox:first").clone(!0), n; r.show(); o.find(".DivRowBox").append(r); var e = o.find(".rowBox").length - 1, u = o.find(".colBox").length - 1, f = (i + 1) * u; for (ci = i + 1, n = 0; n < u; n++)tt.find(".grdDiv").eq(f - 1).after("<div class='grdDiv' style='padding:5px;display: flex; flex-direction: row;'><\/div>"); ni(1, 0); it() }); o.find(".grdColDel").click(function () { var f = t(this).closest(".colBox").index() - 1, s = o.find(".rowBox").length - 1, e = o.find(".colBox").length - 1, r, i, u, n; for (ai = f + 1, r = 0; r < s; r++)for (i = 0; i < e; i++)i == f && (u = e * r + i, tt.find(".grdDiv").eq(u).addClass("del"), n = tt.find(".grdDiv").eq(u).find(".fieldLbl"), n && n.attr("title") && n.attr("title").length > 0 && lf(n.attr("title"), n)); tt.find(".del").remove(); t(this).closest(".colBox").remove(); ni(0, -1); it() }); o.find(".grdColAdd").click(function () { var u = o.find(".colBox:first").clone(!0), i, n, r; u.show(); o.find(".DivColBox").append(u); vi = []; var f = t(this).closest(".colBox").index() - 1, s = o.find(".rowBox").length - 1, e = o.find(".colBox").length - 1; for (ai = f + 1, i = 0; i < s; i++)for (n = 0; n < e; n++)n == f && (r = e * i + n, vi.push(r + 1), tt.find(".grdDiv").eq(r).after("<div class='grdDiv' style='padding:5px;display: flex; flex-direction: row;'><\/div>")); ni(0, 1); it() }); o.find(".mergeCell").click(function () { ao() }); tu.change(function () { ni(); it() }); nu.change(function () { ni(); it() }); o.find(".rowBox input,select").change(function () { ni(); it() }); o.find(".colBox input,select").change(function () { ni(); it() }); b.find(".vis-grey-icon .fa-circle").click(function () { if (t(this).hasClass("vis-succes-clr")) { var n = t(this).closest(".fieldLbl").attr("fieldid"); c.find('[fieldid="' + n + '"]').mousedown().mouseup(); setTimeout(function () { a.find('[command="Unlink"]').click() }, 100) } else po(t(this).closest(".fieldLbl")); it() }); kf.click(function () { y.find('.mainTemplate[templateid="' + et + '"]').parent().click(); tr > 1 && (co(), of()); kf.hide() }) }, wo; f ? (url = n.Application.contextUrl + "JsonData/GetGridWindowSkipRole", wo = { windowNo: s, AD_Window_ID: v.getField("AD_Window_ID").value }, t.ajax({ type: "GET", async: !1, url: url, dataType: "json", contentType: "application/json; charset=utf-8", data: wo, success: function (t) { var f, i, r, u, e; if (ui = JSON.parse(t.result), f = new n.GridWindow(ui), f != null) { for (i = null, r = f.getTabs(), u = 0; r.length > 0; u++)if (r[u].getAD_Tab_ID() == v.getRecord_ID()) { i = r[u]; break } i != null && (e = s + "_" + i.getRecord_ID(), ei = new n.GridController(!1, !1, e), ei.initGrid(!0, s, hr, i), v = ei.getMTab(), bt = ei.vCardView, af = v.getAD_Window_ID(), vf = v.getAD_Tab_ID(), tabName = v.getName(), k = bt.getAD_CardView_ID(), ti = bt.getField_Group_ID(), w = v.getFields(), yf = v.getFields().slice(), de()) } }, error: function (n) { alert(n.statusText) } })) : de(); this.getRoot = function () { return h }; this.show = function () { var i = t(window).width() - 150, r = t(window).height() - 10; st = new n.ChildDialog; st.setTitle(n.Msg.getMsg("Card")); st.setWidth(i); st.setHeight(r); st.setContent(h); st.onOkClick = function () { }; st.onCancelClick = bo; st.onClose = bo; st.show(); st.hideButtons() }; this.disposeComponent = function () { hr = null; h.remove(); h = null } } function u() { function l() { return r.val() == null || r.val() == "" ? (n.ADialog.info("FileNameMendatory"), !1) : (i.onSave(), !0) } function c() { return chCopy.close(), !0 } var i = this, u = t("<div>"), s = t('<div class="input-group vis-input-wrap mb-0" >'), h = t('<div class="vis-control-wrap d-block mt-1" >'), e = t('<span style="display:block;margin-bottom:5px;">' + n.Msg.getMsg("NewCardInfo") + "<\/span>"), r, f, o; s.append(e).append(h); r = t('<input type="text">'); f = t("<label>" + n.Msg.getMsg("EnterName") + "<\/label>"); h.append(r).append(f); o = t('<div class="d-flex align-items-center justify-content-end mt-2">'); i.btnCopySave = t('<button class="vis-save-cont mr-2">' + n.Msg.getMsg("Ok") + "<\/button>"); i.btnCopyCancle = t('<button class="vis-save-cont mr-2">' + n.Msg.getMsg("Cancle") + "<\/button>"); o.append(i.btnCopySave).append(i.btnCopyCancle); u.append(s).append(o); this.show = function () { chCopy = new n.ChildDialog; chCopy.setTitle(n.Msg.getMsg("CardName")); chCopy.setModal(!0); chCopy.setContent(u); chCopy.setWidth("50%"); chCopy.show(); chCopy.onOkClick = l; chCopy.onCancelClick = c; chCopy.onClose = c; chCopy.hideButtons() }; this.getName = function () { return r.val() }; i.close = function () { chCopy.close() } } r.prototype.getOperatorsQuery = function (t, i) { var u = "", r = ""; for (var f in t) r = t[f], i && (r = n.Msg.getMsg(r)), u += '<option value="' + f + '">' + r + "<\/option>"; return u }; r.prototype.sizeChanged = function (n, t) { console.log(n, t) }; r.prototype.dispose = function () { this.disposeComponent() }; n.CVDialog = r; n.CardCopyDialog = u }(VIS, jQuery), function (n, t) { function i() { function nt(n) { n && ni != null && ni.css({ display: "block" }); n || ni == null || ni.css({ display: "none" }) } function tu() { e.load(n.Application.contextUrl + "CardViewWizard/GetCardTemplate/?windowno=" + o, function () { e.append(ni); ii = e.find("#BtnTemplateBack_" + o); h = e.find("#DivTemplate_" + o); dr = e.find("#DivCardFieldSec_" + o); d = e.find("#DivCardStep2_" + o); u = e.find("#DivViewBlock_" + o); i = e.find("#DivStyleSec1_" + o); pt = e.find("#BtnLayoutSetting_" + o); fr = e.find("#BtnChangeTemplate_" + o); f = d.find(".vis-topNavigator"); r = e.find("#DivGridSec_" + o); c = u.find(".section1"); ui = e.find("#chkAllBorderRadius_" + o); fi = e.find("#chkAllPadding_" + o); ei = e.find("#chkAllMargin_" + o); oi = e.find("#chkAllBorder_" + o); dt = e.find("#txtTemplateName_" + o); sr = e.find("#BtnFinesh_" + o); wi = e.find("#txtCustomStyle_" + o); si = e.find("#txtSQLQuery_" + o); bt = r.find(".rowGap"); kt = r.find(".colGap"); bi = e.find("#Btn_BlockCancel_" + o); hi = e.find("#BtnAddField_" + o); ci = e.find("#BtnAddImgField_" + o); li = e.find("#BtnAddImgTxtField_" + o); er = e.find("#spnLastSaved_" + o); g = e.find("#btnEditIcon_" + o); cr = e.find("#btnaddBlankTemplate_" + o); et = e.find("#btnUndo_" + o); ct = e.find("#btnRedo_" + o); gi = e.find("#btnVaddrow_" + o); nr = e.find("#btnVaddCol_" + o); ai = e.find("#btnVdelrow_" + o); vi = e.find("#btnVdelCol_" + o); it = e.find("#BtnExport_" + o); lr = e.find("#BtnRefreshTemplate_" + o); ot = e.find("#CmbTemplateCategory_" + o); lt = e.find("#CmbViwBlockTemplateCategory_" + o); i.find(".nav-tabs li:last").hide(); ii.hide(); ur(); eu(); ru() }) } function iu() { e.find(".chkMark").change(function () { e.find(".chkMark:checked").length > 0 ? it.show() : it.hide(); e.find(".chkMark:checked").length > 1 ? pt.hide() : pt.show() }) } function ru() { t("body").mouseup(function () { p = !1 }); hi.click(function () { f.hide(); var i = t('<div class="fieldGroup" draggable="true"><span class="fieldLbl" title="Label" contenteditable="true">Label<\/span><span class="fieldValue" contenteditable="true">:Value<\/span><\/div>'), n = u.find(".vis-active-block"); n.hasClass("grdDiv") && n.append(i); s() }); ci.click(function () { f.hide(); vt.show(!1) }); li.click(function () { f.hide(); vt.show(!0) }); g.click(function () { f.hide(); var n = u.find(".vis-active-block").closest(".fieldGroup"); n.find(".imgField").length > 0 && n.find(".fieldValue").length > 0 ? vt.show(!0, !0) : vt.show(!1, !0) }); ii.click(function () { yt++; h.hide(); d.find(".vis-two-sec-two").show(); i.show() }); pt.click(function () { vr(); yt++; ti(); h.hide(); d.find(".vis-two-sec-two").show(); i.show(); w == 0 && r.find(".rowBox").length == 1 && (r.find(".addGridCol").click(), r.find(".addGridRow").click()); w == 0 && u.find(".vis-viewBlock").css("backgroundColor", "#fff"); g.hide(); gt = !1; y = []; tr = !0; v = 0; s(); et.attr("disabled", "disabled") }); fr.click(function () { ii.show(); f.hide(); yt--; h.show(); i.hide(); d.find(".vis-two-sec-two").hide(); h.find('[templateid="' + or + '"]').click(); kr(); ot.val(""); h.find('[issystemtemplate="Y"]').removeClass("displayNone") }); sr.click(function (n) { ou(n) }); it.click(function () { vu() }); lr.click(function () { ot.val(""); ur() }); h.find(".vis-cardSingleViewTemplate").click(function (n) { t(n.target).hasClass("chkMark") || (t(n.target).index() == 0 ? it.hide() : it.show(), h.find(".vis-cardSingleViewTemplate").removeClass("vis-active-template"), t(this).addClass("vis-active-template"), h.find(".chkMark").prop("checked", !1), t(this).find(".chkMark").prop("checked", !0), e.find(".chkMark").change()) }); ui.change(function () { t(this).is(":checked") ? (i.find(".allBorderRadius").removeClass("displayNone"), i.find(".singleBorderRadius").addClass("displayNone")) : (i.find(".allBorderRadius").addClass("displayNone"), i.find(".singleBorderRadius").removeClass("displayNone")) }); fi.change(function () { t(this).is(":checked") ? (i.find(".allPadding").removeClass("displayNone"), i.find(".singlePadding").addClass("displayNone")) : (i.find(".allPadding").addClass("displayNone"), i.find(".singlePadding").removeClass("displayNone")) }); ei.change(function () { t(this).is(":checked") ? (i.find(".allMargin").removeClass("displayNone"), i.find(".singleMargin").addClass("displayNone")) : (i.find(".allMargin").addClass("displayNone"), i.find(".singleMargin").removeClass("displayNone")) }); oi.change(function () { t(this).is(":checked") ? (i.find(".allBorder").removeClass("displayNone"), i.find(".singleBorder").addClass("displayNone")) : (i.find(".allBorder").addClass("displayNone"), i.find(".singleBorder").removeClass("displayNone")) }); i.find(".vis-circular-slider-circle").mousedown(function () { p = !0 }).mousemove(function (n) { if (p) { var t = i.find(".vis-circular-slider-dot"), r = ar(t, n); t.css({ WebkitTransform: "rotate(" + r + "deg)" }); t.css({ "-moz-transform": "rotate(" + r + "deg)" }); t.attr("deg", r); rt("gradient", r) } }); f.find("i").click(function () { var n = u.find(".vis-active-block"), i = t(this).attr("command"), e = n.closest(".fieldGroup").find(".fieldLbl"), r; i == "Show" ? (n.prop("tagName") != "I" || n.hasClass("imgField") ? (e.attr("showFieldText", !1), e.removeClass("displayNone")) : (n.attr("class", "fa fa-star"), n.next().attr("showFieldIcon", !1)), f.find('[command="Hide"]').parent().show(), f.find('[command="Show"]').parent().hide(), f.hide(), s()) : i == "Hide" ? (n.prop("tagName") != "I" || n.hasClass("imgField") ? n.hasClass("imgField") ? n.css("display", "none") : n.hasClass("fieldValue") ? n.css("display", "none") : (n.attr("showFieldText", !0), n.addClass("displayNone")) : (n.attr("class", ""), n.next().attr("showFieldIcon", !0)), f.find('[command="Hide"]').parent().hide(), f.find('[command="Show"]').parent().show(), f.hide(), g.hide(), s()) : i == "SelectParent" ? n.parent().hasClass("fieldGroup") ? n.parent().parent().mousedown().mouseup() : n.parent().mousedown().mouseup() : i == "Separate" ? (wr(n), n.find(".vis-split-cell:first").remove(), t(this).parent().hide(), s()) : i == "Merge" ? (pr(), f.find('[command="Merge"]').parent().hide(), s()) : i == "Unlink" ? (f.hide(), r = n.closest(".fieldGroup").find(".fieldLbl"), pi(r.attr("title"), r), g.hide(), s()) : i == "ShowImg" ? (n.closest(".fieldGroup").find(".imgField").css("display", "unset"), f.find('[command="ShowImg"]').parent().hide(), s()) : i == "ShowValue" && (n.closest(".fieldGroup").find(".fieldValue").css("display", "unset"), f.find('[command="ShowValue"]').parent().hide(), s()) }); var o = u.find(".canvas *"); o.mousedown(function (n) { setTimeout(function () { var s, l, a, v, h, o, e; if (n.target.tagName != "SQL" && !t(n.target).hasClass("fieldGroup") && !t(n.target).hasClass("vis-addRemoveRowCol")) { if (n.ctrlKey) { t(n.target).attr("contenteditable") && t(n.target).attr("contenteditable", !1); return } t(n.target).attr("contenteditable") && t(n.target).attr("contenteditable", !0); d.find(".vis-v-rowcol").hide(); t(n.target).hasClass("grdDiv") ? (n.preventDefault(), hi.removeClass("vis-disable-event"), ci.removeClass("vis-disable-event"), li.removeClass("vis-disable-event"), lu(n)) : (hi.addClass("vis-disable-event"), ci.addClass("vis-disable-event"), li.addClass("vis-disable-event")); f.find('[command="Merge"]').parent().hide(); f.find('[command="ShowImg"]').parent().hide(); f.find('[command="ShowValue"]').parent().hide(); i.find(".imgTextCont").addClass("vis-disable-event"); u.find(".vis-active-block").removeClass("vis-active-block"); yt == 1 ? u.find(".vis-viewBlock").addClass("vis-active-block") : (s = t(n.target).closest(".vis-wizard-section").attr("sectionCount"), r.find("[sectionCount='" + s + "']").hasClass("section-active") || r.find("[sectionCount='" + s + "'] .vis-grey-disp-el").click(), t(n.target).addClass("vis-active-block"), l = n.target.offsetTop - f.outerHeight(), a = n.target.offsetLeft, f.css({ top: l, left: a }), f.show(), f.find('[command="fieldName"]').text("").hide(), t(n.target).hasClass("imgField") ? (g.show(), n.target.tagName == "I" ? g.css({ left: t(n.target).closest(".grdDiv")[0].offsetLeft + 22, top: t(n.target).closest(".grdDiv")[0].offsetTop + 6 }) : g.css({ left: n.target.offsetLeft + (n.target.width || 0) - 12, top: n.target.offsetTop })) : g.hide(), v = !1, t(n.target).closest(".fieldGroup").length > 0 ? f.find('[command="Unlink"]').parent().show() : f.find('[command="Unlink"]').parent().hide(), t(n.target).hasClass("fieldLbl") ? (f.find('[command="fieldName"]').text(t(n.target).closest(".fieldGroup").find(".fieldLbl").attr("title")).show(), e = t(n.target).attr("showFieldText") == "true" ? !0 : !1, n.target.hasAttribute("showFieldText") && e ? (f.find('[command="Hide"]').parent().hide(), f.find('[command="Show"]').parent().show()) : (f.find('[command="Show"]').parent().hide(), f.find('[command="Hide"]').parent().show())) : n.target.tagName == "I" && t(n.target).closest(".fieldGroup").find(".imgField").length == 0 ? (e = t(n.target).next().attr("showFieldIcon") == "true" ? !0 : !1, t(n.target).next().attr("showFieldIcon") && e ? (f.find('[command="Hide"]').parent().hide(), f.find('[command="Show"]').parent().show()) : (f.find('[command="Show"]').parent().hide(), f.find('[command="Hide"]').parent().show())) : (f.find('[command="Show"]').parent().hide(), f.find('[command="Hide"]').parent().hide(), t(n.target).closest(".fieldGroup").length > 0 && (h = t(n.target).closest(".fieldGroup").find(".fieldLbl"), o = t(n.target).closest(".fieldGroup"), o.find(".imgField:hidden").length > 0 ? (f.find('[command="ShowImg"]').parent().show(), f.find('[command="Hide"]').parent().hide()) : o.find(".fieldValue:hidden").length > 0 ? (f.find('[command="Hide"]').parent().hide(), f.find('[command="ShowValue"]').parent().show()) : o.find(".imgField").length == 1 && o.find(".fieldValue").length == 1 ? (f.find('[command="Hide"]').parent().show(), i.find(".imgTextCont").removeClass("vis-disable-event")) : i.find(".imgTextCont").addClass("vis-disable-event"), e = h.attr("showFieldText") == "true" ? !0 : !1, f.find('[command="fieldName"]').text(h.attr("title")).show()), e && f.find('[command="Show"]').parent().show()), t(n.target).find(".vis-split-cell").length == 0 ? (f.find('[command="Separate"]').parent().hide(), t(n.target).hasClass("grdDiv") && (p = !0), c.find(".grdDiv").each(function (n) { var i = r.find(".colBox").length - 1, u = Math.ceil((n + 1) / i); t(this).hasClass("vis-active-block") && (wt = u - 1, ri = n - i * wt) })) : f.find('[command="Separate"]').parent().show()); t(n.target).hasClass("vis-wizard-section") && f.find('[command="fieldName"]').text("Section " + t(n.target).attr("sectioncount")).show(); t(n.target).hasClass("vis-viewBlock") && f.find('[command="fieldName"]').text("Main container").show() } }, 30) }).mouseup(function (n) { setTimeout(function () { p = !1; fu(t(n.target)) }, 30) }); i.find("[data-command]").on("change", function () { var e, u, o; t(this).removeClass("vis-editor-validate"); var n = t(this).data("command"), r = t(this).val(), f = !1; if (n.indexOf("margin") != -1 && r.indexOf("-") != -1 && (f = !0), e = r.replace(/\d+/g, "").replace(".", ""), u = r.replace(r.replace(/\d+/g, ""), ""), l[n] && l[n].measurment && r != "" && t(this).attr("type") != "color") if (nu.indexOf(e) < 0) { if (isNaN(Number(u))) { t(this).addClass("vis-editor-validate"); return } f ? t(this).val("-" + u + "px") : t(this).val(u + "px") } else if (isNaN(Number(u))) { t(this).addClass("vis-editor-validate"); return } n == "backgroundColor" ? (i.find(".vis-zero-BTopLeftBLeft:first").css("background-color", r), i.find('[data-command="backgroundColor"]').val(r)) : n == "color" ? (i.find(".vis-zero-BTopLeftBLeft:last").css("background-color", r), i.find('[data-command="color"]').val(r)) : (n == "borderColor" || n == "borderLeftColor" || n == "borderRightColor" || n == "borderTopColor" || n == "borderBottomColor") && (o = i.find("[data-command='" + n + "']").closest(".vis-prop-pan-cont"), o.find(".vis-back-color03").css("background-color", r)); rt(n, t(this).val()) }); i.find("[data-command1]").on("click", function () { var n = t(this).data("command1"), i = u.find(".vis-active-block"), f = !1, r; f = l[n].measurment ? rr(l[n].proprty, l[n].value, i) : rr(l[n].proprty, !1, i); r = t(this).closest(".vis-horz-align-d").find(".vis-hr-elm-inn-active"); r.removeClass("vis-hr-elm-inn-active"); (l[n].proprty == "justify-content" || l[n].proprty == "align-items") && rr("display", "flex", i) ? (i[0].style.removeProperty("display"), rt(n, ""), r.find("[data-command1]").attr("data-command1") != n && (t(this).parent().addClass("vis-hr-elm-inn-active"), rt(n, l[n].value))) : l[n].proprty == "text-align" || l[n].proprty == "text-transform" ? (rt(n, ""), r.find("[data-command1]").attr("data-command1") != n && (t(this).parent().addClass("vis-hr-elm-inn-active"), rt(n, l[n].value))) : f ? (t(this).parent().removeClass("vis-hr-elm-inn-active"), rt(n, "")) : (t(this).parent().addClass("vis-hr-elm-inn-active"), rt(n, l[n].value)); (i.attr("style").indexOf("justify-content") != -1 || i.attr("style").indexOf("align-items") != -1 || i.attr("style").indexOf("flex-direction") != -1) && i.css("display", "flex") }); i.find("[data-command2]").on("click", function () { f.hide(); var n = c.find(".vis-active-block").closest(".fieldGroup"), i = t(this).data("command2"), r = n.find(".fieldValue").attr("style"), u = n.find(".fieldValue").attr("class"); n.find(".fieldValue br").remove(); i == "SwapImgTxt" ? n.find(".imgField").before(n.find(".fieldValue")) : i == "SwapTxtImg" ? n.find(".fieldValue").before(n.find(".imgField")) : i == "SwapTxtImgBr" ? (n.find(".fieldValue").before(n.find(".imgField")), n.find(".fieldValue").prepend("<br>")) : i == "SwapImgTxtBr" && (n.find(".imgField").before(n.find(".fieldValue")), n.find(".fieldValue").append("<br>")); s() }); wi.change(function () { var n = u.find(".vis-active-block"); n.attr("style", t(this).val()); s() }); si.change(function () { var i = u.find(".vis-active-block"), r; t(this).val() == null || t(this).val() == "" ? (i.find("sql").remove(), i.attr("query", "")) : (r = n.secureEngine.encrypt(t(this).val()), i.attr("query", r), i.find("sql").length == 0 && i.append("<sql>SQL<\/sql>")); s() }); r.find(".addGridRow").click(function () { var n = r.find(".rowBox:first").clone(!0); n.show(); r.find(".DivRowBox").append(n); yr(); s() }); r.find(".addGridCol").click(function () { var n = r.find(".colBox:first").clone(!0); n.show(); r.find(".DivColBox").append(n); yr(); s() }); r.find(".addGridSection").click(function () { ki = !0; r.find(".section-active").removeClass("section-active"); var n = r.find(".grid-Section:first").clone(!0); n.removeClass("displayNone"); n.addClass("section-active"); ht = r.find(".grid-Section").length; n.attr("sectionCount", ht); n.find(".vis-grey-disp-ttl").text("Section " + ht); r.find(".vis-sectionAdd").append(n); c = t('<div name="Section ' + ht + '" sectionCount="' + ht + '"  class="section' + ht + ' vis-wizard-section" style="padding:5px"><\/div>'); u.find(".vis-viewBlock").append(c); r.find(".rowBox:not(:first)").remove(); r.find(".colBox:not(:first)").remove(); r.find(".addGridRow").click(); r.find(".addGridCol").click(); r.find(".vis-sectionAdd").sortable({ disabled: !1, update: function (n, t) { var i = t.item.attr("sectioncount"), e = t.item.index(), r = t.item.next().attr("sectioncount"), f; r ? u.find('[sectioncount="' + r + '"]').before(u.find('[sectioncount="' + i + '"]')) : (f = t.item.prev().attr("sectioncount"), u.find('[sectioncount="' + f + '"]').after(u.find('[sectioncount="' + i + '"]'))); s() } }); s() }); r.find(".grid-Section .vis-grey-disp-el-xross").click(function () { var n = t(this).closest(".grid-Section").attr("sectionCount"), i; t(this).closest(".grid-Section").hasClass("section-active") && (r.find(".grid-Section").eq(1).addClass("section-active"), r.find(".grid-Section").eq(1).find(".vis-grey-disp-el").click()); t(this).closest(".grid-Section").remove(); i = u.find(".vis-viewBlock .section" + n); i.find(".fieldLbl").each(function () { t(this).attr("title") && t(this).attr("title").length > 0 && pi(t(this).attr("title"), t(this)) }); i.remove(); delete a["section" + n]; n = r.find(".section-active").attr("sectionCount"); c = u.find(".vis-viewBlock .section" + n); s() }); r.find(".grid-Section .vis-grey-disp-el").click(function () { r.find(".section-active").removeClass("section-active"); t(this).parent().addClass("section-active"); var n = r.find(".section-active").attr("sectionCount"); c = u.find(".vis-viewBlock .section" + n); u.find(".vis-active-block").removeClass("vis-active-block"); c.addClass("vis-active-block"); uu(); gt ? gt = !1 : s() }); gi.click(function () { var n = u.find(".vis-active-block").css("grid-area").split("/"); r.find(".grdRowAdd").eq(Number(n[2]) - 1).click() }); ai.click(function () { var n = u.find(".vis-active-block").css("grid-area").split("/"); r.find(".grdRowDel").eq(Number(n[2]) - 1).click() }); nr.click(function () { var n = u.find(".vis-active-block").css("grid-area").split("/"); r.find(".grdColAdd").eq(Number(n[3]) - 1).click() }); vi.click(function () { var n = u.find(".vis-active-block").css("grid-area").split("/"); r.find(".grdColDel").eq(Number(n[3]) - 1).click() }); r.find(".grdRowDel").click(function () { var f = t(this).closest(".rowBox").index(), i, n; tt = f; var o = r.find(".rowBox").length - 1, u = r.find(".colBox").length - 1, e = f * u + 1 - u; for (i = e; i < e + u; i++)c.find(".grdDiv").eq(i - 1).addClass("del"), n = c.find(".grdDiv").eq(i - 1).find(".fieldLbl"), n && n.attr("title") && n.attr("title").length > 0 && pi(n.attr("title"), n); c.find(".del").remove(); t(this).closest(".rowBox").remove(); k(-1, 0); s() }); r.find(".grdRowAdd").click(function () { var i = t(this).closest(".rowBox").index() - 1, u = r.find(".rowBox:first").clone(!0), n; u.show(); r.find(".DivRowBox").append(u); var o = r.find(".rowBox").length - 1, f = r.find(".colBox").length - 1, e = (i + 1) * f; for (tt = i + 1, n = 0; n < f; n++)c.find(".grdDiv").eq(e - 1).after("<div class='grdDiv' style='padding:5px;display: flex; flex-direction: row;'><\/div>"); ir(); k(1, 0); s() }); r.find(".grdColDel").click(function () { var e = t(this).closest(".colBox").index() - 1, h = r.find(".rowBox").length - 1, o = r.find(".colBox").length - 1, u, i, f, n; for (ut = e + 1, u = 0; u < h; u++)for (i = 0; i < o; i++)i == e && (f = o * u + i, c.find(".grdDiv").eq(f).addClass("del"), n = c.find(".grdDiv").eq(f).find(".fieldLbl"), n && n.attr("title") && n.attr("title").length > 0 && pi(n.attr("title"), n)); c.find(".del").remove(); t(this).closest(".colBox").remove(); k(0, -1); s() }); r.find(".grdColAdd").click(function () { var f = r.find(".colBox:first").clone(!0), i, n, u; f.show(); r.find(".DivColBox").append(f); ft = []; var e = t(this).closest(".colBox").index() - 1, h = r.find(".rowBox").length - 1, o = r.find(".colBox").length - 1; for (ut = e + 1, i = 0; i < h; i++)for (n = 0; n < o; n++)n == e && (u = o * i + n, ft.push(u + 1), c.find(".grdDiv").eq(u).after("<div class='grdDiv' style='padding:5px;display: flex; flex-direction: row;'><\/div>")); ir(); k(0, 1); s() }); r.find(".mergeCell").click(function () { pr(); s() }); kt.change(function () { k(); s() }); bt.change(function () { k(); s() }); r.find(".rowBox input,select").change(function () { k(); s() }); r.find(".colBox input,select").change(function () { k(); s() }); bi.click(function () { h.find('.mainTemplate[templateid="' + w + '"]').parent().click(); yt > 1 && (vr(), ti()); bi.hide() }); cr.click(function () { h.find('.mainTemplate[templateid="0"]').parent().click(); pt.click() }); u.find(".vis-viewBlock")[0].addEventListener("dragstart", function (n) { di = t(n.target); di.hasClass("grdDiv") || !n.ctrlKey ? n.preventDefault() : (f.hide(), p = !1) }, !1); u.find(".vis-viewBlock")[0].addEventListener("dragover", function (n) { n.preventDefault() }); u.find(".vis-viewBlock")[0].addEventListener("drop", function (n) { n.preventDefault(); u.find(".vis-active-block").removeClass("vis-active-block"); var i = t(n.target); i.hasClass("grdDiv") && (i.append(di), s()) }); et.click(function () { v > 0 ? (gt = !0, tr = !1, canv_data = JSON.parse(y[v - 1]), u.find(".vis-viewBlock").html(canv_data), v--, ct.removeAttr("disabled"), v <= 0 && et.attr("disabled", "disabled"), ti(), u.find(".grdDiv").unbind("mouseover"), u.find(".grdDiv").mouseover(function () { p && t(this).find(".vis-split-cell").length == 0 && yi(t(this)) })) : et.attr("disabled", "disabled") }); ct.click(function () { y[v + 1] ? (gt = !0, tr = !1, canv_data = JSON.parse(y[v + 1]), u.find(".vis-viewBlock").html(canv_data), v++, et.removeAttr("disabled"), ti(), v >= y.length - 1 && ct.attr("disabled", "disabled"), u.find(".grdDiv").unbind("mouseover"), u.find(".grdDiv").mouseover(function () { p && t(this).find(".vis-split-cell").length == 0 && yi(t(this)) })) : ct.attr("disabled", "disabled") }); ot.change(function () { t(this).val() != "" ? (h.find('[issystemtemplate="Y"]').not(".blankTemp").addClass("displayNone"), h.find('[issystemtemplate="Y"][category="' + t(this).val() + '"]').removeClass("displayNone")) : h.find('[issystemtemplate="Y"]').removeClass("displayNone"); h.find(".vis-cardSingleViewTemplate:not(:hidden)").length == 1 ? h.find(".vis-noTemplateIcon").show() : h.find(".vis-noTemplateIcon").hide() }); u.find(".vis-viewBlock").on("DOMSubtreeModified", function () { var n = u.height(), t = u.find(".canvas").height(); n && t && t > n ? u.find(".canvas").addClass("canvasOverFlow") : u.find(".canvas").removeClass("canvasOverFlow") }) } function vr() { var i = h.find(".vis-active-template").clone(!0); i.attr("lastupdated") && er.text(n.Msg.getMsg("LastSaved") + " " + i.attr("lastupdated")); i.find(".mainTemplate").css("zoom", 1); CardCreatedby = i.attr("createdBy"); hr = i.attr("isSystemTemplate"); lt.val(i.attr("category") == "0" ? "" : i.attr("category")); w = i.find(".mainTemplate").attr("templateid"); or = w; templateName = i.find(".mainTemplate").attr("name"); w == "0" && i.find(".mainTemplate").html(t('<div name="Section 1" sectionCount="1" class="section1 vis-wizard-section" style="padding:5px;"><\/div>')); i.find("[contenteditable]").attr("contenteditable", !0); dt.val(i.find(".mainTemplate").attr("name")); w = i.find(".mainTemplate").attr("templateid"); (i.html() != "" || i.html() != null) && (i.find(".vis-wizard-section").each(function () { for (var u = t(this).attr("row"), i = t(this).attr("col"), n = [], r = 0; r < u * i; r++)n.push('<div class="grdDiv" style="display:none"><\/div>'); t(this).find(".grdDiv").each(function () { var r = t(this).css("grid-area").split("/"), u = i * (t.trim(r[0]) - 1) + (t.trim(r[1]) - 1); (t.trim(r[0]) != t.trim(r[2]) - 1 || t.trim(r[1]) != t.trim(r[3]) - 1) && t(this).append('<span class="vis-split-cell"><\/span>'); n[u] = t(this)[0].outerHTML }); t(this).html(n.join(" ")) }), u.find(".vis-viewBlock").attr("style", i.find(".mainTemplate").attr("style") || ""), u.find(".vis-viewBlock").html(i.find(".mainTemplate").html()), u.find(".vis-viewBlock").find(".fieldValue").attr("contenteditable", !0), u.find(".vis-viewBlock").find(".fieldLbl").attr("contenteditable", !0), u.find(".fieldGroup").each(function () { t(this).find(".imgField").length > 0 && t(this).find(".fieldValue").length > 0 ? t(this).find(".fieldLbl").attr("title", "Image+Text") : t(this).find(".imgField").length > 0 && t(this).find(".fieldLbl").attr("title", "Image") }), u.find(".grdDiv").unbind("mouseover"), u.find(".grdDiv").mouseover(function () { p && t(this).find(".vis-split-cell").length == 0 && yi(t(this)) })) } function ir() { var n = c; n.find(".grdDiv").unbind("mouseover"); n.find(".grdDiv").mouseover(function () { p && t(this).find(".vis-split-cell").length == 0 && yi(t(this)) }) } function k(n, i) { var s, l, e, f, p, b; n || (n = 0); i || (i = 0); var w = r.find(".section-active").attr("sectionCount"), k = r.find(".section-active .vis-grey-disp-ttl").text(), u = {}, h = ""; r.find(".rowBox:not(:first)").each(function (n) { n == 0 && t(this).find(".grdRowDel").hide(); h += t(this).find("select :selected").val() == "auto" ? t(this).find("select :selected").val() + " " : t(this).find("input").val() + "" + t(this).find("select :selected").val() + " "; u["row_" + n] = { val: t(this).find("input").val(), msr: t(this).find("select :selected").val() } }); s = ""; r.find(".colBox:not(:first)").each(function (n) { n == 0 && t(this).find(".grdColDel").hide(); s += t(this).find("select :selected").val() == "auto" ? t(this).find("select :selected").val() + " " : t(this).find("input").val() + "" + t(this).find("select :selected").val() + " "; u["col_" + n] = { val: t(this).find("input").val(), msr: t(this).find("select :selected").val() } }); l = r.find(".rowBox:not(:first)").length; e = r.find(".colBox:not(:first)").length; u.sectionNo = w; u.sectionName = k; u.rowGap = bt.val(); u.colGap = kt.val(); u.totalRow = l; u.totalCol = e; a["section" + w] = u; f = c; f.attr("row", l); f.attr("col", e); f.css({ "grid-template-columns": s, "grid-template-rows": h, gap: bt.val() + "px " + kt.val() + "px" }); var o = !1, v = tt, y = ut; n == -1 && v--; i == -1 && y--; p = 0; b = ft; f.find(".grdDiv").each(function (r) { var c = t(this).css("grid-area").split("/"), u = Number(t.trim(c[0])), s = Number(t.trim(c[2])), l = Number(t.trim(c[1])), a = Number(t.trim(c[3])), k = Math.floor(r / e) + 1, d, nt, h, g, w; if (tt != null) { if (tt > u - 1 && tt < s - 1 && (t(this).css("grid-area", u + "/" + l + "/" + (s + n) + "/" + a), o = !0), o && n > 0) { for (h = Number(u); h <= Number(s); h++) { for (d = l; d < a; d++)nt = e * h + d, f.find(".grdDiv").eq(nt - 1).css("display", "none"); if (tt == h) break } o = !1; tt = null } } else if (ut != null && (ut > l - 1 && ut < a - 1 && (t(this).css("grid-area", u + "/" + l + "/" + s + "/" + (a + i)), o = !0, f.find(".grdDiv").eq(b[p]).css("display", "none")), p++, o && i > 0)) { for (h = 0; h < ft.length; h++)g = Math.floor(ft[h] / e) + 1, g > u - 1 && g < s && f.find(".grdDiv").eq(ft[h]).css("display", "none"); o = !1; ft = [] } c = t(this).css("grid-area").split("/"); u = Number(t.trim(c[0])); s = Number(t.trim(c[2])); l = Number(t.trim(c[1])); a = Number(t.trim(c[3])); w = r % e + 1; t(this).find(".vis-split-cell").length == 0 ? t(this).css("grid-area", k + "/" + w + "/" + (k + 1) + "/" + (w + 1)) : i != 0 ? i > 0 ? w > y && t(this).css("grid-area", u + "/" + (l + i) + "/" + s + "/" + (a + i)) : w > y && t(this).css("grid-area", u + "/" + (l - 1) + "/" + s + "/" + (a - 1)) : n != 0 && (n > 0 ? k > v && t(this).css("grid-area", u + n + "/" + l + "/" + (s + n) + "/" + a) : k > v && t(this).css("grid-area", u - 1 + "/" + l + "/" + (s - 1) + "/" + a)) }); ut = null } function yr() { var l = r.find(".rowBox"), a = r.find(".colBox"), e = l.length - 1, i = a.length - 1, n = c, o, u, t, s, h, f; if (i > 0 && e > 0) { if (o = n.attr("row"), u = n.attr("col"), u == i || ki) for (h = e * i - n.find(".grdDiv").length, f = 0; f < h; f++)n.append("<div class='grdDiv' style='padding:5px;display: flex; flex-direction: row;'><\/div>"); else for (t = 1; t <= o; t++)s = t * u + (t - 1), n.find(".grdDiv").eq(s - 1).after("<div class='grdDiv' style='padding:5px;display: flex; flex-direction: row;'><\/div>"); ir(); ki = !1 } k() } function uu() { var n, u; r.find(".rowBox:not(:first)").remove(); var f = r.find(".section-active").attr("sectionCount"), t = a["section" + f], i = r.find(".rowBox:first").clone(!0); if (i.show(), r.find(".colBox:not(:first)").remove(), n = r.find(".colBox:first").clone(!0), n.show(), t) { for (let f in t) u = t[f], f.indexOf("row_") != -1 ? (i.find("input").val(u.val), i.find("select").val(u.msr), r.find(".DivRowBox").append(i), i = r.find(".rowBox:last").clone(!0)) : f.indexOf("col_") != -1 && (n.find("input").val(u.val), n.find("select").val(u.msr), r.find(".DivColBox").append(n), n = r.find(".colBox:last").clone(!0)); bt.val(t.rowGap); kt.val(t.colGap); r.find(".rowBox .grdRowDel").eq(1).hide(); r.find(".colBox .grdColDel").eq(1).hide() } } function yi(n) { var e = r.find(".colBox").length - 1, o = c.find(n).index(), t, i; if (!(o < 0)) { var p = Math.ceil((o + 1) / e) - 1, s = o - e * p, h = p, l, a, v, y; for (h < wt ? (l = h, a = wt) : (l = wt, a = h), s < ri ? (v = s, y = ri) : (v = ri, y = s), u.find(".vis-active-block").removeClass("vis-active-block"), t = l; t <= a; t++)for (i = v; i <= y; i++)c.find(".grdDiv").eq(e * t + i).addClass("vis-active-block"); u.find(".vis-active-block").length > 1 ? f.find('[command="Merge"]').parent().show() : f.find('[command="Merge"]').parent().hide() } } function pr() { var i = 0, s = 0, u = 0, f = 1, n = 0, h = 1, a = c.find(".vis-active-block").length, l = 1, e = 0, v = r.find(".colBox").length - 1, o; c.find(".grdDiv").each(function (r) { n++; var o = Math.ceil((r + 1) / v); o != l && (n = 1); l = o; t(this).hasClass("vis-active-block") && (e == 0 && (e = o), i == 0 && u == 0 && (i = o, u = n, f = n), e == o && f++, h == a && (s = o + 1), h++, t(this)[0].style.removeProperty("grid-area"), t(this)[0].style.removeProperty("display")) }); o = t('<span class="vis-split-cell"><\/span>'); c.find(".vis-active-block:not(:first)").hide().removeClass("vis-active-block"); c.find(".vis-active-block:first").css("grid-area", i + "/" + u + "/" + s + "/" + f).append(o); o.click(function () { wr(t(this).parent()); t(this).remove() }) } function wr(n) { for (var u, e, i = n.css("grid-area").split("/"), s = r.find(".colBox").length - 1, o = c.find(".grdDiv"), f = Number(t.trim(i[0])); f < Number(t.trim(i[2])); f++)for (u = Number(t.trim(i[1])); u < Number(t.trim(i[3])); u++)e = s * (f - 1) + (u - 1), o.eq(e)[0].style.removeProperty("grid-area"), o.eq(e)[0].style.removeProperty("display"); k() } function rr(n, i, r) { var f = r.attr("style"), u = !1; return f && f.split(";").forEach(function (r) { var f = r.split(":"); i && t.trim(f[0]) === n && t.trim(f[1]) === i ? u = !0 : i || t.trim(f[0]) !== n || (u = !0) }), u } function rt(n, r) { var f, v; if (u.css({ width: d.find(".vis-cardViewTemplateHead")[0].offsetWidth, overflow: "auto" }), f = u.find(".vis-active-block"), l[n].proprty == "flex-direction" && (f[0].style.removeProperty("display"), f.find(".fieldGroup").removeAttr("style")), n == "maxTextmultiline" && (r == "" || r == null ? (f[0].style.removeProperty("overflow"), f[0].style.removeProperty("display"), f[0].style.removeProperty("-webkit-box-orient")) : f.css({ overflow: "hidden", display: "-webkit-box", "-webkit-box-orient": "vertical" })), n != "gradient" && (r == "" || r == null)) { f[0].style.removeProperty(l[n].proprty); return } if (n == "gradient") { var e = i.find("." + n + "1").val(), o = i.find("." + n + "2").val(), h = i.find(".percent1").val(), c = i.find(".percent2").val(), a = i.find(".grdDirection option:selected").val(); r = "linear-gradient(" + a + "," + e + " " + h + "%,  " + o + " " + c + "%)"; i.find('[data-command="gradientInput"]').val("(" + a + "," + e + " " + h + "%,  " + o + " " + c + "%)") } if (n == "gradientInput" && (r = "linear-gradient" + r), n == "boxShadow") { var y = i.find(".boxX").val(), p = i.find(".boxY").val(), w = i.find(".boxB").val(), b = i.find(".boxC").val(); r = y + " " + p + " " + w + " " + b } (l[n].proprty == "justify-content" || l[n].proprty == "align-items" || l[n].proprty == "flex-direction") && (f.css("display", "flex"), l[n].proprty == "flex-direction" && f.find(".fieldGroup").css({ display: "flex", "flex-direction": t.trim(r) })); r == "column" || r == "column-reverse" ? i.find('[data-command1="flexJustifyStart"]').closest(".vis-horz-align-d").addClass("vis-disable-event") : i.find('[data-command1="flexJustifyStart"]').closest(".vis-horz-align-d").removeClass("vis-disable-event"); n == "width" || n == "height" ? (v = f.attr("style") + ";" + l[n].proprty + ":" + t.trim(r) + " !important", f.attr("style", v)) : f.css(l[n].proprty, t.trim(r)); s() } function fu(r) { i.find('[data-command1="flexJustifyStart"]').closest(".vis-horz-align-d").removeClass("vis-disable-event"); i.find("#master001_" + o + " input").val(""); i.find("#master001_" + o + " select").val(""); i.find(".gradient1").val("#000"); i.find(".gradient2").val("#000"); i.find(".percent1").val("0"); i.find(".percent2").val("100"); i.find(".grdDirection").val("to bottom"); i.find("[data-command1]").parent().removeClass("vis-hr-elm-inn-active"); var u = r.attr("style"); r.find("sql").length > 0 ? si.val(n.secureEngine.decrypt(r.attr("query"))) : si.val(""); wi.val(u); u && u.split(";").forEach(function (n) { var e = n.split(":"), f, u, o; for (const n in l) if ((t.trim(e[0]) == "border-left" || t.trim(e[0]) == "border-right" || t.trim(e[0]) == "border-top" || t.trim(e[0]) == "border-bottom") && (e[0] = e[0] + "-width"), t.trim(e[0]) == t.trim(l[n].proprty)) if (f = t.trim(e[1]), l[n].value == "") { (n == "width" || n == "height") && (f = f.replaceAll("!important", "")); n == "fontFamily" && (f = f.replaceAll('"', "")); n == "padding" && t.trim(f).split(" ").length > 1 ? (fi.prop("checked", !1), i.find(".allPadding").addClass("displayNone"), i.find(".singlePadding").removeClass("displayNone"), i.find("[data-command='paddingLeft']").val(r.css("padding-left")), i.find("[data-command='paddingTop']").val(r.css("padding-top")), i.find("[data-command='paddingRight']").val(r.css("padding-right")), i.find("[data-command='paddingBottom']").val(r.css("padding-bottom"))) : n == "padding" ? (fi.prop("checked", !0), i.find(".allPadding").removeClass("displayNone"), i.find(".singlePadding").addClass("displayNone"), i.find("[data-command='" + n + "']").val(f)) : n == "margin" && t.trim(f).split(" ").length > 1 ? (ei.prop("checked", !1), i.find(".allMargin").addClass("displayNone"), i.find(".singleMargin").removeClass("displayNone"), i.find("[data-command='marginLeft']").val(r.css("margin-left")), i.find("[data-command='marginTop']").val(r.css("margin-top")), i.find("[data-command='marginRight']").val(r.css("margin-right")), i.find("[data-command='marginBottom']").val(r.css("margin-bottom"))) : n == "margin" ? (ei.prop("checked", !0), i.find(".allMargin").removeClass("displayNone"), i.find(".singleMargin").addClass("displayNone"), i.find("[data-command='" + n + "']").val(f)) : n == "borderRadius" && t.trim(f).split(" ").length > 1 ? (ui.prop("checked", !1), i.find(".allBorderRadius").addClass("displayNone"), i.find(".singleBorderRadius").removeClass("displayNone"), i.find("[data-command='borderTopLeftRadius']").val(r.css("border-top-left-radius")), i.find("[data-command='borderTopRightRadius']").val(r.css("border-top-right-radius")), i.find("[data-command='borderBottomRightRadius']").val(r.css("border-bottom-right-radius")), i.find("[data-command='borderBottomLeftRadius']").val(r.css("border-bottom-left-radius"))) : n == "borderRadius" ? (ui.prop("checked", !0), i.find(".allBorderRadius").removeClass("displayNone"), i.find(".singleBorderRadius").addClass("displayNone"), i.find("[data-command='" + n + "']").val(f)) : i.find("[data-command='" + n + "']").val(f); n == "backgroundColor" ? (i.find(".vis-zero-BTopLeftBLeft:first").css("background-color", f), i.find("[data-command='" + n + "'][type='color']").val(st(f))) : n == "color" ? (i.find(".vis-zero-BTopLeftBLeft:last").css("background-color", f), i.find("[data-command='" + n + "'][type='color']").val(st(f))) : n.indexOf("border") != -1 && n.indexOf("radius") == -1 && (u = r[0].style, u.border == "" ? (u.borderLeftWidth != "" && (i.find("[data-command='borderLeft']").val(u.borderLeftWidth), i.find("[data-command='borderLeftStyle']").val(u.borderLeftStyle), i.find("[data-command='borderLeftColor']").val(st(u.borderLeftColor)), i.find("[data-command='borderLeftColor']").parent().css("background-color", u.borderLeftColor)), u.borderRightWidth != "" && (i.find("[data-command='borderRight']").val(u.borderRightWidth), i.find("[data-command='borderRightStyle']").val(u.borderRightStyle), i.find("[data-command='borderRightColor']").val(st(u.borderRightColor)), i.find("[data-command='borderRightColor']").parent().css("background-color", u.borderRightColor)), u.borderTopWidth != "" && (i.find("[data-command='borderTop']").val(u.borderTopWidth), i.find("[data-command='borderTopStyle']").val(u.borderTopStyle), i.find("[data-command='borderTopColor']").val(st(u.borderTopColor)), i.find("[data-command='borderTopColor']").parent().css("background-color", u.borderTopColor)), u.borderBottomWidth != "" && (i.find("[data-command='borderBottom']").val(u.borderBottomWidth), i.find("[data-command='borderBottomStyle']").val(u.borderBottomStyle), i.find("[data-command='borderBottomColor']").val(st(u.borderBottomColor)), i.find("[data-command='borderBottomColor']").parent().css("background-color", u.borderBottomColor))) : (o = f.split("rgb"), o.length > 1 && (f = f.replace("rgb" + o[1], st("rgb" + o[1]))), i.find("[data-command='" + n + "']").val(f)), u.border == "" && (u.borderTopWidth != "" || u.borderRightWidth != "" || u.borderTopWidth != "" || u.borderBottomWidth != "") ? (oi.prop("checked", !1), i.find(".allBorder").addClass("displayNone"), i.find(".singleBorder").removeClass("displayNone")) : (oi.prop("checked", !0), i.find(".allBorder").removeClass("displayNone"), i.find(".singleBorder").addClass("displayNone"))); break } else if (l[n].value == f) { i.find("[data-command1='" + n + "']").parent().addClass("vis-hr-elm-inn-active"); break } }); (i.find("[data-command='flexDirection'] option:selected").val() == "column" || i.find("[data-command='flexDirection'] option:selected").val() == "column-reverse") && i.find('[data-command1="flexJustifyStart"]').closest(".vis-horz-align-d").addClass("vis-disable-event") } function st(n) { try { if (/^#[0-9A-F]{6}$/i.test(n)) return n; n = n.match(/^rgb\((\d+),\s*(\d+),\s*(\d+)\)$/); function t(n) { return ("0" + parseInt(n).toString(16)).slice(-2) } return "#" + t(n[1]) + t(n[2]) + t(n[3]) } catch (t) { return n } } function pi(n, t) { t.closest(".fieldGroup").remove(); t.remove(); f.hide() } function ur() { var i, r; nt(!0); i = n.Application.contextUrl + "CardView/GetSystemTemplateDesign"; h.find('.mainTemplate[templateid="0"]').parent().click(); h.find(".vis-cardSingleViewTemplate:not(:first)").remove(); r = {}; t.ajax({ type: "POST", url: i, dataType: "json", contentType: "application/json; charset=utf-8", data: JSON.stringify(r), success: function (n) { for (var r = JSON.parse(n), i = 0; i < r.length; i++)h.find(".vis-cardTemplateContainer").append(t(r[i].template)); nt(!1); h.find(".vis-cardSingleViewTemplate:not(:hidden)").length == 1 ? h.find(".vis-noTemplateIcon").show() : h.find(".vis-noTemplateIcon").hide() }, error: function (n) { alert(n.statusText); nt(!1) }, complete: function () { h.find(".vis-cardSingleViewTemplate").click(function (n) { t(n.target).hasClass("chkMark") || (t(n.target).index() == 0 ? it.hide() : it.show(), h.find(".vis-cardSingleViewTemplate").removeClass("vis-active-template"), t(this).addClass("vis-active-template"), h.find(".chkMark").prop("checked", !1), t(this).find(".chkMark").prop("checked", !0), e.find(".chkMark").change()) }); h.find(".vis-deleteTemplate").click(function () { cu(Number(t(this).next().attr("templateID")), t(this)) }); kr(); t.each(e.find('[issystemtemplate="Y"]:not(:first)'), function () { var n = '<div style="position: absolute;left: 5px;top: 5px;z-index:9"><input type="checkbox" value="' + t(this).find(".mainTemplate").attr("templateid") + '" class="pull-right vis-styledCheckbox m-0 chkMark" style="width:20px;height:20px;position: absolute;" ><label><\/label><\/div>'; t(this).append(n) }); br(); iu() } }) } function eu() { ot.find("option").remove(); lt.find("option").remove(); ot.append('<option value="">All<\/option>'); lt.append('<option value="">--Select Category--<\/option>'); t.ajax({ type: "POST", url: n.Application.contextUrl + "CardView/GetTemplateCategory", dataType: "json", contentType: "application/json; charset=utf-8", data: {}, success: function (n) { var i = JSON.parse(n), t; if (i) for (t = 0; t < i.length; t++)ot.append('<option value="' + i[t].TemplateCategoryID + '">' + i[t].Name + "<\/option>"), lt.append('<option value="' + i[t].TemplateCategoryID + '">' + i[t].Name + "<\/option>"); nt(!1) }, error: function (n) { alert(n.statusText); nt(!1) } }) } function ou(i) { var r, c, l; if (i.preventDefault(), dt.val() == "") return n.ADialog.error("FillMandatory", !0, "Template Name"), !1; if (r = !1, w == 0 && h.find(".mainTemplate").each(function () { if (t(this).attr("name") && t.trim(t(this).attr("name").toUpperCase()) == t.trim(dt.val().toUpperCase())) return r = !0, n.ADialog.error("TempalteAlreadyExist", !0, ""), !1 }), r) return !1; nt(!0); var f = [], o = 10, s = []; cardViewColArray = []; u.find(".grdDiv:not(:hidden)").each(function () { var n = t(this).css("grid-area").split("/"), i = t(this).closest(".vis-wizard-section").attr("sectioncount"), r, u, e; a["section" + i].style = t(this).closest(".vis-wizard-section").attr("style"); a["section" + i].sectionID = t(this).closest(".vis-wizard-section").attr("sectionid") || 0; r = (t(this).closest(".vis-wizard-section").index() + 1) * 10; a["section" + i].sectionSeq = r; a["section" + i].sectionName = t(this).closest(".vis-wizard-section").attr("name"); u = null; t(this).find("sql").length > 0 && (u = t(this).attr("query") || null); t(this).find(".fieldGroup:not(:hidden)").length > 0 ? t(this).find(".fieldGroup:not(:hidden)").each(function () { var s = "", a = t(this).find(".fieldLbl").text(), i = "", h, l, c; t(this).find(".imgField").length > 0 && t(this).find(".fieldValue").length > 0 ? (t(this).find(".imgField").attr("src") ? s = '<img class="imgField" src="' + t(this).find(".imgField").attr("src") + '" style="' + t(this).find(".imgField").attr("style") + '">' : (h = t(this).find(".imgField").attr("class"), h = h.replace("vis-active-block", ""), s = '<i class="imgField ' + h + '" style="' + t(this).find(".imgField").attr("style") + '"><\/i>'), s += " |" + t(this).find(".fieldValue").text(), l = t(this).find("br").length, t(this).find(".imgField").next(".fieldValue").length > 0 ? (i = "@img::" + t(this).find(".imgField").attr("style") || "", l > 0 && (i += "|<br>"), i += " |@value::" + t(this).find(".fieldValue").attr("style") || "display:none") : (i = "@value::" + t(this).find(".fieldValue").attr("style") || "display:none", l > 0 && (i += "|<br>"), i += " |@img::" + t(this).find(".imgField").attr("style") || "")) : t(this).find(".imgField").length > 0 ? (s = '<img class="imgField" src="' + t(this).find(".imgField").attr("src") + '" style="' + t(this).find(".imgField").attr("style") + '">', i = ("@value::" + t(this).find(".fieldValue").attr("style") || "") + (" |@img::" + t(this).find(".imgField").attr("style") || "")) : (s = t(this).find(".fieldValue").text(), i = t(this).find(".fieldValue").attr("style") || ""); c = !0; t(this).find(".fa-star").length == 0 && (c = !0); t(this).find(".fieldLbl").attr("showfieldicon") && (c = t(this).find(".fieldLbl").attr("showfieldicon") == "true" ? !0 : !1); e = { cardFieldID: t(this).attr("cardfieldid"), sectionNo: r, rowStart: t.trim(n[0]), rowEnd: t.trim(n[2]), colStart: t.trim(n[1]), colEnd: t.trim(n[3]), seq: o, style: t(this).closest(".grdDiv").attr("style"), fieldID: t(this).find(".fieldLbl").attr("fieldid"), valueStyle: i, fieldStyle: t(this).find(".fieldLbl").attr("style") || "", hideFieldIcon: c, hideFieldText: t(this).find(".fieldLbl").attr("showfieldtext") == "true" ? !0 : !1, columnSQL: u, contentFieldValue: s, contentFieldLabel: a }; f.push(e) }) : (e = { cardFieldID: null, sectionNo: r, rowStart: t.trim(n[0]), rowEnd: t.trim(n[2]), colStart: t.trim(n[1]), colEnd: t.trim(n[3]), seq: o, style: t(this).attr("style"), fieldID: null, valueStyle: "", fieldStyle: "", hideFieldIcon: !1, hideFieldText: !1, columnSQL: u, contentFieldValue: null, contentFieldLable: null }, f.push(e)); o += 10 }); Object.keys(a).forEach(function (n) { var t = { sectionName: a[n].sectionName, sectionID: a[n].sectionID, sectionNo: a[n].sectionSeq, style: a[n].style, totalRow: a[n].totalRow, totalCol: a[n].totalCol, rowGap: a[n].rowGap, colGap: a[n].colGap }; s.push(t) }); c = { CardViewID: 0, templateID: w || 0, templateName: dt.val(), templateCategory: lt.find("option:selected").val() || 0, style: u.find(".vis-viewBlock").attr("style"), cardSection: s, cardTempField: f, isSystemTemplate: "Y", refTempID: 0 }; l = n.Application.contextUrl + "CardView/SaveCardTemplate"; t.ajax({ type: "POST", async: !1, url: l, dataType: "json", contentType: "application/json; charset=utf-8", data: JSON.stringify(c), success: function (t) { var i = JSON.parse(t), r; if (isNaN(i)) { toastr.error(i, "", { timeOut: 3e3, positionClass: "toast-top-center", closeButton: !0 }); nt(!1); return } if (w = i, hr = "Y", toastr.success(n.Msg.getMsg("SavedSuccessfully"), "", { timeOut: 3e3, positionClass: "toast-top-center", closeButton: !0 }), nt(!1), r = e.find('.mainTemplate[templateid="' + i + '"] ').closest(".vis-cardSingleViewTemplate").find(".vis-removeExport"), r.length > 0) var u = r.data("id").split("|"), t = { moduleId: u[1], _strRecordID: u[0] }, f = n.dataContext.getJSONData(n.Application.contextUrl + "CardView/SaveCardExportData", t); ur() }, error: function (n) { alert(n.statusText); nt(!1) } }) } function br() { var i, r; if (e.find(".vis-removeExport").remove(), i = n.dataContext.getJSONData(n.Application.contextUrl + "CardView/GetExportTemplateIDs", null, null), i != null) { for (r in i) e.find('.mainTemplate[templateid="' + i[r].split("|")[0] + '"]').closest(".vis-cardSingleViewTemplate").prepend('<i data-id="' + i[r] + '" class="vis vis-remove-export-data vis-removeExport" title="Remove export" style=""><\/i>'); e.find(".vis-removeExport").click(function () { var i = t(this), r = i.data("id").split("|")[0]; n.ADialog.confirm("SureWantToRemove", !0, "", n.Msg.getMsg("Confirm"), function (t) { if (t) { var f = { templateID: r }, u = n.dataContext.getJSONData(n.Application.contextUrl + "CardView/RemoveExportTemplate", f, null); u != null && u > 0 && i.remove() } }) }) } } function kr() { h.find(".vis-cardSingleViewTemplate").each(function () { var f = t(this).height(), e = t(this).width(), n = t(this).find(".mainTemplate"), o = n.height(), s = n.width(), i = 1, r = f / o, u = e / s; i = r > u ? u : r; n.css("zoom", i) }) } function su(n, i, r, f) { var e = '<div class="fieldGroup" draggable="true">', c, h; if (t.trim(f.val()).length > 0) { r ? (h = u.find(".vis-active-block"), h.removeAttr("class"), h.addClass("imgField vis-active-block"), h.addClass(t.trim(f.val())), s()) : i && (e += '<span class="fieldLbl" title="Image+Text" contenteditable="true">Label<\/span>', e += '<i class="imgField ' + t.trim(f.val()) + '"><\/i>', e += '<span class="fieldValue" contenteditable="true">:Value<\/span>', e += "<\/div>", c = u.find(".vis-active-block"), c.hasClass("grdDiv") && c.append(t(e)), s()); return } var l = 320, a = 180, v = "image/jpeg", y = .7, p = n[0].files[0], w = URL.createObjectURL(p), o = new Image; o.src = w; o.onerror = function () { URL.revokeObjectURL(this.src); console.log("Cannot load image") }; o.onload = function () { var f, n, c, h; URL.revokeObjectURL(this.src); f = hu(o, l, a); newWidth = f.width; newHeight = f.height; n = document.createElement("canvas"); n.width = newWidth; n.height = newHeight; c = n.getContext("2d"); c.drawImage(o, 0, 0, newWidth, newHeight); n.toBlob(function () { }, v, y); r ? (u.find(".vis-active-block").attr("src", n.toDataURL()), s()) : (i ? (e += '<span class="fieldLbl" title="Image+Text" contenteditable="true">Label<\/span>', e += '<img class="imgField" style="width:30px; height:30px" src="' + n.toDataURL() + '">', e += '<span class="fieldValue" contenteditable="true">:Value<\/span>') : (e += '<span class="fieldLbl displayNone" title="Image" contenteditable="true" showfieldtext="true" >Label<\/span>', e += '<img class="imgField" style="width:100px; height:100px" src="' + n.toDataURL() + '">'), e += "<\/div>", h = u.find(".vis-active-block"), h.hasClass("grdDiv") && h.append(t(e)), s()) } } function hu(n, t, i) { var r = n.width, u = n.height; return r > u ? r > t && (u = Math.round(u * t / r), r = t) : u > i && (r = Math.round(r * i / u), u = i), { width: r, height: u } } function cu(i, r) { n.ADialog.confirm("SureWantToDelete", !0, "", n.Msg.getMsg("Confirm"), function (u) { if (u) { var f = n.Application.contextUrl + "CardView/DeleteTemplate"; t.ajax({ type: "POST", async: !1, url: f, dataType: "json", contentType: "application/json; charset=utf-8", data: JSON.stringify({ tempID: i }), success: function (n) { var t = JSON.parse(n); r.parent().remove() }, error: function (n) { alert(n.statusText) } }) } }) } function s() { var t = u.find(".vis-viewBlock").html(), n; v < y.length - 1 && (y = y.slice(0, v + 1), v++); n = JSON.stringify(t); (n != y[v] || gr == 1) && (y.push(n), y.length > 11 && y.shift(), v = y.length - 1); d.find(".vis-v-rowcol").hide(); ct.attr("disabled", "disabled"); et.removeAttr("disabled") } function lu(n) { d.find(".vis-v-rowcol").show(); var r = t(n.target).index(), i = au(r); i.rowNo == 1 && ai.hide(); i.colNo == 1 && vi.hide(); gi.css({ left: t(n.target).closest(".vis-viewBlock")[0].offsetLeft - 38, top: t(n.target).height() + t(n.target)[0].offsetTop }); ai.css({ left: t(n.target).closest(".vis-viewBlock")[0].offsetLeft - 20, top: t(n.target).height() + t(n.target)[0].offsetTop }); nr.css({ top: t(n.target).closest(".vis-viewBlock")[0].offsetTop - 20, left: t(n.target).width() - 8 + t(n.target)[0].offsetLeft }); vi.css({ top: t(n.target).closest(".vis-viewBlock")[0].offsetTop - 20, left: t(n.target).width() - 5 + t(n.target)[0].offsetLeft + 15 }) } function au(n) { var t = r.find(".colBox").length - 1, i = Math.floor(n / t) + 1, u = n % t + 1; return { rowNo: i, colNo: u } } function vu() { var s, y, d, p, w, tt, o, k, it, r, i, a, f; rootMI = t("<div>"); s = t('<div class="vis-busyindicatorouterwrap"><div class="vis-busyindicatorinnerwrap"><i class="vis-busyindicatordiv"><\/i><\/div><\/div>'); s[0].style.visibility = "visible"; rootMI.append(s); y = t("<div>"); d = t("<div class='vis-markmodulemainwrap'>"); y.append(d); p = t("<div>"); y.append(p); var rt = n.Msg.getMsg("Cancel"), ut = n.Msg.getMsg("Ok"), g = t("<button class='VIS_Pref_btn-2' style='margin-top: 5px;margin-bottom: -10px;'>").append(rt), nt = t("<button class='VIS_Pref_btn-2' style='margin-top: 5px;margin-bottom: -10px;margin-right:5px'>").append(ut); if (p.append(g), p.append(nt), rootMI.append(y), w = t("<table>"), b = new n.ChildDialog, b.setTitle(n.Msg.getMsg("Module")), b.setWidth("30%"), b.setContent(rootMI), b.onOkClick = function () { }, b.onCancelClick = at, b.onClose = at, b.show(), b.hideButtons(), lstModules = [], r = n.dataContext.getJSONData(n.Application.contextUrl + "MarkModule/LoadModules", null, null), r != null) for (i in r) tt = { AD_ModuleInfo_ID: r[i].AD_ModuleInfo_ID, Name: r[i].Name }, lstModules.push(tt); if (o = "", t.each(e.find(".chkMark:checked"), function () { o += this.value + "," }), o = o.replace(/,(\s+)?$/, ""), k = [], o.length > 0 && (it = { _strRecordID: o }, r = n.dataContext.getJSONData(n.Application.contextUrl + "CardView/GetCardExportData", it, null), r != null)) for (i in r) k.push(r[i]); var h = null, c = null, u = null, l = null, v = []; if (k.length == 0) for (i = 0; i < lstModules.length; i++)h = t("<tr>"), c = t("<td>"), u = t('<label class="vis-gc-vpanel-table-label-checkbox" style="display: inline-block; opacity: 1;">'), l = t("<input type='checkbox'>"), u.append(l), u.append(lstModules[i].Name), c.append(u), h.append(c), w.append(h), f = {}, f.Ctrl = l, f.AD_ModuleInfo_ID = lstModules[i].AD_ModuleInfo_ID, v.push(f); else for (a = 0; a < lstModules.length; a++)h = t("<tr>"), c = t("<td>"), u = t('<label class="vis-gc-vpanel-table-label-checkbox" style="display: inline-block; opacity: 1;">'), l = k.indexOf(lstModules[a].AD_ModuleInfo_ID) > -1 ? t("<input type='checkbox' checked>") : t("<input type='checkbox'>"), u.append(l), u.append(lstModules[a].Name), c.append(u), h.append(c), w.append(h), f = {}, f.Ctrl = l, f.AD_ModuleInfo_ID = lstModules[a].AD_ModuleInfo_ID, v.push(f); d.append(w); s[0].style.visibility = "hidden"; nt.on("click", function () { var i, t, u, f, r; for (s[0].style.visibility = "visible", i = [], t = 0; t < v.length; t++)u = v[t].Ctrl, u.prop("checked") && i.push(v[t].AD_ModuleInfo_ID); f = { moduleId: i, _strRecordID: o }; r = n.dataContext.getJSONData(n.Application.contextUrl + "CardView/SaveCardExportData", f); r.result != "OK" ? alert(r.result) : (at(), toastr.success(n.Msg.getMsg("SavedSuccessfully"), "", { timeOut: 3e3, positionClass: "toast-top-center", closeButton: !0 }), br()); s[0].style.visibility = "hidden" }); g.on("click", function () { at() }) } function at() { return b.close(), !0 } var ar, ti; this.frame; var vt = this, o = n.Env.getWindowNo(), ii = null, yt = 1, h = null, dr = null, d = null, i = null, u = null, pt = null, w = null, fr = null, f = null, er = null, r = null, c = null, wt = null, ri = null, or = null, p = !1, ui = null, fi = null, ei = null, oi = null, wi = null, si = null, bt = null, kt = null, hi = null, ci = null, li = null, bi = null, sr = null, tt = null, ut = null, dt = null, ft = [], ht = 2, g = null, ki = !1, hr = "Y", cr = null, et = null, ct = null, di = null, gi = null, nr = null, ai = null, vi = null, lr = null, gr = 0, ot = null, lt = null, it = null, a = {}, b = null, gt = !1, y = [], tr = !0, v = 0, nu = ["px", "%", "cm", "mm", "in", "pc", "pt", "ch", "em", "rem", "vh", "vw", "vmin", "vmax"], l = { width: { proprty: "width", value: "", measurment: !0 }, minWidth: { proprty: "min-width", value: "", measurment: !0 }, height: { proprty: "height", value: "", measurment: !0 }, minHeight: { proprty: "min-height", value: "", measurment: !0 }, fontSize: { proprty: "font-size", value: "", measurment: !0 }, fontFamily: { proprty: "font-family", value: "", measurment: !1 }, color: { proprty: "color", value: "", measurment: !1 }, border: { proprty: "border", value: "", measurment: !0 }, borderType: { proprty: "border-style", value: "", measurment: !1 }, borderColor: { proprty: "border-color", value: "", measurment: !1 }, borderLeft: { proprty: "border-left-width", value: "", measurment: !0 }, borderLeftStyle: { proprty: "border-left-style", value: "", measurment: !1 }, borderLeftColor: { proprty: "border-left-color", value: "", measurment: !1 }, borderTop: { proprty: "border-top-width", value: "", measurment: !0 }, borderTopStyle: { proprty: "border-top-style", value: "", measurment: !1 }, borderTopColor: { proprty: "border-top-color", value: "", measurment: !1 }, borderRight: { proprty: "border-right-width", value: "", measurment: !0 }, borderRightStyle: { proprty: "border-right-style", value: "", measurment: !1 }, borderRightColor: { proprty: "border-right-color", value: "", measurment: !1 }, borderBottom: { proprty: "border-bottom-width", value: "", measurment: !0 }, borderBottomStyle: { proprty: "border-bottom-style", value: "", measurment: !1 }, borderBottomColor: { proprty: "border-bottom-color", value: "", measurment: !1 }, borderRadius: { proprty: "border-radius", value: "", measurment: !0 }, borderTopLeftRadius: { proprty: "border-top-left-radius", value: "", measurment: !0 }, borderTopRightRadius: { proprty: "border-top-right-radius", value: "", measurment: !0 }, borderBottomRightRadius: { proprty: "border-bottom-right-radius", value: "", measurment: !0 }, borderBottomLeftRadius: { proprty: "border-bottom-left-radius", value: "", measurment: !0 }, padding: { proprty: "padding", value: "", measurment: !0 }, paddingLeft: { proprty: "padding-left", value: "", measurment: !0 }, paddingTop: { proprty: "padding-top", value: "", measurment: !0 }, paddingRight: { proprty: "padding-right", value: "", measurment: !0 }, paddingBottom: { proprty: "padding-bottom", value: "", measurment: !0 }, margin: { proprty: "margin", value: "", measurment: !0 }, marginLeft: { proprty: "margin-left", value: "", measurment: !0 }, marginTop: { proprty: "margin-top", value: "", measurment: !0 }, marginRight: { proprty: "margin-right", value: "", measurment: !0 }, marginBottom: { proprty: "margin-bottom", value: "", measurment: !0 }, opacity: { proprty: "opacity", value: "", measurment: !1 }, backgroundColor: { proprty: "background-color", value: "", measurment: !1 }, gradientInput: { proprty: "background", value: "", measurment: !1 }, gradient: { proprty: "background", value: "", measurment: !1 }, boxShadow: { proprty: "box-shadow", value: "", measurment: !0 }, flexDirection: { proprty: "flex-direction", value: "", measurment: !1 }, bold: { proprty: "font-weight", value: "bold", measurment: !1 }, italic: { proprty: "font-style", value: "italic", measurment: !1 }, underline: { proprty: "text-decoration", value: "underline", measurment: !1 }, upperCase: { proprty: "text-transform", value: "uppercase", measurment: !1 }, capitalize: { proprty: "text-transform", value: "capitalize", measurment: !1 }, textLeft: { proprty: "text-align", value: "left", measurment: !1 }, textCenter: { proprty: "text-align", value: "center", measurment: !1 }, textJustify: { proprty: "text-align", value: "justify", measurment: !1 }, textRight: { proprty: "text-align", value: "right", measurment: !1 }, lowerCase: { proprty: "text-transform", value: "lowercase", measurment: !1 }, flexJustifyCenter: { proprty: "justify-content", value: "center", measurment: !1 }, flexJustifyStart: { proprty: "justify-content", value: "flex-start", measurment: !1 }, flexJustifyEnd: { proprty: "justify-content", value: "flex-end", measurment: !1 }, flexJustifySpaceBetween: { proprty: "justify-content", value: "space-between", measurment: !1 }, flexJustifySpaceAround: { proprty: "justify-content", value: "space-around", measurment: !1 }, flexAlignCenter: { proprty: "align-items", value: "center", measurment: !1 }, flexAlignEnd: { proprty: "align-items", value: "flex-end", measurment: !1 }, flexAlignStart: { proprty: "align-items", value: "flex-start", measurment: !1 }, maxTextmultiline: { proprty: "-webkit-line-clamp", value: "", measurment: !1 }, objectFit: { proprty: "object-fit", value: "", measurment: !1 } }, e = t('<div style="height:100%"><div class="vis-apanel-busy vis-cardviewmainbusy" style="display:block"><\/div><\/div>'), ni = t("<div class='vis-apanel-busy vis-cardviewmainbusy'><\/div> "); ar = function (n, t) { var r = 9, u = 0, f = n.parent().offset(), e = { x: f.left, y: f.top }, i, o; if (p) return i = { x: t.clientX - e.x, y: t.clientY - e.y }, o = Math.atan2(i.x - r, i.y - r), u = -o / (Math.PI / 180) + 180, Math.ceil(u) }; ti = function () { a = {}; var n = r.find(".grid-Section:first").clone(!0); n.removeClass("displayNone"); r.find(".grid-Section:not(:first)").remove(); u.find(".vis-wizard-section").each(function (i) { var e = t(this).attr("sectionCount"), o, i, c, f, l; if (i == 0 && (n.addClass("section-active"), t(this).addClass("vis-active-block")), n.attr("sectionCount", e), o = t(this).attr("name"), n.find(".vis-grey-disp-ttl").text(o), r.find(".vis-sectionAdd").append(n), n = r.find(".grid-Section:first").clone(!0), n.removeClass("displayNone"), !a["section" + e]) { var v = t(this).attr("row"), y = t(this).attr("col"), s = t(this)[0].style.gridTemplateColumns.split(" "), h = t(this)[0].style.gridTemplateRows.split(" "), u = {}; for (i = 0; i < v; i++)h.length > 0 && h[i] != "auto" ? (c = h[i].replace(/\'/g, "").split(/(\d+)/).filter(Boolean), u["row_" + i] = { val: c[0], msr: c[1] }) : u["row_" + i] = { val: 1, msr: "auto" }; for (f = 0; f < y; f++)s.length > 0 && s[f] != "auto" ? (l = s[f].replace(/\'/g, "").split(/(\d+)/).filter(Boolean), u["col_" + f] = { val: l[0], msr: l[1] }) : u["col_" + f] = { val: 1, msr: "auto" }; u.sectionNo = e; u.sectionName = o; u.rowGap = 0; u.colGap = 0; u.totalRow = v; u.totalCol = y; a["section" + e] = u } }); r.find(".vis-sectionAdd").sortable({ disabled: !1, update: function (n, t) { var i = t.item.attr("sectioncount"), e = t.item.index(), r = t.item.next().attr("sectioncount"), f; r ? u.find('[sectioncount="' + r + '"]').before(u.find('[sectioncount="' + i + '"]')) : (f = t.item.prev().attr("sectioncount"), u.find('[sectioncount="' + f + '"]').after(u.find('[sectioncount="' + i + '"]'))) } }); r.find(".section-active .vis-grey-disp-el").click(); r.find(".vis-grey-disp-el-xross").eq(1).hide() }; this.getRoot = function () { return e }; this.show = function (i, r) { var o = t("<div>"), u = t('<input type="file" name="" maxlength="50" style="height: 45px;padding: 10px" class="" accept="image/*" placeholder=" " data-placeholder="">'), s = t('<label for="">' + n.Msg.getMsg("SelectFromFiles") + "<\/label>"), f = t('<div class="input-group vis-input-wrap"><\/div>'), e = t('<div class="vis-control-wrap"><\/div>'), h; e.append(u).append(s); f.append(e); o.append(f); IconInput = t('<input type="text" name="" class="" placeholder=" " data-placeholder="">'); i && (h = t('<div class="mb-2"><center>OR<\/center><\/div>'), f = t('<div class="input-group vis-input-wrap"><\/div>'), s = t('<label style="left:10px" for="">' + n.Msg.getMsg("Icon") + "<\/label>"), e = t('<div class="vis-control-wrap"><\/div>'), e.append(IconInput).append(s), f.append(e), o.append(h).append(f), o.append('<div class="input-group vis-input-wrap "><div class="vis-control-wrap"><p style="word-break: break-all" for="">' + n.Msg.getMsg("IconLinkMsg") + "<\/p><\/div><\/div>")); u.change(function () { IconInput.val(""); t(this).val().length > 0 ? IconInput.attr("disabled", "disabled") : IconInput.removeAttr("disabled") }); IconInput.change(function () { u.val(""); t(this).val().length > 0 ? u.attr("disabled", "disabled") : u.removeAttr("disabled"); IconInput.val().indexOf("fa-") != -1 && IconInput.val().indexOf("fa ") == -1 ? IconInput.val("fa " + IconInput.val()) : IconInput.val().indexOf("vis-") != -1 && IconInput.val().indexOf("vis ") == -1 && IconInput.val("vis " + IconInput.val()) }); ch = new n.ChildDialog; ch.setTitle(n.Msg.getMsg("InsertImage")); ch.setWidth("30%"); ch.setContent(o); ch.onOkClick = function () { su(u, i, r, IconInput) }; ch.onCancelClick = at; ch.onClose = at; ch.show() }; this.disposeComponent = function () { vt = null; e.remove(); e = null }; tu() } i.prototype.init = function (n, t) { this.frame = t; this.windowNo = n; this.frame.getContentGrid().append(this.getRoot()) }; i.prototype.dispose = function () { this.disposeComponent() }; n.CardTemplateMaster = i }(VIS, jQuery), function (n, t) { function i(i) { function st(i) { var e, o; u = t("<div style='overflow: hidden;'>"); s = t('<div class="vis-apanel-busy" style="width: 96%; height: 97%; text-align: center; position: absolute; visibility: hidden;"><\/div>'); l = t('<div style="display: inline-block; float: left;width:99%;height:auto;margin-top: 2px;">'); a = t('<div style="padding-left: 7px;height:88.9%;display: inline-block; float: left;width:100%;height:87.8%;">'); w = t("<button class='vis-initial-btn vis-initial-btn-blue' style='border: none;'>" + n.Msg.getMsg("SelectFile") + "<\/button>"); b = t("<div class='VIS-form-data' style='width: 100%;height:200px;border: 1px solid #ccc;margin-top: 11px;padding: 10px;overflow:auto;'>"); v = t('<div style="display: inline-block; float: left;width:100%;height:auto;margin-top: 2px;">'); d = t("<div style='float: left;'>"); y = t('<div style="float:right;">'); e = n.Msg.getMsg("Cancel"); e.indexOf("&") > -1 && (e = e.replace("&", "")); o = n.Msg.getMsg("Ok"); o.indexOf("&") > -1 && (o = o.replace("&", "")); p = t("<button class='VIS_Pref_btn-2' style='margin-top: 5px;margin-bottom: -10px;'>").append(e); f = t("<button class='VIS_Pref_btn-2' disabled='true' style='margin-top: 5px;margin-bottom: -10px;margin-right:5px'>").append(o); h = i ? t("<input type='file' multiple='true'>") : t("<input type='file'>"); a.append(w); a.append(b); l.append(a); v.append(d); y.append(p); y.append(f); v.append(y); l.append(v); u.append(l); u.append(s); r = [] } function ht() { p.on("click", function () { g = !1; et() }); f.on("click", function () { ft() }); w.on("click", function () { h.val(""); h.trigger("click") }); h.on("change", function () { ut(this) }) } function ct() { g || (k = ""); ot.onClose(k); et() } this.onClose = null; var u, s, l, a, v, y, p, f, r, h, w, b, d, ot = this, g = !1, tt = 0, o = 0, k = Date.now().toString() + "_FileCtrl", e = 1048576, it = 0, c = 0, rt = []; st(i); ht(); this.show = function () { u.dialog({ width: 500, height: 377, resizable: !1, modal: !0, title: n.Msg.getMsg("Upload"), close: ct }) }; var ut = function (i) { for (var c, e, o, v, u = [], s = 0; s < i.files.length; s++) { if (file = i.files[s], file == undefined) return; if (file.name.indexOf("&") > -1 || file.name.indexOf("?") > -1 || file.name.indexOf("#") > -1 || file.name.indexOf("/") > -1 || file.name.indexOf("\\") > -1) { u.push(file.name); continue } for (c in r) if (file.name == r[c].name) { window.setTimeout(function () { n.ADialog.info("fileAlreadyAttached") }, 20); return } if (e = {}, e.Name = file.name, e.Size = file.size, !(e.Size > 17e6)) { r.push(file); var h = t("<div class='VIS-file-wrap'>"), y = t("<p>" + e.Name + "<\/p>"), l = r.length - 1, a = t("<span class='vis vis-mark VIS-close-ico mychoice_" + l + "'  data-index='" + l + "'>"); a.on("click", function () { var n = t(this).parent(), i, u; n && (i = n.children()[0], i && (u = r.map(function (n) { return n.name == t(i).text() }).indexOf(!0), r.splice(u, 1), n.remove())); r.length == 0 ? f.attr("disabled", "true") : f.removeAttr("disabled") }); h.append(y); h.append(a); b.append(h); r.length == 0 ? f.attr("disabled", "true") : f.removeAttr("disabled") } } if (u.length > 0) { o = ""; for (v in u) o += u[v].toString() + "\n"; o += u.length == 1 ? "File has" : "Files have"; o += " " + n.Msg.getMsg("VIS_InvalidName") + " " + n.Msg.getMsg("VIS_ChangeFileName"); n.ADialog.info(o) } }, ft = function () { var t, u; s[0].style.visibility = "visible"; var n = null, i = 0; for (t in r) i = parseInt(r[t].size / e), file.size % e > 0 && i++, it += i, n = {}, n.Name = r[t].name, n.Size = r[t].size, rt.push(n); u = nt() }, nt = function () { var t, i, f; if (r == null || r.length == 0) return n.ADialog.info("NothingToUpload"), s[0].style.visibility = "hidden", !1; if (o >= r.length) return s[0].style.visibility = "hidden", g = !0, u.dialog("close"), !0; t = new XMLHttpRequest; i = new FormData; i.append("file", r[o].slice(c * e, c * e + Number(e))); t.open("POST", n.Application.contextUrl + "Attachment/SaveFileinTemp/?filename=" + r[o].name + "&folderKey=" + k, !1); t.send(i); tt++; c++; f = parseInt(r[o].size / e); r[o].size % e > 0 && f++; c == f && (o++, c = 0); window.setTimeout(function () { nt() }, 2) }, et = function () { p.off("click"); f.off("click"); s = l = a = v = y = p = f = null; r = h = w = b = d = null; tt = o = k = e = it = c = rt = null; ut = ft = nt = loadTables = loadLanguage = loadEDL = loadExportScope = null; u != null && (u.dialog("destroy"), u.remove()); u = null } } n.VisImportFiles = i }(VIS, jQuery); VIS = window.VIS || {}, function (n, t) { function i(i, r) { function a(n) { v.css("display", n ? "block" : "none") } function y(t) { if (t.error == null) { var i = JSON.parse(t.result); if (!i.IsError) if (i.ShowParameter) u.pInstanceId = i.AD_PInstance_ID, u.fields = i.ProcessFields; else return i.ReportProcessInfo != null && (n.ADialog.info(i.ReportProcessInfo.Summary, !0, "", ""), n.Msg.getMsg("ImportedSuccessfully") == i.ReportProcessInfo.Summary) ? (p.parentcall(!0), u && (u.isOkProcess = !0), !0) : (u && (u.isOkProcess = !1), p.parentcall(!1), !1) } } function b() { f = t("<div title='ParameterDialog'>"); c = t("<table class='vis-processpara-table'>"); f.append(c); s = t('<input type="button" style="margin-right:5px" >').val(n.Msg.getMsg("OK")); s.addClass("VIS_Pref_btn-2"); o = t("<input type='button'>").val(n.Msg.getMsg("Close")); o.addClass("VIS_Pref_btn-2"); o.css({ "margin-bottom": "0px", "margin-top": "7px" }); s.css({ "margin-bottom": "0px", "margin-top": "7px" }) } function k(t, i) { if (t) { u.paraList = i; var r = new n.ProcessInfo(u.name, u.processId, 0, 0); r.setAD_PInstance_ID(u.pInstanceId); n.dataContext.executeProcess({ processInfo: r.toJson(), parameterList: i }, function (n) { y(n) }) } } var p = r, f, c, w, h, l, e, s, o, v, u; this.windowNo = i; this.processId = null; this.name = null; this.entityType = null; this.pInstanceId = 0; this.className = null; this.fields = null; this.paraList = null; this.asyncProcess = !0; this.gridFields = []; this.depOnFieldColumn = []; this.depOnField = []; this.vEditors = []; this.vEditors2 = []; this.mFields = []; this.mFields2 = []; this.isOkClicked = !1; this.onClosed; v = t("<div class='vis-apanel-busy' style='width:95%;height:98%;position:absolute'>"); u = this; this.onCloseMain = null; this.isOkProcess = !1; this.process = function (t, i, r) { var f = new n.ProcessInfo(i, t, 0, 0), e, o; f.setAD_PInstance_ID(u.pInstanceId); f.setWindowNo(r); e = { processInfo: f.toJson() }; this.asyncProcess ? n.dataContext.process(e, function (n) { y(n) }) : (o = n.dataContext.process(e), y(o)) }; b(); this.addLine = function () { w = h = l = e = null; h = t("<td class=''>"); l = t("<td class=''>"); e = t("<td class='vis-processpara-table-td3'>"); c.append(t("<tr>").append(h).append(l).append(e)) }; this.addFields = function (t, i) { if (t && h.append(t.getControl()), i && (i.getControl().width("200px"), i.getControl().height("30px"), e.append(i.getControl()), i.getBtnCount() > 0)) { var r = i.getBtn(0); e.append(r); i.getDisplayType() == n.DisplayType.MultiKey && e.append(i.getBtn(1)) } }; this.addButtons = function () { this.addLine(); e.append(o).append(s) }; this.showDialog = function () { f.append(v); f.dialog({ modal: !0, width: "auto", close: function () { if (k(u.isOkClicked, u.parameterList), u.onCloseMain) u.onCloseMain(u.isOkClicked); u.dispose(); u = null; a(!1) } }); window.setTimeout(function () { o.focus() }, 200); a(!1) }; this.onClose = function (n) { u.isOkClicked = n; f.dialog("close") }; o.on(n.Events.onTouchStartOrClick, function () { u.onClose(!1) }); s.on(n.Events.onTouchStartOrClick, function () { a(!0); var n = u.saveParameters(); if (!n) { a(!1); return } u.parameterList = n; u.onClose(!0, n) }); this.disposeComponent = function () { o.off(n.Events.onTouchStartOrClick); s.off(n.Events.onTouchStartOrClick); f.dialog("destroy"); f.remove(); u = null; this.gridFields.length = 0; this.gridFields = null; this.depOnFieldColumn.length = 0; this.depOnFieldColumn - null; this.depOnField.length = 0; this.depOnField = null; this.vEditors.length = 0; this.vEditors2.length = 0; this.mFields.length = 0; this.mFields2.length = 0; this.parameterList = null; this.addLine = null; this.addFields = null; this.addButtons = null; this.showDialog = null; this.onClose = null; this.isOkClicked = null; f = c = w = h = l = e = s = o = null } } i.prototype.initDialog = function (i, r, u, f, e) { var l, o, c, b, p, a, k, s, w, y, h, v; for (this.processId = i, this.name = r, this.entityType = u, this.className = f, typeof e != "undefined" && (this.asyncProcess = e), this.process(i, r, this.windowNo), l = this.fields, o = null, c = 0, b = l.length; c < b; c++) { for (o = new n.GridField(l[c]), this.addLine(), this.mFields.push(o), p = o.getDependentOn(!1), a = 0; a < p.length; a++)this.depOnField.push(o), this.depOnFieldColumn.push(p[a]); k = n.VControlFactory.getLabel(o); s = n.VControlFactory.getControl(null, o, !1); s && (v = o.getDefault(n.context, this.windowNo), s.setValue(v), s.addVetoableChangeListener(this)); o.setPropertyChangeListener(s); this.vEditors.push(s); this.addFields(k, s); o.getIsRange() ? (this.addLine(), w = {}, t.extend(!0, w, l[c]), y = new n.GridField(w), this.mFields2.push(y), h = n.VControlFactory.getControl(null, y, !1), h && (v = y.getDefault(n.context, this.windowNo), h.setValue(v), h.addVetoableChangeListener(this)), this.vEditors2.push(h), this.addFields(null, h)) : (this.mFields2.push(null), this.vEditors2.push(null)) } return this.addButtons(), !0 }; i.prototype.vetoablechange = function (t) { var e, r, f, u, o, i; if (console.log(t), e = t.newValue == null ? "" : t.newValue.toString(), r = t.propertyName, n.Env.getCtx().setWindowContext(this.windowNo, r, e), this.depOnFieldColumn.indexOf(r) !== -1) for (f = this.getDependantFields(r), u = 0, o = f.length; u < o; u++)(i = f[u], i != null) && (i.refreshLookup(), i.setValue(i.getDefault(n.Env.getCtx(), this.windowNo), !0)) }; i.prototype.getDependantFields = function (n) { var i = [], r, t; if (this.depOnFieldColumn.indexOf(n) != -1) for (r = this.depOnFieldColumn.length, t = 0; t < r; t++)this.depOnFieldColumn[t].equals(n) && i.indexOf(this.depOnField[t]) < 0 && i.push(this.depOnField[t]); return i }; i.prototype.saveParameters = function () { for (var r = new StringBuilder, v = this.mFields.length, t = 0, u, e, o, y, s, h, c, i, a, t = 0; t < v; t++)u = this.mFields[t], u.getIsMandatory(!0) && (e = this.vEditors[t], o = e.getValue(), o == null || o.toString().length == 0 ? (u.setInserting(!0), u.setError(!0), r.length() > 0 && r.append(", "), r.append(u.getHeader())) : u.setError(!1), y = this.vEditors2[t], y != null && (s = e.getValue(), h = this.mFields2[t], s == null || s.toString().length == 0 ? (u.setInserting(!0), h.setError(!0), r.length() > 0 && r.append(", "), r.append(u.getHeader())) : h.setError(!1))); if (r.length() != 0) return n.ADialog.error("FillMandatory", !0, r.toString()), !1; for (c = [], i = {}, t = 0; t < v; t++) { var p = this.vEditors[t], f = this.vEditors2[t], w = p.getValue(), l = null; (f != null && (l = f.getValue()), w != null || l != null) && (i = {}, a = this.mFields[t], i.Name = a.getColumnName(), i.DisplayType = a.getDisplayType(), i.Result = w, i.Result2 = l, i.Info = p.getDisplay(), f != null && (i.Info_To = f.getDisplay()), c.push(i)) } return c }; i.prototype.dispose = function () { this.disposeComponent() }; n.ParameterDialog = i }(VIS, jQuery), function (n, t) { function f(n, i, u) { var f = null; return t.ajax({ url: r, type: "POST", datatype: "json", contentType: "application/json; charset=utf-8", async: i, data: JSON.stringify(n) }).done(function (n) { f = n; u && u(n) }), f } function e(t, i) { function f() { var o, e, i, f; try { if (o = "VIS_100", e = [], e[0] = new n.DB.SqlParam("@processName", t), i = u(o, e), i != null && i.getTables()[0].getRows().length > 0) { var s = i.tables[0].getRow(0).getCell(0), h = i.tables[0].getRow(0).getCell(1), c = i.tables[0].getRow(0).getCell(2), l = i.tables[0].getRow(0).getCell(3); s > 0 ? (f = new n.ParameterDialog(r.parent.windowNo, r), f.initDialog(s, h, l, c, !1), f.onCloseMain = function (t) { t ? n.ADialog.info("ProcessWait", !0, "", "") : n.ADialog.info("Process Canceled", !0, "", "") }, f.showDialog(), f = null) : n.ADialog.info("ProcessNotFound", !0, "", "") } } catch (a) { } } this.parent = i; var r = this; f(); this.lockUI = function (n) { r.lockUI && r.lockUI(n) }; this.unlockUI = function (n) { r.unlockUI && r.unlockUI(n) }; this.parentcall = function (n) { r.parentcall && r.parentcall(n) } } var i = n.Application.contextUrl, r = i + "JsonData/JDataSetWithCode", u = function (t, i, r) { var o = r ? !0 : !1, e = { sql: t, page: 1, pageSize: 0 }, u; return i && (e.param = i), u = null, f(e, o, function (t) { u = (new n.DB.DataSet).toJson(t); r && r(u) }), u }; n.ProcessWrapper = e }(VIS, jQuery), function (n, t) { function i() { function is() { t.ajax({ url: n.Application.contextUrl + "TreeMaintenance/TreeDataForCombo", success: function (i) { var u = JSON.parse(i), r; if (u) for (w.append(t("<Option value=''> <\/option>")), r = 0; r < u.length; r++)w.append(t("<Option value=" + u[r].ID + " data-type='" + u[r].TreeType + "' data-isallnodes='" + u[r].IsAllNodes + "'  >" + n.Utility.encodeText(u[r].Name) + "<\/option>")); fi != null && w.val(fi.attr("value")); f[0].style.visibility = "hidden" }, error: function (n) { console.log(n); f[0].style.visibility = "visible" } }) } function rs() { di.css("display", "none"); e = 0; u.empty(); i.empty(); st.empty(); lt = ""; dt.val(""); fi = null; k.addClass("vis-tm-delete"); o.val(""); window.setTimeout(function () { u.empty(); b.data("kendoTreeView").destroy(); b.empty() }, 200); bu.text(n.Msg.getMsg("SelectTree")); gt.text(n.Msg.getMsg("SelectTree")); ni.css("display", "none"); kt.addClass("vis-tm-delete"); y.prop("disabled", !0); ai.prop("disabled", !0); y.css("cursor", "not-allowed"); ai.css("cursor", "not-allowed"); o.prop("disabled", !0); dt.prop("disabled", !0); g.prop("disabled", !0); ut.prop("disabled", !0); ut.css("cursor", "not-allowed"); cr.css("display", "none"); wi.css("display", "none"); ai.prop("checked", !1); ut.prop("checked", !1); y.prop("checked", !1); d.prop("checked", !1) } function fu() { var o = n.dataContext.getJSONData(n.Application.contextUrl + "TreeMaintenance/GetTableID", { treeId: e }, null), s = n.dataContext.getJSONData(n.Application.contextUrl + "TreeMaintenance/GetTableName", { table_id: o }, null), f, i, u, r; if (br(), f = n.dataContext.getJSONData(n.Application.contextUrl + "TreeMaintenance/GetRecordCount", { tablename: s, tableTreeName: nr, treeId: e }, null), fr = f > 0 ? !0 : !1, ri == "false" && sqlQry == si.length && (i = n.dataContext.getJSONData(n.Application.contextUrl + "TreeMaintenance/GetNodeIds", { tableTreeName: nr, treeId: e }, null), i != null)) for (u = null, r = 0; r < i.length; r++)if (u = i[r], t.inArray(u, si) < 0) { fr = !0; break } else fr = !1 } function du(i, r, u, f) { ei[0].style.visibility = "visible"; tt.is(":checked") || (gl(), f = tt.is(":checked") ? !0 : !1); t.ajax({ url: n.Application.contextUrl + "TreeMaintenance/BindTree", type: "Post", data: { treeType: i, AD_Tree_ID: r, isAllNodes: u, isSummary: f }, success: function (n) { var t = JSON.parse(n); t && (ph(t), window.setTimeout(function () { window.setTimeout(function () { w.val() == "" ? rs() : w.val() == null && rs(); fu() }, 400) }, 500), ao = t, co = t.settree); ei[0].style.visibility = "hidden" }, error: function (n) { console.log(n); ei[0].style.visibility = "hidden" } }) } function yh() { pr.css("display", "none"); ui = !1; nt.css("display", "none"); c.css("height", "100%"); bt.css("height", "100%"); c.resizable("destroy"); bt.removeClass("VIS-TM-resizediv"); fi != null && du(wt, e, ar, ui) } function ph(u) { ei[0].style.visibility = "visible"; di.css("display", "inherit"); b && b.data("kendoTreeView") != undefined && (b.data("kendoTreeView").destroy(), b.empty()); b = r.kendoTreeView({ autoScroll: !0, dragAndDrop: !0, drag: wh, drop: bh, dataSource: u.settree, select: function (n) { ot[0].style.visibility = "visible"; tt.is(":checked") && hr.css("display", "inherit"); or == !0; i.empty(); d.prop("checked", !1); r.find(".k-state-selected").removeClass("k-state-selected"); t(n.node).find(".k-state-hover").addClass("k-state-selected").removeClass("k-state-hover"); var u = t(t(t(n.node).find(".treechild")[0]).find("p")).text(); gt.text(u); yr = t(t(n.node).find(".treechild")[0]).attr("data-nodeid"); ur = !0; of = -1; k.addClass("vis-tm-delete"); ni.css("display", "none"); vf = !1; r.find(".vis-tm-selectedkendoNode").removeClass("vis-tm-selectedkendoNode"); r.find(".k-state-selected").find("p").addClass("vis-tm-selectedkendoNode"); window.setTimeout(function () { r.find(".vis-tm-selectedkendoNode").removeClass("vis-tm-selectedkendoNode"); r.find(".k-state-selected").find("p").addClass("vis-tm-selectedkendoNode"); rt = 1; ft = 50; v = y.is(":checked") ? o.val() : ""; h = y.is(":checked") ? "true" : "false"; window.setTimeout(function () { yr = r.find(".k-state-selected").find(".treechild").attr("data-nodeid"); tt.is(":checked") && (r.find(".k-state-hover").removeClass("k-state-hover"), bi(yr, e, rt, ft, v, h, n)) }, 300) }, 300) }, template: "<div class='treechild'  data-getparentnode='#= item.getparentnode #'       data-IsSummary='#= item.IsSummary #' data-TableName='#= item.TableName #' data-NodeID='#= item.NodeID #'   data-TreeParentID='#= item.TreeParentID #' data-ParentID='#= item.ParentID #'  ><div class='imgdivTree'><i class='fa fa-folder-o' data-imgsrc='#= item.ImageSource #'><\/i><\/div><div class='textdivTree'><p>" + n.Utility.encodeText("#= item.text #") + "<\/p><\/div><\/div>" }); gr(); b.find(".k-plus").on("click", function () { t(this).hasClass("k-minus") && (ht.css("display", "inherit"), vt.css("display", "none")); t(this).hasClass("k-plus") && (vt.css("display", "inherit"), ht.css("display", "none")) }); b.find(".k-in").on("dblclick", function () { t(r.find(".k-state-selected").parent().find("span")[0]).hasClass("k-minus") && (ht.css("display", "inherit"), vt.css("display", "none")); t(r.find(".k-state-selected").parent().find("span")[0]).hasClass("k-plus") && (vt.css("display", "inherit"), ht.css("display", "none")) }); window.setTimeout(function () { di.css("display", "none") }, 200); tu == !0 && (b.data("kendoTreeView").expand(".k-item"), r.find("div").find("div[data-nodeid='" + fo + "']").parent().addClass("k-state-selected"), r.find("span").hasClass("k-state-selected") && r.find("div").find("div[data-nodeid='" + fo + "']").parent().addClass("k-state-selected")[0].scrollIntoView()); o.val() != "" && rr(ir); hu(); window.setTimeout(function () { o.val() != "" && rr(fe) }, 200); rc() } function wh(n) { ir = n; nt.addClass("vis-tm-bottomdivdisable"); no.css("display", "inherit"); oi.css("display", "inherit"); cu = t(n.sourceNode).find(".treechild").attr("data-nodeid"); vo = t(n.sourceNode).find(".treechild").parent().parent().parent(); us = t(n.sourceNode); er = this.dragging._draggable.hint.find(".k-denied"); t(r.find("ul")[0]).css("width", "95%"); s.addClass("VIS-TM-ondragdrop"); cu != 0 && (et.css("display", "inherit"), s.css("display", "inherit")); t(n.sourceNode).find(".treechild").attr("data-nodeid") == 0 && n.setStatusClass("k-denied"); t(n.dropTarget).parent().parent().attr("data-issummary") == "false" && n.setStatusClass("k-denied"); t(n.dropTarget).parent().parent().parent().parent().parent().find(".treechild").attr("data-issummary") == "false" && n.setStatusClass("k-denied"); t(n.dropTarget).hasClass("k-top") && t(n.dropTarget).find(".treechild").attr("data-issummary") == "false" && n.setStatusClass("k-denied"); t(n.dropTarget).hasClass("k-item") && n.setStatusClass("k-denied"); this.dragging._draggable.hint.find(".k-add").length == 1 && t(n.dropTarget).parent().attr("data-issummary") == "false" && n.setStatusClass("k-denied"); t(n.dropTarget).parent().find(".textdivTree").length == 1 && this.dragging._draggable.hint.find(".k-add").length == 1 && n.setStatusClass("k-denied"); (t(n.dropTarget).attr("aria-expanded") == "true" || t(n.dropTarget).attr("aria-expanded") == "false") && n.setStatusClass("k-denied"); t(n.dropTarget).hasClass("selectchangecolor") ? (er.css("display", "none"), er.parent().prepend(fs), er.parent().find(".vis-tm-unlinkimgss").css("display", "inherit")) : (er.css("display", "inherit"), er.parent().find(".vis-tm-unlinkimgss").css("display", "none")); t(n.dropTarget).hasClass("glyphicon glyphicon-trash") && (er.css("display", "none"), er.parent().prepend(fs)); lo = this.dragging._draggable.hint.find("span").hasClass("k-insert-bottom"); lo && n.setStatusClass("k-denied"); t(n.dropTarget).hasClass("k-state-hover") && t(n.dropTarget).find(".treechild").attr("data-issummary") == "false" && n.setStatusClass("k-denied"); t(n.dropTarget).hasClass("VIS-TM-root-node") && n.setStatusClass("k-denied") } function bh(i) { var l, h, u, c; if (gu = 0, gu = r.find(".k-state-selected").find(".treechild").attr("data-nodeid"), ir = i, ct.css("overflow", "auto"), ku.css("overflow", "auto"), lf.css("overflow", "auto"), nt.removeClass("vis-tm-bottomdivdisable"), no.css("display", "none"), oi.css("display", "none"), i.sourceNode.previousSibling == i.destinationNode && i.dropPosition == "after") { i.preventDefault(); s.removeClass("VIS-TM-ondragdrop"); s.css("display", "none"); et.css("display", "none"); return } if (i.sourceNode.nextSibling == i.destinationNode && i.dropPosition == "before") { i.preventDefault(); s.removeClass("VIS-TM-ondragdrop"); s.css("display", "none"); et.css("display", "none"); return } if (i.dropPosition == "after") { if (t(i.dropTarget).parent().attr("data-nodeid") == 0) { i.preventDefault(); s.removeClass("VIS-TM-ondragdrop"); s.css("display", "none"); et.css("display", "none"); return } if (t(i.dropTarget).find(".treechild").attr("data-nodeid") == 0) { i.preventDefault(); s.removeClass("VIS-TM-ondragdrop"); s.css("display", "none"); et.css("display", "none"); return } if (t(i.dropTarget).hasClass("k-minus")) { i.preventDefault(); s.removeClass("VIS-TM-ondragdrop"); s.css("display", "none"); et.css("display", "none"); return } } if (i.dropPosition == "before") { if (t(i.dropTarget).find(".treechild").attr("data-nodeid") == 0) { i.preventDefault(); s.removeClass("VIS-TM-ondragdrop"); s.css("display", "none"); et.css("display", "none"); return } if (t(i.dropTarget).hasClass("k-minus")) { i.preventDefault(); s.removeClass("VIS-TM-ondragdrop"); s.css("display", "none"); et.css("display", "none"); return } if (t(i.dropTarget).parent().hasClass("imgdivTree")) { i.preventDefault(); s.removeClass("VIS-TM-ondragdrop"); s.css("display", "none"); et.css("display", "none"); return } if (t(i.dropTarget).hasClass("VIS-TM-tree-wrap")) { i.preventDefault(); s.removeClass("VIS-TM-ondragdrop"); s.css("display", "none"); et.css("display", "none"); return } if (t(i.dropTarget).parent().hasClass("k-bot") && t(t(t(i.dropTarget).parent()).parent()).parent().attr("role") != "group") { i.preventDefault(); s.removeClass("VIS-TM-ondragdrop"); s.css("display", "none"); et.css("display", "none"); return } if (t(i.dropTarget).parent().hasClass("textdivTree") && t(i.dropTarget).parent().parent().attr("data-nodeid") == 0) { i.preventDefault(); s.removeClass("VIS-TM-ondragdrop"); s.css("display", "none"); et.css("display", "none"); return } } if (i.dropPosition == "over") { if (t(i.dropTarget).parent().attr("data-issummary") == "false") { i.preventDefault(); s.removeClass("VIS-TM-ondragdrop"); s.css("display", "none"); et.css("display", "none"); return } if (t(i.dropTarget).find(".treechild").attr("data-nodeid") == 0) { i.preventDefault(); s.removeClass("VIS-TM-ondragdrop"); s.css("display", "none"); et.css("display", "none"); return } } if (s.hasClass("selectchangecolor") && t(t(this.dragging._draggable.hint)).animate({ left: "250px", opacity: "0.5", height: "2px", width: "2px" }, 1e3), s.removeClass("VIS-TM-ondragdrop"), s.css("display", "none"), et.css("display", "none"), !er.hasClass("k-denied") || s.hasClass("selectchangecolor")) { if (treeType = n.dataContext.getJSONData(n.Application.contextUrl + "TreeMaintenance/GetTreeType", { treeId: e }, null), pi = treeType == "PR" ? "AD_TreeNodePR" : treeType == "BP" ? "AD_TreeNodeBP" : treeType == "MM" ? "AD_TreeNodeMM" : "AD_TreeNode", l = b.find(".k-state-hover").find(".treechild").attr("data-nodeid"), h = b.find(".k-state-hover").find(".treechild").attr("data-issummary"), h == "true") { kh(e, cu, l); u = t(i.destinationNode); f[0].style.visibility = "visible"; window.setTimeout(function () { f[0].style.visibility = "visible"; os(u); o.val() != "" && rr(i); hu(); es(); f[0].style.visibility = "hidden" }, 100); return } if (h = t(i.destinationNode).parent().parent().find(".treechild").attr("data-issummary"), i.sourceNode === i.destinationNode) { i.setValid(!1); f[0].style.visibility = "hidden"; return } if (es(), gu > 0 && window.setTimeout(function () { r.find(".k-state-selected").removeClass("k-state-selected"); t(r.find("div").find("div[data-nodeid='" + gu + "']").parent()).addClass("k-state-selected"); hu() }, 200), t(i.destinationNode).parent().parent().parent().attr("role") == "tree") { u = t(i.destinationNode); f[0].style.visibility = "visible"; var v = i.dropPosition, y = i.sourceNode, p = t(t(i.sourceNode.parentElement).parent().find(".k-in")[0]).find(".treechild").attr("data-nodeid"); window.setTimeout(function () { var o, i, r; f[0].style.visibility = "visible"; o = u.parent().children(); o.length > 0 && (i = 0, i = n.dataContext.getJSONData(n.Application.contextUrl + "TreeMaintenance/GetSeqNo", { treeId: e, tblName: pi, nodeId: u.find(".treechild").attr("data-nodeid") }, null), v == "after" && (i = i + 1), n.dataContext.getJSONData(n.Application.contextUrl + "TreeMaintenance/UpdateSeqNo", { treeId: e, tblName: pi, seqNo: i, bySeqNo: !0, isParent: !1 }, null), r = t(y).find(".treechild").attr("data-nodeid"), p > 0 ? n.dataContext.getJSONData(n.Application.contextUrl + "TreeMaintenance/UpdateSeqNo", { treeId: e, tblName: pi, seqNo: i, nodeId: r, bySeqNo: !1, isParent: !0 }, null) : n.dataContext.getJSONData(n.Application.contextUrl + "TreeMaintenance/UpdateSeqNo", { treeId: e, tblName: pi, seqNo: i, nodeId: r, bySeqNo: !1, isParent: !1 }, null)); f[0].style.visibility = "hidden" }, 600) } else { if (c = t(i.destinationNode), c.length == 0) { if (vu = t(i.sourceNode).find(".treechild").attr("data-nodeid"), cf = t(i.sourceNode).find(".treechild").parent().parent().parent(), s.hasClass("selectchangecolor")) sl(); else { s.removeClass("VIS-TM-ondragdrop"); s.css("display", "none"); et.css("display", "none"); f[0].style.visibility = "hidden"; return } return } var w = i.destinationNode.parentElement, a = i.sourceNode.parentElement, k = i.destinationNode, d = i.sourceNode; f[0].style.visibility = "visible"; window.setTimeout(function () { var s, u, r, i, o; if (f[0].style.visibility = "visible", s = t(t(d).find(".treechild").parent().parent().parent().parent().parent()).find("li").find(".k-state-hover").find("div").attr("data-nodeid"), u = c.parent().children(), w == a) { if (r = t(a.parentElement).find(".treechild").attr("data-nodeid"), r != 0) for (i = 0; i < u.length; i++)o = t(u[i]).find(".treechild").attr("data-nodeid"), n.dataContext.getJSONData(n.Application.contextUrl + "TreeMaintenance/UpdateSeqNoParentId", { treeId: e, tblName: pi, seqNo: i, nodeId: o, pid: r }, null) } else if (r = t(k.parentElement).parent().find(".treechild").attr("data-nodeid"), r != 0) for (i = 0; i < u.length; i++)o = t(u[i]).find(".treechild").attr("data-nodeid"), n.dataContext.getJSONData(n.Application.contextUrl + "TreeMaintenance/UpdateSeqNoParentId", { treeId: e, tblName: pi, seqNo: i, nodeId: o, pid: r }, null); f[0].style.visibility = "hidden" }, 600) } window.setTimeout(function () { o.val() != "" && rr(i) }, 300) } } function es() { r.find(".k-state-selected").length > 1 && (r.find(".k-state-selected").removeClass("k-state-selected"), i.empty()) } function os(n) { var u = n.parent(), i, f; u.attr("role") == "tree" ? (i = n.parent().children().children("ul").children()[n.parent().children().children("ul").children().length - 1], i && u && (i.remove(), t(t(u.children()[0]).children("ul")).prepend(i))) : (n.children("ul") && (i = n.children("ul").children()), i && (i = t(i[i.length - 1])), i && i.siblings().length > 0 && (f = t(i.siblings()[0]).parent(), r.data("kendoTreeView").detach(i[0]), f.prepend(i[0]))) } function kh(i, r, u) { f[0].style.visibility = "visible"; t.ajax({ url: n.Application.contextUrl + "TreeMaintenance/SaveTreeDragDrop", type: "Post", data: { treeID: i, NodeID: r, ParentID: u }, success: function (t) { var i = JSON.parse(t); i == n.Msg.getMsg("VIS_DataSave"); f[0].style.visibility = "hidden" }, error: function (n) { console.log(n); f[0].style.visibility = "hidden" } }) } function bi(r, u, e, s, h, l, a) { ot[0].style.visibility = "visible"; h == null && (h = ""); gr(); t.ajax({ url: n.Application.contextUrl + "TreeMaintenance/GetDataTreeNodeSelect", type: "Post", async: !1, data: { nodeID: r, treeID: u, pageNo: e, pageLength: s, searchChildNode: h, getTreeNodeChkValue: l }, success: function (r) { var u, s, c; if (or != !1) { var e = JSON.parse(r), h = null; if (e.length > 0) { for (ot[0].style.visibility = "visible", ur == !0 && i.empty(), ii = !0, u = 0; u < e.length; u++)if ((ur != !1 || !(i.find("li li").length > 0) || (s = i.find('[data-id="' + e[u].parentID + '"]'), !s || !(s.length > 0))) && e[u].parentID != 0) if (c = t('<input class="VIS-tm-checkbox" type="checkbox" />'), e[u].issummary == "Y") continue; else h = "<i class='vis vis-m-window summNonsumImage' data='Images/mWindow.png'><\/i>", i.append(t('<li class="VIS-tm-topMLi">').append(c).append(h).append(t("<li class='VIS-tm-MLi'    data-id='" + e[u].parentID + "' data-issummary='" + e[u].issummary + "' id='" + e[u].parentID + "'   >" + n.Utility.encodeText(e[u].name) + "<\/li>"))); ni.css("display", "none"); hs(); io(); gr() } else i.find("li").length > 0 ? (ii = !0, ni.css("display", "none")) : (ii = !1, ni.css("display", "inherit")); rr(a); window.setTimeout(function () { i.find("input:checked").length > 0 ? k.removeClass("vis-tm-delete") : k.addClass("vis-tm-delete") }, 200); tr(); d.is(":checked") && (i.find("input").prop("checked", !0), i.find("input").parent().addClass("vis-tm-menuselectedcolor")); i.find("li").length > 0 ? (ii = !0, ni.css("display", "none")) : (ii = !1, ni.css("display", "inherit")); o.prop("disabled", !1); gi.prop("disabled", !1); o.focus(); wf = !0; yf = !0; hr.css("display", "none"); f[0].style.visibility = "hidden"; fu(); ot[0].style.visibility = "hidden" } }, error: function (n) { hr.css("display", "none"); ii = !1; console.log(n); i.empty(); o.prop("disabled", !1); gi.prop("disabled", !1); o.focus(); yf = !0; f[0].style.visibility = "hidden"; ot[0].style.visibility = "hidden" } }); window.setTimeout(function () { i.find("li").length > 0 ? (ii = !0, ni.css("display", "none"), kt.removeClass("vis-tm-delete"), ot[0].style.visibility = "hidden") : (ii = !1, kt.addClass("vis-tm-delete")) }, 500); ct.height(ti.height() - (c.height() + 20 + wr.height())) } function ss() { f[0].style.visibility = "hidden"; ks(); var r = new n.ChildDialog; r.setEnableResize(!1); r.setTitle(n.Msg.getMsg("UnlinkRecord")); r.setModal(!0); r.setContent(te); r.show(); r.onClose = function () { }; r.onOkClick = function () { for (var u, n = [], r = 0; r < i.find("input:checked").length; r++)u = t(i.find("input:checked")[r]).parent().find("li").attr("data-id"), n.push(u); i.find("input:checked").length == 0 && n.push(eu); bottomchildselectedID = n; n = n.toString(); rf(e, n); a.removeClass("VIS-TM-ondragdrop"); a.css("display", "none") }; r.onCancelClick = function () { a.removeClass("VIS-TM-ondragdrop"); a.css("display", "none") } } function dh(r, u) { var o, s, e, h; for (ot[0].style.visibility = "visible", o = [], s = "", e = 0; e < i.find("li li").length; e++)h = t(i.find("li li")[e]).attr("data-id"), o.push(h); s = o.toString(); t.ajax({ url: n.Application.contextUrl + "TreeMaintenance/UpdateItemSeqNo", type: "Post", data: { treeID: u, itemsid: s, ParentID: r }, success: function (n) { var t = JSON.parse(n) }, error: function (n) { console.log(n); f[0].style.visibility = "visible" } }); ot[0].style.visibility = "hidden" } function br() { t.ajax({ url: n.Application.contextUrl + "TreeMaintenance/TreeTableName", async: !1, data: { treeID: e }, success: function (n) { var t = JSON.parse(n); nr = t }, error: function (n) { console.log(n); f[0].style.visibility = "hidden" } }) } function hs() { t(i.find("li")).draggable({ cursorAt: { left: -10, top: -10 }, helper: function () { var r = t(i.find("li")).find("input:checked").parent(), n; if (r.length === 0 && (r = t(this)), n = t("<div/>").attr("id", "draggingContainer"), t(i.find("li")).find("input:checked").length == 0) { if (t(this).hasClass("VIS-tm-topMLi")) return; r = t(this).parent(); n = t('<div style="background-color:lightblue;"/>').attr("id", "draggingContainer") } return n.append(r.clone()), l = n, l.css("width", "250px"), l.css({ "z-index": 2 }), l.css({ "max-height": "250px", overflow: "auto" }), l.css({ overflow: "hidden" }), n }, start: function () { var n, i, r; for (se = t(this).attr("id"), vr = !0, ci = [], ou = [], n = 0; n < t(t(l.find("li li"))).length; n++)i = t(t(l.find("li li"))[n]).attr("id"), ou.push(parseInt(i)), ci.push(i); gr(); yo = !1; kr = !0; su = !1; cs(); oi.css("display", "inherit"); k.css("display", "none"); a.height(nt.height()); a.css("margin-top", "5px"); a.css("background-color", "#FFC0CB"); a.css("display", "inherit"); a.mouseover(function () { a.addClass("selectchangecolor"); a.css("background-color", "#ff0000") }); a.mouseleave(function () { a.removeClass("selectchangecolor"); a.css("background-color", "#FFC0CB") }); r = ti.width() - 35; nt.width(r); kt.css("display", "none"); ct.css("overflow", "hidden") }, drag: function () { }, stop: function () { var u, o, r, i; if (kr = !1, a.hasClass("selectchangecolor")) if (f[0].style.visibility = "visible", br(), u = n.dataContext.getJSONData(n.Application.contextUrl + "TreeMaintenance/GetNodeIdsOfParent", { tbname: pi, parent_id: eu, treeId: e }, null), u != null && u.length == 0) { if (o = [], ci.length > 0) if (ri == "false") { for (r = [], i = 0; i < ou.length; i++)t.inArray(ou[i], si) >= 0 || r.push(ou[i]); r.length > 0 ? rf(e, r.toString()) : (n.ADialog.info("NeverDelete", !0, nu), f[0].style.visibility = "hidden") } else rf(e, ci.toString()); else n.ADialog.info("NeverDelete", !0, nu), f[0].style.visibility = "hidden"; a.removeClass("VIS-TM-ondragdrop"); a.css("display", "none"); k.css("display", "inherit") } else ss(); a.removeClass("VIS-TM-ondragdrop"); a.css("display", "none"); k.css("display", "inherit"); nt.css("width", "100%"); ct.css("overflow", "auto"); oi.css("display", "none"); kt.css("display", "inherit") } }) } function lr(i, r, e, o) { u.find("li").length == 0 && st.empty(); hf != !1 && u.empty(); yi[0].style.visibility = "visible"; e = n.Utility.encodeText(e); e == null && (e = ""); hr.css("display", "inherit"); oi.css("display", "inherit"); t.ajax({ url: n.Application.contextUrl + "TreeMaintenance/LoadMenuData", type: "Post", data: { pageLength: he, pageNo: vi, treeID: i, searchtext: e, demandsMenu: o }, success: function (i) { var f = JSON.parse(i), o, s, e, l = t("<span><\/span>"), r, h, c; if (f) { for (r = 0; r < f.length; r++)u.find("li li").length > 0 && (h = u.find('[data-id="' + f[r].ID + '"]'), h && h.length > 0) || f[r].ID != 0 && (f[r].issummary == "Y" ? (f[r].disabled == !0 ? (e = t('<input class="vis-tm-chkbox" disabled type="checkbox" />'), o = "<i class='" + f[r].classopacity + " fa fa-folder-o summNonsumImage' data-imgsrc='Images/summary.png'><\/i>") : (e = t('<input  class="vis-tm-chkbox" type="checkbox" />'), o = "<i class='vis vis-m-window summNonsumImage' data-imgsrc='Images/folder.png'><\/i>"), u.append(t('<li class="vis-tm-upperLi">').append(t("<div class='vis-tm-upperdivchkandimg'>").append(e).append(o)).append(t("<div class='vis-tm-upperdivli'>").append(t("<li class='" + f[r].classopacity + " vis-tm-textli ' checkSummary='checkSummary'  style='cursor:default;' id='" + f[r].ID + "' data-id='" + f[r].ID + "'  style='cursor:pointer'  >" + n.Utility.encodeText(f[r].Name) + " (" + n.Utility.encodeText(f[r].description) + ")<\/li>").append(t("<span title='" + n.Msg.getMsg("UnlinkNode") + "' class='" + f[r].unlinkClass + "'><\/span>")))))) : (f[r].disabled == !0 ? (e = t('<input  class="vis-tm-chkbox"  disabled type="checkbox" />'), s = "<i class='" + f[r].classopacity + " vis vis-m-window summNonsumImage' data-imgsrc='Images/nonSummary.png'><\/i>") : (e = t('<input  class="vis-tm-chkbox" type="checkbox" />'), s = "<i class='vis vis-m-window summNonsumImage' data-imgsrc='Images/mWindow.png'><\/i>"), u.append(t('<li class="vis-tm-upperLi">').append(t("<div class='vis-tm-upperdivchkandimg'>").append(e).append(s)).append(t("<div class='vis-tm-upperdivli'>").append(t("<li class='" + f[r].classopacity + " vis-tm-textli ' style='cursor:default;' id='" + f[r].ID + "' data-id='" + f[r].ID + "'   style='cursor:pointer'  >" + n.Utility.encodeText(f[r].Name) + " (" + n.Utility.encodeText(f[r].description) + ")<\/li>").append(t("<span title='" + n.Msg.getMsg("UnlinkNode") + "' class='" + f[r].unlinkClass + "'><\/span>"))))))); u.find("li").length > 0 ? uu.css("display", "none") : uu.css("display", "inherit") } else u.find("li").length > 0 ? uu.css("display", "none") : uu.css("display", "inherit"); gh(); as(); g.prop("disabled", !1); hr.css("display", "none"); oi.css("display", "none"); di.css("display", "none"); yi[0].style.visibility = "hidden"; c = /ipad|iphone|ipod/i.test(navigator.userAgent.toLowerCase()); c && t(u.find("li")).draggable("destroy") }, error: function (n) { console.log(n); hr.css("display", "none"); oi.css("display", "none"); g.prop("disabled", !1); di.css("display", "none"); f[0].style.visibility = "hidden"; yi[0].style.visibility = "hidden" } }) } function gh(n) { ir = n; t(u.find("li")).draggable({ cursorAt: { left: -10, top: -10 }, helper: function () { var i, n; return l = [], i = t(u.find("input:checked")).parent().parent(), i.length === 0 && (i = t(this)), n = t("<div/>"), t(u.find("input:checked")).parent().parent().length == 0 ? t(this).hasClass("vis-tm-textli") ? t(this).parent().parent().find("input").attr("disabled") == "disabled" ? window.setTimeout(function () { }, 200) : (i = t(this).parent().parent(), n = t('<div style="background-color:lightblue;"/>').attr("id", "draggingContainer")) : t(this).hasClass("vis-tm-upperLi") && (t(this).find("input").attr("disabled") == "disabled", n = t('<div style="background-color:lightblue;"/>').attr("id", "draggingContainer")) : t(this).hasClass("vis-tm-textli") ? (t(this).parent().parent().find("input").attr("disabled") == "disabled", n = t('<div style="background-color:lightblue;"/>').attr("id", "draggingContainer")) : t(this).hasClass("vis-tm-upperLi") && (t(this).find("input").attr("disabled") == "disabled", n = t("<div/>").attr("id", "draggingContainer")), t(this).parent().parent().find("input").attr("disabled") != "disabled" && t(this).parent().parent().find("input").attr("disabled") != undefined && n.append(i.clone()), (t(u.find("input:checked")).length > 0 || i.find("input").attr("disabled") == undefined) && !i.hasClass("vis-tm-opacity") && n.append(i.clone()), l = n, l.css({ width: "350px" }), l.css({ "z-index": 2 }), l.find(".vis-tm-upperLi").length > 5 && (l.css({ "max-height": "250px", overflow: "auto" }), l.css({ overflow: "hidden" })), dr = n, n }, start: function () { var u, i, r, f, e; if (oi.css("display", "inherit"), dr.find("li").length > 0 && sr.css("display", "inherit"), yo = !0, dr.find(".vis-tm-textli").hasClass("vis-tm-textli") && (kr = !0), se = t(this).attr("id"), vr = !1, lu = !0, ci = [], ru = [], su = !0, l.find(".vis-tm-upperLi").length == 0) r = l.find("li").attr("id"), ci.push(r); else for (u = l.find(".vis-tm-upperLi"), i = 0; i < u.length; i++)r = t(u.find("li")[i]).attr("id"), ci.push(r), f = t(u[i]).find("i").data("imgsrc"), e = f.substr(f.lastIndexOf("/") + 1), e == "mWindow.png" || e == "folder.png" ? ru.push("new") : ru.push("update"); gr(); io(n); cs() }, drag: function () { }, stop: function () { ci = []; kr = !1; oi.css("display", "none"); sr.css("display", "none") } }) } function gr() { ti.droppable({ drop: function (n, i) { var u = !0, s, c, h, o, e, l; ye == !1 && (u = !1); t(i.draggable).hasClass("ui-dialog") && (f[0].style.visibility = "hidden", u = !1); r.find("span").hasClass("k-state-hover") || r.find("span").hasClass("k-state-selected") || (f[0].style.visibility = "hidden", u = !1); lu = !1; r.find("span").hasClass("k-state-hover") ? au = t(r.find("li").find("span")).parent().find(".k-state-hover").parent().parent() : r.find("span").hasClass("k-state-selected") && (au = t(r.find("li").find("span")).parent().find(".k-state-selected").parent().parent()); r.find("span").hasClass("k-state-hover") ? (o = b.find(".k-state-hover").find(".treechild"), li = o, s = o.attr("data-issummary"), c = o.attr("data-nodeid"), h = o.attr("data-parentid")) : r.find("span").hasClass("k-state-selected") && (e = r.find(".k-state-selected").find(".treechild"), e.parent().css("border", "none"), li = e, c = e.attr("data-nodeid"), s = e.attr("data-issummary"), h = e.attr("data-parentid")); l = []; s == "true" ? (su == !1 && li.parent().hasClass("k-state-selected") && (u = !1), pf = u, u == !0 ? (pf = u, ro(c, h, ci, vr, ru)) : u == !1 && (lu = !0, f[0].style.visibility = "hidden")) : s != "false" || tt.is(":checked") || (SummaryIDs = t(au.parent().parent().find(".treechild")[0]).attr("data-nodeid"), li = t(au.parent().parent().find(".treechild")[0]), ro(SummaryIDs, h, ci, vr, ru)) } }) } function cs() { r.data("kendoTreeView").wrapper.find(".k-in").on({ mouseenter: function () { kr == !0 && (ye = !0, t(this).hasClass("k-state-selected") && t(this).css("border", "2px solid #bac0cc")) }, mouseleave: function () { kr == !0 && t(this).hasClass("k-state-selected") && t(this).css("border", "none"); ye = !1 } }) } function io() { i.parent().droppable({ drop: function (i, u) { var o = !0, e; if (lu == !1 && (o = !1), t(u.draggable).hasClass("ui-dialog") && (f[0].style.visibility = "hidden", o = !1), o == !0 && !vr) if (r.find(".k-state-selected").length == 1) { e = r.find(".k-state-selected").find(".treechild"); li = e; var s = e.attr("data-nodeid"), h = e.attr("data-issummary"), c = e.attr("data-parentid"); h == "true" && dr.find(".vis-tm-textli").hasClass("vis-tm-textli") && (f[0].style.visibility = "visible", ro(s, c, ci, vr, ru)) } else dr.find(".vis-tm-textli").hasClass("vis-tm-textli") && n.ADialog.info("SelectAnySummaryTreeNode"); r.find(".k-state-selected").length == 0 && dr.find(".vis-tm-textli").hasClass("vis-tm-textli") && n.ADialog.info("SelectAnySummaryTreeNode") }, tolerance: "pointer" }) } function ro(s, h, c, a, v) { var p = c.toString(); p != "" && (f[0].style.visibility = "visible", st.empty(), v = v.toString(), t.ajax({ url: n.Application.contextUrl + "TreeMaintenance/SaveDataOnDrop", type: "Post", data: { summaryid: s, nodid: h, treeID: e, dragMenuNodeID: p, checkMorRdragable: a, IsExistItem: v }, success: function (e) { var st = !0, ri = JSON.parse(e), ft, bt, ui, v, ct, lt, at, yt, p, h, w, kt, b, c, pt, rt, nt, it, et, ut, ti, ii, wt; if (a) for (ft = 0; ft < l.find("li").find(".VIS-tm-MLi").length; ft++)r.find("div").find("div[data-nodeid='" + s + "']").parent().hasClass("k-state-selected") && su == !1 || (ct = t(l.find("li").find(".VIS-tm-MLi")[ft]).attr("id"), t(i.find("li").find("li[data-id='" + ct + "']").parent()).remove()); if (ri == n.Msg.getMsg("VIS_DataSave")) { if (bt = u.find(".vis-tm-menuselectedcolor"), ui = l.find("li .vis-tm-textli").attr("id"), r.find("div").find("div[data-nodeid='" + s + "']").parent().hasClass("k-state-selected")) for (v = l.find("li li").length - 1; v >= 0; v--)if (ct = l.find("li li").attr("id"), su != !1) { if (lt = i.find("input:checked").length, at = i.find("input").length, lt == at ? lt != 0 && at != 0 ? d.prop("checked", !1) : d.prop("checked", !1) : d.prop("checked", !1), yt = t(l.find("li li")[v]).attr("id"), p = t(l.find("li li")[v]).text(), p = p.substring(0, p.lastIndexOf("(")), h = t(l.find("li li")[v]).parent().parent().find("i").data("imgsrc"), h = h.substring(h.lastIndexOf("/") + 1), w = null, h == "nonSummary.png") w = "<i class='summNonsumImage vis vis-m-window'  data-imgsrc='Images/mWindow.png'><\/i>"; else if (h == "summary.png") w = "<i class='fa fa-folder-o summNonsumImage' data-imgsrc='Images/folder.png'><\/i>"; else if (h == "folder.png") { w = "<i class='fa fa-folder-o summNonsumImage' data-imgsrc='Images/folder.png'><\/i>"; continue } (h == "mWindow.png" && (w = "<i class='summNonsumImage vis vis-m-window' data-imgsrc='Images/mWindow.png'><\/i>"), o.val() == "" || !y.is(":checked") || p.contains(o.val())) && (kt = t('<input class="VIS-tm-checkbox" type="checkbox" />'), i.prepend(t('<li class="VIS-tm-topMLi">').append(kt).append(w).append(t("<li class='VIS-tm-MLi' data-id='" + yt + "'  id='" + yt + "' style='cursor:default'  >" + n.Utility.encodeText(p) + "<\/li>")))) } for (b = 0; b < l.find("li .vis-tm-textli").length; b++) { c = t(t(u.find("li"))).find("li[data-id='" + t(l.find(".vis-tm-textli")[b]).attr("data-id") + "']").parent().parent(); c.find("input").prop("disabled", "true"); c.find("input").prop("checked", !1); c.find("i").addClass("vis-tm-opacity"); c.find(".vis-tm-textli").addClass("vis-tm-opacity"); c.find("input").css("cursor", "not-allowed"); c.find("span").hasClass("VIS-Tm-glyphiconglyphicon-link") || c.find("span").addClass("VIS-Tm-glyphiconglyphicon-link"); g.val() == "Unlinked" && c.remove(); var dt = t(t(u.find("li"))).find("li[data-id='" + t(l.find(".vis-tm-textli")[b]).attr("data-id") + "']").parent().parent().find("img").attr("src"), gt = t(t(u.find("li"))).find("li[data-id='" + t(l.find(".vis-tm-textli")[b]).attr("data-id") + "']").parent().parent().find("img"), k, h = dt; h != null && (h = h.substring(h.lastIndexOf("/") + 1), h == "mWindow.png" ? k = n.Application.contextUrl + "Areas/VIS/Images/nonSummary.png" : h == "folder.png" && (k = n.Application.contextUrl + "Areas/VIS/Images/summary.png"), gt.attr("src", k)); st = !1 } for (pt = 0; pt < u.find(".vis-tm-menuselectedcolor").length; pt++)st = !1; if (st != !1 && l.find(".vis-tm-textli").length == 1) { var fi = t(t(u.find("li"))).find("li[data-id='" + l.find(".vis-tm-textli").attr("data-id") + "']"), dt = t(t(u.find("li"))).find("li[data-id='" + l.find(".vis-tm-textli").attr("data-id") + "']").parent().parent().find("img").attr("src"), gt = t(t(u.find("li"))).find("li[data-id='" + l.find(".vis-tm-textli").attr("data-id") + "']").parent().parent().find("img"), k, h = dt; h != null && (h = h.substring(h.lastIndexOf("/") + 1), h == "mWindow.png" ? k = n.Application.contextUrl + "Areas/VIS/Images/nonSummary.png" : h == "folder.png" && (k = n.Application.contextUrl + "Areas/VIS/Images/summary.png"), gt.attr("src", k)) } for (rt = [], nt = 0; nt < l.find(".vis-tm-textli").length; nt++)(it = null, et = null, t(l.find(".vis-tm-textli")[nt]).attr("checkSummary") == "checkSummary" ? (it = "true", et = "Areas/VIS/Images/folder.png") : (it = "false", et = "Areas/VIS/Images/mWindow.png"), tt.is(":checked") && it == "false") || (tt.is(":checked") && it == "true" && (vt.css("display", "inherit"), ht.css("display", "none")), tt.is(":checked") || (vt.css("display", "inherit"), ht.css("display", "none")), ut = t(l.find(".vis-tm-textli")[nt]).text(), ut = ut.substring(0, ut.lastIndexOf("(")), ti = r.data("kendoTreeView").append({ text: n.Utility.encodeText(ut), IsSummary: it, getparentnode: li.attr("data-nodeid"), TableName: li.attr("data-tablename"), NodeID: t(l.find(".vis-tm-textli")[nt]).attr("id"), TreeParentID: li.attr("data-nodeid"), ParentID: li.attr("data-nodeid"), ImageSource: et }, li), rt.push(ti)); if (ii = li.parent().parent().parent(), rt && rt.length > 0) for (wt = rt.length - 1; wt >= 0; wt--)os(ii); bt.removeClass("vis-tm-menuselectedcolor"); i.find("li").length > 0 && (ni.css("display", "none"), ot[0].style.visibility = "hidden") } hs(); tr(); window.setTimeout(function () { o.val() != "" && rr(fe) }, 200); tf(); fr = !0; f[0].style.visibility = "hidden" }, error: function (n) { console.log(n); f[0].style.visibility = "hidden" } })) } function ic() { w.on("change", na); tt.on("click", ra); lf.on("scroll", ia); u.on("click", kl); i.on("click", bl); o.on("keyup", rr); o.on("keypress", vl); gi.on("click", wl); o.on("input", function (n) { if ("" == this.value) { r.find("span").removeClass("VIS-TM-highlight"); rt = 1; ft = 50; v = o.val(); h = y.is(":checked") ? "true" : "false"; var t = r.find(".k-state-selected").find(".treechild").attr("data-nodeid"); bi(t, e, rt, ft, v, h, n) } }); dt.on("input", function () { "" == this.value && w.val() != "" && (u.empty(), window.setTimeout(function () { u.empty(); lt = ""; at = g.val(); vi = 1; lr(e, wt, lt, at) }, 200)) }); ke.on("click", ll); be.on("click", re); ns.on("click", hl); dt.on("keyup", cl); c.on("resize", ol); c.find(".ui-resizable-e").css("right", "0px"); c.find(".ui-resizable-s").css("bottom", "0px"); fl(); k.on("click", ul); g.on("change", el); s.mouseover(function () { s.addClass("selectchangecolor"); s.css("background-color", "#ff0000") }); s.mouseleave(function () { s.removeClass("selectchangecolor"); s.css("background-color", "#FFC0CB") }); ct.on("scroll", rl); window.setTimeout(function () { }, 200); y.is(":checked") && (iu = -1); y.on("click", function (n) { h = y.is(":checked") ? "true" : "false"; rr(n) }); d.on("click", gc); vt.on("click", dc); ht.on("click", kc); kt.on("click", yc); ut.on("click", as); wi.on("click", lc); cr.on("click", cc); go.on("click", hc); sr.mouseover(function () { sr.css({ cursor: "not-allowed" }) }); sr.mouseleave(function () { sr.css({ cursor: "default" }) }); af.on("click", sc); ai.on("click", fc) } function rc() { var o, s, h, t, r, i, u, f; if (ki = [], o = n.dataContext.getJSONData(n.Application.contextUrl + "TreeMaintenance/GetTableID", { treeId: e }, null), s = n.dataContext.getJSONData(n.Application.contextUrl + "TreeMaintenance/GetTableName", { table_id: o }, null), ri = "true", s == "AD_Menu" && (ri = n.dataContext.getJSONData(n.Application.contextUrl + "TreeMaintenance/IsRecordExists", { treeId: e }, null)), h = n.dataContext.getJSONData(n.Application.contextUrl + "TreeMaintenance/GetWindowMenuIds", {}, null), t = n.dataContext.getJSONData(n.Application.contextUrl + "TreeMaintenance/GetFormMenuIds", {}, null), t != null && t.length > 0) for (r = 0; r < t.length; r++)ki.push(t[r]); if (si = ki, ki = ki.toString(), i = n.dataContext.getJSONData(n.Application.contextUrl + "TreeMaintenance/GetNameByIds", { ids: ki }, null), u = "", i != null && i.length > 0) for (f = 0; f < i.length; f++)u += i[f], u += ","; nu = u + " " + n.Msg.getMsg("MenuBinded"); ot[0].style.visibility = "hidden" } function uc(t) { br(); var i = n.dataContext.getJSONData(n.Application.contextUrl + "TreeMaintenance/GetSeqNo", { treeId: e, tblName: nr, nodeId: "-1" }, null); i += 1; n.dataContext.getJSONData(n.Application.contextUrl + "TreeMaintenance/UpdateSeqNo", { treeId: e, tblName: nr, seqNo: i, nodeId: t, bySeqNo: !1, isParant: !0 }, null) } function fc() { } function ec() { if (w.val() != "") { if (t(this).find("span").hasClass("vis-tm-delete")) return; n.ADialog.confirm("RemoveUnlinkedItem", !0, "", "Confirm", function (n) { if (n) { oc(); vt.css("display", "none"); ht.css("display", "inherit"); var t = w.find("option:selected").text(); gt.text(t); fr = !1 } else return }) } } function oc() { f[0].style.visibility = "visible"; t.ajax({ url: n.Application.contextUrl + "TreeMaintenance/RemoveLinkedItemFromTree", type: "Post", data: { treeID: e, menuId: ki }, success: function (t) { var i = JSON.parse(t); i == "count" ? (u.empty(), lt = dt.val(), at = g.val(), vi = 1, lr(e, wt, lt, at), window.setTimeout(function () { re(); window.setTimeout(function () { fr = !1; f[0].style.visibility = "hidden" }, 200) }, 200)) : i == "menubind" && (f[0].style.visibility = "hidden", n.ADialog.info("NeverDelete", !0, nu)) }, error: function (n) { console.log(n); f[0].style.visibility = "hidden" } }) } function sc() { if (w.val() != "") { var f = t('<ul class="vis-apanel-tm-ul"><\/ul>'), u = t("<div>"), i = t('<div style="padding:0 10px;min-width:150px">'), r = t('<span class="VIS-Tm-glyphiconglyphicon-link VIS-Tm-unlinkforbottmo vis vis-link"><\/span>'); bf = t('<p style="line-height:19px;cursor:pointer;">' + n.Msg.getMsg("RemoveLinkedItem") + "<\/p>").append(r); u.append(i); i.append(t('<div style="margin-top: 10px;" ><\/div>').append(ai).append(vh)); i.append(t('<div style="float: left;margin-bottom: 6px;margin-top: 5px;width:100%" ><\/div>').append(bf)); t(this).w2overlay(u); fr == !0 ? r.removeClass("vis-tm-delete") : r.addClass("vis-tm-delete"); bf.on("click", ec) } } function tf(n) { if (r.find("span").hasClass("k-state-selected") && ct.find("ul").height() < ct.height()) { rt = 1; ft = 50; v = y.is(":checked") ? o.val() : ""; h = y.is(":checked") ? "true" : "false"; ur = !1; var t = r.find(".k-state-selected").find(".treechild").attr("data-nodeid"); bi(t, e, rt, ft, v, h, n) } } function kf() { ut.prop("checked", !1) } function hc() { var i = n.dataContext.getJSONData(n.Application.contextUrl + "TreeMaintenance/GetWindowtId", {}, null), t = new n.Query; t.addRestriction("AD_Tree_ID", n.Query.prototype.EQUAL, e); n.viewManager.startWindow(i, t) } function cc() { cr.css("display", "none"); dt.val(""); w.val() != "" && (u.empty(), window.setTimeout(function () { u.empty(); lt = ""; at = g.val(); vi = 1; lr(e, wt, lt, at) }, 200)) } function lc(n) { o.val(""); o.focus(); wi.css("display", "none"); r.find("span").removeClass("VIS-TM-highlight"); rt = 1; ft = 50; v = o.val(); h = y.is(":checked") ? "true" : "false"; ur = !0; var t = r.find(".k-state-selected").find(".treechild").attr("data-nodeid"); w.val() != "" && bi(t, e, rt, ft, v, h, n) } function as(n) { if (ir = n, ut.is(":checked")) { yi[0].style.visibility = "visible"; le = !1; for (var i = 0; i < u.find("input").length; i++)t(u.find("input")[i]).attr("disabled") == "disabled" && t(u.find("input")[i]).parent().parent().removeClass("vis-tm-menuselectedcolor"), t(u.find("input")[i]).attr("disabled") != "disabled" && (t(u.find("input")[i]).prop("checked", !0), t(u.find("input")[i]).parent().parent().addClass("vis-tm-menuselectedcolor")); yi[0].style.visibility = "hidden" } else le == !1 && (yi[0].style.visibility = "visible", u.find("input").prop("checked", !1), u.find(".vis-tm-menuselectedcolor").removeClass("vis-tm-menuselectedcolor"), yi[0].style.visibility = "hidden") } function ac(n) { t(n.target).hasClass("VIS-tm-MLi") && (t(this).find("li").removeClass("vis-tm-menuselectedcolor"), t(this).find("li").find("input").prop("checked", !1), t(n.target).parent().addClass("vis-tm-menuselectedcolor"), t(n.target).parent().find("input").prop("checked", !0), d.prop("checked", !1)); t(n.target).hasClass(" summNonsumImage ") && (t(this).find("li").removeClass("vis-tm-menuselectedcolor"), t(this).find("li").find("input").prop("checked", !1), t(n.target).parent().addClass("vis-tm-menuselectedcolor"), t(n.target).parent().find("input").prop("checked", !0), d.prop("checked", !1)); t(n.target).hasClass("VIS-tm-checkbox") && (t(n.target).parent().find("input").prop("checked") ? t(n.target).parent().addClass("vis-tm-menuselectedcolor") : (t(n.target).parent().removeClass("vis-tm-menuselectedcolor"), t(n.target).parent().find("li").removeClass("vis-tm-menuselectedcolor"), d.prop("checked", !1))) } function vc(n) { v = ""; var i = t(n.currentTarget); i[0].scrollHeight - i.scrollTop() == i.outerHeight() && (df = !1, gf += 1, f[0].style.visibility = "visible", ps(yr, e, gf, uo, v, h, n)) } function yc(u) { var c, s; if (f[0].style.visibility = "visible", w.val() != "" && (o.prop("disabled", !1), gi.prop("disabled", !1)), or = !1, ii == !1) { or = !0; kt.addClass("vis-tm-delete"); f[0].style.visibility = "hidden"; return } if (r.find(".k-state-selected").length == 0) { f[0].style.visibility = "hidden"; or = !0; return } if (w.val() == "") { f[0].style.visibility = "hidden"; or = !0; return } pc(); df = !0; gf = 1; uo = 50; v = ""; h = "false"; c = r.find(".k-state-selected").find(".treechild").attr("data-nodeid"); f[0].style.visibility = "visible"; window.setTimeout(function () { ps(c, e, gf, uo, v, h, u) }, 200); yt.on("click", ac); ys.on("scroll", vc); s = new n.ChildDialog; s.setHeight(550); s.setWidth(450); s.setEnableResize(!1); s.setTitle(n.Msg.getMsg("SetOrder")); s.setModal(!0); s.setContent(vs); yt.empty(); s.show(); s.onClose = function () { tu = !0 }; s.onOkClick = function (u) { var s, f, p; if (ne == !1) { ne = !0; tu = !0; ot[0].style.visibility = "visible"; s = r.find(".k-state-selected").find(".treechild").attr("data-nodeid"); fo = s; var c = r.find(".k-state-selected").find(".treechild").attr("data-nodeid"), l = [], a = ""; for (f = 0; f < yt.find("li li").length; f++)p = t(yt.find("li li")[f]).attr("data-id"), l.push(p); a = l.toString(); t.ajax({ url: n.Application.contextUrl + "TreeMaintenance/UpdateItemSeqNo", type: "Post", data: { treeID: e, itemsid: a, ParentID: c }, success: function (n) { var t = JSON.parse(n); re(); i.empty(); rt = 1; ft = 50; v = y.is(":checked") ? o.val() : ""; h = y.is(":checked") ? "true" : "false"; ur = !0; bi(c, e, rt, ft, v, h, u); vt.css("display", "inherit"); ht.css("display", "none") }, error: function (n) { console.log(n); ot[0].style.visibility = "hidden" } }) } v = y.is(":checked") ? o.val() : ""; h = y.is(":checked") ? "true" : "false"; or = !0 }; s.onCancelClick = function () { f[0].style.visibility = "hidden"; v = y.is(":checked") ? o.val() : ""; h = y.is(":checked") ? "true" : "false"; ne = !0; or = !0; tu = !1 } } function pc() { vs.append(ys.append(yt)) } function ps(i, r, u, e, o, s) { o == null && (o = ""); df == !0 && yt.empty(); gr(); t.ajax({ url: n.Application.contextUrl + "TreeMaintenance/FillSequenceDailog", type: "Post", data: { nodeID: i, treeID: r, pageNo: u, pageLength: e, searchChildNode: o, getTreeNodeChkValue: s }, success: function (i) { var r, o, s, e; f[0].style.visibility = "visible"; var u = JSON.parse(i), h = null, c = null; if (u.length > 0) for (r = 0; r < u.length; r++)ur == !1 && yt.find("li li").length > 0 && (o = yt.find('[data-id="' + u[r].parentID + '"]'), o && o.length > 0) || u[r].parentID != 0 && (s = t('<input class="VIS-tm-checkbox" type="checkbox" />'), u[r].issummary == "Y" ? (h = "<i class='fa fa-folder-o summNonsumImage' data-imgsrc='Images/folder.png'><\/i>", yt.append(t('<li class="VIS-tm-topMLi">').append(s).append(h).append(t("<li class='VIS-tm-MLi' data-NodePID='" + u[r].NodeParentID + "' data-id='" + u[r].parentID + "' data-issummary='" + u[r].issummary + "' id='" + u[r].parentID + "'   >" + n.Utility.encodeText(u[r].name) + "<\/li>")))) : (c = "<i class='vis vis-m-window summNonsumImage' data-imgsrc='Images/mWindow.png'><\/i>", e = t('<li class="VIS-tm-topMLi" >'), e.append(s), e.append(c), e.append(t("<li class='VIS-tm-MLi'  data-NodePID='" + u[r].NodeParentID + "'  data-id='" + u[r].parentID + "' data-issummary='" + u[r].issummary + "' id='" + u[r].parentID + "'   >" + n.Utility.encodeText(u[r].name) + "<\/li>")), yt.append(e))); bc(); yt.sortable("refresh"); window.setTimeout(function () { f[0].style.visibility = "hidden" }, 500) }, error: function (n) { console.log(n); yt.empty(); f[0].style.visibility = "hidden" } }) } function bc() { var n = null; yt.sortable({ cursorAt: { left: -10, top: -10 }, helper: function (i, r) { n = t("<li />"); r.hasClass("vis-tm-menuselectedcolor") || r.addClass("vis-tm-menuselectedcolor").siblings().removeClass("vis-tm-menuselectedcolor"); var u = r.parent().children(".vis-tm-menuselectedcolor").clone(); return ws = r.data("multidrag", u).siblings(".vis-tm-menuselectedcolor"), r.data("multidrag", u).siblings(".vis-tm-menuselectedcolor").hide(), wc = n.append(u), n.append(u) }, start: function (n, i) { ne = !1; yt.find("input").prop("checked", !1); eu = i.item.find("li").attr("id"); t(this).parent().parent().parent().css("overflow", "hidden") }, change: function () { }, update: function () { }, stop: function (n, t) { t.item.after(t.item.data("multidrag")).remove(); window.setTimeout(function () { ws.remove() }, 100); yt.find("input").prop("checked", !1); yt.find(".vis-tm-menuselectedcolor").find("input").prop("checked", !0) } }) } function kc() { w.val() != "" && r.find("li").length > 1 && (ei[0].style.visibility = "visible", window.setTimeout(function () { ht.css("display", "none"); vt.css("display", "inherit"); vt.css("float", "right"); b.data("kendoTreeView").expand(".k-item"); ei[0].style.visibility = "hidden" }, 150)) } function dc() { w.val() != "" && (ei[0].style.visibility = "visible", window.setTimeout(function () { ht.css("display", "inherit"); vt.css("display", "none"); ht.css("float", "right"); b.data("kendoTreeView").collapse(".k-item"); ei[0].style.visibility = "hidden" }, 150)) } function gc() { d.is(":checked") ? (i.find("input").prop("checked", !0), i.find("li").addClass("vis-tm-menuselectedcolor"), k.removeClass("vis-tm-delete"), i.find("input:checked").length == 0 && k.addClass("vis-tm-delete")) : (i.find("input").prop("checked", !1), i.find("li").removeClass("vis-tm-menuselectedcolor"), k.addClass("vis-tm-delete")) } function rl(n) { v = o.val(); var r = t(n.currentTarget); nl = r[0].scrollHeight; tl = r.scrollTop(); il = r.outerHeight(); r[0].scrollHeight - r.scrollTop() - 10 == r.outerHeight() - 10 && i.find("li").length > 0 && (rt += 1, ur = !1, ot[0].style.visibility = "visible", bi(yr, e, rt, ft, v, h, n), ot[0].style.visibility = "hidden", i.find("li").length > 0 && (ni.css("display", "none"), ot[0].style.visibility = "hidden")) } function ul() { pt = []; i.find("input:checked").length > 0 && n.ADialog.confirm("DoYouWantToUnlink", !0, "", "Confirm", function (r) { if (r) f[0].style.visibility = "visible", window.setTimeout(function () { for (var r, o = [], u = 0; u < i.find("input:checked").length; u++)(r = t(i.find("input:checked")[u]).parent().find("li").attr("data-id"), ri == "false" && t.inArray(parseInt(r), si) >= 0) || (pt.push(r), o.push(parseInt(r))); bottomchildselectedID = pt; pt = pt.toString(); pt.length > 0 ? rf(e, pt) : (n.ADialog.info("NeverDelete", !0, nu), f[0].style.visibility = "hidden") }, 200); else { f[0].style.visibility = "hidden"; return } }); f[0].style.visibility = "hidden" } function rf(e, o) { var h, s, c; f[0].style.visibility = "visible"; h = n.dataContext.getJSONData(n.Application.contextUrl + "TreeMaintenance/GetTableID", { treeId: e }, null); treeType = n.dataContext.getJSONData(n.Application.contextUrl + "TreeMaintenance/GetTreeType", { treeId: e }, null); s = ""; s = treeType == "PR" ? "AD_TreeNodePR" : treeType == "BP" ? "AD_TreeNodeBP" : treeType == "MM" ? "AD_TreeNodeMM" : "AD_TreeNode"; it = []; c = ""; i.find("input:checked").length > 0 && (o = o.toString(), uf(s, o, e)); i.find("input:checked").length == 0 && uf(s, o, e); t.ajax({ url: n.Application.contextUrl + "TreeMaintenance/DeleteNodeFromBottom", type: "Post", data: { nodeid: o, treeID: e, menuArray: ki }, success: function (e) { var et = JSON.parse(e), ut, w, h, l, v, a, nt, tt, p, rt; if (et == "") { for (d.prop("checked", !1), ut = !0, l = 0; l < i.find("input:checked").length; l++)if (ut = !1, ri != "false" || (p = t(i.find("input:checked").parent().find("li")[l]).attr("data-id"), !(t.inArray(parseInt(p), si) >= 0))) { w = o.toString(); w = w.split(","); h = u.find("li").find("li[data-id='" + w[l] + "']").parent().parent(); h.find("input").prop("disabled", !1); h.find("i").removeClass("vis-tm-opacity"); h.find(".vis-tm-textli").removeClass("vis-tm-opacity"); h.find("span").removeClass("VIS-Tm-glyphiconglyphicon-link"); h.find("input").css("cursor", "pointer"); h.hasClass("vis-tm-menuselectedcolor") && (st.empty(), h.find("input").prop("checked", !0)); g.val() == "Linked" && h.remove(); var ft = t(i.find("input:checked").parent().find(".VIS-tm-MLi")[l]).attr("data-id"), b = t(t(u.find("li"))).find("li[data-id='" + ft + "']").parent().parent().find("img").attr("src"), y = t(t(u.find("li"))).find("li[data-id='" + ft + "']").parent().parent().find("img"), c, s = b; if (s != null) if (s = s.substring(s.lastIndexOf("/") + 1), s == "nonSummary.png") c = n.Application.contextUrl + "Areas/VIS/Images/mWindow.png", y.attr("src", c); else if (s == "summary.png") for (c = n.Application.contextUrl + "Areas/VIS/Images/folder.png", y.attr("src", c), eh(ft), r.data("kendoTreeView").remove(r.find("div").find("div[data-nodeid='" + bottomchildselectedID[l] + "']").parent().parent().parent()), l = 0; l < it.length; l++) { v = it[l]; r.data("kendoTreeView").remove(r.find("div").find("div[data-nodeid='" + v + "']").parent().parent().parent()); t(i.find("input:checked")[l]).parent().remove(); a = t(t(u.find("li"))).find("li[data-id='" + v + "']").parent().parent(); a.find("input").prop("disabled", !1); a.removeClass("vis-tm-menuselectedcolor"); a.find("i").removeClass("vis-tm-opacity"); a.find(".vis-tm-textli").removeClass("vis-tm-opacity"); a.find("span").removeClass("VIS-Tm-glyphiconglyphicon-link"); a.find("input").css("cursor", "pointer"); var b = t(t(u.find("li"))).find("li[data-id='" + v + "']").parent().parent().find("img").attr("src"), y = t(t(u.find("li"))).find("li[data-id='" + v + "']").parent().parent().find("img"), c, s = b; s != null && (s = s.substring(s.lastIndexOf("/") + 1), s == "nonSummary.png" ? c = n.Application.contextUrl + "Areas/VIS/Images/mWindow.png" : s == "summary.png" ? c = n.Application.contextUrl + "Areas/VIS/Images/folder.png" : s == "mWindow.png" ? c = n.Application.contextUrl + "Areas/VIS/Images/mWindow.png" : s == "folder.png" && (c = n.Application.contextUrl + "Areas/VIS/Images/folder.png")); y.attr("src", c) } } if (ut == !0 && i.find("input:checked").length == 0) { h = u.find("li").find("li[data-id='" + it + "']").parent().parent(); h.find("input").prop("disabled", !1); h.find("i").removeClass("vis-tm-opacity"); h.find(".vis-tm-textli").removeClass("vis-tm-opacity"); h.find("span").removeClass("VIS-Tm-glyphiconglyphicon-link"); h.find("input").css("cursor", "pointer"); h.hasClass("vis-tm-menuselectedcolor") && (st.empty(), h.find("input").prop("checked", !0)); g.val() == "Linked" && h.remove(); var b = t(t(u.find("li"))).find("li[data-id='" + it + "']").parent().parent().find("img").attr("src"), y = t(t(u.find("li"))).find("li[data-id='" + it + "']").parent().parent().find("img"), c, s = b; if (s != null) if (s = s.substring(s.lastIndexOf("/") + 1), s == "nonSummary.png") c = n.Application.contextUrl + "Areas/VIS/Images/mWindow.png", y.attr("src", c); else if (s == "summary.png") for (c = n.Application.contextUrl + "Areas/VIS/Images/folder.png", y.attr("src", c), eh(it), r.data("kendoTreeView").remove(r.find("div").find("div[data-nodeid='" + it + "']").parent().parent().parent()), l = 0; l < it.length; l++) { v = it[l]; r.data("kendoTreeView").remove(r.find("div").find("div[data-nodeid='" + v + "']").parent().parent().parent()); t(i.find("input:checked")[l]).parent().remove(); a = t(t(u.find("li"))).find("li[data-id='" + v + "']").parent().parent(); a.find("input").prop("disabled", !1); a.removeClass("vis-tm-menuselectedcolor"); a.find("i").removeClass("vis-tm-opacity"); a.find(".vis-tm-textli").removeClass("vis-tm-opacity"); a.find("span").removeClass("VIS-Tm-glyphiconglyphicon-link"); a.find("input").css("cursor", "pointer"); var b = t(t(u.find("li"))).find("li[data-id='" + v + "']").parent().parent().find("img").attr("src"), y = t(t(u.find("li"))).find("li[data-id='" + v + "']").parent().parent().find("img"), c, s = b; s != null && (s = s.substring(s.lastIndexOf("/") + 1), s == "nonSummary.png" ? c = n.Application.contextUrl + "Areas/VIS/Images/mWindow.png" : s == "summary.png" ? c = n.Application.contextUrl + "Areas/VIS/Images/folder.png" : s == "mWindow.png" ? c = n.Application.contextUrl + "Areas/VIS/Images/mWindow.png" : s == "folder.png" && (c = n.Application.contextUrl + "Areas/VIS/Images/folder.png")); y.attr("src", c) } i.find("li").find("li[data-id='" + it + "']").parent().remove(); r.data("kendoTreeView").remove(r.find("div").find("div[data-nodeid='" + it + "']").parent().parent().parent()) } for (k.addClass("vis-tm-delete"), nt = [], tt = 0; tt < i.find("input:checked").length; tt++)(p = t(i.find("input:checked").parent().find("li")[tt]).attr("data-id"), ri == "false" && t.inArray(parseInt(p), si) >= 0) || nt.push(p); for (rt = 0; rt < nt.length; rt++)i.find("li").find("li[data-id='" + nt[rt] + "']").parent().remove(); i.find("input:checked").length > 0 && n.ADialog.info("NeverDelete"); tf() } tr(); kf(); fu(); f[0].style.visibility = "hidden" }, error: function (n) { console.log(n); f[0].style.visibility = "hidden" } }); tr() } function tr() { i.find("input").length == 0 ? (d.prop("disabled", !0), d.css("cursor", "not-allowed"), d.prop("checked", !1), k.addClass("vis-tm-delete"), kt.addClass("vis-tm-delete"), ii = !1) : (kt.removeClass("vis-tm-delete"), ii = !0, d.prop("disabled", !1), d.css("cursor", "pointer")) } function fl() { var i = "" + n.Msg.getMsg("All") + "", r = "" + n.Msg.getMsg("Linked") + "", u = "" + n.Msg.getMsg("UnLinked") + ""; g.append(t("<Option value='All'>" + i + "<\/option>")); g.append(t("<Option value='Linked'>" + r + "<\/option>")); g.append(t("<Option value='Unlinked'>" + u + "<\/option>")) } function el() { w.val() != "" && (st.empty(), u.empty(), at = g.val(), window.setTimeout(function () { g.prop("disabled", !0); di.css("display", "inherit"); hf = !1; at = g.val(); lt = dt.val(); vi = 1; lr(e, wt, lt, at) }, 200)) } function ol(n, t) { var i = t.size.height; c.css("height", i); c.css("overflow-x", "none"); c.css("width", "100%"); window.setTimeout(function () { ct.height(ti.height() - (c.height() + wr.height() + 45)) }, 200); nt.css("overflow", "hidden"); nt.height(ti.height() - c.height()); a.height(nt.height() - 10); bt.height(i - 10); c.addClass("VIS-TM-resizediv"); bt.addClass("VIS-TM-resizediv") } function ks() { te = t("<div>"); bs = t('<input style="margin-right: 10px;" type="checkbox"/>'); var r = t("<span>" + n.Msg.getMsg("WantToUnlinked") + "<span/>"), i = t('<span style="font-size: 16px;">' + n.Msg.getMsg("UnlinkedWithChild") + "<span/>"); te.append(t('<div style="padding: 10px;">').append(i)) } function sl(i) { ir = i; br(); var r = n.dataContext.getJSONData(n.Application.contextUrl + "TreeMaintenance/GetNodeIdsOfParent", { tbname: nr, parent_id: cu, treeId: e }, null); if (r != null && r.length == 0) { if (yu = !0, s.removeClass("VIS-TM-ondragdrop"), s.css("display", "none"), et.css("display", "none"), ri == "false") { if (t.inArray(parseInt(vu), si) >= 0) { n.ADialog.info("NeverDelete", !0, nu); return } eo(e, vu, cf, yu) } else eo(e, vu, cf, yu); return } f[0].style.visibility = "hidden"; ks(); n.ADialog.confirm("ChildAlsoWillbeRemove", !0, "", "Confirm", function (n) { n ? (yu = !0, eo(e, vu, cf, yu), s.removeClass("VIS-TM-ondragdrop"), s.css("display", "none"), et.css("display", "none")) : (s.removeClass("VIS-TM-ondragdrop"), s.css("display", "none"), et.css("display", "none")) }) } function eo(e, o, s, h) { var a, c, l; o != 0 ? (ds = !1, f[0].style.visibility = "visible", a = n.dataContext.getJSONData(n.Application.contextUrl + "TreeMaintenance/GetTableID", { treeId: e }, null), treeType = n.dataContext.getJSONData(n.Application.contextUrl + "TreeMaintenance/GetTreeType", { treeId: e }, null), c = "", c = treeType == "PR" ? "AD_TreeNodePR" : treeType == "BP" ? "AD_TreeNodeBP" : treeType == "MM" ? "AD_TreeNodeMM" : "AD_TreeNode", pt = o.toString(), uf(c, pt, e), l = n.dataContext.getJSONData(n.Application.contextUrl + "TreeMaintenance/GetParentId", { treeId: e, nodeId: delNodeId, tblName: c }, null), t.ajax({ url: n.Application.contextUrl + "TreeMaintenance/DeleteNodeFromTree", type: "Post", data: { nodeid: o, treeID: e, unlinkchild: h, menuArray: ki }, success: function (e) { var w = JSON.parse(e), p, y, s, tt, nt; if (w == "") { i.find("input:checked").length == 0 && d.prop("checked", !1); sh = w; i.find("li").find("li[data-id='" + o + "']").parent().remove(); s = u.find("li").find("li[data-id='" + o + "']").parent().parent(); s.find("input").prop("disabled", !1); s.find("i").removeClass("vis-tm-opacity"); s.find(".vis-tm-textli").removeClass("vis-tm-opacity"); s.find("span").removeClass("VIS-Tm-glyphiconglyphicon-link"); s.find("input").css("cursor", "pointer"); s.hasClass("vis-tm-menuselectedcolor") && (st.empty(), s.find("input").prop("checked", !0)); var b = t(t(u.find("li"))).find("li[data-id='" + o + "']").parent().parent().find("img").attr("src"), k = t(t(u.find("li"))).find("li[data-id='" + o + "']").parent().parent().find("img"), v, a = b; if (a != null && (a = a.substring(a.lastIndexOf("/") + 1), a == "nonSummary.png" ? v = n.Application.contextUrl + "Areas/VIS/Images/mWindow.png" : a == "summary.png" && (v = n.Application.contextUrl + "Areas/VIS/Images/folder.png"), k.attr("src", v)), gs = c, h == !0) for (ri == "false" && nh(), r.data("kendoTreeView").remove(us), p = 0; p < it.length; p++)if (y = it[p], i.find("li").find("li[data-id='" + y + "']").parent().remove(), ri != "false" || !(t.inArray(parseInt(y), si) >= 0)) { s = u.find("li").find("li[data-id='" + y + "']").parent().parent(); s.find("input").prop("disabled", !1); s.find("i").removeClass("vis-tm-opacity"); s.find(".vis-tm-textli").removeClass("vis-tm-opacity"); s.find("span").removeClass("VIS-Tm-glyphiconglyphicon-link"); s.find("input").css("cursor", "pointer"); s.hasClass("vis-tm-menuselectedcolor") && (s.find("input").prop("checked", !0), st.empty()); g.val() == "Linked" && s.remove(); var b = t(t(u.find("li"))).find("li[data-id='" + y + "']").parent().parent().find("img").attr("src"), k = t(t(u.find("li"))).find("li[data-id='" + y + "']").parent().parent().find("img"), v, a = b; a != null && (a = a.substring(a.lastIndexOf("/") + 1), a == "nonSummary.png" ? v = n.Application.contextUrl + "Areas/VIS/Images/mWindow.png" : a == "summary.png" && (v = n.Application.contextUrl + "Areas/VIS/Images/folder.png"), k.attr("src", v)) } h == !1 && (tt = null, nt = l, li = r.find("div").find("div[data-nodeid='" + nt + "']")); tf() } vo.find("span").hasClass("k-state-selected") && gt.text(n.Msg.getMsg("SelectTree")); tr(); kf(); fu(); f[0].style.visibility = "hidden" }, error: function (n) { console.log(n); f[0].style.visibility = "hidden" } })) : n.ADialog.info("VIS_SelectTreeNode") } function nh() { for (var s, i, f, h, u = [], e = 0; e < ie.length; e++)s = ie[e], u.push(parseInt(s)); for (i = 0; i < u.length; i++)t.inArray(u[i], si) >= 0 && (uc(u[i]), f = r.find("div").find("div[data-nodeid='" + u[i] + "']").parent().parent().parent(), r.find("div").find("div[data-nodeid='" + u[i] + "']").parent().parent().parent().remove(), tt.is(":checked") || (h = r.data("kendoTreeView").append({ text: n.Utility.encodeText(f.text()), IsSummary: f.find(".treechild").attr("data-issummary"), getparentnode: 0, TableName: f.find(".treechild").attr("data-tablename"), NodeID: f.find(".treechild").attr("data-nodeid"), TreeParentID: f.find(".treechild").attr("data-nodeid"), ParentID: 0, ImageSource: "Areas/VIS/Images/mWindow.png" }, t(t(r.find(".treechild")[0]))))); o.val() != "" && window.setTimeout(function () { rr(fe) }, 200) } function uf(i, r, u) { f[0].style.visibility = "visible"; t.ajax({ url: n.Application.contextUrl + "TreeMaintenance/SelectAllChildNodes", type: "Post", async: !1, data: { TableName: i, treeID: u, nodeID: r }, success: function (n) { f[0].style.visibility = "visible"; var t = JSON.parse(n); it = []; t != null && (it = t.split(","), ie = it) }, error: function (n) { console.log(n); f[0].style.visibility = "hidden" } }) } function hl() { w.val() != "" && (u.empty(), lt = dt.val(), at = g.val(), vi = 1, lr(e, wt, lt, at)) } function cl(n) { n.which != 13 && n.which != 8 && n.which != 46 && cr.css("display", "inherit"); (n.which == 8 || n.which == 46) && dt.val() == "" && cr.css("display", "none"); n.which == 13 && w.val() != "" && (u.empty(), lt = dt.val(), at = g.val(), vi = 1, lr(e, wt, lt, at)) } function ll(t) { w.val() != "" && di.css("display", "inherit"); ir = t; w.empty(); is(); tu = !1; re(); kt.addClass("vis-tm-delete"); vt.css("display", "none"); ht.css("display", "inherit"); ht.css("float", "right"); gt.text(n.Msg.getMsg("SelectTree")); tr() } function re() { i.empty(); ls = !1; w.val() != "" && (tt.is(":checked") ? (ui = !0, fi != null && du(wt, e, ar, ui)) : (ui = !1, fi != null && du(wt, e, ar, ui))); nt.css("overflow", "hidden") } function vl(n) { if (wf = !0, n.which == 13) { if (o.val() != "" && tt.is(":checked") && (o.prop("disabled", !0), gi.prop("disabled", !0)), h == "true" && r.find(".k-state-selected").length == 1) { rt = 1; ft = 50; h = y.is(":checked") ? "true" : "false"; var u = r.find(".k-state-selected").find("div").attr("data-nodeid"); v = o.val(); i.empty(); bi(u, e, rt, ft, v, h, n) } o.val() != "" && w.val() != "" && (k.removeClass("vis-tm-delete"), f[0].style.visibility = "visible", b.find("span.k-in").find(".treechild").find("p").each(function () { var r = t(this).text().toUpperCase(), i; if (r == o.val().toUpperCase()) { n.preventDefault(); i = t(this).parent().parent().parent().parent().parent().attr("class"); b.data("kendoTreeView").expand("." + i); b.find("span").removeClass("k-state-selected"); t(this).parent().parent().parent().addClass("k-state-selected"); this.parentNode.parentNode.parentNode.scrollIntoView(); f[0].style.visibility = "hidden"; return } }), uh(n), k.addClass("vis-tm-delete"), f[0].style.visibility = "hidden") } else iu = -1 } function uh(n) { if (tt.is(":checked") && (o.prop("disabled", !0), gi.prop("disabled", !0)), th = ff, ih = o.val(), ue = fh(th, ih, iu), ue > -1) { var t = ef[ue]; currentNode = t; iu = ue; yl(t, n) } else rh = !1, o.val() != "" && (o.prop("disabled", !1), gi.prop("disabled", !1)) } function fh(n, t, i) { for (var r = i + 1; r < n.length; r++)if (r != -1 && n[r].trim().toLowerCase().contains(t.trim().toLowerCase())) return r; return i > -1 ? (i = -1, fh(n, t, i)) : -1 } function yl(n, t) { return n != -1 ? (currentNode = n, pl(n, !0, t)) : (currentNode = 0, !1) } function pl(n, u, f) { y.is(":checked") ? (i.find(".vis-tm-menuselectedcolor").removeClass("vis-tm-menuselectedcolor"), ct.find("li").find("li[id='" + n + "']").parent().find("input").prop("checked", !0), ct.find("li").find("li[id='" + n + "']").parent().addClass("vis-tm-menuselectedcolor"), ct.find("li").find("li[id='" + n + "']").parent().hasClass("vis-tm-menuselectedcolor") && (ct.find("li").find("li[id='" + n + "']").parent()[0].scrollIntoView(), ct.height(nt.height() - (wr.height() + 50)))) : wf == !0 && (r.find(".k-state-selected").removeClass("k-state-selected"), t(r.find("div").find("div[data-nodeid='" + n + "']").parent()).addClass("k-state-selected"), t(r.find("div").find("div[data-nodeid='" + n + "']").parent()).hasClass("k-state-selected") && (t(r.find("div").find("div[data-nodeid='" + n + "']").parent()).addClass("k-state-selected")[0].scrollIntoView(), hu()), window.setTimeout(function () { rt = 1; ft = 50; v = y.is(":checked") ? o.val() : ""; h = y.is(":checked") ? "true" : "false"; var t = r.find("div").find("div[data-nodeid='" + n + "']").parent().text(); gt.text(t); i.empty(); bi(n, e, rt, ft, v, h, f) }, 400)) } function wl(n) { if (o.val() != "" && (o.prop("disabled", !0), gi.prop("disabled", !0)), h == "true" && r.find(".k-state-selected").length == 1) { rt = 1; ft = 50; h = y.is(":checked") ? "true" : "false"; var u = r.find(".k-state-selected").find("div").attr("data-nodeid"); v = o.val(); i.empty(); bi(u, e, rt, ft, v, h, n) } o.val() != "" && (f[0].style.visibility = "visible", b.find("span.k-in").find(".treechild").find("p").each(function () { var r = t(this).text().toUpperCase(), i; r == o.val().toUpperCase() && (n.preventDefault(), i = t(this).parent().parent().parent().parent().parent().attr("class"), b.data("kendoTreeView").expand("." + i), b.find("span").removeClass("k-state-selected"), t(this).parent().parent().parent().addClass("k-state-selected"), this.parentNode.parentNode.parentNode.scrollIntoView()) }), uh(n), f[0].style.visibility = "hidden") } function rr(u) { var f, e; if (w.val() != "" && (wi.css("display", "inherit"), oo == !0 && (oo = !1, fe = u)), w.val() == "") return !1; if (t(o).val() == "" || !vf) { t(o).val() == "" && (i.find("span").removeClass("VIS-TM-highlight"), r.find("span").removeClass("VIS-TM-highlight"), wi.css("display", "none"), wf = !0, oo = !0); vf = !0; return } if (u != undefined && u.which != 13) if (f = o.val().toUpperCase(), e = f.length, y.is(":checked")) iu = -1, ef = [], ff = [], r.find("span").removeClass("VIS-TM-highlight"), i.find("li li").each(function (r, u) { var c = t(u), s = n.Utility.decodeText(t(this).text()), h, o; if (ef.push(c.attr("id")), ff.push(s), h = "", o = 0, f == "") s.toUpperCase().indexOf(f, o) == 0 && (t(this).find("span").removeClass("VIS-TM-highlight"), i.find(".vis-tm-menuselectedcolor").removeClass("vis-tm-menuselectedcolor"), k.addClass("vis-tm-delete"), i.find("input").prop("checked", !1)); else { while ((p = s.toUpperCase().indexOf(f, o)) >= 0) h += s.substring(o, p) + '<span class="VIS-TM-highlight">' + s.substr(p, e) + "<\/span>", o = p + e; s.toUpperCase().indexOf(f, o) == -1 && t(this).find("span").removeClass("VIS-TM-highlight"); o > 0 && (h += s.substring(o)) } }); else { if (ef = [], ff = [], i.find("li").find("span").removeClass("VIS-TM-highlight"), b.data("kendoTreeView").expand(".k-item"), ht.css("display", "none"), vt.css("display", "inherit"), t(o).val() == "" && b.find("span").removeClass("VIS-TM-highlight"), t("span.k-in > span.highlight").each(function () { t(this).parent().text(t(this).parent().text()) }), t.trim(o.val()) == "") return; f = o.val().toUpperCase(); e = f.length; b.find("span.k-in").each(function (i, r) { var h = t(r), o = n.Utility.decodeText(t(this).text()), s, u; for (ef.push(h.find(".treechild").attr("data-nodeid")), ff.push(o), s = "", u = 0; (p = o.toUpperCase().indexOf(f, u)) >= 0;)s += o.substring(u, p) + '<span class="VIS-TM-highlight">' + o.substr(p, e) + "<\/span>", u = p + e; o.toUpperCase().indexOf(f, u) == -1 && t(this).find("span").removeClass("VIS-TM-highlight"); u > 0 && (s += o.substring(u), t(this).find("p").html(s)) }) } } function hu() { r.find(".k-state-hover").removeClass("k-state-hover"); r.find(".vis-tm-selectedkendoNode").removeClass("vis-tm-selectedkendoNode"); r.find(".k-state-selected").find("p").addClass("vis-tm-selectedkendoNode") } function bl(n) { var r, u; t(n.target).hasClass("summNonsumImage") && (t(n.target).parent().parent().find("li").removeClass("vis-tm-menuselectedcolor"), t(n.target).parent().parent().find("input").prop("checked", !1), t(n.target).parent().addClass("vis-tm-menuselectedcolor"), t(n.target).parent().find("input").prop("checked", !0), k.removeClass("vis-tm-delete"), r = i.find("input").length, u = i.find("input:checked").length, r == u && d.prop("checked", !0)); t(n.target).hasClass("VIS-tm-MLi") && (t(this).find("li").removeClass("vis-tm-menuselectedcolor"), t(this).find("li").find("input").prop("checked", !1), t(n.target).parent().addClass("vis-tm-menuselectedcolor"), t(n.target).parent().find("input").prop("checked", !0), k.removeClass("vis-tm-delete"), d.prop("checked", !1), r = i.find("input").length, u = i.find("input:checked").length, r == u && d.prop("checked", !0)); t(n.target).hasClass("VIS-tm-checkbox") && (t(n.target).parent().find("input").prop("checked") ? (t(n.target).parent().addClass("vis-tm-menuselectedcolor"), k.removeClass("vis-tm-delete"), r = i.find("input").length, u = i.find("input:checked").length, r == u && d.prop("checked", !0)) : (t(n.target).parent().removeClass("vis-tm-menuselectedcolor"), t(n.target).parent().find("li").removeClass("vis-tm-menuselectedcolor"), d.prop("checked", !1), i.find("input:checked").length > 0 ? k.removeClass("vis-tm-delete") : k.addClass("vis-tm-delete"))) } function ee(n) { ir = n; var t = u.find("input:checked").length, i = u.find("[disabled]").length, r = u.find("input").length, f = r - i; t == f ? n != "disabled" && ut.prop("checked", !0) : ut.prop("checked", !1) } function sf() { } function kl(s) { var p, l, a, c; if (ir = s, p = u, f[0].style.visibility = "visible", u.find("input:checked").length > 1 && st.empty(), t(s.target).hasClass("VIS-Tm-glyphiconglyphicon-link")) { pt = []; l = t(s.target).parent(); a = t(s.target).parent().attr("id"); pt.push(a); pt = pt.toString(); window.setTimeout(function () { ir = s }, 200); ri == "false" ? t.inArray(parseInt(a), si) < 0 ? oh(e, pt, l) : (n.ADialog.info("NeverDelete", !0, nu), f[0].style.visibility = "hidden") : oh(e, pt, l); return } if (t(s.target).hasClass("vis-tm-textli") && (t(this).find("input").prop("checked", !1), t(this).find("li").removeClass("vis-tm-menuselectedcolor"), t(s.target).parent().parent().addClass("vis-tm-menuselectedcolor"), t(t(s.target).parent().parent()).find("input").prop("checked", !0), hi = t(t(s.target).parent().parent()).find("img").attr("src"), s.target.id = t(s.target).attr("id"), t(s.target).parent().parent().find("input").attr("disabled") == "disabled" && t(t(s.target).parent().parent()).find("input").prop("checked", !1), ut.prop("checked", !1), ee(t(s.target).parent().parent().find("input").attr("disabled")), wu && sf(t(s.target).parent().parent())), t(s.target).hasClass("vis-tm-upperLi") && (t(s.target).parent().find("li").removeClass("vis-tm-menuselectedcolor"), t(s.target).addClass("vis-tm-menuselectedcolor"), t(s.target).parent().find("input").prop("checked", !1), t(s.target).find("input").prop("checked", !0), hi = t(s.target).find("img").attr("src"), s.target.id = t(s.target).find(".vis-tm-textli").attr("id"), t(s.target).find("input").attr("disabled") == "disabled" && t(s.target).find("input").prop("checked", !1), ut.prop("checked", !1), ee(t(s.target).find("input").attr("disabled")), wu && sf(t(s.target))), t(s.target).hasClass("vis-tm-upperdivchkandimg") && (t(s.target).parent().parent().find("li").removeClass("vis-tm-menuselectedcolor"), t(s.target).parent().addClass("vis-tm-menuselectedcolor"), t(s.target).parent().parent().find("input").prop("checked", !1), t(s.target).find("input").prop("checked", !0), hi = t(s.target).find("img").attr("src"), s.target.id = t(s.target).parent().find(".vis-tm-textli").attr("id"), t(s.target).find("input").attr("disabled") == "disabled" && t(s.target).find("input").prop("checked", !1), ut.prop("checked", !1), ee(t(s.target).find("input").attr("disabled")), wu && sf(t(s.target).parent().parent())), t(s.target).hasClass("vis-tm-chkbox")) { if (f[0].style.visibility = "visible", t(s.target).attr("disabled") != "disabled") if (t(s.target).prop("checked")) { for (t(s.target).parent().parent().addClass("vis-tm-menuselectedcolor"), s.target.id = s.target.id = t(s.target).parent().parent().find(".vis-tm-textli").attr("id"), hi = t(s.target).parent().parent().find("img").attr("src"), c = 0; c < u.find(".vis-tm-menuselectedcolor").length; c++)t(u.find(".vis-tm-menuselectedcolor").find("input")[c]).attr("disabled") == "disabled" && t(u.find(".vis-tm-menuselectedcolor").find("input")[c]).parent().parent().removeClass("vis-tm-menuselectedcolor"); var w = u.find("input:checked").length, k = u.find("[disabled]").length, g = u.find("input").length, nt = g - k; w == nt ? ut.prop("checked", !0) : ut.prop("checked", !1) } else t(s.target).parent().parent().removeClass("vis-tm-menuselectedcolor"), hi = t(s.target).parent().parent().find("img").attr("src"), s.target.id = 0, ut.prop("checked", !1); f[0].style.visibility = "hidden"; wu && sf(t(s.target).parent().parent()) } t(s.target).hasClass("summNonsumImage") && (t(s.target).parent().parent().parent().find("li").removeClass("vis-tm-menuselectedcolor"), t(s.target).parent().parent().addClass("vis-tm-menuselectedcolor"), t(s.target).parent().parent().parent().find("input").prop("checked", !1), t(s.target).parent().find("input").prop("checked", !0), hi = t(s.target).parent().find("img").attr("src"), s.target.id = t(s.target).parent().parent().find(".vis-tm-textli").attr("id"), t(s.target).parent().find("input").attr("disabled") == "disabled" && t(s.target).parent().find("input").prop("checked", !1), ut.prop("checked", !1), ee(t(s.target).parent().find("input").attr("disabled")), wu && sf(t(s.target).parent())); (s.target.id == "" || s.target.id == "undefined") && (s.target.id = t(s.target).find(".vis-tm-menuselectedcolor").find("li").attr("id")); u.find(".vis-tm-menuselectedcolor").length == 1 && u.find(".vis-tm-menuselectedcolor").find("li").hasClass("vis-tm-opacity") && s.target.id != "" ? t.ajax({ url: n.Application.contextUrl + "TreeMaintenance/GetNodePath", type: "Post", data: { node_ID: s.target.id, treeID: e }, success: function (c) { var k, nt, p, w, g, l, a; ut.prop("checked", !1); k = JSON.parse(c); k = k.replaceAll("\\\\", " \\ "); st.empty(); st.append(n.Utility.encodeText(k)); ai.is(":checked") && (d.prop("checked", !1), nt = t(s.target).parent().parent().find("li").attr("id"), p = t(s.target).parent().parent().find("img").attr("src"), p = p.substring(p.lastIndexOf("/") + 1), p == "summary.png" && (w = t(s.target).text(), w = w.substring(0, w.lastIndexOf("(")), gt.text(w), of = -1), hi.lastIndexOf("/"), hi = hi.substring(hi.lastIndexOf("/") + 1), hi != "mWindow.png" && hi != "folder.png" && (tt.is(":checked") ? ai.is(":checked") && (f[0].style.visibility = "visible", hi != "nonSummary.png" ? b.data("kendoTreeView").expand(".k-item") : (br(), g = n.dataContext.getJSONData(n.Application.contextUrl + "TreeMaintenance/GetParentId", { treeId: e, nodeId: s.target.id, tblName: nr }, null), g != null && g > 0 && (l = g, l == null && (l = 0), of != l && (b.data("kendoTreeView").expand(".k-item"), window.setTimeout(function () { t(r.find(".k-state-selected")).removeClass("k-state-selected"); t(r.find("div").find("div[data-nodeid='" + l + "']").parent()).addClass("k-state-selected")[0].scrollIntoView(); var n = t(r.find(".k-state-selected")).text(); gt.text(n); of = l; hu() }, 200), i.empty(), rt = 1, ft = 50, v = o.val(), h = y.is(":checked") ? "true" : "false", bi(l, e, rt, ft, v, h, s), of = l))), f[0].style.visibility = "hidden") : b.data("kendoTreeView").expand(".k-item")), t(r.find("div").find("div[data-nodeid='" + s.target.id + "']").parent()).addClass("k-state-selected").length != 0 ? (t(r.find(".k-state-selected")).removeClass("k-state-selected"), t(r.find(".k-state-focused")).removeClass("k-state-focused"), window.setTimeout(function () { t(r.find("div").find("div[data-nodeid='" + s.target.id + "']").parent()).addClass("k-state-selected")[0].scrollIntoView(); hu() }, 200), i.empty(), rt = 1, ft = 50, v = o.val(), h = y.is(":checked") ? "true" : "false", bi(s.target.id, e, rt, ft, v, h, s)) : u.find(".vis-tm-menuselectedcolor").length == 1 && (a = u.find(".vis-tm-menuselectedcolor").find("img").attr("src"), a = a.substring(a.lastIndexOf("/") + 1), a != "nonSummary.png" && a != "summary.png" && st.empty())); f[0].style.visibility = "hidden" }, error: function (n) { console.log(n); f[0].style.visibility = "hidden" } }) : st.empty(); f[0].style.visibility = "hidden" } function eh(n) { var i = r.find("div").find("div[data-nodeid='" + n + "']").parent().parent().parent(); i.children("ul").length > 0 && (pu = t(t(i.children("ul")[0]).find("ul")[0]).length > 0 ? t(t(t(i.children("ul")[0]).find("ul")[0]).find("ul")[0]).length > 0 ? t(t(t(t(i.children("ul")[0]).find("ul")[0]).find("ul")[0]).find("ul")[0]).length > 0 ? t(t(t(t(t(i.children("ul")[0]).find("ul")[0]).find("ul")[0]).find("ul")[0]).find("ul")[0]).length > 0 ? !0 : !1 : !1 : !1 : !1) } function oh(e, o) { var s, h; f[0].style.visibility = "visible"; treeType = n.dataContext.getJSONData(n.Application.contextUrl + "TreeMaintenance/GetTreeType", { treeId: e }, null); s = ""; s = treeType == "PR" ? "AD_TreeNodePR" : treeType == "BP" ? "AD_TreeNodeBP" : treeType == "MM" ? "AD_TreeNodeMM" : "AD_TreeNode"; h = n.dataContext.getJSONData(n.Application.contextUrl + "TreeMaintenance/GetNodeIdsOfParent", { tbname: s, parent_id: o, treeId: e }, null); h != null && h.length > 0 ? n.ADialog.confirm("ChildAlsoWillbeRemove", !0, "", "Confirm", function (h) { if (h) o = o.toString(), uf(s, o, e), t.ajax({ url: n.Application.contextUrl + "TreeMaintenance/DeleteNodeFromBottom", type: "Post", data: { nodeid: o, treeID: e, menuArray: ki }, success: function (e) { var w = JSON.parse(e), c, v, a, h; if (w == "") { for (i.find("input:checked").length == 0 && d.prop("checked", !1), st.empty(), c = u.find("li").find("li[data-id='" + o + "']").parent().parent(), c.find("input").prop("disabled", !1), c.find("i").removeClass("vis-tm-opacity"), c.find(".vis-tm-textli").removeClass("vis-tm-opacity"), c.find("span").removeClass("VIS-Tm-glyphiconglyphicon-link"), c.find("input").css("cursor", "pointer"), c.hasClass("vis-tm-menuselectedcolor") && (st.empty(), c.find("input").prop("checked", !0)), ri == "false" && nh(), r.data("kendoTreeView").remove(r.find("div").find("div[data-nodeid='" + o + "']").parent().parent().parent()), i.find("li").find("li[data-id='" + o + "']").parent().remove(), v = 0; v < it.length; v++)if (a = it[v], i.find("li").find("li[data-id='" + a + "']").parent().remove(), ri != "false" || !(t.inArray(parseInt(a), si) >= 0)) { h = u.find("li").find("li[data-id='" + a + "']").parent().parent(); h.find("input").prop("disabled", !1); h.find("i").removeClass("vis-tm-opacity"); h.find(".vis-tm-textli").removeClass("vis-tm-opacity"); h.find("span").removeClass("VIS-Tm-glyphiconglyphicon-link"); h.find("input").css("cursor", "pointer"); h.hasClass("vis-tm-menuselectedcolor") && (st.empty(), h.find("input").prop("checked", !0)); g.val() == "Linked" && h.remove(); var y = u.find("li").find("li[data-id='" + a + "']").parent().parent().find("img").attr("src"), p = u.find("li").find("li[data-id='" + a + "']").parent().parent().find("img"), l, s = y; s != null && (s = s.substring(s.lastIndexOf("/") + 1), s == "nonSummary.png" ? l = n.Application.contextUrl + "Areas/VIS/Images/mWindow.png" : s == "summary.png" && (l = n.Application.contextUrl + "Areas/VIS/Images/folder.png"), p.attr("src", l)) } var y = u.find("li").find("li[data-id='" + o + "']").parent().parent().find("img").attr("src"), p = u.find("li").find("li[data-id='" + o + "']").parent().parent().find("img"), l, s = y; s != null && (s = s.substring(s.lastIndexOf("/") + 1), s == "nonSummary.png" ? l = n.Application.contextUrl + "Areas/VIS/Images/mWindow.png" : s == "summary.png" ? l = n.Application.contextUrl + "Areas/VIS/Images/folder.png" : s == "folder.png" ? l = n.Application.contextUrl + "Areas/VIS/Images/folder.png" : s == "mWindow.png" && (l = n.Application.contextUrl + "Areas/VIS/Images/mWindow.png"), p.attr("src", l)); i.find("li").length != 0 || r.find("span").hasClass("k-state-selected") || gt.text(n.Msg.getMsg("SelectTree")); tf() } tr(); kf(); fu(); f[0].style.visibility = "hidden" }, error: function (n) { console.log(n); f[0].style.visibility = "hidden" } }); else { f[0].style.visibility = "hidden"; return } }) : (o = o.toString(), uf(s, o, e), t.ajax({ url: n.Application.contextUrl + "TreeMaintenance/DeleteNodeFromBottom", type: "Post", data: { nodeid: o, treeID: e, menuArray: ki }, success: function (e) { var w = JSON.parse(e), h, v, a, c; if (w == "") { for (st.empty(), h = u.find("li").find("li[data-id='" + o + "']").parent().parent(), h.find("input").prop("disabled", !1), h.find("i").removeClass("vis-tm-opacity"), h.find(".vis-tm-textli").removeClass("vis-tm-opacity"), h.find("span").removeClass("VIS-Tm-glyphiconglyphicon-link"), h.find("input").css("cursor", "pointer"), r.data("kendoTreeView").remove(r.find("div").find("div[data-nodeid='" + o + "']").parent().parent().parent()), i.find("li").find("li[data-id='" + o + "']").parent().remove(), v = 0; v < it.length; v++)if (a = it[v], ri != "false" || !(t.inArray(parseInt(a), si) >= 0)) { c = u.find("li").find("li[data-id='" + a + "']").parent().parent(); c.find("input").prop("disabled", !1); c.find("i").removeClass("vis-tm-opacity"); c.find(".vis-tm-textli").removeClass("vis-tm-opacity"); c.removeClass("vis-tm-menuselectedcolor"); g.val() == "Linked" && c.remove(); var y = u.find("li").find("li[data-id='" + a + "']").parent().parent().find("img").attr("src"), p = u.find("li").find("li[data-id='" + a + "']").parent().parent().find("img"), l, s = y; s != null && (s = s.substring(s.lastIndexOf("/") + 1), s == "nonSummary.png" ? l = n.Application.contextUrl + "Areas/VIS/Images/mWindow.png" : s == "summary.png" && (l = n.Application.contextUrl + "Areas/VIS/Images/folder.png"), p.attr("src", l)) } var y = u.find("li").find("li[data-id='" + o + "']").parent().parent().find("img").attr("src"), p = u.find("li").find("li[data-id='" + o + "']").parent().parent().find("img"), l, s = y; s != null && (s = s.substring(s.lastIndexOf("/") + 1), s == "nonSummary.png" ? l = n.Application.contextUrl + "Areas/VIS/Images/mWindow.png" : s == "summary.png" && (l = n.Application.contextUrl + "Areas/VIS/Images/folder.png"), p.attr("src", l)); tf() } i.find("li").length != 0 || r.find("span").hasClass("k-state-selected") || gt.text(n.Msg.getMsg("SelectTree")); tr(); kf(); fu(); f[0].style.visibility = "hidden" }, error: function (n) { console.log(n); f[0].style.visibility = "hidden" } })) } function gl() { br(); var t = ""; t = n.dataContext.getJSONData(n.Application.contextUrl + "TreeMaintenance/GetRestrictionCount", { treeId: e, tableTreeName: nr }, null); t > 5e3 ? (tt.prop("checked", !0), tt.prop("disabled", !0), ot[0].style.visibility = "hidden", ui = !0, so = !0, pr.css("display", "inherit"), nt.css("display", "inherit"), c.css("height", "70%"), bt.css("height", "100%"), c.resizable({ handles: "n,s,se" }), c.find(".ui-resizable-e").css("right", "0px"), c.find(".ui-resizable-s").css("bottom", "0px"), bt.addClass("VIS-TM-resizediv"), nt.height(ti.height() - c.height() - 20), wi.css("right", "145px")) : (tt.prop("disabled", !1), so = !1) } function na() { if (ls = !1, yf = !0, tu = !1, pf = !1, w.val() != "") { ei[0].style.visibility = "visible"; af.removeClass("vis-tm-opacity"); tt.prop("disabled", !1); di.css("display", "inherit"); g.prop("disabled", !0); ai.prop("disabled", !1); ai.css("cursor", "pointer"); y.prop("disabled", !1); y.css("cursor", "pointer"); o.prop("disabled", !1); dt.prop("disabled", !1); ut.prop("disabled", !1); ut.css("cursor", "pointer"); kt.addClass("vis-tm-delete"); vt.css("display", "none"); ht.css("display", "inherit"); k.addClass("vis-tm-delete"); ur = !0; hf = !0; u.empty(); i.empty(); lt = ""; dt.val(""); o.val(""); ni.css("display", "inherit"); he = 50; vi = 1; g.val(t(g.find("option")[0]).attr("value")); var r = w.find("option:selected").text(); bu.text(n.Msg.getMsg("AllItems")); gt.text(r); fi = w.find("option:selected"); wt = fi.attr("data-type"); e = fi.val(); ar = fi.attr("data-isallnodes"); window.setTimeout(function () { du(wt, e, ar, ui) }, 100); window.setTimeout(function () { u.empty(); at = "All"; vi = 1; lr(e, wt, lt, at); gr(); io() }, 200); ta(); tt.is(":checked") ? (ui = !0, nt.css("display", "inherit"), c.css("height", "70%"), bt.css("height", "100%"), c.resizable({}), c.find(".ui-resizable-e").css("right", "0px"), c.find(".ui-resizable-s").css("bottom", "0px"), bt.addClass("VIS-TM-resizediv"), nt.height(ti.height() - c.height() - 20), ct.height(ti.height() - (c.height() + wr.height() + 40)), pr.css("display", "inherit")) : (pr.css("display", "none"), ui = !1, nt.css("display", "none"), c.css("height", "100%"), bt.css("height", "100%"), c.resizable("destroy"), bt.removeClass("VIS-TM-resizediv"), nt.height(ti.height() - c.height())) } else af.addClass("vis-tm-opacity"), tt.prop("disabled", !0), tt.prop("checked", !0), di.css("display", "none"), e = 0, u.empty(), i.empty(), b.data("kendoTreeView").destroy(), b.empty(), st.empty(), lt = "", dt.val(""), fi = null, k.addClass("vis-tm-delete"), o.val(""), window.setTimeout(function () { u.empty() }, 200), bu.text(n.Msg.getMsg("SelectTree")), gt.text(n.Msg.getMsg("SelectTree")), ni.css("display", "none"), kt.addClass("vis-tm-delete"), y.prop("disabled", !0), ai.prop("disabled", !0), y.css("cursor", "not-allowed"), ai.css("cursor", "not-allowed"), o.prop("disabled", !0), dt.prop("disabled", !0), g.prop("disabled", !0), ut.prop("disabled", !0), ut.css("cursor", "not-allowed"), cr.css("display", "none"), wi.css("display", "none"); ai.prop("checked", !1); ut.prop("checked", !1); y.prop("checked", !1); u.empty(); d.prop("checked", !1); tr() } function ta() { bt.height(c.height() - 10) } function ia(n) { var i = t(n.currentTarget); i[0].scrollHeight - i.scrollTop() == i.outerHeight() && u.find("li").length > 0 && (at = g.val(), hf = !1, le = !0, vi += 1, lr(e, wt, lt, at)) } function ra(n) { w.val() != "" && (i.empty(), tt.is(":checked") ? (ot[0].style.visibility = "hidden", ui = !0, pr.css("display", "inherit"), nt.css("display", "inherit"), c.css("height", "70%"), bt.css("height", "100%"), c.resizable({ handles: "n,s,se" }), c.find(".ui-resizable-e").css("right", "0px"), c.find(".ui-resizable-s").css("bottom", "0px"), bt.addClass("VIS-TM-resizediv"), fi != null && du(wt, e, ar, ui), nt.height(ti.height() - c.height() - 20), wi.css("right", "145px")) : (yh(), o.val() != "" && y.prop("checked", !1), wi.css("right", "35px")), vt.css("display", "none"), ht.css("display", "inherit"), tr(), window.setTimeout(function () { o.val() != "" && window.setTimeout(function () { rr(n) }, 200) }, 200), iu = -1, tu = !1) } function ua() { f = t('<div class="vis-busyindicatorouterwrap"><div class="vis-busyindicatorinnerwrap"><i class="vis-busyindicatordiv"><\/i><\/div><\/div>'); f[0].style.visibility = "visible"; oe.append(f) } function fa() { var n = null; n = t('<div style="position: relative; width: 100%; height: 100%; z-index: -1;">'); ot = t('<div class="vis-busyindicatorouterwrap"><div class="vis-busyindicatorinnerwrap"><i class="vis-busyindicatordiv"><\/i><\/div><\/div>'); n[0].style.visibility = "visible"; n.append(ot); nt.append(n) } function ea() { yi = t('<div class="vis-busyindicatorouterwrap"><div class="vis-busyindicatorinnerwrap"><i class="vis-busyindicatordiv"><\/i><\/div><\/div>'); yi[0].style.visibility = "visible"; ku.append(yi) } function oa() { ei = t('<div class="vis-busyindicatorouterwrap"><div class="vis-busyindicatorinnerwrap"><i class="vis-busyindicatordiv"><\/i><\/div><\/div>'); ei[0].style.visibility = "visible"; c.append(ei) } var s, et, wi, kt, sr, ti, hr, to, cr, uu, oi, fr, vf, yf, gu, ii, nf, nr, ou, kr, dr, pf, nc, su, tc, bf, df, pt, te, bs, ds, gs, ie, it, al, iu, th, ih, ue, rh, dl, so, hf; this.frame; this.windowNo; var sa = this, oe = t('<div class="vis-forms-container" style="padding:3px 0 7px;background-color:white;height:100%"/>'), b, ui = !0, fi, wt, e, ar, ho = "", se = 0, co, he = 50, vi = 1, l, ci = [], ru = [], vr = !0, lo = null, cu, yr = 0, f = null, ot = null, yi = null, ei = null, ur = !0, lu = !0, au, ao, vo = null, pi = null, lt = "", sh = null, yo = !0, v = null, rt = 1, ft = 50, ce = 0, vu = 0, cf = null, yu = !1, li = null, pu = !1, at = "All", le = !1, or = !0, po = n.Application.contextUrl, ha = po + "JsonData/JDataSet", ca = po + "JsonData/ExecuteNonQuer", ae = t("<div  class='VIS-TM-left-tree'>"), hh = t("<div  class='VIS-TM-middle'>"), ve = t("<div class='VIS-TM-right-slide'>"), ye = !1, pe = t('<div class="VIS-TM-data-head" style="padding-top: 8px;">'), wo = t('<div class="VIS-TM-data">'), tt = t('<input disabled type="checkbox" checked="true" />'), bo = t("<span>" + n.Msg.getMsg("OnlySummaryLevel") + "<span/>"), ko = t("<h4>" + n.Msg.getMsg("SelectTree") + "<\/h4>"), wu = /ipad|iphone|ipod/i.test(navigator.userAgent.toLowerCase()); pe.append(ko).append(wo.append(tt).append(bo)); var we = t('<div class="VIS-TM-treeCombo">'), w = t("<select><\/select>"), be = t('<span style="display:none" class="VIS-Tm-btnicon vis vis-refresh"  title=' + n.Msg.getMsg("RefreshSelectTree") + "><\/span>"), ke = t('<span class="VIS-Tm-btnicon vis vis-refresh" style="float:left" title="' + n.Msg.getMsg("tmRefresh") + '"><\/span>'), vt = t('<span class="VIS-Tm-btnicon fa fa-minus-square-o"  style="display:none;" title="' + n.Msg.getMsg("TreeCollapse") + '" ><\/span>'), ht = t('<span class="VIS-Tm-btnicon fa fa-plus-square-o" title="' + n.Msg.getMsg("TreeExpand") + '" ><\/span>'), go = t("<i class='vis vis-find VIS-Tm-btnicon' title='" + n.Msg.getMsg("CreateNewTree") + "'><\/i>"), di = t('<div class="vis-tm-treeCmbDisable "><\/div>'); we.append(di).append(w).append(go).append(ke).append(vt).append(ht); var c = t('<div class="VIS-TM-tree-wrap">'), r = t('<div class="VIS-TM-root-node" style="overflow:visible">'), bt = t('<div class="vis-tm-topTreeDiv">'); c.resizable({ handles: "n,s,se" }); s = t('<div style="z-index:9;width:28px;display:none;text-align:center;float: right; height: 95%; position: absolute; right: 5px;"><\/div>'); et = t('<span class="VIS-Tm-deletetreenode" style="margin:auto;display:none;position: relative;top: 50%;"><\/span>'); s.append(et); bt.append(be).append(s).append(r); c.append(bt); var de = t("<div class='VIS-TM-tree-search'>"), o = t("<input disabled placeholder='" + n.Msg.getMsg("Search") + "' type='search'>"), gi = t('<span class="VIS-Tm-btnicon vis vis-search"><\/span>'), pr = t('<div class="vis-tm-b-s-ryt">'), y = t('<input type="checkbox" disabled>'), ch = t('<label style="font-weight: normal;margin-bottom:0px">' + n.Msg.getMsg("NodeItem") + "<\/label>"); pr.append(y).append(ch); wi = t('<span class="vis-tmlinkdel-icon"><\/span>'); de.append(o).append(wi).append(pr).append(gi); var wr = t("<div class='VIS-TM-data-headMID'>"), k = t("<span style='display:inherit;' class='VIS-Tm-unlinkforbottmo vis vis-link ' title='" + n.Msg.getMsg("UnlinkNode") + "' ><\/span>"), gt = t('<h4 style="float:left">' + n.Msg.getMsg("SelectTree") + "<\/h4>"), ct = t("<div class='VIS-TM-dataWrap' style='padding-top:0px' >"), ni = t('<span class="VIS-TM-recordeNotFound">' + n.Msg.getMsg("TMRecordNotFound") + "<\/span>"), i = t('<ul class="vis-tm-sortable" style="list-style: none;padding:0">'), d = t('<input type="checkbox" disabled />'), lh = t('<span class="vis vis-search" style="display:none;cursor:pointer;float:left;margin: 14px 0 0 6px;font-size: 10px;" ><\/span>'); ct.append(i).append(ni); kt = t('<span style="display:inherit;" class="vis-tm-childnodeinidailog" title="' + n.Msg.getMsg("SetOrder") + '">Set Order<\/span>'); kt.addClass("vis-tm-delete"); sr = t('<div style="display:none;position:absolute;height: 40.2px;width: 100%; z-index: 5;"><\/div>'); wr.append(sr).append(d).append(gt).append(lh).append(kt).append(k); var ge = t("<div class='VIS-TM-data-head'>"), bu = t("<h4>" + n.Msg.getMsg("AllItems") + "<\/h4>"), ku = t("<div class='VIS-TM-dataWrap'>"), lf = t("<div class='VIS-TM-treeList'>"), u = t("<ul style='list-style: none' class='scrolldrag' >"), dt = t("<input disabled placeholder='" + n.Msg.getMsg("Search") + "' type='search'>"), ns = t('<span class="VIS-Tm-btnicon vis vis-search" style="top:0px;float:none"><\/span>'), ts = t("<div class='VIS-TM-path'>"), st = t("<i style='font-weight:600'>"), g = t('<select disabled style="float: right; min-width: 100px"><\/select>'), ah = t('<span style="margin: 0 7px;">' + n.Msg.getMsg("Show") + "<span/>"), ai = t('<input type="checkbox"  style="float:left;margin-right:5px" disabled  />'), vh = t("<span>" + n.Msg.getMsg("TraceItem") + "<span/>"), ut = t('<input type="checkbox" disabled />'), af = t('<span class="vis-unlinkallNodes vis-tm-opacity" title="' + n.Msg.getMsg("UnlinkItem") + '"  ><b><\/b><b><\/b><b><\/b><\/span>'); ge.append(ut).append(bu).append(t('<div class="vis-tm-r-list-w">').append(ah).append(g).append(af)); var a = t('<div class="vis-tm-nodeItemDeleteliketopdiv"><span class="VIS-Tm-deletetreenode vis-tm-nodeItemDeletespans" ><\/span><\/div>'), nt = t('<div style="float:left;width:100%;">'), no = t('<div style="z-index:999;height:100%;display:none;position:absolute; left:0; right:0; top:0; bottom:0;"><\/div>'); nt.append(no).append(wr).append(ct).append(a); ti = t('<div class="VIS-TM-leftMianDataDiv">'); ti.append(c).append(nt); hr = t('<div style="display:none;height: 100%; width: 100%; position: absolute;z-index: 9999;"><\/div>'); ae.append(hr).append(t('<div style="height:100%;" >').append(pe).append(we).append(ti).append(de)); to = t('<div class="VIS-TM-Righttree-search" >'); cr = t('<span class="vis-tmlinkdel-icon"><\/span>'); to.append(dt).append(cr).append(ns); uu = t('<span class="VIS-TM-recordeNotFound" style="margin-top:50%" >' + n.Msg.getMsg("TMRecordNotFound") + "<\/span>"); oi = t('<div style="z-index:999;height:100%;display:none;position:absolute; left:0; right:0; top:0; bottom:0;"><\/div>'); ku.append(oi).append(to).append(lf.append(u).append(uu)).append(ts.append(st)); ve.append(t('<div  style="height:100%">').append(ge).append(ku)); oe.append(ae).append(ve); fr = !1; vf = !0; yf = !0; var er = null, us = null, fs = t('<div class="vis-tm-unlinkimgss">'); gu = 0; ii = !1; var eu = null; nf = null; nr = null; ou = []; kr = !1; dr = null; pf = null; nc = !0; su = !0; tc = null; var h = !1, ls = !1, wf = !1; var ki = [], ri = "true", si = null, nu = null; bf = null; df = !0; var gf = 1, uo = 50, tu = !1, fo = 0; var yt = t("<ul style='padding:0;list-style: none'>"), vs = t("<div>"), ys = t('<div style="padding: 10px;height:425px;overflow:auto">'); var ws = null, wc = null, ne = !0; var nl = 0, tl = 0, il = 0; pt = []; te = null; bs = null; ds = !0; gs = null; ie = ""; it = []; al = 0; iu = -1; rh = !0; var ff = [], ef = [], ir = null, oo = !0, fe = null; var hi = null, of = -1; dl = !0; so = null; hf = !0; this.Initialize = function () { ua(); ea(); oa(); fa(); is(); ic(); window.setTimeout(function () { f[0].style.visibility = "hidden" }, 200); f[0].style.visibility = "visible"; yi[0].style.visibility = "hidden"; ei[0].style.visibility = "hidden"; ot[0].style.visibility = "hidden" }; this.disposeComponent = function () { b = null; ui = null; fi = null; wt = null; e = null; ar = null; ho = null; se = null; co = null; he = null; vi = null; l = null; ci = null; vr = null; cu = null; yr = null; f = null; au = null; ao = null; ae = null; hh = null; ve = null; pe = null; wo = null; tt = null; bo = null; ko = null; we = null; w = null; be = null; ke = null; c = null; r = null; de = null; o = null; gi = null; wr = null; gt = null; ct = null; ni = null; i = null; ge = null; bu = null; ku = null; lf = null; u = null; ts = null; st = null }; this.getRoot = function () { return window.kendo == undefined || window.kendo == null ? t('<div><p style="text-align: center;line-height: 600px;">' + n.Msg.getMsg("PleaseInstallKendoUIModule") + "<\/p><\/div>") : (window.setTimeout(function () { k.addClass("vis-tm-delete"); c.find(".ui-resizable-n").css("display", "none") }, 200), f[0].style.visibility = "visible", oe) }; this.formSizeChanged = function () { nt.height(ti.height() - c.height() - 20); ct.height(nt.height()); nt.css("overflow", "hidden") }; this.sizeChanged = function (n, t) { this.formSizeChanged(n, t) } } i.prototype.init = function (n, t) { this.frame = t; this.windowNo = n; this.Initialize(); this.frame.getContentGrid().append(this.getRoot()) }; i.prototype.sizeChanged = function (n, t) { this.formSizeChanged(n, t) }; i.prototype.refresh = function () { this.formSizeChanged() }; i.prototype.dispose = function () { this.disposeComponent(); this.frame && this.frame.dispose(); this.frame = null }; n.Apps.AForms.VTreeMaintenance = i }(VIS, jQuery), function (n, t) { function i(i, r) { function l() { } function a(t, i, r, u) { s.filter("p#forreportcreate").text(n.Msg.getMsg("Generating" + u + "File")); h.filter("p#forreportdownload").text(n.Msg.getMsg("Downloading" + u + "File")) } var u, f; this.onClose = null; var e = t("<div><\/div>"), o = t('<div style="overflow-y:auto;margin-bottom:15px"><\/div>'), s = t('<p id="forreportcreate"><\/p><div class="vis-ui-progress-bar hide" id="reportcreate"><div class="progress-bar vis-ui-progress" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="width: 0%;"><\/div><\/div><br /><p class="hide" id="reportcreateresult"><\/p> <div style="margin-bottom: 15px;"><\/div>'), h = t('<p id="forreportdownload" class="hide"><\/p><div class="vis-ui-progress-bar hide" id="reportdownload"><div class="progress-bar vis-ui-progress" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="width: 0%;"><\/div><\/div><br /><p class="hide" id="reportdownloadresult"><\/p>'), c = t("<div class='vis-apanel-busy' style='width:98%;height:98%;position:absolute'>"); e.append(c).append(s).append(h); this.winNo = i; u = null; this.prop = { WindowNo: i }; a(o, i, this.prop, r); f = this; this.show = function () { u = new n.ChildDialog; u.setContent(e); u.setHeight(450); u.setWidth(650); u.setTitle(n.Msg.getMsg("Reports")); u.setModal(!0); u.onClose = function () { f.onClose && f.onClose(); f.dispose() }; u.show(); l(); u.hidebuttons() }; this.onClose = function () { u.close() }; this.setBulkBusy = function (n) { c.css("display", n ? "block" : "none") }; this.dispose = function () { this.prop = null; o = null; e = null; u = null; f = null; this.setBulkBusy(!1) } } n.BulkDownload = i }(VIS, jQuery), function (n, t) { function i() { function et() { c = t('<div class="Page-content" style="height:100%;background-color:white;">'); e = t(' <div class="formLeft" style="background-color: rgb(241, 241, 241);display: inline-block; float: left;width:23%;height:87.8%;overflow:auto;padding-left: 7px;">'); r = t('<div class="VIS_formDataRow">'); u = t("<div id=PCont_Name_" + i.windowNo + ' class="VIS_formData">'); k = t("<label>" + n.Msg.translate(n.Env.getCtx(), "Name") + "<\/label><br>"); d = t("<input type=text id=containerName_" + i.windowNo + " ><\/input>"); u.append(k).append(d); r.append(u); e.append(r); r = t('<div class="VIS_formDataRow">'); u = t("<div id=PCont_WarehouseSearch_" + i.windowNo + ' class="VIS_formData" style="margin-top:20px">'); g = t("<label>" + n.Msg.translate(n.Env.getCtx(), "M_Warehouse_ID") + "<\/label><br>"); u.append(g); r.append(u); e.append(r); r = t('<div class="VIS_formDataRow">'); u = t("<div id=PCont_LocatorSearch_" + i.windowNo + ' class="VIS_formData" style="margin-top:20px">'); tt = t("<label>" + n.Msg.translate(n.Env.getCtx(), "M_Locator_ID") + "<\/label><br>"); u.append(tt).append(o); r.append(u); e.append(r); r = t('<div class="VIS_formDataRow">'); u = t('<div class="VIS_formData">'); v = t('<input type=button id="PCont_btnSearch_' + i.windowNo + ' class="#" style="margin-top:20px;width: 100px;" value = ' + n.Msg.getMsg("Search") + "><\/input>"); u.append(v); r.append(u); e.append(r); l = t(' <div class="formRight" style="display: inline-block; float: left; width: 75%; height: 87.8%; margin-left: 10px;">'); p = t('<div style="display: inline-block; float: left; width: 75%; height: 87.8%; margin-left: 10px;">'); a = t("<div>"); y = t('<input type=button id="PCont_OK_' + i.windowNo + ' style="margin-top:20px;width: 100px;" value = ' + n.Msg.getMsg("OK") + "><\/input>"); a.append(y); l.append(p).append(a); c.append(e).append(l); f.append(c).append(b) } function ot() { h = f.find("#PCont_WarehouseSearch_" + i.windowNo); st(); o = f.find("#PCont_LocatorSearch_" + i.windowNo); ht(); var t = f.find("#containerName_" + i.windowNo)[0].value; w(t, $ReqControlWarehouse.value, $ReqControlLocator.value); v.on("click", function () { var n = f.find("#containerName_" + i.windowNo)[0].value; w(n, $ReqControlWarehouse.value, $ReqControlLocator.value) }); y.on("click", function () { var t = n.context.getWindowTabContext(i.windowNo, 1, "KeyColumnName"), r = 0; if (t.length > 0) r = n.context.getWindowContext(i.windowNo, t, !0); else { w2alert(n.Msg.getMsg("VIS_TableNotFound")); return } r > 0 && $selectedContainerId > 0 ? lt(t, r, $selectedContainerId) : w2alert(n.Msg.getMsg("VIS_RecordNotSelected")) }) } function st() { nt = n.MLookupFactory.get(n.Env.getCtx(), i.windowNo, 3798, n.DisplayType.Search, "M_Warehouse_ID", 0, !1, null); this.$ReqControlWarehouse = new n.Controls.VTextBoxButton("M_Warehouse_ID", !0, !0, !0, n.DisplayType.Search, nt); this.$ReqControlWarehouse.getControl().css("width", "55%"); this.$ReqControlWarehouse.getBtn(0).css("height", "29px"); this.$ReqControlWarehouse.getBtn(0).css("margin-top", "-1px"); this.$ReqControlWarehouse.getBtn(0).css("width", "14%"); this.$ReqControlWarehouse.getBtn(1).css("height", "29px"); this.$ReqControlWarehouse.getBtn(1).css("margin-top", "-1px"); this.$ReqControlWarehouse.getBtn(1).css("width", "14%"); h.append(this.$ReqControlWarehouse.getControl()); h.append(this.$ReqControlWarehouse.getBtn(0)); h.append(this.$ReqControlWarehouse.getBtn(1)); var t = ut(i.windowNo, "M_Warehouse_ID"); $ReqControlWarehouse.setValue(t) } function ht() { it = new n.MLocatorLookup(n.Env.getCtx(), i.windowNo); this.$ReqControlLocator = new n.Controls.VLocator("M_Locator_ID", !0, !0, !0, n.DisplayType.Locator, it); this.$ReqControlLocator.getControl().css("width", "55%"); this.$ReqControlLocator.getBtn(0).css("height", "29px"); this.$ReqControlLocator.getBtn(0).css("margin-top", "-1px"); this.$ReqControlLocator.getBtn(0).css("width", "14%"); this.$ReqControlLocator.getBtn(1).css("height", "29px"); this.$ReqControlLocator.getBtn(1).css("margin-top", "-1px"); this.$ReqControlLocator.getBtn(1).css("width", "14%"); o.append(this.$ReqControlLocator.getControl()); o.append(this.$ReqControlLocator.getBtn(0)); o.append(this.$ReqControlLocator.getBtn(1)); var t = ut(i.windowNo, "M_Locator_ID"); $ReqControlLocator.setValue(t) } function ut(t, i) { return n.context.getWindowContext(t, i, !1) } function w(i, r, u) { t.ajax({ type: "POST", url: n.Application.contextUrl + "ProductContainer/ProductContainer", data: { Name: i, WarehouseId: r, LocatorId: u }, dataType: "json", success: function (n) { var t = JSON.parse(n); t ? ct(t) : w2ui[s].clear() }, error: function (n) { console.log(n) } }) } function ct(t) { var u = [], f = [], i, r; for (u.push({ field: "ContainerName", caption: n.Msg.getMsg("ContainerName"), size: "15%" }), u.push({ field: "Width", caption: n.Msg.getMsg("Width"), size: "15%" }), u.push({ field: "Height", caption: n.Msg.getMsg("Height"), size: "15%" }), u.push({ field: "ParentPath", caption: n.Msg.getMsg("ParentPath"), size: "22%" }), u.push({ field: "M_ProductContainer_ID", caption: n.Msg.getMsg("M_ProductContainer_ID"), hidden: !0 }), u.push({ field: "Ref_M_Container_ID", caption: n.Msg.getMsg("Ref_M_Container_ID"), hidden: !0 }), i = 0; i < t.length; i++)r = {}, r.M_ProductContainer_ID = t[i].M_ProductContainer_ID, r.Ref_M_Container_ID = t[i].Ref_M_Container_ID, r.ContainerName = t[i].ContainerName, r.ParentPath = t[i].ParentPath, r.Width = t[i].Width, r.Height = t[i].Height, r.recid = i + 1, f[i] = r; s = "PCont_gridContainer" + Math.random(); s = s.replace(".", ""); w2utils.encodeTags(f); rt = p.w2grid({ name: s, recordHeight: 20, show: { toolbar: !1, columnHeaders: !0, lineNumbers: !0, selectColumn: !1, toolbarReload: !1, toolbarColumns: !0, toolbarSearch: !1, toolbarAdd: !1, toolbarDelete: !1, toolbarSave: !1, selectionBorder: !1, recordTitles: !1 }, columns: u, records: f, onClick: function (n) { $selectedContainerId = rt.get(n.recid).M_ProductContainer_ID } }) } function lt(r, u, e) { t.ajax({ type: "POST", url: n.Application.contextUrl + "ProductContainer/UpdateProductContainer", data: { TableName: r, RecordId: u, ContainerId: e }, dataType: "json", success: function (t) { var u = JSON.parse(t), r; u ? (w2alert(n.Msg.getMsg("VIS_UpdatedSuccess")), r = f.find("#containerName_" + i.windowNo)[0].value, w(r, $ReqControlWarehouse.value, $ReqControlLocator.value)) : w2alert(n.Msg.getMsg("VIS_NotUpdated")) }, error: function (n) { console.log(n) } }) } function ft(n) { b[0].style.visibility = n } this.frame; this.windowNo; var i = this, f = t("<div style='height:100%;background-color:white;' >"), b = t('<div class="vis-busyindicatorouterwrap"><div class="vis-busyindicatorinnerwrap"><i class="vis-busyindicatordiv"><\/i><\/div><\/div>'), c = null, r = null, e = null, l = null, u = null, a = null, k = null, d = null, g = null, h = null, nt = null; this.$ReqControlWarehouse = null; var tt = null, o = null, it = null; this.$ReqControlLocator = null; var v = null, y = null, p = null, rt = null, s = null; this.$selectedContainerId = null; this.Initialize = function () { ft("visible"); et(); ot(); ft("hidden") }; this.getRoot = function () { return f }; this.formSizeChanged = function () { }; this.sizeChanged = function () { }; disposeComponent = function () { this.$ReqControlWarehouse = null; this.$ReqControlLocator = null; this.$selectedContainerId = null } } n.AForms = n.AForms || {}; i.prototype.init = function (n, t) { this.frame = t; this.windowNo = n; var i = this.Initialize(); this.frame.getContentGrid().append(this.getRoot()); this.formSizeChanged() }; i.prototype.sizeChanged = function (n, t) { this.formSizeChanged(n, t) }; i.prototype.refresh = function () { this.formSizeChanged() }; i.prototype.dispose = function () { disposeComponent(); this.frame = null }; n.AForms.productContainer = i }(VIS, jQuery), function (n, t) { function i() { function pi() { var a, o, y, r, k, g, ot; tt = t('<div class="VIS_main-wrap vis-formouterwrpdiv">'); b = t('<div class="VIS_form-wrap">'); h = t('<div class="VIS_form-row">'); s = t('<div class="VIS_form-col input-group vis-input-wrap">'); r = t('<div class="vis-control-wrap">'); lt = t("<label>" + n.Msg.translate(n.Env.getCtx(), "M_Warehouse_ID") + "<\/label>"); w = t('<select disabled class="vis-ev-col-readonly">'); s.append(r); r.append(w).append(lt); l = t('<div class="VIS_form-col input-group vis-input-wrap">'); o = t('<div class="vis-control-wrap">'); at = t("<label>" + n.Msg.translate(n.Env.getCtx(), "M_WarehouseTo_ID") + "<\/label>"); c = t('<select disabled class="vis-ev-col-readonly">'); l.append(o); o.append(c).append(at); h.append(s).append(l); b.append(h); h = t('<div class="VIS_form-row">'); s = t('<div class="VIS_form-col input-group vis-input-wrap">'); r = t('<div class="vis-control-wrap">'); vt = t("<label>" + n.Msg.translate(n.Env.getCtx(), "M_Locator_ID") + "<\/label>"); u = t("<select>"); s.append(r); r.append(u).append(vt); l = t('<div class="VIS_form-col input-group vis-input-wrap">'); o = t('<div class="vis-control-wrap">'); yt = t("<label>" + n.Msg.translate(n.Env.getCtx(), "M_LocatorTo_ID") + "<\/label>"); e = t("<select>"); l.append(o); o.append(e).append(yt); h.append(s).append(l); b.append(h); h = t('<div class="VIS_form-row">'); s = t('<div class="VIS_form-col input-group vis-input-wrap">'); r = t('<div class="vis-control-wrap">'); a = t('<div class="input-group-append">'); pt = t("<label>" + n.Msg.translate(n.Env.getCtx(), "VIS_FromContainer") + "<\/label>"); f = t('<select disabled class="VIS-container-move-combo-width" class="vis-ev-col-readonly" data-hasbtn=" ">'); d = t('<span class="fa fa-cubes input-group-text VIS_buttons-ContainerTree VIS-pallet-icon VIS_Tree-Container-disabled"><\/span>'); s.append(r); r.append(f).append(pt); s.append(a); a.append(d); l = t('<div class="VIS_form-col input-group vis-input-wrap">'); o = t('<div class="vis-control-wrap">'); y = t('<div class="input-group-append">'); wt = t("<label>" + n.Msg.translate(n.Env.getCtx(), "Ref_M_ProductContainerTo_ID") + "<\/label>"); i = t('<select disabled class="VIS-container-move-combo-width" class="vis-ev-col-readonly" data-hasbtn=" ">'); $btnToContainerTree = t('<span class="fa fa-cubes input-group-text VIS_buttons-ContainerTree VIS-pallet-icon VIS_Tree-Container-disabled"><\/span>'); l.append(o); o.append(i).append(wt); l.append(y); y.append($btnToContainerTree); h.append(s).append(l); b.append(h); h = t('<div class="VIS_form-row">'); s = t('<div class="VIS_form-col input-group vis-input-wrap">'); r = t('<div class="vis-control-wrap">'); k = t('<label class="vis-ec-col-lblchkbox" title="' + n.Msg.translate(n.Env.getCtx(), "VIS_MoveFullContainerToolTip") + '"><input type="checkbox" name="">' + n.Msg.translate(n.Env.getCtx(), "VIS_MoveFullContainer") + "<\/label>"); s.append(r); r.append(k); v = k.find("input"); it = t('<div class="VIS_form-col input-group vis-input-wrap">'); g = t('<div class="vis-control-wrap">'); ot = t('<label class="vis-ec-col-lblchkbox" title="' + n.Msg.translate(n.Env.getCtx(), "VIS_WithoutContainerToolTip") + '"><input type="checkbox" name="WithoutContainer">' + n.Msg.translate(n.Env.getCtx(), "VIS_WithoutContainer") + "<\/label>"); it.append(g); g.append(ot); p = ot.find("input"); h.append(s).append(it); b.append(h); rt = t(' <div class="VIS_outer-table-wrap">'); ut = t('<div class="VIS_outer-table-wrap">'); rt.append(ut); ft = t('<div class="VIS_buttons-wrap">'); bt = t('<div class="pull-left" style="display: none;"><label>' + n.Msg.translate(n.Env.getCtx(), "VIS_ContainerGridInfo") + "<\/label><\/div>"); nt = t('<div class="pull-right">'); et = t('<span class="btn">' + n.Msg.translate(n.Env.getCtx(), "VIS_OK") + "<\/span>"); wi(nt); nt.append(et); ft.append(bt).append(nt); tt.append(b).append(rt).append(ft); ct.append(tt).append(ni) } function wi(i) { ulPaging = t('<ul style="float:left;margin-top:4px" class="vis-statusbar-ul">'); liFirstPage = t('<li style="display: none; "><div><i class="vis vis-shiftleft" title="' + n.Msg.translate(n.Env.getCtx(), "FirstPage") + '"  style="opacity: 0.6;"><\/i><\/div><\/li>'); liPrevPage = t('<li style="opacity: 1;"><div><i class="vis vis-pageup" title="' + n.Msg.translate(n.Env.getCtx(), "PageUp") + '"  style="opacity: 0.6;"><\/i><\/div><\/li>'); cmbPage = t("<select>"); liCurrPage = t("<li>").append(cmbPage); liNextPage = t('<li style="opacity: 1;"><div><i class="vis vis-pagedown" title="' + n.Msg.translate(n.Env.getCtx(), "PageDown") + '" style="opacity: 0.6;"><\/i><\/div><\/li>'); liLastPage = t('<li style="display: none;"><div><i class="vis vis-shiftright" title="' + n.Msg.translate(n.Env.getCtx(), "LastPage") + '" style="opacity: 0.6;"><\/div><\/li>'); ulPaging.append(liFirstPage).append(liPrevPage).append(liCurrPage).append(liNextPage).append(liLastPage); i.append(ulPaging) } function bi() { liPrevPage.on("click", function (n) { n.preventDefault(); t(this).css("opacity") == "1" && (r("visible"), g(ht, !0, -1)) }); liNextPage.on("click", function (n) { n.preventDefault(); t(this).css("opacity") == "1" && (r("visible"), g(ht, !0, 1)) }); cmbPage.on("change", function (n) { n.preventDefault(); r("visible"); g(ht, !0, 0) }) } function ki(n, t) { cmbPage.val(n); t > 0 ? (t > n ? liNextPage.css("opacity", "1") : liNextPage.css("opacity", "0.6"), n > 1 ? liPrevPage.css("opacity", "1") : liPrevPage.css("opacity", "0.6"), t == 1 && (liPrevPage.css("opacity", "0.6"), liNextPage.css("opacity", "0.6"))) : (liPrevPage.css("opacity", "0.6"), liNextPage.css("opacity", "0.6")); r("hidden") } function di() { gi(); nr(); tr(); u.on("change", function () { r("visible"); f.empty(); u.val() == "0" ? d.addClass("VIS_Tree-Container-disabled") : d.removeClass("VIS_Tree-Container-disabled"); window.setTimeout(function () { g(0, !1, 0) }, 20); r("hidden") }); c.on("change", function () { r("visible"); i.empty(); ii(); r("hidden") }); e.on("change", function () { r("visible"); i.empty(); e.val() == "0" ? $btnToContainerTree.addClass("VIS_Tree-Container-disabled") : $btnToContainerTree.removeClass("VIS_Tree-Container-disabled"); r("hidden") }); g(0, !1, 0); et.on("click", function () { if (c.val() == "0") return n.ADialog.error("VIS_ToWarehouseNotSelected", !0, "", ""), !1; if (u.val() == "0") return n.ADialog.error("VIS_FromLocatorNotSelected", !0, "", ""), !1; if (e.val() == "0") return n.ADialog.error("VIS_ToLocatorNotSelected", !0, "", ""), !1; if (f.val() == null && i.val() == null) return n.ADialog.error("VIS_SelectContainer", !0, "", ""), !1; var t = y.length; if (t == 0 && !p.is(":checked") && !v.is(":checked")) return n.ADialog.error("VIS_MoveQtyNotSelected", !0, "", ""), !1; v.is(":checked") ? n.ADialog.confirm("VIS_DoYouWantToDeleteManualCL", !0, "", "Confirm", function (n) { if (n) r("visible"), ri(), r("hidden"); else return !1 }) : (r("visible"), ri(), r("hidden")) }); d.on("click", function () { if (!d.hasClass("VIS_Tree-Container-disabled")) { var i = w.val() == "0" || w.val() == null ? 0 : parseInt(w.val()), r = u.val() == "0" || u.val() == null ? 0 : parseInt(u.val()), t = new n.productContainerTree(i, r, null, null); t != null && (t.showDialog(), t.onClosing = function (n, t) { ht = n; n > 0 && bt.css("display", "block"); f.empty(); f.append(" <option value=" + n + "  selected>" + t + "<\/option>"); y = []; g(n, !1, 0) }); t = null } }); $btnToContainerTree.on("click", function () { if (!$btnToContainerTree.hasClass("VIS_Tree-Container-disabled")) { var r = c.val() == "0" || c.val() == null ? 0 : parseInt(c.val()), u = e.val() == "0" || e.val() == null ? 0 : parseInt(e.val()), t = new n.productContainerTree(r, u, null, null); t != null && (t.showDialog(), t.onClosing = function (n, t) { i.empty(); i.append(" <option value=" + n + "  selected>" + t + "<\/option>") }); t = null } }); v.change(function () { this.checked ? (w2ui[grdname].lock(""), t(this).prop("checked", !0), p.prop("checked", !1)) : (w2ui[grdname].unlock(""), t(this).prop("checked", !1)) }); p.change(function () { this.checked ? (w2ui[grdname].lock(""), t(this).prop("checked", !0), v.prop("checked", !1)) : (w2ui[grdname].unlock(""), t(this).prop("checked", !1)) }); bi() } function gi() { var i = n.context.getWindowContext(a.windowNo, "DTD001_MWarehouseSource_ID", !0); t.ajax({ type: "POST", url: n.Application.contextUrl + "ProductContainer/LoadWarehouse", data: { fromWarehouse_ID: i }, dataType: "json", success: function (t) { var r = JSON.parse(t), i; if (r) for (i = 0; i < r.length; i++)key = n.Utility.Util.getValueOfInt(r[i].ID), value = n.Utility.Util.getValueOfString(r[i].Name), w.append(" <option value=" + key + ">" + value + "<\/option>"); w.prop("selectedIndex", 0) }, error: function (n) { r("hidden"); console.log(n) } }) } function nr() { var i = n.context.getWindowContext(a.windowNo, "DTD001_MWarehouseSource_ID", !0); t.ajax({ type: "POST", url: n.Application.contextUrl + "ProductContainer/LoadLocator", data: { fromWarehouse_ID: i }, dataType: "json", success: function (t) { var r = JSON.parse(t), i; if (r) for (u.empty(), u.append("<option value= 0 >Select<\/option>"), i = 0; i < r.length; i++)key = n.Utility.Util.getValueOfInt(r[i].ID), value = n.Utility.Util.getValueOfString(r[i].Name), u.append(" <option value=" + key + ">" + value + "<\/option>"); else u.append("<option value= 0 >Select<\/option>"); u.prop("selectedIndex", 0) }, error: function (n) { r("hidden"); console.log(n) } }) } function tr() { var i = n.context.getWindowContext(a.windowNo, "M_Warehouse_ID", !0); i == "" && (i = 0); t.ajax({ type: "POST", url: n.Application.contextUrl + "ProductContainer/LoadWarehouse", data: { fromWarehouse_ID: i }, dataType: "json", success: function (t) { var r = JSON.parse(t), i; if (r) for (i = 0; i < r.length; i++)key = n.Utility.Util.getValueOfInt(r[i].ID), value = n.Utility.Util.getValueOfString(r[i].Name), c.append(" <option value=" + key + ">" + value + "<\/option>"); c.prop("selectedIndex", 0); ii() }, error: function (n) { r("hidden"); console.log(n) } }) } function ii() { var i = c.val() == "0" || c.val() == null ? 0 : parseInt(c.val()); t.ajax({ type: "POST", url: n.Application.contextUrl + "ProductContainer/LoadLocator", data: { fromWarehouse_ID: i }, dataType: "json", success: function (t) { var r = JSON.parse(t), i; if (r) for (e.empty(), e.append("<option value= 0 >Select<\/option>"), i = 0; i < r.length; i++)key = n.Utility.Util.getValueOfInt(r[i].ID), value = n.Utility.Util.getValueOfString(r[i].Name), e.append(" <option value=" + key + ">" + value + "<\/option>"); else e.append("<option value= 0 >Select<\/option>"); e.prop("selectedIndex", 0) }, error: function (n) { r("hidden"); console.log(n) } }) } function g(i, f, e) { o = 1; k = 1; st = 0; dt = !1; var s = parseInt(n.context.getWindowContext(a.windowNo, "AD_Org_ID", !0)), h = n.context.getWindowContext(a.windowNo, "MovementDate", !0), c = u.val() == "0" || u.val() == null ? 0 : parseInt(u.val()); f && (o = parseInt(cmbPage.val()), e != 0 && (e == -1 ? (o = o - 1, o < 1 && (o = 1)) : e == 1 && (o = o + 1, o > gt && (o = gt)))); t.ajax({ type: "POST", url: n.Application.contextUrl + "ProductContainer/MoveContainer", data: { container: i, movementDate: h, AD_Org_ID: s, locator: c, page: o, size: kt }, dataType: "json", success: function (n) { var u = JSON.parse(n), i; if (u) { if (o == 1 && u.length > 0 && (st = u[0].ContainerRecord, k = Math.ceil(st / kt)), ir(u), f) ot = o, cmbPage.val(ot), ot > 1 ? liPrevPage.css("opacity", "1") : liPrevPage.css("opacity", "0.6"), r("hidden"); else { if (gt = k, liCurrPage.find("option").remove(), k > 0) for (i = 0; i < k; i++)cmbPage.append(t("<option value=" + (i + 1) + ">" + (i + 1) + "<\/option>")); ki(ot, k); cmbPage.val(o) } dt = !0 } }, error: function (n) { r("hidden"); console.log(n) } }) } function ir(i) { var f = [], e = [], r, u, o; for (f.push({ field: "ProductName", caption: n.Msg.translate(n.Env.getCtx(), "ProductName"), size: "20%" }), f.push({ field: "ASI", caption: n.Msg.translate(n.Env.getCtx(), "ASI"), size: "15%" }), f.push({ field: "UomName", caption: n.Msg.translate(n.Env.getCtx(), "UomName"), size: "15%" }), f.push({ field: "ContainerQty", caption: n.Msg.translate(n.Env.getCtx(), "ContainerQty"), size: "10%" }), f.push({ field: "MoveQty", caption: n.Msg.translate(n.Env.getCtx(), "MoveQty"), editable: { type: "float" }, render: "number:4", sortable: !1, size: "10%" }), f.push({ field: "M_ProductContainer_ID", caption: n.Msg.translate(n.Env.getCtx(), "M_ProductContainer_ID"), hidden: !0 }), f.push({ field: "M_PRODUCT_ID", caption: n.Msg.translate(n.Env.getCtx(), "M_PRODUCT_ID"), hidden: !0 }), f.push({ field: "M_AttributeSetInstance_ID", caption: n.Msg.translate(n.Env.getCtx(), "M_AttributeSetInstance_ID"), size: "15%", hidden: !0 }), f.push({ field: "C_Uom_ID", caption: n.Msg.translate(n.Env.getCtx(), "C_Uom_ID"), size: "15%", hidden: !0 }), f.push({ field: "M_Transaction_ID", caption: n.Msg.translate(n.Env.getCtx(), "M_Transaction_ID"), size: "15%", hidden: !0 }), r = 0; r < i.length; r++)u = {}, u.ProductName = i[r].ProductName, u.ASI = i[r].ASI, u.UomName = i[r].UomName, u.ContainerQty = i[r].ContainerQty, u.M_ProductContainer_ID = i[r].M_ProductContainer_ID, u.M_Product_ID = i[r].M_Product_ID, u.M_AttributeSetInstance_ID = i[r].M_AttributeSetInstance_ID, u.C_Uom_ID = i[r].C_Uom_ID, y.length > 0 ? (o = t.map(y, function (n) { if (n.M_Product_ID == i[r].M_Product_ID && n.M_AttributeSetInstance_ID == i[r].M_AttributeSetInstance_ID) return n }), u.MoveQty = o.length > 0 ? o[0].MoveQty : 0) : u.MoveQty = 0, u.recid = r + 1, e[r] = u; grdname = "MCont_gridContainer" + Math.random(); grdname = grdname.replace(".", ""); w2utils.encodeTags(e); ti = ut.w2grid({ name: grdname, recordHeight: 20, show: { toolbar: !1, columnHeaders: !0, lineNumbers: !0, selectColumn: !1, toolbarReload: !1, toolbarColumns: !0, toolbarSearch: !1, toolbarAdd: !1, toolbarDelete: !1, toolbarSave: !1, selectionBorder: !1, recordTitles: !1 }, columns: f, records: e, multiSelect: !1, onClick: function () { }, onChange: function (t) { if (t.column == 4 && t.value_new && t.value_new != 0) { var i = t.value_new, r = w2ui[grdname].get(t.recid).ContainerQty; if (r < 0 && i > 0) return n.ADialog.error("VIS_CantbePositive"), t.value_new = 0, !1; if (Math.abs(i) > Math.abs(r)) return n.ADialog.error("VIS_CantGreater"), t.value_new = 0, !1; rr(i, t.recid) } } }); (v.is(":checked") || p.is(":checked")) && w2ui[grdname].lock("") } function ri() { var s = [], o = v.is(":checked"), h = !1, k, d, l, b, w, c; if (h = p.is(":checked"), o && f.val() == null) return n.ADialog.error("VIS_FullContainerMove", !0, "", ""), !1; if (k = f.val() == "0" || f.val() == null ? 0 : parseInt(f.val()), d = i.val() == "0" || i.val() == null ? 0 : parseInt(i.val()), k == d) return n.ADialog.error("VIS_ContainerCantSame", !0, "", ""), !1; if (l = y.length, l == 0 && !o && !h) return n.ADialog.error("VIS_MoveQtyNotSelected", !0, "", ""), !1; if (b = n.context.getWindowContext(a.windowNo, "M_Movement_ID", !0), l > 0 || o || h) { if (!o && !h && l > 0 && (t.each(y, function () { this.ToLocator = parseInt(e.val()); this.ToContainer = i.val() == "0" || i.val() == null ? 0 : parseInt(i.val()) }), s = y), o || h) { for (s = [], w = 0; w < w2ui[grdname].records.length; w++) { c = w2ui[grdname].records[w]; s.push({ M_Product_ID: c.M_Product_ID, M_AttributeSetInstance_ID: c.M_AttributeSetInstance_ID, C_UOM_ID: c.C_Uom_ID, FromLocator: parseInt(u.val()), ToLocator: parseInt(e.val()), FromContainer: f.val() == "0" || f.val() == null ? 0 : parseInt(f.val()), ToContainer: i.val() == "0" || i.val() == null ? 0 : parseInt(i.val()), MoveQty: c.ContainerQty, M_Movement_ID: b, IsFullMoveContainer: o ? !0 : !1, IsfullContainerQtyWise: h ? !0 : !1 }); break } s.length == 0 && o && s.push({ M_Product_ID: 0, M_AttributeSetInstance_ID: 0, C_UOM_ID: 0, FromLocator: parseInt(u.val()), ToLocator: parseInt(e.val()), FromContainer: f.val() == "0" || f.val() == null ? 0 : parseInt(f.val()), ToContainer: i.val() == "0" || i.val() == null ? 0 : parseInt(i.val()), MoveQty: 0, M_Movement_ID: b, IsFullMoveContainer: o ? !0 : !1, IsfullContainerQtyWise: h ? !0 : !1 }) } if (s.length == 0) return n.ADialog.error("VIS_MoveQtyNotSelected", !0, "", ""), !1; t.ajax({ url: n.Application.contextUrl + "ProductContainer/SaveMoveData", type: "POST", data: { moveData: JSON.stringify(s) }, success: function (t) { JSON.parse(t) == "VIS_SuccessFullyInserted" ? n.ADialog.info("VIS_SuccessFullyInserted", !0, "", "") : n.ADialog.error("Error", !0, n.Msg.translate(n.Env.getCtx(), "VIS_NotInserted") + " - " + t, ""); v.prop("checked", !1); p.prop("checked", !1); y = []; a.frame.close() }, error: function () { y = []; a.frame.close(); r("hidden") } }) } } function rr(t, r) { var s = v.is(":checked"), h = p.is(":checked"), c = n.context.getWindowContext(a.windowNo, "M_Movement_ID", !0), l = w2ui[grdname].getChanges().length, o; t != 0 && (o = w2ui[grdname].get(r), y.push({ M_Product_ID: o.M_Product_ID, M_AttributeSetInstance_ID: o.M_AttributeSetInstance_ID, C_UOM_ID: o.C_Uom_ID, FromLocator: parseInt(u.val()), ToLocator: parseInt(e.val()), FromContainer: f.val() == "0" || f.val() == null ? 0 : parseInt(f.val()), ToContainer: i.val() == "0" || i.val() == null ? 0 : parseInt(i.val()), MoveQty: t, M_Movement_ID: c, IsFullMoveContainer: s ? !0 : !1, IsfullContainerQtyWise: h ? !0 : !1 })) } function r(n) { ni[0].style.visibility = n } this.frame; this.windowNo; var a = this, ct = t("<div style='height:100%;background-color:white;' class='vis-forms-container' >"), ni = t("<div class='vis-busyindicatorouterwrap'><div class='vis-busyindicatorinnerwrap'><i class='vis-busyindicatordiv'><\/i><\/div><\/div>"), tt = null, b = null, h = null, s = null, l = null, it = null, lt = null, w = null, at = null, c = null, vt = null, u = null, yt = null, e = null, d = null, pt = null, f = null, wt = null, i = null, ui = null, fi = null, ei = null, oi, si = null, v = null, hi = null, p = null, ci = null, li = null, ai = null, rt = null, ut = null, ti = null; this.grdname; var ft = null, nt = null, vi = null, et = null, yi = null, bt = null, kt = 50, ot = 1, o = 1, k = 1, st = 0, dt = !1, gt = 1, ht = 0, y = []; this.Initialize = function () { r("visible"); pi(); di(); r("hidden") }; this.setHeight = function () { return 700 }; this.getRoot = function () { return ct }; disposeComponent = function () { tt = null; b = null; h = null; s = null; l = null; it = null; lt = null; w = null; at = null; c = null; vt = null; u = null; yt = null; e = null; pt = null; f = null; wt = null; i = null; ui = null; fi = null; ei = null; oi; si = null; v = null; hi = null; p = null; ci = null; li = null; ai = null; rt = null; ut = null; ti = null; this.grdname = null; ft = null; nt = null; vi = null; et = null; yi = null; kt = null; o = null; k = null; st = null; dt = null; a = null; ct = null } } n.AForms = n.AForms || {}; i.prototype.init = function (n, t) { this.frame = t; this.windowNo = n; var i = this.Initialize(); this.frame.getContentGrid().append(this.getRoot()) }; i.prototype.dispose = function () { disposeComponent(); this.frame = null }; n.AForms.productContainerMove = i }(VIS, jQuery), function (n, t) { function i(i, r, u, f) { function et(n) { var t; return n = n.toUpperCase(), n.contains("M_LOCATOR_ID") ? t = n.substr(n.indexOf("M_LOCATOR_ID=") + 13, n.length) : n.contains("M_LOCATORTO_ID") && (t = n.substr(n.indexOf("M_LOCATORTO_ID=") + 15, n.length)), t != undefined && (t = t.contains("AND") ? t.substr(0, t.indexOf("AND")).trim() : t.trim()), t } function g(u) { t.ajax({ url: n.Application.contextUrl + "ProductContainer/LoadContainerAsTree", type: "GET", datatype: "json", contentType: "application/json; charset=utf-8", data: { warehouse: i, locator: r, container: 0, validation: f }, success: function (n) { u(n) }, error: function () { n.ADialog.error("VIS_ErrorLoadingFromController") } }) } function nt(n) { var r, i, e, f; for (o = '<div id=containerParent style="width:100%;height:400px"><div><div class="well VIS_tree-container" style="width:100%;float: left;"><div id=containerParent1 style="overflow-y: auto;height: 383px;"><ul class="nav nav-list">', r = JSON.parse(n), i = 0; i < r.length; i++)if (i == 0) { w(r[i], r[i].Level); continue } else if (r[i - 1].Level < r[i].Level) { o += '<ul class="nav nav-list tree" style="display: none;">'; w(r[i], r[i].Level); i + 1 == r.length && (o += "<\/li> <\/ul>"); continue } else if (r[i - 1].Level == r[i].Level && r[i].Level != 1) { o += "<\/li>"; w(r[i], r[i].Level); i + 1 == r.length && (o += "<\/li>"); continue } else if (r[i - 1].Level > r[i].Level && r[i].Level != 1) { if (r[i - 1].Level > r[i].Level) for (e = r[i - 1].Level - r[i].Level, f = 0; f < e; f++)tt(); w(r[i], r[i].Level); i + 1 == r.length && (o += "<\/li>"); continue } else if (r[i].Level == 1) { if (r[i - 1].Level > r[i].Level) for (e = r[i - 1].Level - 1, f = 0; f < e; f++)tt(); o += "<\/li>"; o += '<li class="divider"><\/li>'; w(r[i], r[i].Level); i + 1 == r.length && (o += "<\/li>"); continue } o += "<\/ul> <\/div> <\/div> <\/div> <\/div>"; t("#VIS_ContainerParentChild").html(o); h = t("#VIS_ContainerParentChild")[0]; t("label.tree-toggler").click(function () { var n = t(h); n.find(".nav-header").removeClass("current"); t(t(this)).addClass("current"); t(this).parent().children("ul.tree").toggle(300) }); b.click(function () { c.val() != "" && it(t(h), c.val()); c.val() == "" && t(h).find(".nav-header").removeClass("current") }); u && b.trigger("click"); t(document).keypress(function (n) { var i = n.keyCode ? n.keyCode : n.which; i == 13 && n.preventDefault(); i == "13" && c.val() != "" && it(t(h), c.val()) }); t(document).keyup(function () { $NameInput.val() != "" ? $NameInput.css("background-color", rt(!1)) : $NameInput.css("background-color", rt(!0)) }) } function w(n, t) { o += t == 1 ? "<li data-value=" + n.M_ProductContainer_ID + ' class="First">' : "<li data-value=" + n.M_ProductContainer_ID + ">"; o += '<label class="tree-toggler nav-header" for=' + n.M_ProductContainer_ID + ">" + n.ContainerName + '<span class="vis-treewindow-span"><span class="vis-css-treewindow-arrow-up"><\/span><\/span><\/label>' } function tt() { o += "<\/li> <\/ul>" } function it(n, i) { var r = n.find("label:contains('" + i + "')"); t("label").removeClass("current"); r.addClass("current"); t(r).parents(".First").find("ul.tree:last-child").css("display") == "none" ? (t(r).parents(".First").find("ul.tree:last-child").toggle(), t(r).parents(".First").find("ul.tree:last-child").css("display", "block")) : t(r).parents(".First").find("ul.tree:last-child").css("display", "block"); r[0].scrollIntoView() } function ot(u, f, e, o, s) { t.ajax({ url: n.Application.contextUrl + "ProductContainer/SaveContainer", datatype: "json", async: !1, contentType: "application/json; charset=utf-8", data: { warehouseId: i, locatorId: r, value: u, name: f, height: e, width: o, parentContainerId: s }, success: function (i) { JSON.parse(i) == "" ? (n.ADialog.info("VIS_ContainerInserted", !0, "", ""), t(h).empty(), h = t("<div id='VIS_ContainerParentChild' style='height:382px; float: left; width: 100%;'><\/div>"), g(nt), ut(), ft()) : n.ADialog.error("", !0, JSON.parse(i), "") }, error: function () { n.ADialog.error("VIS_ErrorLoadingFromController") } }) } function rt(n) { return n ? "#FFB6C1" : "White" } function ut() { y = e.find("#AddNewContainer"); y[0].style.display = "none"; a[0].style.display = "flex"; l[0].style.display = "none"; v[0].style.display = "none"; e.find("#VIS_DialogOKCancelProductContainer")[0].style.display = "block"; e.find("#containerParent").css("height", "400px"); e.find("#containerParent1").css("height", "383px"); e.find("#VIS_ContainerParentChild").css("height", "382px"); p[0].style.display = "none" } function st() { y = e.find("#AddNewContainer"); y[0].style.display = "block"; a[0].style.display = "none"; l[0].style.display = "flex"; v[0].style.display = "flex"; e.find("#VIS_DialogOKCancelProductContainer")[0].style.display = "none"; e.find("#containerParent").css("height", "295px"); e.find("#containerParent1").css("height", "275px"); e.find("#VIS_ContainerParentChild").css("height", "265px"); p[0].style.display = "block" } function ft() { $searchInput.val(""); $NameInput.val(""); $HeightInput.val(""); $WidthInput.val("") } var d = this; this.onClose = null; this.onClosing = null; var e = null, s = null, o, h = null, b = null, c = null, l = null, a = null, v = null, y = null, k, p = null; this.showDialog = function () { var o, w = "", y, tt; f != null ? o = et(f) : r > 0 && (o = r); o != null && (w = n.dataContext.getJSONRecord("ProductContainer/GetWarehouseAndLocatorName", o)); e = t("<div class='vis-formouterwrpdiv' style='float: left; width: 100%;min-height:480px; max-height:480px !important'><\/div>"); tt = t("<div id='AddNewContainer' style='float: left; width: 100%; display:none;'><div class='VIS_form-data-row'><div class='VIS_form-data-col input-group vis-input-wrap'><div class='vis-control-wrap'><input id='VIS_SearchValue' type='text' placeholder=' ' data-placeholder=''><label>" + n.Msg.translate(n.Env.getCtx(), "Value") + "<\/label><\/div><\/div><div class='VIS_form-data-col input-group vis-input-wrap'><div class='vis-control-wrap'><input id='VIS_Name' type='text' class='vis-ev-col-mandatory' placeholder=' ' data-placeholder=''><label>" + n.Msg.translate(n.Env.getCtx(), "Name") + "<\/label><\/div><\/div><\/div><div class='VIS_form-data-row'><div class='VIS_form-data-col input-group vis-input-wrap'><div class='vis-control-wrap'><input id='VIS_Height' type='Number' placeholder=' ' data-placeholder=''><label>" + n.Msg.translate(n.Env.getCtx(), "Height") + "<\/label><\/div><\/div><div class='VIS_form-data-col input-group vis-input-wrap'><div class='vis-control-wrap'><input id='VIS_Width' type='Number' placeholder=' ' data-placeholder=''><label>" + n.Msg.translate(n.Env.getCtx(), "Width") + "<\/label><\/div><\/div><\/div><div class='VIS_form-data-row' style='display: none;'><div class='VIS_form-data-col'><label>" + n.Msg.translate(n.Env.getCtx(), "Ref_M_Container_ID") + "<\/label><\/div><\/div><\/div>"); y = t("<div class='VIS_form-data-row'><div class='VIS_form-search-wrap input-group vis-input-wrap'><div class='vis-control-wrap'><input class='VIS_form-search-wrap input' id='VIS_Search' type='text' placeholder='Search Here...' data-hasbtn=' '><\/div><div class='input-group-append'><button class='VIS_form-search-wrap button input-group-text' id=VIS_BtnSearch title=" + n.Msg.translate(n.Env.getCtx(), "VIS_Search") + "><i class='vis vis-search'><\/i><\/button><button class='VIS_form-search-wrap button input-group-text' id=VIS_BtnAdd title=" + n.Msg.translate(n.Env.getCtx(), "VIS_NewContainer") + "><i class='vis vis-plus'><\/i><\/button><button class='VIS_form-search-wrap button input-group-text' style='display:none;' id=VIS_BtnSave title=" + n.Msg.translate(n.Env.getCtx(), "VIS_SaveContainer") + "><i class='vis vis-save'><\/i><\/button><button class='VIS_form-search-wrap button input-group-text' style='display:none;' id=VIS_BtnCancel title=" + n.Msg.translate(n.Env.getCtx(), "VIS_Cancel") + "><i class='vis vis-mark'><\/i><\/button><\/div><\/div>"); h = t("<div id='VIS_ContainerParentChild' class='VIS_Tree-Container' ><\/div>"); k = t("<div id='VIS_DialogOKCancelProductContainer' class='VIS_buttons-wrap VIS_pop-btn-wrap' style='display:block;'> <span class='btn' id=VIS_DialogOK>" + n.Msg.translate(n.Env.getCtx(), "VIS_DialogOK") + "<\/span> <span class='btn' id=VIS_DialogCancel>" + n.Msg.translate(n.Env.getCtx(), "VIS_DialogCancel") + "<\/span> <\/div>"); p = t("<div id='VIS_LabelInfo' class='VIS_Tree-Container-labelInfo'><label>" + w + "<\/label><\/div>"); y.append(h); e.append(tt).append(y).append(k).append(p); s = new n.ChildDialog; s.setContent(e); s.setTitle(n.Msg.translate(n.Env.getCtx(), "VIS_Container")); s.setWidth("450px"); s.setEnableResize(!1); s.setModal(!0); s.show(); s.hidebuttons(); b = e.find("#VIS_BtnSearch"); c = e.find("#VIS_Search"); $searchInput = e.find("#VIS_SearchValue"); $NameInput = e.find("#VIS_Name"); $HeightInput = e.find("#VIS_Height"); $WidthInput = e.find("#VIS_Width"); a = e.find("#VIS_BtnAdd"); l = e.find("#VIS_BtnSave"); v = e.find("#VIS_BtnCancel"); $DialogbtnOk = e.find("#VIS_DialogOK"); $DialogbtnCancel = e.find("#VIS_DialogCancel"); $DialogbtnOk.click(function () { var i = h, r = t(i).find(".current").length, u, f; if (r > 1) return n.ADialog.error("VIS_SelectSingleContainer", !0, "", ""), !1; if (r > 0) { u = parseInt(t(i).find(".current")[0].htmlFor); f = t(t(i).find(".current")[0]).text(); d.onClosing(u, f); s.close() } else s.close() }); $DialogbtnCancel.click(function () { s.close() }); u && c.val(u); g(nt); a.click(function () { st() }); v.click(function () { ut(); ft() }); l.click(function () { var s, u; if ($NameInput.val() == "") return n.ADialog.error("VIS_ContainerNameNotSelected", !0, "", ""), !1; if (s = f, i == "" && r == "" && f == "") return n.ADialog.error("VIS_WarehouseOrLocatorNotFound", !0, "", ""), !1; f != null && (f = f.toUpperCase(), f.contains("M_LOCATOR_ID") ? u = f.substr(f.indexOf("M_LOCATOR_ID=") + 13, f.length) : f.contains("M_LOCATORTO_ID") && (u = f.substr(f.indexOf("M_LOCATORTO_ID=") + 15, f.length)), u != undefined && (r = u.contains("AND") ? u.substr(0, u.indexOf("AND")).trim() : u.trim(), parseInt(r) == 0 && n.ADialog.error("VIS_WarehouseOrLocatorNotFound", !0, "", ""))); var e = h, c = t(e).find(".current").length, o = 0; if (c <= 1) t(e).find(".current")[0] != undefined && (o = parseInt(t(e).find(".current")[0].htmlFor)); else return n.ADialog.error("VIS_SelectSingleContainer", !0, "", ""), !1; ot($searchInput.val(), $NameInput.val(), $HeightInput.val() == "" ? 0 : $HeightInput.val(), $WidthInput.val() == "" ? 0 : $WidthInput.val(), o) }) }; jQuery.expr[":"].contains = function (n, t, i) { return jQuery(n).text().toUpperCase().indexOf(i[3].toUpperCase()) >= 0 }; this.disposeComponent = function () { d = null; e = null; s = null; o; h = null; b = null; c = null; p = null; l = null; a = null; v = null; y = null; k; this.disposeComponent = null } } i.prototype.dispose = function () { this.disposeComponent() }; n.productContainerTree = i }(VIS, jQuery), function (n, t) { function i(i, r, u, f) { function y() { h = t("<div class='vis-height-full'>"); l = t("<div class='vis-apanel-busy'>"); s = t("<div class='vis-height-full'>"); h.append(s).append(l); e = new n.ChildDialog; p() } function p() { n.dataContext.getFormDataString({ AD_Form_ID: r }, function (i) { if (i.error != null) { n.ADialog.error(i.error); o.dispose(); o = null; return } var r = t.parseJSON(i.result); if (r.IsError) { n.ADialog.error(r.Message); o.dispose(); o = null; return } e.setTitle(r.DisplayName); openForm(r, o, f); r = null }) } function w(n) { e.setContent(s); n.setHeight ? e.setHeight(n.setHeight()) : e.setHeight(i); n.setWidth ? e.setWidth(n.setWidth()) : e.setWidth(window.innerWidth - 100); e.setModal(!0); e.onClose = function () { n.dispose && n.dispose(); e.dispose && e.dispose(); u.dataRefresh(); o.disposeComponent && o.disposeComponent() }; e.show(); e.hidebuttons() } var h, l, s, e, v = n.Env.getCtx(), a = n.Logging.VLogger.getVLogger("VIS.AForm"), c = n.Env.getWindowNo(), o = this; y(); this.getWindowNo = function () { return c }; this.getAD_Table_ID = function () { return u.getAD_Table_ID() }; this.getAD_Window_ID = function () { return u.getAD_Window_ID() }; this.getRecord_ID = function () { return u.getRecord_ID() }; this.getContentGrid = function () { return s }; this.close = function () { e && e.close() }; this.disposeComponent = function () { h.remove(); h = null; s.remove(); s = null; this.getContentGrid = null; o = null }; openForm = function (t, i, r) { var f, s, e; if (t.IsReport) return n.ADialog.info("Form Report is not supported"), !1; f = ""; f = t.Prefix + t.ClassName; console.log(f); a.info("Form Name= " + t.Name + ", Class=" + f); v.setWindowContext(c, "WindowName", t.DisplayName); try { s = n.Utility.getFunctionByName(f, window); e = new s(c); e.init(r, o); e.setRecordID && e.setRecordID(u.getRecord_ID()); w(e) } catch (h) { return a.log(n.Logging.Level.WARNING, "Class=" + f + ", AD_Form Name=" + t.Name, h), !1 } return !0 } } n.WForm = i }(VIS, jQuery), function (n, t) { function i(t, i, r, u, f, e, o) { this._tblName = t; this.rec_ID = r; this.sqlWhere = u; this.gFields = i; this._callbackClose = o; this._newRec = e; this.gridCols = []; this.htmlUI = []; this.busyInd = null; this.deletable = !1; this.maintTblVer = f; this.defaultColsIniPos = [Version = n.Msg.getMsg("VIS_RecordVersion"), ValidFrom = n.Msg.translate(n.Env.getCtx(), "VersionValidFrom"), Approved = n.Msg.getMsg("VIS_IsVersionApproved"),]; this.defaultColEleIniPos = [Version = "RECORDVERSION", ValidFrom = "VERSIONVALIDFROM", Approved = "ISVERSIONAPPROVED"]; this.defaultCols = [VersionLog = n.Msg.translate(n.Env.getCtx(), "VersionLog"), Delete = n.Msg.getMsg("Action")]; this.defaultColElements = [VersionLog = "VERSIONLOG", Delete = "ACTION"]; this.exclCols = [Tenant = "AD_Client_ID", Created = "Created", CreatedBy = "CreatedBy", Updated = "Updated", UpdatedBy = "UpdatedBy", Export_ID = "Export_ID"] } i.prototype.show = function () { var o = !1, e = null, s = null, u = null, r = this, c = this._tblName + ",true," + this.sqlWhere, l = n.dataContext.getJSONRecord("JsonData/GetIDTextData", c), a = n.dataContext.getJSONRecord("Common/CheckTableDeletable", this._tblName + "_Ver"), h = "40%", i, f; if (a == "Y" && (this.deletable = !0), i = new n.ChildDialog, f = this.getMasterVersionUI(l), i.setContent(f), this.gridCols.length > 8 && (h = "70%"), i.setWidth(h), i.setTitle(n.Msg.getMsg("MasterDataVersioning")), i.setModal(!0), i.onClose = function () { e && (e.off("click"), e = null); u && (u = null); s && (s = null); this.deletable && f.find(".vis-mas-ver-btnDel").off("click"); i = null }, i.onOkClick = function () { if (!o) return r.setBusy(!0), setTimeout(function () { var s, h; if (r._callbackClose) if (o = !0, s = u.val(), s && s != "" || (s = new Date), !e.prop("checked") && new Date(u.val()) > new Date) { var c = f.find(".vis-mas-ver-recRow"), l = !1, a = 0; if (c.length > 0) for (h = 0; h < c.length; h++) { var v = t(c[h]), y = v.find(".vis-mas-ver-valFromDate"), p = new Date(t(y).attr("valdt")).getTime(), w = new Date(new Date(u.val()).setHours(0, 0, 0, 0)).getTime(); if (p == w) { l = !0; a = v.attr("recid"); break } } if (l) return n.ADialog.confirm("VersionExistOverwrite", !0, "", "Confirm", function (n) { n ? (r._callbackClose(e.prop("checked"), s, a), i.close(), o = !1) : o = !1 }), !1; r._callbackClose(e.prop("checked"), s, 0); o = !1; i.close() } else r._callbackClose(e.prop("checked"), s, 0), o = !1, i.close(); else i.close() }, 10), !1 }, i.onCancelClick = function () { i.close() }, i.show(), this.deletable) f.find(".vis-mas-ver-btnDel").on("click", function (i) { var u = t(i.target).closest(".vis-mas-ver-recRow"), o, e; if (u.length > 0 && (o = u.attr("recid"), o > 0)) { if (e = !1, e) return; n.ADialog.confirm("DeleteConfirm", !0, "", "Confirm", function (t) { if (e = !0, t) { var s = r._tblName + "_Ver," + o, i = n.dataContext.getJSONRecord("Common/DeleteRecord", s); i && i.Success && i.Success == "Y" ? (u.remove(), u = f.find(".vis-mas-ver-recRow"), u.length <= 0 && f.find(".vis-mas-ver-gridData").append(r.getNoRecDiv())) : i.Success && i.Msg != "" ? n.ADialog.error(i.Msg) : n.ADialog.error(n.Msg.getMsg("ErrorDeletingRecord")); e = !1 } else e = !1 }) } }); e = f.find(".vis-mas-ver-chkImmSave"); s = f.find(".vis-mas-ver-secValFrom"); u = f.find(".vis-mas-ver-dtVerVal"); e.on("click", function () { s.toggle(); e.prop("checked") || (r._newRec ? u.val(r.getDateString(!0)) : u.val(r.getDateString())) }); u.on("change", function () { var n = new Date(u.val()).setHours(0, 0, 0, 0), t = (new Date).setHours(0, 0, 0, 0); n == t && u.val(r.getDateString()); r._newRec && n >= t && u.val(r.getDateString(!0)) }); this.busyInd = f.parent().find(".vis-busyindicatorouterwrap") }; i.prototype.getMasterVersionUI = function (i) { return t('<div class= "vis-mas-ver-outerwrap"><div class="vis-mas-ver-text">' + n.Msg.getMsg("VersioningColsFoundValidFrom") + '<\/div><div style="display: flex;"><div class="vis-mas-ver-checkwrap"><input type="checkbox" class="vis-mas-ver-ImmSav vis-mas-ver-chkImmSave" checked="checked"><label>' + n.Msg.getMsg("SaveImmediate") + '<\/label><\/div><div class="vis-mas-ver-fieldwrap vis-mas-ver-checkwrap vis-mas-ver-secValFrom" style="display: none;"><label>' + n.Msg.getMsg("VersionValidFrom") + '<\/label><input type="date" class="vis-mas-ver-ImmSav vis-mas-ver-dtVerVal"><\/div><\/div>' + this.getGrid(i) + '<\/div><div class="vis-busyindicatorouterwrap" style="visibility: hidden;"><div class="vis-busyindicatorinnerwrap"><i class="vis-busyindicatordiv"><\/i><\/div><\/div>') }; i.prototype.getGrid = function (i) { var a, o, s, l, h, p, e; if (this.htmlUI.push('<div class= "vis-mas-ver-gridSection" style="min-height: 300px;">'), this.htmlUI.push("<table>"), a = n.Application.contextUrl + "Areas/VIS/Images/base/delete10.png", this.htmlUI.push('<thead class="vis-mas-ver-gridData">'), this.htmlUI.push(this.createHeaders()), this.htmlUI.push("<\/thead>"), i && i.Table) if (i.Table.length > 0) { for (this.htmlUI.push("<tbody>"), o = 0; o < i.Table.length; o++) { var v = i.Table[o], c = Object.keys(v), u = {}; for (s = 0; s < c.length; s++)u[c[s].toUpperCase()] = v[c[s]]; for (l = "", o % 2 == 0 && (l = "style='background-color: #ebf1f3;'"), this.htmlUI.push('<tr recid="' + u[this._tblName.toUpper() + "_VER_ID"] + '"  ' + l + ' class="vis-mas-ver-recRow">'), h = 0; h < this.gridCols.length; h++) { var r = this.gridCols[h], f = t.grep(this.gFields, function (n) { return n.vo.ColumnName.toUpper() == r })[0], y = "---"; u[r + "_TXT"] ? this.htmlUI.push("<td>" + n.Utility.encodeText(u[r + "_TXT"]) + "<\/td>") : r == "ACTION" ? this.deletable && this.htmlUI.push("<td style='text-align: center;'><button class='vis-mas-ver-btnDel'><img src='" + a + "' /><\/button><\/td>") : u[r + "_LOC"] || u[r + "_LTR"] || u[r + "_ASI"] || u[r + "_ACT"] || u[r + "_CTR"] ? (f && (y = f.getLookup().getDisplay(f.value)), this.htmlUI.push("<td>" + n.Utility.encodeText(y) + "<\/td>")) : u[r] ? r == "ISVERSIONAPPROVED" || f && f.vo && f.vo.displayType && f.vo.displayType == 20 ? u[r] == "Y" ? this.htmlUI.push('<td style="text-align: center;"><input type="checkbox" checked="checked" disabled><\/td>') : this.htmlUI.push('<td style="text-align: center;"><input type="checkbox" disabled><\/td>') : r == "VERSIONVALIDFROM" ? (p = Globalize.format(new Date(u[r]), "d"), this.htmlUI.push('<td class="vis-mas-ver-valFromDate" valdt="' + new Date(u[r]) + '">' + p + "<\/td>")) : f && f.vo && f.vo.displayType && f.vo.displayType == 15 ? (e = Globalize.format(new Date(u[r]), "d"), this.htmlUI.push('<td dtDate="' + new Date(u[r]) + '">' + e + "<\/td>")) : f && f.vo && f.vo.displayType && f.vo.displayType == 16 ? (e = Globalize.format(new Date(u[r] + "Z"), "f"), this.htmlUI.push('<td dtDate="' + new Date(u[r]) + '">' + e + "<\/td>")) : f && f.vo && f.vo.displayType && f.vo.displayType == 24 ? (e = Globalize.format(new Date(u[r] + "Z"), "t"), this.htmlUI.push('<td dtDate="' + new Date(u[r]) + '">' + e + "<\/td>")) : r == "RECORDVERSION" ? this.htmlUI.push('<td style="text-align: center">' + n.Utility.encodeText(u[r]) + "<\/td>") : this.htmlUI.push("<td>" + n.Utility.encodeText(u[r]) + "<\/td>") : this.htmlUI.push("<td> --- <\/td>") } this.htmlUI.push("<\/tr>") } this.htmlUI.push("<\/tbody>") } else this.htmlUI.push(this.getNoRecDiv()); else this.htmlUI.push(this.getNoRecDiv()); return this.htmlUI.push("<\/table>"), this.htmlUI.push("<\/div>"), this.htmlUI.join(" ") }; i.prototype.createHeaders = function () { var t = [], r, i; if (t.push('<tr style="border-bottom: 2px #b5b3b3 solid;">'), this.gFields && this.gFields.length > 0) { for (this.createVerColsHdrs(t, this.defaultColsIniPos, this.defaultColEleIniPos), r = 0; r < this.gFields.length; r++)i = this.gFields[r], (i.vo.IsMaintainVersions || this.maintTblVer) && this.exclCols.indexOf(i.vo.ColumnName) < 0 && (this.gridCols.push(i.vo.ColumnName.toUpper()), i.vo.displayType == 20 ? t.push('<th style="text-align: center;">' + n.Utility.encodeText(i.vo.Header) + "<\/th>") : t.push("<th>" + n.Utility.encodeText(i.vo.Header) + "<\/th>")); this.createVerColsHdrs(t, this.defaultCols, this.defaultColElements) } return t.push("<\/tr>"), t.join(" ") }; i.prototype.createVerColsHdrs = function (t, i, r) { for (var u = 0; u < i.length; u++)this.gridCols.push(r[u]), r[u] == "ACTION" ? this.deletable && t.push('<th style="text-align: center;">' + n.Utility.encodeText(i[u]) + "<\/th>") : r[u] == "ISVERSIONAPPROVED" || r[u] == "RECORDVERSION" ? t.push('<th style="text-align: center;">' + n.Utility.encodeText(i[u]) + "<\/th>") : t.push("<th>" + n.Utility.encodeText(i[u]) + "<\/th>") }; i.prototype.getDateString = function (n) { var t = new Date, u, i, r; return n ? t.setDate(t.getDate() - 1) : t.setDate(t.getDate() + 1), u = t.getFullYear(), i = t.getMonth() + 1, i < 10 && (i = "0" + i), r = t.getDate(), r < 10 && (r = "0" + r), u + "-" + i + "-" + r }; i.prototype.getNoRecDiv = function () { return '<div class="vis-mas-ver-norecord">' + n.Utility.encodeText(n.Msg.getMsg("NoRecords")) + "<\/div>" }; i.prototype.setBusy = function (n) { var t = this.busyInd; t && t.css("visibility", n ? "visible" : "hidden") }; n.MasterDataVersion = i }(VIS, jQuery); VIS = window.VIS || {}, function () { function n() { var i, t, n, r; this.record_ID = 0; this.windowNo = 0; this.curTab = null; this.selectedRow = null; this.panelWidth; this.extraInfo = null; this.init = function () { if (i = $('<div style="height:100%;width:100%"><\/div>'), window.VA037) t = $('<iframe height=100%; width="100%"; frameborder="0" ><\/iframe>'), i.html(t); else { var n = $('<span class="vis-bi-tab-panel">' + VIS.Msg.getMsg("PleaseInstallBIReportTool") + "<\/span>"); i.append(n) } }; this.update = function (n) { r(n) }; this.getRoot = function () { return i }; n = this; r = function (i) { var u, f, e, r, o; if (t) { if (u = n.extraInfo, f = u.match(/\@.+?\@/g), f) for (e = 0; e < f.length; e++)r = f[e].replaceAll("@", ""), VIS.Env.getCtx().getContext(r).length > 0 ? r = VIS.Env.getCtx().getContext(r) : VIS.Env.getCtx().getContext(n.windowNo, r).length > 0 ? r = VIS.Env.getCtx().getContext(n.windowNo, r) : VIS.Env.getCtx().getContext(n.windowNo, n.curTab().getTabNo(), r).length > 0 && (r = VIS.Env.getCtx().getContext(n.windowNo, n.curTab().getTabNo(), r)), u = u.replaceAll(f[e], r); o = VIS.Application.contextUrl + "BiPanel/GetUserBILogin?recID=" + i + "&extraInfo=" + window.encodeURIComponent(u); t.prop("src", o) } }; this.disposeComponent = function () { t && t.remove(); i.remove(); t = null; i = null } } n.prototype.startPanel = function (n, t, i) { this.windowNo = n; this.curTab = t; this.extraInfo = i; this.init() }; n.prototype.refreshPanelData = function (n, t) { this.record_ID = n; this.selectedRow = t; this.update(n) }; n.prototype.sizeChanged = function (n) { this.panelWidth = n }; n.prototype.dispose = function () { this.disposeComponent() }; VIS.BiPanel = n }(); VIS = window.VIS || {}, function (n, t) { function i() { n.CalloutEngine.call(this, "calloutColumn") } function u() { n.CalloutEngine.call(this, "VIS.CalloutCheckDocAction") } function f() { n.CalloutEngine.call(this, "VIS.CalloutGetTableID") } var r = n.Utility.Util; n.Utility.inheritPrototype(i, n.CalloutEngine); i.prototype.setDBColumnName = function (i, r, u, f, e, o) { if (!this.isCalloutActive() && e != null && e != 0) { this.setCalloutActive(!0); var s = u; return t.ajax({ url: n.Application.contextUrl + "VIS/CalloutColumn/GetDBColunName", data: { AD_Element_ID: e }, success: function (n) { n && s.setValue("ColumnName", n) }, error: function (n) { this.log.severe(n) } }), this.setCalloutActive(!1), i = r = u = f = e = o = null, "" } }; i.prototype.checkColumnLength = function (t, i, r, u, f, e) { if (!this.isCalloutActive() && f != null && f != 0) return this.setCalloutActive(!0), f.length > 43 && (u.setValue(""), n.ADialog.error("VIS_CheckColumnLength")), this.setCalloutActive(!1), t = i = r = u = f = e = null, "" }; i.prototype.checkTableLength = function (t, i, r, u, f, e) { if (!this.isCalloutActive() && f != null && f != 0) return this.setCalloutActive(!0), f.length > 40 && (u.setValue(""), n.ADialog.error("VIS_CheckTableLength")), this.setCalloutActive(!1), t = i = r = u = f = e = null, "" }; i.prototype.checkOrgAccess = function (i, u, f, e, o, s) { if (!this.isCalloutActive() && o != null) { var h = r.getValueOfInt(f.getValue("AD_User_ID")); return this.setCalloutActive(!0), t.ajax({ url: n.Application.contextUrl + "VIS/CalloutColumn/CheckOrgAccessByRole", data: { AD_Role_ID: o, AD_User_ID: h }, success: function (t) { t == "NoRoleAcc" && n.ADialog.warn("VIS_NoRoleAccess"); t == "NoUserAcc" && n.ADialog.warn("VIS_NoUserAccess") }, error: function (n) { this.log.severe(n) } }), this.setCalloutActive(!1), i = u = f = e = o = s = null, "" } }; i.prototype.buttonDisable = function (n, t, i, r, u, f) { if (!this.isCalloutActive() && u != null) return this.setCalloutActive(!0), i.setValue("IsExpireLink", "N"), this.setCalloutActive(!1), n = t = i = r = u = f = null, "" }; i.prototype.SetBIUserName = function (i, u, f, e, o, s) { if (!this.isCalloutActive() && o != null) { this.setCalloutActive(!0); var h = r.getValueOfInt(f.getValue("AD_User_ID")); return t.ajax({ url: n.Application.contextUrl + "VIS/CalloutColumn/GetEmailAddress", data: { AD_User_ID: h }, async: !1, success: function (n) { n && f.setValue("VA037_BIUserName", n) }, error: function (n) { this.log.severe(n) } }), this.setCalloutActive(!1), i = u = f = e = o = s = null, "" } }; n.calloutColumn = i; n.Utility.inheritPrototype(u, n.CalloutEngine); u.prototype.CheckDocActionInTable = function (t, i, u, f, e) { if (this.isCalloutActive() || e == null || e.toString() == "") return ""; this.setCalloutActive(!0); var o = n.dataContext.getJSONRecord("VIS/SurveyPanel/CheckDocActionInTable", r.getValueOfInt(e)); return o ? u.setValue("IsDocAction", "Y") : u.setValue("IsDocAction", "N"), this.setCalloutActive(!1), "" }; n.CalloutCheckDocAction = u; n.Utility.inheritPrototype(f, n.CalloutEngine); f.prototype.CalloutGetTableIDByTab = function (t, i, u, f, e) { var o, s; return this.isCalloutActive() || e == null || e.toString() == "" ? "" : (this.setCalloutActive(!0), o = n.dataContext.getJSONRecord("VIS/SurveyPanel/CalloutGetTableIDByTab", r.getValueOfInt(e)), u.setValue("AD_Table_ID", o), s = n.dataContext.getJSONRecord("VIS/SurveyPanel/CheckDocActionInTable", r.getValueOfInt(o)), s ? u.setValue("IsDocAction", "Y") : u.setValue("IsDocAction", "N"), this.setCalloutActive(!1), "") }; n.CalloutGetTableID = f }(VIS, jQuery), function (n) { function t() { function t(t) { n.indexOf(t) < 0 && n.push(t) } function i(t) { var i = n.indexOf(t); i > -1 && n.splice(i, 1) } function r(t) { for (var i = 0, r = n.length; i < r; i++)if (n[i].onmessage) n[i].onmessage(t) } function u() { var n = new EventSource("Message/Get"); n.onmessage = function (n) { var t = JSON.parse(n.data), i, u; if (t && t.length > 0) for (i = 0, u = t.length; i < u; i++)t[i].Event == "MSG" ? toastr.success(t[i].Message, "", { timeOut: 4e3, positionClass: "toast-top-center", closeButton: !0 }) : t[i].Event == "LOGIN" || t[i].Event == "LOGOFF" || r(t[i]) } } var n = []; return { start: u, register: t, unregister: i } } n.sseManager = t() }(VIS, jQuery); VIS = window.VIS || {}, function () { function n() { this.record_ID = 0; this.windowNo = 0; this.curTab = null; this.selectedRow = null; this.panelWidth; var t = $('<div class="vis-mas-verinf-wrap"><\/div>'), n = null; this.init = function () { var i = '<div class="vis-mas-verinf-hdrCtr"><div class="vis-mas-verinf-hdrsLft">' + VIS.Msg.getMsg("FieldName") + '<\/div><div class="vis-mas-verinf-hdrsRgt">' + VIS.Msg.getMsg("OldValue") + '<\/div><\/div><div class="vis-mas-verinf-CngCtr"><\/div>'; t.append(i); n = t.find(".vis-mas-verinf-CngCtr") }; this.getRoot = function () { return t }; this.update = function () { try { if (this.selectedRow.recordversion > 1) { this.selectedRow.RID = this.record_ID; this.selectedRow.TName = this.curTab.vo.TableName; this.selectedRow.TabID = this.curTab.vo.AD_Tab_ID; this.selectedRow.TblID = this.curTab.vo.AD_Table_ID; var t = this; $.ajax({ type: "POST", async: !0, url: VIS.Application.contextUrl + "JsonData/GetVerInfo", contentType: "application/json; charset=utf-8", data: "{ 'RowData': '" + JSON.stringify(this.selectedRow) + "' }", success: function (i) { var s = t.curTab, u, o, f, e, r; if (n.empty(), i && (u = JSON.parse(i), u.ColumnNames && u.ColumnNames.length > 0)) { for (o = [], f = 0; f < u.ColumnNames.length; f++) { e = 10; try { e = $.grep(t.curTab.gridTable.gTable.m_fields, function (n) { return n._vo.ColumnName == u.DBColNames[f] })[0]._vo.displayType } catch (h) { e = 10 } r = u.OldVals[f]; e == 15 ? r = Globalize.format(new Date(r), "d") : e == 16 ? r = Globalize.format(new Date(r + "Z"), "f") : e == 24 && (r = Globalize.format(new Date(r + "Z"), "t")); u.OldVals[f] == "" && (r = "&nbsp"); o.push('<div class="vis-mas-verinf-cntCtr"><div class="vis-mas-verinf-cnt">' + u.ColumnNames[f] + '<\/div><div class="vis-mas-verinf-cnt">' + r + "<\/div><\/div>") } n.append(o.join(" ")) } }, error: function () { } }) } else this.selectedRow.recordversion == 1 ? (n.empty(), n.append('<div class="vis-mas-verinf-newrecord">' + VIS.Msg.getMsg("FirstVersion") + "<\/div>")) : (n.empty(), n.append('<div class="vis-mas-verinf-newrecord">' + VIS.Msg.getMsg("NoVersionsFound") + "<\/div>")) } catch (i) { } }; this.disposeComponent = function () { this.record_ID = 0; this.windowNo = 0; this.curTab = null; this.rowSource = null; this.panelWidth = null; t.remove(); t = null } } n.prototype.startPanel = function (n, t) { this.windowNo = n; this.curTab = t; this.init() }; n.prototype.refreshPanelData = function (n, t) { this.record_ID = n; this.selectedRow = t; this.update(n) }; n.prototype.sizeChanged = function (n, t) { this.panelWidth = t }; n.prototype.dispose = function () { this.disposeComponent() }; VIS.verinfo = n }(); VIS = window.VIS || {}, function () { function n() { function l() { var u = t.closest(".vis-ad-w-p-ap-tp-outerwrap"), o = u.find(".vis-ad-w-p-ap-tp-o-b-head"), e = u.find(".vis-ad-w-p-ap-tp-o-b-content"), i = u.height(), r = o.height() + 40, s = e.height(), f; e.css("height", i - r); f = $("#VIS_pagingHtml" + n).height() + 10; $("#VIS_recordDetail" + n).is(":visible") ? ($("#VIS_recordDetail" + n).css("height", (i - r) / 2 + 50), $("#VIS_HistoryGrd" + n).css("height", (i - r) / 2 - f - 50)) : $("#VIS_HistoryGrd" + n).css("height", i - (r + f)) } function ct() { if (u > 0) { if (w = u % nt == 0 ? u / nt : Math.floor(u / nt) + 1, h = VIS.Utility.Util.getValueOfInt($("#VIS_ddlPages" + n).find(":selected").val()) > 0 ? VIS.Utility.Util.getValueOfInt($("#VIS_ddlPages" + n).find(":selected").val()) : 1, h > 0 && (kt = h - 1), w >= h + 1 && (dt = h + 1), VIS.Utility.Util.getValueOfInt($("#VIS_ddlPages" + n).find(":selected").val()) <= 0 || $("#VIS_ddlPages" + n).children("option").length <= 0) { $("#VIS_ddlPages" + n).empty(); for (var t = 1; t <= w; t++)t == 1 ? $("#VIS_ddlPages" + n).append(new Option(t, t, !0, !0)) : $("#VIS_ddlPages" + n).append(new Option(t, t, !1, !1)) } w > 1 && w > VIS.Utility.Util.getValueOfInt($("#VIS_ddlPages" + n).find(":selected").val()) ? $("#VIS_pagingText" + n).html('<span class="vis-ad-w-p-s-statusdb" id="VIS_pageIndx' + n + '">1/' + k + "<\/span><span>Showing Result " + ((h - 1) * nt + 1) + "-" + h * nt + " of " + u + "<\/span>") : w > 1 && w == VIS.Utility.Util.getValueOfInt($("#VIS_ddlPages" + n).find(":selected").val()) ? $("#VIS_pagingText" + n).html('<span class="vis-ad-w-p-s-statusdb" id="VIS_pageIndx' + n + '">1/' + k + "<\/span><span>Showing Result " + ((h - 1) * nt + 1) + "-" + u + " of " + u + "<\/span>") : w == 1 && $("#VIS_pagingText" + n).html('<span class="vis-ad-w-p-s-statusdb" id="VIS_pageIndx' + n + '">1/' + k + "<\/span><span>Showing Result 1-" + u + " of " + u + "<\/span>") } else $("#VIS_pagingText" + n).html('<span class="vis-ad-w-p-s-statusdb" id="VIS_pageIndx' + n + '">0/0<\/span><span>Showing Result 0-0 of 0<\/span>'), $("#VIS_ddlPages" + n).empty() } function ft(t, i) { $.ajax({ url: VIS.Application.contextUrl + "VIS/HistoryDetailsData/GetHistoryRecordsCount", data: { RecordId: t, AD_Table_ID: i }, success: function (i) { var r = []; r = JSON.parse(i); r != null && (u = r, $("#VIS_ddlPages" + n).empty(), ct(t, 0)) }, error: function () { } }) } function gt() { s = $("#VIS_ddlPages" + n).find(":selected").val(); it(c, VIS.Utility.Util.getValueOfInt(s), n, b); h = s } function it(n, t, i, r) { $("#VIS_tabPanelDataLoader" + i).show(); $.ajax({ url: VIS.Application.contextUrl + "VIS/HistoryDetailsData/GetHistoryRecordDetails", data: { RecordId: n, AD_Table_ID: r, CurrentPage: t }, success: function (u) { var f = []; if (f = JSON.parse(u), f != null) { tt = f; et(f, i, !1); $("#VIS_recordDetail" + i).hide(); l(); VIS.Utility.Util.getValueOfInt(t) > 0 && ct(n, VIS.Utility.Util.getValueOfInt(t)); $("#VIS_tabPanelDataLoader" + i).hide(); $("#VIS_ddlPages" + i).one("change", gt); $("#VIS_prevPage" + i).one("click"); $("#VIS_nextPage" + i).one("click"); $("#VIS_prevPage" + i).one("click", function (n) { s = $("#VIS_ddlPages" + i).find(":selected").val(); VIS.Utility.Util.getValueOfInt(s) > 1 && ($("#VIS_prevPage" + i).off("click"), $("#VIS_ddlPages" + i).off("change"), it(c, VIS.Utility.Util.getValueOfInt(s) - 1, i, r), h = s, $("#VIS_ddlPages" + i).val(VIS.Utility.Util.getValueOfInt(s) - 1), n.stopPropagation(), n.stopImmediatePropagation()) }); $("#VIS_nextPage" + i).one("click", function (n) { s = $("#VIS_ddlPages" + i).find(":selected").val(); VIS.Utility.Util.getValueOfInt(s) < $("#VIS_ddlPages" + i).children("option").length && ($("#VIS_nextPage" + i).off("click"), $("#VIS_ddlPages" + i).off("change"), it(c, VIS.Utility.Util.getValueOfInt(s) + 1, i, r), h = s, $("#VIS_ddlPages" + i).val(VIS.Utility.Util.getValueOfInt(s) + 1), n.stopPropagation(), n.stopImmediatePropagation()) }) } }, error: function () { } }) } function et(n, r, u) { var a = $('<div class="VIS-tabPanelDataLoader" id="VIS_tabPanelDataLoader' + r + '"><i class="fa fa-spinner fa-pulse fa-3x fa-fw"><\/i><\/div>'), o = $('<div class="VIS-tp-mainContainer"><\/div>'), h = $('<div class="VIS-tp-topSearchWrp"><button id="VIS_btnRefresh' + r + '" class="VIS-tp-refreshIcon" ><i class="vis vis-refresh"><\/i><\/button><div class="VIS-tp-searchControl"><input id="VIS_txtSearch' + r + '" type="text" placeholder="Search"><i id="VIS_faSearch' + r + '" class="fa fa-search"><\/i><\/div><\/div>'), s, e, f; if (n.length > 0) { for (s = $('<div class="VIS-tp-recordswrap"><\/div>'), k = n.length, $("#VIS_pageIndx" + r).text("1/" + k), f = 0; f < n.length; f++)n[f].Type.toLower() == "email" ? e = $('<div data-rid="' + n[f].ID + '" data-username="' + n[f].UserName + '" data-winno="' + r + '" data-atype="email" data-recid="' + f + '" id="rowId' + f + '" class="VIS-tp-recordWrap "><div data-recid="' + f + '" class= "VIS-tp-recordIcon" ><i data-recid="' + f + '" class="vis vis-email"><\/i><\/div ><div data-recid="' + f + '" class="VIS-tp-recordInfo"><h6 data-recid="' + f + '">' + new Date(n[f].Created).toLocaleString() + '<\/h6><div data-recid="' + f + '" class="VIS-tp-recordSubject"><i data-recid="' + f + '" class="fa fa-arrow-up"><\/i><p data-recid="' + f + '">' + n[f].Subject + '<\/p><\/div><\/div><div data-recid="' + f + '" class="VIS-tp-recordInfoRight"><i data-recid="' + f + (VIS.Utility.Util.getValueOfString(n[f].HasAttachment) == "true" ? '" class="vis vis-attachment1"><\/i>' : '"><\/i>') + '<small data-recid="' + f + '">By: ' + n[f].UserName + "<\/small><\/div><\/div>") : n[f].Type.toLower() == "inbox" ? e = $('<div data-rid="' + n[f].ID + '" data-username="' + n[f].UserName + '" data-winno="' + r + '" data-atype="email" data-recid="' + f + '" id="rowId' + f + '" class="VIS-tp-recordWrap "><div data-recid="' + f + '" class= "VIS-tp-recordIcon" ><i data-recid="' + f + '" class="vis vis-email"><\/i><\/div ><div data-recid="' + f + '" class="VIS-tp-recordInfo"><h6 data-recid="' + f + '">' + new Date(n[f].Created).toLocaleString() + '<\/h6><div data-recid="' + f + '" class="VIS-tp-recordSubject"><i data-recid="' + f + '" class="fa fa-arrow-down"><\/i><p data-recid="' + f + '">' + n[f].Subject + '<\/p><\/div><\/div><div data-recid="' + f + '" class="VIS-tp-recordInfoRight"><i data-recid="' + f + (VIS.Utility.Util.getValueOfString(n[f].HasAttachment) == "true" ? '" class="vis vis-attachment1"><\/i>' : '"><\/i>') + '<small data-recid="' + f + '">By: ' + n[f].UserName + "<\/small><\/div><\/div>") : n[f].Type.toLower() == "call" ? e = $('<div data-rid="' + n[f].ID + '" data-username="' + n[f].UserName + '" data-winno="' + r + '" data-atype="call" data-recid="' + f + '" id="rowId' + f + '" class="VIS-tp-recordWrap  "><div data-recid="' + f + '" class= "VIS-tp-recordIcon" ><i data-recid="' + f + '" class="fa fa-phone" aria-hidden="true" title="Call" ><\/i><\/div ><div data-recid="' + f + '" class="VIS-tp-recordInfo"><h6 data-recid="' + f + '">' + new Date(n[f].Created).toLocaleString() + '<\/h6><div data-recid="' + f + '" class="VIS-tp-recordSubject"><p data-recid="' + f + '">' + n[f].Subject + '<\/p><\/div><\/div><div data-recid="' + f + '" class="VIS-tp-recordInfoRight"><i data-recid="' + f + (VIS.Utility.Util.getValueOfString(n[f].HasAttachment) == "true" ? '" class="vis vis-attachment1">&nbsp;<\/i>' : '">&nbsp;<\/i>') + '<small data-recid="' + f + '">By: ' + n[f].UserName + "<\/small><\/div><\/div>") : n[f].Type.toLower() == "chat" ? e = $('<div data-rid="' + n[f].ID + '" data-username="' + n[f].UserName + '" data-winno="' + r + '" data-atype="chat" data-recid="' + f + '" id="rowId' + f + '" class="VIS-tp-recordWrap  "><div data-recid="' + f + '" class= "VIS-tp-recordIcon" ><i data-recid="' + f + '" class="vis vis-chat" title="chat" ><\/i><\/div ><div data-recid="' + f + '" class="VIS-tp-recordInfo"><h6 data-recid="' + f + '">' + new Date(n[f].Created).toLocaleString() + '<\/h6><div data-recid="' + f + '" class="VIS-tp-recordSubject"><p data-recid="' + f + '">' + n[f].Subject + '<\/p><\/div><\/div><div data-recid="' + f + '" class="VIS-tp-recordInfoRight"><i data-recid="' + f + '">&nbsp;<\/i><small data-recid="' + f + '">By: ' + n[f].UserName + "<\/small><\/div><\/div>") : n[f].Type.toLower() == "letter" ? e = $('<div data-rid="' + n[f].ID + '" data-username="' + n[f].UserName + '" data-winno="' + r + '" data-atype="letter" data-recid="' + f + '" id="rowId' + f + '" class="VIS-tp-recordWrap "><div data-recid="' + f + '" class= "VIS-tp-recordIcon" ><i data-recid="' + f + '" class="vis vis-letter"><\/i><\/div ><div data-recid="' + f + '" class="VIS-tp-recordInfo"><h6 data-recid="' + f + '">' + new Date(n[f].Created).toLocaleString() + '<\/h6><div data-recid="' + f + '" class="VIS-tp-recordSubject"><p data-recid="' + f + '">' + n[f].Subject + '<\/p><\/div><\/div><div data-recid="' + f + '" class="VIS-tp-recordInfoRight"><i data-recid="' + f + (VIS.Utility.Util.getValueOfString(n[f].HasAttachment) == "true" ? '" class="vis vis-attachment1">&nbsp;<\/i>' : '">&nbsp;<\/i>') + '<small data-recid="' + f + '">By: ' + n[f].UserName + "<\/small><\/div><\/div>") : n[f].Type.toLower() == "appointment" ? e = $('<div data-rid="' + n[f].ID + '" data-username="' + n[f].UserName + '" data-winno="' + r + '" data-atype="appointment" data-recid="' + f + '" id="rowId' + f + '" class="VIS-tp-recordWrap "><div data-recid="' + f + '" class="VIS-tp-recordIcon"><i data-recid="' + f + '" class="vis vis-appointment" title="appointment"><\/i><\/div><div data-recid="' + f + '" class="VIS-tp-recordInfo"><h6 data-recid="' + f + '">' + new Date(n[f].Created).toLocaleString() + '<\/h6><div data-recid="' + f + '" class="VIS-tp-recordSubject"><p data-recid="' + f + '">' + n[f].Subject + '<\/p><\/div><\/div><div data-recid="' + f + '" class="VIS-tp-recordInfoRight"><i data-recid="' + f + '">&nbsp;<\/i><small data-recid="' + f + '">By: ' + n[f].UserName + "<\/small><\/div><\/div>") : n[f].Type.toLower() == "task" ? e = $('<div data-rid="' + n[f].ID + '" data-username="' + n[f].UserName + '" data-winno="' + r + '" data-atype="task" data-recid="' + f + '" id="rowId' + f + '" class="VIS-tp-recordWrap "><div data-recid="' + f + '" class="VIS-tp-recordIcon"><i data-recid="' + f + '" class="vis vis-task" title="task"><\/i><\/div><div data-recid="' + f + '" class="VIS-tp-recordInfo"><h6 data-recid="' + f + '">' + new Date(n[f].Created).toLocaleString() + '<\/h6><div data-recid="' + f + '" class="VIS-tp-recordSubject"><p data-recid="' + f + '">' + n[f].Subject + '<\/p><\/div><\/div><div data-recid="' + f + '" class="VIS-tp-recordInfoRight">' + (n[f].IsTaskClosed ? '<span data-recid="' + f + '" class="VIS-tp-taskTag">' + VIS.Msg.getMsg("Closed") + "<\/span>" : "") + '<i data-recid="' + f + '">&nbsp;<\/i><small data-recid="' + f + '" >By: ' + n[f].UserName + "<\/small><\/div><\/div>") : n[f].Type.toLower() == "attachment" && (e = $('<div data-rid="' + n[f].ID + '" data-username="' + n[f].UserName + '" data-winno="' + r + '" data-atype="attachment" data-recid="' + f + '" id="rowId' + f + '" class="VIS-tp-recordWrap "><div data-recid="' + f + '" class= "VIS-tp-recordIcon" title="attachment"><i data-recid="' + f + '" class="vis vis-attachmentx"><\/i><\/div ><div data-recid="' + f + '" class="VIS-tp-recordInfo"><h6 data-recid="' + f + '">' + new Date(n[f].Created).toLocaleString() + '<\/h6><div data-recid="' + f + '" class="VIS-tp-recordSubject"><p data-recid="' + f + '">' + n[f].Subject + '<\/p><\/div><\/div><div data-recid="' + f + '" class="VIS-tp-recordInfoRight"><i data-recid="' + f + '" >&nbsp;<\/i><small data-recid="' + f + '" >By: ' + n[f].UserName + "<\/small><\/div><\/div>")), s.append(e); u ? (t.find(".VIS-tp-recordswrap").empty(), t.find(".VIS-tp-recordswrap").append(s.html())) : (o.append(a).append(h).append(s), g.empty(), g.append(o)); t.find(".VIS-tp-recordWrap").click(function (n) { var s = n.target, f = ""; f = VIS.Utility.Util.getValueOfInt($(s).data("recid")); t.find("#rowId" + f).addClass("VIS-tp-selectedRecord"); VIS.Utility.Util.getValueOfInt(i) >= 0 && f != VIS.Utility.Util.getValueOfInt(i) && t.find("#rowId" + i).hasClass("VIS-tp-selectedRecord") && t.find("#rowId" + i).removeClass("VIS-tp-selectedRecord"); i = f; $("#VIS_pageIndx" + r).text(VIS.Utility.Util.getValueOfInt(i) + 1 + "/" + k); var u = t.find("#rowId" + f).data("atype").toString().toUpper(), e = t.find("#rowId" + f).data("rid"), o = t.find("#rowId" + f).data("username"); $("#VIS_recordDetail" + r).show(); u == "EMAIL" || u == "INBOX" ? lt(e, o, r) : u == "CALL" ? vt(e, o, r) : u == "APPOINTMENT" ? yt(e, o, r) : u == "LETTER" ? at(e, o, r) : u == "TASK" ? pt(e, o, r) : u == "ATTACHMENT" ? wt(e, o, r) : u == "CHAT" && ot(e, o, r); l() }); $("#VIS_txtSearch" + r).keyup(function (n) { var t; if ((n.keyCode == undefined || n.keyCode == 13 || n.keyCode == 8) && (t = $(this).val(), t !== "" || n.keyCode == 13)) { var i = [], u = new RegExp(t, "i"), f = 0; $.each(tt, function (n, t) { (t.Subject.search(u) != -1 || t.UserName.search(u) != -1) && (i[f] = t, f++) }); et(i, r, !0); $("#VIS_recordDetail" + r).fadeOut(100); $("#VIS_recordDetail" + r).hide(); t === "" && n.keyCode == 13 ? $("#VIS_pagingHtml" + r).show() : $("#VIS_pagingHtml" + r).hide() } }); $("#VIS_btnRefresh" + r).click(function () { VIS.Utility.Util.getValueOfInt(c) > 0 && (ft(c, b), it(c, 0, r, b)); $("#VIS_recordDetail" + r).hide(); $("#VIS_pagingHtml" + r).show() }); $("#VIS_faSearch" + r).click(function () { var n = $("#VIS_txtSearch" + r).val(); if (n === "") VIS.Utility.Util.getValueOfInt(c) > 0 && (ft(c, b), it(c, 0, r, b)), $("#VIS_recordDetail" + r).hide(), $("#VIS_pagingHtml" + r).show(); else { var t = [], i = new RegExp(n, "i"), u = 0; $.each(tt, function (n, r) { (r.Subject.search(i) != -1 || r.UserName.search(i) != -1) && (t[u] = r, u++) }); et(t, r, !0); $("#VIS_recordDetail" + r).fadeOut(100); $("#VIS_recordDetail" + r).hide(); $("#VIS_pagingHtml" + r).hide() } }) } else o.append(h), g.empty(), g.append(o) } function o(n, t) { var o, u, f, r, e = -1; tt != null && VIS.Utility.Util.getValueOfInt(n) >= 0 && VIS.Utility.Util.getValueOfInt(n) < tt.length && (e = VIS.Utility.Util.getValueOfInt(n), o = tt[e], u = o.ID, f = o.UserName, r = VIS.Utility.Util.getValueOfString(o.Type).toUpper(), $("#rowId" + e).addClass("VIS-tp-selectedRecord"), VIS.Utility.Util.getValueOfInt(i) >= 0 && e != VIS.Utility.Util.getValueOfInt(i) && $("#rowId" + i).hasClass("VIS-tp-selectedRecord") && $("#rowId" + i).removeClass("VIS-tp-selectedRecord"), i = e, $("#VIS_pageIndx" + t).text(VIS.Utility.Util.getValueOfInt(i) + 1 + "/" + k)); r == "EMAIL" || r == "INBOX" ? lt(u, f, t) : r == "CALL" ? vt(u, f, t) : r == "APPOINTMENT" ? yt(u, f, t) : r == "LETTER" ? at(u, f, t) : r == "TASK" ? pt(u, f, t) : r == "ATTACHMENT" ? wt(u, f, t) : r == "CHAT" && ot(u, f, t) } function lt(n, s, h) { $.ajax({ url: VIS.Application.contextUrl + "VIS/HistoryDetailsData/GetSelectedMailDetails", datatype: "json", type: "get", cache: !1, data: { ID: n }, success: function (c) { var w = JSON.parse(c), it, lt = 0, ot = w.Record_ID, ht = w.AD_Table_ID, ut = 0, nt, tt, ft, et, g, at, b, k, ct; if (it = VIS.Utility.Util.getValueOfString(w.ID), ft = "", et = VIS.Utility.Util.getValueOfString(s).split(" "), ft = et.length > 1 ? VIS.Utility.Util.getValueOfString(et[0]).substring(0, 1).toUpper() + VIS.Utility.Util.getValueOfString(et[1]).substring(0, 1).toUpper() : VIS.Utility.Util.getValueOfString(s).substring(0, 2).toUpper(), VIS.Utility.Util.getValueOfString(w.Cc) != "" || VIS.Utility.Util.getValueOfString(w.Bcc) != "") { if (g = '<div class="dropdown show VIS-tp-dropdownWrap">' + w.To + '<a class="btn dropdown-toggle" style="font-size:.75rem;" href = "#" role = "button" id="dropdownMenuLink" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true" >&nbsp;<i class="fa fa-angle-down VIS-tp-recordLabels"><\/i><\/a><div class="dropdown-menu" aria-labelledby="dropdownMenuLink">', VIS.Utility.Util.getValueOfString(w.Cc) != "") for (nt = VIS.Utility.Util.getValueOfString(w.Cc).split(","), b = 0; b < nt.length; b++)nt[b] != "undefined" && nt[b] != "" && (g += b == 0 ? '<span class="VIS-tp-recordLabels VIS-mail-to">' + VIS.Msg.getMsg("Cc") + ':&nbsp; <\/span><a class="dropdown-item VIS-mail-to" href = "#">' + nt[b] + "<\/a>" : '<a class="dropdown-item VIS-mail-to" href="#">' + nt[b] + "<\/a>"); if (VIS.Utility.Util.getValueOfString(w.Bcc) != "") for (tt = VIS.Utility.Util.getValueOfString(w.Bcc).split(","), k = 0; k < tt.length; k++)tt[k] != "undefined" && tt[k] != "" && (g += k == 0 ? '<span class="VIS-tp-recordLabels VIS-mail-to">' + VIS.Msg.getMsg("Bcc") + ':&nbsp; <\/span><a class="dropdown-item VIS-mail-to" href="#">' + tt[k] + "<\/a>" : '<a class="dropdown-item VIS-mail-to" href="#">' + tt[k] + "<\/a>"); g += "<\/div><\/div>" } else g = w.To; w.Attach != null && w.Attach.length > 0 && (lt = w.Attach.length, ut = w.ID); r.length < 1 && (r = $('<div id="VIS_recordDetail' + h + '" class="VIS-tp-detailPanel"><\/div>')); r.empty(); e = $('<div class="VIS-testPanel VIS-tp-borderBott" ><div class="d-flex align-items-center VIS-tp-leftIcons"><span><i class="fa fa-reply" data-mailto="' + w.To + '" data-mailcc="' + w.Cc + '" data-mailbcc="' + w.Bcc + '" id="VIS_imgReply' + h + '"><\/i><\/span><span><i class="fa fa-reply-all" data-mailto="' + w.To + '" data-mailcc="' + w.Cc + '" data-mailbcc="' + w.Bcc + '" id="VIS_imgReplyAll' + h + '"><\/i><\/span><span><i class="fa fa-share" id="VIS_imgForward' + h + '"><\/i><\/span><\/div><div class= "align-items-center d-flex VIS-tp-rightIcons" ><span id="VIS_prtHistory' + h + '"><i class="vis vis-print" title="Print"><\/i><\/span><span><i id="VIS_prevRecord' + h + '" class="fa fa-arrow-left"><\/i><\/span><span><i id="VIS_nextRecord' + h + '" class="fa fa-arrow-right"><\/i><\/span><span class="VIS-close-btn" id="VIS_btnClose' + h + '"><i class="vis vis-cross"><\/i><\/span><\/div ><\/div > '); at = $('<div class="VIS-tp-contentdiv" ><div id="VIS-tp-comments-input' + h + '" class="VIS-tp-comments-input"><div class="vis-tp-emailDetailWrap"><div class="VIS-mail-user-div"><span class="VIS-mail-user-span">' + ft + '<\/span><\/div><div class="VIS-contentTitile"><span class="VIS-mail-username">' + s + '<\/span><span id="VIS_mailSubject' + h + '" class="VIS-mail-subject VIS-tp-recordLabels">' + w.Title + '<\/span><div class="VIS-mail-content"><div class="VIS-mail-from"><span class="VIS-tp-recordLabels">' + VIS.Msg.getMsg("From") + ':&nbsp;<\/span><span style="word-break: break-word;">' + w.From + "<\/span><\/div><small>" + new Date(w.Date).toLocaleString() + '<\/small><\/div><span class="VIS-mail-to"><span class="VIS-tp-recordLabels">' + VIS.Msg.getMsg("To") + ":&nbsp; <\/span>" + g + '<\/span><\/div><\/div><div id="VIS_mailBody' + h + '" class="VIS-mail-body" >' + w.Detail + '<\/div><\/div ><div id="VIS_viewMoreComments' + h + '" style="display:none;" class="VIS-tp-commentsPanel"><\/div><div id="VIS_commentsdata' + h + '"><div class="pr-0 m-0 VIS-tp-commentsField d-flex flex-column w-100"><p id="VIS_viewAllComments' + h + '" class="vis-attachhistory-view-comments" > ' + VIS.Msg.getMsg("ViewMoreComments") + '<\/p><div class="vis-attachhistory-comments vis-feedMessage m-0"><input id="VIS_txtComments' + h + '" type="text" placeholder="' + VIS.Msg.getMsg("TypeComment") + '"><\/input><span id="VIS_btnComments' + h + '" class="vis-attachhistory-comment-icon vis vis-sms"><\/span><\/div><\/div><\/div>'); f = $('<div class="VIS-tp-contentdiv" ><div class="VIS-tp-comments-input' + h + '" ><div class="vis-tp-emailDetailWrap"<div class="VIS-mail-user-div"><span class="VIS-mail-user-span">' + ft + '<\/span><\/div><div class="VIS-contentTitile"><span class="VIS-mail-username">' + s + '<\/span><span id="mailSubject" class="VIS-mail-subject VIS-tp-recordLabels">' + w.Title + '<\/span><div class="VIS-mail-content"><span class="VIS-mail-from"><span class="VIS-tp-recordLabels">' + VIS.Msg.getMsg("From") + ':&nbsp;<\/span><span style="word-break: break-word;">' + w.From + "<\/span><\/div><small>" + new Date(w.Date).toLocaleString() + '<\/small><\/div><span class="VIS-mail-to"><span class="VIS-tp-recordLabels">' + VIS.Msg.getMsg("To") + ":&nbsp; <\/span>" + g + '<\/span><\/div><\/div><div class="VIS-mail-body" >' + w.Detail + "<\/div><\/div>"); y = $('<div class="VIS-tp-downloadAttachment"><div class="VIS-tp-attachments"><i class="vis vis-attachment1" ><\/i><span> ' + lt + " " + VIS.Msg.getMsg("Attachments") + '<\/span><\/div><div class="VIS-tp-attchDownload" id="dwnldAllAttach"><i class="vis vis-import" title="Download All" style="opacity: 1;"><\/i><span> ' + VIS.Msg.getMsg("VIS_DownloadAll") + "<\/span><\/div><\/div><\/div>"); ct = $('<div class="VIS-tp-emailDetailOuterPanel VIS-tp-recordDetail"><\/div>'); ct.append(at).append(y); r.append(e).append(ct); t.html().toString().contains("VIS_recordDetail" + h) || t.append(r); t.html().toString().contains("VIS_pagingHtml" + h) || t.append(p); v(VIS.Utility.Util.getValueOfInt(it), !1, !1); $("#VIS_recordDetail" + h).show(); $("#dwnldAllAttach").click(function () { ti(n) }); $("#VIS_btnComments" + h).click(function (n) { a(!1, !1, n) }); $("#VIS_txtComments" + h).keyup(function (n) { a(!1, !1, n) }); $("#VIS_viewAllComments" + h).click(function () { $("#VIS_viewAllComments" + h).text() == VIS.Msg.getMsg("HideComments") ? ($("#VIS_viewMoreComments" + h).empty(), $("#VIS_viewMoreComments" + h).hide(), $("#VIS-tp-comments-input" + h).show(), $("#VIS_commentsMsg" + h).show(), $("#VIS_viewAllComments" + h).text(VIS.Msg.getMsg("ViewMoreComments")), v(VIS.Utility.Util.getValueOfInt(it), !1, !1)) : rt(VIS.Utility.Util.getValueOfInt(it), !1, !1) }); $("#VIS_imgReply" + h).click(function (n) { st(ot, ht, "<br><br><hr>" + $("#VIS_mailBody" + h).html(), $("#VIS_mailSubject" + h).text(), ut, "R", n) }); $("#VIS_imgReplyAll" + h).click(function (n) { st(ot, ht, "<br><br><hr>" + $("#VIS_mailBody" + h).html(), $("#VIS_mailSubject" + h).text(), ut, "RA", n) }); $("#VIS_imgForward" + h).click(function (n) { st(ot, ht, "<br><br><hr>" + $("#VIS_mailBody" + h).html(), $("#VIS_mailSubject" + h).text(), ut, "F", n) }); $("#VIS_prtHistory" + h).find("i").click(function () { d(f.html()) }); $("#VIS_prevRecord" + h).click(function () { i > 0 && o(VIS.Utility.Util.getValueOfInt(i) - 1, h) }); $("#VIS_nextRecord" + h).click(function () { i < VIS.Utility.Util.getValueOfInt(u) - 1 && o(VIS.Utility.Util.getValueOfInt(i) + 1, h) }); $("#VIS_btnClose" + h).click(function () { $("#VIS_recordDetail" + h).hide(); l() }) } }) } function at(n, s, h) { $.ajax({ url: VIS.Application.contextUrl + "VIS/HistoryDetailsData/GetSelectedLetterDetails", datatype: "json", type: "get", cache: !1, data: { ID: n }, success: function (c) { var w = JSON.parse(c), b, tt; b = VIS.Utility.Util.getValueOfString(w.ID); var k = "", g = "", nt = VIS.Utility.Util.getValueOfString(s).split(" "); g = nt.length > 1 ? VIS.Utility.Util.getValueOfString(nt[0]).substring(0, 1).toUpper() + VIS.Utility.Util.getValueOfString(nt[1]).substring(0, 1).toUpper() : VIS.Utility.Util.getValueOfString(s).substring(0, 2).toUpper(); w.Attach != null && w.Attach.length > 0 && (k = w.Attach[0].Name); r.length < 1 && (r = $('<div id="VIS_recordDetail' + h + '" class="VIS-tp-detailsPanel"><\/div>')); r.empty(); e = $('<div class="VIS-contentHeadOuter VIS-tp-borderBott" ><div class="VIS-tp-recordIcon" ><i class="vis vis-letter"><\/i><\/div><div class="VIS-contentHead"><span class="VIS-letter-header" >' + VIS.Msg.getMsg("Letter") + '<\/span><\/div><div class="align-items-center d-flex VIS-tp-rightIcons" ><span id="VIS_prtHistory' + h + '"><i class="vis vis-print" title="Print"><\/i><\/span><span><i id="VIS_prevRecord' + h + '" class="fa fa-arrow-left"><\/i><\/span><span><i id="VIS_nextRecord' + h + '" class="fa fa-arrow-right"><\/i><\/span><span class="VIS-close-btn" id="VIS_btnClose' + h + '"><i class="vis vis-cross"><\/i><\/span><\/div><\/div>'); $mailbodyhtml = $('<div class="VIS-tp-contentdiv" ><div id="VIS-tp-comments-input' + h + '" class="VIS-tp-comments-input"><div style="width: 100%"><table height="50px" width="100%"><tr height="50px"><td style="width:60px"><div class="VIS-mail-user-div"><span class="VIS-mail-user-span">' + g + '<\/span><\/div><\/td><td height="50px"><span class="VIS-mail-username">' + s + '<\/span><span id="mailSubject" class="VIS-mail-subject VIS-tp-recordLabels">' + w.Title + '<\/span><span class="VIS-mail-to">&nbsp;<\/span><span class="VIS-mail-from">&nbsp;<\/span><\/td><td height="50px" class="VIS-mail-date">' + new Date(w.Date).toLocaleString() + '<\/td><\/tr><\/table><\/div><div id="mailBody" class="VIS-mail-body" >' + w.Detail + '<\/div><\/div><div id="VIS_viewMoreComments' + h + '" style="display:none;" class="VIS-tp-commentsPanel"><\/div><div id="VIS_commentsdata' + h + '"><div class="pr-0 m-0 VIS-tp-commentsField d-flex flex-column w-100"><p id="VIS_viewAllComments' + h + '" class="vis-attachhistory-view-comments" > ' + VIS.Msg.getMsg("ViewMoreComments") + '<\/p><div class="vis-attachhistory-comments vis-feedMessage m-0"><input id="VIS_txtComments' + h + '" type="text" placeholder="' + VIS.Msg.getMsg("TypeComment") + '"><\/input><span id="VIS_btnComments' + h + '" class="vis-attachhistory-comment-icon vis vis-sms"><\/span><\/div><\/div><\/div> '); f = $('<div class="VIS-tp-contentdiv VIS-tp-contentPanel"><div class="" ><div style="width:100%" ><table height="50px" width="100%"><tr height="50px"><td><div class="VIS-mail-user-div"><span class="VIS-mail-user-span">' + g + '<\/span><\/div><\/td><td height="50px"><span class="VIS-mail-username">' + s + '<\/span><span id="mailSubject" class="VIS-mail-subject VIS-tp-recordLabels">' + w.Title + '<\/span><span class="VIS-mail-to">&nbsp;<\/span><span class="VIS-mail-from">&nbsp;<\/span><\/td><td height="50px" class="VIS-mail-date">' + w.Date + '<\/td><\/tr><\/table><\/div><div id="mailBody" class="VIS-mail-body" >' + w.Detail + "<\/div><\/div>"); y = $('<div class="VIS-tp-downloadAttachment"><div class="VIS-tp-attachments"><i class="vis vis-attachment1" ><\/i><span> ' + k + '<\/span><\/div><div class="VIS-tp-attchDownload" id="dwnldLetterAttach"><i class="vis vis-import" title="Download" style="opacity: 1;"><\/i><span> ' + VIS.Msg.getMsg("VIS_Download") + "<\/span><\/div><\/div><\/div>"); tt = $('<div class="VIS-tp-emailDetailOuterPanel VIS-tp-recordDetail"><\/div>'); tt.append($mailbodyhtml).append(y); r.append(e).append(tt); t.html().toString().contains("VIS_recordDetail" + h) || t.append(r); t.html().toString().contains("VIS_pagingHtml" + h) || t.append(p); v(VIS.Utility.Util.getValueOfInt(b), !1, !1); $("#VIS_recordDetail" + h).show(); $("#VIS_btnComments" + h).click(function (n) { a(!1, !1, n) }); $("#VIS_txtComments" + h).keyup(function (n) { a(!1, !1, n) }); $("#VIS_viewAllComments" + h).click(function () { $("#VIS_viewAllComments" + h).text() == VIS.Msg.getMsg("HideComments") ? ($("#VIS_viewMoreComments" + h).empty(), $("#VIS_viewMoreComments" + h).hide(), $("#VIS-tp-comments-input" + h).show(), $("#VIS_commentsMsg" + h).show(), $("#VIS_viewAllComments" + h).text(VIS.Msg.getMsg("ViewMoreComments")), v(VIS.Utility.Util.getValueOfInt(b), !1, !1)) : rt(VIS.Utility.Util.getValueOfInt(b), !1, !1) }); $("#dwnldLetterAttach").click(function () { ri(n, k) }); $("#VIS_prtHistory" + h).find("i").click(function () { d(f.html()) }); $("#VIS_prevRecord" + h).click(function () { i > 0 && o(VIS.Utility.Util.getValueOfInt(i) - 1, h) }); $("#VIS_nextRecord" + h).click(function () { i < VIS.Utility.Util.getValueOfInt(u) - 1 && o(VIS.Utility.Util.getValueOfInt(i) + 1, h) }); $("#VIS_btnClose" + h).click(function () { $("#VIS_recordDetail" + h).hide(); l() }) } }) } function vt(n, s, h) { var c = VIS.Utility.Util.getValueOfInt(n); $.ajax({ url: VIS.Application.contextUrl + "VIS/HistoryDetailsData/GetSelectedCallDetails", datatype: "json", type: "get", cache: !1, data: { ID: n }, success: function (n) { var w = JSON.parse(n), k = c, b = "", nt, tt, it, g; attach_ID = 0; attachLine_ID = 0; it = w.VA048_Duration >= 60 ? ni(w.VA048_Duration) : w.VA048_Duration + " " + VIS.Msg.getMsg("VA048_Seconds"); w.Attach != null && w.Attach.length > 0 && (b = w.Attach[0].Name, attach_ID = w.Attach[0].AttID, attachLine_ID = w.Attach[0].ID); VIS.Utility.Util.getValueOfString(w.VA048_Status).toLower() == "completed" && (tt = 'style = "color: #42d819;"'); r.length < 1 && (r = $('<div id="VIS_recordDetail' + h + '" class="VIS-tp-detailsPanel"><\/div>')); r.empty(); e = $('<div class="VIS-tp-borderBott"><div class="VIS-contentHeadOuter"><div class= "VIS-tp-recordIcon" ><i class="fa fa-phone" aria-hidden="true" title="Call"><\/i><\/div ><div class="VIS-contentHead"><div class="VIS-contentTitile"><h6 class="mb-0">' + s + "<\/h6><small>" + w.VA048_From + '<\/small><\/div><div class="align-items-center d-flex VIS-tp-rightIcons"><span id="VIS_prtHistory' + h + '"><i class="vis vis-print" title="Print"><\/i><\/span><span><i id="VIS_prevRecord' + h + '" class="fa fa-arrow-left"><\/i><\/span><span><i id="VIS_nextRecord' + h + '" class="fa fa-arrow-right"><\/i><\/span><span class="VIS-close-btn" id="VIS_btnClose' + h + '"><i class="vis vis-cross"><\/i><\/span><\/div><\/div><\/div><\/div>'); nt = $('<div class="VIS-tp-contentdiv VIS-tp-contentPanel"><div id="VIS-tp-comments-input' + h + '" class="VIS-tp-comments-input"><div class="" ><table height="50px" width="100%"><tr class="VIS-call-col-header" ><td>' + VIS.Msg.getMsg("VA048_To") + "<\/td><td>" + VIS.Msg.getMsg("VA048_Duration") + '<\/td><\/tr><tr class="VIS-call-col-data " ><td>' + w.VA048_To + "<\/td><td>" + it + '<\/td><\/tr><tr class="VIS-call-col-header"><td>' + VIS.Msg.getMsg("Created") + "<\/td><td>" + VIS.Msg.getMsg("VA048_Status") + '<\/td><\/tr><tr class="VIS-call-col-data"><td>' + new Date(w.Created).toLocaleString() + "<\/td><td " + tt + " >" + w.VA048_Status + '<\/td><\/tr><tr class="VIS-call-col-header"><td>' + VIS.Msg.getMsg("VA048_Price") + "<\/td><td>" + VIS.Msg.getMsg("VA048_PriceUnit") + '<\/td><\/tr><tr class="VIS-call-col-data"><td>' + w.VA048_Price + "<\/td><td>" + w.VA048_Price_Unit + '<\/td><\/tr><tr class="VIS-call-col-header"><td>' + VIS.Msg.getMsg("Category") + "<\/td><td>" + VIS.Msg.getMsg("Attachments") + '<\/td><\/tr><tr class="VIS-call-col-data"><td>' + VIS.Msg.getMsg("VA048_CallType") + '<\/td><td class="VIS-tp-attchDownload" id="dwnldCallAttach">' + b + '<\/td><\/tr><\/table><\/div><\/div><div id="VIS_viewMoreComments' + h + '" style="display:none;" class="VIS-tp-commentsPanel" ><\/div><div id="VIS_commentsdata' + h + '"><div class="pr-0 m-0 VIS-tp-commentsField d-flex flex-column w-100"><p id="VIS_viewAllComments' + h + '" class="vis-attachhistory-view-comments" > ' + VIS.Msg.getMsg("ViewMoreComments") + '<\/p><div class="vis-attachhistory-comments vis-feedMessage m-0"><input id="VIS_txtComments' + h + '" type="text" placeholder="' + VIS.Msg.getMsg("TypeComment") + '"><\/input><span id="VIS_btnComments' + h + '" class="vis-attachhistory-comment-icon vis vis-sms"><\/span><\/div><\/div><\/div>'); f = $('<div class="VIS-tp-contentdiv VIS-tp-contentPanel"><div id="VIS-tp-comments-input' + h + '" class="VIS-tp-comments-input"><div class="" ><table height="50px" width="100%"><tr class="VIS-call-col-header" ><td>' + VIS.Msg.getMsg("VA048_To") + "<\/td><td>" + VIS.Msg.getMsg("VA048_Duration") + '<\/td><\/tr><tr class="VIS-call-col-data " ><td>' + w.VA048_To + "<\/td><td>" + w.VA048_Duration + '<\/td><\/tr><tr class="VIS-call-col-header"><td>' + VIS.Msg.getMsg("Created") + "<\/td><td>" + VIS.Msg.getMsg("VA048_Status") + '<\/td><\/tr><tr class="VIS-call-col-data"><td>' + w.Created + '<\/td><td style="color: #42d819;">' + w.VA048_Status + '<\/td><\/tr><tr class="VIS-call-col-header"><td>' + VIS.Msg.getMsg("VA048_Price") + "Price<\/td><td>" + VIS.Msg.getMsg("VA048_PriceUnit") + 'Price Unit<\/td><\/tr><tr class="VIS-call-col-data"><td>' + w.VA048_Price + "<\/td><td>" + w.VA048_Price_Unit + '<\/td><\/tr><tr class="VIS-call-col-header"><td>' + VIS.Msg.getMsg("Category") + "<\/td><td>" + VIS.Msg.getMsg("Attachments") + '<\/td><\/tr><tr class="VIS-call-col-data"><td>' + VIS.Msg.getMsg("VA048_CallType") + '<\/td><td class="VIS-tp-attchDownload" id="dwnldCallAttach">' + b + "<\/td><\/tr><\/table><\/div><\/div>"); y = $('<div id="VIS_commentsdata' + h + '"><div class="pr-0 m-0 VIS-tp-commentsField d-flex flex-column w-100"><p id="VIS_viewAllComments' + h + '" class="vis-attachhistory-view-comments" > ' + VIS.Msg.getMsg("ViewMoreComments") + '<\/p><div class="vis-attachhistory-comments vis-feedMessage m-0"><input id="VIS_txtComments' + h + '" type="text" placeholder="' + VIS.Msg.getMsg("TypeComment") + '"><\/input><span id="VIS_btnComments' + h + '" class="vis-attachhistory-comment-icon vis vis-sms"><\/span><\/div><\/div><\/div>'); g = $('<div class="VIS-mail-header VIS-tp-recordDetail"><\/div>'); g.append(nt); r.append(e).append(g); t.html().toString().contains("VIS_recordDetail" + h) || t.append(r); t.html().toString().contains("VIS_pagingHtml" + h) || t.append(p); v(VIS.Utility.Util.getValueOfInt(k), !1, !0); $("#VIS_recordDetail" + h).show(); $("#dwnldCallAttach").click(function () { ui(attachLine_ID, attach_ID, b) }); $("#VIS_btnComments" + h).click(function (n) { a(!1, !0, n) }); $("#VIS_txtComments" + h).keyup(function (n) { a(!1, !0, n) }); $("#VIS_viewAllComments" + h).click(function () { $("#VIS_viewAllComments" + h).text() == VIS.Msg.getMsg("HideComments") ? ($("#VIS_viewMoreComments" + h).empty(), $("#VIS_viewMoreComments" + h).hide(), $("#VIS-tp-comments-input" + h).show(), $("#VIS_commentsMsg" + h).show(), $("#VIS_viewAllComments" + h).text(VIS.Msg.getMsg("ViewMoreComments")), v(VIS.Utility.Util.getValueOfInt(k), !1, !0)) : rt(VIS.Utility.Util.getValueOfInt(k), !1, !0) }); $("#VIS_prtHistory" + h).find("i").click(function () { d(f.html()) }); $("#VIS_prevRecord" + h).click(function () { i > 0 && o(VIS.Utility.Util.getValueOfInt(i) - 1, h) }); $("#VIS_nextRecord" + h).click(function () { i < VIS.Utility.Util.getValueOfInt(u) - 1 && o(VIS.Utility.Util.getValueOfInt(i) + 1, h) }); $("#VIS_btnClose" + h).click(function () { $("#VIS_recordDetail" + h).hide(); l() }) } }) } function yt(n, s, h) { var w = "", tt, c = VIS.dataContext.getJSONData(VIS.Application.contextUrl + "VIS/HistoryDetailsData/GetSelectedAppointmentDetails", { record_ID: n }, null), b, k, g, nt; if (c != null) { if (strApp = "", b = VIS.Utility.Util.getValueOfString(c.AppointmentsInfo_ID), k = c.AttendeeInfo, k != null && k != "" && (names = VIS.dataContext.getJSONData(VIS.Application.contextUrl + "AttachmentHistory/GetUser", { UserQry: k }, null), names != null && names.length > 0)) { for (strApp = "", g = 0; g < names.length; g++)strApp += names[g] + ", "; strApp = strApp.substring(0, strApp.length - 2); w = strApp } r.length < 1 && (r = $('<div id="VIS_recordDetail' + h + '" class="VIS-tp-detailsPanel"><\/div>')); r.empty(); e = $('<div class="VIS-tp-borderBott"><div class="VIS-contentHeadOuter"><div class= "VIS-tp-recordIcon" ><i class="vis vis-task" title="task"><\/i><\/div ><div class="VIS-contentHead"><div class="VIS-contentTitile"><h6 class="mb-0">' + VIS.Msg.getMsg("Appointment") + "<\/h6><small>" + c.Subject + '<\/small><\/div><div class="align-items-center d-flex VIS-tp-rightIcons"><span id="VIS_prtHistory' + h + '"><i class="vis vis-print" title="Print"><\/i><\/span><span><i id="VIS_prevRecord' + h + '" class="fa fa-arrow-left"><\/i><\/span><span><i id="VIS_nextRecord' + h + '" class="fa fa-arrow-right"><\/i><\/span><span class="VIS-close-btn" id="VIS_btnClose' + h + '"><i class="vis vis-cross"><\/i><\/span><\/div><\/div><\/div><\/div>'); tt = $('<div class="VIS-tp-contentdiv VIS-tp-contentPanel"><div id="VIS-tp-comments-input' + h + '" class="VIS-tp-comments-input"><div ><table height="50px" width="100%"><tr class="VIS-call-col-header"><td>' + VIS.Msg.getMsg("Location") + "<\/td><td>" + VIS.Msg.getMsg("AllDay") + '<\/td><\/tr><tr class="VIS-call-col-data"><td>' + c.Location + "<\/td><td>" + c.Allday + '<\/td><\/tr><tr class="VIS-call-col-header"><td>' + VIS.Msg.getMsg("StartDate") + "<\/td><td>" + VIS.Msg.getMsg("EndDate") + '<\/td><\/tr><tr class="VIS-call-col-data"><td>' + new Date(c.StartDate).toLocaleString() + "<\/td><td>" + new Date(c.EndDate).toLocaleString() + '<\/td><\/tr><tr class="VIS-call-col-header"><td colspan="2">' + VIS.Msg.getMsg("Contacts") + '<\/td><\/tr><tr class="VIS-call-col-data"><td colspan="2">' + w + '<\/td><\/tr><tr class="VIS-call-col-header"><td colspan="2">' + VIS.Msg.getMsg("Description") + '<\/td><\/tr><tr class="VIS-call-col-data"><td colspan="2">' + c.Description + '<\/td><\/tr><\/table><\/div><\/div><div id="VIS_viewMoreComments' + h + '" style="display:none;" class="VIS-tp-commentsPanel"><\/div><div id="VIS_commentsdata' + h + '"><div class="pr-0 m-0 VIS-tp-commentsField d-flex flex-column w-100"><p id="VIS_viewAllComments' + h + '" class="vis-attachhistory-view-comments" > ' + VIS.Msg.getMsg("ViewMoreComments") + '<\/p><div class="vis-attachhistory-comments vis-feedMessage m-0"><input id="VIS_txtComments' + h + '" type="text" placeholder="' + VIS.Msg.getMsg("TypeComment") + '"><\/input><span id="VIS_btnComments' + h + '" class="vis-attachhistory-comment-icon vis vis-sms"><\/span><\/div><\/div><\/div>'); f = $('<div class="VIS-tp-contentdiv VIS-tp-contentPanel"><div id="VIS-tp-comments-input' + h + '" class="VIS-tp-comments-input"><div ><table height="50px" width="100%"><tr class="VIS-call-col-header"><td>' + VIS.Msg.getMsg("Location") + "<\/td><td>" + VIS.Msg.getMsg("AllDay") + '<\/td><\/tr><tr class="VIS-call-col-data"><td>' + c.Location + "<\/td><td>" + c.Allday + '<\/td><\/tr><tr class="VIS-call-col-header"><td>' + VIS.Msg.getMsg("StartDate") + "<\/td><td>" + VIS.Msg.getMsg("EndDate") + '<\/td><\/tr><tr class="VIS-call-col-data"><td>' + c.StartDate + "<\/td><td>" + c.EndDate + '<\/td><\/tr><tr class="VIS-call-col-header"><td colspan="2">' + VIS.Msg.getMsg("Contacts") + '<\/td><\/tr><tr class="VIS-call-col-data"><td colspan="2">' + w + '<\/td><\/tr><tr class="VIS-call-col-header"><td colspan="2">' + VIS.Msg.getMsg("Description") + '<\/td><\/tr><tr class="VIS-call-col-data"><td colspan="2">' + c.Description + "<\/td><\/tr><\/table><\/div><\/div>"); y = $('<div id="ViewMoreComments' + h + '" style="display:none;" class="VIS-tp-commentsPanel"><\/div><div id="VIS_commentsdata' + h + '"><div class="pr-0 m-0 VIS-tp-commentsField d-flex flex-column w-100"><p id="VIS_viewAllComments' + h + '" class="vis-attachhistory-view-comments" > ' + VIS.Msg.getMsg("ViewMoreComments") + '<\/p><div class="vis-attachhistory-comments vis-feedMessage m-0"><input id="VIS_txtComments' + h + '" type="text" placeholder="' + VIS.Msg.getMsg("TypeComment") + '"><\/input><span id="VIS_btnComments' + h + '" class="vis-attachhistory-comment-icon vis vis-sms"><\/span><\/div><\/div><\/div>'); nt = $('<div class="VIS-mail-header VIS-tp-recordDetail"><\/div>'); nt.append(tt); r.append(e).append(nt); t.html().toString().contains("VIS_recordDetail" + h) || t.append(r); t.html().toString().contains("VIS_pagingHtml" + h) || t.append(p); v(VIS.Utility.Util.getValueOfInt(b), !0, !1); w = ""; $("#VIS_recordDetail" + h).show(); $("#VIS_btnComments" + h).click(function (n) { a(!0, !1, n) }); $("#VIS_txtComments" + h).keyup(function (n) { a(!0, !1, n) }); $("#VIS_viewAllComments" + h).click(function () { $("#VIS_viewAllComments" + h).text() == VIS.Msg.getMsg("HideComments") ? ($("#VIS_viewMoreComments" + h).empty(), $("#VIS_viewMoreComments" + h).hide(), $("#VIS-tp-comments-input" + h).show(), $("#VIS_commentsMsg" + h).show(), $("#VIS_viewAllComments" + h).text(VIS.Msg.getMsg("ViewMoreComments")), v(VIS.Utility.Util.getValueOfInt(b), !0, !1)) : rt(VIS.Utility.Util.getValueOfInt(b), !0, !1) }); $("#VIS_prtHistory" + h).find("i").click(function () { d(f.html()) }); $("#VIS_prevRecord" + h).click(function () { i > 0 && o(VIS.Utility.Util.getValueOfInt(i) - 1, h) }); $("#VIS_nextRecord" + h).click(function () { i < VIS.Utility.Util.getValueOfInt(u) - 1 && o(VIS.Utility.Util.getValueOfInt(i) + 1, h) }); $("#VIS_btnClose" + h).click(function () { $("#VIS_recordDetail" + h).hide(); l() }) } } function pt(n, s, h) { $.ajax({ url: VIS.Application.contextUrl + "VIS/HistoryDetailsData/GetSelectedTaskDetails", datatype: "json", type: "get", cache: !1, data: { record_ID: n }, success: function (n) { var s = JSON.parse(n), ft = "", g, c, w, nt, tt, k, b, it; if (s != null) { if (w = "", nt = s.AttendeeInfo, ht = s.IsTaskClosed, g = VIS.Utility.Util.getValueOfString(s.AppointmentsInfo_ID), nt != null && nt != "" && (names = VIS.dataContext.getJSONData(VIS.Application.contextUrl + "AttachmentHistory/GetUser", { UserQry: nt }, null), names != null && names.length > 0)) { for (w = "", tt = 0; tt < names.length; tt++)w += names[tt] + ", "; w = w.substring(0, w.length - 2); ft = w } VIS.Utility.Util.getValueOfString(s.PriorityKey) != "" && (s.PriorityKey == "1" ? (b = "color: #f60000;", k = "Urgent") : s.PriorityKey == "3" ? (b = "color: #fb9300;", k = "High") : s.PriorityKey == "5" ? (b = "color: #6f04e8;", k = "Medium") : s.PriorityKey == "7" ? (b = "color: #03e5f3;", k = "Low") : s.PriorityKey == "9" && (b = "color: #42d819;", k = "Minor")); r.length < 1 && (r = $('<div id="VIS_recordDetail' + h + '" class="VIS-tp-detailsPanel"><\/div>')); r.empty(); e = $('<div class="VIS-tp-borderBott"><div class="VIS-contentHeadOuter"><div class= "VIS-tp-recordIcon" ><i class="vis vis-task" title="task"><\/i><\/div ><div class="VIS-contentHead"><div class="VIS-contentTitile"><h6 class="mb-0">' + VIS.Msg.getMsg("Task") + "<\/h6><small>" + s.Subject + '<\/small><\/div><div class="align-items-center d-flex VIS-tp-rightIcons"><span id="VIS_prtHistory' + h + '"><i class="vis vis-print" title="Print"><\/i><\/span><span><i id="VIS_prevRecord' + h + '" class="fa fa-arrow-left"><\/i><\/span><span><i id="VIS_nextRecord' + h + '" class="fa fa-arrow-right"><\/i><\/span><span class="VIS-close-btn" id="VIS_btnClose' + h + '"><i class="vis vis-cross"><\/i><\/span><\/div><\/div><\/div><\/div>'); c = $('<div class="VIS-tp-contentdiv VIS-tp-contentPanel"><div id="VIS-tp-comments-input' + h + '" class="VIS-tp-comments-input"><div class="VIS-tp-taskcontTag" >' + (s.IsTaskClosed ? '<span class="VIS-tp-taskTag">' + VIS.Msg.getMsg("Closed") + "<\/span>" : "") + '<table height="50px" width="100%"><tr class="VIS-call-col-header"><td>' + VIS.Msg.getMsg("Priority") + "<\/td><td>" + VIS.Msg.getMsg("Status") + '<\/td><\/tr><tr class="VIS-call-col-data"><td style="' + b + '">' + k + "<\/td><td>" + VIS.Utility.Util.getValueOfInt(s.TaskStatus) * 10 + '%<\/td><\/tr><tr class="VIS-call-col-header"><td>' + VIS.Msg.getMsg("StartDate") + "<\/td><td>" + VIS.Msg.getMsg("EndDate") + '<\/td><\/tr><tr class="VIS-call-col-data"><td>' + new Date(s.StartDate).toLocaleString() + "<\/td><td>" + new Date(s.EndDate).toLocaleString() + '<\/td><\/tr><tr class="VIS-call-col-header"><td>' + VIS.Msg.getMsg("ASSIGNEDTO") + "<\/td><td>" + VIS.Msg.getMsg("Category") + '<\/td><\/tr><tr class="VIS-call-col-data"><td>' + s.AssignedTo + "<\/td><td>" + s.CategoryName + '<\/td><\/tr><tr class="VIS-call-col-header"><td colspan="2">' + VIS.Msg.getMsg("Result") + '<\/td><\/tr><tr class="VIS-call-col-data"><td colspan="2">' + s.Result + '<\/td><\/tr><tr class="VIS-call-col-header"><td colspan="2">' + VIS.Msg.getMsg("Description") + '<\/td><\/tr><tr class="VIS-call-col-data"><td colspan="2">' + s.Description + '<\/td><\/tr><tr><td><div class="vis-float-left vis-frm-ls-top"><input id="VIS_chkTaskComplete' + h + '" value="1" type="checkbox" class="vis-float-left"><label id="VIS_lblTaskComplete' + h + '" for="chkTaskComplete" class="wsp-task-from-inputLabel vis-float-left" style="margin:0 0 0 5px;">' + VIS.Msg.getMsg("Closed") + '<\/label><\/div><\/td><td><div class="vis-float-right"><a href="javascript:void(0)" id="VIS_hlnktaskdone' + h + '" class="vis-btn vis-btn-done vis-icon-doneButton vis-float-right vis-btnOk"> <span class="vis-btn-ico vis-btn-done-bg vis-btn-done-border"><\/span>' + VIS.Msg.getMsg("Done") + '<\/a><\/div><\/td><\/tr><\/table><\/div><\/div><div id="VIS_viewMoreComments' + h + '" style="display:none;" class="VIS-tp-commentsPanel"><\/div><div id="VIS_commentsdata' + h + '"><div class="pr-0 m-0 VIS-tp-commentsField d-flex flex-column w-100"><p id="VIS_viewAllComments' + h + '" class="vis-attachhistory-view-comments" > ' + VIS.Msg.getMsg("ViewMoreComments") + '<\/p><div class="vis-attachhistory-comments vis-feedMessage m-0"><input id="VIS_txtComments' + h + '" type="text" placeholder="' + VIS.Msg.getMsg("TypeComment") + '"><\/input><span id="VIS_btnComments' + h + '" class="vis-attachhistory-comment-icon vis vis-sms"><\/span><\/div><\/div><\/div>'); f = $('<div class="VIS-tp-contentdiv VIS-tp-contentPanel"><div id="VIS-tp-comments-input' + h + '" class="VIS-tp-comments-input"><div class="VIS-tp-taskcontTag" >' + (s.IsTaskClosed ? '<span class="VIS-tp-taskTag">' + VIS.Msg.getMsg("Closed") + "<\/span>" : "") + '<table height="50px" width="100%"><tr class="VIS-call-col-header"><td>' + VIS.Msg.getMsg("Priority") + "<\/td><td>" + VIS.Msg.getMsg("Status") + '<\/td><\/tr><tr class="VIS-call-col-data"><td style="' + b + '">' + s.Priority + "<\/td><td>" + VIS.Utility.Util.getValueOfInt(s.TaskStatus) * 10 + '%<\/td><\/tr><tr class="VIS-call-col-header"><td>' + VIS.Msg.getMsg("StartDate") + "<\/td><td>" + VIS.Msg.getMsg("EndDate") + '<\/td><\/tr><tr class="VIS-call-col-data"><td>' + s.StartDate + "<\/td><td>" + s.EndDate + '<\/td><\/tr><tr class="VIS-call-col-header"><td>' + VIS.Msg.getMsg("ASSIGNEDTO") + "<\/td><td>" + VIS.Msg.getMsg("Category") + '<\/td><\/tr><tr class="VIS-call-col-data"><td>' + s.AssignedTo + "<\/td><td>" + s.CategoryName + '<\/td><\/tr><tr class="VIS-call-col-header"><td colspan="2">' + VIS.Msg.getMsg("Result") + '<\/td><\/tr><tr class="VIS-call-col-data"><td colspan="2">' + s.Result + '<\/td><\/tr><tr class="VIS-call-col-header"><td colspan="2">' + VIS.Msg.getMsg("Description") + '<\/td><\/tr><tr class="VIS-call-col-data"><td colspan="2">' + s.Description + "<\/td><\/tr><\/table><\/div><\/div>"); y = $('<div id="VIS_viewMoreComments' + h + '" style="display:none;" class="VIS-tp-commentsPanel"><\/div><div id="VIS_commentsdata' + h + '"><div class="pr-0 m-0 VIS-tp-commentsField d-flex flex-column w-100"><p id="VIS_viewAllComments' + h + '" class="vis-attachhistory-view-comments" > ' + VIS.Msg.getMsg("ViewMoreComments") + '<\/p><div class="vis-attachhistory-comments vis-feedMessage m-0"><input id="VIS_txtComments' + h + '" type="text" placeholder="' + VIS.Msg.getMsg("TypeComment") + '"><\/input><span id="VIS_btnComments' + h + '" class="vis-attachhistory-comment-icon vis vis-sms"><\/span><\/div><\/div><\/div>'); it = $('<div class="VIS-mail-header VIS-tp-recordDetail"><\/div>'); it.append(c); r.append(e).append(it); t.html().toString().contains("VIS_recordDetail" + h) || t.append(r); t.html().toString().contains("VIS_pagingHtml" + h) || t.append(p); v(VIS.Utility.Util.getValueOfInt(g), !0, !1); ft = ""; $("#VIS_recordDetail" + h).show(); $("#VIS_btnComments" + h).click(function (n) { a(!0, !1, n) }); $("#VIS_txtComments" + h).keyup(function (n) { a(!0, !1, n) }); $("#VIS_viewAllComments" + h).click(function () { $("#VIS_viewAllComments" + h).text() == VIS.Msg.getMsg("HideComments") ? ($("#VIS_viewMoreComments" + h).empty(), $("#VIS_viewMoreComments" + h).hide(), $("#VIS-tp-comments-input" + h).show(), $("#VIS_commentsMsg" + h).show(), $("#VIS_viewAllComments" + h).text(VIS.Msg.getMsg("ViewMoreComments")), v(VIS.Utility.Util.getValueOfInt(g), !0, !1)) : rt(VIS.Utility.Util.getValueOfInt(g), !0, !1) }); $("#VIS_prtHistory" + h).find("i").click(function () { d(f.html()) }); $("#VIS_prevRecord" + h).click(function () { i > 0 && o(VIS.Utility.Util.getValueOfInt(i) - 1, h) }); $("#VIS_nextRecord" + h).click(function () { i < VIS.Utility.Util.getValueOfInt(u) - 1 && o(VIS.Utility.Util.getValueOfInt(i) + 1, h) }); $("#VIS_btnClose" + h).click(function () { $("#VIS_recordDetail" + h).hide(); l() }); ht && (c.find("#VIS_chkTaskComplete" + h).hide(), c.find("#VIS_hlnktaskdone" + h).hide(), c.find("#VIS_lblTaskComplete" + h).hide()); c.find("#VIS_hlnktaskdone" + h).on("click", function () { var i, n; ut != null && ut.empty(); var t = s.Subject, o = s.CategoryName, r = s.StartDate, u = s.EndDate; if (u < r) { ut.append(VIS.Msg.getMsg("WSP_EndDateShouldBeGreaterThanStartDate")); return } var l = s.Description, a = s.Result, v = s.PriorityKey, b = s.Priority, y = parseInt(s.TaskStatus), k = s.TaskStatus, f = "", p = c.find("#VIS_chkTaskComplete" + h).prop("checked", !0); f = p.is(":checked") ? !0 : !1; var e = [], w = s.AppointmentsInfo_ID; WspSharedUser = []; i = 0; n = s.UserID; i = n != null && n != 0 ? n : VIS.context.getAD_User_ID(); e.push({ AppointmentsInfo_ID: w, Title: t, Description: l, Start: r, End: u, Categories: o, TaskStatus: y, PriorityKey: v, Ad_User_ID: i, Contacts: [], ContactsInfo: WspSharedUser, isClosed: f, Result: a }); t != "" && t.trim().length > 0 && $.ajax({ url: VIS.Application.contextUrl + "WSP/Home/UpdateJson_Task", type: "POST", datatype: "JSON", contentType: "application/json; charset=utf-8", async: !0, data: JSON.stringify({ models: e }), success: function (n) { var t = JSON.parse(n); VIS.ADialog.info("WSP_TaskUpdated", !0, null); c.find("#VIS_chkTaskComplete" + h).hide(); c.find("#VIS_hlnktaskdone" + h).hide(); c.find("#VIS_lblTaskComplete" + h).hide() } }) }) } }, error: function () { } }) } function wt(n, s, h) { $.ajax({ url: VIS.Application.contextUrl + "VIS/HistoryDetailsData/GetSelectedAttachmentDetails", datatype: "json", type: "get", cache: !1, data: { record_ID: n }, success: function (n) { var s = JSON.parse(n), y = "", c, a, v; if (s != null && s.length > 0) for (c = 0; c < s.length; c++)a = "", a = VIS.Utility.Util.getValueOfString(s[c].FileType).toString().toLower() == ".doc" || VIS.Utility.Util.getValueOfString(s[c].FileType).toString().toLower() == ".docx" ? '<i class="vis vis-doc-word"><\/i>' : VIS.Utility.Util.getValueOfString(s[c].FileType).toString().toLower() == ".xls" || VIS.Utility.Util.getValueOfString(s[c].FileType).toString().toLower() == ".xlsx" ? '<i class="vis vis-doc-excel"><\/i>' : VIS.Utility.Util.getValueOfString(s[c].FileType).toString().toLower() == ".ppt" || VIS.Utility.Util.getValueOfString(s[c].FileType).toString().toLower() == ".pptx" ? '<i class="vis vis-doc-pp"><\/i>' : VIS.Utility.Util.getValueOfString(s[c].FileType).toString().toLower() == ".pdf" ? '<i class="vis vis-doc-pdf"><\/i>' : VIS.Utility.Util.getValueOfString(s[c].FileType).toString().toLower() == ".txt" ? '<i class="vis vis-doc-text"><\/i>' : VIS.Utility.Util.getValueOfString(s[c].FileType).toString().toLower() == ".png" || VIS.Utility.Util.getValueOfString(s[c].FileType).toString().toLower() == ".jpg" || VIS.Utility.Util.getValueOfString(s[c].FileType).toString().toLower() == ".jpeg" || VIS.Utility.Util.getValueOfString(s[c].FileType).toString().toLower() == ".gif" ? '<i class="vis vis-doc-img"><\/i>' : '<i class="vis vis-doc-img"><\/i>', y += '<div class="VIS-tp-recordWrap"><div class="VIS-tp-attachIcon">' + a + '<\/div><div data-filename="' + VIS.Utility.Util.getValueOfString(s[c].FileName) + '" data-attid="' + VIS.Utility.Util.getValueOfString(s[c].AD_Attachment_ID) + '" data-id="' + VIS.Utility.Util.getValueOfString(s[c].ID) + '" class="VIS-tp-attachInfo" ><h6>' + VIS.Utility.Util.getValueOfString(s[c].FileName) + "<\/h6><small>" + VIS.Utility.Util.getValueOfString(s[c].FileSize) + ' kb<\/small><\/div><div class="VIS-tp-recordInfoRight"><span class="VIS-tp-dateTime">' + new Date(s[c].CreatedOn).toLocaleString() + "<\/span><small>By: " + VIS.Utility.Util.getValueOfString(s[c].CreatedBy) + "<\/small><\/div><\/div>"; r.length < 1 && (r = $('<div id="VIS_recordDetail' + h + '" class="VIS-tp-detailsPanel"><\/div>')); r.empty(); e = $('<div class="VIS-contentHeadOuter VIS-tp-borderBott"><div class= "VIS-tp-recordIcon" ><i class="vis vis-attachmentx"><\/i><\/div><div class="VIS-contentHead"><span class="VIS-letter-header">' + VIS.Msg.getMsg("Attachment") + '<\/span><\/div><div class="align-items-center d-flex VIS-tp-rightIcons" ><span id="VIS_prtHistory' + h + '"><i class="vis vis-print" title="Print"><\/i><\/span><span><i id="VIS_prevRecord' + h + '" class="fa fa-arrow-left"><\/i><\/span><span><i id="VIS_nextRecord' + h + '" class="fa fa-arrow-right"><\/i><\/span><span class="VIS-close-btn" id="VIS_btnClose' + h + '"><i class="vis vis-cross"><\/i><\/span><\/div><\/div>'); f = $('<div class="VIS-tp-contentdiv"><div class="VIS-tp-contentWrap VIS-tp-attachmentContent">' + y + "<\/div><\/div>"); v = $('<div class="VIS-mail-header VIS-tp-recordDetail"><\/div>'); v.append(f); r.append(e).append(v); t.html().toString().contains("VIS_recordDetail" + h) || t.append(r); t.html().toString().contains("VIS_pagingHtml" + h) || t.append(p); attdInfo = ""; $("#VIS_recordDetail" + h).show(); $(".VIS-tp-attachInfo").click(function (n) { $(".VIS-tp-contentWrap").css({ cursor: "wait" }); ii(n) }); $("#VIS_prtHistory" + h).find("i").click(function () { d(f.html()) }); $("#VIS_prevRecord" + h).click(function () { i > 0 && o(VIS.Utility.Util.getValueOfInt(i) - 1, h) }); $("#VIS_nextRecord" + h).click(function () { i < VIS.Utility.Util.getValueOfInt(u) - 1 && o(VIS.Utility.Util.getValueOfInt(i) + 1, h) }); $("#VIS_btnClose" + h).click(function () { $("#VIS_recordDetail" + h).hide(); l() }) } }) } function ot(n, s, h) { $.ajax({ url: VIS.Application.contextUrl + "VIS/HistoryDetailsData/GetSelectedChatDetails", datatype: "json", type: "get", cache: !1, data: { record_ID: n }, success: function (s) { var a = JSON.parse(s), b = "", g = !1, ut = 0, w, ft, et = VIS.context.getAD_User_Name(), ot, c, k, it, rt; if (a != null && a.length > 0) for (ot = "", c = 0; c < a.length; c++) { if (a[c].Created != null && a[c].Created != "") { k = new Date; w = new Date(a[c].Created.toString()); var v = w.getHours(), nt = w.getMinutes(), tt = " AM"; v == 0 ? v = 12 : v < 12 ? v = v : v == 12 ? (v = v, tt = " PM") : v > 12 && (v = v - 12, tt = " PM"); ft = w.getMonth() + "/" + w.getDate() + "/" + w.getFullYear() + " | " + (v >= 10 ? v : "0" + v) + ":" + (nt >= 10 ? nt : "0" + nt) + tt } c == 0 && (b = '<div class="VIS-tp-contentWrap VIS-tp-attachmentContent">'); (c == 0 || c == VIS.Utility.Util.getValueOfInt(a.length) - 1) && w.getDate() == k.getDate() && w.getMonth() == k.getMonth() && w.getFullYear() == k.getFullYear() && (g = !0); ut = VIS.Utility.Util.getValueOfInt(a[c].Record_ID); b += et.toString().toLower() == a[c].UserName.toString().toLower() ? '<div class="VIS-tp-recordWrap VIS-tp-msgSend"><div class="VIS-tp-userImg" >' + a[c].UserImage + '<\/div><div class="VIS-tp-recordInfo pr-0"><div class="VIS-tp-chatInfo"><h6>' + a[c].UserName + "<\/h6><span>" + w.toLocaleString() + '<\/span><\/div><p class="VIS-tp-message">' + a[c].CharacterData + "<\/p><\/div><\/div >" : '<div class="VIS-tp-recordWrap VIS-tp-msgRecevied"><div class="VIS-tp-userImg" >' + a[c].UserImage + '<\/div><div class="VIS-tp-recordInfo pr-0"><div class="VIS-tp-chatInfo"><h6>' + a[c].UserName + "<\/h6><span>" + w.toLocaleString() + '<\/span><\/div><p class="VIS-tp-message">' + a[c].CharacterData + "<\/p><\/div><\/div>"; c == a.length - 1 && (b += "<\/div>") } r.length < 1 && (r = $('<div id="VIS_recordDetail' + h + '" class="VIS-tp-detailsPanel"><\/div>')); r.empty(); it = ""; g && (it = '<div class="VIS-chatBoxWrap"><div class="VIS-chat-box"><textarea id="VIS_chatBox' + h + '" class="VIS-chat-msgbox" style="height:46px;" maxlength="500"><\/textarea><\/div><div class="VIS-chat-send-div"><div style="float:left;"><\/div><div class="VIS-chat-send"><i class="fa fa-paper-plane VIS-tp-chatBtn" data-chid="' + VIS.Utility.Util.getValueOfInt(n).toString() + '" data-recid="' + ut.toString() + '" id="VIS_imgSend' + h + '" ><\/i><i id="VIS_imgCancel' + h + '" class="fa fa-times-circle VIS-tp-chatBtn"><\/i><\/div><\/div><\/div>'); e = $('<div class="VIS-contentHeadOuter VIS-tp-borderBott" ><div class= "VIS-tp-recordIcon" ><i class="vis vis-chat"><\/i><\/div><div class="VIS-contentHead"><span class="VIS-letter-header">' + VIS.Msg.getMsg("Chat") + '<\/span><\/div><div class="align-items-center d-flex VIS-tp-rightIcons" ><span id="VIS_prtHistory' + h + '"><i class="vis vis-print" title="Print"><\/i><\/span><span><i id="VIS_prevRecord' + h + '" class="fa fa-arrow-left"><\/i><\/span><span><i id="VIS_nextRecord' + h + '" class="fa fa-arrow-right"><\/i><\/span><span class="VIS-close-btn" id="VIS_btnClose' + h + '"><i class="vis vis-cross"><\/i><\/span><\/div><\/div>'); f = $('<div class="VIS-tp-contentdiv VIS-tp-contentPanel"><div class="' + (g ? "VIS-chatContentWrap" : "") + '" >' + b + "<\/div>"); y = $(it + "<\/div>"); rt = $('<div class="VIS-mail-header VIS-tp-recordDetail"><\/div>'); rt.append(f).append(y); r.append(e).append(rt); t.html().toString().contains("VIS_recordDetail" + h) || t.append(r); t.html().toString().contains("VIS_pagingHtml" + h) || t.append(p); attdInfo = ""; $("#VIS_recordDetail" + h).show(); $("#VIS_imgSend" + h).click(function (n) { fi(n) }); $("#VIS_imgCancel" + h).click(function () { $("#VIS_chatBox" + h).val("") }); $("#VIS_prtHistory" + h).find("i").click(function () { d(f.html()) }); $("#VIS_prevRecord" + h).click(function () { i > 0 && o(VIS.Utility.Util.getValueOfInt(i) - 1, h) }); $("#VIS_nextRecord" + h).click(function () { i < VIS.Utility.Util.getValueOfInt(u) - 1 && o(VIS.Utility.Util.getValueOfInt(i) + 1, h) }); $("#VIS_btnClose" + h).click(function () { $("#VIS_recordDetail" + h).hide(); l() }) } }) } function ni(n) { var u = ~~(n / 3600), i = ~~(n % 3600 / 60), r = n % 60, t = ""; return u > 0 && (t += "" + hrs + ":" + (i < 10 ? "0" : "")), t += "" + i + ":" + (r < 10 ? "0" : ""), t += "" + r, t + " " + VIS.Msg.getMsg("VA048_Minutes") } function d(n) { var t = window.open(), i = '<link rel="stylesheet" href="' + VIS.Application.contextUrl + 'Areas/VIS/Content/VIS.all.min.css" />'; t.document.write(i + n); setTimeout(function () { t.print(); t.close() }, 300) } function ti(n) { n != null && n != 0 && $.ajax({ url: VIS.Application.contextUrl + "VIS/HistoryDetailsData/DownloadAllAttachments", datatype: "json", type: "get", cache: !1, data: { ID: n, Name: name }, success: function (n) { var t = JSON.parse(n), i; t != null && t != "" ? (i = VIS.Application.contextUrl + "TempDownload/" + t, window.open(i)) : VIS.ADialog.error("AttachmentNotFound") } }) } function ii(n) { var t = n.target, r = "", i = "", u = ""; ($(t).is("div") ? (r = $(t).data("filename"), u = $(t).data("attid"), i = $(t).data("id")) : $(t).is("h6") && (r = $(t).parent().data("filename"), u = $(t).parent().data("attid"), i = $(t).parent().data("id")), i != null && i != 0) && $.ajax({ url: VIS.Application.contextUrl + "VIS/HistoryDetailsData/DownloadHistoryAttachment", datatype: "json", type: "get", cache: !1, data: { AttID: u, ID: i, Name: r }, success: function (n) { var t = JSON.parse(n), i; t != null && t != "" ? (i = VIS.Application.contextUrl + "TempDownload/" + t, $("#tblAttach").css({ cursor: "default" }), window.open(i)) : VIS.ADialog.error("AttachmentNotFound") } }) } function ri(n, t) { n != null && n != 0 && $.ajax({ url: VIS.Application.contextUrl + "VIS/HistoryDetailsData/DownloadAttachment", datatype: "json", type: "get", cache: !1, data: { ID: n, Name: t }, success: function (n) { var t = JSON.parse(n), i; t != null && t != "" ? (i = VIS.Application.contextUrl + "TempDownload/" + t, window.open(i)) : VIS.ADialog.error("AttachmentNotFound") } }) } function ui(n, t, i) { n != null && n != 0 && $.ajax({ url: VIS.Application.contextUrl + "AttachmentHistory/DownloadAttachmentCall", datatype: "json", type: "get", cache: !1, data: { AttID: t, ID: n, Name: i }, success: function (n) { var t = JSON.parse(n), i; t != null && t != "" ? (i = VIS.Application.contextUrl + "TempDownload/" + t, window.open(i)) : VIS.ADialog.error("AttachmentNotFound") } }) } function st(n, t, i, r, u, f, e) { var s = null, h = e.target, c, l, a, o; $(h).is("i") && (f == "R" || f == "RA") && (c = $(h).data("mailto"), l = $(h).data("mailcc"), a = $(h).data("mailbcc")); f == "R" || f == "RA" ? s = new VIS.Email(c, null, null, n, !0, !0, t, i, "RE: " + VIS.Utility.Util.getValueOfString(r), u) : f == "F" && (s = new VIS.Email("", null, null, n, !0, !0, t, i, "FW: " + VIS.Utility.Util.getValueOfString(r), u)); o = new VIS.CFrame; o.setName(VIS.Msg.getMsg("EMail")); o.setTitle(VIS.Msg.getMsg("EMail")); o.hideHeader(!0); o.setContent(s); o.show(); f == "RA" && s.showCcBccMails(l.replace(/,/g, ""), a.replace(/,/g, "")); s.initializeComponent() } function fi(t) { var r = t.target, e = 0, u = 0, i; if (_AD_Table_ID = 876, $(r).is("i") && (e = $(r).data("recid"), u = $(r).data("chid")), i = $("#VIS_chatBox" + n).val(), $.trim(i) == "" || i == "" || i == null) return VIS.ADialog.info("EnterData"), t != undefined && t.preventDefault(), !1; var f = new VIS.Chat(e, u, _AD_Table_ID, "info: test", this.windowNo); f.prop.ChatText = i; f.onClose = function () { }; VIS.dataContext.saveChat(f.prop); ot(u, "", n) } function rt(n, t, i) { $.ajax({ url: VIS.Application.contextUrl + "AttachmentHistory/ViewChatonHistory", datatype: "json", type: "POST", cache: !1, data: { record_ID: n, isAppointment: t, isCall: i }, success: function (n) { var r = JSON.parse(n); oi(r, t, i) }, error: function () { VIS.ADialog.error("RecordNotSaved") } }) } function a(t, r, u) { var o = u.target, e, f; (u.keyCode == undefined || u.keyCode == 13) && (u.keyCode != undefined || $(o).hasClass("vis-attachhistory-comment-icon")) && (e = 0, e = $("#rowId" + i).data("rid"), e != 0) && (f = "", f = $("#VIS_txtComments" + n).val(), f.length != 0) && $.ajax({ url: VIS.Application.contextUrl + "AttachmentHistory/SaveComment", datatype: "json", type: "POST", cache: !1, data: { ID: e, Text: f, isAppointment: t, isCall: r }, success: function (t) { var i = JSON.parse(t), r, e, u; i != null && (u = i.length - 1); e = i[u].UserImage != "VIS_NoRecordFound" && i[u].UserImage != "VIS_FileDoesn'tExist" && i[u].UserImage != null ? '<img  class="userAvatar-Feeds"  src="' + i[u].UserImage + "?" + new Date + '">' : '<i class="fa fa-user userAvatar-Feeds"><\/i>'; $("#VIS_txtComments" + n).val(""); $("#VIS_commentsdata" + n).html().contains("VIS_commentsMsg") ? (r = $('<div class= "vis-attachhistory-comment-detail VIS-feedDetails-cmnt d-flex" >' + e + '<div class="vis-attachhistory-comment-text ml-0"><div class="d-flex justify-content-between VIS-tp-commentHead"><h6 class="VIS-attachhistory-comment-text">Me <\/h6><div class="vis-attachhistory-comment-dateTime"><p>' + (new Date).toLocaleString().replace(",", "").replace(/:.. /, " ") + '<\/p><\/div><\/div><p class= "VIS-attachhistory-comment-text" >' + f + "<\/p><\/div><\/div>"), $("#VIS_commentsMsg" + n).empty(), $("#VIS_commentsMsg" + n).append(r), $("#VIS_viewMoreComments" + n).is(":visible") && $("#VIS_viewMoreComments" + n).append(r), $("#VIS_commentsdata" + n).show(), $("#VIS_commentsMsg" + n).show()) : (r = $('<div id="VIS_commentsMsg' + n + '"  class="vis-attachhistory-comment-data mb-0 VIS-tp-commentData"><div class= "vis-attachhistory-comment-detail VIS-feedDetails-cmnt d-flex" >' + e + '<div class="vis-attachhistory-comment-text ml-0"><div class="d-flex justify-content-between VIS-tp-commentHead"><h6 class="VIS-attachhistory-comment-text">Me <\/h6><div class="vis-attachhistory-comment-dateTime"><p>' + (new Date).toLocaleString().replace(",", "").replace(/:.. /, " ") + '<\/p><\/div><\/div><p class= "VIS-attachhistory-comment-text" >' + f + "<\/p><\/div><\/div><\/div>"), $("#VIS_commentsdata" + n).prepend(r), $("#VIS_viewMoreComments" + n).is(":visible") && $("#VIS_viewMoreComments" + n).append(r)) }, error: function () { VIS.ADialog.error("RecordNotSaved") } }) } function ei(n, t) { return n += ' <div class="vis-attachhistory-comment-data  mb-0 VIS-tp-commentData"><div class="vis-attachhistory-comment-detail VIS-feedDetails-cmnt d-flex">', n += t.UserImage != "VIS_NoRecordFound" && t.UserImage != "VIS_FileDoesn'tExist" && t.UserImage != null ? '<img  class="userAvatar-Feeds"  src="' + t.UserImage + "?" + new Date + '">' : '<i class="fa fa-user userAvatar-Feeds"><\/i>', n += '<div class="vis-attachhistory-comment-text ml-0">', n += t.CreatedBy == VIS.Env.getCtx().getAD_User_ID() ? '<div class="d-flex justify-content-between VIS-tp-commentHead"><h6 class="VIS-attachhistory-comment-text">' + VIS.Msg.getMsg("Me") + " <\/h6>" : '<div class="d-flex justify-content-between VIS-tp-commentHead"><h6 class="VIS-attachhistory-comment-text">' + t.UserName + "<\/h6>", n + ('<div class="vis-attachhistory-comment-dateTime"><p>' + new Date(t.Created).toLocaleString() + '<\/p><\/div><\/div> <p class="VIS-attachhistory-comment-text">' + t.CharacterData + "<\/p><\/div><\/div><\/div>") } function oi(i) { var r, u; if (i.length > 0) { for (r = '<div class="vis-attachhistory-comments-container">', u = 0; u < i.length; u++)r = ei(r, i[u]); r += "<\/div>"; $("#VIS_viewMoreComments" + n).show(); $("#VIS-tp-comments-input" + n).hide(); $("#VIS_viewMoreComments" + n).empty(); $("#VIS_commentsMsg" + n).hide(); $("#VIS_viewAllComments" + n).text(VIS.Msg.getMsg("HideComments")); $("#VIS_viewMoreComments" + n).height(t.find(".VIS-tp-contentdiv").height() - $("#VIS_commentsdata" + n).height()); $("#VIS_viewMoreComments" + n).append(r) } } function si(t, i) { return t += '<div class="vis-attachhistory-comment-detail VIS-feedDetails-cmnt d-flex">', t += i.UserImage != "VIS_NoRecordFound" && i.UserImage != "VIS_FileDoesn'tExist" && i.UserImage != null ? '<img  class="userAvatar-Feeds"  src="' + i.UserImage + "?" + new Date + '">' : '<i class="fa fa-user userAvatar-Feeds"><\/i>', t += '<div class="vis-attachhistory-comment-text ml-0">', t += i.CreatedBy == VIS.Env.getCtx().getAD_User_ID() ? '<div class="d-flex justify-content-between VIS-tp-commentHead"><h6 class="VIS-attachhistory-comment-text">' + VIS.Msg.getMsg("Me") + " <\/h6>" : '<div class="d-flex justify-content-between VIS-tp-commentHead"><h6 class="VIS-attachhistory-comment-text">' + i.UserName + "<\/h6>", t += '<div class="vis-attachhistory-comment-dateTime"><p>' + new Date(i.Created).toLocaleString() + '<\/p><\/div><\/div> <p class="VIS-attachhistory-comment-text">' + i.CharacterData + "<\/p><\/div><\/div > ", $("#VIS_commentsdata" + n).html().contains("VIS_commentsMsg") || (t = '<div id="VIS_commentsMsg' + n + '" class="vis-attachhistory-comment-data  mb-0 VIS-tp-commentData">' + t + "<\/div >"), t } function v(t, i, r) { $.ajax({ url: VIS.Application.contextUrl + "AttachmentHistory/ViewChatonLastHistory", datatype: "json", type: "POST", cache: !1, data: { record_ID: t, isAppointment: i, isCall: r }, success: function (t) { var r = JSON.parse(t), i; r.length > 0 && (i = "", i = si(i, r[0]), $("#VIS_commentsMsg" + n).empty(), $("#VIS_commentsdata" + n).html().contains("VIS_commentsMsg") ? $("#VIS_commentsMsg" + n).prepend(i) : $("#VIS_commentsdata" + n).prepend(i)) } }) } this.record_ID = 0; this.windowNo = 0; this.table_ID = 0; this.frame; this.curTab = null; this.selectedRow = null; this.panelWidth; var t = $('<div class="VIS-root-div"><\/div>'), g, r, e, f, y, p, bt, nt = 10, h = 0, kt = 0, dt = 0, w = 0, u = 0, s = 0, c = 0, i = 0, tt, k = 0, b = 0, n = 0, ut = null, ht; this.init = function () { g = $('<div class="VIS-testPanel VIS-HistGrd-data" id="VIS_HistoryGrd' + this.windowNo + '" ><\/div>'); r = $('<div id="VIS_recordDetail' + this.windowNo + '" style="display:none;" class="VIS-tp-detailsPanel"><\/div>'); t.prepend(g); p = $('<div id="VIS_pagingHtml' + this.windowNo + '" class="vis-ad-w-p-s-pages VIS-root-pagingHtml"><ul class="vis-ad-w-p-s-plst w-100"><li class="flex-fill"><div id="VIS_pagingText' + this.windowNo + '" class="vis-ad-w-p-s-result"><span class="vis-ad-w-p-s-statusdb" id="VIS_pageIndx' + n + '">0/0<\/span><span>Showing Result 0-0 of 0<\/span><\/div><\/li><li id="VIS_prevPage' + this.windowNo + '" style="opacity: 1;"><div ><i class="vis vis-pageup" title="Page Up(Alt+ Pg Up)" })="" style="opacity: 1;"><\/i><\/div><\/li><li><select id="VIS_ddlPages' + this.windowNo + '" class="vis-statusbar-combo"><option><\/option><\/select><\/li><li id="VIS_nextPage' + this.windowNo + '" style="opacity: 1;"><div ><i class="vis vis-pagedown" title="Page Down(Alt+ Pg Dn)" })="" style="opacity: 1;"><\/i><\/div><\/li><\/div><\/ul><\/div>'); bt = $('<div id="VIS_viewMoreComments' + this.windowNo + '" style="display:none;" class="VIS-tp-commentsPanel"><\/div>'); t.append(p); t.append(r); n = this.windowNo; l() }; this.getRoot = function () { return t }; this.update = function (n) { c = n; b = this.table_ID; ft(n, b); it(n, 0, this.windowNo, b) }; this.disposeComponent = function () { this.record_ID = 0; this.windowNo = 0; this.curTab = null; this.rowSource = null; this.panelWidth = null; _gridCtrl = null; t.remove(); t = null; n = 0 } } n.prototype.startPanel = function (n, t) { this.windowNo = n; this.curTab = t; this.init(); window_No = n; this.table_ID = t.getAD_Table_ID() }; n.prototype.refreshPanelData = function (n, t) { this.record_ID = n; this.selectedRow = t; this.update(n) }; n.prototype.sizeChanged = function (n) { this.panelWidth = n }; n.prototype.dispose = function () { this.disposeComponent() }; VIS.HistoryDetailsTabPanel = n }(); VIS = window.VIS || {}, function () { function n() { function ft(n, t, i) { f(!0); $.ajax({ url: VIS.Application.contextUrl + "VIS/SurveyPanel/GetSurveyItems", data: { AD_Survey_ID: n }, success: function (r) { f(!1); var u = []; u = JSON.parse(r); u != null && (et(u, t, i, n), st()) }, error: function () { f(!1) } }) } function et(u, f, e, v) { var d, it = "width: calc(100% - 35px);height: calc(100% - 71px);position: absolute;", p, y, w, ut, g, k, tt; if (n.curTab && n.curTab.getIsTPBottomAligned() && (it = ""), p = '<div class="VIS_SI_Main' + n.windowNo + '" style="' + it + '"><div class="vis-tp-mainContainer"> <ol class="list-unstyled vis-tp-orderListWrap"> ', f == "CL") { if (u.length > 0) for (y = 0; y < u.length; y++)p += '<li class="VIS_SI_' + u[y].Item.AD_SurveyItem_ID + ' align-items-center d-flex mb-3 pb-3 vis-tp-listItem"><h6 class="mr-2 mb-0" style="min-width:15px;text-algin:right">' + (y + 1) + '.<\/h6><input class="VIS_Answ_' + n.windowNo + '" data-id="VIS_Quest_' + u[y].Item.AD_SurveyItem_ID + '" data-surveyitem=' + u[y].Item.AD_SurveyItem_ID + ' data-surveyvalue="0" data-survey=' + u[y].Item.AD_Survey_ID + ' type= "checkbox" ><p class="VIS_Quest_' + u[y].Item.AD_SurveyItem_ID + '" data-qtype="' + f + '" data-mandatory="' + u[y].Item.IsMandatory + '">' + u[y].Item.Question, (c || u[y].Item.IsMandatory == "Y") && (p += '<sub style="color:red;font-size: 100%;bottom: unset;">*<\/sub>'), p += "<\/p><\/li>"; p += "<\/ol>" } else { if (u.length > 0) for (y = 0; y < u.length; y++)if (u[y].Item.AnswerType == "CB") { for (p += '<li class="mb-3"> <h6 data-qtype="' + u[y].Item.AnswerType + '" data-mandatory="' + u[y].Item.IsMandatory + '" class= "VIS_Quest_' + u[y].Item.AD_SurveyItem_ID + ' mb-3 vis-tp-qus ml"> ' + (y + 1) + ". " + u[y].Item.Question, (c || u[y].Item.IsMandatory == "Y") && (p += '<sub style="color:red;font-size: 100%;bottom: unset;">*<\/sub>'), p += '<\/h6 > <div class="vis-tp-listWrap"> ', w = 0; w < u[y].Values.length; w++)p += ' <div class="VIS_SI_' + u[y].Values[w].AD_SurveyValue_ID + ' align-items-center d-flex mb-3 vis-tp-listItem">  <input  data-id="VIS_Quest_' + u[y].Item.AD_SurveyItem_ID + '"', p += u[y].Item.AnswerSelection == "SL" ? ' class="VIS_Answ_' + u[y].Values[w].AD_SurveyValue_ID + " group_" + u[y].Item.AD_SurveyItem_ID + '" ' : ' class="VIS_Answ_' + u[y].Values[w].AD_SurveyValue_ID + '"', p += " data-surveyitem=" + u[y].Item.AD_SurveyItem_ID + " data-surveyvalue=" + u[y].Values[w].AD_SurveyValue_ID + "  data-survey=" + u[y].Item.AD_Survey_ID + ' value="' + u[y].Values[w].Answer + '" type="checkbox"> <p>' + u[y].Values[w].Answer + "<\/p> <\/div>"; p += "<\/div> <\/li > " } else if (u[y].Item.AnswerType == "OP") { for (p += '<li class="mb-3"> <h6 data-qtype=' + u[y].Item.AnswerType + ' data-mandatory="' + u[y].Item.IsMandatory + '" class="VIS_Quest_' + u[y].Item.AD_SurveyItem_ID + ' mb-3 vis-tp-qus">' + (y + 1) + ". " + u[y].Item.Question, (c || u[y].Item.IsMandatory == "Y") && (p += '<sub style="color:red;font-size: 100%;bottom: unset;">*<\/sub>'), p += '<\/h6 > <div class="vis-tp-listWrap"> ', w = 0; w < u[y].Values.length; w++)p += '<div  class=" VIS_SI_' + u[y].Values[w].AD_SurveyValue_ID + ' align-items-center d-flex mb-3 vis-tp-listItem"> <input type="radio" name=VIS_' + u[y].Item.AD_SurveyItem_ID + " data-id=VIS_Quest_" + u[y].Item.AD_SurveyItem_ID + " data-surveyitem=" + u[y].Item.AD_SurveyItem_ID + " data-surveyvalue=" + u[y].Values[w].AD_SurveyValue_ID + " data-survey=" + u[y].Item.AD_Survey_ID + ' class = "VIS_Answ_' + u[y].Values[w].AD_SurveyValue_ID + '" value="' + u[y].Values[w].Answer + '" > <p>' + u[y].Values[w].Answer + "<\/p><\/div>"; p += "<\/div><\/li > " } else u[y].Item.AnswerType == "TX" && (p += '<li class="mb-3"> <h6 data-qtype=' + u[y].Item.AnswerType + ' data-mandatory="' + u[y].Item.IsMandatory + '" class="VIS_Quest_' + u[y].Item.AD_SurveyItem_ID + ' mb-3 vis-tp-qus ml">' + (y + 1) + ". " + u[y].Item.Question, (c || u[y].Item.IsMandatory == "Y") && (p += '<sub style="color:red;font-size: 100%;bottom: unset;">*<\/sub>'), p += '<\/h6 > <textarea class="VIS_Answ_' + u[y].Item.AD_SurveyItem_ID + '" data-id=VIS_Quest_' + u[y].Item.AD_SurveyItem_ID + " data-surveyitem=" + u[y].Item.AD_SurveyItem_ID + ' data-surveyvalue="0" data-survey=' + u[y].Item.AD_Survey_ID + '  cols="30" rows="10" placeholder="Enter your text here"><\/textarea> <\/li > '); p += "<\/ol > " } if (p += "<\/div ><\/div > ", d = $(p), s == 0 && (i.find(".response").append(d.clone(!0).removeAttr("style")), i.find("input,textarea").attr("disabled", "disabled")), a > 0 && nt >= a ? (t.hide(), r.find("#quesMessage_" + n.windowNo).html(VIS.Msg.getMsg("VIS_AlreadySubmittedResponse")), r.find("#quesMessage_" + n.windowNo).removeClass("vis-displayNone")) : (t.append(d), ut = t.find(".VIS_SI_Main" + n.windowNo), g = "bottom: 0px;position: absolute;width: calc(100% - 35px);", n.curTab && n.curTab.getIsTPBottomAligned() && (g = "bottom: 0px;position: absolute;width: calc(100% - 10px);"), k = '<div class="vis-survey" style="' + g + '">', tt = ut.find("[class^=VIS_Quest_]").length, h > 0 && tt > h && (k += '<div class="' + (VIS.Application.isRTL ? " float-right" : " float-left") + '"><a class="prev btn mr-2"><i class="fa fa-chevron-' + (VIS.Application.isRTL ? "right" : "left") + '" aria-hidden="true"><\/i> ' + VIS.Msg.getMsg("VIS_Prev") + "<\/a><\/div>"), k += '<div style="padding-bottom: 10px;" class="vis-tp-btnWrap' + (VIS.Application.isRTL ? " float-left" : " float-right") + '" > <a class="next btn">' + VIS.Msg.getMsg("VIS_Next") + ' <i class="fa fa-chevron-' + (VIS.Application.isRTL ? "left" : "right") + '" aria-hidden="true"><\/i><\/a><a href="#" id="VIS_SI_BtnSubmit_' + n.windowNo + '" class="btn" >' + VIS.Msg.getMsg("VIS_Submit") + "<\/a> <\/div >", k += "<div>", t.append(k), h > 0 && tt > h && t.find(".vis-tp-orderListWrap li:gt(" + (h - 1) + ")").addClass("hideQuestion"), nt > 0 && (t.hide(), r.find("#quesMessage_" + n.windowNo).html('<span class="d-block px-2 text-center w-100">' + VIS.Msg.getMsg("VIS_SubmitAgain") + " " + rt + "<\/span>"), r.find("#quesMessage_" + n.windowNo).removeClass("vis-displayNone"), r.find("#quesMessage_" + n.windowNo + " a").click(function () { t.show(); r.find("#quesMessage_" + n.windowNo).addClass("vis-displayNone"); t.find(".vis-tp-orderListWrap li").removeClass("hideQuestion"); t.find(".vis-tp-orderListWrap li:gt(" + (h - 1) + ")").addClass("hideQuestion"); b() }))), s == 0) ot(v); else { s == 0 ? t.css("height", o) : t.css("height", "74vh"); l.find(".respTab").hide(); l.find(".quesTab").hide(); return } } function ot(c) { u = {}; e = 0; f(!0); $.ajax({ url: VIS.Application.contextUrl + "VIS/SurveyPanel/CheckResponseAccess", data: { AD_Survey_ID: c, AD_SurveyAssignment_ID: it, AD_User_ID: VIS.context.getAD_User_ID(), AD_Role_ID: VIS.context.getAD_Role_ID(), Record_ID: n.record_ID, AD_window_ID: p, AD_Table_ID: w, IsSelfShow: tt }, success: function (e) { var c, d, p, w, g; if (f(!1), c = [], c = JSON.parse(e), c != null && c.length > 0) for (d = 0, l.find(".respTab").show(), l.find(".quesTab").show(), tt ? t.css("height", y) : t.css("height", o), l.find(".responseCount").text(c.length), p = 0; p < c.length; p++)u["U" + c[p].User_ID] || (u["U" + c[p].User_ID] = []), u["U" + c[p].User_ID].push({ id: c[p].AD_SurveyResponse_ID, Created: new Date(c[p].Created).toLocaleString() }), i.find('select option[value="' + c[p].User_ID + '"]').length > 0 || (c[p].Name == "Self" && d == 0 ? (d++, i.find("select").append('<option selected value="' + c[p].User_ID + '">' + c[p].Name + "<\/option>")) : i.find("select").append('<option value="' + c[p].User_ID + '" >' + c[p].Name + "<\/option>")); else { s == 0 ? t.css("height", o) : t.css("height", "74vh"); l.find(".respTab").hide(); l.find(".quesTab").hide(); return } if (w = VIS.context.getAD_User_ID(), !u["U" + w]) { i.find("select option:selected").change(); return } v = u["U" + w][0].id; u["U" + w].length > 1 ? (i.find(".next").removeAttr("disabled"), i.find(".prev").attr("disabled", "disabled")) : (i.find(".prev").attr("disabled", "disabled"), i.find(".next").attr("disabled", "disabled")); i.find(".resStatus").text("1/" + u["U" + w].length); i.find(".submittedDate").text(u["U" + w][0].Created); g = !0; a > 0 && u["U" + w].length >= a && (t.hide(), r.find("#quesMessage_" + n.windowNo).html(VIS.Msg.getMsg("VIS_AlreadySubmittedResponse")), r.find("#quesMessage_" + n.windowNo).removeClass("vis-displayNone"), g = !1); g && u["U" + w].length > 0 && (t.hide(), r.find("#quesMessage_" + n.windowNo).html('<span class="d-block px-2 text-center w-100">' + VIS.Msg.getMsg("VIS_SubmitAgain") + " " + rt + "<\/span>"), r.find("#quesMessage_" + n.windowNo).removeClass("vis-displayNone"), r.find("#quesMessage_" + n.windowNo + " a").click(function () { t.show(); r.find("#quesMessage_" + n.windowNo).addClass("vis-displayNone"); t.find(".vis-tp-orderListWrap li").removeClass("hideQuestion"); t.find(".vis-tp-orderListWrap li:gt(" + (h - 1) + ")").addClass("hideQuestion"); b() })); s == 0 && k(w) }, error: function () { f(!1) } }) } function k(t) { i.find("input").prop("checked", !1); i.find("textarea").val(""); f(!0); $.ajax({ url: VIS.Application.contextUrl + "VIS/SurveyPanel/GetResponseList", data: { AD_window_ID: p, AD_Table_ID: w, Record_ID: n.record_ID, AD_User_ID: t, AD_SurveyResponse_ID: v }, success: function (n) { var t = [], r; if (t = JSON.parse(n), t != null && t.length > 0) for (r = 0; r < t.length; r++)t[r].AnswerType == "TX" ? i.find('[data-surveyitem="' + t[r].AD_SurveyItem_ID + '"][data-surveyvalue="' + t[r].AD_SurveyValue_ID + '"]').val(t[r].Answer) : i.find('[data-surveyitem="' + t[r].AD_SurveyItem_ID + '"][data-surveyvalue="' + t[r].AD_SurveyValue_ID + '"]').prop("checked", !0); f(!1) }, error: function () { f(!1) } }) } function st() { $mainDiv = t.find(".VIS_SI_Main" + n.windowNo); $btnSubmit = t.find("#VIS_SI_BtnSubmit_" + n.windowNo); ht(); b() } function b() { t.find(".vis-tp-orderListWrap li:last").is(":hidden") ? ($btnSubmit.hide(), t.find(".next").show()) : ($btnSubmit.show(), t.find(".next").hide()); t.find(".vis-tp-orderListWrap li:first").is(":hidden") ? t.find(".prev").show() : t.find(".prev").hide(); t.find(".vis-tp-orderListWrap").scrollTop(0) } function ht() { $btnSubmit.off().on("click", function () { n.SaveData(n.record_ID) }); t.find("[class*=group_]").off().click(function () { $(this).next().attr("data-qtype") && $(this).next().attr("data-qtype") == "CL" || ct(this, "group_" + $(this).data("surveyitem")) }); t.find(".next").off().click(function () { var n = t.find(".vis-tp-orderListWrap").children("li:visible:last"); n.nextAll(":lt(" + h + ")").removeClass("hideQuestion"); n.next().prevAll().addClass("hideQuestion"); b() }); t.find(".prev").off().click(function () { var n = t.find(".vis-tp-orderListWrap").children("li:visible:first"); n.prevAll(":lt(" + h + ")").removeClass("hideQuestion"); n.prev().nextAll().addClass("hideQuestion"); b() }); i.find("select").off().change(function () { e = 0; var n = i.find("select option:selected").val(); v = u["U" + n][0].id; i.find(".submittedDate").text(u["U" + n][0].Created); i.find(".resStatus").text(e + 1 + "/" + u["U" + n].length); u["U" + n].length == 1 ? (i.find(".next").attr("disabled", "disabled"), i.find(".prev").attr("disabled", "disabled")) : (i.find(".next").removeAttr("disabled"), i.find(".prev").attr("disabled", "disabled")); k(n) }); i.find(".next").off().click(function () { e++; var n = i.find("select option:selected").val(); v = u["U" + n][e].id; i.find(".submittedDate").text(u["U" + n][e].Created); e >= u["U" + n].length - 1 && $(this).attr("disabled", "disabled"); i.find(".prev").removeAttr("disabled"); i.find(".resStatus").text(e + 1 + "/" + u["U" + n].length); k(n) }); i.find(".prev").off().click(function () { e--; var n = i.find("select option:selected").val(); v = u["U" + n][e].id; i.find(".submittedDate").text(u["U" + n][e].Created); e == 0 && $(this).attr("disabled", "disabled"); i.find(".next").removeAttr("disabled"); i.find(".resStatus").text(e + 1 + "/" + u["U" + n].length); k(n) }) } function ct(n, i) { for (var u = t[0].getElementsByClassName(i), r = 0; r < u.length; r++)u[r] == n || (u[r].checked = !1) } this.record_ID = 0; this.windowNo = 99999; this.curTab = null; this.selectedRow = null; this.panelWidth; this.extraInfo = null; this.isCheckListFill = !1; var n = this, r, t = null, i = null, p = 0, d = 0, w = 0, s = 0, g, c = !1, h = 0, a = 0, it = 0, v = 0, nt = 0, u = {}, e = 0, tt = !0, l = null, rt = '<a href="javascript:;">' + VIS.Msg.getMsg("VIS_ClickHere") + "<\/a>", ut = $('<div class="vis-busyindicatorouterwrap"><div class="vis-busyindicatorinnerwrap"><i class="vis-busyindicatordiv"><\/i><\/div><\/div>'), f = function (n) { ut.css("display", n ? "block" : "none") }, o = null, y = null; this.init = function () { f(!1); r = $("<div><\/div>").append(ut); o = VIS.Env.getScreenHeight() - 230; n.curTab.getIsHeaderPanel() && (o = o - VIS.Utility.Util.getValueOfInt(n.curTab.getHeaderHeight().replace("px", " ")) - 10); (!o || o < 0) && (o = $(".divWorkflowActivity").height() - 19); o ? (y = o - 38 + "px", o = o + "px") : (o = "100%", y = "100%"); var u = $('<div class="vis-surveyTab"><div class="vis-tabPrimary"><ul class="nav vis-primarySection nav-tabs mb-1" id="surveyTab_' + n.windowNo + '" role="tablist"><li class="nav-item vis-firstResLink  text-center ">  <a    class="nav-link active quesTab text-center"    id="home-tab"    data-toggle="tab"    href="#quesSec_' + n.windowNo + '"    >' + VIS.Msg.getMsg("VIS_Questions") + '<\/a><\/li><li class="nav-item text-center" >  <a style="display:none"    class="nav-link respTab text-center"    id="profile-tab"    data-toggle="tab"    href="#resp_' + n.windowNo + '"    >' + VIS.Msg.getMsg("Response") + '<span class="badge badge-light responseCount' + (VIS.Application.isRTL ? " mr-1" : " ml-1") + '">0<\/span><\/a><\/li><\/ul><div class="tab-content"><div class="tab-pane fade show active" style="width:100%;" id="quesSec_' + n.windowNo + '"><div class="align-items-center d-flex justify-content-center vis-displayNone" style="height:' + y + '" id="quesMessage_' + n.windowNo + '"><\/div><div style="height:' + y + ';overflow-y:auto !important;" id="ques_' + n.windowNo + '"><\/div><\/div><div class="tab-pane fade mt-2" style="height:' + y + ';width:100%;overflow:auto !important;" id="resp_' + n.windowNo + '"><div class="d-flex align-items-center justify-content-between mr-2 ml-2"><div class="d-flex align-items-center ' + (VIS.Application.isRTL ? " ml-1" : " mr-1") + '"><span class="d-inline-block ' + (VIS.Application.isRTL ? " ml-1" : " mr-1") + '">' + VIS.Msg.getMsg("SelectUser") + '<\/span><select class="w-100"><\/select><\/div> <div class="align-items-center d-flex"> <span class="' + (VIS.Application.isRTL ? "ml-1" : "mr-1") + ' ">' + VIS.Msg.getMsg("Response") + ':<\/span><span class="align-items-center d-flex"><button class="vis-cusPagination prev"><i class="fa fa-chevron-circle-' + (VIS.Application.isRTL ? "right ml-1" : "left mr-1") + ' " aria-hidden="true"><\/i><\/button><span class="resStatus vis-surveyPagination">0/0<\/span class="d-flex align-items-center"><button class="vis-cusPagination next"><i class="fa fa-chevron-circle-' + (VIS.Application.isRTL ? "left mr-1" : "right ml-1") + '" aria-hidden="true"><\/i><\/button><\/span><\/div><\/div> <div class="' + (VIS.Application.isRTL ? "text-left ml-2" : "text-right mr-2") + ' mt-2"  style="font-size: 12px;font-style: italic;" >' + VIS.Msg.getMsg("VIS_Submitted") + ': <span class="submittedDate"><\/span><\/div><div class="response"><\/div><\/div > <\/div><\/div><\/div>'); r.append(u); l = r.find("#surveyTab_" + n.windowNo); t = r.find("#ques_" + n.windowNo); i = r.find("#resp_" + n.windowNo) }; this.update = function (t) { if (n.isCheckListFill) { if (t < 0) return !1; n.SaveData(t) } else n.panelDetails(this.curTab.vo.AD_Window_ID, this.curTab.vo.AD_Tab_ID, this.curTab.getAD_Table_ID(), t, r, 0) }; this.setisCheckListFill = function (n) { this.isCheckListFill = n }; this.panelDetails = function (r, u, o, l, y, b) { n.isCheckListFill = !1; n.record_ID = l; p = r; d = u; w = o; s = b; t.empty(); y.find(".vis-surveyTab .vis-primarySection").show(); y.find("#quesMessage_" + n.windowNo).addClass("vis-displayNone"); i.find(".response").empty(); c = !1; h = 0; e = 0; a = 0; f(!0); $.ajax({ url: VIS.Application.contextUrl + "VIS/SurveyPanel/GetSurveyAssignments", data: { AD_window_ID: r, AD_Tab_ID: u, AD_Table_ID: o, AD_Record_ID: n.record_ID, AD_WF_Activity_ID: s }, success: function (t) { f(!1); var i = []; i = JSON.parse(t); i != null && i.length > 0 ? (c = i[0].IsMandatory, h = i[0].QuestionsPerPage, tt = i[0].IsSelfshow, a = i[0].Limit, nt = i[0].ResponseCount, it = i[0].SurveyAssignment_ID, v = i[0].SurveyResponse_ID, ft(i[0].Survey_ID, i[0].SurveyType, y)) : s > 0 && (y.find(".vis-surveyTab .vis-primarySection").hide(), y.find("#quesMessage_" + n.windowNo).html(VIS.Msg.getMsg("VIS_NoCheckListFound")), y.find("#quesMessage_" + n.windowNo).removeClass("vis-displayNone")) }, error: function () { f(!1) } }) }; this.getRoot = function () { return r }; this.SaveData = function (i) { var v, u, a, e, h; f(!0); var y = t.find(".VIS_SI_Main" + n.windowNo), b = y.find("[class^=VIS_Answ_]"), o = y.find("[class^=VIS_Quest_]"), l = {}; for (l.Questions = [], v = 0, u = 0; u < o.length; u++)if (a = !0, e = t.find('[data-id="' + o[u].classList[0] + '"]'), v = e[0].dataset.survey, o[u].dataset.qtype == "CB" || o[u].dataset.qtype == "OP" || o[u].dataset.qtype == "CL") { if (e.length > 0) { for (h = 0; h < e.length; h++)$(e[h]).is(":checked") && (a = !1, l.Questions.push({ Question: o[u].textContent, Answer: $(e[h]).val(), AD_SurveyItem_ID: e[h].dataset.surveyitem, AD_SurveyValue_ID: e[h].dataset.surveyvalue })); if ((c || o[u].dataset.mandatory == "Y") && a) { VIS.ADialog.error("FillMandatory", !0, "Ques-" + (u + 1)); f(!1); return } } } else if (o[u].dataset.qtype == "TX" && ($(e[0]).val().length > 0 && (a = !1), l.Questions.push({ Question: o[u].textContent, Answer: $(e[0]).val(), AD_SurveyItem_ID: e[0].dataset.surveyitem, AD_SurveyValue_ID: e[0].dataset.surveyvalue }), (c || o[u].dataset.mandatory == "Y") && a)) { VIS.ADialog.error("FillMandatory", !0, "Ques-" + (u + 1)); f(!1); return } if (s == 0 && i <= 0 && l.Questions.length > 0) { n.isCheckListFill = !0; toastr.success(VIS.Msg.getMsg("CheckWillAutoSaveAfterNewRecordSave"), "", { timeOut: 3e3, positionClass: "toast-top-right", closeButton: !0 }); f(!1); return } n.isCheckListFill = !1; $.ajax({ type: "POST", url: VIS.Application.contextUrl + "VIS/SurveyPanel/SaveSurveyResponse", dataType: "json", contentType: "application/json; charset=utf-8", data: JSON.stringify({ surveyResponseValue: l.Questions, AD_Window_ID: p, AD_Survey_ID: v, AD_Tab_ID: d, Record_ID: i, AD_Table_ID: w, AD_WF_Activity_ID: s }), success: function () { t.find("input").prop("checked", !1); t.find("textarea").val(""); toastr.success(VIS.Msg.getMsg("CheckListSaved"), "", { timeOut: 3e3, positionClass: "toast-top-right", closeButton: !0 }); n.isCheckListFill = !1; s == 0 ? n.update(n.record_ID) : n.panelDetails(p, d, w, n.record_ID, r, s); f(!1) }, error: function () { f(!1) } }) }; this.disposeComponent = function () { g && g.remove(); r.remove(); g = null; r = null } } n.prototype.startPanel = function (n, t, i) { this.windowNo = n; this.curTab = t; this.extraInfo = i; this.init() }; n.prototype.refreshPanelData = function (n, t) { this.record_ID = n; this.selectedRow = t; this.update(n) }; n.prototype.sizeChanged = function (n) { this.panelWidth = n }; n.prototype.dispose = function () { this.disposeComponent() }; VIS.SurveyPanel = n }(); VIS = window.VIS || {}, function () { function n() { this.record_ID = 0; this.windowNo = 0; this.curTab = null; this.selectedRow = null; this.panelWidth; var t = null, i = null, r = null, u = null, f = null, n = $('<div style="height:100%;width:100%;padding:15px"><\/div>'); this.init = function () { var e = '<div class="vis-testPanel-Div"><span class="vis-testPanel-Span">Name: <\/span><label class="vis-testPanel-Label" id="' + this.windowNo + 'lblName"><\/label> <\/div><div class="vis-testPanel-Div"><span class="vis-testPanel-Span">Location: <\/span><label class="vis-testPanel-Label" id="' + this.windowNo + 'lblLocation"><\/label> <\/div><div class="vis-testPanel-Div"><span class="vis-testPanel-Span">Business Partner: <\/span><label class="vis-testPanel-Label" id="' + this.windowNo + 'lblBPartner"><\/label> <\/div><div class="vis-testPanel-Div"><span class="vis-testPanel-Span">Date Time: <\/span><label class="vis-testPanel-Label" id="' + this.windowNo + 'lblDateTime"><\/label> <\/div><div class="vis-testPanel-Div"><span class="vis-testPanel-Span">Amount: <\/span><label class="vis-testPanel-Label" id="' + this.windowNo + 'lblAmount"><\/label> <\/div>'; n.append(e); t = n.find("#" + this.windowNo + "lblName"); i = n.find("#" + this.windowNo + "lblLocation"); r = n.find("#" + this.windowNo + "lblBPartner"); u = n.find("#" + this.windowNo + "lblDateTime"); f = n.find("#" + this.windowNo + "lblAmount") }; this.getRoot = function () { return n }; this.update = function () { var n, e; t.text(VIS.context.getWindowContext(this.windowNo, "Name")); try { e = "C_Location_ID"; n = this.selectedRow[e.toLower()]; (VIS.DisplayType.IsLookup(this.curTab.getField(e).getDisplayType()) || VIS.DisplayType.Location == this.curTab.getField(e).getDisplayType()) && (n && (n = this.curTab.getField(e.toLower()).lookup.getDisplay(n)), i.text(n)); n = null; e = "C_BPartner_ID"; n = this.selectedRow[e.toLower()]; (VIS.DisplayType.IsLookup(this.curTab.getField(e).getDisplayType()) || VIS.DisplayType.Location == this.curTab.getField(e).getDisplayType()) && (n && (n = this.curTab.getField(e.toLower()).lookup.getDisplay(n)), r.text(n)); n = null; e = "T_DateTime"; VIS.DisplayType.IsDate(this.curTab.getField(e).getDisplayType()) && (n = this.curTab.getField(e).value, n = new Date(n).toLocaleString(), u.text(n)); n = null; e = "T_Amount"; n = this.selectedRow[e.toLower()]; f.text(n) } catch (o) { } }; this.disposeComponent = function () { this.record_ID = 0; this.windowNo = 0; this.curTab = null; this.rowSource = null; this.panelWidth = null; t.remove(); t = null; i.remove(); i = null; r.remove(); r = null; u.remove(); u = null; f.remove(); f = null; n.remove(); n = null } } n.prototype.startPanel = function (n, t) { this.windowNo = n; this.curTab = t; this.init() }; n.prototype.refreshPanelData = function (n, t) { this.record_ID = n; this.selectedRow = t; this.update(n) }; n.prototype.sizeChanged = function (n) { this.panelWidth = n }; n.prototype.dispose = function () { this.disposeComponent() }; VIS.TestPanel = n }(), function (n, t) { n.TestForm = function () { function o() { i = t("<div>"); f = t("<input type='text'>"); r = t("<input type='button'>").val("Show"); u = t("<input type='button'>").val("Close"); i.append(f).append(r).append(u) } var i, f, r, u, e; this.frame; this.windowNo; o(); e = this; r.on(n.Events.onTouchStartOrClick, function () { alert("Test From has value :==> " + f.val()) }); u.on(n.Events.onTouchStartOrClick, function () { confirm("wanna close this form???") && e.dispose() }); this.getRoot = function () { return i }; this.disposeComponent = function () { e = null; i && i.remove(); i = null; r && r.off(n.Events.onTouchStartOrClick); u && u.off(n.Events.onTouchStartOrClick); f = r = u = null; this.getRoot = null; this.disposeComponent = null } }; n.TestForm.prototype.init = function (n, t) { this.frame = t; this.frame.getContentGrid().append(this.getRoot()) }; n.TestForm.prototype.dispose = function () { this.disposeComponent(); this.frame && this.frame.dispose(); this.frame = null }; n.TestMsgForm = function () { function s() { u = t("<div>"); f = t("<input type='text'>"); i = t("<input type='button'>").val("Start"); r = t("<input type='button' disable>").val("Stop"); u.append(f).append(i).append(r) } function o(n, t) { n ? (r.hide(), i.show(), f.css("color", "red")) : (r.show(), i.hide(), f.css("color", "green")); f.val(t) } var u, f, i, r, e; this.frame; this.windowNo; s(); e = this; i.on(n.Events.onTouchStartOrClick, function () { e.sendRequest(!1); o(!1, "started") }); r.on(n.Events.onTouchStartOrClick, function () { e.sendRequest(!0); o(!0, "Stopped") }); this.getRoot = function () { return u }; this.onmessage = function (n) { n.Event == "DEMOS" ? o(!1, n.Message) : n.Event == "DEMOE" && o(!0, n.Message) }; this.disposeComponent = function () { e = null; u && u.remove(); u = null; i && i.off(n.Events.onTouchStartOrClick); r && r.off(n.Events.onTouchStartOrClick); f = i = r = null; this.getRoot = null; this.disposeComponent = null } }; n.TestMsgForm.prototype.init = function (t, i) { this.frame = i; this.frame.getContentGrid().append(this.getRoot()); n.sseManager.register(this) }; n.TestMsgForm.prototype.sendRequest = function (t) { n.dataContext.postJSONData(n.Application.contextUrl + "Message/Demo", { IsStop: t }, function () { }) }; n.TestMsgForm.prototype.dispose = function () { this.disposeComponent(); this.frame && this.frame.dispose(); this.frame = null; n.sseManager.unregister(this) } }(VIS, jQuery), function (n, t) { function i() { function r() { var u = t("#vis_theme"), r; u.on("click", "div.vis-theme-rec", function (n) { var r = t(n.currentTarget).data("color"); i(r) }); n.Application.theme && n.Application.theme != "" ? i(n.Application.theme) : (r = u.find("div.vis-theme-rec"), r.length > 0 && i(t(r[0]).data("color"))) } function i(n) { var t = document.documentElement, i = n.split("|"); t.style.setProperty("--v-c-primary", i[0]); t.style.setProperty("--v-c-on-primary", i[1]); t.style.setProperty("--v-c-secondary", i[2]); t.style.setProperty("--v-c-on-secondary", i[3]) } return { init: r, applyTheme: i } } n.themeMgr = i() }(VIS, jQuery), function (n, t) { VIS.VApp = function () { function i() { var n = t.context.getAD_Language().replace("_", "-"); Globalize.culture(n) } function r() { document.getElementById("vis_mainConatiner").removeChild(document.getElementById("vis_busyGrid")); var t = n("#vis_antiForgeryToken").val(); n.ajaxSetup({ headers: { VerificationToken: t } }); VIS.Application.isIOS = /ipad|iphone|ipod/i.test(navigator.userAgent.toLowerCase()) } function u() { var n = t.Logging; n.VLogMgt.initialize(!0); n.VLogMgt.setLevel(VIS.Ini.getTraceLevel()) } function f() { VIS.Ini.updateLocalContextFromIni() } function e() { r(); i(); f(); u(); VIS.desktopMgr.start(); VIS.themeMgr.init(); VIS.Env.setWINDOW_PAGE_SIZE(VIS.Ini.getLocalStorage(VIS.IniConstants.WIN_PAGESIZE)); var e = n("#vis_userDate").find("span"); e.text(" " + (new Date).toLocaleDateString(t.context.getAD_Language().replace("_", "-"), { weekday: "long", year: "numeric", month: "long", day: "numeric" })) } return { init: e } }() }(jQuery, VIS)